/**
 * UX Accordion Component
 * Acordeones expandibles estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Accordion
    ======================================== */

    .ux-accordion {
      display: flex;
      flex-direction: column;
      width: 100%;
      background-color: var(--ux-surface);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
    }

    /* ========================================
       Accordion Item
    ======================================== */

    .ux-accordion-item {
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-accordion-item:last-child {
      border-bottom: none;
    }

    /* ========================================
       Accordion Header
    ======================================== */

    .ux-accordion-item__header {
      display: flex;
      align-items: center;
      width: 100%;
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background: none;
      border: none;
      color: var(--ux-text);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-md);
      text-align: left;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-accordion-item__header:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-accordion-item__header:active {
      background-color: var(--ux-light);
    }

    .ux-accordion-item--disabled .ux-accordion-item__header {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-accordion-item--disabled .ux-accordion-item__header:hover {
      background-color: transparent;
    }

    /* ========================================
       Accordion Header Content
    ======================================== */

    .ux-accordion-item__icon {
      width: 24px;
      height: 24px;
      margin-right: var(--ux-space-md);
      color: var(--ux-text-secondary);
      flex-shrink: 0;
    }

    .ux-accordion-item__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-accordion-item__content {
      flex: 1;
      min-width: 0;
    }

    .ux-accordion-item__title {
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-accordion-item__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: 2px;
    }

    .ux-accordion-item__chevron {
      width: 20px;
      height: 20px;
      margin-left: var(--ux-space-md);
      color: var(--ux-text-tertiary);
      flex-shrink: 0;
      transition: transform var(--ux-transition-base) var(--ux-ease);
    }

    .ux-accordion-item__chevron svg {
      width: 100%;
      height: 100%;
    }

    .ux-accordion-item--open .ux-accordion-item__chevron {
      transform: rotate(180deg);
    }

    /* ========================================
       Accordion Body
    ======================================== */

    .ux-accordion-item__body {
      display: grid;
      grid-template-rows: 0fr;
      transition: grid-template-rows var(--ux-transition-base) var(--ux-ease);
    }

    .ux-accordion-item--open .ux-accordion-item__body {
      grid-template-rows: 1fr;
    }

    .ux-accordion-item__body-inner {
      overflow: hidden;
    }

    .ux-accordion-item__body-content {
      padding: 0 var(--ux-space-lg) var(--ux-space-lg);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      line-height: 1.6;
    }

    /* With left icon offset */
    .ux-accordion-item--with-icon .ux-accordion-item__body-content {
      padding-left: calc(var(--ux-space-lg) + 24px + var(--ux-space-md));
    }

    /* ========================================
       Accordion Variants
    ======================================== */

    /* Inset (iOS grouped style) */
    .ux-accordion--inset {
      margin: var(--ux-space-lg);
    }

    /* Outline */
    .ux-accordion--outline {
      background-color: transparent;
      border: 1px solid var(--ux-border-color);
    }

    .ux-accordion--outline .ux-accordion-item {
      border-bottom-color: var(--ux-border-color);
    }

    /* Flat */
    .ux-accordion--flat {
      border-radius: 0;
      background-color: transparent;
    }

    .ux-accordion--flat .ux-accordion-item {
      background-color: var(--ux-surface);
      margin-bottom: var(--ux-space-sm);
      border-radius: var(--ux-border-radius);
      border-bottom: none;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-accordion--sm .ux-accordion-item__header {
      min-height: 40px;
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
    }

    .ux-accordion--sm .ux-accordion-item__icon {
      width: 20px;
      height: 20px;
    }

    .ux-accordion--sm .ux-accordion-item__body-content {
      padding: 0 var(--ux-space-md) var(--ux-space-md);
      font-size: var(--ux-font-size-xs);
    }

    .ux-accordion--lg .ux-accordion-item__header {
      min-height: 60px;
      padding: var(--ux-space-lg) var(--ux-space-xl);
      font-size: var(--ux-font-size-lg);
    }

    .ux-accordion--lg .ux-accordion-item__body-content {
      padding: 0 var(--ux-space-xl) var(--ux-space-xl);
      font-size: var(--ux-font-size-md);
    }

    /* ========================================
       Accordion List (simpler version)
    ======================================== */

    .ux-accordion-list {
      background-color: var(--ux-surface);
    }

    .ux-accordion-list__item {
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-accordion-list__item:last-child {
      border-bottom: none;
    }

    /* ========================================
       FAQ Style
    ======================================== */

    .ux-accordion--faq .ux-accordion-item__title {
      font-weight: 600;
    }

    .ux-accordion--faq .ux-accordion-item__title::before {
      content: 'Q: ';
      color: var(--ux-primary);
    }

    .ux-accordion--faq .ux-accordion-item__body-content::before {
      content: 'A: ';
      font-weight: 600;
      color: var(--ux-success);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-accordion--glass {
      border: 0.5px solid var(--ux-glass-border);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
    }

    .ux-accordion--glass .ux-accordion-item {
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    .ux-accordion--glass .ux-accordion-item:last-child {
      border-bottom: none;
    }

    .ux-accordion--glass .ux-accordion-item__header {
      background: transparent;
    }

    .ux-accordion--glass .ux-accordion-item__header:hover {
      background: var(--ux-glass-bg-thin);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-accordion-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-accordion-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for accordion
  // ARIA: aria-expanded, aria-controls on headers; region role on panels
  // Keyboard: Arrow Up/Down, Home/End, Enter/Space
  const accordionComponent = (config = {}) => ({
    openItems: config.openItems || [],
    multiple: config.multiple || false,
    disabled: config.disabled || false,
    accordionId: config.id || 'ux-accordion-' + Math.random().toString(36).substr(2, 9),
    totalItems: config.totalItems || 0,
    focusedIndex: -1,

    isOpen(index) {
      return this.openItems.includes(index);
    },

    // ARIA attributes for accordion header button
    getHeaderAriaAttrs(index) {
      return {
        'aria-expanded': this.isOpen(index) ? 'true' : 'false',
        'aria-controls': this.accordionId + '-panel-' + index,
        'id': this.accordionId + '-header-' + index
      };
    },

    // ARIA attributes for accordion panel
    getPanelAriaAttrs(index) {
      return {
        'role': 'region',
        'aria-labelledby': this.accordionId + '-header-' + index,
        'id': this.accordionId + '-panel-' + index
      };
    },

    toggle(index) {
      if (this.disabled) return;

      if (this.isOpen(index)) {
        this.close(index);
      } else {
        this.open(index);
      }
    },

    open(index) {
      if (!this.multiple) {
        this.openItems = [index];
      } else if (!this.openItems.includes(index)) {
        this.openItems.push(index);
      }
    },

    close(index) {
      const i = this.openItems.indexOf(index);
      if (i !== -1) {
        this.openItems.splice(i, 1);
      }
    },

    openAll(total) {
      this.openItems = Array.from({ length: total }, (_, i) => i);
    },

    closeAll() {
      this.openItems = [];
    },

    // Keyboard navigation handler
    handleKeydown(event, index) {
      const headers = this.$el.querySelectorAll('.ux-accordion-item__header');
      const total = headers.length;

      switch (event.key) {
        case 'ArrowDown':
          event.preventDefault();
          this.focusItem((index + 1) % total, headers);
          break;
        case 'ArrowUp':
          event.preventDefault();
          this.focusItem((index - 1 + total) % total, headers);
          break;
        case 'Home':
          event.preventDefault();
          this.focusItem(0, headers);
          break;
        case 'End':
          event.preventDefault();
          this.focusItem(total - 1, headers);
          break;
        case 'Enter':
        case ' ':
          event.preventDefault();
          this.toggle(index);
          break;
      }
    },

    focusItem(index, headers) {
      this.focusedIndex = index;
      if (headers && headers[index]) {
        headers[index].focus();
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxAccordion', accordionComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxAccordion', accordionComponent);
    });
  }

  // Alpine component for single accordion item
  // ARIA: aria-expanded on header
  // Keyboard: Enter/Space to toggle
  const accordionItemComponent = (config = {}) => ({
    isOpen: config.isOpen || false,
    disabled: config.disabled || false,
    itemId: config.id || 'ux-accordion-item-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for header
    get headerAriaAttrs() {
      return {
        'aria-expanded': this.isOpen ? 'true' : 'false',
        'aria-controls': this.itemId + '-panel',
        'id': this.itemId + '-header'
      };
    },

    // ARIA attributes for panel
    get panelAriaAttrs() {
      return {
        'role': 'region',
        'aria-labelledby': this.itemId + '-header',
        'id': this.itemId + '-panel'
      };
    },

    toggle() {
      if (!this.disabled) {
        this.isOpen = !this.isOpen;
      }
    },

    open() {
      if (!this.disabled) {
        this.isOpen = true;
      }
    },

    close() {
      this.isOpen = false;
    },

    // Keyboard handler for Enter/Space
    handleKeydown(event) {
      if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        this.toggle();
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxAccordionItem', accordionItemComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxAccordionItem', accordionItemComponent);
    });
  }
})();

/**
 * UX Alert Component
 * Alertas y diÃ¡logos estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Alert Backdrop
    ======================================== */

    .ux-alert-backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: var(--ux-z-modal);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-xl);
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        visibility var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-alert-backdrop--open {
      opacity: 1;
      visibility: visible;
    }

    /* ========================================
       UX Alert (iOS style)
    ======================================== */

    .ux-alert {
      width: 100%;
      max-width: 270px;
      background: var(--ux-glass-bg-thick);
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border-radius: var(--ux-glass-radius-md);
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
      overflow: hidden;
      transform: scale(1.1);
      opacity: 0;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease-spring),
        opacity var(--ux-transition-fast) var(--ux-ease);
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-alert {
        background-color: var(--ux-surface);
      }
    }

    .ux-alert-backdrop--open .ux-alert {
      transform: scale(1);
      opacity: 1;
    }

    /* ========================================
       Alert Content
    ======================================== */

    .ux-alert__content {
      padding: var(--ux-space-lg) var(--ux-space-lg) var(--ux-space-md);
      text-align: center;
    }

    .ux-alert__icon {
      width: 48px;
      height: 48px;
      margin: 0 auto var(--ux-space-md);
    }

    .ux-alert__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-alert__icon--success {
      color: var(--ux-success);
    }

    .ux-alert__icon--warning {
      color: var(--ux-warning);
    }

    .ux-alert__icon--danger {
      color: var(--ux-danger);
    }

    .ux-alert__icon--info {
      color: var(--ux-primary);
    }

    .ux-alert__title {
      font-size: var(--ux-font-size-lg);
      font-weight: var(--ux-font-weight-semibold);
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
      letter-spacing: -0.01em;
    }

    .ux-alert__message {
      font-size: var(--ux-font-size-base);
      font-weight: var(--ux-font-weight-regular);
      color: var(--ux-text-secondary);
      margin: 0;
      line-height: 1.4;
    }

    /* ========================================
       Alert Inputs
    ======================================== */

    .ux-alert__inputs {
      padding: var(--ux-space-sm) var(--ux-space-lg);
    }

    .ux-alert__input {
      width: 100%;
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      background-color: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      outline: none;
      transition: border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-alert__input:focus {
      border-color: var(--ux-primary);
    }

    .ux-alert__input + .ux-alert__input {
      margin-top: var(--ux-space-sm);
    }

    /* ========================================
       Alert Buttons
    ======================================== */

    .ux-alert__buttons {
      display: flex;
      border-top: 0.5px solid var(--ux-glass-border);
    }

    .ux-alert__buttons--stacked {
      flex-direction: column;
    }

    .ux-alert__button {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 44px;
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: none;
      border: none;
      color: var(--ux-primary);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-lg);
      font-weight: var(--ux-font-weight-regular);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-alert__button:not(:last-child) {
      border-right: 0.5px solid var(--ux-glass-border);
    }

    .ux-alert__buttons--stacked .ux-alert__button:not(:last-child) {
      border-right: none;
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    .ux-alert__button:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-alert__button:active {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-alert__button--primary {
      font-weight: var(--ux-font-weight-semibold);
    }

    .ux-alert__button--destructive {
      color: var(--ux-danger);
    }

    .ux-alert__button--destructive:hover {
      background-color: rgba(var(--ux-danger-rgb), 0.05);
    }

    .ux-alert__button--destructive:active {
      background-color: rgba(var(--ux-danger-rgb), 0.1);
    }

    .ux-alert__button--cancel {
      font-weight: var(--ux-font-weight-semibold);
    }

    /* ========================================
       Alert Variants
    ======================================== */

    /* Wide Alert (Android style) */
    .ux-alert--wide {
      max-width: 320px;
    }

    .ux-alert--wide .ux-alert__content {
      text-align: left;
    }

    .ux-alert--wide .ux-alert__buttons {
      justify-content: flex-end;
      border-top: none;
      padding: var(--ux-space-sm) var(--ux-space-lg);
    }

    .ux-alert--wide .ux-alert__button {
      flex: 0 0 auto;
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      border-radius: var(--ux-border-radius);
    }

    .ux-alert--wide .ux-alert__button:not(:last-child) {
      border-right: none;
    }

    /* ========================================
       Inline Alert (Banner)
    ======================================== */

    .ux-alert-banner {
      display: flex;
      align-items: flex-start;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface);
      border-radius: var(--ux-border-radius-lg);
      border: 1px solid var(--ux-border-color);
    }

    .ux-alert-banner--success {
      background-color: rgba(var(--ux-success-rgb), 0.1);
      border-color: var(--ux-success);
    }

    .ux-alert-banner--warning {
      background-color: rgba(var(--ux-warning-rgb), 0.1);
      border-color: var(--ux-warning);
    }

    .ux-alert-banner--danger {
      background-color: rgba(var(--ux-danger-rgb), 0.1);
      border-color: var(--ux-danger);
    }

    .ux-alert-banner--info {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
      border-color: var(--ux-primary);
    }

    .ux-alert-banner__icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .ux-alert-banner--success .ux-alert-banner__icon {
      color: var(--ux-success);
    }

    .ux-alert-banner--warning .ux-alert-banner__icon {
      color: var(--ux-warning);
    }

    .ux-alert-banner--danger .ux-alert-banner__icon {
      color: var(--ux-danger);
    }

    .ux-alert-banner--info .ux-alert-banner__icon {
      color: var(--ux-primary);
    }

    .ux-alert-banner__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-alert-banner__content {
      flex: 1;
      min-width: 0;
    }

    .ux-alert-banner__title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
    }

    .ux-alert-banner__message {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
      line-height: 1.4;
    }

    .ux-alert-banner__close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      padding: 0;
      background: none;
      border: none;
      color: var(--ux-text-tertiary);
      cursor: pointer;
      flex-shrink: 0;
    }

    .ux-alert-banner__close:hover {
      color: var(--ux-text);
    }

    .ux-alert-banner__close svg {
      width: 16px;
      height: 16px;
    }

    .ux-alert-banner__actions {
      display: flex;
      gap: var(--ux-space-sm);
      margin-top: var(--ux-space-md);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-alert--glass .ux-alert__content {
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-alert--glass .ux-alert__footer {
      border-top-color: var(--ux-glass-border);
    }

    .ux-alert-banner--glass {
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-alert-backdrop {
        transition: opacity 0.1s ease, visibility 0.1s ease;
      }

      .ux-alert {
        transition: opacity 0.1s ease;
        transform: none;
      }

      .ux-alert-backdrop--open .ux-alert {
        transform: none;
      }

      .ux-alert__button {
        transition: none;
      }

      .ux-alert__input {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-alert-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-alert-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for alert dialog
  // ARIA: role="alertdialog", aria-modal="true", aria-labelledby, aria-describedby
  const alertComponent = (config = {}) => ({
    isOpen: false,
    title: config.title || '',
    message: config.message || '',
    buttons: config.buttons || [],
    inputs: config.inputs || [],
    inputValues: {},
    alertId: config.id || 'ux-alert-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for alert dialog
    get ariaAttrs() {
      return {
        'role': 'alertdialog',
        'aria-modal': 'true',
        'aria-labelledby': this.alertId + '-title',
        'aria-describedby': this.alertId + '-message'
      };
    },

    get titleId() {
      return this.alertId + '-title';
    },

    get messageId() {
      return this.alertId + '-message';
    },

    open(options = {}) {
      if (options.title) this.title = options.title;
      if (options.message) this.message = options.message;
      if (options.buttons) this.buttons = options.buttons;
      if (options.inputs) {
        this.inputs = options.inputs;
        this.inputValues = {};
        options.inputs.forEach((input, i) => {
          this.inputValues[input.name || `input${i}`] = input.value || '';
        });
      }

      this.isOpen = true;
      document.body.style.overflow = 'hidden';
    },

    close() {
      this.isOpen = false;
      document.body.style.overflow = '';
    },

    confirm(title, message, options = {}) {
      const cancelText = options.cancelText || 'Cancel';
      const okText = options.okText || 'OK';
      return new Promise((resolve) => {
        this.open({
          title,
          message,
          buttons: [
            { text: cancelText, role: 'cancel', handler: () => resolve(false) },
            { text: okText, role: 'confirm', handler: () => resolve(true) }
          ]
        });
      });
    },

    prompt(title, message, options = {}) {
      const cancelText = options.cancelText || 'Cancel';
      const okText = options.okText || 'OK';
      const placeholder = options.placeholder || '';
      return new Promise((resolve) => {
        this.open({
          title,
          message,
          inputs: [{ name: 'value', placeholder }],
          buttons: [
            { text: cancelText, role: 'cancel', handler: () => resolve(null) },
            { text: okText, role: 'confirm', handler: () => resolve(this.inputValues.value) }
          ]
        });
      });
    },

    handleButtonClick(button) {
      if (button.handler && typeof button.handler === 'function') {
        button.handler(this.inputValues);
      }
      this.close();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxAlert', alertComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxAlert', alertComponent);
    });
  }

  // Alpine component for inline alert banner
  // ARIA: role="alert" for important messages
  const alertBannerComponent = (config = {}) => ({
    visible: config.visible !== false,
    dismissible: config.dismissible !== false,

    // ARIA role for inline alerts
    get ariaAttrs() {
      return {
        'role': 'alert',
        'aria-live': 'polite'
      };
    },

    dismiss() {
      this.visible = false;
    },

    show() {
      this.visible = true;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxAlertBanner', alertBannerComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxAlertBanner', alertBannerComponent);
    });
  }
})();

/**
 * UX Alpine Utils
 * Utility directives and magic helpers for Alpine.js
 * @requires Alpine.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       Clipboard Feedback
    ======================================== */

    .ux-clipboard-feedback {
      position: fixed;
      bottom: calc(var(--ux-safe-bottom, 0px) + var(--ux-space-lg));
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      padding: var(--ux-space-sm) var(--ux-space-lg);
      background: var(--ux-gray-900);
      color: white;
      border-radius: var(--ux-radius-full, 9999px);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      opacity: 0;
      transition: transform var(--ux-transition-normal) var(--ux-ease-out),
                  opacity var(--ux-transition-normal) var(--ux-ease-out);
      z-index: var(--ux-z-toast, 800);
      pointer-events: none;
    }

    .ux-clipboard-feedback--visible {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
      .ux-clipboard-feedback {
        background: var(--ux-gray-100);
        color: var(--ux-gray-900);
      }
    }
    .ux-dark .ux-clipboard-feedback {
      background: var(--ux-gray-100);
      color: var(--ux-gray-900);
    }

    /* ========================================
       Focus Trap Visual Indicator (dev only)
    ======================================== */

    [data-focus-trapped] {
      outline: none;
    }

    /* ========================================
       Scroll Lock Body State
    ======================================== */

    body.ux-scroll-locked {
      overflow: hidden !important;
      touch-action: none;
    }

    /* iOS fix for scroll lock */
    body.ux-scroll-locked--ios {
      position: fixed;
      width: 100%;
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-alpine-utils-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-alpine-utils-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // ========================================
  // Utility Functions
  // ========================================

  // Detect iOS for scroll lock workarounds
  const isIOS = () => {
    return /iPad|iPhone|iPod/.test(navigator.userAgent) ||
           (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
  };

  // Get focusable elements within a container
  const getFocusableElements = (container) => {
    const selector = [
      'a[href]',
      'button:not([disabled])',
      'input:not([disabled]):not([type="hidden"])',
      'select:not([disabled])',
      'textarea:not([disabled])',
      '[tabindex]:not([tabindex="-1"]):not([disabled])',
      '[contenteditable="true"]'
    ].join(', ');

    return Array.from(container.querySelectorAll(selector))
      .filter(el => {
        // Only include visible elements
        if (el.offsetParent === null && el.tagName !== 'BODY') return false;
        // Check computed styles
        const style = window.getComputedStyle(el);
        return style.visibility !== 'hidden' && style.display !== 'none';
      });
  };

  // ========================================
  // Scroll Lock State Manager
  // ========================================

  const scrollLockState = {
    count: 0,
    scrollPosition: 0,

    lock() {
      this.count++;
      if (this.count === 1) {
        this.scrollPosition = window.scrollY;

        if (isIOS()) {
          document.body.classList.add('ux-scroll-locked', 'ux-scroll-locked--ios');
          document.body.style.top = `-${this.scrollPosition}px`;
        } else {
          document.body.classList.add('ux-scroll-locked');
          document.body.style.paddingRight = `${window.innerWidth - document.documentElement.clientWidth}px`;
        }
      }
    },

    unlock() {
      this.count = Math.max(0, this.count - 1);
      if (this.count === 0) {
        document.body.classList.remove('ux-scroll-locked', 'ux-scroll-locked--ios');
        document.body.style.top = '';
        document.body.style.paddingRight = '';

        if (isIOS()) {
          window.scrollTo(0, this.scrollPosition);
        }
      }
    }
  };

  // ========================================
  // Clipboard Feedback Element
  // ========================================

  let clipboardFeedback = null;
  let feedbackTimeout = null;

  const showClipboardFeedback = (message = 'Copied!') => {
    if (!clipboardFeedback) {
      clipboardFeedback = document.createElement('div');
      clipboardFeedback.className = 'ux-clipboard-feedback';
      document.body.appendChild(clipboardFeedback);
    }

    clipboardFeedback.textContent = message;

    // Clear existing timeout
    if (feedbackTimeout) {
      clearTimeout(feedbackTimeout);
    }

    // Show feedback
    requestAnimationFrame(() => {
      clipboardFeedback.classList.add('ux-clipboard-feedback--visible');
    });

    // Hide after delay
    feedbackTimeout = setTimeout(() => {
      clipboardFeedback.classList.remove('ux-clipboard-feedback--visible');
    }, 2000);
  };

  // ========================================
  // Register Directives and Magics
  // ========================================

  const registerAll = () => {
    if (typeof Alpine === 'undefined') {
      document.addEventListener('alpine:init', registerAll);
      return;
    }

    // ========================================
    // x-focus-trap directive
    // Traps focus within element when active
    // Usage: x-focus-trap="isOpen" or x-focus-trap
    // ========================================
    Alpine.directive('focus-trap', (el, { expression }, { effect, evaluate, cleanup }) => {
      let cleanupFn = null;
      let previousActiveElement = null;

      const activate = () => {
        // Store currently focused element to restore later
        previousActiveElement = document.activeElement;

        el.setAttribute('data-focus-trapped', '');

        const focusable = getFocusableElements(el);

        // Focus first focusable element or container itself
        if (focusable.length > 0) {
          // Small delay to ensure element is visible
          requestAnimationFrame(() => {
            focusable[0].focus();
          });
        } else {
          el.setAttribute('tabindex', '-1');
          el.focus();
        }

        // Handle Tab key cycling
        const handleKeydown = (event) => {
          if (event.key !== 'Tab') return;

          const focusableNow = getFocusableElements(el);
          if (focusableNow.length === 0) return;

          const firstElement = focusableNow[0];
          const lastElement = focusableNow[focusableNow.length - 1];

          if (event.shiftKey) {
            // Shift+Tab: wrap from first to last
            if (document.activeElement === firstElement || !el.contains(document.activeElement)) {
              event.preventDefault();
              lastElement.focus();
            }
          } else {
            // Tab: wrap from last to first
            if (document.activeElement === lastElement || !el.contains(document.activeElement)) {
              event.preventDefault();
              firstElement.focus();
            }
          }
        };

        // Prevent focus from leaving the trap
        const handleFocusin = (event) => {
          if (!el.contains(event.target)) {
            event.stopPropagation();
            const focusableNow = getFocusableElements(el);
            if (focusableNow.length > 0) {
              focusableNow[0].focus();
            }
          }
        };

        el.addEventListener('keydown', handleKeydown);
        document.addEventListener('focusin', handleFocusin);

        return () => {
          el.removeEventListener('keydown', handleKeydown);
          document.removeEventListener('focusin', handleFocusin);
          el.removeAttribute('data-focus-trapped');
          el.removeAttribute('tabindex');

          // Return focus to previous element
          if (previousActiveElement && previousActiveElement.focus) {
            previousActiveElement.focus();
          }
        };
      };

      const deactivate = () => {
        if (cleanupFn) {
          cleanupFn();
          cleanupFn = null;
        }
      };

      // If expression provided, use it reactively
      if (expression) {
        effect(() => {
          const isActive = evaluate(expression);
          if (isActive) {
            cleanupFn = activate();
          } else {
            deactivate();
          }
        });
      } else {
        // No expression = always active
        cleanupFn = activate();
      }

      cleanup(() => {
        deactivate();
      });
    });

    // ========================================
    // x-click-outside directive
    // Detects clicks outside element
    // Usage: x-click-outside="close()"
    // Modifiers: .ignore="selector" to ignore certain elements
    // ========================================
    Alpine.directive('click-outside', (el, { expression, modifiers }, { evaluate, cleanup }) => {
      // Parse ignore selectors from modifiers
      const ignoreSelectors = [];
      modifiers.forEach((mod, index) => {
        if (mod === 'ignore' && modifiers[index + 1]) {
          ignoreSelectors.push(modifiers[index + 1]);
        }
      });

      const handleClick = (event) => {
        // Check if click is inside element
        if (el.contains(event.target)) return;

        // Check if click is on ignored elements
        for (const selector of ignoreSelectors) {
          const ignored = document.querySelector(selector);
          if (ignored && ignored.contains(event.target)) return;
        }

        // Execute expression
        evaluate(expression);
      };

      const handleTouch = (event) => {
        // Same logic for touch events
        if (el.contains(event.target)) return;

        for (const selector of ignoreSelectors) {
          const ignored = document.querySelector(selector);
          if (ignored && ignored.contains(event.target)) return;
        }

        evaluate(expression);
      };

      // Use capture phase to detect clicks early
      // Small delay to avoid triggering on the click that opened the element
      setTimeout(() => {
        document.addEventListener('click', handleClick, true);
        document.addEventListener('touchstart', handleTouch, true);
      }, 0);

      cleanup(() => {
        document.removeEventListener('click', handleClick, true);
        document.removeEventListener('touchstart', handleTouch, true);
      });
    });

    // ========================================
    // x-scroll-lock directive
    // Locks body scroll when element/condition is active
    // Usage: x-scroll-lock="isOpen" or x-scroll-lock
    // ========================================
    Alpine.directive('scroll-lock', (el, { expression }, { effect, evaluate, cleanup }) => {
      let isLocked = false;

      const lock = () => {
        if (!isLocked) {
          scrollLockState.lock();
          isLocked = true;
        }
      };

      const unlock = () => {
        if (isLocked) {
          scrollLockState.unlock();
          isLocked = false;
        }
      };

      // If expression provided, use it reactively
      if (expression) {
        effect(() => {
          const shouldLock = evaluate(expression);
          if (shouldLock) {
            lock();
          } else {
            unlock();
          }
        });
      } else {
        // No expression = lock when element exists
        lock();
      }

      cleanup(() => {
        unlock();
      });
    });

    // ========================================
    // x-clipboard directive
    // Copy text to clipboard
    // Usage: x-clipboard="textToCopy" or x-clipboard:target="#element-id"
    // Modifiers: .feedback to show visual feedback
    // ========================================
    Alpine.directive('clipboard', (el, { expression, modifiers, value }, { evaluate, cleanup }) => {
      const showFeedback = modifiers.includes('feedback') || modifiers.length === 0;
      const feedbackMessage = modifiers.find(m => m.startsWith('message:'))?.slice(8) || 'Copied!';

      const handleClick = async () => {
        let textToCopy = '';

        if (value === 'target') {
          // Copy from target element
          const targetSelector = evaluate(expression);
          const targetEl = document.querySelector(targetSelector);
          if (targetEl) {
            textToCopy = targetEl.textContent || targetEl.value || '';
          }
        } else if (expression) {
          // Evaluate expression for text
          textToCopy = evaluate(expression);
        } else {
          // Copy element's own text content
          textToCopy = el.textContent || el.value || '';
        }

        try {
          // Modern clipboard API
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(textToCopy);
          } else {
            // Fallback for older browsers
            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            textarea.style.position = 'fixed';
            textarea.style.left = '-9999px';
            textarea.style.top = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
          }

          // Show feedback
          if (showFeedback) {
            showClipboardFeedback(feedbackMessage);
          }

          // Dispatch success event
          el.dispatchEvent(new CustomEvent('clipboard:success', {
            detail: { text: textToCopy },
            bubbles: true
          }));

        } catch (err) {
          console.error('Failed to copy:', err);

          // Dispatch error event
          el.dispatchEvent(new CustomEvent('clipboard:error', {
            detail: { error: err },
            bubbles: true
          }));
        }
      };

      el.addEventListener('click', handleClick);

      cleanup(() => {
        el.removeEventListener('click', handleClick);
      });
    });

    // ========================================
    // $debounce magic helper
    // Usage: $debounce(fn, delay)
    // Returns debounced version of function
    // ========================================
    Alpine.magic('debounce', () => {
      return (fn, delay = 300) => {
        let timeoutId = null;

        const debounced = (...args) => {
          if (timeoutId) {
            clearTimeout(timeoutId);
          }
          timeoutId = setTimeout(() => {
            fn.apply(null, args);
            timeoutId = null;
          }, delay);
        };

        // Allow canceling pending execution
        debounced.cancel = () => {
          if (timeoutId) {
            clearTimeout(timeoutId);
            timeoutId = null;
          }
        };

        // Allow immediate execution and cancel pending
        debounced.flush = (...args) => {
          debounced.cancel();
          fn.apply(null, args);
        };

        return debounced;
      };
    });

    // ========================================
    // $throttle magic helper
    // Usage: $throttle(fn, limit)
    // Returns throttled version of function
    // ========================================
    Alpine.magic('throttle', () => {
      return (fn, limit = 300) => {
        let inThrottle = false;
        let lastArgs = null;

        const throttled = (...args) => {
          if (!inThrottle) {
            fn.apply(null, args);
            inThrottle = true;

            setTimeout(() => {
              inThrottle = false;
              // Execute with last args if called during throttle
              if (lastArgs) {
                throttled.apply(null, lastArgs);
                lastArgs = null;
              }
            }, limit);
          } else {
            // Store args to execute after throttle period
            lastArgs = args;
          }
        };

        // Allow canceling pending execution
        throttled.cancel = () => {
          lastArgs = null;
        };

        return throttled;
      };
    });

    // ========================================
    // $clipboard magic helper (alternative API)
    // Usage: $clipboard('text to copy')
    // Returns Promise
    // ========================================
    Alpine.magic('clipboard', () => {
      return async (text, options = {}) => {
        const { feedback = true, message = 'Copied!' } = options;

        try {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(text);
          } else {
            // Fallback
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
          }

          if (feedback) {
            showClipboardFeedback(message);
          }

          return true;
        } catch (err) {
          console.error('Clipboard error:', err);
          return false;
        }
      };
    });

    // ========================================
    // $scrollLock magic helper (alternative API)
    // Usage: $scrollLock.lock() / $scrollLock.unlock()
    // ========================================
    Alpine.magic('scrollLock', () => {
      return {
        lock: () => scrollLockState.lock(),
        unlock: () => scrollLockState.unlock(),
        get isLocked() {
          return scrollLockState.count > 0;
        }
      };
    });

    // ========================================
    // $focusTrap magic helper (alternative API)
    // Usage: $focusTrap(element) returns cleanup function
    // ========================================
    Alpine.magic('focusTrap', () => {
      return (container) => {
        const previousActiveElement = document.activeElement;
        container.setAttribute('data-focus-trapped', '');

        const focusable = getFocusableElements(container);

        if (focusable.length > 0) {
          requestAnimationFrame(() => {
            focusable[0].focus();
          });
        }

        const handleKeydown = (event) => {
          if (event.key !== 'Tab') return;

          const focusableNow = getFocusableElements(container);
          if (focusableNow.length === 0) return;

          const firstElement = focusableNow[0];
          const lastElement = focusableNow[focusableNow.length - 1];

          if (event.shiftKey) {
            if (document.activeElement === firstElement) {
              event.preventDefault();
              lastElement.focus();
            }
          } else {
            if (document.activeElement === lastElement) {
              event.preventDefault();
              firstElement.focus();
            }
          }
        };

        container.addEventListener('keydown', handleKeydown);

        // Return cleanup function
        return () => {
          container.removeEventListener('keydown', handleKeydown);
          container.removeAttribute('data-focus-trapped');

          if (previousActiveElement && previousActiveElement.focus) {
            previousActiveElement.focus();
          }
        };
      };
    });
  };

  // Initialize
  registerAll();

  // Register with UX namespace if available
  if (window.UX) {
    window.UX.alpineUtils = {
      scrollLockState,
      getFocusableElements,
      showClipboardFeedback,
      isIOS
    };
  }
})();

/**
 * UX Attendance List Component
 * Employee attendance tracking with status indicators, clock times, and summary stats
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       UX Attendance List - Employee Attendance Tracking
       iOS 26 Style - Liquid Glass Design
       ========================================================================== */

    :root {
      /* Attendance List Tokens */
      --ux-attendance-border-radius: var(--ux-border-radius-lg);
      --ux-attendance-item-padding: var(--ux-space-md) var(--ux-space-lg);
      --ux-attendance-item-gap: var(--ux-space-md);
      --ux-attendance-avatar-size: 44px;
      --ux-attendance-status-size: 10px;

      /* Status Colors */
      --ux-attendance-present: var(--ux-success);
      --ux-attendance-present-bg: rgba(var(--ux-success-rgb), 0.1);
      --ux-attendance-absent: var(--ux-danger);
      --ux-attendance-absent-bg: rgba(var(--ux-danger-rgb), 0.1);
      --ux-attendance-late: var(--ux-warning);
      --ux-attendance-late-bg: rgba(var(--ux-warning-rgb), 0.1);
      --ux-attendance-leave: var(--ux-info, var(--ux-primary));
      --ux-attendance-leave-bg: rgba(var(--ux-info-rgb, var(--ux-primary-rgb)), 0.1);
      --ux-attendance-remote: var(--ux-secondary);
      --ux-attendance-remote-bg: rgba(var(--ux-secondary-rgb), 0.1);
    }

    /* ==========================================================================
       Attendance List Container
       ========================================================================== */

    .ux-attendance-list {
      display: flex;
      flex-direction: column;
      width: 100%;
      background: var(--ux-surface);
      border-radius: var(--ux-attendance-border-radius);
      border: 1px solid var(--ux-border-color);
      overflow: hidden;
    }

    .ux-attendance-list--inset {
      margin: var(--ux-space-lg);
    }

    /* ==========================================================================
       Attendance List Header
       ========================================================================== */

    .ux-attendance-list__header {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md);
      padding: var(--ux-space-lg);
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-attendance-list__header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      flex-wrap: wrap;
    }

    .ux-attendance-list__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-attendance-list__date {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-attendance-list__date-input {
      padding: var(--ux-space-sm) var(--ux-space-md);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      background: var(--ux-surface);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      cursor: pointer;
      transition: border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-attendance-list__date-input:focus {
      outline: none;
      border-color: var(--ux-primary);
    }

    /* ==========================================================================
       Attendance Summary Stats
       ========================================================================== */

    .ux-attendance-list__summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-attendance-list__stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: var(--ux-space-sm);
      background: var(--ux-surface);
      border-radius: var(--ux-border-radius);
      text-align: center;
    }

    .ux-attendance-list__stat-value {
      font-size: var(--ux-font-size-xl);
      font-weight: 700;
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
    }

    .ux-attendance-list__stat-label {
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Stat colors */
    .ux-attendance-list__stat--present .ux-attendance-list__stat-value { color: var(--ux-attendance-present); }
    .ux-attendance-list__stat--absent .ux-attendance-list__stat-value { color: var(--ux-attendance-absent); }
    .ux-attendance-list__stat--late .ux-attendance-list__stat-value { color: var(--ux-attendance-late); }
    .ux-attendance-list__stat--leave .ux-attendance-list__stat-value { color: var(--ux-attendance-leave); }
    .ux-attendance-list__stat--remote .ux-attendance-list__stat-value { color: var(--ux-attendance-remote); }

    /* ==========================================================================
       Attendance Toolbar (Search & Filter)
       ========================================================================== */

    .ux-attendance-list__toolbar {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-sm) var(--ux-space-lg);
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      flex-wrap: wrap;
    }

    .ux-attendance-list__search {
      flex: 1;
      min-width: 200px;
      position: relative;
    }

    .ux-attendance-list__search-input {
      width: 100%;
      padding: var(--ux-space-sm) var(--ux-space-md);
      padding-left: 36px;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      background: var(--ux-surface-secondary);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      transition: border-color var(--ux-transition-fast) var(--ux-ease),
                  background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-attendance-list__search-input:focus {
      outline: none;
      border-color: var(--ux-primary);
      background: var(--ux-surface);
    }

    .ux-attendance-list__search-input::placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-attendance-list__search-icon {
      position: absolute;
      left: var(--ux-space-sm);
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      color: var(--ux-text-tertiary);
      pointer-events: none;
    }

    .ux-attendance-list__filter {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-attendance-list__filter-btn {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-pill);
      background: var(--ux-surface);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-attendance-list__filter-btn:hover {
      background: var(--ux-surface-secondary);
      border-color: var(--ux-text-tertiary);
    }

    .ux-attendance-list__filter-btn--active {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-attendance-list__filter-btn--active:hover {
      background: var(--ux-primary-shade);
      border-color: var(--ux-primary-shade);
    }

    /* Status-specific filter buttons */
    .ux-attendance-list__filter-btn--present.ux-attendance-list__filter-btn--active {
      background: var(--ux-attendance-present);
      border-color: var(--ux-attendance-present);
    }
    .ux-attendance-list__filter-btn--absent.ux-attendance-list__filter-btn--active {
      background: var(--ux-attendance-absent);
      border-color: var(--ux-attendance-absent);
    }
    .ux-attendance-list__filter-btn--late.ux-attendance-list__filter-btn--active {
      background: var(--ux-attendance-late);
      border-color: var(--ux-attendance-late);
    }
    .ux-attendance-list__filter-btn--leave.ux-attendance-list__filter-btn--active {
      background: var(--ux-attendance-leave);
      border-color: var(--ux-attendance-leave);
    }
    .ux-attendance-list__filter-btn--remote.ux-attendance-list__filter-btn--active {
      background: var(--ux-attendance-remote);
      border-color: var(--ux-attendance-remote);
    }

    /* ==========================================================================
       Attendance List Body
       ========================================================================== */

    .ux-attendance-list__body {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .ux-attendance-list__body--fixed-height {
      max-height: 400px;
    }

    /* ==========================================================================
       Attendance Item
       ========================================================================== */

    .ux-attendance-list__item {
      display: flex;
      align-items: center;
      gap: var(--ux-attendance-item-gap);
      padding: var(--ux-attendance-item-padding);
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-attendance-list__item:last-child {
      border-bottom: none;
    }

    .ux-attendance-list__item:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-attendance-list__item--clickable {
      cursor: pointer;
    }

    .ux-attendance-list__item--clickable:active {
      background: var(--ux-surface-tertiary);
    }

    /* ==========================================================================
       Employee Avatar & Info
       ========================================================================== */

    .ux-attendance-list__avatar {
      position: relative;
      width: var(--ux-attendance-avatar-size);
      height: var(--ux-attendance-avatar-size);
      flex-shrink: 0;
    }

    .ux-attendance-list__avatar-img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      background: var(--ux-surface-secondary);
    }

    .ux-attendance-list__avatar-initials {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
      font-size: calc(var(--ux-attendance-avatar-size) * 0.38);
      font-weight: 600;
    }

    .ux-attendance-list__info {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ux-attendance-list__name {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-attendance-list__department {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ==========================================================================
       Attendance Status Badge
       ========================================================================== */

    .ux-attendance-list__status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: var(--ux-border-radius-pill);
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      flex-shrink: 0;
    }

    .ux-attendance-list__status-dot {
      width: var(--ux-attendance-status-size);
      height: var(--ux-attendance-status-size);
      border-radius: 50%;
      flex-shrink: 0;
    }

    /* Present */
    .ux-attendance-list__status--present {
      background: var(--ux-attendance-present-bg);
      color: var(--ux-attendance-present);
    }
    .ux-attendance-list__status--present .ux-attendance-list__status-dot {
      background: var(--ux-attendance-present);
    }

    /* Absent */
    .ux-attendance-list__status--absent {
      background: var(--ux-attendance-absent-bg);
      color: var(--ux-attendance-absent);
    }
    .ux-attendance-list__status--absent .ux-attendance-list__status-dot {
      background: var(--ux-attendance-absent);
    }

    /* Late */
    .ux-attendance-list__status--late {
      background: var(--ux-attendance-late-bg);
      color: var(--ux-attendance-late);
    }
    .ux-attendance-list__status--late .ux-attendance-list__status-dot {
      background: var(--ux-attendance-late);
    }

    /* On Leave */
    .ux-attendance-list__status--leave {
      background: var(--ux-attendance-leave-bg);
      color: var(--ux-attendance-leave);
    }
    .ux-attendance-list__status--leave .ux-attendance-list__status-dot {
      background: var(--ux-attendance-leave);
    }

    /* Remote */
    .ux-attendance-list__status--remote {
      background: var(--ux-attendance-remote-bg);
      color: var(--ux-attendance-remote);
    }
    .ux-attendance-list__status--remote .ux-attendance-list__status-dot {
      background: var(--ux-attendance-remote);
    }

    /* ==========================================================================
       Clock Times & Work Hours
       ========================================================================== */

    .ux-attendance-list__times {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
      flex-shrink: 0;
    }

    .ux-attendance-list__clock {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
    }

    .ux-attendance-list__clock-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      min-width: 32px;
    }

    .ux-attendance-list__clock-time {
      font-weight: 500;
      min-width: 50px;
      text-align: right;
    }

    .ux-attendance-list__clock-time--late {
      color: var(--ux-attendance-late);
    }

    .ux-attendance-list__work-hours {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      font-variant-numeric: tabular-nums;
    }

    .ux-attendance-list__work-hours--over {
      color: var(--ux-success);
    }

    .ux-attendance-list__work-hours--under {
      color: var(--ux-warning);
    }

    /* ==========================================================================
       Compact Time Display (Alternative Layout)
       ========================================================================== */

    .ux-attendance-list__times--compact {
      flex-direction: row;
      gap: var(--ux-space-md);
      align-items: center;
    }

    .ux-attendance-list__times--compact .ux-attendance-list__clock {
      flex-direction: column;
      gap: 0;
      align-items: center;
    }

    .ux-attendance-list__times--compact .ux-attendance-list__clock-label {
      order: 1;
    }

    /* ==========================================================================
       Empty State
       ========================================================================== */

    .ux-attendance-list__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-2xl) var(--ux-space-lg);
      text-align: center;
    }

    .ux-attendance-list__empty-icon {
      width: 64px;
      height: 64px;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-text-tertiary);
    }

    .ux-attendance-list__empty-title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
    }

    .ux-attendance-list__empty-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    /* ==========================================================================
       Footer / Pagination
       ========================================================================== */

    .ux-attendance-list__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md) var(--ux-space-lg);
      background: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-attendance-list--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-attendance-list--glass .ux-attendance-list__header,
    .ux-attendance-list--glass .ux-attendance-list__toolbar,
    .ux-attendance-list--glass .ux-attendance-list__item {
      background: transparent;
    }

    .ux-attendance-list--glass .ux-attendance-list__summary {
      background: var(--ux-glass-bg-thin);
    }

    .ux-attendance-list--glass .ux-attendance-list__stat {
      background: var(--ux-glass-bg);
    }

    .ux-attendance-list--glass .ux-attendance-list__item:hover {
      background: var(--ux-glass-bg-thin);
    }

    .ux-attendance-list--glass .ux-attendance-list__footer {
      background: var(--ux-glass-bg-thin);
    }

    /* ==========================================================================
       Size Variants
       ========================================================================== */

    /* Compact size */
    .ux-attendance-list--compact .ux-attendance-list__item {
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    .ux-attendance-list--compact .ux-attendance-list__avatar {
      --ux-attendance-avatar-size: 36px;
    }

    .ux-attendance-list--compact .ux-attendance-list__name {
      font-size: var(--ux-font-size-sm);
    }

    .ux-attendance-list--compact .ux-attendance-list__department {
      font-size: var(--ux-font-size-xs);
    }

    /* ==========================================================================
       Responsive
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-attendance-list__header-row {
        flex-direction: column;
        align-items: stretch;
      }

      .ux-attendance-list__summary {
        grid-template-columns: repeat(3, 1fr);
      }

      .ux-attendance-list__toolbar {
        flex-direction: column;
        align-items: stretch;
      }

      .ux-attendance-list__search {
        min-width: 100%;
      }

      .ux-attendance-list__filter {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
        margin: 0 calc(var(--ux-space-lg) * -1);
        padding: 0 var(--ux-space-lg);
      }

      .ux-attendance-list__filter::-webkit-scrollbar {
        display: none;
      }

      .ux-attendance-list__item {
        flex-wrap: wrap;
      }

      .ux-attendance-list__times {
        width: 100%;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        margin-top: var(--ux-space-sm);
        padding-top: var(--ux-space-sm);
        border-top: 1px dashed var(--ux-border-color);
      }

      .ux-attendance-list__footer {
        flex-direction: column;
        gap: var(--ux-space-sm);
        text-align: center;
      }
    }

    @media (max-width: 480px) {
      .ux-attendance-list__summary {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light) {
        --ux-attendance-present-bg: rgba(var(--ux-success-rgb), 0.15);
        --ux-attendance-absent-bg: rgba(var(--ux-danger-rgb), 0.15);
        --ux-attendance-late-bg: rgba(var(--ux-warning-rgb), 0.15);
        --ux-attendance-leave-bg: rgba(var(--ux-info-rgb, var(--ux-primary-rgb)), 0.15);
        --ux-attendance-remote-bg: rgba(var(--ux-secondary-rgb), 0.15);
      }
    }

    .ux-dark {
      --ux-attendance-present-bg: rgba(var(--ux-success-rgb), 0.15);
      --ux-attendance-absent-bg: rgba(var(--ux-danger-rgb), 0.15);
      --ux-attendance-late-bg: rgba(var(--ux-warning-rgb), 0.15);
      --ux-attendance-leave-bg: rgba(var(--ux-info-rgb, var(--ux-primary-rgb)), 0.15);
      --ux-attendance-remote-bg: rgba(var(--ux-secondary-rgb), 0.15);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-attendance-list__item,
      .ux-attendance-list__filter-btn,
      .ux-attendance-list__search-input,
      .ux-attendance-list__date-input {
        transition: none;
      }
    }

    /* ==========================================================================
       Print Styles
       ========================================================================== */

    @media print {
      .ux-attendance-list {
        border: 1px solid #ccc;
        box-shadow: none;
      }

      .ux-attendance-list__toolbar {
        display: none;
      }

      .ux-attendance-list__item {
        break-inside: avoid;
      }

      .ux-attendance-list--glass {
        background: white;
        backdrop-filter: none;
      }
    }
  `;

  // Icons
  const icons = {
    search: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>',
    calendar: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>',
    clock: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>',
    users: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>',
    empty: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/><path d="M22 22L2 2" stroke-width="2"/></svg>'
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-attendance-list-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-attendance-list-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Status labels for i18n
  const defaultLabels = {
    present: 'Present',
    absent: 'Absent',
    late: 'Late',
    leave: 'On Leave',
    remote: 'Remote',
    all: 'All',
    clockIn: 'In',
    clockOut: 'Out',
    workHours: 'Hours',
    search: 'Search employees...',
    noResults: 'No employees found',
    noResultsText: 'Try adjusting your search or filter criteria.',
    total: 'Total',
    showing: 'Showing',
    of: 'of',
    employees: 'employees'
  };

  // Alpine.js component
  const attendanceListComponent = (config = {}) => ({
    // Data
    employees: config.employees || [],
    selectedDate: config.selectedDate || new Date().toISOString().split('T')[0],

    // Filters
    filterStatus: config.filterStatus || 'all',
    searchQuery: '',

    // Config
    showSummary: config.showSummary !== false,
    showSearch: config.showSearch !== false,
    showFilter: config.showFilter !== false,
    showDateSelector: config.showDateSelector !== false,
    clickable: config.clickable || false,
    compactTimes: config.compactTimes || false,

    // Work day config (for calculations)
    workDayStart: config.workDayStart || '09:00',
    workDayEnd: config.workDayEnd || '18:00',
    standardHours: config.standardHours || 8,

    // Labels (for i18n)
    labels: { ...defaultLabels, ...config.labels },

    // Initialize
    init() {
      // Watch for date changes
      this.$watch('selectedDate', () => {
        this.$dispatch('date-change', { date: this.selectedDate });
      });
    },

    // Computed: Filtered employees
    get filteredEmployees() {
      let result = this.employees;

      // Filter by status
      if (this.filterStatus !== 'all') {
        result = result.filter(emp => emp.status === this.filterStatus);
      }

      // Filter by search query
      if (this.searchQuery.trim()) {
        const query = this.searchQuery.toLowerCase().trim();
        result = result.filter(emp => {
          const name = (emp.name || '').toLowerCase();
          const department = (emp.department || '').toLowerCase();
          const id = (emp.id || emp.employeeId || '').toString().toLowerCase();
          return name.includes(query) || department.includes(query) || id.includes(query);
        });
      }

      return result;
    },

    // Computed: Summary statistics
    get summaryStats() {
      const stats = {
        total: this.employees.length,
        present: 0,
        absent: 0,
        late: 0,
        leave: 0,
        remote: 0
      };

      this.employees.forEach(emp => {
        if (stats.hasOwnProperty(emp.status)) {
          stats[emp.status]++;
        }
      });

      return stats;
    },

    // Get employee initials
    getInitials(name) {
      if (!name) return '??';
      const parts = name.trim().split(/\s+/);
      if (parts.length >= 2) {
        return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
      }
      return name.substring(0, 2).toUpperCase();
    },

    // Calculate work hours from clock in/out
    calculateWorkHours(employee) {
      if (!employee.clockIn || !employee.clockOut) return null;

      const [inHours, inMins] = employee.clockIn.split(':').map(Number);
      const [outHours, outMins] = employee.clockOut.split(':').map(Number);

      const inMinutes = inHours * 60 + inMins;
      const outMinutes = outHours * 60 + outMins;

      const totalMinutes = outMinutes - inMinutes;
      const hours = Math.floor(totalMinutes / 60);
      const mins = totalMinutes % 60;

      return {
        hours,
        minutes: mins,
        total: totalMinutes / 60,
        formatted: `${hours}h ${mins}m`
      };
    },

    // Check if clock-in is late
    isLateClockIn(clockIn) {
      if (!clockIn || !this.workDayStart) return false;

      const [inHours, inMins] = clockIn.split(':').map(Number);
      const [startHours, startMins] = this.workDayStart.split(':').map(Number);

      const inMinutes = inHours * 60 + inMins;
      const startMinutes = startHours * 60 + startMins;

      return inMinutes > startMinutes;
    },

    // Format time display
    formatTime(time) {
      if (!time) return '--:--';
      return time;
    },

    // Get work hours class
    getWorkHoursClass(employee) {
      const workHours = this.calculateWorkHours(employee);
      if (!workHours) return '';

      if (workHours.total >= this.standardHours) {
        return 'ux-attendance-list__work-hours--over';
      } else if (workHours.total < this.standardHours - 1) {
        return 'ux-attendance-list__work-hours--under';
      }
      return '';
    },

    // Set filter status
    setFilter(status) {
      this.filterStatus = status;
      this.$dispatch('filter-change', { status });
    },

    // Handle search
    onSearch() {
      this.$dispatch('search', { query: this.searchQuery });
    },

    // Handle employee click
    onEmployeeClick(employee) {
      if (this.clickable) {
        this.$dispatch('employee-click', { employee });
      }
    },

    // Handle date change
    onDateChange() {
      this.$dispatch('date-change', { date: this.selectedDate });
    },

    // Get status label
    getStatusLabel(status) {
      return this.labels[status] || status;
    },

    // Get icon
    getIcon(name) {
      return icons[name] || '';
    },

    // Set employees data (for external updates)
    setEmployees(data) {
      this.employees = data;
    },

    // Update employee status
    updateEmployeeStatus(employeeId, status, clockIn, clockOut) {
      const employee = this.employees.find(emp => emp.id === employeeId || emp.employeeId === employeeId);
      if (employee) {
        employee.status = status;
        if (clockIn !== undefined) employee.clockIn = clockIn;
        if (clockOut !== undefined) employee.clockOut = clockOut;
        this.$dispatch('employee-update', { employee });
      }
    },

    // Refresh data (trigger load event)
    refresh() {
      this.$dispatch('refresh', { date: this.selectedDate });
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxAttendanceList', attendanceListComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxAttendanceList', attendanceListComponent);
    });
  }

  // Export icons for external use
  window.UXAttendanceIcons = icons;
})();

/**
 * UX Audio Player Component
 * Reproductor de audio con controles completos, visualizacion y playlist
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Audio Player Container
    ======================================== */

    :root {
      --ux-audio-player-height: auto;
      --ux-audio-player-padding: var(--ux-space-md);
      --ux-audio-player-border-radius: var(--ux-radius-lg, 12px);
      --ux-audio-player-bg: var(--ux-surface);
      --ux-audio-player-progress-height: 4px;
      --ux-audio-player-progress-bg: var(--ux-medium);
      --ux-audio-player-progress-fill: var(--ux-primary);
      --ux-audio-player-waveform-height: 48px;
      --ux-audio-player-thumb-size: 14px;
    }

    .ux-audio-player {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
      padding: var(--ux-audio-player-padding);
      background: var(--ux-audio-player-bg);
      border-radius: var(--ux-audio-player-border-radius);
      border: 1px solid var(--ux-border-color);
      box-shadow: var(--ux-shadow-sm);
    }

    /* ========================================
       Track Info Section
    ======================================== */

    .ux-audio-player__info {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      margin-bottom: var(--ux-space-md);
    }

    .ux-audio-player__artwork {
      flex-shrink: 0;
      width: 64px;
      height: 64px;
      border-radius: var(--ux-radius-md, 8px);
      background: var(--ux-surface-secondary);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ux-audio-player__artwork img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .ux-audio-player__artwork svg {
      width: 32px;
      height: 32px;
      color: var(--ux-text-tertiary);
    }

    .ux-audio-player__meta {
      flex: 1;
      min-width: 0;
    }

    .ux-audio-player__title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin: 0 0 var(--ux-space-xs) 0;
    }

    .ux-audio-player__artist {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin: 0;
    }

    /* ========================================
       Waveform Visualization
    ======================================== */

    .ux-audio-player__waveform {
      position: relative;
      width: 100%;
      height: var(--ux-audio-player-waveform-height);
      margin-bottom: var(--ux-space-md);
      cursor: pointer;
      border-radius: var(--ux-radius-sm, 4px);
      overflow: hidden;
    }

    .ux-audio-player__waveform canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .ux-audio-player__waveform-overlay {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: var(--ux-primary);
      opacity: 0.3;
      pointer-events: none;
      transition: width 0.05s linear;
    }

    /* ========================================
       Progress Bar
    ======================================== */

    .ux-audio-player__progress {
      position: relative;
      width: 100%;
      height: var(--ux-audio-player-progress-height);
      margin-bottom: var(--ux-space-sm);
      cursor: pointer;
    }

    .ux-audio-player__progress-track {
      position: absolute;
      width: 100%;
      height: 100%;
      background: var(--ux-audio-player-progress-bg);
      border-radius: calc(var(--ux-audio-player-progress-height) / 2);
      overflow: hidden;
    }

    .ux-audio-player__progress-fill {
      position: absolute;
      height: 100%;
      background: var(--ux-audio-player-progress-fill);
      border-radius: calc(var(--ux-audio-player-progress-height) / 2);
      transition: width 0.05s linear;
    }

    .ux-audio-player__progress-buffer {
      position: absolute;
      height: 100%;
      background: var(--ux-audio-player-progress-bg);
      opacity: 0.5;
      border-radius: calc(var(--ux-audio-player-progress-height) / 2);
    }

    .ux-audio-player__progress-thumb {
      position: absolute;
      top: 50%;
      width: var(--ux-audio-player-thumb-size);
      height: var(--ux-audio-player-thumb-size);
      background: white;
      border-radius: 50%;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      transform: translate(-50%, -50%);
      opacity: 0;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
      z-index: 1;
    }

    .ux-audio-player__progress:hover .ux-audio-player__progress-thumb,
    .ux-audio-player__progress:active .ux-audio-player__progress-thumb {
      opacity: 1;
    }

    .ux-audio-player__progress:active .ux-audio-player__progress-thumb {
      transform: translate(-50%, -50%) scale(1.2);
    }

    /* ========================================
       Time Display
    ======================================== */

    .ux-audio-player__time {
      display: flex;
      justify-content: space-between;
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      font-variant-numeric: tabular-nums;
      margin-bottom: var(--ux-space-md);
    }

    .ux-audio-player__time-current,
    .ux-audio-player__time-duration {
      min-width: 40px;
    }

    .ux-audio-player__time-current {
      text-align: left;
    }

    .ux-audio-player__time-duration {
      text-align: right;
    }

    /* ========================================
       Controls
    ======================================== */

    .ux-audio-player__controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
    }

    .ux-audio-player__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      padding: 0;
      border: none;
      background: transparent;
      color: var(--ux-text);
      border-radius: 50%;
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-audio-player__btn:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-audio-player__btn:active {
      transform: scale(0.95);
    }

    .ux-audio-player__btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
    }

    .ux-audio-player__btn svg {
      width: 24px;
      height: 24px;
    }

    .ux-audio-player__btn--sm {
      width: 36px;
      height: 36px;
    }

    .ux-audio-player__btn--sm svg {
      width: 20px;
      height: 20px;
    }

    .ux-audio-player__btn--play {
      width: 56px;
      height: 56px;
      background: var(--ux-primary);
      color: var(--ux-primary-contrast, white);
    }

    .ux-audio-player__btn--play:hover {
      background: var(--ux-primary-shade);
    }

    .ux-audio-player__btn--play svg {
      width: 28px;
      height: 28px;
    }

    /* ========================================
       Secondary Controls (Volume, Speed)
    ======================================== */

    .ux-audio-player__secondary {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: var(--ux-space-md);
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-audio-player__volume {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      flex: 1;
      max-width: 150px;
    }

    .ux-audio-player__volume-slider {
      flex: 1;
      height: 4px;
      background: var(--ux-medium);
      border-radius: 2px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .ux-audio-player__volume-fill {
      position: absolute;
      height: 100%;
      background: var(--ux-text-secondary);
      border-radius: 2px;
      transition: width 0.05s linear;
    }

    .ux-audio-player__volume-input {
      position: absolute;
      width: 100%;
      height: 100%;
      margin: 0;
      opacity: 0;
      cursor: pointer;
      -webkit-appearance: none;
    }

    .ux-audio-player__speed {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-audio-player__speed-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 48px;
      height: 32px;
      padding: 0 var(--ux-space-sm);
      border: 1px solid var(--ux-border-color);
      background: var(--ux-surface);
      color: var(--ux-text-secondary);
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      border-radius: var(--ux-radius-sm, 4px);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-audio-player__speed-btn:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-audio-player__speed-btn--active {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
      color: var(--ux-primary-contrast, white);
    }

    /* ========================================
       Playlist
    ======================================== */

    .ux-audio-player__playlist {
      margin-top: var(--ux-space-md);
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
      max-height: 200px;
      overflow-y: auto;
    }

    .ux-audio-player__playlist-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-audio-player__playlist-title {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-audio-player__playlist-count {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-audio-player__playlist-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm);
      border-radius: var(--ux-radius-sm, 4px);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-audio-player__playlist-item:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-audio-player__playlist-item--active {
      background: var(--ux-primary);
      color: var(--ux-primary-contrast, white);
    }

    .ux-audio-player__playlist-item--active:hover {
      background: var(--ux-primary-shade);
    }

    .ux-audio-player__playlist-item-index {
      width: 24px;
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-align: center;
    }

    .ux-audio-player__playlist-item--active .ux-audio-player__playlist-item-index {
      color: inherit;
    }

    .ux-audio-player__playlist-item-info {
      flex: 1;
      min-width: 0;
    }

    .ux-audio-player__playlist-item-title {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-audio-player__playlist-item-duration {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-audio-player__playlist-item--active .ux-audio-player__playlist-item-duration {
      color: inherit;
      opacity: 0.8;
    }

    /* ========================================
       Mini Player Variant
    ======================================== */

    .ux-audio-player--mini {
      flex-direction: row;
      align-items: center;
      padding: var(--ux-space-sm) var(--ux-space-md);
      gap: var(--ux-space-md);
    }

    .ux-audio-player--mini .ux-audio-player__artwork {
      width: 48px;
      height: 48px;
    }

    .ux-audio-player--mini .ux-audio-player__info {
      margin-bottom: 0;
      flex: 1;
      min-width: 0;
    }

    .ux-audio-player--mini .ux-audio-player__meta {
      display: flex;
      flex-direction: column;
    }

    .ux-audio-player--mini .ux-audio-player__title {
      font-size: var(--ux-font-size-sm);
    }

    .ux-audio-player--mini .ux-audio-player__artist {
      font-size: var(--ux-font-size-xs);
    }

    .ux-audio-player--mini .ux-audio-player__progress,
    .ux-audio-player--mini .ux-audio-player__time,
    .ux-audio-player--mini .ux-audio-player__secondary,
    .ux-audio-player--mini .ux-audio-player__waveform,
    .ux-audio-player--mini .ux-audio-player__playlist {
      display: none;
    }

    .ux-audio-player--mini .ux-audio-player__controls {
      margin: 0;
      gap: var(--ux-space-xs);
    }

    .ux-audio-player--mini .ux-audio-player__btn--play {
      width: 44px;
      height: 44px;
    }

    .ux-audio-player--mini .ux-audio-player__btn--play svg {
      width: 22px;
      height: 22px;
    }

    /* Mini progress bar below */
    .ux-audio-player--mini .ux-audio-player__mini-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--ux-medium);
    }

    .ux-audio-player--mini .ux-audio-player__mini-progress-fill {
      height: 100%;
      background: var(--ux-primary);
      transition: width 0.1s linear;
    }

    /* ========================================
       Compact Variant
    ======================================== */

    .ux-audio-player--compact {
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    .ux-audio-player--compact .ux-audio-player__info {
      margin-bottom: var(--ux-space-sm);
    }

    .ux-audio-player--compact .ux-audio-player__artwork {
      width: 48px;
      height: 48px;
    }

    .ux-audio-player--compact .ux-audio-player__secondary {
      display: none;
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-audio-player--loading .ux-audio-player__btn--play {
      position: relative;
      color: transparent;
    }

    .ux-audio-player--loading .ux-audio-player__btn--play::after {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      border: 2px solid var(--ux-primary-contrast, white);
      border-top-color: transparent;
      border-radius: 50%;
      animation: ux-audio-player-spin 0.8s linear infinite;
    }

    @keyframes ux-audio-player-spin {
      to { transform: rotate(360deg); }
    }

    /* ========================================
       Error State
    ======================================== */

    .ux-audio-player--error {
      border-color: var(--ux-danger);
    }

    .ux-audio-player__error {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm);
      background: rgba(var(--ux-danger-rgb, 239, 68, 68), 0.1);
      border-radius: var(--ux-radius-sm, 4px);
      color: var(--ux-danger);
      font-size: var(--ux-font-size-sm);
      margin-bottom: var(--ux-space-md);
    }

    .ux-audio-player__error svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    .ux-audio-player--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-audio-player--glass .ux-audio-player__secondary,
    .ux-audio-player--glass .ux-audio-player__playlist {
      border-top-color: var(--ux-glass-border);
    }

    .ux-audio-player--glass .ux-audio-player__speed-btn {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    .ux-audio-player--glass .ux-audio-player__speed-btn:hover {
      background: var(--ux-glass-bg);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-audio-player {
        --ux-audio-player-bg: var(--ux-surface);
      }

      .ux-audio-player__progress-thumb {
        background: var(--ux-text);
      }
    }

    .ux-dark .ux-audio-player {
      --ux-audio-player-bg: var(--ux-surface);
    }

    .ux-dark .ux-audio-player__progress-thumb {
      background: var(--ux-text);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-audio-player__progress-fill,
      .ux-audio-player__progress-thumb,
      .ux-audio-player__volume-fill,
      .ux-audio-player__btn,
      .ux-audio-player__waveform-overlay {
        transition: none;
      }

      .ux-audio-player--loading .ux-audio-player__btn--play::after {
        animation: none;
      }
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-audio-player__secondary {
        flex-direction: column;
        gap: var(--ux-space-md);
      }

      .ux-audio-player__volume {
        max-width: 100%;
        width: 100%;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-audio-player-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-audio-player-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component
  const audioPlayerComponent = (config = {}) => ({
    // State
    isPlaying: false,
    isLoading: false,
    hasError: false,
    errorMessage: '',
    currentTime: 0,
    duration: 0,
    volume: config.volume ?? 1,
    isMuted: false,
    previousVolume: 1,
    playbackRate: config.playbackRate ?? 1,
    buffered: 0,

    // Track info
    src: config.src || '',
    title: config.title || 'Unknown Track',
    artist: config.artist || 'Unknown Artist',
    artwork: config.artwork || '',

    // Playlist
    playlist: config.playlist || [],
    currentTrackIndex: config.startIndex ?? 0,
    shuffle: config.shuffle ?? false,
    repeat: config.repeat ?? 'none', // 'none', 'one', 'all'

    // Waveform
    showWaveform: config.showWaveform ?? false,
    waveformData: [],
    _waveformCanvas: null,
    _waveformCtx: null,

    // Internal
    _audio: null,
    _rafId: null,
    _seekingFromProgress: false,

    // Playback speed options
    speedOptions: [0.5, 0.75, 1, 1.25, 1.5, 2],

    // Computed
    get progress() {
      return this.duration > 0 ? (this.currentTime / this.duration) * 100 : 0;
    },

    get currentTimeFormatted() {
      return this.formatTime(this.currentTime);
    },

    get durationFormatted() {
      return this.formatTime(this.duration);
    },

    get volumePercent() {
      return this.isMuted ? 0 : this.volume * 100;
    },

    get currentTrack() {
      if (this.playlist.length > 0) {
        return this.playlist[this.currentTrackIndex] || {};
      }
      return {
        src: this.src,
        title: this.title,
        artist: this.artist,
        artwork: this.artwork
      };
    },

    get hasPlaylist() {
      return this.playlist.length > 1;
    },

    get canPrev() {
      return this.currentTrackIndex > 0 || this.repeat === 'all';
    },

    get canNext() {
      return this.currentTrackIndex < this.playlist.length - 1 || this.repeat === 'all';
    },

    // ARIA attributes
    get ariaLabel() {
      return `Audio player: ${this.currentTrack.title || this.title}`;
    },

    // Methods
    init() {
      this._audio = new Audio();
      this._audio.preload = 'metadata';

      // Set initial volume
      this._audio.volume = this.volume;
      this._audio.playbackRate = this.playbackRate;

      // Event listeners
      this._audio.addEventListener('loadstart', () => {
        this.isLoading = true;
        this.hasError = false;
      });

      this._audio.addEventListener('loadedmetadata', () => {
        this.duration = this._audio.duration;
        this.isLoading = false;
      });

      this._audio.addEventListener('canplay', () => {
        this.isLoading = false;
      });

      this._audio.addEventListener('play', () => {
        this.isPlaying = true;
        this._startProgressLoop();
        this.$dispatch('ux-audio-player:play', { track: this.currentTrack });
      });

      this._audio.addEventListener('pause', () => {
        this.isPlaying = false;
        this._stopProgressLoop();
        this.$dispatch('ux-audio-player:pause', { track: this.currentTrack });
      });

      this._audio.addEventListener('ended', () => {
        this.isPlaying = false;
        this._stopProgressLoop();
        this._handleTrackEnd();
        this.$dispatch('ux-audio-player:ended', { track: this.currentTrack });
      });

      this._audio.addEventListener('timeupdate', () => {
        if (!this._seekingFromProgress) {
          this.currentTime = this._audio.currentTime;
        }
      });

      this._audio.addEventListener('progress', () => {
        this._updateBuffered();
      });

      this._audio.addEventListener('error', (e) => {
        this.isLoading = false;
        this.hasError = true;
        this.errorMessage = this._getErrorMessage(this._audio.error);
        this.$dispatch('ux-audio-player:error', { error: this._audio.error });
      });

      // Initialize waveform if enabled
      if (this.showWaveform) {
        this.$nextTick(() => {
          this._initWaveform();
        });
      }

      // Load initial track
      this._loadTrack();
    },

    destroy() {
      this._stopProgressLoop();
      if (this._audio) {
        this._audio.pause();
        this._audio.src = '';
        this._audio = null;
      }
    },

    // Playback controls
    play() {
      if (this._audio && this._audio.src) {
        this._audio.play().catch(err => {
          console.error('Play failed:', err);
        });
      }
    },

    pause() {
      if (this._audio) {
        this._audio.pause();
      }
    },

    toggle() {
      if (this.isPlaying) {
        this.pause();
      } else {
        this.play();
      }
    },

    stop() {
      if (this._audio) {
        this._audio.pause();
        this._audio.currentTime = 0;
        this.currentTime = 0;
      }
    },

    // Seeking
    seek(time) {
      if (this._audio && this.duration > 0) {
        const newTime = Math.max(0, Math.min(time, this.duration));
        this._audio.currentTime = newTime;
        this.currentTime = newTime;
        this.$dispatch('ux-audio-player:seek', { time: newTime });
      }
    },

    seekPercent(percent) {
      const time = (percent / 100) * this.duration;
      this.seek(time);
    },

    seekForward(seconds = 10) {
      this.seek(this.currentTime + seconds);
    },

    seekBackward(seconds = 10) {
      this.seek(this.currentTime - seconds);
    },

    // Progress bar interaction
    onProgressClick(event) {
      const rect = event.currentTarget.getBoundingClientRect();
      const percent = ((event.clientX - rect.left) / rect.width) * 100;
      this.seekPercent(percent);
    },

    onProgressDrag(event) {
      this._seekingFromProgress = true;
      const rect = event.currentTarget.getBoundingClientRect();
      const percent = Math.max(0, Math.min(100, ((event.clientX - rect.left) / rect.width) * 100));
      this.currentTime = (percent / 100) * this.duration;
    },

    onProgressDragEnd() {
      if (this._seekingFromProgress) {
        this.seek(this.currentTime);
        this._seekingFromProgress = false;
      }
    },

    // Volume controls
    setVolume(value) {
      this.volume = Math.max(0, Math.min(1, value));
      if (this._audio) {
        this._audio.volume = this.volume;
      }
      if (this.volume > 0) {
        this.isMuted = false;
      }
      this.$dispatch('ux-audio-player:volume', { volume: this.volume });
    },

    toggleMute() {
      if (this.isMuted) {
        this.isMuted = false;
        this.setVolume(this.previousVolume || 1);
      } else {
        this.previousVolume = this.volume;
        this.isMuted = true;
        if (this._audio) {
          this._audio.volume = 0;
        }
      }
    },

    onVolumeInput(event) {
      this.setVolume(parseFloat(event.target.value));
    },

    // Playback speed
    setPlaybackRate(rate) {
      this.playbackRate = rate;
      if (this._audio) {
        this._audio.playbackRate = rate;
      }
      this.$dispatch('ux-audio-player:speed', { rate });
    },

    cyclePlaybackRate() {
      const currentIndex = this.speedOptions.indexOf(this.playbackRate);
      const nextIndex = (currentIndex + 1) % this.speedOptions.length;
      this.setPlaybackRate(this.speedOptions[nextIndex]);
    },

    // Playlist controls
    playTrack(index) {
      if (index >= 0 && index < this.playlist.length) {
        this.currentTrackIndex = index;
        this._loadTrack();
        this.play();
      }
    },

    nextTrack() {
      if (this.shuffle) {
        const randomIndex = Math.floor(Math.random() * this.playlist.length);
        this.playTrack(randomIndex);
      } else if (this.currentTrackIndex < this.playlist.length - 1) {
        this.playTrack(this.currentTrackIndex + 1);
      } else if (this.repeat === 'all') {
        this.playTrack(0);
      }
    },

    prevTrack() {
      // If more than 3 seconds into track, restart it
      if (this.currentTime > 3) {
        this.seek(0);
      } else if (this.currentTrackIndex > 0) {
        this.playTrack(this.currentTrackIndex - 1);
      } else if (this.repeat === 'all') {
        this.playTrack(this.playlist.length - 1);
      }
    },

    toggleShuffle() {
      this.shuffle = !this.shuffle;
      this.$dispatch('ux-audio-player:shuffle', { shuffle: this.shuffle });
    },

    toggleRepeat() {
      const modes = ['none', 'all', 'one'];
      const currentIndex = modes.indexOf(this.repeat);
      this.repeat = modes[(currentIndex + 1) % modes.length];
      this.$dispatch('ux-audio-player:repeat', { repeat: this.repeat });
    },

    // Waveform
    onWaveformClick(event) {
      const rect = event.currentTarget.getBoundingClientRect();
      const percent = ((event.clientX - rect.left) / rect.width) * 100;
      this.seekPercent(percent);
    },

    // Internal methods
    _loadTrack() {
      if (!this._audio) return;

      const track = this.currentTrack;
      if (track.src) {
        this._audio.src = track.src;
        this.title = track.title || 'Unknown Track';
        this.artist = track.artist || 'Unknown Artist';
        this.artwork = track.artwork || '';
        this.currentTime = 0;
        this.duration = 0;

        this.$dispatch('ux-audio-player:load', { track });
      }
    },

    _handleTrackEnd() {
      if (this.repeat === 'one') {
        this.seek(0);
        this.play();
      } else if (this.hasPlaylist) {
        this.nextTrack();
      }
    },

    _startProgressLoop() {
      const update = () => {
        if (this.isPlaying && this._audio) {
          this.currentTime = this._audio.currentTime;
          this._updateWaveform();
          this._rafId = requestAnimationFrame(update);
        }
      };
      this._rafId = requestAnimationFrame(update);
    },

    _stopProgressLoop() {
      if (this._rafId) {
        cancelAnimationFrame(this._rafId);
        this._rafId = null;
      }
    },

    _updateBuffered() {
      if (this._audio && this._audio.buffered.length > 0) {
        const bufferedEnd = this._audio.buffered.end(this._audio.buffered.length - 1);
        this.buffered = this.duration > 0 ? (bufferedEnd / this.duration) * 100 : 0;
      }
    },

    _initWaveform() {
      const canvas = this.$refs.waveformCanvas;
      if (!canvas) return;

      this._waveformCanvas = canvas;
      this._waveformCtx = canvas.getContext('2d');

      // Generate sample waveform data (in real app, analyze audio)
      this._generateSampleWaveform();
      this._drawWaveform();
    },

    _generateSampleWaveform() {
      const bars = 100;
      this.waveformData = [];
      for (let i = 0; i < bars; i++) {
        // Generate random heights with some smoothing
        const height = 0.2 + Math.random() * 0.8;
        this.waveformData.push(height);
      }
    },

    _drawWaveform() {
      if (!this._waveformCanvas || !this._waveformCtx) return;

      const canvas = this._waveformCanvas;
      const ctx = this._waveformCtx;
      const dpr = window.devicePixelRatio || 1;

      // Set canvas size
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.scale(dpr, dpr);

      const width = rect.width;
      const height = rect.height;
      const barWidth = width / this.waveformData.length;
      const progressPercent = this.progress / 100;

      ctx.clearRect(0, 0, width, height);

      this.waveformData.forEach((value, index) => {
        const x = index * barWidth;
        const barHeight = value * height * 0.8;
        const y = (height - barHeight) / 2;

        // Determine color based on progress
        if (index / this.waveformData.length < progressPercent) {
          ctx.fillStyle = getComputedStyle(document.documentElement)
            .getPropertyValue('--ux-primary').trim() || '#007AFF';
        } else {
          ctx.fillStyle = getComputedStyle(document.documentElement)
            .getPropertyValue('--ux-medium').trim() || '#8E8E93';
        }

        ctx.fillRect(x, y, barWidth - 1, barHeight);
      });
    },

    _updateWaveform() {
      if (this.showWaveform) {
        this._drawWaveform();
      }
    },

    _getErrorMessage(error) {
      if (!error) return 'Unknown error';
      switch (error.code) {
        case 1: return 'Loading aborted';
        case 2: return 'Network error';
        case 3: return 'Decoding error';
        case 4: return 'Audio not supported';
        default: return 'Unknown error';
      }
    },

    // Utility
    formatTime(seconds) {
      if (!seconds || isNaN(seconds)) return '0:00';
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    },

    // Keyboard navigation
    handleKeydown(event) {
      switch (event.key) {
        case ' ':
        case 'k':
          event.preventDefault();
          this.toggle();
          break;
        case 'ArrowLeft':
          event.preventDefault();
          this.seekBackward(5);
          break;
        case 'ArrowRight':
          event.preventDefault();
          this.seekForward(5);
          break;
        case 'ArrowUp':
          event.preventDefault();
          this.setVolume(this.volume + 0.1);
          break;
        case 'ArrowDown':
          event.preventDefault();
          this.setVolume(this.volume - 0.1);
          break;
        case 'm':
          event.preventDefault();
          this.toggleMute();
          break;
        case 'j':
          event.preventDefault();
          this.seekBackward(10);
          break;
        case 'l':
          event.preventDefault();
          this.seekForward(10);
          break;
        case 'n':
          event.preventDefault();
          this.nextTrack();
          break;
        case 'p':
          event.preventDefault();
          this.prevTrack();
          break;
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxAudioPlayer', audioPlayerComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxAudioPlayer', audioPlayerComponent);
    });
  }
})();

/**
 * UX Autocomplete Component
 * Search input with suggestions dropdown and highlighting
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Autocomplete Container
       ========================================================================== */

    :root {
      --ux-autocomplete-min-width: 200px;
      --ux-autocomplete-max-height: 300px;
      --ux-autocomplete-item-height: 44px;
      --ux-autocomplete-radius: var(--ux-radius-lg);
    }

    .ux-autocomplete {
      position: relative;
      width: 100%;
      min-width: var(--ux-autocomplete-min-width);
    }

    /* ==========================================================================
       Input
       ========================================================================== */

    .ux-autocomplete__input {
      width: 100%;
      height: var(--ux-input-height);
      padding: 0 var(--ux-space-md);
      padding-right: 2.5rem;
      font-size: 1rem;
      color: var(--ux-text);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-autocomplete-radius);
      outline: none;
      transition: border-color var(--ux-transition-fast), box-shadow var(--ux-transition-fast);
    }

    .ux-autocomplete__input:focus {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-autocomplete__input::placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-autocomplete__input--loading {
      background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle%3E.spinner{transform-origin:center;animation:rotate 1s linear infinite}@keyframes rotate{100%{transform:rotate(360deg)}}%3C/style%3E%3Cg class='spinner'%3E%3Ccircle cx='12' cy='12' r='9' fill='none' stroke='%239CA3AF' stroke-width='2' stroke-dasharray='30 60'/%3E%3C/g%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 20px;
    }

    /* ==========================================================================
       Clear Button
       ========================================================================== */

    .ux-autocomplete__clear {
      position: absolute;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: var(--ux-surface-tertiary);
      border: none;
      border-radius: 50%;
      color: var(--ux-text-secondary);
      cursor: pointer;
      opacity: 0;
      transition: opacity var(--ux-transition-fast), background var(--ux-transition-fast);
    }

    .ux-autocomplete__clear:hover {
      background: var(--ux-gray-300);
    }

    .ux-autocomplete:focus-within .ux-autocomplete__clear,
    .ux-autocomplete__input:not(:placeholder-shown) ~ .ux-autocomplete__clear {
      opacity: 1;
    }

    .ux-autocomplete__clear--hidden {
      display: none;
    }

    /* ==========================================================================
       Dropdown
       ========================================================================== */

    .ux-autocomplete__dropdown {
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      right: 0;
      z-index: var(--ux-z-dropdown);
      max-height: var(--ux-autocomplete-max-height);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-autocomplete-radius);
      box-shadow: var(--ux-shadow-lg);
      overflow: hidden;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all var(--ux-transition-fast) var(--ux-ease-out);
    }

    .ux-autocomplete__dropdown--open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-autocomplete__dropdown--above {
      top: auto;
      bottom: calc(100% + 4px);
      transform: translateY(8px);
    }

    .ux-autocomplete__dropdown--above.ux-autocomplete__dropdown--open {
      transform: translateY(0);
    }

    /* ==========================================================================
       List
       ========================================================================== */

    .ux-autocomplete__list {
      max-height: var(--ux-autocomplete-max-height);
      margin: 0;
      padding: var(--ux-space-xs);
      list-style: none;
      overflow-y: auto;
      overscroll-behavior: contain;
    }

    .ux-autocomplete__item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      min-height: var(--ux-autocomplete-item-height);
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: 0.9375rem;
      color: var(--ux-text);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-autocomplete__item:hover,
    .ux-autocomplete__item--active {
      background: var(--ux-surface-secondary);
    }

    .ux-autocomplete__item--selected {
      background: var(--ux-primary-tint);
      color: var(--ux-primary);
    }

    .ux-autocomplete__item--disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .ux-autocomplete__item-icon {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      color: var(--ux-text-secondary);
    }

    .ux-autocomplete__item-content {
      flex: 1;
      min-width: 0;
    }

    .ux-autocomplete__item-label {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-autocomplete__item-description {
      font-size: 0.8125rem;
      color: var(--ux-text-tertiary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Highlight match */
    .ux-autocomplete__highlight {
      background: var(--ux-warning-tint);
      color: inherit;
      font-weight: 600;
      border-radius: 2px;
      padding: 0 1px;
    }

    /* ==========================================================================
       Groups
       ========================================================================== */

    .ux-autocomplete__group {
      padding-top: var(--ux-space-sm);
    }

    .ux-autocomplete__group:first-child {
      padding-top: 0;
    }

    .ux-autocomplete__group-label {
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: 0.6875rem;
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ==========================================================================
       Empty State
       ========================================================================== */

    .ux-autocomplete__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-xl);
      text-align: center;
      color: var(--ux-text-secondary);
    }

    .ux-autocomplete__empty-icon {
      width: 48px;
      height: 48px;
      margin-bottom: var(--ux-space-sm);
      color: var(--ux-text-tertiary);
      opacity: 0.5;
    }

    .ux-autocomplete__empty-text {
      font-size: 0.9375rem;
    }

    /* ==========================================================================
       Loading State
       ========================================================================== */

    .ux-autocomplete__loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-lg);
    }

    .ux-autocomplete__loading-spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--ux-border-color);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-autocomplete-spin 0.8s linear infinite;
    }

    @keyframes ux-autocomplete-spin {
      to { transform: rotate(360deg); }
    }

    /* ==========================================================================
       Footer
       ========================================================================== */

    .ux-autocomplete__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: 0.75rem;
      color: var(--ux-text-tertiary);
      background: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-autocomplete__footer-hint {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-autocomplete__footer-hint kbd {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 20px;
      height: 18px;
      padding: 0 4px;
      font-size: 0.6875rem;
      font-family: inherit;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: 4px;
      box-shadow: 0 1px 0 var(--ux-border-color);
    }

    /* ==========================================================================
       Variants
       ========================================================================== */

    /* Small */
    .ux-autocomplete--sm .ux-autocomplete__input {
      height: 36px;
      font-size: 0.875rem;
    }

    .ux-autocomplete--sm .ux-autocomplete__item {
      min-height: 36px;
      font-size: 0.875rem;
    }

    /* Large */
    .ux-autocomplete--lg .ux-autocomplete__input {
      height: 52px;
      font-size: 1.0625rem;
    }

    .ux-autocomplete--lg .ux-autocomplete__item {
      min-height: 52px;
      font-size: 1rem;
    }

    /* Glass */
    .ux-autocomplete--glass .ux-autocomplete__input {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    .ux-autocomplete--glass .ux-autocomplete__dropdown {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    /* Inline (no border) */
    .ux-autocomplete--inline .ux-autocomplete__input {
      border-color: transparent;
      background: transparent;
    }

    .ux-autocomplete--inline .ux-autocomplete__input:focus {
      border-color: transparent;
      box-shadow: none;
    }

    /* ==========================================================================
       Multi-select Tags
       ========================================================================== */

    .ux-autocomplete__tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs);
      min-height: var(--ux-input-height);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-autocomplete-radius);
      cursor: text;
      transition: border-color var(--ux-transition-fast);
    }

    .ux-autocomplete__tags:focus-within {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-autocomplete__tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      font-size: 0.8125rem;
      background: var(--ux-primary-tint);
      color: var(--ux-primary);
      border-radius: var(--ux-radius-full);
    }

    .ux-autocomplete__tag-remove {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      background: transparent;
      border: none;
      border-radius: 50%;
      color: inherit;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity var(--ux-transition-fast);
    }

    .ux-autocomplete__tag-remove:hover {
      opacity: 1;
      background: rgba(0, 0, 0, 0.1);
    }

    .ux-autocomplete__tags-input {
      flex: 1;
      min-width: 80px;
      height: 28px;
      padding: 0 var(--ux-space-xs);
      font-size: 0.9375rem;
      color: var(--ux-text);
      background: transparent;
      border: none;
      outline: none;
    }

    .ux-autocomplete__tags-input::placeholder {
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      .ux-autocomplete__highlight {
        background: rgba(var(--ux-warning-rgb), 0.3);
      }
    }

    .ux-dark .ux-autocomplete__highlight {
      background: rgba(var(--ux-warning-rgb), 0.3);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-autocomplete__dropdown {
        transition: opacity var(--ux-transition-fast);
        transform: none;
      }

      .ux-autocomplete__loading-spinner {
        animation: none;
      }
    }
  `;

  // Icons
  const icons = {
    search: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="11" cy="11" r="8"/>
      <path d="M21 21l-4.35-4.35"/>
    </svg>`,
    close: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M18 6L6 18M6 6l12 12"/>
    </svg>`,
    empty: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="11" cy="11" r="8"/>
      <path d="M21 21l-4.35-4.35"/>
      <path d="M8 8l6 6M14 8l-6 6"/>
    </svg>`
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-autocomplete-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-autocomplete-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const autocompleteData = (options = {}) => ({
    // Configuration
    items: options.items || [],
    placeholder: options.placeholder || 'Search...',
    minChars: options.minChars ?? 1,
    debounce: options.debounce ?? 300,
    maxItems: options.maxItems || 10,
    highlightMatches: options.highlightMatches ?? true,
    closeOnSelect: options.closeOnSelect ?? true,
    clearOnSelect: options.clearOnSelect ?? false,
    showEmpty: options.showEmpty ?? true,
    emptyText: options.emptyText || 'No results found',
    labelKey: options.labelKey || 'label',
    valueKey: options.valueKey || 'value',
    descriptionKey: options.descriptionKey || 'description',
    groupKey: options.groupKey || 'group',
    filterFn: options.filterFn || null,
    fetchFn: options.fetchFn || null,
    multiple: options.multiple ?? false,

    // State
    query: '',
    isOpen: false,
    isLoading: false,
    activeIndex: -1,
    filteredItems: [],
    selectedItems: [],
    selectedValue: options.value || null,
    debounceTimer: null,
    icons: icons,

    // Lifecycle
    init() {
      // Set initial value if provided
      if (this.selectedValue && !this.multiple) {
        const item = this.items.find(i => this.getValue(i) === this.selectedValue);
        if (item) {
          this.query = this.getLabel(item);
        }
      }

      // Keyboard navigation
      this.$watch('isOpen', (open) => {
        if (open) {
          this.activeIndex = -1;
        }
      });
    },

    destroy() {
      if (this.debounceTimer) {
        clearTimeout(this.debounceTimer);
      }
    },

    // Getters
    getLabel(item) {
      if (typeof item === 'string') return item;
      return item[this.labelKey] || item.label || item.name || '';
    },

    getValue(item) {
      if (typeof item === 'string') return item;
      return item[this.valueKey] || item.value || item.id || this.getLabel(item);
    },

    getDescription(item) {
      if (typeof item === 'string') return '';
      return item[this.descriptionKey] || item.description || '';
    },

    getGroup(item) {
      if (typeof item === 'string') return null;
      return item[this.groupKey] || item.group || null;
    },

    // Filter and search
    async search() {
      if (this.query.length < this.minChars) {
        this.filteredItems = [];
        this.isOpen = false;
        return;
      }

      this.isLoading = true;

      // Debounce
      if (this.debounceTimer) {
        clearTimeout(this.debounceTimer);
      }

      this.debounceTimer = setTimeout(async () => {
        try {
          let results;

          // Custom fetch function for remote data
          if (this.fetchFn) {
            results = await this.fetchFn(this.query);
          }
          // Custom filter function
          else if (this.filterFn) {
            results = this.filterFn(this.query, this.items);
          }
          // Default filter
          else {
            const queryLower = this.query.toLowerCase();
            results = this.items.filter(item => {
              const label = this.getLabel(item).toLowerCase();
              const description = this.getDescription(item).toLowerCase();
              return label.includes(queryLower) || description.includes(queryLower);
            });
          }

          // Limit results
          this.filteredItems = results.slice(0, this.maxItems);

          // Filter out already selected items in multiple mode
          if (this.multiple) {
            const selectedValues = this.selectedItems.map(i => this.getValue(i));
            this.filteredItems = this.filteredItems.filter(
              item => !selectedValues.includes(this.getValue(item))
            );
          }

          this.isOpen = this.filteredItems.length > 0 || this.showEmpty;
          this.activeIndex = -1;
        } catch (error) {
          console.error('Autocomplete search error:', error);
          this.filteredItems = [];
        } finally {
          this.isLoading = false;
        }
      }, this.debounce);
    },

    // Highlight matching text
    highlight(text) {
      if (!this.highlightMatches || !this.query) return text;

      const regex = new RegExp(`(${this.escapeRegex(this.query)})`, 'gi');
      return text.replace(regex, '<mark class="ux-autocomplete__highlight">$1</mark>');
    },

    escapeRegex(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    },

    // Selection
    select(item) {
      if (this.multiple) {
        this.selectedItems.push(item);
        this.query = '';
        this.filteredItems = [];
        this.$dispatch('autocomplete:select', {
          item: item,
          value: this.getValue(item),
          items: this.selectedItems,
          values: this.selectedItems.map(i => this.getValue(i))
        });
      } else {
        this.selectedValue = this.getValue(item);
        this.query = this.clearOnSelect ? '' : this.getLabel(item);
        this.$dispatch('autocomplete:select', {
          item: item,
          value: this.selectedValue
        });
      }

      if (this.closeOnSelect) {
        this.isOpen = false;
      }

      this.$refs.input?.focus();
    },

    removeSelected(index) {
      const removed = this.selectedItems.splice(index, 1)[0];
      this.$dispatch('autocomplete:remove', {
        item: removed,
        value: this.getValue(removed),
        items: this.selectedItems
      });
    },

    clear() {
      this.query = '';
      this.selectedValue = null;
      this.selectedItems = [];
      this.filteredItems = [];
      this.isOpen = false;
      this.$dispatch('autocomplete:clear');
      this.$refs.input?.focus();
    },

    // Keyboard navigation
    onKeydown(event) {
      switch (event.key) {
        case 'ArrowDown':
          event.preventDefault();
          if (!this.isOpen && this.query.length >= this.minChars) {
            this.search();
          } else {
            this.activeIndex = Math.min(this.activeIndex + 1, this.filteredItems.length - 1);
          }
          break;

        case 'ArrowUp':
          event.preventDefault();
          this.activeIndex = Math.max(this.activeIndex - 1, -1);
          break;

        case 'Enter':
          event.preventDefault();
          if (this.activeIndex >= 0 && this.filteredItems[this.activeIndex]) {
            this.select(this.filteredItems[this.activeIndex]);
          }
          break;

        case 'Escape':
          this.isOpen = false;
          this.activeIndex = -1;
          break;

        case 'Backspace':
          if (this.multiple && !this.query && this.selectedItems.length > 0) {
            this.removeSelected(this.selectedItems.length - 1);
          }
          break;

        case 'Tab':
          this.isOpen = false;
          break;
      }
    },

    onInput() {
      this.search();
      this.$dispatch('autocomplete:input', { query: this.query });
    },

    onFocus() {
      if (this.query.length >= this.minChars) {
        this.search();
      }
      this.$dispatch('autocomplete:focus');
    },

    onBlur() {
      // Delay to allow click on dropdown items
      setTimeout(() => {
        this.isOpen = false;
        this.$dispatch('autocomplete:blur');
      }, 200);
    },

    // Grouped items
    get groupedItems() {
      const groups = new Map();

      this.filteredItems.forEach(item => {
        const group = this.getGroup(item) || '__ungrouped__';
        if (!groups.has(group)) {
          groups.set(group, []);
        }
        groups.get(group).push(item);
      });

      return groups;
    },

    get hasGroups() {
      return this.filteredItems.some(item => this.getGroup(item));
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxAutocomplete', autocompleteData);
  }
})();

/**
 * UX Avatar Component
 * Avatares para usuarios con imagen, iniciales o icono
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Avatar
    ======================================== */

    .ux-avatar {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-avatar-size);
      height: var(--ux-avatar-size);
      border-radius: 50%;
      background-color: var(--ux-medium);
      color: var(--ux-medium-contrast);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      text-transform: uppercase;
      overflow: hidden;
      flex-shrink: 0;
    }

    .ux-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-avatar--xs {
      width: var(--ux-avatar-size-xs);
      height: var(--ux-avatar-size-xs);
      font-size: var(--ux-font-size-xs);
    }

    .ux-avatar--sm {
      width: var(--ux-avatar-size-sm);
      height: var(--ux-avatar-size-sm);
      font-size: var(--ux-font-size-sm);
    }

    .ux-avatar--md {
      width: var(--ux-avatar-size);
      height: var(--ux-avatar-size);
      font-size: var(--ux-font-size-lg);
    }

    .ux-avatar--lg {
      width: var(--ux-avatar-size-lg);
      height: var(--ux-avatar-size-lg);
      font-size: var(--ux-font-size-xl);
    }

    .ux-avatar--xl {
      width: var(--ux-avatar-size-xl);
      height: var(--ux-avatar-size-xl);
      font-size: var(--ux-font-size-3xl);
    }

    .ux-avatar--2xl {
      width: calc(var(--ux-avatar-size-xl) * 1.33);
      height: calc(var(--ux-avatar-size-xl) * 1.33);
      font-size: var(--ux-font-size-4xl);
    }

    /* ========================================
       Shape Variants
    ======================================== */

    .ux-avatar--square {
      border-radius: var(--ux-border-radius);
    }

    .ux-avatar--rounded {
      border-radius: var(--ux-border-radius-lg);
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-avatar--primary {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-avatar--secondary {
      background-color: var(--ux-secondary);
      color: var(--ux-secondary-contrast);
    }

    .ux-avatar--tertiary {
      background-color: var(--ux-tertiary);
      color: var(--ux-tertiary-contrast);
    }

    .ux-avatar--success {
      background-color: var(--ux-success);
      color: var(--ux-success-contrast);
    }

    .ux-avatar--warning {
      background-color: var(--ux-warning);
      color: var(--ux-warning-contrast);
    }

    .ux-avatar--danger {
      background-color: var(--ux-danger);
      color: var(--ux-danger-contrast);
    }

    .ux-avatar--dark {
      background-color: var(--ux-dark);
      color: var(--ux-dark-contrast);
    }

    .ux-avatar--light {
      background-color: var(--ux-light);
      color: var(--ux-light-contrast);
    }

    /* ========================================
       Status Indicator
    ======================================== */

    .ux-avatar__status {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid var(--ux-background);
      background-color: var(--ux-medium);
    }

    .ux-avatar--xs .ux-avatar__status {
      width: 8px;
      height: 8px;
      border-width: 1px;
    }

    .ux-avatar--sm .ux-avatar__status {
      width: 10px;
      height: 10px;
    }

    .ux-avatar--lg .ux-avatar__status,
    .ux-avatar--xl .ux-avatar__status {
      width: 16px;
      height: 16px;
      border-width: 3px;
    }

    .ux-avatar__status--online {
      background-color: var(--ux-success);
    }

    .ux-avatar__status--offline {
      background-color: var(--ux-medium);
    }

    .ux-avatar__status--busy {
      background-color: var(--ux-danger);
    }

    .ux-avatar__status--away {
      background-color: var(--ux-warning);
    }

    /* ========================================
       Avatar Group
    ======================================== */

    .ux-avatar-group {
      display: inline-flex;
      flex-direction: row-reverse;
      align-items: center;
    }

    .ux-avatar-group .ux-avatar {
      margin-left: -12px;
      border: 2px solid var(--ux-background);
      transition: transform var(--ux-transition-fast) var(--ux-ease);
      box-sizing: content-box;
    }

    .ux-avatar-group .ux-avatar:last-child {
      margin-left: 0;
    }

    .ux-avatar-group .ux-avatar:hover {
      transform: translateY(-4px);
      z-index: 10;
    }

    /* Group Sizes */
    .ux-avatar-group--xs .ux-avatar {
      margin-left: -6px;
      border-width: 1px;
    }

    .ux-avatar-group--sm .ux-avatar {
      margin-left: -8px;
    }

    .ux-avatar-group--lg .ux-avatar {
      margin-left: -16px;
      border-width: 3px;
    }

    .ux-avatar-group--xl .ux-avatar {
      margin-left: -20px;
      border-width: 3px;
    }

    /* Group Stacking (left-to-right) */
    .ux-avatar-group--stack-left {
      flex-direction: row;
    }

    .ux-avatar-group--stack-left .ux-avatar {
      margin-left: 0;
      margin-right: -12px;
    }

    .ux-avatar-group--stack-left .ux-avatar:last-child {
      margin-right: 0;
    }

    /* Group - No Hover Effect */
    .ux-avatar-group--static .ux-avatar:hover {
      transform: none;
    }

    /* Avatar Group Counter */
    .ux-avatar-group__more {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-avatar-size);
      height: var(--ux-avatar-size);
      margin-left: -12px;
      border-radius: 50%;
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text);
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      border: 2px solid var(--ux-background);
      cursor: default;
      box-sizing: content-box;
    }

    .ux-avatar-group--xs .ux-avatar-group__more {
      width: var(--ux-avatar-size-xs);
      height: var(--ux-avatar-size-xs);
      margin-left: -6px;
      font-size: 9px;
      border-width: 1px;
    }

    .ux-avatar-group--sm .ux-avatar-group__more {
      width: var(--ux-avatar-size-sm);
      height: var(--ux-avatar-size-sm);
      margin-left: -8px;
      font-size: 10px;
    }

    .ux-avatar-group--lg .ux-avatar-group__more {
      width: var(--ux-avatar-size-lg);
      height: var(--ux-avatar-size-lg);
      margin-left: -16px;
      font-size: var(--ux-font-size-md);
      border-width: 3px;
    }

    .ux-avatar-group--xl .ux-avatar-group__more {
      width: var(--ux-avatar-size-xl);
      height: var(--ux-avatar-size-xl);
      margin-left: -20px;
      font-size: var(--ux-font-size-lg);
      border-width: 3px;
    }

    .ux-avatar-group--stack-left .ux-avatar-group__more {
      margin-left: 0;
      margin-right: -12px;
    }

    .ux-avatar-group__more:hover {
      background-color: var(--ux-surface-tertiary);
    }

    .ux-avatar-group__more--clickable {
      cursor: pointer;
    }

    /* Avatar Group Tooltip Container */
    .ux-avatar-group-wrapper {
      position: relative;
      display: inline-flex;
    }

    .ux-avatar-group__tooltip {
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      z-index: var(--ux-z-tooltip);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-gray-900);
      color: white;
      font-size: 0.75rem;
      border-radius: var(--ux-radius-md);
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all var(--ux-transition-fast);
    }

    .ux-avatar-group__tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: var(--ux-gray-900);
    }

    .ux-avatar-group-wrapper:hover .ux-avatar-group__tooltip {
      opacity: 1;
      visibility: visible;
    }

    /* Glass variant for group */
    .ux-avatar-group--glass .ux-avatar {
      border-color: var(--ux-glass-border);
    }

    .ux-avatar-group--glass .ux-avatar-group__more {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Avatar with Badge
    ======================================== */

    .ux-avatar__badge {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 18px;
      height: 18px;
      padding: 0 4px;
      border-radius: 9px;
      background-color: var(--ux-danger);
      color: white;
      font-size: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--ux-background);
    }

    /* ========================================
       Avatar Icon
    ======================================== */

    .ux-avatar__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 60%;
      height: 60%;
    }

    .ux-avatar__icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Clickable Avatar
    ======================================== */

    .ux-avatar--clickable {
      cursor: pointer;
      transition: transform var(--ux-transition-fast) var(--ux-ease),
                  box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-avatar--clickable:hover {
      transform: scale(1.05);
      box-shadow: var(--ux-shadow-md);
    }

    .ux-avatar--clickable:active {
      transform: scale(0.98);
    }

    /* ========================================
       Avatar Placeholder (loading)
    ======================================== */

    .ux-avatar--loading {
      background: linear-gradient(
        90deg,
        var(--ux-light) 25%,
        var(--ux-light-tint) 50%,
        var(--ux-light) 75%
      );
      background-size: 200% 100%;
      animation: ux-avatar-shimmer 1.5s infinite;
    }

    @keyframes ux-avatar-shimmer {
      0% {
        background-position: 200% 0;
      }
      100% {
        background-position: -200% 0;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-avatar-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-avatar-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Helper function to get initials from name
  window.UX = window.UX || {};
  window.UX.getInitials = function(name, maxLength = 2) {
    if (!name) return '';
    return name
      .split(' ')
      .map(word => word[0])
      .join('')
      .toUpperCase()
      .slice(0, maxLength);
  };

  // Helper function to generate color from string
  window.UX.stringToColor = function(str) {
    const colors = [
      'primary', 'secondary', 'tertiary',
      'success', 'warning', 'danger'
    ];
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      hash = str.charCodeAt(i) + ((hash << 5) - hash);
    }
    return colors[Math.abs(hash) % colors.length];
  };
})();

/**
 * UX Back Button Component
 * iOS-style back button with arrow and text
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Back Button
    ======================================== */

    .ux-back-button {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      padding-left: 0;
      background: none;
      border: none;
      color: var(--ux-primary);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-md);
      font-weight: 400;
      text-decoration: none;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-back-button:hover {
      opacity: 0.7;
    }

    .ux-back-button:active {
      opacity: 0.5;
      transform: scale(0.97);
    }

    /* ========================================
       Back Button Icon
    ======================================== */

    .ux-back-button__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      flex-shrink: 0;
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-back-button__icon svg {
      width: 100%;
      height: 100%;
    }

    /* Hover animation - slide left */
    .ux-back-button:hover .ux-back-button__icon {
      transform: translateX(-2px);
    }

    /* ========================================
       Back Button Text
    ======================================== */

    .ux-back-button__text {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 120px;
    }

    /* Icon only */
    .ux-back-button--icon-only .ux-back-button__text {
      display: none;
    }

    .ux-back-button--icon-only {
      padding: var(--ux-space-xs);
    }

    /* ========================================
       Back Button Sizes
    ======================================== */

    .ux-back-button--sm {
      min-height: var(--ux-touch-target-sm);
      font-size: var(--ux-font-size-sm);
    }

    .ux-back-button--sm .ux-back-button__icon {
      width: 20px;
      height: 20px;
    }

    .ux-back-button--sm .ux-back-button__text {
      max-width: 100px;
    }

    .ux-back-button--lg {
      font-size: var(--ux-font-size-lg);
    }

    .ux-back-button--lg .ux-back-button__icon {
      width: 28px;
      height: 28px;
    }

    .ux-back-button--lg .ux-back-button__text {
      max-width: 160px;
    }

    /* ========================================
       Back Button Colors
    ======================================== */

    .ux-back-button--light {
      color: white;
    }

    .ux-back-button--dark {
      color: var(--ux-text);
    }

    .ux-back-button--secondary {
      color: var(--ux-text-secondary);
    }

    /* ========================================
       Back Button in Navbar
    ======================================== */

    .ux-navbar .ux-back-button {
      margin-left: calc(-1 * var(--ux-space-sm));
    }

    .ux-navbar--primary .ux-back-button,
    .ux-navbar--dark .ux-back-button {
      color: white;
    }

    /* ========================================
       Back Button in Toolbar
    ======================================== */

    .ux-toolbar .ux-back-button {
      margin-left: calc(-1 * var(--ux-space-xs));
    }

    /* ========================================
       Back Button in Modal
    ======================================== */

    .ux-modal__header .ux-back-button {
      margin-left: calc(-1 * var(--ux-space-sm));
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-back-button:disabled,
    .ux-back-button--disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    /* ========================================
       Custom Icon Positions
    ======================================== */

    .ux-back-button--icon-end {
      flex-direction: row-reverse;
    }

    .ux-back-button--icon-end .ux-back-button__icon {
      transform: rotate(180deg);
    }

    .ux-back-button--icon-end:hover .ux-back-button__icon {
      transform: rotate(180deg) translateX(-2px);
    }

    /* ========================================
       Animated Entrance (for page transitions)
    ======================================== */

    @keyframes ux-back-button-enter {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .ux-back-button--animate-in {
      animation: ux-back-button-enter 300ms var(--ux-ease-spring) forwards;
    }

    /* ========================================
       Collapse/Expand Animation (iOS-style)
    ======================================== */

    .ux-back-button--collapsible .ux-back-button__text {
      transition:
        max-width 200ms var(--ux-ease),
        opacity 200ms var(--ux-ease);
    }

    .ux-back-button--collapsed .ux-back-button__text {
      max-width: 0;
      opacity: 0;
      padding: 0;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
       Circular button with frosted glass effect
    ======================================== */

    .ux-back-button--glass {
      width: 36px;
      height: 36px;
      min-height: 36px;
      padding: 0;
      border-radius: 50%;
      background: rgba(120, 120, 128, 0.24);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      color: var(--ux-text);
      justify-content: center;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-back-button--glass .ux-back-button__text {
      display: none;
    }

    .ux-back-button--glass .ux-back-button__icon {
      width: 20px;
      height: 20px;
    }

    .ux-back-button--glass:hover {
      background: rgba(120, 120, 128, 0.36);
      opacity: 1;
    }

    .ux-back-button--glass:hover .ux-back-button__icon {
      transform: none;
    }

    .ux-back-button--glass:active {
      background: rgba(120, 120, 128, 0.48);
      transform: scale(0.92);
      opacity: 1;
    }

    /* Glass button sizes */
    .ux-back-button--glass.ux-back-button--sm {
      width: 28px;
      height: 28px;
      min-height: 28px;
    }

    .ux-back-button--glass.ux-back-button--sm .ux-back-button__icon {
      width: 16px;
      height: 16px;
    }

    .ux-back-button--glass.ux-back-button--lg {
      width: 44px;
      height: 44px;
      min-height: 44px;
    }

    .ux-back-button--glass.ux-back-button--lg .ux-back-button__icon {
      width: 24px;
      height: 24px;
    }

    /* Dark mode glass */
    .ux-dark .ux-back-button--glass {
      background: rgba(120, 120, 128, 0.32);
      color: #ffffff;
    }

    .ux-dark .ux-back-button--glass:hover {
      background: rgba(120, 120, 128, 0.44);
    }

    .ux-dark .ux-back-button--glass:active {
      background: rgba(120, 120, 128, 0.56);
    }

    @media (prefers-color-scheme: dark) {
      .ux-back-button--glass {
        background: rgba(120, 120, 128, 0.32);
        color: #ffffff;
      }

      .ux-back-button--glass:hover {
        background: rgba(120, 120, 128, 0.44);
      }

      .ux-back-button--glass:active {
        background: rgba(120, 120, 128, 0.56);
      }
    }

    /* Glass button in glass navbar */
    .ux-navbar--glass .ux-back-button--glass {
      margin-left: 0;
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-back-button--glass {
        background: rgba(120, 120, 128, 0.5);
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-back-button {
        transition: none;
      }

      .ux-back-button__icon {
        transition: none;
      }

      .ux-back-button:hover .ux-back-button__icon {
        transform: none;
      }

      .ux-back-button:active {
        transform: none;
      }

      .ux-back-button--animate-in {
        animation: none;
      }

      .ux-back-button--collapsible .ux-back-button__text {
        transition: none;
      }

      .ux-back-button--glass {
        transition: none;
      }
    }
  `;

  // Default back arrow SVG (iOS SF Symbols style - thin chevron)
  const backArrowSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>`;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-back-button-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-back-button-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for back button with routing
  // ARIA: aria-label for accessibility
  const backButtonComponent = (config = {}) => ({
    text: config.text || 'Back',
    href: config.href || null,
    defaultHref: config.defaultHref || '/',
    showIcon: config.showIcon !== false,
    showText: config.showText !== false,
    disabled: config.disabled || false,
    collapsed: config.collapsed || false,

    // ARIA attributes
    get ariaAttrs() {
      return {
        'aria-label': this.text || 'Go back',
        'role': this.href ? 'link' : 'button'
      };
    },

    // Get the back arrow SVG
    get iconSvg() {
      return backArrowSvg;
    },

    // Navigate back
    goBack() {
      if (this.disabled) return;

      // If href is provided, navigate to it
      if (this.href) {
        window.location.href = this.href;
        return;
      }

      // Check if there's history to go back to
      if (window.history.length > 1) {
        window.history.back();
      } else if (this.defaultHref) {
        // Fallback to default href
        window.location.href = this.defaultHref;
      }

      // Dispatch event for custom handling
      this.$dispatch('back-button-click');
    },

    // Handle click
    handleClick(event) {
      // If it's a link and href is set, let it navigate normally
      if (this.href && event.currentTarget.tagName === 'A') {
        return;
      }

      event.preventDefault();
      this.goBack();
    },

    // Collapse/expand text (iOS scroll behavior)
    collapse() {
      this.collapsed = true;
    },

    expand() {
      this.collapsed = false;
    },

    toggle() {
      this.collapsed = !this.collapsed;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxBackButton', backButtonComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxBackButton', backButtonComponent);
    });
  }

  // Export SVG for use in templates
  window.UX = window.UX || {};
  window.UX.backArrowSvg = backArrowSvg;
})();

/**
 * UX Badge Component
 * Badges para mostrar contadores y estados
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Badge
    ======================================== */

    .ux-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: var(--ux-badge-min-height);
      height: var(--ux-badge-min-height);
      padding: 0 var(--ux-badge-padding-x);
      font-family: var(--ux-font-family);
      font-size: var(--ux-badge-font-size);
      font-weight: 600;
      line-height: 1;
      text-align: center;
      white-space: nowrap;
      vertical-align: middle;
      border-radius: var(--ux-badge-border-radius);
      /* Uses composition system: combine with .ux-color-* classes */
      background-color: var(--ux-variant-bg, var(--ux-primary));
      color: var(--ux-variant-color, var(--ux-primary-contrast));
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-badge--xs {
      min-width: 14px;
      height: 14px;
      padding: 0 3px;
      font-size: 8px;
      border-radius: 7px;
    }

    .ux-badge--sm {
      min-width: 16px;
      height: 16px;
      padding: 0 4px;
      font-size: 9px;
      border-radius: 8px;
    }

    /* Default is md (20px) */

    .ux-badge--lg {
      min-width: 24px;
      height: 24px;
      padding: 0 8px;
      font-size: var(--ux-font-size-sm);
      border-radius: 12px;
    }

    .ux-badge--xl {
      min-width: 28px;
      height: 28px;
      padding: 0 10px;
      font-size: var(--ux-font-size-md);
      border-radius: 14px;
    }

    .ux-badge--xxl {
      min-width: 32px;
      height: 32px;
      padding: 0 12px;
      font-size: var(--ux-font-size-lg);
      border-radius: 16px;
    }

    /* ========================================
       Dot (no text)
    ======================================== */

    .ux-badge--dot {
      min-width: 8px;
      width: 8px;
      height: 8px;
      padding: 0;
      font-size: 0;
    }

    .ux-badge--dot.ux-badge--sm {
      min-width: 6px;
      width: 6px;
      height: 6px;
    }

    .ux-badge--dot.ux-badge--lg {
      min-width: 10px;
      width: 10px;
      height: 10px;
    }

    /* ========================================
       Outline Variant
       Use with .ux-color-*--outline classes
    ======================================== */

    .ux-badge--outline {
      background-color: var(--ux-variant-bg, transparent);
      color: var(--ux-variant-color, var(--ux-primary));
      border: 1px solid var(--ux-variant-border, currentColor);
    }

    /* ========================================
       Soft Variant (tinted background)
       Use with .ux-color-*--soft classes
    ======================================== */

    .ux-badge--soft {
      background-color: var(--ux-variant-bg, rgba(var(--ux-primary-rgb), 0.15));
      color: var(--ux-variant-color, var(--ux-primary-shade));
    }

    /* ========================================
       Badge Container (for positioning)
    ======================================== */

    .ux-badge-container {
      position: relative;
      display: inline-flex;
    }

    .ux-badge-container .ux-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      z-index: 1;
    }

    .ux-badge-container .ux-badge--dot {
      top: 0;
      right: 0;
    }

    /* Position variants */
    .ux-badge-container--top-left .ux-badge {
      top: -4px;
      right: auto;
      left: -4px;
    }

    .ux-badge-container--bottom-right .ux-badge {
      top: auto;
      bottom: -4px;
      right: -4px;
    }

    .ux-badge-container--bottom-left .ux-badge {
      top: auto;
      bottom: -4px;
      right: auto;
      left: -4px;
    }

    /* ========================================
       Animation (for updates)
    ======================================== */

    .ux-badge--pulse {
      animation: ux-badge-pulse 1.5s ease-in-out infinite;
    }

    @keyframes ux-badge-pulse {
      0%, 100% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.1);
        opacity: 0.8;
      }
    }

    .ux-badge--bounce {
      animation: ux-badge-bounce 0.5s ease;
    }

    @keyframes ux-badge-bounce {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-badge--glass {
      border: 0.5px solid var(--ux-glass-border);
      color: var(--ux-text);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-badge-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-badge-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }
})();

/**
 * UX Banner Component
 * Dismissable notification bar estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Banner - CSS Variables
    ======================================== */

    :root {
      --ux-banner-min-height: 48px;
      --ux-banner-padding-x: var(--ux-space-lg);
      --ux-banner-padding-y: var(--ux-space-md);
      --ux-banner-gap: var(--ux-space-md);
      --ux-banner-icon-size: 20px;
      --ux-banner-border-radius: 0;
      --ux-banner-font-size: var(--ux-font-size-sm);
    }

    /* ========================================
       UX Banner Base
    ======================================== */

    .ux-banner {
      display: flex;
      align-items: center;
      gap: var(--ux-banner-gap);
      min-height: var(--ux-banner-min-height);
      padding: var(--ux-banner-padding-y) var(--ux-banner-padding-x);
      background-color: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      font-size: var(--ux-banner-font-size);
      line-height: 1.4;
      width: 100%;
      box-sizing: border-box;
      opacity: 1;
      transform: translateY(0);
      max-height: 200px;
      overflow: hidden;
      transition:
        opacity var(--ux-transition-normal) var(--ux-ease),
        transform var(--ux-transition-normal) var(--ux-ease),
        max-height var(--ux-transition-normal) var(--ux-ease),
        padding var(--ux-transition-normal) var(--ux-ease);
    }

    /* Hidden state for dismiss animation */
    .ux-banner--hidden {
      opacity: 0;
      transform: translateY(-100%);
      max-height: 0;
      padding-top: 0;
      padding-bottom: 0;
      border-bottom-width: 0;
    }

    /* Sticky positioning */
    .ux-banner--sticky {
      position: sticky;
      top: 0;
      z-index: var(--ux-z-sticky);
    }

    /* Fixed positioning (full width at top) */
    .ux-banner--fixed {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: var(--ux-z-fixed);
    }

    /* Safe area support for fixed banner */
    .ux-banner--fixed.ux-banner--safe-area {
      padding-top: calc(var(--ux-banner-padding-y) + env(safe-area-inset-top));
    }

    /* ========================================
       Banner Icon
    ======================================== */

    .ux-banner__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-banner-icon-size);
      height: var(--ux-banner-icon-size);
      flex-shrink: 0;
    }

    .ux-banner__icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Banner Content
    ======================================== */

    .ux-banner__content {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ux-banner__title {
      font-weight: var(--ux-font-weight-semibold);
      color: var(--ux-text);
      margin: 0;
    }

    .ux-banner__message {
      color: var(--ux-text-secondary);
      margin: 0;
    }

    /* Single line content (no title, just message) */
    .ux-banner__content--inline {
      flex-direction: row;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    /* ========================================
       Banner Actions
    ======================================== */

    .ux-banner__actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      flex-shrink: 0;
    }

    .ux-banner__action {
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: none;
      border: none;
      color: var(--ux-primary);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-sm);
      font-weight: var(--ux-font-weight-semibold);
      cursor: pointer;
      border-radius: var(--ux-border-radius-sm);
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-banner__action:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-banner__action:active {
      background-color: rgba(var(--ux-primary-rgb), 0.15);
    }

    /* ========================================
       Banner Close Button
    ======================================== */

    .ux-banner__close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      padding: 0;
      background: none;
      border: none;
      color: var(--ux-text-tertiary);
      cursor: pointer;
      flex-shrink: 0;
      border-radius: var(--ux-border-radius-sm);
      -webkit-tap-highlight-color: transparent;
      transition:
        color var(--ux-transition-fast) var(--ux-ease),
        background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-banner__close:hover {
      color: var(--ux-text);
      background-color: rgba(0, 0, 0, 0.05);
    }

    .ux-banner__close:active {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .ux-banner__close svg {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Banner Color Variants
    ======================================== */

    /* Info (default blue) */
    .ux-banner--info {
      background-color: rgba(var(--ux-info-rgb), 0.1);
      border-bottom-color: rgba(var(--ux-info-rgb), 0.2);
    }

    .ux-banner--info .ux-banner__icon {
      color: var(--ux-info);
    }

    .ux-banner--info .ux-banner__action {
      color: var(--ux-info);
    }

    .ux-banner--info .ux-banner__action:hover {
      background-color: rgba(var(--ux-info-rgb), 0.15);
    }

    /* Success (green) */
    .ux-banner--success {
      background-color: rgba(var(--ux-success-rgb), 0.1);
      border-bottom-color: rgba(var(--ux-success-rgb), 0.2);
    }

    .ux-banner--success .ux-banner__icon {
      color: var(--ux-success);
    }

    .ux-banner--success .ux-banner__action {
      color: var(--ux-success);
    }

    .ux-banner--success .ux-banner__action:hover {
      background-color: rgba(var(--ux-success-rgb), 0.15);
    }

    /* Warning (amber) */
    .ux-banner--warning {
      background-color: rgba(var(--ux-warning-rgb), 0.1);
      border-bottom-color: rgba(var(--ux-warning-rgb), 0.2);
    }

    .ux-banner--warning .ux-banner__icon {
      color: var(--ux-warning);
    }

    .ux-banner--warning .ux-banner__action {
      color: var(--ux-warning-shade);
    }

    .ux-banner--warning .ux-banner__action:hover {
      background-color: rgba(var(--ux-warning-rgb), 0.15);
    }

    /* Danger (red) */
    .ux-banner--danger {
      background-color: rgba(var(--ux-danger-rgb), 0.1);
      border-bottom-color: rgba(var(--ux-danger-rgb), 0.2);
    }

    .ux-banner--danger .ux-banner__icon {
      color: var(--ux-danger);
    }

    .ux-banner--danger .ux-banner__action {
      color: var(--ux-danger);
    }

    .ux-banner--danger .ux-banner__action:hover {
      background-color: rgba(var(--ux-danger-rgb), 0.15);
    }

    /* ========================================
       Banner Filled Variants (solid background)
    ======================================== */

    .ux-banner--info-filled {
      background-color: var(--ux-info);
      color: var(--ux-info-contrast);
      border-bottom-color: var(--ux-info-shade);
    }

    .ux-banner--info-filled .ux-banner__icon,
    .ux-banner--info-filled .ux-banner__title,
    .ux-banner--info-filled .ux-banner__message {
      color: var(--ux-info-contrast);
    }

    .ux-banner--info-filled .ux-banner__action {
      color: var(--ux-info-contrast);
    }

    .ux-banner--info-filled .ux-banner__action:hover {
      background-color: rgba(255, 255, 255, 0.15);
    }

    .ux-banner--info-filled .ux-banner__close {
      color: rgba(255, 255, 255, 0.7);
    }

    .ux-banner--info-filled .ux-banner__close:hover {
      color: var(--ux-info-contrast);
      background-color: rgba(255, 255, 255, 0.15);
    }

    .ux-banner--success-filled {
      background-color: var(--ux-success);
      color: var(--ux-success-contrast);
      border-bottom-color: var(--ux-success-shade);
    }

    .ux-banner--success-filled .ux-banner__icon,
    .ux-banner--success-filled .ux-banner__title,
    .ux-banner--success-filled .ux-banner__message {
      color: var(--ux-success-contrast);
    }

    .ux-banner--success-filled .ux-banner__action {
      color: var(--ux-success-contrast);
    }

    .ux-banner--success-filled .ux-banner__action:hover {
      background-color: rgba(255, 255, 255, 0.15);
    }

    .ux-banner--success-filled .ux-banner__close {
      color: rgba(255, 255, 255, 0.7);
    }

    .ux-banner--success-filled .ux-banner__close:hover {
      color: var(--ux-success-contrast);
      background-color: rgba(255, 255, 255, 0.15);
    }

    .ux-banner--warning-filled {
      background-color: var(--ux-warning);
      color: var(--ux-warning-contrast);
      border-bottom-color: var(--ux-warning-shade);
    }

    .ux-banner--warning-filled .ux-banner__icon,
    .ux-banner--warning-filled .ux-banner__title,
    .ux-banner--warning-filled .ux-banner__message {
      color: var(--ux-warning-contrast);
    }

    .ux-banner--warning-filled .ux-banner__action {
      color: var(--ux-warning-contrast);
    }

    .ux-banner--warning-filled .ux-banner__action:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .ux-banner--warning-filled .ux-banner__close {
      color: rgba(0, 0, 0, 0.5);
    }

    .ux-banner--warning-filled .ux-banner__close:hover {
      color: var(--ux-warning-contrast);
      background-color: rgba(0, 0, 0, 0.1);
    }

    .ux-banner--danger-filled {
      background-color: var(--ux-danger);
      color: var(--ux-danger-contrast);
      border-bottom-color: var(--ux-danger-shade);
    }

    .ux-banner--danger-filled .ux-banner__icon,
    .ux-banner--danger-filled .ux-banner__title,
    .ux-banner--danger-filled .ux-banner__message {
      color: var(--ux-danger-contrast);
    }

    .ux-banner--danger-filled .ux-banner__action {
      color: var(--ux-danger-contrast);
    }

    .ux-banner--danger-filled .ux-banner__action:hover {
      background-color: rgba(255, 255, 255, 0.15);
    }

    .ux-banner--danger-filled .ux-banner__close {
      color: rgba(255, 255, 255, 0.7);
    }

    .ux-banner--danger-filled .ux-banner__close:hover {
      color: var(--ux-danger-contrast);
      background-color: rgba(255, 255, 255, 0.15);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter comes from universal selector [class*="--glass"] in ux-core.js */
    .ux-banner--glass {
      border-bottom: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }

    .ux-banner--glass .ux-banner__action:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .ux-banner--glass .ux-banner__close:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-banner--glass {
        background-color: var(--ux-surface);
      }
    }

    /* ========================================
       Inline/Card Variant (with border radius)
    ======================================== */

    .ux-banner--inline {
      border-radius: var(--ux-border-radius-lg);
      border: 1px solid var(--ux-border-color);
      margin: var(--ux-space-md);
      width: auto;
    }

    .ux-banner--inline.ux-banner--info {
      border-color: rgba(var(--ux-info-rgb), 0.3);
    }

    .ux-banner--inline.ux-banner--success {
      border-color: rgba(var(--ux-success-rgb), 0.3);
    }

    .ux-banner--inline.ux-banner--warning {
      border-color: rgba(var(--ux-warning-rgb), 0.3);
    }

    .ux-banner--inline.ux-banner--danger {
      border-color: rgba(var(--ux-danger-rgb), 0.3);
    }

    /* ========================================
       Dark Mode Support
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-banner {
        background-color: var(--ux-surface);
      }

      .ux-banner__close:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .ux-banner--glass .ux-banner__action:hover,
      .ux-banner--glass .ux-banner__close:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
    }

    .ux-dark .ux-banner {
      background-color: var(--ux-surface);
    }

    .ux-dark .ux-banner__close:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .ux-dark .ux-banner--glass .ux-banner__action:hover,
    .ux-dark .ux-banner--glass .ux-banner__close:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* ========================================
       Responsive Adjustments
    ======================================== */

    @media (max-width: 767px) {
      .ux-banner {
        --ux-banner-padding-x: var(--ux-space-md);
        --ux-banner-gap: var(--ux-space-sm);
      }

      .ux-banner__actions {
        flex-direction: column;
        align-items: flex-end;
      }
    }

    /* ========================================
       Reduced Motion Support
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-banner {
        transition: opacity 0.1s ease;
        transform: none !important;
      }

      .ux-banner--hidden {
        transform: none;
      }

      .ux-banner__action,
      .ux-banner__close {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-banner-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-banner-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for banner
  // ARIA: role="alert" or role="status" for announcements
  const bannerComponent = (config = {}) => ({
    visible: config.visible !== false,
    autoDismiss: config.autoDismiss || 0,
    _timer: null,
    bannerId: config.id || 'ux-banner-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for banner
    get ariaAttrs() {
      const isUrgent = config.type === 'danger' || config.type === 'warning';
      return {
        'role': isUrgent ? 'alert' : 'status',
        'aria-live': isUrgent ? 'assertive' : 'polite',
        'aria-atomic': 'true'
      };
    },

    init() {
      // Auto dismiss if configured
      if (this.autoDismiss > 0 && this.visible) {
        this._startAutoDismiss();
      }
    },

    destroy() {
      if (this._timer) {
        clearTimeout(this._timer);
        this._timer = null;
      }
    },

    _startAutoDismiss() {
      if (this._timer) {
        clearTimeout(this._timer);
      }
      this._timer = setTimeout(() => {
        this.dismiss();
      }, this.autoDismiss);
    },

    show(options = {}) {
      if (options.autoDismiss !== undefined) {
        this.autoDismiss = options.autoDismiss;
      }

      this.visible = true;
      this.$dispatch('banner:show', { id: this.bannerId });

      // Announce to screen readers
      if (window.UX && window.UX.announce) {
        const message = this.$el.querySelector('.ux-banner__message')?.textContent || '';
        const isUrgent = this.$el.classList.contains('ux-banner--danger') ||
                         this.$el.classList.contains('ux-banner--warning');
        window.UX.announce(message, isUrgent ? 'assertive' : 'polite');
      }

      // Start auto dismiss timer
      if (this.autoDismiss > 0) {
        this._startAutoDismiss();
      }
    },

    dismiss() {
      if (this._timer) {
        clearTimeout(this._timer);
        this._timer = null;
      }

      this.visible = false;
      this.$dispatch('banner:dismiss', { id: this.bannerId });
    },

    toggle() {
      if (this.visible) {
        this.dismiss();
      } else {
        this.show();
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxBanner', bannerComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxBanner', bannerComponent);
    });
  }
})();

(function() {
  'use strict';

  const styles = `
    :root {
      --ux-barcode-scanner-bg: var(--ux-gray-900);
      --ux-barcode-scanner-border-radius: var(--ux-radius-lg);
      --ux-barcode-scanner-overlay-color: rgba(0, 0, 0, 0.5);
      --ux-barcode-scanner-scan-line: var(--ux-primary);
    }

    .ux-barcode-scanner {
      position: relative;
      background: var(--ux-barcode-scanner-bg);
      border-radius: var(--ux-barcode-scanner-border-radius);
      overflow: hidden;
      aspect-ratio: 4/3;
      max-width: 100%;
    }

    .ux-barcode-scanner--fullscreen {
      position: fixed;
      inset: 0;
      z-index: var(--ux-z-modal);
      border-radius: 0;
      aspect-ratio: auto;
    }

    /* Video */
    .ux-barcode-scanner__video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Overlay */
    .ux-barcode-scanner__overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    /* Scan area frame */
    .ux-barcode-scanner__frame {
      position: relative;
      width: 70%;
      max-width: 300px;
      aspect-ratio: 1.5;
      border: 2px solid rgba(255, 255, 255, 0.5);
      border-radius: var(--ux-radius-md);
      box-shadow: 0 0 0 9999px var(--ux-barcode-scanner-overlay-color);
    }

    /* Corner markers */
    .ux-barcode-scanner__frame::before,
    .ux-barcode-scanner__frame::after,
    .ux-barcode-scanner__corners::before,
    .ux-barcode-scanner__corners::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-color: var(--ux-primary);
      border-style: solid;
      border-width: 0;
    }

    .ux-barcode-scanner__frame::before {
      top: -2px;
      left: -2px;
      border-top-width: 3px;
      border-left-width: 3px;
      border-top-left-radius: var(--ux-radius-md);
    }

    .ux-barcode-scanner__frame::after {
      top: -2px;
      right: -2px;
      border-top-width: 3px;
      border-right-width: 3px;
      border-top-right-radius: var(--ux-radius-md);
    }

    .ux-barcode-scanner__corners {
      position: absolute;
      inset: 0;
    }

    .ux-barcode-scanner__corners::before {
      bottom: -2px;
      left: -2px;
      border-bottom-width: 3px;
      border-left-width: 3px;
      border-bottom-left-radius: var(--ux-radius-md);
    }

    .ux-barcode-scanner__corners::after {
      bottom: -2px;
      right: -2px;
      border-bottom-width: 3px;
      border-right-width: 3px;
      border-bottom-right-radius: var(--ux-radius-md);
    }

    /* Scan line animation */
    .ux-barcode-scanner__scan-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(
        90deg,
        transparent,
        var(--ux-barcode-scanner-scan-line),
        transparent
      );
      animation: ux-scan-line 2s ease-in-out infinite;
    }

    @keyframes ux-scan-line {
      0%, 100% {
        top: 0;
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      50% {
        top: 100%;
        opacity: 1;
      }
      60% {
        opacity: 0;
      }
    }

    /* Instructions */
    .ux-barcode-scanner__instructions {
      position: absolute;
      bottom: -40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: var(--ux-font-size-sm);
      color: rgba(255, 255, 255, 0.8);
      text-align: center;
      white-space: nowrap;
    }

    /* Result display */
    .ux-barcode-scanner__result {
      position: absolute;
      bottom: var(--ux-space-lg);
      left: 50%;
      transform: translateX(-50%);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-success);
      color: white;
      border-radius: var(--ux-radius-full);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      animation: ux-scan-result 0.3s ease-out;
      pointer-events: auto;
    }

    @keyframes ux-scan-result {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .ux-barcode-scanner__result svg {
      width: 16px;
      height: 16px;
    }

    /* Controls */
    .ux-barcode-scanner__controls {
      position: absolute;
      top: var(--ux-space-md);
      right: var(--ux-space-md);
      display: flex;
      gap: var(--ux-space-sm);
      pointer-events: auto;
    }

    .ux-barcode-scanner__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border: none;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-barcode-scanner__btn:hover {
      background: rgba(0, 0, 0, 0.7);
    }

    .ux-barcode-scanner__btn:active {
      background: rgba(0, 0, 0, 0.8);
    }

    .ux-barcode-scanner__btn svg {
      width: 20px;
      height: 20px;
    }

    /* Close button for fullscreen */
    .ux-barcode-scanner__close {
      position: absolute;
      top: var(--ux-space-md);
      left: var(--ux-space-md);
      pointer-events: auto;
    }

    /* Loading state */
    .ux-barcode-scanner__loading {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-md);
      background: var(--ux-barcode-scanner-bg);
    }

    .ux-barcode-scanner__loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-scan-spin 0.8s linear infinite;
    }

    @keyframes ux-scan-spin {
      to { transform: rotate(360deg); }
    }

    .ux-barcode-scanner__loading-text {
      font-size: var(--ux-font-size-sm);
      color: rgba(255, 255, 255, 0.7);
    }

    /* Error state */
    .ux-barcode-scanner__error {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-md);
      background: var(--ux-barcode-scanner-bg);
      padding: var(--ux-space-xl);
      text-align: center;
    }

    .ux-barcode-scanner__error-icon {
      width: 48px;
      height: 48px;
      color: var(--ux-danger);
    }

    .ux-barcode-scanner__error-text {
      font-size: var(--ux-font-size-md);
      color: white;
    }

    .ux-barcode-scanner__error-hint {
      font-size: var(--ux-font-size-sm);
      color: rgba(255, 255, 255, 0.6);
    }

    /* Manual input fallback */
    .ux-barcode-scanner__manual {
      position: absolute;
      bottom: var(--ux-space-lg);
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: var(--ux-space-sm);
      pointer-events: auto;
    }

    .ux-barcode-scanner__manual-input {
      width: 200px;
      height: 40px;
      padding: 0 var(--ux-space-md);
      border: none;
      border-radius: var(--ux-radius-full);
      background: rgba(255, 255, 255, 0.9);
      font-size: var(--ux-font-size-md);
      color: var(--ux-gray-900);
    }

    .ux-barcode-scanner__manual-input::placeholder {
      color: var(--ux-gray-400);
    }

    .ux-barcode-scanner__manual-submit {
      height: 40px;
      padding: 0 var(--ux-space-md);
      border: none;
      border-radius: var(--ux-radius-full);
      background: var(--ux-primary);
      color: white;
      font-weight: 500;
      cursor: pointer;
      transition: opacity var(--ux-transition-fast);
    }

    .ux-barcode-scanner__manual-submit:hover {
      opacity: 0.9;
    }

    /* History */
    .ux-barcode-scanner__history {
      position: absolute;
      bottom: var(--ux-space-md);
      left: var(--ux-space-md);
      max-width: 200px;
      pointer-events: auto;
    }

    .ux-barcode-scanner__history-item {
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: rgba(0, 0, 0, 0.5);
      border-radius: var(--ux-radius-sm);
      font-size: var(--ux-font-size-xs);
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: var(--ux-space-xs);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Format badges */
    .ux-barcode-scanner__format {
      display: inline-block;
      padding: 2px 6px;
      background: var(--ux-primary-tint);
      color: var(--ux-primary);
      border-radius: var(--ux-radius-sm);
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      margin-right: var(--ux-space-xs);
    }

    /* Dark mode adjustments */
    @media (prefers-color-scheme: dark) {
      .ux-barcode-scanner__manual-input {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .ux-barcode-scanner__scan-line {
        animation: none;
        opacity: 1;
        top: 50%;
      }

      .ux-barcode-scanner__loading-spinner {
        animation: none;
      }

      .ux-barcode-scanner__result {
        animation: none;
      }
    }

    /* Mobile adjustments */
    @media (max-width: 767px) {
      .ux-barcode-scanner__frame {
        width: 85%;
      }

      .ux-barcode-scanner__manual {
        flex-direction: column;
        width: calc(100% - var(--ux-space-xl) * 2);
      }

      .ux-barcode-scanner__manual-input {
        width: 100%;
      }
    }
  `;

  if (window.UX) {
    window.UX.injectStyles('ux-barcode-scanner-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-barcode-scanner-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  const componentData = (options = {}) => ({
    // State
    isActive: false,
    isLoading: false,
    error: null,
    lastResult: null,
    isFullscreen: options.fullscreen ?? false,
    showManualInput: options.showManualInput ?? true,
    manualCode: '',
    history: [],
    maxHistory: options.maxHistory ?? 5,
    facingMode: 'environment', // 'environment' (back) or 'user' (front)
    torchOn: false,
    hasTorch: false,

    // Configuration
    formats: options.formats || ['ean_13', 'ean_8', 'upc_a', 'upc_e', 'code_128', 'code_39', 'code_93', 'codabar', 'qr_code', 'data_matrix'],
    continuous: options.continuous ?? false,
    beepOnScan: options.beepOnScan ?? true,
    vibrate: options.vibrate ?? true,

    // Internal
    stream: null,
    barcodeDetector: null,
    animationFrame: null,

    init() {
      // Check for BarcodeDetector API support
      if ('BarcodeDetector' in window) {
        this.start();
      } else {
        this.error = 'Barcode scanning is not supported in this browser. Please use manual input.';
      }
    },

    destroy() {
      this.stop();
    },

    async start() {
      this.isLoading = true;
      this.error = null;

      try {
        // Request camera access
        this.stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: this.facingMode,
            width: { ideal: 1280 },
            height: { ideal: 720 }
          }
        });

        // Set video source
        const video = this.$refs.video;
        video.srcObject = this.stream;
        await video.play();

        // Check for torch support
        const track = this.stream.getVideoTracks()[0];
        const capabilities = track.getCapabilities?.() || {};
        this.hasTorch = capabilities.torch || false;

        // Create barcode detector
        this.barcodeDetector = new BarcodeDetector({
          formats: this.formats
        });

        this.isActive = true;
        this.isLoading = false;

        // Start scanning
        this.scan();

        this.$dispatch('scanner:started');
      } catch (err) {
        this.isLoading = false;
        if (err.name === 'NotAllowedError') {
          this.error = 'Camera access denied. Please allow camera permissions.';
        } else if (err.name === 'NotFoundError') {
          this.error = 'No camera found on this device.';
        } else {
          this.error = err.message || 'Failed to start camera.';
        }
        this.$dispatch('scanner:error', { error: this.error });
      }
    },

    stop() {
      this.isActive = false;

      if (this.animationFrame) {
        cancelAnimationFrame(this.animationFrame);
        this.animationFrame = null;
      }

      if (this.stream) {
        this.stream.getTracks().forEach(track => track.stop());
        this.stream = null;
      }

      this.$dispatch('scanner:stopped');
    },

    async scan() {
      if (!this.isActive || !this.barcodeDetector) return;

      const video = this.$refs.video;

      try {
        const barcodes = await this.barcodeDetector.detect(video);

        if (barcodes.length > 0) {
          const barcode = barcodes[0];
          this.onDetected(barcode);

          if (!this.continuous) {
            return;
          }
        }
      } catch (err) {
        // Silently ignore detection errors
      }

      this.animationFrame = requestAnimationFrame(() => this.scan());
    },

    onDetected(barcode) {
      const result = {
        rawValue: barcode.rawValue,
        format: barcode.format,
        timestamp: new Date().toISOString()
      };

      this.lastResult = result;

      // Add to history
      this.history.unshift(result);
      if (this.history.length > this.maxHistory) {
        this.history.pop();
      }

      // Feedback
      if (this.beepOnScan) {
        this.playBeep();
      }

      if (this.vibrate && navigator.vibrate) {
        navigator.vibrate(100);
      }

      this.$dispatch('scanner:detected', result);

      // Clear result after delay
      setTimeout(() => {
        this.lastResult = null;
      }, 2000);
    },

    playBeep() {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.frequency.value = 1800;
        oscillator.type = 'sine';

        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);

        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      } catch (err) {
        // Silently ignore audio errors
      }
    },

    async toggleCamera() {
      this.facingMode = this.facingMode === 'environment' ? 'user' : 'environment';
      this.stop();
      await this.start();
    },

    async toggleTorch() {
      if (!this.hasTorch || !this.stream) return;

      const track = this.stream.getVideoTracks()[0];
      this.torchOn = !this.torchOn;

      try {
        await track.applyConstraints({
          advanced: [{ torch: this.torchOn }]
        });
      } catch (err) {
        console.error('Failed to toggle torch:', err);
      }
    },

    submitManual() {
      if (!this.manualCode.trim()) return;

      const result = {
        rawValue: this.manualCode.trim(),
        format: 'manual',
        timestamp: new Date().toISOString()
      };

      this.lastResult = result;
      this.manualCode = '';

      // Add to history
      this.history.unshift(result);
      if (this.history.length > this.maxHistory) {
        this.history.pop();
      }

      this.$dispatch('scanner:detected', result);

      setTimeout(() => {
        this.lastResult = null;
      }, 2000);
    },

    toggleFullscreen() {
      this.isFullscreen = !this.isFullscreen;

      if (this.isFullscreen) {
        window.UX?.lockScroll();
      } else {
        window.UX?.unlockScroll();
      }
    },

    close() {
      this.stop();
      if (this.isFullscreen) {
        this.isFullscreen = false;
        window.UX?.unlockScroll();
      }
      this.$dispatch('scanner:close');
    },

    formatLabel(format) {
      const labels = {
        'ean_13': 'EAN-13',
        'ean_8': 'EAN-8',
        'upc_a': 'UPC-A',
        'upc_e': 'UPC-E',
        'code_128': 'Code 128',
        'code_39': 'Code 39',
        'code_93': 'Code 93',
        'codabar': 'Codabar',
        'qr_code': 'QR',
        'data_matrix': 'Data Matrix',
        'manual': 'Manual'
      };
      return labels[format] || format;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxBarcodeScanner', componentData);
  }
})();

/**
 * UX Batch Tracker Component
 * Manufacturing batch/lot tracking with status timeline and traceability
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       UX Batch Tracker - Variables
       ========================================================================== */

    :root {
      --ux-batch-tracker-radius: var(--ux-radius-lg);
      --ux-batch-tracker-padding: var(--ux-space-lg);
      --ux-batch-tracker-gap: var(--ux-space-md);
      --ux-batch-tracker-timeline-line: 2px;
      --ux-batch-tracker-marker-size: 24px;
      --ux-batch-tracker-marker-size-lg: 32px;
    }

    /* ==========================================================================
       Batch Card - Main Container
       ========================================================================== */

    .ux-batch-card {
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-batch-tracker-radius);
      padding: var(--ux-batch-tracker-padding);
      font-family: var(--ux-font-family);
    }

    .ux-batch-card__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--ux-space-md);
      margin-bottom: var(--ux-space-lg);
    }

    .ux-batch-card__title-group {
      flex: 1;
      min-width: 0;
    }

    .ux-batch-card__batch-number {
      font-size: var(--ux-font-size-xl);
      font-weight: 700;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
      font-family: var(--ux-font-mono, 'SF Mono', 'Fira Code', monospace);
      letter-spacing: 0.5px;
    }

    .ux-batch-card__product-name {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    .ux-batch-card__qr {
      flex-shrink: 0;
      width: 64px;
      height: 64px;
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-xs);
    }

    .ux-batch-card__qr svg,
    .ux-batch-card__qr img {
      width: 100%;
      height: 100%;
    }

    .ux-batch-card__body {
      display: flex;
      flex-direction: column;
      gap: var(--ux-batch-tracker-gap);
    }

    .ux-batch-card__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      margin-top: var(--ux-space-lg);
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    /* ==========================================================================
       Batch Status Badge
       ========================================================================== */

    .ux-batch-status {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-radius: 999px;
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-batch-status__dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: ux-batch-pulse 2s infinite;
    }

    @keyframes ux-batch-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .ux-batch-status--created {
      background: rgba(var(--ux-gray-500-rgb, 107, 114, 128), 0.15);
      color: var(--ux-gray-600);
    }
    .ux-batch-status--created .ux-batch-status__dot { background: var(--ux-gray-500); animation: none; }

    .ux-batch-status--in-progress {
      background: rgba(var(--ux-primary-rgb), 0.15);
      color: var(--ux-primary);
    }
    .ux-batch-status--in-progress .ux-batch-status__dot { background: var(--ux-primary); }

    .ux-batch-status--qc {
      background: rgba(var(--ux-warning-rgb), 0.15);
      color: var(--ux-warning-shade, #d97706);
    }
    .ux-batch-status--qc .ux-batch-status__dot { background: var(--ux-warning); }

    .ux-batch-status--completed {
      background: rgba(var(--ux-success-rgb), 0.15);
      color: var(--ux-success);
    }
    .ux-batch-status--completed .ux-batch-status__dot { background: var(--ux-success); animation: none; }

    .ux-batch-status--shipped {
      background: rgba(var(--ux-cyan-500-rgb, 6, 182, 212), 0.15);
      color: var(--ux-cyan-600, #0891b2);
    }
    .ux-batch-status--shipped .ux-batch-status__dot { background: var(--ux-cyan-500, #06b6d4); animation: none; }

    .ux-batch-status--rejected {
      background: rgba(var(--ux-danger-rgb), 0.15);
      color: var(--ux-danger);
    }
    .ux-batch-status--rejected .ux-batch-status__dot { background: var(--ux-danger); animation: none; }

    .ux-batch-status--quarantine {
      background: rgba(var(--ux-purple-500-rgb, 139, 92, 246), 0.15);
      color: var(--ux-purple-600, #7c3aed);
    }
    .ux-batch-status--quarantine .ux-batch-status__dot { background: var(--ux-purple-500, #8b5cf6); }

    /* ==========================================================================
       Batch Info Grid
       ========================================================================== */

    .ux-batch-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: var(--ux-space-md);
    }

    .ux-batch-info__item {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-2xs, 2px);
    }

    .ux-batch-info__label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-batch-info__value {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-batch-info__value--mono {
      font-family: var(--ux-font-mono, 'SF Mono', 'Fira Code', monospace);
    }

    .ux-batch-info__value--danger {
      color: var(--ux-danger);
    }

    .ux-batch-info__value--warning {
      color: var(--ux-warning-shade, #d97706);
    }

    .ux-batch-info__value--success {
      color: var(--ux-success);
    }

    /* ==========================================================================
       Quantity Tracking
       ========================================================================== */

    .ux-batch-quantity {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-batch-quantity__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .ux-batch-quantity__title {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-batch-quantity__values {
      display: flex;
      gap: var(--ux-space-lg);
      font-size: var(--ux-font-size-sm);
    }

    .ux-batch-quantity__stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .ux-batch-quantity__stat-value {
      font-size: var(--ux-font-size-lg);
      font-weight: 700;
      font-family: var(--ux-font-mono, 'SF Mono', 'Fira Code', monospace);
    }

    .ux-batch-quantity__stat-value--initial { color: var(--ux-text); }
    .ux-batch-quantity__stat-value--current { color: var(--ux-primary); }
    .ux-batch-quantity__stat-value--rejected { color: var(--ux-danger); }
    .ux-batch-quantity__stat-value--yield { color: var(--ux-success); }

    .ux-batch-quantity__stat-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-batch-quantity__bar {
      height: 8px;
      background: var(--ux-surface-secondary);
      border-radius: 999px;
      overflow: hidden;
      display: flex;
    }

    .ux-batch-quantity__bar-segment {
      height: 100%;
      transition: width var(--ux-transition-normal);
    }

    .ux-batch-quantity__bar-segment--good {
      background: var(--ux-success);
    }

    .ux-batch-quantity__bar-segment--rejected {
      background: var(--ux-danger);
    }

    .ux-batch-quantity__bar-segment--remaining {
      background: var(--ux-border-color);
    }

    /* ==========================================================================
       Expiry Indicator
       ========================================================================== */

    .ux-batch-expiry {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
    }

    .ux-batch-expiry__icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .ux-batch-expiry__content {
      flex: 1;
    }

    .ux-batch-expiry__label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-batch-expiry__date {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-batch-expiry__days {
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      padding: 2px 8px;
      border-radius: 999px;
    }

    .ux-batch-expiry--ok .ux-batch-expiry__icon { color: var(--ux-success); }
    .ux-batch-expiry--ok .ux-batch-expiry__days { background: rgba(var(--ux-success-rgb), 0.15); color: var(--ux-success); }

    .ux-batch-expiry--warning .ux-batch-expiry__icon { color: var(--ux-warning); }
    .ux-batch-expiry--warning .ux-batch-expiry__days { background: rgba(var(--ux-warning-rgb), 0.15); color: var(--ux-warning-shade, #d97706); }

    .ux-batch-expiry--danger .ux-batch-expiry__icon { color: var(--ux-danger); }
    .ux-batch-expiry--danger .ux-batch-expiry__days { background: rgba(var(--ux-danger-rgb), 0.15); color: var(--ux-danger); }

    .ux-batch-expiry--expired .ux-batch-expiry__icon { color: var(--ux-danger); }
    .ux-batch-expiry--expired .ux-batch-expiry__date { color: var(--ux-danger); text-decoration: line-through; }
    .ux-batch-expiry--expired .ux-batch-expiry__days { background: var(--ux-danger); color: white; }

    /* ==========================================================================
       Status Timeline
       ========================================================================== */

    .ux-batch-timeline {
      position: relative;
      padding-left: calc(var(--ux-batch-tracker-marker-size) / 2 + var(--ux-space-lg));
    }

    .ux-batch-timeline::before {
      content: '';
      position: absolute;
      left: calc(var(--ux-batch-tracker-marker-size) / 2 - 1px);
      top: var(--ux-batch-tracker-marker-size);
      bottom: var(--ux-batch-tracker-marker-size);
      width: var(--ux-batch-tracker-timeline-line);
      background: var(--ux-border-color);
    }

    .ux-batch-timeline--horizontal {
      display: flex;
      padding-left: 0;
      padding-top: calc(var(--ux-batch-tracker-marker-size) / 2 + var(--ux-space-md));
      overflow-x: auto;
      gap: 0;
    }

    .ux-batch-timeline--horizontal::before {
      left: var(--ux-batch-tracker-marker-size);
      right: var(--ux-batch-tracker-marker-size);
      top: calc(var(--ux-batch-tracker-marker-size) / 2 - 1px);
      bottom: auto;
      width: auto;
      height: var(--ux-batch-tracker-timeline-line);
    }

    .ux-batch-timeline__item {
      position: relative;
      padding-bottom: var(--ux-space-lg);
    }

    .ux-batch-timeline__item:last-child {
      padding-bottom: 0;
    }

    .ux-batch-timeline--horizontal .ux-batch-timeline__item {
      flex: 0 0 auto;
      min-width: 120px;
      padding-bottom: 0;
      padding-right: var(--ux-space-lg);
      text-align: center;
    }

    .ux-batch-timeline--horizontal .ux-batch-timeline__item:last-child {
      padding-right: 0;
    }

    .ux-batch-timeline__marker {
      position: absolute;
      left: calc(-1 * var(--ux-batch-tracker-marker-size) / 2 - var(--ux-space-lg));
      top: 0;
      width: var(--ux-batch-tracker-marker-size);
      height: var(--ux-batch-tracker-marker-size);
      border-radius: 50%;
      background: var(--ux-surface);
      border: 2px solid var(--ux-border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
    }

    .ux-batch-timeline--horizontal .ux-batch-timeline__marker {
      left: 50%;
      top: calc(-1 * var(--ux-batch-tracker-marker-size) / 2 - var(--ux-space-md));
      transform: translateX(-50%);
    }

    .ux-batch-timeline__marker svg {
      width: 14px;
      height: 14px;
      color: var(--ux-text-tertiary);
    }

    .ux-batch-timeline__item--completed .ux-batch-timeline__marker {
      background: var(--ux-success);
      border-color: var(--ux-success);
    }

    .ux-batch-timeline__item--completed .ux-batch-timeline__marker svg {
      color: white;
    }

    .ux-batch-timeline__item--active .ux-batch-timeline__marker {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 4px rgba(var(--ux-primary-rgb), 0.2);
    }

    .ux-batch-timeline__item--active .ux-batch-timeline__marker svg {
      color: white;
    }

    .ux-batch-timeline__item--error .ux-batch-timeline__marker {
      background: var(--ux-danger);
      border-color: var(--ux-danger);
    }

    .ux-batch-timeline__item--error .ux-batch-timeline__marker svg {
      color: white;
    }

    .ux-batch-timeline__content {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ux-batch-timeline__title {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-batch-timeline__item--pending .ux-batch-timeline__title {
      color: var(--ux-text-tertiary);
    }

    .ux-batch-timeline__time {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-batch-timeline__description {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    /* ==========================================================================
       Location/Warehouse Info
       ========================================================================== */

    .ux-batch-location {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
    }

    .ux-batch-location__icon {
      width: 20px;
      height: 20px;
      color: var(--ux-text-secondary);
    }

    .ux-batch-location__content {
      flex: 1;
    }

    .ux-batch-location__name {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-batch-location__details {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
    }

    /* ==========================================================================
       Parent/Child Relationships
       ========================================================================== */

    .ux-batch-relations {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-batch-relations__title {
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-batch-relations__list {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
    }

    .ux-batch-relations__item {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
      font-size: var(--ux-font-size-xs);
      font-family: var(--ux-font-mono, 'SF Mono', 'Fira Code', monospace);
      color: var(--ux-text);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-batch-relations__item:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-batch-relations__item svg {
      width: 12px;
      height: 12px;
      color: var(--ux-text-secondary);
    }

    .ux-batch-relations__item--parent {
      border-left: 3px solid var(--ux-primary);
    }

    .ux-batch-relations__item--child {
      border-left: 3px solid var(--ux-success);
    }

    /* ==========================================================================
       Traceability Links
       ========================================================================== */

    .ux-batch-trace {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-batch-trace__title {
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-batch-trace__list {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
    }

    .ux-batch-trace__item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-batch-trace__item:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-batch-trace__item-info {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-batch-trace__item-icon {
      width: 20px;
      height: 20px;
      color: var(--ux-text-secondary);
    }

    .ux-batch-trace__item-label {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
    }

    .ux-batch-trace__item-value {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      font-family: var(--ux-font-mono, 'SF Mono', 'Fira Code', monospace);
      color: var(--ux-primary);
    }

    /* ==========================================================================
       History Log
       ========================================================================== */

    .ux-batch-history {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-batch-history__title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-batch-history__list {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
      max-height: 300px;
      overflow-y: auto;
    }

    .ux-batch-history__item {
      display: flex;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
      font-size: var(--ux-font-size-xs);
    }

    .ux-batch-history__item-time {
      flex-shrink: 0;
      width: 120px;
      color: var(--ux-text-tertiary);
      font-family: var(--ux-font-mono, 'SF Mono', 'Fira Code', monospace);
    }

    .ux-batch-history__item-action {
      flex: 1;
      color: var(--ux-text);
    }

    .ux-batch-history__item-user {
      flex-shrink: 0;
      color: var(--ux-text-secondary);
    }

    /* ==========================================================================
       Search/Filter
       ========================================================================== */

    .ux-batch-search {
      display: flex;
      gap: var(--ux-space-sm);
      margin-bottom: var(--ux-space-lg);
    }

    .ux-batch-search__input {
      flex: 1;
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
    }

    .ux-batch-search__input:focus-within {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-batch-search__input svg {
      width: 18px;
      height: 18px;
      color: var(--ux-text-tertiary);
      flex-shrink: 0;
    }

    .ux-batch-search__input input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      outline: none;
    }

    .ux-batch-search__input input::placeholder {
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       Batch List
       ========================================================================== */

    .ux-batch-list {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-batch-list__item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-batch-list__item:hover {
      border-color: var(--ux-primary);
      box-shadow: var(--ux-shadow-sm);
    }

    .ux-batch-list__item-main {
      flex: 1;
      min-width: 0;
    }

    .ux-batch-list__item-batch {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      font-family: var(--ux-font-mono, 'SF Mono', 'Fira Code', monospace);
      color: var(--ux-text);
    }

    .ux-batch-list__item-product {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-batch-list__item-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
    }

    .ux-batch-list__item-qty {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-batch-list__item-date {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-batch-card--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-batch-card--glass .ux-batch-card__qr,
    .ux-batch-card--glass .ux-batch-info__item,
    .ux-batch-card--glass .ux-batch-location,
    .ux-batch-card--glass .ux-batch-expiry,
    .ux-batch-card--glass .ux-batch-relations__item,
    .ux-batch-card--glass .ux-batch-trace__item,
    .ux-batch-card--glass .ux-batch-history__item {
      background: var(--ux-glass-bg-thin, rgba(255, 255, 255, 0.5));
    }

    /* Universal glass selector */
    [class*="--glass"].ux-batch-card {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      .ux-batch-status--created {
        background: rgba(156, 163, 175, 0.2);
        color: var(--ux-gray-400);
      }

      .ux-batch-status--shipped {
        background: rgba(6, 182, 212, 0.2);
      }

      .ux-batch-status--quarantine {
        background: rgba(139, 92, 246, 0.2);
      }
    }

    .ux-dark .ux-batch-status--created {
      background: rgba(156, 163, 175, 0.2);
      color: var(--ux-gray-400);
    }

    .ux-dark .ux-batch-status--shipped {
      background: rgba(6, 182, 212, 0.2);
    }

    .ux-dark .ux-batch-status--quarantine {
      background: rgba(139, 92, 246, 0.2);
    }

    /* ==========================================================================
       Responsive
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-batch-card__header {
        flex-direction: column;
        align-items: stretch;
      }

      .ux-batch-card__qr {
        align-self: center;
        margin-bottom: var(--ux-space-sm);
        order: -1;
      }

      .ux-batch-info {
        grid-template-columns: repeat(2, 1fr);
      }

      .ux-batch-quantity__values {
        flex-wrap: wrap;
        justify-content: center;
      }

      .ux-batch-timeline--horizontal {
        padding-top: calc(var(--ux-batch-tracker-marker-size) + var(--ux-space-sm));
      }

      .ux-batch-timeline--horizontal .ux-batch-timeline__item {
        min-width: 100px;
      }
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-batch-status__dot {
        animation: none;
      }

      .ux-batch-quantity__bar-segment {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-batch-tracker-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-batch-tracker-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const batchTrackerData = (options = {}) => ({
    // Batch identification
    batchNumber: options.batchNumber || '',
    lotNumber: options.lotNumber || '',
    productName: options.productName || '',
    productSku: options.productSku || '',

    // Status
    status: options.status || 'created', // created, in-progress, qc, completed, shipped, rejected, quarantine
    statusHistory: options.statusHistory || [],

    // Quantities
    initialQuantity: options.initialQuantity || 0,
    currentQuantity: options.currentQuantity || 0,
    rejectedQuantity: options.rejectedQuantity || 0,
    unit: options.unit || 'units',

    // Dates
    createdAt: options.createdAt || null,
    expiryDate: options.expiryDate || null,
    manufacturedDate: options.manufacturedDate || null,

    // Location
    location: options.location || null, // { name, zone, shelf, bin }

    // Relationships
    parentBatches: options.parentBatches || [], // [{ number, product }]
    childBatches: options.childBatches || [],

    // Traceability
    traceLinks: options.traceLinks || [], // [{ type, label, value, url }]

    // History log
    history: options.history || [], // [{ timestamp, action, user, details }]

    // Timeline steps
    timelineSteps: options.timelineSteps || [
      { id: 'created', title: 'Created', icon: 'plus' },
      { id: 'in-progress', title: 'In Progress', icon: 'cog' },
      { id: 'qc', title: 'QC Check', icon: 'check-circle' },
      { id: 'completed', title: 'Completed', icon: 'package' },
      { id: 'shipped', title: 'Shipped', icon: 'truck' }
    ],

    // Search
    searchQuery: '',
    batches: options.batches || [],
    filteredBatches: [],

    // QR code
    showQR: options.showQR ?? true,
    qrData: options.qrData || null,

    init() {
      this.filteredBatches = [...this.batches];
      this.$watch('searchQuery', () => this.filterBatches());
    },

    // Computed properties
    get yieldPercentage() {
      if (this.initialQuantity === 0) return 0;
      return ((this.currentQuantity / this.initialQuantity) * 100).toFixed(1);
    },

    get rejectedPercentage() {
      if (this.initialQuantity === 0) return 0;
      return ((this.rejectedQuantity / this.initialQuantity) * 100).toFixed(1);
    },

    get daysUntilExpiry() {
      if (!this.expiryDate) return null;
      const expiry = new Date(this.expiryDate);
      const today = new Date();
      const diff = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
      return diff;
    },

    get expiryStatus() {
      const days = this.daysUntilExpiry;
      if (days === null) return 'none';
      if (days < 0) return 'expired';
      if (days <= 7) return 'danger';
      if (days <= 30) return 'warning';
      return 'ok';
    },

    get statusIndex() {
      const statusOrder = ['created', 'in-progress', 'qc', 'completed', 'shipped'];
      return statusOrder.indexOf(this.status);
    },

    // Methods
    getStatusLabel(status) {
      const labels = {
        'created': 'Created',
        'in-progress': 'In Progress',
        'qc': 'Quality Check',
        'completed': 'Completed',
        'shipped': 'Shipped',
        'rejected': 'Rejected',
        'quarantine': 'Quarantine'
      };
      return labels[status] || status;
    },

    isStepCompleted(stepIndex) {
      return stepIndex < this.statusIndex;
    },

    isStepActive(stepIndex) {
      return stepIndex === this.statusIndex;
    },

    isStepPending(stepIndex) {
      return stepIndex > this.statusIndex;
    },

    getStepState(stepIndex) {
      if (this.status === 'rejected' && stepIndex === this.statusIndex) return 'error';
      if (this.isStepCompleted(stepIndex)) return 'completed';
      if (this.isStepActive(stepIndex)) return 'active';
      return 'pending';
    },

    formatDate(date) {
      if (!date) return '-';
      return new Date(date).toLocaleDateString('es-ES', {
        day: '2-digit',
        month: 'short',
        year: 'numeric'
      });
    },

    formatDateTime(date) {
      if (!date) return '-';
      return new Date(date).toLocaleString('es-ES', {
        day: '2-digit',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    },

    filterBatches() {
      const query = this.searchQuery.toLowerCase().trim();
      if (!query) {
        this.filteredBatches = [...this.batches];
        return;
      }

      this.filteredBatches = this.batches.filter(batch => {
        return (
          batch.batchNumber?.toLowerCase().includes(query) ||
          batch.lotNumber?.toLowerCase().includes(query) ||
          batch.productName?.toLowerCase().includes(query) ||
          batch.productSku?.toLowerCase().includes(query)
        );
      });
    },

    selectBatch(batch) {
      this.$dispatch('batch:select', { batch });
    },

    viewParentBatch(batch) {
      this.$dispatch('batch:view-parent', { batch });
    },

    viewChildBatch(batch) {
      this.$dispatch('batch:view-child', { batch });
    },

    viewTraceLink(link) {
      this.$dispatch('batch:trace', { link });
    },

    updateStatus(newStatus) {
      const oldStatus = this.status;
      this.status = newStatus;
      this.statusHistory.push({
        from: oldStatus,
        to: newStatus,
        timestamp: new Date().toISOString()
      });
      this.$dispatch('batch:status-change', { oldStatus, newStatus });
    },

    addHistoryEntry(action, user = 'System', details = '') {
      this.history.unshift({
        timestamp: new Date().toISOString(),
        action,
        user,
        details
      });
      this.$dispatch('batch:history-add', { action, user, details });
    },

    generateQRData() {
      return JSON.stringify({
        batch: this.batchNumber,
        lot: this.lotNumber,
        product: this.productSku,
        expiry: this.expiryDate
      });
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxBatchTracker', batchTrackerData);
  }

})();

/**
 * UX BOM Tree Component
 * Bill of Materials hierarchical tree view for manufacturing
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       BOM Tree Variables
       ========================================================================== */

    :root {
      --ux-bom-tree-font-size: var(--ux-font-size-md);
      --ux-bom-tree-item-height: 48px;
      --ux-bom-tree-item-padding: var(--ux-space-sm) var(--ux-space-md);
      --ux-bom-tree-indent: 28px;
      --ux-bom-tree-border-radius: var(--ux-radius-lg);

      /* Level indicators */
      --ux-bom-tree-level-width: 3px;
      --ux-bom-tree-level-gap: var(--ux-space-xs);

      /* Icons */
      --ux-bom-tree-icon-size: 20px;
      --ux-bom-tree-toggle-size: 20px;

      /* Type colors */
      --ux-bom-type-raw: var(--ux-amber-500);
      --ux-bom-type-raw-bg: var(--ux-amber-50);
      --ux-bom-type-subassembly: var(--ux-blue-500);
      --ux-bom-type-subassembly-bg: var(--ux-blue-50);
      --ux-bom-type-finished: var(--ux-green-500);
      --ux-bom-type-finished-bg: var(--ux-green-50);
      --ux-bom-type-consumable: var(--ux-purple-500);
      --ux-bom-type-consumable-bg: var(--ux-purple-50);
      --ux-bom-type-packaging: var(--ux-gray-500);
      --ux-bom-type-packaging-bg: var(--ux-gray-100);
    }

    /* ==========================================================================
       BOM Tree Base
       ========================================================================== */

    .ux-bom-tree {
      font-family: var(--ux-font-family);
      font-size: var(--ux-bom-tree-font-size);
      color: var(--ux-text);
      background: var(--ux-surface);
      border-radius: var(--ux-bom-tree-border-radius);
      overflow: hidden;
    }

    .ux-bom-tree--bordered {
      border: 1px solid var(--ux-border-color);
    }

    /* ==========================================================================
       BOM Tree Header / Toolbar
       ========================================================================== */

    .ux-bom-tree__header {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
      border-bottom: 1px solid var(--ux-border-color);
      background: var(--ux-surface-secondary);
    }

    .ux-bom-tree__title {
      font-weight: 600;
      font-size: var(--ux-font-size-lg);
      flex: 1;
    }

    .ux-bom-tree__actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-bom-tree__action {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border: none;
      background: transparent;
      color: var(--ux-text-secondary);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease-default);
    }

    .ux-bom-tree__action:hover {
      background: var(--ux-surface-tertiary);
      color: var(--ux-text);
    }

    .ux-bom-tree__action:active {
      transform: scale(0.95);
    }

    .ux-bom-tree__action svg {
      width: 18px;
      height: 18px;
    }

    /* ==========================================================================
       BOM Tree Search
       ========================================================================== */

    .ux-bom-tree__search {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      border-bottom: 1px solid var(--ux-border-color);
      background: var(--ux-surface);
    }

    .ux-bom-tree__search-input {
      flex: 1;
      height: 36px;
      padding: 0 var(--ux-space-sm);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      background: var(--ux-surface);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      outline: none;
      transition: border-color var(--ux-transition-fast);
    }

    .ux-bom-tree__search-input:focus {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px var(--ux-primary-tint);
    }

    .ux-bom-tree__search-input::placeholder {
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       BOM Tree List
       ========================================================================== */

    .ux-bom-tree__list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .ux-bom-tree__list--nested {
      padding-left: var(--ux-bom-tree-indent);
    }

    /* ==========================================================================
       BOM Tree Node / Item
       ========================================================================== */

    .ux-bom-tree__node {
      margin: 0;
      padding: 0;
    }

    .ux-bom-tree__item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      min-height: var(--ux-bom-tree-item-height);
      padding: var(--ux-bom-tree-item-padding);
      border-bottom: 1px solid var(--ux-border-color);
      cursor: pointer;
      transition: background var(--ux-transition-fast) var(--ux-ease-default);
      position: relative;
    }

    .ux-bom-tree__item:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-bom-tree__item:active {
      background: var(--ux-surface-tertiary);
    }

    .ux-bom-tree__item--selected {
      background: var(--ux-primary-tint);
    }

    .ux-bom-tree__item--selected:hover {
      background: var(--ux-primary-tint);
    }

    .ux-bom-tree__item--highlight {
      background: var(--ux-warning-tint);
    }

    .ux-bom-tree__item--dragging {
      opacity: 0.5;
    }

    .ux-bom-tree__item--drag-over {
      background: var(--ux-primary-tint);
      outline: 2px dashed var(--ux-primary);
      outline-offset: -2px;
    }

    /* ==========================================================================
       Toggle Arrow
       ========================================================================== */

    .ux-bom-tree__toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-bom-tree-toggle-size);
      height: var(--ux-bom-tree-toggle-size);
      flex-shrink: 0;
      color: var(--ux-text-tertiary);
      transition: transform var(--ux-transition-fast) var(--ux-ease-out);
    }

    .ux-bom-tree__toggle svg {
      width: 14px;
      height: 14px;
    }

    .ux-bom-tree__toggle--expanded {
      transform: rotate(90deg);
    }

    .ux-bom-tree__toggle--empty {
      visibility: hidden;
    }

    /* ==========================================================================
       Level Indicator
       ========================================================================== */

    .ux-bom-tree__level {
      display: flex;
      align-items: center;
      gap: var(--ux-bom-tree-level-gap);
      flex-shrink: 0;
    }

    .ux-bom-tree__level-bar {
      width: var(--ux-bom-tree-level-width);
      height: 24px;
      border-radius: 2px;
      background: var(--ux-border-color);
    }

    .ux-bom-tree__level-bar--l1 { background: var(--ux-primary); }
    .ux-bom-tree__level-bar--l2 { background: var(--ux-success); }
    .ux-bom-tree__level-bar--l3 { background: var(--ux-warning); }
    .ux-bom-tree__level-bar--l4 { background: var(--ux-danger); }
    .ux-bom-tree__level-bar--l5 { background: var(--ux-purple-500); }

    /* ==========================================================================
       Component Type Icon
       ========================================================================== */

    .ux-bom-tree__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      flex-shrink: 0;
      border-radius: var(--ux-radius-md);
      background: var(--ux-surface-tertiary);
      color: var(--ux-text-secondary);
    }

    .ux-bom-tree__icon svg {
      width: var(--ux-bom-tree-icon-size);
      height: var(--ux-bom-tree-icon-size);
    }

    /* Type-based icon colors */
    .ux-bom-tree__icon--raw {
      background: var(--ux-bom-type-raw-bg);
      color: var(--ux-bom-type-raw);
    }

    .ux-bom-tree__icon--subassembly {
      background: var(--ux-bom-type-subassembly-bg);
      color: var(--ux-bom-type-subassembly);
    }

    .ux-bom-tree__icon--finished {
      background: var(--ux-bom-type-finished-bg);
      color: var(--ux-bom-type-finished);
    }

    .ux-bom-tree__icon--consumable {
      background: var(--ux-bom-type-consumable-bg);
      color: var(--ux-bom-type-consumable);
    }

    .ux-bom-tree__icon--packaging {
      background: var(--ux-bom-type-packaging-bg);
      color: var(--ux-bom-type-packaging);
    }

    /* ==========================================================================
       Component Details
       ========================================================================== */

    .ux-bom-tree__details {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ux-bom-tree__name {
      font-weight: 500;
      color: var(--ux-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-bom-tree__sku {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      font-family: var(--ux-font-mono);
    }

    /* ==========================================================================
       Quantity
       ========================================================================== */

    .ux-bom-tree__quantity {
      display: flex;
      align-items: baseline;
      gap: var(--ux-space-xs);
      flex-shrink: 0;
      min-width: 70px;
      justify-content: flex-end;
    }

    .ux-bom-tree__qty-value {
      font-weight: 600;
      font-size: var(--ux-font-size-md);
      font-variant-numeric: tabular-nums;
      color: var(--ux-text);
    }

    .ux-bom-tree__qty-unit {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
    }

    /* ==========================================================================
       Stock Status
       ========================================================================== */

    .ux-bom-tree__stock {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      flex-shrink: 0;
      min-width: 90px;
    }

    .ux-bom-tree__stock-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .ux-bom-tree__stock--in-stock .ux-bom-tree__stock-dot {
      background: var(--ux-success);
    }

    .ux-bom-tree__stock--low-stock .ux-bom-tree__stock-dot {
      background: var(--ux-warning);
      animation: ux-bom-pulse 2s ease-in-out infinite;
    }

    .ux-bom-tree__stock--out-of-stock .ux-bom-tree__stock-dot {
      background: var(--ux-danger);
    }

    .ux-bom-tree__stock-text {
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
    }

    .ux-bom-tree__stock--in-stock .ux-bom-tree__stock-text {
      color: var(--ux-success);
    }

    .ux-bom-tree__stock--low-stock .ux-bom-tree__stock-text {
      color: var(--ux-warning);
    }

    .ux-bom-tree__stock--out-of-stock .ux-bom-tree__stock-text {
      color: var(--ux-danger);
    }

    @keyframes ux-bom-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* ==========================================================================
       Cost Display
       ========================================================================== */

    .ux-bom-tree__cost {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      flex-shrink: 0;
      min-width: 80px;
    }

    .ux-bom-tree__cost-value {
      font-weight: 600;
      font-size: var(--ux-font-size-md);
      font-variant-numeric: tabular-nums;
      color: var(--ux-text);
    }

    .ux-bom-tree__cost-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-bom-tree__cost--total {
      background: var(--ux-primary-tint);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-radius: var(--ux-radius-sm);
    }

    .ux-bom-tree__cost--total .ux-bom-tree__cost-value {
      color: var(--ux-primary);
    }

    /* ==========================================================================
       Footer / Summary
       ========================================================================== */

    .ux-bom-tree__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
      background: var(--ux-surface-secondary);
    }

    .ux-bom-tree__summary {
      display: flex;
      gap: var(--ux-space-lg);
    }

    .ux-bom-tree__summary-item {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ux-bom-tree__summary-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-bom-tree__summary-value {
      font-weight: 600;
      font-size: var(--ux-font-size-lg);
      font-variant-numeric: tabular-nums;
    }

    /* ==========================================================================
       Empty State
       ========================================================================== */

    .ux-bom-tree__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-2xl);
      color: var(--ux-text-tertiary);
      text-align: center;
    }

    .ux-bom-tree__empty-icon {
      width: 64px;
      height: 64px;
      margin-bottom: var(--ux-space-md);
      opacity: 0.5;
    }

    .ux-bom-tree__empty-title {
      font-weight: 600;
      font-size: var(--ux-font-size-lg);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-xs);
    }

    /* ==========================================================================
       Type Badge
       ========================================================================== */

    .ux-bom-tree__type {
      display: inline-flex;
      align-items: center;
      height: 20px;
      padding: 0 var(--ux-space-xs);
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-radius: var(--ux-radius-sm);
      flex-shrink: 0;
    }

    .ux-bom-tree__type--raw {
      background: var(--ux-bom-type-raw-bg);
      color: var(--ux-bom-type-raw);
    }

    .ux-bom-tree__type--subassembly {
      background: var(--ux-bom-type-subassembly-bg);
      color: var(--ux-bom-type-subassembly);
    }

    .ux-bom-tree__type--finished {
      background: var(--ux-bom-type-finished-bg);
      color: var(--ux-bom-type-finished);
    }

    .ux-bom-tree__type--consumable {
      background: var(--ux-bom-type-consumable-bg);
      color: var(--ux-bom-type-consumable);
    }

    .ux-bom-tree__type--packaging {
      background: var(--ux-bom-type-packaging-bg);
      color: var(--ux-bom-type-packaging);
    }

    /* ==========================================================================
       Size Variants
       ========================================================================== */

    .ux-bom-tree--sm {
      --ux-bom-tree-font-size: var(--ux-font-size-sm);
      --ux-bom-tree-item-height: 40px;
      --ux-bom-tree-item-padding: var(--ux-space-xs) var(--ux-space-sm);
      --ux-bom-tree-indent: 24px;
      --ux-bom-tree-icon-size: 16px;
    }

    .ux-bom-tree--sm .ux-bom-tree__icon {
      width: 28px;
      height: 28px;
    }

    .ux-bom-tree--lg {
      --ux-bom-tree-font-size: var(--ux-font-size-lg);
      --ux-bom-tree-item-height: 56px;
      --ux-bom-tree-item-padding: var(--ux-space-md) var(--ux-space-lg);
      --ux-bom-tree-indent: 36px;
      --ux-bom-tree-icon-size: 24px;
    }

    .ux-bom-tree--lg .ux-bom-tree__icon {
      width: 40px;
      height: 40px;
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-bom-tree--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 1px solid var(--ux-glass-border);
    }

    .ux-bom-tree--glass .ux-bom-tree__header,
    .ux-bom-tree--glass .ux-bom-tree__footer {
      background: rgba(255, 255, 255, 0.05);
    }

    .ux-bom-tree--glass .ux-bom-tree__item:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .ux-bom-tree--glass .ux-bom-tree__item--selected {
      background: rgba(var(--ux-primary-rgb), 0.2);
    }

    /* ==========================================================================
       Compact Variant
       ========================================================================== */

    .ux-bom-tree--compact .ux-bom-tree__item {
      min-height: 36px;
      padding: var(--ux-space-xs) var(--ux-space-sm);
    }

    .ux-bom-tree--compact .ux-bom-tree__icon {
      width: 24px;
      height: 24px;
    }

    .ux-bom-tree--compact .ux-bom-tree__icon svg {
      width: 14px;
      height: 14px;
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root {
        --ux-bom-type-raw-bg: rgba(245, 158, 11, 0.15);
        --ux-bom-type-subassembly-bg: rgba(59, 130, 246, 0.15);
        --ux-bom-type-finished-bg: rgba(34, 197, 94, 0.15);
        --ux-bom-type-consumable-bg: rgba(168, 85, 247, 0.15);
        --ux-bom-type-packaging-bg: rgba(107, 114, 128, 0.15);
      }

      .ux-bom-tree--glass .ux-bom-tree__header,
      .ux-bom-tree--glass .ux-bom-tree__footer {
        background: rgba(0, 0, 0, 0.2);
      }

      .ux-bom-tree--glass .ux-bom-tree__item:hover {
        background: rgba(255, 255, 255, 0.05);
      }
    }

    .ux-dark {
      --ux-bom-type-raw-bg: rgba(245, 158, 11, 0.15);
      --ux-bom-type-subassembly-bg: rgba(59, 130, 246, 0.15);
      --ux-bom-type-finished-bg: rgba(34, 197, 94, 0.15);
      --ux-bom-type-consumable-bg: rgba(168, 85, 247, 0.15);
      --ux-bom-type-packaging-bg: rgba(107, 114, 128, 0.15);
    }

    .ux-dark .ux-bom-tree--glass .ux-bom-tree__header,
    .ux-dark .ux-bom-tree--glass .ux-bom-tree__footer {
      background: rgba(0, 0, 0, 0.2);
    }

    .ux-dark .ux-bom-tree--glass .ux-bom-tree__item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    /* ==========================================================================
       Responsive
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-bom-tree__header {
        flex-wrap: wrap;
      }

      .ux-bom-tree__cost,
      .ux-bom-tree__stock {
        min-width: auto;
      }

      .ux-bom-tree__item {
        flex-wrap: wrap;
        gap: var(--ux-space-xs);
      }

      .ux-bom-tree__details {
        flex-basis: calc(100% - 60px);
      }

      .ux-bom-tree__quantity,
      .ux-bom-tree__stock,
      .ux-bom-tree__cost {
        margin-left: auto;
      }

      .ux-bom-tree__footer {
        flex-direction: column;
        align-items: stretch;
      }

      .ux-bom-tree__summary {
        flex-wrap: wrap;
        justify-content: space-between;
      }
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-bom-tree__toggle,
      .ux-bom-tree__item,
      .ux-bom-tree__action {
        transition: none;
      }

      .ux-bom-tree__stock--low-stock .ux-bom-tree__stock-dot {
        animation: none;
      }
    }

    /* ==========================================================================
       Print Styles
       ========================================================================== */

    @media print {
      .ux-bom-tree {
        background: white;
        border: 1px solid #ccc;
      }

      .ux-bom-tree__actions,
      .ux-bom-tree__search {
        display: none;
      }

      .ux-bom-tree__item {
        break-inside: avoid;
      }
    }
  `;

  // Icons
  const icons = {
    chevron: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>`,
    raw: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>`,
    subassembly: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>`,
    finished: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>`,
    consumable: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>`,
    packaging: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>`,
    expandAll: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>`,
    collapseAll: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/><line x1="14" y1="10" x2="21" y2="3"/><line x1="3" y1="21" x2="10" y2="14"/></svg>`,
    search: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>`,
    export: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>`,
    empty: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>`
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-bom-tree-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-bom-tree-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const bomTreeData = (options = {}) => ({
    // Configuration
    data: options.data || [],
    showSearch: options.showSearch ?? true,
    showCost: options.showCost ?? true,
    showStock: options.showStock ?? true,
    showLevels: options.showLevels ?? true,
    showTypes: options.showTypes ?? true,
    currency: options.currency ?? '$',
    currencyPosition: options.currencyPosition ?? 'before',
    lowStockThreshold: options.lowStockThreshold ?? 10,
    draggable: options.draggable ?? false,
    selectable: options.selectable ?? false,

    // State
    expandedNodes: new Set(options.expanded || []),
    selectedNode: null,
    searchQuery: '',
    draggedNode: null,
    dragOverNode: null,

    // Icons
    icons: icons,

    // Lifecycle
    init() {
      // Auto-expand first level if no expanded specified
      if (this.expandedNodes.size === 0 && this.data.length > 0) {
        this.data.forEach(node => {
          if (node.children && node.children.length > 0) {
            this.expandedNodes.add(node.id);
          }
        });
      }
    },

    // Toggle expansion
    toggle(nodeId) {
      if (this.expandedNodes.has(nodeId)) {
        this.expandedNodes.delete(nodeId);
      } else {
        this.expandedNodes.add(nodeId);
      }
      this.$dispatch('bom:toggle', { nodeId, expanded: this.expandedNodes.has(nodeId) });
    },

    // Expand all nodes
    expandAll() {
      const expandRecursive = (nodes) => {
        nodes.forEach(node => {
          if (node.children && node.children.length > 0) {
            this.expandedNodes.add(node.id);
            expandRecursive(node.children);
          }
        });
      };
      expandRecursive(this.data);
      this.$dispatch('bom:expand-all');
    },

    // Collapse all nodes
    collapseAll() {
      this.expandedNodes.clear();
      this.$dispatch('bom:collapse-all');
    },

    // Select node
    select(nodeId, node) {
      if (!this.selectable) return;
      this.selectedNode = this.selectedNode === nodeId ? null : nodeId;
      this.$dispatch('bom:select', { nodeId, node, selected: this.selectedNode === nodeId });
    },

    // Search filter
    get filteredData() {
      if (!this.searchQuery.trim()) return this.data;
      return this.filterNodes(this.data, this.searchQuery.toLowerCase());
    },

    filterNodes(nodes, query) {
      return nodes.reduce((acc, node) => {
        const matches = node.name.toLowerCase().includes(query) ||
                       (node.sku && node.sku.toLowerCase().includes(query));

        const filteredChildren = node.children ?
          this.filterNodes(node.children, query) : [];

        if (matches || filteredChildren.length > 0) {
          acc.push({
            ...node,
            children: filteredChildren.length > 0 ? filteredChildren : node.children,
            _highlight: matches
          });

          // Auto-expand parents of matches
          if (filteredChildren.length > 0) {
            this.expandedNodes.add(node.id);
          }
        }

        return acc;
      }, []);
    },

    // Get stock status
    getStockStatus(node) {
      if (!node.stock && node.stock !== 0) return null;
      if (node.stock <= 0) return 'out-of-stock';
      if (node.stock <= (node.lowThreshold || this.lowStockThreshold)) return 'low-stock';
      return 'in-stock';
    },

    getStockLabel(node) {
      const status = this.getStockStatus(node);
      if (status === 'out-of-stock') return 'Out of Stock';
      if (status === 'low-stock') return 'Low Stock';
      return 'In Stock';
    },

    // Format currency
    formatCurrency(value) {
      if (value === null || value === undefined) return '';
      const formatted = Number(value).toFixed(2);
      return this.currencyPosition === 'before'
        ? `${this.currency}${formatted}`
        : `${formatted}${this.currency}`;
    },

    // Calculate total cost recursively
    calculateTotalCost(nodes = this.data) {
      return nodes.reduce((total, node) => {
        const nodeCost = (node.unitCost || 0) * (node.quantity || 1);
        const childrenCost = node.children ? this.calculateTotalCost(node.children) : 0;
        return total + nodeCost + childrenCost;
      }, 0);
    },

    // Calculate rollup cost for a node
    calculateRollupCost(node) {
      const nodeCost = (node.unitCost || 0) * (node.quantity || 1);
      const childrenCost = node.children ? this.calculateTotalCost(node.children) : 0;
      return nodeCost + childrenCost;
    },

    // Count components
    countComponents(nodes = this.data) {
      return nodes.reduce((count, node) => {
        const childCount = node.children ? this.countComponents(node.children) : 0;
        return count + 1 + childCount;
      }, 0);
    },

    // Get component type icon
    getTypeIcon(type) {
      switch (type) {
        case 'raw': return icons.raw;
        case 'subassembly': return icons.subassembly;
        case 'finished': return icons.finished;
        case 'consumable': return icons.consumable;
        case 'packaging': return icons.packaging;
        default: return icons.finished;
      }
    },

    // Get level color class
    getLevelClass(level) {
      const lvl = Math.min(level, 5);
      return `ux-bom-tree__level-bar--l${lvl}`;
    },

    // Find node by ID
    findNode(nodeId, nodes = this.data) {
      for (const node of nodes) {
        if (node.id === nodeId) return node;
        if (node.children) {
          const found = this.findNode(nodeId, node.children);
          if (found) return found;
        }
      }
      return null;
    },

    // Export BOM structure
    exportBOM(format = 'json') {
      const flattenBOM = (nodes, level = 0, parentId = null) => {
        return nodes.reduce((acc, node) => {
          acc.push({
            id: node.id,
            parentId,
            level,
            sku: node.sku || '',
            name: node.name,
            type: node.type || 'raw',
            quantity: node.quantity || 1,
            unit: node.unit || 'pcs',
            unitCost: node.unitCost || 0,
            totalCost: (node.unitCost || 0) * (node.quantity || 1),
            stock: node.stock,
            stockStatus: this.getStockStatus(node)
          });

          if (node.children) {
            acc.push(...flattenBOM(node.children, level + 1, node.id));
          }

          return acc;
        }, []);
      };

      const flatData = flattenBOM(this.data);

      if (format === 'csv') {
        const headers = ['Level', 'SKU', 'Name', 'Type', 'Qty', 'Unit', 'Unit Cost', 'Total Cost', 'Stock'];
        const rows = flatData.map(row => [
          row.level,
          row.sku,
          row.name,
          row.type,
          row.quantity,
          row.unit,
          row.unitCost,
          row.totalCost,
          row.stock || ''
        ]);
        const csvContent = [headers, ...rows].map(r => r.join(',')).join('\n');
        this.$dispatch('bom:export', { format: 'csv', data: csvContent });
        return csvContent;
      }

      this.$dispatch('bom:export', { format: 'json', data: flatData });
      return flatData;
    },

    // Drag & Drop handlers
    handleDragStart(nodeId, event) {
      if (!this.draggable) return;
      this.draggedNode = nodeId;
      event.dataTransfer.effectAllowed = 'move';
      event.dataTransfer.setData('text/plain', nodeId);
    },

    handleDragOver(nodeId, event) {
      if (!this.draggable || !this.draggedNode) return;
      if (nodeId === this.draggedNode) return;
      event.preventDefault();
      event.dataTransfer.dropEffect = 'move';
      this.dragOverNode = nodeId;
    },

    handleDragLeave(nodeId) {
      if (this.dragOverNode === nodeId) {
        this.dragOverNode = null;
      }
    },

    handleDrop(nodeId, event) {
      if (!this.draggable || !this.draggedNode) return;
      event.preventDefault();

      const draggedNode = this.findNode(this.draggedNode);
      const targetNode = this.findNode(nodeId);

      if (draggedNode && targetNode && this.draggedNode !== nodeId) {
        this.$dispatch('bom:reorder', {
          draggedNodeId: this.draggedNode,
          targetNodeId: nodeId,
          draggedNode,
          targetNode
        });
      }

      this.draggedNode = null;
      this.dragOverNode = null;
    },

    handleDragEnd() {
      this.draggedNode = null;
      this.dragOverNode = null;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxBomTree', bomTreeData);
  }

  // Expose icons for external use
  window.UX = window.UX || {};
  window.UX.bomTreeIcons = icons;
})();

/**
 * UX Breadcrumbs Component
 * Migas de pan para navegaciÃ³n
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Breadcrumbs
       Semantic structure: nav > ol > li
       ARIA: aria-label="Breadcrumb", aria-current="page"
    ======================================== */

    .ux-breadcrumbs {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-sm) 0;
      font-size: var(--ux-font-size-sm);
    }

    /* Semantic list structure */
    .ux-breadcrumbs__list {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
      list-style: none;
      margin: 0;
      padding: 0;
    }

    /* ========================================
       Breadcrumb Item
    ======================================== */

    .ux-breadcrumb {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-breadcrumb__link {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      color: var(--ux-primary);
      text-decoration: none;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-radius: var(--ux-border-radius-sm);
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-breadcrumb__link:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-breadcrumb__link:active {
      background-color: rgba(var(--ux-primary-rgb), 0.2);
    }

    .ux-breadcrumb--current .ux-breadcrumb__link {
      color: var(--ux-text);
      pointer-events: none;
    }

    .ux-breadcrumb--disabled .ux-breadcrumb__link {
      color: var(--ux-text-tertiary);
      pointer-events: none;
    }

    /* ========================================
       Breadcrumb Icon
    ======================================== */

    .ux-breadcrumb__icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .ux-breadcrumb__icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Separator
    ======================================== */

    .ux-breadcrumb__separator {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      color: var(--ux-text-tertiary);
      flex-shrink: 0;
    }

    .ux-breadcrumb__separator svg {
      width: 100%;
      height: 100%;
    }

    /* Different separator styles */
    .ux-breadcrumbs--slash .ux-breadcrumb__separator::before {
      content: '/';
    }

    .ux-breadcrumbs--arrow .ux-breadcrumb__separator::before {
      content: 'âº';
      font-size: var(--ux-font-size-lg);
    }

    .ux-breadcrumbs--dot .ux-breadcrumb__separator::before {
      content: 'â¢';
    }

    /* ========================================
       Collapsed Breadcrumbs
    ======================================== */

    .ux-breadcrumb--collapsed {
      display: inline-flex;
    }

    .ux-breadcrumb__ellipsis {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      color: var(--ux-text-secondary);
      cursor: pointer;
      border-radius: var(--ux-border-radius-sm);
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-breadcrumb__ellipsis:hover {
      background-color: var(--ux-surface-secondary);
    }

    /* Dropdown for collapsed items */
    .ux-breadcrumb__dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      min-width: 160px;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      box-shadow: var(--ux-shadow-lg);
      padding: var(--ux-space-xs) 0;
      z-index: 100;
    }

    .ux-breadcrumb__dropdown-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      color: var(--ux-text);
      text-decoration: none;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-breadcrumb__dropdown-item:hover {
      background-color: var(--ux-surface-secondary);
    }

    /* ========================================
       Variants
    ======================================== */

    /* Contained */
    .ux-breadcrumbs--contained {
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    /* Outlined */
    .ux-breadcrumbs--outlined {
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-breadcrumbs--sm {
      font-size: var(--ux-font-size-xs);
      gap: 2px;
    }

    .ux-breadcrumbs--sm .ux-breadcrumb__link {
      padding: 2px var(--ux-space-xs);
    }

    .ux-breadcrumbs--sm .ux-breadcrumb__icon,
    .ux-breadcrumbs--sm .ux-breadcrumb__separator {
      width: 12px;
      height: 12px;
    }

    .ux-breadcrumbs--lg {
      font-size: var(--ux-font-size-md);
    }

    .ux-breadcrumbs--lg .ux-breadcrumb__link {
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    .ux-breadcrumbs--lg .ux-breadcrumb__icon,
    .ux-breadcrumbs--lg .ux-breadcrumb__separator {
      width: 20px;
      height: 20px;
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-breadcrumbs--responsive .ux-breadcrumb:not(:last-child):not(:first-child) {
        display: none;
      }

      .ux-breadcrumbs--responsive .ux-breadcrumb--show-mobile {
        display: inline-flex;
      }
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-breadcrumbs--glass {
      padding: var(--ux-space-sm) var(--ux-space-md);
      border-radius: var(--ux-border-radius);
      border: 0.5px solid var(--ux-glass-border);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-breadcrumbs-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-breadcrumbs-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for collapsible breadcrumbs
  // ARIA: aria-label="Breadcrumb" on nav, aria-current="page" on last item
  const breadcrumbsComponent = (config = {}) => ({
    items: config.items || [],
    maxItems: config.maxItems || 4,
    collapsed: true,
    dropdownOpen: false,
    ariaLabel: config.ariaLabel || 'Breadcrumb',

    // ARIA attributes for the nav element
    get navAriaAttrs() {
      return {
        'aria-label': this.ariaLabel
      };
    },

    // ARIA attributes for list items
    getItemAriaAttrs(index) {
      const isLast = this.isLast(index);
      return isLast ? { 'aria-current': 'page' } : {};
    },

    get visibleItems() {
      if (!this.collapsed || this.items.length <= this.maxItems) {
        return this.items;
      }

      // Show first, ellipsis, and last two
      return [
        this.items[0],
        { type: 'ellipsis' },
        ...this.items.slice(-2)
      ];
    },

    get collapsedItems() {
      if (this.items.length <= this.maxItems) return [];
      return this.items.slice(1, -2);
    },

    expand() {
      this.collapsed = false;
    },

    toggleDropdown() {
      this.dropdownOpen = !this.dropdownOpen;
    },

    closeDropdown() {
      this.dropdownOpen = false;
    },

    isLast(index) {
      return index === this.visibleItems.length - 1;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxBreadcrumbs', breadcrumbsComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxBreadcrumbs', breadcrumbsComponent);
    });
  }
})();

/**
 * UX Button Group Component
 * AgrupaciÃ³n de botones con estilos conectados
 * @requires ux-core.js
 * @requires ux-button.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Button Group
    ======================================== */

    .ux-button-group {
      display: inline-flex;
      flex-wrap: nowrap;
      vertical-align: middle;
      isolation: isolate;
    }

    /* Reset button borders for grouping */
    .ux-button-group > .ux-button {
      position: relative;
      flex: 0 1 auto;
      border-radius: 0;
    }

    /* First button */
    .ux-button-group > .ux-button:first-child {
      border-top-left-radius: var(--ux-button-border-radius);
      border-bottom-left-radius: var(--ux-button-border-radius);
    }

    /* Last button */
    .ux-button-group > .ux-button:last-child {
      border-top-right-radius: var(--ux-button-border-radius);
      border-bottom-right-radius: var(--ux-button-border-radius);
    }

    /* Only child */
    .ux-button-group > .ux-button:only-child {
      border-radius: var(--ux-button-border-radius);
    }

    /* Remove double borders */
    .ux-button-group > .ux-button:not(:first-child) {
      margin-left: -2px;
    }

    /* Z-index for hover/focus states */
    .ux-button-group > .ux-button:hover,
    .ux-button-group > .ux-button:focus-visible,
    .ux-button-group > .ux-button:active {
      z-index: 1;
    }

    .ux-button-group > .ux-button.ux-button--active {
      z-index: 2;
    }

    /* ========================================
       Outline Variant
    ======================================== */

    .ux-button-group--outline > .ux-button {
      background-color: transparent;
      color: var(--ux-variant-color, var(--ux-primary));
      border: 2px solid var(--ux-variant-border, var(--ux-primary));
    }

    .ux-button-group--outline > .ux-button:hover {
      background-color: var(--ux-variant-bg-hover, rgba(var(--ux-primary-rgb), 0.1));
    }

    .ux-button-group--outline > .ux-button.ux-button--active,
    .ux-button-group--outline > .ux-button[aria-pressed="true"] {
      background-color: var(--ux-variant-bg, var(--ux-primary));
      color: var(--ux-variant-color, var(--ux-primary-contrast));
    }

    /* ========================================
       Vertical Group
    ======================================== */

    .ux-button-group--vertical {
      flex-direction: column;
    }

    .ux-button-group--vertical > .ux-button {
      width: 100%;
      border-radius: 0;
    }

    .ux-button-group--vertical > .ux-button:first-child {
      border-top-left-radius: var(--ux-button-border-radius);
      border-top-right-radius: var(--ux-button-border-radius);
      border-bottom-left-radius: 0;
    }

    .ux-button-group--vertical > .ux-button:last-child {
      border-bottom-left-radius: var(--ux-button-border-radius);
      border-bottom-right-radius: var(--ux-button-border-radius);
      border-top-right-radius: 0;
    }

    .ux-button-group--vertical > .ux-button:not(:first-child) {
      margin-left: 0;
      margin-top: -2px;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-button-group--sm > .ux-button {
      height: var(--ux-button-height-sm);
      padding: 0 var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
    }

    .ux-button-group--lg > .ux-button {
      height: var(--ux-button-height-lg);
      padding: 0 var(--ux-space-lg);
      font-size: var(--ux-font-size-lg);
    }

    /* ========================================
       Full Width
    ======================================== */

    .ux-button-group--block {
      display: flex;
      width: 100%;
    }

    .ux-button-group--block > .ux-button {
      flex: 1;
    }

    /* ========================================
       Separated (gap between buttons)
    ======================================== */

    .ux-button-group--separated {
      gap: var(--ux-space-xs);
    }

    .ux-button-group--separated > .ux-button {
      border-radius: var(--ux-button-border-radius);
      margin-left: 0;
    }

    .ux-button-group--separated > .ux-button:not(:first-child) {
      margin-left: 0;
      margin-top: 0;
    }

    /* ========================================
       Toggle Group (single selection)
    ======================================== */

    .ux-button-group--toggle > .ux-button {
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text);
      border-color: var(--ux-border-color);
    }

    .ux-button-group--toggle > .ux-button:hover {
      background-color: var(--ux-surface-tertiary);
    }

    .ux-button-group--toggle > .ux-button.ux-button--active,
    .ux-button-group--toggle > .ux-button[aria-pressed="true"] {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-color: var(--ux-primary);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-button-group--glass > .ux-button {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
      color: var(--ux-text);
    }

    .ux-button-group--glass > .ux-button:hover {
      background: var(--ux-glass-bg-thick);
    }

    .ux-button-group--glass > .ux-button.ux-button--active {
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-button-group--toggle > .ux-button {
        background-color: var(--ux-surface-secondary);
        border-color: var(--ux-border-color);
      }

      .ux-button-group--toggle > .ux-button:hover {
        background-color: var(--ux-surface-tertiary);
      }
    }

    .ux-dark .ux-button-group--toggle > .ux-button {
      background-color: var(--ux-surface-secondary);
      border-color: var(--ux-border-color);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-button-group > .ux-button {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-button-group-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-button-group-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for toggle functionality
  const buttonGroupData = (options = {}) => ({
    selected: options.selected ?? null,
    multiple: options.multiple ?? false,
    selectedItems: options.selectedItems ?? [],

    init() {
      // Initialize from aria-pressed attributes
      this.$el.querySelectorAll('.ux-button[aria-pressed="true"]').forEach(btn => {
        const value = btn.dataset.value;
        if (value) {
          if (this.multiple) {
            this.selectedItems.push(value);
          } else {
            this.selected = value;
          }
        }
      });
    },

    isSelected(value) {
      if (this.multiple) {
        return this.selectedItems.includes(value);
      }
      return this.selected === value;
    },

    select(value) {
      if (this.multiple) {
        const index = this.selectedItems.indexOf(value);
        if (index === -1) {
          this.selectedItems.push(value);
        } else {
          this.selectedItems.splice(index, 1);
        }
        this.$dispatch('buttongroup:change', { selected: [...this.selectedItems] });
      } else {
        this.selected = value;
        this.$dispatch('buttongroup:change', { selected: value });
      }
    },

    getButtonClasses(value) {
      return {
        'ux-button--active': this.isSelected(value)
      };
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxButtonGroup', buttonGroupData);
  }

})();

/**
 * UX Button Component
 * Botones estilo Ionic con variantes, tamaÃ±os y estados
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Button
    ======================================== */

    .ux-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
      height: var(--ux-button-height);
      min-height: var(--ux-button-min-height);
      max-height: var(--ux-button-max-height);
      padding: var(--ux-button-padding-y) var(--ux-button-padding-x);
      font-family: var(--ux-font-family);
      font-size: var(--ux-button-font-size);
      font-weight: var(--ux-button-font-weight);
      line-height: 1;
      text-align: center;
      text-decoration: none;
      white-space: nowrap;
      /* Uses composition system: combine with .ux-color-* classes */
      background-color: var(--ux-variant-bg, var(--ux-primary));
      color: var(--ux-variant-color, var(--ux-primary-contrast));
      border: 2px solid var(--ux-variant-border, transparent);
      border-radius: var(--ux-button-border-radius);
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      transition: var(--ux-transition-colors),
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
      position: relative;
      overflow: hidden;
    }

    .ux-button:hover {
      background-color: var(--ux-variant-bg-hover, var(--ux-primary-shade));
    }

    /* Ripple effect */
    .ux-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease, opacity 0.4s ease;
      opacity: 0;
      pointer-events: none;
    }

    .ux-button:active::before {
      width: 300%;
      height: 300%;
      opacity: 1;
      transition: 0s;
    }

    /* Press effect */
    .ux-button:active {
      transform: scale(0.97);
    }

    /* Focus state */
    .ux-button:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    /* ========================================
       Outline Variant
       Use with .ux-color-*--outline classes
    ======================================== */

    .ux-button--outline {
      background-color: var(--ux-variant-bg, transparent);
      color: var(--ux-variant-color, var(--ux-primary));
      border: 2px solid var(--ux-variant-border, var(--ux-primary));
    }

    .ux-button--outline:hover {
      background-color: var(--ux-variant-bg-hover, rgba(var(--ux-primary-rgb), 0.1));
    }

    /* ========================================
       Clear Variant (text only)
       Use with .ux-color-* classes for color
    ======================================== */

    .ux-button--clear {
      background-color: transparent;
      color: var(--ux-variant-color, var(--ux-primary));
      border: none;
    }

    .ux-button--clear:hover {
      background-color: var(--ux-variant-bg-hover, rgba(0, 0, 0, 0.05));
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-button--glass {
      box-shadow: var(--ux-glass-highlight);
      border: 0.5px solid var(--ux-glass-border);
      color: var(--ux-text);
    }

    .ux-button--glass:hover {
      background: var(--ux-glass-bg-thick);
    }

    .ux-button--glass:active {
      background: var(--ux-glass-bg);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-button--sm {
      height: var(--ux-button-height-sm);
      min-height: var(--ux-button-min-height-sm);
      padding: var(--ux-button-padding-y-sm) var(--ux-button-padding-x-sm);
      font-size: var(--ux-button-font-size-sm);
      border-radius: var(--ux-button-border-radius-sm);
    }

    .ux-button--lg {
      height: var(--ux-button-height-lg);
      min-height: var(--ux-button-min-height-lg);
      padding: var(--ux-button-padding-y-lg) var(--ux-button-padding-x-lg);
      font-size: var(--ux-button-font-size-lg);
      border-radius: var(--ux-button-border-radius-lg);
    }

    /* ========================================
       Full Width
    ======================================== */

    .ux-button--block {
      display: flex;
      width: 100%;
    }

    /* ========================================
       Round
    ======================================== */

    .ux-button--round {
      border-radius: 9999px;
    }

    /* ========================================
       Icon Only
    ======================================== */

    .ux-button--icon {
      width: var(--ux-button-icon-only-size);
      min-width: var(--ux-button-icon-only-size);
      height: var(--ux-button-icon-only-size);
      min-height: var(--ux-button-icon-only-size);
      padding: 0;
      border-radius: 50%;
    }

    .ux-button--icon.ux-button--sm {
      width: var(--ux-button-icon-only-size-sm);
      min-width: var(--ux-button-icon-only-size-sm);
      height: var(--ux-button-icon-only-size-sm);
      min-height: var(--ux-button-icon-only-size-sm);
    }

    .ux-button--icon.ux-button--lg {
      width: var(--ux-button-icon-only-size-lg);
      min-width: var(--ux-button-icon-only-size-lg);
      height: var(--ux-button-icon-only-size-lg);
      min-height: var(--ux-button-icon-only-size-lg);
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-button--loading {
      pointer-events: none;
      position: relative;
      color: transparent !important;
    }

    .ux-button--loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid currentColor;
      border-right-color: transparent;
      border-radius: 50%;
      animation: ux-button-spin 0.6s linear infinite;
    }

    .ux-button--loading:not(.ux-button--outline):not(.ux-button--clear)::after {
      border-color: rgba(255, 255, 255, 0.8);
      border-right-color: transparent;
    }

    @keyframes ux-button-spin {
      to { transform: rotate(360deg); }
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-button:disabled,
    .ux-button[disabled],
    .ux-button--disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* ========================================
       Button Group
    ======================================== */

    .ux-button-group {
      display: inline-flex;
    }

    .ux-button-group .ux-button {
      border-radius: 0;
    }

    .ux-button-group .ux-button:first-child {
      border-radius: var(--ux-border-radius) 0 0 var(--ux-border-radius);
    }

    .ux-button-group .ux-button:last-child {
      border-radius: 0 var(--ux-border-radius) var(--ux-border-radius) 0;
    }

    .ux-button-group .ux-button:not(:last-child) {
      border-right: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* ========================================
       Button Icon
    ======================================== */

    .ux-button__icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-button-icon-size);
      height: var(--ux-button-icon-size);
      flex-shrink: 0;
    }

    .ux-button__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-button--sm .ux-button__icon {
      width: calc(var(--ux-button-icon-size) * 0.8);
      height: calc(var(--ux-button-icon-size) * 0.8);
    }

    .ux-button--lg .ux-button__icon {
      width: calc(var(--ux-button-icon-size) * 1.2);
      height: calc(var(--ux-button-icon-size) * 1.2);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-button {
        transition: none;
      }

      .ux-button::before {
        transition: none;
      }

      .ux-button:active {
        transform: none;
      }

      .ux-button--loading::after {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-button-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-button-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Register Alpine component for button with loading state
  const buttonComponent = () => ({
    loading: false,

    setLoading(state) {
      this.loading = state;
    },

    async click(callback) {
      if (this.loading) return;
      this.loading = true;
      try {
        await callback();
      } finally {
        this.loading = false;
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxButton', buttonComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxButton', buttonComponent);
    });
  }
})();

/**
 * UX Calculator Component
 * Scientific calculator with iOS-style design
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Calculator Variables
    ======================================== */

    :root {
      --ux-calculator-width: 320px;
      --ux-calculator-btn-size: 64px;
      --ux-calculator-btn-size-sm: 52px;
      --ux-calculator-btn-gap: 12px;
      --ux-calculator-btn-gap-sm: 8px;
      --ux-calculator-border-radius: var(--ux-border-radius-xl);
      --ux-calculator-display-font-size: 3rem;
      --ux-calculator-display-font-size-sm: 2rem;
      --ux-calculator-expression-font-size: 1rem;
      --ux-calculator-btn-font-size: 1.5rem;
      --ux-calculator-btn-font-size-sm: 1.25rem;
    }

    /* ========================================
       UX Calculator Container
    ======================================== */

    .ux-calculator {
      display: flex;
      flex-direction: column;
      width: var(--ux-calculator-width);
      max-width: 100%;
      padding: var(--ux-space-lg);
      background-color: var(--ux-surface);
      border-radius: var(--ux-calculator-border-radius);
      box-shadow: var(--ux-shadow-lg);
      user-select: none;
      -webkit-user-select: none;
    }

    .ux-calculator--full-width {
      width: 100%;
    }

    /* ========================================
       Compact Variant
    ======================================== */

    .ux-calculator--compact {
      --ux-calculator-btn-size: var(--ux-calculator-btn-size-sm);
      --ux-calculator-btn-gap: var(--ux-calculator-btn-gap-sm);
      --ux-calculator-display-font-size: var(--ux-calculator-display-font-size-sm);
      --ux-calculator-btn-font-size: var(--ux-calculator-btn-font-size-sm);
      padding: var(--ux-space-md);
    }

    .ux-calculator--compact .ux-calculator__display {
      padding: var(--ux-space-sm) var(--ux-space-md);
      min-height: 80px;
    }

    /* ========================================
       Calculator Display
    ======================================== */

    .ux-calculator__display {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: flex-end;
      min-height: 120px;
      padding: var(--ux-space-md) var(--ux-space-lg);
      margin-bottom: var(--ux-space-md);
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
    }

    .ux-calculator__expression {
      width: 100%;
      text-align: right;
      font-size: var(--ux-calculator-expression-font-size);
      font-weight: 400;
      color: var(--ux-text-secondary);
      min-height: 1.5em;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-calculator__result {
      width: 100%;
      text-align: right;
      font-family: 'SF Mono', 'Menlo', 'Monaco', monospace;
      font-size: var(--ux-calculator-display-font-size);
      font-weight: 300;
      font-variant-numeric: tabular-nums;
      color: var(--ux-text);
      line-height: 1.2;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      transition: font-size var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-calculator__result--small {
      font-size: calc(var(--ux-calculator-display-font-size) * 0.7);
    }

    .ux-calculator__result--error {
      color: var(--ux-danger);
    }

    /* ========================================
       Calculator Keypad
    ======================================== */

    .ux-calculator__keypad {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--ux-calculator-btn-gap);
    }

    /* ========================================
       Calculator Buttons
    ======================================== */

    .ux-calculator__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: var(--ux-calculator-btn-size);
      min-height: var(--ux-calculator-btn-size);
      padding: var(--ux-space-sm);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      font-family: var(--ux-font-family);
      font-size: var(--ux-calculator-btn-font-size);
      font-weight: 500;
      color: var(--ux-text);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform 100ms var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-calculator__btn:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-calculator__btn:active {
      transform: scale(0.95);
      background-color: var(--ux-surface-tertiary);
    }

    .ux-calculator__btn:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    /* Number buttons */
    .ux-calculator__btn--number {
      background-color: var(--ux-surface);
      font-weight: 400;
    }

    .ux-calculator__btn--number:hover {
      background-color: var(--ux-surface-secondary);
    }

    /* Operator buttons */
    .ux-calculator__btn--operator {
      background-color: var(--ux-warning);
      border-color: var(--ux-warning);
      color: white;
    }

    .ux-calculator__btn--operator:hover {
      background-color: var(--ux-warning-shade, #e89806);
    }

    .ux-calculator__btn--operator:active {
      background-color: var(--ux-warning-shade, #e89806);
    }

    .ux-calculator__btn--operator.is-active {
      background-color: white;
      color: var(--ux-warning);
    }

    /* Function buttons (C, +/-, %) */
    .ux-calculator__btn--function {
      background-color: var(--ux-surface-secondary);
      border-color: var(--ux-border-color);
      color: var(--ux-text);
    }

    .ux-calculator__btn--function:hover {
      background-color: var(--ux-surface-tertiary);
    }

    /* Equals button */
    .ux-calculator__btn--equals {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-calculator__btn--equals:hover {
      background-color: var(--ux-primary-shade);
    }

    .ux-calculator__btn--equals:active {
      background-color: var(--ux-primary-shade);
    }

    /* Zero button spans 2 columns */
    .ux-calculator__btn--wide {
      grid-column: span 2;
    }

    /* Button icon */
    .ux-calculator__btn svg {
      width: 24px;
      height: 24px;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    .ux-calculator--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-calculator--glass .ux-calculator__display {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-calculator--glass .ux-calculator__btn {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    .ux-calculator--glass .ux-calculator__btn:hover {
      background: var(--ux-glass-bg);
    }

    .ux-calculator--glass .ux-calculator__btn--number {
      background: var(--ux-glass-bg-thin);
    }

    .ux-calculator--glass .ux-calculator__btn--function {
      background: var(--ux-glass-bg);
    }

    .ux-calculator--glass .ux-calculator__btn--operator {
      background: rgba(var(--ux-warning-rgb, 234, 179, 8), 0.85);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .ux-calculator--glass .ux-calculator__btn--equals {
      background: rgba(var(--ux-primary-rgb, 59, 130, 246), 0.85);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-calculator {
        width: 100%;
        max-width: 100%;
        border-radius: 0;
        box-shadow: none;
      }

      .ux-calculator__btn {
        min-height: 56px;
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-calculator {
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .ux-calculator__btn--number {
        background-color: var(--ux-gray-800);
        border-color: var(--ux-gray-700);
      }

      .ux-calculator__btn--number:hover {
        background-color: var(--ux-gray-700);
      }

      .ux-calculator__btn--function {
        background-color: var(--ux-gray-700);
        border-color: var(--ux-gray-600);
      }

      .ux-calculator__btn--function:hover {
        background-color: var(--ux-gray-600);
      }
    }

    .ux-dark .ux-calculator {
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .ux-dark .ux-calculator__btn--number {
      background-color: var(--ux-gray-800);
      border-color: var(--ux-gray-700);
    }

    .ux-dark .ux-calculator__btn--number:hover {
      background-color: var(--ux-gray-700);
    }

    .ux-dark .ux-calculator__btn--function {
      background-color: var(--ux-gray-700);
      border-color: var(--ux-gray-600);
    }

    .ux-dark .ux-calculator__btn--function:hover {
      background-color: var(--ux-gray-600);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-calculator__btn {
        transition: none;
      }

      .ux-calculator__btn:active {
        transform: none;
      }

      .ux-calculator__result {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-calculator-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-calculator-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for calculator
  const calculatorComponent = (config = {}) => ({
    // State
    display: '0',
    expression: '',
    currentOperand: '',
    previousOperand: '',
    operator: null,
    waitingForOperand: false,
    hasError: false,
    lastResult: null,

    // Configuration
    maxDigits: config.maxDigits || 12,
    precision: config.precision || 10,

    // Initialize
    init() {
      // Keyboard support
      this._keyHandler = (e) => {
        // Only respond if calculator or body is focused
        if (!this.$el.contains(document.activeElement) && document.activeElement !== document.body) return;

        // Prevent default for calculator keys
        const calculatorKeys = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '.', '+', '-', '*', '/', 'Enter', 'Escape', 'Backspace', '%'];
        if (calculatorKeys.includes(e.key)) {
          e.preventDefault();
        }

        // Handle keys
        if (e.key >= '0' && e.key <= '9') {
          this.inputDigit(e.key);
        } else if (e.key === '.') {
          this.inputDecimal();
        } else if (e.key === '+') {
          this.inputOperator('+');
        } else if (e.key === '-') {
          this.inputOperator('-');
        } else if (e.key === '*') {
          this.inputOperator('*');
        } else if (e.key === '/') {
          this.inputOperator('/');
        } else if (e.key === '%') {
          this.inputPercent();
        } else if (e.key === 'Enter' || e.key === '=') {
          this.calculate();
        } else if (e.key === 'Escape') {
          this.clear();
        } else if (e.key === 'Backspace') {
          this.backspace();
        }
      };

      document.addEventListener('keydown', this._keyHandler);
    },

    destroy() {
      if (this._keyHandler) {
        document.removeEventListener('keydown', this._keyHandler);
      }
    },

    // Input a digit (0-9)
    inputDigit(digit) {
      if (this.hasError) {
        this.clear();
      }

      if (this.waitingForOperand) {
        this.currentOperand = digit;
        this.waitingForOperand = false;
      } else {
        // Prevent multiple leading zeros
        if (this.currentOperand === '0' && digit === '0') return;

        // Replace leading zero unless it's followed by decimal
        if (this.currentOperand === '0' && digit !== '0') {
          this.currentOperand = digit;
        } else {
          // Check max digits
          const digitsOnly = this.currentOperand.replace(/[^0-9]/g, '');
          if (digitsOnly.length >= this.maxDigits) return;

          this.currentOperand += digit;
        }
      }

      this.updateDisplay();
      this.emitChange();
    },

    // Input decimal point
    inputDecimal() {
      if (this.hasError) {
        this.clear();
      }

      if (this.waitingForOperand) {
        this.currentOperand = '0.';
        this.waitingForOperand = false;
      } else if (!this.currentOperand.includes('.')) {
        this.currentOperand = this.currentOperand === '' ? '0.' : this.currentOperand + '.';
      }

      this.updateDisplay();
      this.emitChange();
    },

    // Input operator (+, -, *, /)
    inputOperator(op) {
      if (this.hasError) {
        this.clear();
      }

      const inputValue = parseFloat(this.currentOperand) || 0;

      // If we have a previous operand and an operator, calculate first
      if (this.previousOperand !== '' && this.operator && !this.waitingForOperand) {
        const result = this.performCalculation();
        if (result === null) return; // Error occurred

        this.currentOperand = String(result);
        this.previousOperand = String(result);
      } else {
        this.previousOperand = this.currentOperand || '0';
      }

      this.operator = op;
      this.waitingForOperand = true;
      this.updateExpression();
      this.updateDisplay();
      this.emitChange();
    },

    // Perform the calculation
    performCalculation() {
      const prev = parseFloat(this.previousOperand);
      const current = parseFloat(this.currentOperand);

      if (isNaN(prev) || isNaN(current)) return null;

      let result;
      switch (this.operator) {
        case '+':
          result = prev + current;
          break;
        case '-':
          result = prev - current;
          break;
        case '*':
          result = prev * current;
          break;
        case '/':
          if (current === 0) {
            this.showError('Error');
            return null;
          }
          result = prev / current;
          break;
        default:
          return current;
      }

      // Round to avoid floating point errors
      result = parseFloat(result.toPrecision(this.precision));

      return result;
    },

    // Calculate result (equals)
    calculate() {
      if (this.hasError) {
        this.clear();
        return;
      }

      if (this.operator && this.previousOperand !== '') {
        const result = this.performCalculation();
        if (result === null) return; // Error occurred

        // Store expression before clearing
        const prevOp = this.operator;
        const prevOperand = this.previousOperand;
        const currOperand = this.currentOperand;

        this.expression = `${this.formatNumber(prevOperand)} ${this.getOperatorSymbol(prevOp)} ${this.formatNumber(currOperand)} =`;
        this.currentOperand = String(result);
        this.lastResult = result;
        this.previousOperand = '';
        this.operator = null;
        this.waitingForOperand = true;

        this.updateDisplay();
        this.emitResult(result);
      }
    },

    // Clear all
    clear() {
      this.display = '0';
      this.expression = '';
      this.currentOperand = '';
      this.previousOperand = '';
      this.operator = null;
      this.waitingForOperand = false;
      this.hasError = false;
      this.lastResult = null;
      this.emitChange();
    },

    // Clear entry (CE) - clear current operand only
    clearEntry() {
      if (this.hasError) {
        this.clear();
        return;
      }

      this.currentOperand = '';
      this.updateDisplay();
      this.emitChange();
    },

    // Backspace - delete last digit
    backspace() {
      if (this.hasError || this.waitingForOperand) {
        this.clear();
        return;
      }

      if (this.currentOperand.length > 0) {
        this.currentOperand = this.currentOperand.slice(0, -1);
        if (this.currentOperand === '' || this.currentOperand === '-') {
          this.currentOperand = '';
        }
        this.updateDisplay();
        this.emitChange();
      }
    },

    // Toggle sign (+/-)
    toggleSign() {
      if (this.hasError) {
        this.clear();
        return;
      }

      if (this.currentOperand === '' || this.currentOperand === '0') return;

      if (this.currentOperand.startsWith('-')) {
        this.currentOperand = this.currentOperand.slice(1);
      } else {
        this.currentOperand = '-' + this.currentOperand;
      }

      this.updateDisplay();
      this.emitChange();
    },

    // Input percent
    inputPercent() {
      if (this.hasError) {
        this.clear();
        return;
      }

      const value = parseFloat(this.currentOperand) || 0;
      const result = value / 100;
      this.currentOperand = String(result);
      this.updateDisplay();
      this.emitChange();
    },

    // Show error
    showError(message) {
      this.display = message;
      this.hasError = true;
      this.currentOperand = '';
      this.previousOperand = '';
      this.operator = null;
      this.waitingForOperand = false;
    },

    // Update the expression display
    updateExpression() {
      if (this.operator && this.previousOperand !== '') {
        this.expression = `${this.formatNumber(this.previousOperand)} ${this.getOperatorSymbol(this.operator)}`;
      } else {
        this.expression = '';
      }
    },

    // Update the main display
    updateDisplay() {
      if (this.hasError) return;

      const value = this.currentOperand || '0';
      this.display = this.formatNumber(value);
    },

    // Format number for display
    formatNumber(numStr) {
      if (numStr === '' || numStr === '-') return '0';

      const num = parseFloat(numStr);
      if (isNaN(num)) return numStr;

      // Check if it's a decimal that ends with .
      if (numStr.endsWith('.')) {
        const parts = numStr.split('.');
        const intPart = parseFloat(parts[0]) || 0;
        return intPart.toLocaleString('en-US') + '.';
      }

      // Check if it has decimal places
      if (numStr.includes('.')) {
        const parts = numStr.split('.');
        const intPart = parseFloat(parts[0]) || 0;
        return intPart.toLocaleString('en-US') + '.' + parts[1];
      }

      return num.toLocaleString('en-US');
    },

    // Get operator symbol for display
    getOperatorSymbol(op) {
      const symbols = {
        '+': '+',
        '-': '-',
        '*': '\u00D7',
        '/': '\u00F7'
      };
      return symbols[op] || op;
    },

    // Check if display needs smaller font
    needsSmallFont() {
      return this.display.length > 10;
    },

    // Check if operator is active
    isOperatorActive(op) {
      return this.operator === op && this.waitingForOperand;
    },

    // Emit change event
    emitChange() {
      this.$dispatch('calculator-change', {
        display: this.display,
        expression: this.expression,
        currentOperand: this.currentOperand,
        operator: this.operator
      });
    },

    // Emit result event
    emitResult(result) {
      this.$dispatch('calculator-result', {
        result: result,
        display: this.display,
        expression: this.expression
      });
    },

    // Get numeric value
    getValue() {
      return parseFloat(this.currentOperand) || 0;
    },

    // Set value programmatically
    setValue(value) {
      this.clear();
      this.currentOperand = String(value);
      this.updateDisplay();
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxCalculator', calculatorComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxCalculator', calculatorComponent);
    });
  }
})();

/**
 * UX Calendar Views Component
 * Week and day calendar views with events support
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Calendar Views - Base
    ======================================== */

    .ux-calendar-view {
      --ux-cv-hour-height: 60px;
      --ux-cv-time-width: 60px;
      --ux-cv-header-height: 80px;

      font-family: var(--ux-font-family);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      overflow: hidden;
    }

    /* ========================================
       Header
    ======================================== */

    .ux-calendar-view__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-calendar-view__nav {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .ux-calendar-view__nav-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: var(--ux-surface-secondary);
      border: none;
      border-radius: var(--ux-radius-md);
      color: var(--ux-text);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-calendar-view__nav-btn:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-calendar-view__nav-btn svg {
      width: 18px;
      height: 18px;
    }

    .ux-calendar-view__title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-calendar-view__today-btn {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ux-primary);
      background: transparent;
      border: 1px solid var(--ux-primary);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-calendar-view__today-btn:hover {
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-calendar-view__view-toggle {
      display: flex;
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
      padding: 0.25rem;
    }

    .ux-calendar-view__view-btn {
      padding: 0.5rem 1rem;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--ux-text-secondary);
      background: transparent;
      border: none;
      border-radius: var(--ux-radius-sm);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-calendar-view__view-btn:hover {
      color: var(--ux-text);
    }

    .ux-calendar-view__view-btn--active {
      background: var(--ux-surface);
      color: var(--ux-text);
      box-shadow: var(--ux-shadow-sm);
    }

    /* ========================================
       Week View - Day Headers
    ======================================== */

    .ux-calendar-view__day-headers {
      display: grid;
      grid-template-columns: var(--ux-cv-time-width) repeat(7, 1fr);
      border-bottom: 1px solid var(--ux-border-color);
      position: sticky;
      top: 0;
      background: var(--ux-surface);
      z-index: 10;
    }

    .ux-calendar-view__day-headers--single {
      grid-template-columns: var(--ux-cv-time-width) 1fr;
    }

    .ux-calendar-view__corner {
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-calendar-view__day-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 0.5rem;
      text-align: center;
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-calendar-view__day-header:last-child {
      border-right: none;
    }

    .ux-calendar-view__day-name {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      margin-bottom: 0.25rem;
    }

    .ux-calendar-view__day-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      font-size: 1rem;
      font-weight: 600;
      color: var(--ux-text);
      border-radius: var(--ux-radius-full);
    }

    .ux-calendar-view__day-header--today .ux-calendar-view__day-number {
      background: var(--ux-primary);
      color: white;
    }

    .ux-calendar-view__day-header--selected .ux-calendar-view__day-number {
      background: var(--ux-primary);
      color: white;
    }

    /* ========================================
       Time Grid
    ======================================== */

    .ux-calendar-view__grid {
      display: grid;
      grid-template-columns: var(--ux-cv-time-width) repeat(7, 1fr);
      position: relative;
      max-height: 600px;
      overflow-y: auto;
    }

    .ux-calendar-view__grid--single {
      grid-template-columns: var(--ux-cv-time-width) 1fr;
    }

    .ux-calendar-view__times {
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-calendar-view__time {
      height: var(--ux-cv-hour-height);
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;
      padding: 0 0.5rem;
      font-size: 0.75rem;
      color: var(--ux-text-tertiary);
      transform: translateY(-0.5em);
    }

    .ux-calendar-view__day-column {
      position: relative;
      border-right: 1px solid var(--ux-border-color);
      min-height: calc(var(--ux-cv-hour-height) * 24);
    }

    .ux-calendar-view__day-column:last-child {
      border-right: none;
    }

    .ux-calendar-view__hour-slot {
      height: var(--ux-cv-hour-height);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-calendar-view__hour-slot:last-child {
      border-bottom: none;
    }

    /* Half hour line */
    .ux-calendar-view__hour-slot::after {
      content: '';
      display: block;
      height: 50%;
      border-bottom: 1px dashed var(--ux-gray-100);
    }

    /* ========================================
       Current Time Indicator
    ======================================== */

    .ux-calendar-view__now-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--ux-danger);
      z-index: 5;
      pointer-events: none;
    }

    .ux-calendar-view__now-line::before {
      content: '';
      position: absolute;
      left: -5px;
      top: -4px;
      width: 10px;
      height: 10px;
      background: var(--ux-danger);
      border-radius: 50%;
    }

    /* ========================================
       Events
    ======================================== */

    .ux-calendar-view__event {
      position: absolute;
      left: 2px;
      right: 2px;
      padding: 0.25rem 0.5rem;
      border-radius: var(--ux-radius-sm);
      font-size: 0.75rem;
      overflow: hidden;
      cursor: pointer;
      z-index: 2;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-calendar-view__event:hover {
      z-index: 3;
      box-shadow: var(--ux-shadow-md);
    }

    .ux-calendar-view__event-title {
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-calendar-view__event-time {
      font-size: 0.6875rem;
      opacity: 0.8;
    }

    /* Event Colors */
    .ux-calendar-view__event--primary {
      background: rgba(var(--ux-primary-rgb), 0.9);
      color: white;
      border-left: 3px solid var(--ux-primary-shade);
    }

    .ux-calendar-view__event--success {
      background: rgba(var(--ux-success-rgb), 0.9);
      color: white;
      border-left: 3px solid var(--ux-green-600);
    }

    .ux-calendar-view__event--danger {
      background: rgba(var(--ux-danger-rgb), 0.9);
      color: white;
      border-left: 3px solid var(--ux-red-600);
    }

    .ux-calendar-view__event--warning {
      background: rgba(var(--ux-warning-rgb), 0.9);
      color: var(--ux-gray-900);
      border-left: 3px solid var(--ux-yellow-600);
    }

    .ux-calendar-view__event--secondary {
      background: rgba(var(--ux-gray-500-rgb, 107, 114, 128), 0.9);
      color: white;
      border-left: 3px solid var(--ux-gray-600);
    }

    /* All-day events */
    .ux-calendar-view__all-day {
      display: grid;
      grid-template-columns: var(--ux-cv-time-width) repeat(7, 1fr);
      padding: 0.25rem 0;
      border-bottom: 1px solid var(--ux-border-color);
      background: var(--ux-surface-secondary);
    }

    .ux-calendar-view__all-day--single {
      grid-template-columns: var(--ux-cv-time-width) 1fr;
    }

    .ux-calendar-view__all-day-label {
      font-size: 0.6875rem;
      color: var(--ux-text-tertiary);
      padding: 0.25rem 0.5rem;
      text-align: right;
    }

    .ux-calendar-view__all-day-events {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      padding: 0 0.25rem;
    }

    .ux-calendar-view__all-day-event {
      padding: 0.125rem 0.5rem;
      border-radius: var(--ux-radius-sm);
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
    }

    /* ========================================
       Empty State
    ======================================== */

    .ux-calendar-view__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      text-align: center;
      color: var(--ux-text-secondary);
    }

    .ux-calendar-view__empty-icon {
      width: 48px;
      height: 48px;
      margin-bottom: 1rem;
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-calendar-view {
        --ux-cv-time-width: 45px;
        --ux-cv-hour-height: 50px;
      }

      .ux-calendar-view__header {
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .ux-calendar-view__day-headers {
        grid-template-columns: var(--ux-cv-time-width) repeat(7, 1fr);
      }

      .ux-calendar-view__day-name {
        font-size: 0.625rem;
      }

      .ux-calendar-view__day-number {
        width: 28px;
        height: 28px;
        font-size: 0.875rem;
      }

      .ux-calendar-view__view-toggle {
        order: -1;
        width: 100%;
        justify-content: center;
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-calendar-view {
        background: var(--ux-surface);
        border-color: var(--ux-border-color);
      }

      .ux-calendar-view__hour-slot::after {
        border-color: var(--ux-gray-800);
      }
    }

    .ux-dark .ux-calendar-view {
      background: var(--ux-surface);
      border-color: var(--ux-border-color);
    }

    .ux-dark .ux-calendar-view__hour-slot::after {
      border-color: var(--ux-gray-800);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-calendar-view__nav-btn,
      .ux-calendar-view__today-btn,
      .ux-calendar-view__view-btn,
      .ux-calendar-view__event {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-calendar-views-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-calendar-views-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Icons
  const icons = {
    chevronLeft: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>',
    chevronRight: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>',
    calendar: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>'
  };

  // Day names
  const dayNames = ['Dom', 'Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b'];
  const dayNamesLong = ['Domingo', 'Lunes', 'Martes', 'MiÃ©rcoles', 'Jueves', 'Viernes', 'SÃ¡bado'];
  const monthNames = [
    'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
  ];

  // Alpine.js component
  const calendarViewData = (options = {}) => ({
    // Configuration
    view: options.view || 'week', // 'week', 'day'
    startHour: options.startHour ?? 0,
    endHour: options.endHour ?? 24,
    hourHeight: options.hourHeight || 60,
    events: options.events || [],

    // State
    currentDate: options.initialDate ? new Date(options.initialDate) : new Date(),
    selectedDate: null,
    nowLineTop: 0,
    icons,
    dayNames,
    dayNamesLong,
    monthNames,

    init() {
      this.selectedDate = new Date(this.currentDate);
      this.updateNowLine();

      // Update now line every minute
      this._nowInterval = setInterval(() => {
        this.updateNowLine();
      }, 60000);
    },

    destroy() {
      if (this._nowInterval) {
        clearInterval(this._nowInterval);
      }
    },

    // Get title
    get title() {
      if (this.view === 'day') {
        return `${this.dayNamesLong[this.currentDate.getDay()]}, ${this.currentDate.getDate()} de ${this.monthNames[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`;
      }

      const weekStart = this.getWeekStart(this.currentDate);
      const weekEnd = new Date(weekStart);
      weekEnd.setDate(weekEnd.getDate() + 6);

      if (weekStart.getMonth() === weekEnd.getMonth()) {
        return `${weekStart.getDate()} - ${weekEnd.getDate()} de ${this.monthNames[weekStart.getMonth()]} ${weekStart.getFullYear()}`;
      }

      return `${weekStart.getDate()} ${this.monthNames[weekStart.getMonth()].substring(0, 3)} - ${weekEnd.getDate()} ${this.monthNames[weekEnd.getMonth()].substring(0, 3)} ${weekEnd.getFullYear()}`;
    },

    // Get week start (Sunday)
    getWeekStart(date) {
      const d = new Date(date);
      const day = d.getDay();
      d.setDate(d.getDate() - day);
      return d;
    },

    // Get days for week view
    get weekDays() {
      const days = [];
      const weekStart = this.getWeekStart(this.currentDate);

      for (let i = 0; i < 7; i++) {
        const d = new Date(weekStart);
        d.setDate(d.getDate() + i);
        days.push({
          date: d,
          name: this.dayNames[d.getDay()],
          number: d.getDate(),
          isToday: this.isToday(d),
          isSelected: this.isSameDay(d, this.selectedDate)
        });
      }

      return days;
    },

    // Get hours
    get hours() {
      const hours = [];
      for (let i = this.startHour; i < this.endHour; i++) {
        hours.push({
          value: i,
          label: `${i.toString().padStart(2, '0')}:00`
        });
      }
      return hours;
    },

    // Check if date is today
    isToday(date) {
      const today = new Date();
      return this.isSameDay(date, today);
    },

    // Check if two dates are same day
    isSameDay(d1, d2) {
      return d1.getFullYear() === d2.getFullYear() &&
             d1.getMonth() === d2.getMonth() &&
             d1.getDate() === d2.getDate();
    },

    // Navigate
    prev() {
      if (this.view === 'day') {
        this.currentDate.setDate(this.currentDate.getDate() - 1);
      } else {
        this.currentDate.setDate(this.currentDate.getDate() - 7);
      }
      this.currentDate = new Date(this.currentDate);
      this.$dispatch('calendar:navigate', { date: this.currentDate, view: this.view });
    },

    next() {
      if (this.view === 'day') {
        this.currentDate.setDate(this.currentDate.getDate() + 1);
      } else {
        this.currentDate.setDate(this.currentDate.getDate() + 7);
      }
      this.currentDate = new Date(this.currentDate);
      this.$dispatch('calendar:navigate', { date: this.currentDate, view: this.view });
    },

    goToToday() {
      this.currentDate = new Date();
      this.selectedDate = new Date();
      this.$dispatch('calendar:navigate', { date: this.currentDate, view: this.view });
    },

    setView(view) {
      this.view = view;
      this.$dispatch('calendar:viewchange', { view });
    },

    selectDay(date) {
      this.selectedDate = date;
      if (this.view === 'week') {
        this.currentDate = new Date(date);
        this.view = 'day';
      }
      this.$dispatch('calendar:dayselect', { date });
    },

    // Update now line position
    updateNowLine() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const totalMinutes = hours * 60 + minutes;
      const startMinutes = this.startHour * 60;

      this.nowLineTop = ((totalMinutes - startMinutes) / 60) * this.hourHeight;
    },

    // Get events for a specific day
    getEventsForDay(date) {
      return this.events.filter(event => {
        const eventDate = new Date(event.start);
        return this.isSameDay(eventDate, date) && !event.allDay;
      });
    },

    // Get all-day events for a specific day
    getAllDayEventsForDay(date) {
      return this.events.filter(event => {
        const eventDate = new Date(event.start);
        return this.isSameDay(eventDate, date) && event.allDay;
      });
    },

    // Get event position and height
    getEventStyle(event) {
      const start = new Date(event.start);
      const end = new Date(event.end);

      const startHour = start.getHours();
      const startMinutes = start.getMinutes();
      const endHour = end.getHours();
      const endMinutes = end.getMinutes();

      const top = ((startHour - this.startHour) * 60 + startMinutes) / 60 * this.hourHeight;
      const duration = ((endHour - startHour) * 60 + (endMinutes - startMinutes)) / 60 * this.hourHeight;

      return {
        top: `${top}px`,
        height: `${Math.max(duration, 20)}px`
      };
    },

    // Format time
    formatTime(date) {
      const d = new Date(date);
      return `${d.getHours().toString().padStart(2, '0')}:${d.getMinutes().toString().padStart(2, '0')}`;
    },

    // Add event
    addEvent(event) {
      this.events.push(event);
      this.$dispatch('calendar:eventadd', { event });
    },

    // Remove event
    removeEvent(eventId) {
      const index = this.events.findIndex(e => e.id === eventId);
      if (index !== -1) {
        const event = this.events.splice(index, 1)[0];
        this.$dispatch('calendar:eventremove', { event });
      }
    },

    // Click event handler
    onEventClick(event) {
      this.$dispatch('calendar:eventclick', { event });
    },

    // Set events
    setEvents(events) {
      this.events = events;
    },

    // Check if current day column should show now line
    shouldShowNowLine(date) {
      return this.isToday(date);
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxCalendarView', calendarViewData);
  }

})();

/**
 * UX Calendar Component
 * Monthly calendar view with date selection, range selection, and events
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Calendar Container
       ========================================================================== */

    :root {
      --ux-calendar-width: 320px;
      --ux-calendar-cell-size: 40px;
      --ux-calendar-gap: 2px;
      --ux-calendar-radius: var(--ux-radius-xl);
      --ux-calendar-padding: var(--ux-space-md);
    }

    .ux-calendar {
      width: var(--ux-calendar-width);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-calendar-radius);
      overflow: hidden;
      user-select: none;
    }

    /* ==========================================================================
       Header
       ========================================================================== */

    .ux-calendar__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-calendar-padding);
      background: var(--ux-surface);
    }

    .ux-calendar__title {
      font-size: 1.0625rem;
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-calendar__nav {
      display: flex;
      gap: var(--ux-space-xs);
    }

    .ux-calendar__nav-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: var(--ux-surface-secondary);
      border: none;
      border-radius: var(--ux-radius-md);
      color: var(--ux-text);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-calendar__nav-btn:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-calendar__nav-btn:active {
      transform: scale(0.95);
    }

    .ux-calendar__nav-btn svg {
      width: 16px;
      height: 16px;
    }

    /* ==========================================================================
       Weekdays
       ========================================================================== */

    .ux-calendar__weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: var(--ux-calendar-gap);
      padding: 0 var(--ux-calendar-padding);
      padding-bottom: var(--ux-space-xs);
    }

    .ux-calendar__weekday {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 32px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
    }

    /* ==========================================================================
       Days Grid
       ========================================================================== */

    .ux-calendar__days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: var(--ux-calendar-gap);
      padding: 0 var(--ux-calendar-padding);
      padding-bottom: var(--ux-calendar-padding);
    }

    .ux-calendar__day {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-calendar-cell-size);
      height: var(--ux-calendar-cell-size);
      font-size: 0.9375rem;
      color: var(--ux-text);
      background: transparent;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-calendar__day:hover:not(.ux-calendar__day--disabled):not(.ux-calendar__day--selected) {
      background: var(--ux-surface-secondary);
    }

    .ux-calendar__day:active:not(.ux-calendar__day--disabled) {
      transform: scale(0.9);
    }

    /* Day States */
    .ux-calendar__day--other-month {
      color: var(--ux-text-tertiary);
    }

    .ux-calendar__day--today {
      font-weight: 600;
      color: var(--ux-primary);
    }

    .ux-calendar__day--today::after {
      content: '';
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 4px;
      background: var(--ux-primary);
      border-radius: 50%;
    }

    .ux-calendar__day--selected {
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
      font-weight: 500;
    }

    .ux-calendar__day--selected::after {
      display: none;
    }

    .ux-calendar__day--disabled {
      color: var(--ux-text-tertiary);
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-calendar__day--weekend {
      color: var(--ux-danger);
    }

    .ux-calendar__day--weekend.ux-calendar__day--other-month {
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       Range Selection
       ========================================================================== */

    .ux-calendar__day--range-start {
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-radius: 50% 0 0 50%;
    }

    .ux-calendar__day--range-end {
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-radius: 0 50% 50% 0;
    }

    .ux-calendar__day--range-start.ux-calendar__day--range-end {
      border-radius: 50%;
    }

    .ux-calendar__day--in-range {
      background: var(--ux-primary-tint);
      border-radius: 0;
    }

    .ux-calendar__day--range-hover {
      background: var(--ux-primary-tint);
    }

    /* ==========================================================================
       Event Indicators
       ========================================================================== */

    .ux-calendar__day-events {
      position: absolute;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 2px;
    }

    .ux-calendar__day-event {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--ux-primary);
    }

    .ux-calendar__day-event--success { background: var(--ux-success); }
    .ux-calendar__day-event--warning { background: var(--ux-warning); }
    .ux-calendar__day-event--danger { background: var(--ux-danger); }

    .ux-calendar__day--selected .ux-calendar__day-event {
      background: var(--ux-primary-contrast);
    }

    /* ==========================================================================
       Footer
       ========================================================================== */

    .ux-calendar__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm) var(--ux-calendar-padding);
      background: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-calendar__today-btn {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ux-primary);
      background: transparent;
      border: none;
      cursor: pointer;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-radius: var(--ux-radius-md);
      transition: background var(--ux-transition-fast);
    }

    .ux-calendar__today-btn:hover {
      background: var(--ux-primary-tint);
    }

    .ux-calendar__clear-btn {
      font-size: 0.875rem;
      color: var(--ux-text-secondary);
      background: transparent;
      border: none;
      cursor: pointer;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-radius: var(--ux-radius-md);
      transition: background var(--ux-transition-fast);
    }

    .ux-calendar__clear-btn:hover {
      background: var(--ux-surface-tertiary);
    }

    /* ==========================================================================
       Month/Year Picker
       ========================================================================== */

    .ux-calendar__picker {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--ux-space-sm);
      padding: var(--ux-calendar-padding);
    }

    .ux-calendar__picker-item {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 44px;
      font-size: 0.9375rem;
      color: var(--ux-text);
      background: transparent;
      border: none;
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-calendar__picker-item:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-calendar__picker-item--selected {
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-calendar__picker-item--current {
      font-weight: 600;
      color: var(--ux-primary);
    }

    /* ==========================================================================
       Size Variants
       ========================================================================== */

    .ux-calendar--sm {
      --ux-calendar-width: 280px;
      --ux-calendar-cell-size: 32px;
    }

    .ux-calendar--lg {
      --ux-calendar-width: 380px;
      --ux-calendar-cell-size: 48px;
    }

    .ux-calendar--full {
      --ux-calendar-width: 100%;
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-calendar--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    .ux-calendar--glass .ux-calendar__header,
    .ux-calendar--glass .ux-calendar__footer {
      background: transparent;
    }

    .ux-calendar--glass .ux-calendar__nav-btn {
      background: rgba(255, 255, 255, 0.1);
    }

    .ux-calendar--glass .ux-calendar__nav-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* ==========================================================================
       Inline Variant (no border/shadow)
       ========================================================================== */

    .ux-calendar--inline {
      border: none;
      box-shadow: none;
      background: transparent;
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      .ux-calendar--glass .ux-calendar__nav-btn {
        background: rgba(255, 255, 255, 0.08);
      }

      .ux-calendar--glass .ux-calendar__nav-btn:hover {
        background: rgba(255, 255, 255, 0.15);
      }
    }

    .ux-dark .ux-calendar--glass .ux-calendar__nav-btn {
      background: rgba(255, 255, 255, 0.08);
    }

    .ux-dark .ux-calendar--glass .ux-calendar__nav-btn:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-calendar__day,
      .ux-calendar__nav-btn,
      .ux-calendar__picker-item {
        transition: none;
      }
    }
  `;

  // Navigation icons
  const icons = {
    prev: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M15 18l-6-6 6-6"/>
    </svg>`,
    next: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M9 18l6-6-6-6"/>
    </svg>`
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-calendar-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-calendar-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const calendarData = (options = {}) => ({
    // Configuration
    locale: options.locale || 'es',
    firstDayOfWeek: options.firstDayOfWeek ?? 1, // 0 = Sunday, 1 = Monday
    minDate: options.minDate ? new Date(options.minDate) : null,
    maxDate: options.maxDate ? new Date(options.maxDate) : null,
    disabledDates: options.disabledDates || [],
    disabledDays: options.disabledDays || [], // 0-6 (Sunday-Saturday)
    events: options.events || [],
    range: options.range ?? false,
    showFooter: options.showFooter ?? true,
    showOtherMonths: options.showOtherMonths ?? true,
    highlightWeekends: options.highlightWeekends ?? false,

    // State
    currentDate: new Date(),
    selectedDate: options.value ? new Date(options.value) : null,
    rangeStart: options.rangeStart ? new Date(options.rangeStart) : null,
    rangeEnd: options.rangeEnd ? new Date(options.rangeEnd) : null,
    hoverDate: null,
    view: 'days', // 'days', 'months', 'years'
    icons: icons,

    // Weekday names
    get weekdays() {
      const days = ['D', 'L', 'M', 'X', 'J', 'V', 'S'];
      const reordered = [];
      for (let i = 0; i < 7; i++) {
        reordered.push(days[(this.firstDayOfWeek + i) % 7]);
      }
      return reordered;
    },

    // Month names
    get monthNames() {
      return ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
              'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
    },

    get shortMonthNames() {
      return ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
              'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
    },

    // Current month/year display
    get currentMonthYear() {
      return `${this.monthNames[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`;
    },

    // Generate calendar days
    get calendarDays() {
      const year = this.currentDate.getFullYear();
      const month = this.currentDate.getMonth();

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);

      const days = [];

      // Days from previous month
      let startDay = firstDay.getDay() - this.firstDayOfWeek;
      if (startDay < 0) startDay += 7;

      for (let i = startDay - 1; i >= 0; i--) {
        const date = new Date(year, month, -i);
        days.push(this.createDayObject(date, true));
      }

      // Days of current month
      for (let i = 1; i <= lastDay.getDate(); i++) {
        const date = new Date(year, month, i);
        days.push(this.createDayObject(date, false));
      }

      // Days from next month
      const remaining = 42 - days.length; // 6 rows Ã 7 days
      for (let i = 1; i <= remaining; i++) {
        const date = new Date(year, month + 1, i);
        days.push(this.createDayObject(date, true));
      }

      return days;
    },

    // Create day object with all states
    createDayObject(date, isOtherMonth) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      date.setHours(0, 0, 0, 0);

      const dayOfWeek = date.getDay();
      const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

      return {
        date: new Date(date),
        day: date.getDate(),
        isOtherMonth,
        isToday: date.getTime() === today.getTime(),
        isSelected: this.isDateSelected(date),
        isDisabled: this.isDateDisabled(date),
        isWeekend,
        isRangeStart: this.isRangeStart(date),
        isRangeEnd: this.isRangeEnd(date),
        isInRange: this.isInRange(date),
        isRangeHover: this.isInRangeHover(date),
        events: this.getEventsForDate(date)
      };
    },

    // Check if date is selected
    isDateSelected(date) {
      if (this.range) {
        return this.isRangeStart(date) || this.isRangeEnd(date);
      }
      if (!this.selectedDate) return false;
      return date.getTime() === this.selectedDate.getTime();
    },

    // Check if date is disabled
    isDateDisabled(date) {
      // Check min/max
      if (this.minDate && date < this.minDate) return true;
      if (this.maxDate && date > this.maxDate) return true;

      // Check disabled days of week
      if (this.disabledDays.includes(date.getDay())) return true;

      // Check disabled specific dates
      const dateStr = this.formatDate(date);
      return this.disabledDates.some(d => {
        if (typeof d === 'string') return d === dateStr;
        if (d instanceof Date) return d.getTime() === date.getTime();
        return false;
      });
    },

    // Range helpers
    isRangeStart(date) {
      if (!this.range || !this.rangeStart) return false;
      return date.getTime() === this.rangeStart.getTime();
    },

    isRangeEnd(date) {
      if (!this.range || !this.rangeEnd) return false;
      return date.getTime() === this.rangeEnd.getTime();
    },

    isInRange(date) {
      if (!this.range || !this.rangeStart || !this.rangeEnd) return false;
      return date > this.rangeStart && date < this.rangeEnd;
    },

    isInRangeHover(date) {
      if (!this.range || !this.rangeStart || this.rangeEnd || !this.hoverDate) return false;
      const start = this.rangeStart;
      const end = this.hoverDate;
      if (start < end) {
        return date > start && date <= end;
      } else {
        return date >= end && date < start;
      }
    },

    // Get events for a date
    getEventsForDate(date) {
      const dateStr = this.formatDate(date);
      return this.events.filter(event => {
        const eventDate = typeof event.date === 'string' ? event.date : this.formatDate(event.date);
        return eventDate === dateStr;
      });
    },

    // Format date as YYYY-MM-DD
    formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    },

    // Navigation
    prevMonth() {
      this.currentDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() - 1, 1);
      this.$dispatch('calendar:navigate', { date: new Date(this.currentDate), direction: 'prev' });
    },

    nextMonth() {
      this.currentDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 1);
      this.$dispatch('calendar:navigate', { date: new Date(this.currentDate), direction: 'next' });
    },

    goToToday() {
      this.currentDate = new Date();
      this.currentDate.setHours(0, 0, 0, 0);
      this.$dispatch('calendar:today');
    },

    goToDate(date) {
      this.currentDate = new Date(date);
      this.currentDate.setHours(0, 0, 0, 0);
    },

    // Selection
    selectDate(dayObj) {
      if (dayObj.isDisabled) return;

      const date = new Date(dayObj.date);
      date.setHours(0, 0, 0, 0);

      if (this.range) {
        this.selectRange(date);
      } else {
        this.selectedDate = date;
        this.$dispatch('calendar:select', {
          date: new Date(date),
          formatted: this.formatDate(date)
        });
      }

      // Navigate to month if clicking other month day
      if (dayObj.isOtherMonth) {
        this.goToDate(date);
      }
    },

    selectRange(date) {
      if (!this.rangeStart || (this.rangeStart && this.rangeEnd)) {
        // Start new range
        this.rangeStart = date;
        this.rangeEnd = null;
        this.$dispatch('calendar:range-start', {
          start: new Date(date),
          formatted: this.formatDate(date)
        });
      } else {
        // Complete range
        if (date < this.rangeStart) {
          this.rangeEnd = this.rangeStart;
          this.rangeStart = date;
        } else {
          this.rangeEnd = date;
        }
        this.$dispatch('calendar:range-select', {
          start: new Date(this.rangeStart),
          end: new Date(this.rangeEnd),
          startFormatted: this.formatDate(this.rangeStart),
          endFormatted: this.formatDate(this.rangeEnd)
        });
      }
    },

    clearSelection() {
      this.selectedDate = null;
      this.rangeStart = null;
      this.rangeEnd = null;
      this.hoverDate = null;
      this.$dispatch('calendar:clear');
    },

    // Hover for range preview
    onDayHover(dayObj) {
      if (this.range && this.rangeStart && !this.rangeEnd) {
        this.hoverDate = dayObj.date;
      }
    },

    onDayLeave() {
      this.hoverDate = null;
    },

    // View switching
    showMonthPicker() {
      this.view = 'months';
    },

    showYearPicker() {
      this.view = 'years';
    },

    selectMonth(month) {
      this.currentDate = new Date(this.currentDate.getFullYear(), month, 1);
      this.view = 'days';
    },

    selectYear(year) {
      this.currentDate = new Date(year, this.currentDate.getMonth(), 1);
      this.view = 'months';
    },

    get years() {
      const currentYear = this.currentDate.getFullYear();
      const startYear = currentYear - 6;
      const years = [];
      for (let i = 0; i < 12; i++) {
        years.push(startYear + i);
      }
      return years;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxCalendar', calendarData);
  }
})();

/**
 * UX Callout Component
 * Info boxes and callouts for documentation and alerts
 * Similar to GitHub/documentation callouts with iOS 26 Liquid Glass design
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Callout - Info Box Component
    ======================================== */

    .ux-callout {
      position: relative;
      display: flex;
      align-items: flex-start;
      gap: var(--ux-space-md);
      padding: var(--ux-space-lg);
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius-lg);
      border: 1px solid var(--ux-border-color);
      border-left-width: 4px;
      border-left-color: var(--ux-primary);
      margin: var(--ux-space-lg) 0;
      transition:
        opacity var(--ux-transition-normal) var(--ux-ease-default),
        transform var(--ux-transition-normal) var(--ux-ease-default);
    }

    /* ========================================
       Callout Icon
    ======================================== */

    .ux-callout__icon {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      color: var(--ux-primary);
    }

    .ux-callout__icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Callout Content
    ======================================== */

    .ux-callout__content {
      flex: 1;
      min-width: 0;
    }

    .ux-callout__title {
      font-size: var(--ux-font-size-md);
      font-weight: var(--ux-font-weight-semibold);
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
      line-height: 1.4;
    }

    .ux-callout__text {
      font-size: var(--ux-font-size-base);
      color: var(--ux-text-secondary);
      margin: 0;
      line-height: 1.6;
    }

    .ux-callout__text p {
      margin: 0 0 var(--ux-space-sm);
    }

    .ux-callout__text p:last-child {
      margin-bottom: 0;
    }

    .ux-callout__text a {
      color: var(--ux-primary);
      text-decoration: underline;
    }

    .ux-callout__text a:hover {
      text-decoration: none;
    }

    .ux-callout__text code {
      padding: 2px 6px;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: var(--ux-border-radius-sm);
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
      font-size: 0.9em;
    }

    /* When no title, remove extra spacing */
    .ux-callout__content > .ux-callout__text:first-child {
      margin-top: 0;
    }

    /* ========================================
       Close Button
    ======================================== */

    .ux-callout__close {
      position: absolute;
      top: var(--ux-space-sm);
      right: var(--ux-space-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      padding: 0;
      background: none;
      border: none;
      border-radius: var(--ux-border-radius-sm);
      color: var(--ux-text-tertiary);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease-default),
        color var(--ux-transition-fast) var(--ux-ease-default);
    }

    .ux-callout__close:hover {
      background-color: rgba(0, 0, 0, 0.05);
      color: var(--ux-text);
    }

    .ux-callout__close:active {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .ux-callout__close svg {
      width: 16px;
      height: 16px;
    }

    /* Add padding-right when close button is present */
    .ux-callout--dismissible {
      padding-right: calc(var(--ux-space-lg) + 32px);
    }

    /* ========================================
       Color Variants
    ======================================== */

    /* Info (default - uses primary color) */
    .ux-callout--info {
      background-color: rgba(var(--ux-info-rgb), 0.08);
      border-color: rgba(var(--ux-info-rgb), 0.2);
      border-left-color: var(--ux-info);
    }

    .ux-callout--info .ux-callout__icon {
      color: var(--ux-info);
    }

    .ux-callout--info .ux-callout__title {
      color: var(--ux-info-shade);
    }

    /* Success */
    .ux-callout--success {
      background-color: rgba(var(--ux-success-rgb), 0.08);
      border-color: rgba(var(--ux-success-rgb), 0.2);
      border-left-color: var(--ux-success);
    }

    .ux-callout--success .ux-callout__icon {
      color: var(--ux-success);
    }

    .ux-callout--success .ux-callout__title {
      color: var(--ux-success-shade);
    }

    /* Warning */
    .ux-callout--warning {
      background-color: rgba(var(--ux-warning-rgb), 0.08);
      border-color: rgba(var(--ux-warning-rgb), 0.2);
      border-left-color: var(--ux-warning);
    }

    .ux-callout--warning .ux-callout__icon {
      color: var(--ux-warning);
    }

    .ux-callout--warning .ux-callout__title {
      color: var(--ux-warning-shade);
    }

    /* Danger */
    .ux-callout--danger {
      background-color: rgba(var(--ux-danger-rgb), 0.08);
      border-color: rgba(var(--ux-danger-rgb), 0.2);
      border-left-color: var(--ux-danger);
    }

    .ux-callout--danger .ux-callout__icon {
      color: var(--ux-danger);
    }

    .ux-callout--danger .ux-callout__title {
      color: var(--ux-danger-shade);
    }

    /* Neutral */
    .ux-callout--neutral {
      background-color: var(--ux-surface-secondary);
      border-color: var(--ux-border-color);
      border-left-color: var(--ux-medium);
    }

    .ux-callout--neutral .ux-callout__icon {
      color: var(--ux-text-secondary);
    }

    .ux-callout--neutral .ux-callout__title {
      color: var(--ux-text);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    .ux-callout--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      border-left-width: 4px;
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
    }

    .ux-callout--glass.ux-callout--info {
      border-left-color: var(--ux-info);
    }

    .ux-callout--glass.ux-callout--success {
      border-left-color: var(--ux-success);
    }

    .ux-callout--glass.ux-callout--warning {
      border-left-color: var(--ux-warning);
    }

    .ux-callout--glass.ux-callout--danger {
      border-left-color: var(--ux-danger);
    }

    .ux-callout--glass.ux-callout--neutral {
      border-left-color: var(--ux-medium);
    }

    .ux-callout--glass .ux-callout__close:hover {
      background-color: rgba(var(--ux-text-rgb, 0, 0, 0), 0.05);
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-callout--glass {
        background-color: var(--ux-surface);
      }
    }

    /* ========================================
       Bordered Variant (full border, no left accent)
    ======================================== */

    .ux-callout--bordered {
      border-left-width: 1px;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-callout--sm {
      padding: var(--ux-space-md);
      gap: var(--ux-space-sm);
    }

    .ux-callout--sm .ux-callout__icon {
      width: 20px;
      height: 20px;
    }

    .ux-callout--sm .ux-callout__title {
      font-size: var(--ux-font-size-base);
    }

    .ux-callout--sm .ux-callout__text {
      font-size: var(--ux-font-size-sm);
    }

    .ux-callout--sm.ux-callout--dismissible {
      padding-right: calc(var(--ux-space-md) + 28px);
    }

    .ux-callout--lg {
      padding: var(--ux-space-xl);
      gap: var(--ux-space-lg);
    }

    .ux-callout--lg .ux-callout__icon {
      width: 28px;
      height: 28px;
    }

    .ux-callout--lg .ux-callout__title {
      font-size: var(--ux-font-size-lg);
      margin-bottom: var(--ux-space-sm);
    }

    .ux-callout--lg .ux-callout__text {
      font-size: var(--ux-font-size-md);
    }

    .ux-callout--lg.ux-callout--dismissible {
      padding-right: calc(var(--ux-space-xl) + 36px);
    }

    /* ========================================
       Inline Variant (compact, no margin)
    ======================================== */

    .ux-callout--inline {
      margin: 0;
      display: inline-flex;
    }

    /* ========================================
       Dismissed State
    ======================================== */

    .ux-callout--dismissed {
      opacity: 0;
      transform: translateX(-10px);
      pointer-events: none;
    }

    .ux-callout--hidden {
      display: none;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light):not(.ux-theme-light) .ux-callout--info {
        background-color: rgba(var(--ux-info-rgb), 0.12);
        border-color: rgba(var(--ux-info-rgb), 0.25);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-callout--info .ux-callout__title {
        color: var(--ux-info-tint);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-callout--success {
        background-color: rgba(var(--ux-success-rgb), 0.12);
        border-color: rgba(var(--ux-success-rgb), 0.25);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-callout--success .ux-callout__title {
        color: var(--ux-success-tint);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-callout--warning {
        background-color: rgba(var(--ux-warning-rgb), 0.12);
        border-color: rgba(var(--ux-warning-rgb), 0.25);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-callout--warning .ux-callout__title {
        color: var(--ux-warning-tint);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-callout--danger {
        background-color: rgba(var(--ux-danger-rgb), 0.12);
        border-color: rgba(var(--ux-danger-rgb), 0.25);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-callout--danger .ux-callout__title {
        color: var(--ux-danger-tint);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-callout__text code {
        background-color: rgba(255, 255, 255, 0.08);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-callout__close:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-callout--glass .ux-callout__close:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
    }

    /* Manual dark mode class */
    .ux-dark .ux-callout--info,
    .ux-theme-dark .ux-callout--info {
      background-color: rgba(var(--ux-info-rgb), 0.12);
      border-color: rgba(var(--ux-info-rgb), 0.25);
    }

    .ux-dark .ux-callout--info .ux-callout__title,
    .ux-theme-dark .ux-callout--info .ux-callout__title {
      color: var(--ux-info-tint);
    }

    .ux-dark .ux-callout--success,
    .ux-theme-dark .ux-callout--success {
      background-color: rgba(var(--ux-success-rgb), 0.12);
      border-color: rgba(var(--ux-success-rgb), 0.25);
    }

    .ux-dark .ux-callout--success .ux-callout__title,
    .ux-theme-dark .ux-callout--success .ux-callout__title {
      color: var(--ux-success-tint);
    }

    .ux-dark .ux-callout--warning,
    .ux-theme-dark .ux-callout--warning {
      background-color: rgba(var(--ux-warning-rgb), 0.12);
      border-color: rgba(var(--ux-warning-rgb), 0.25);
    }

    .ux-dark .ux-callout--warning .ux-callout__title,
    .ux-theme-dark .ux-callout--warning .ux-callout__title {
      color: var(--ux-warning-tint);
    }

    .ux-dark .ux-callout--danger,
    .ux-theme-dark .ux-callout--danger {
      background-color: rgba(var(--ux-danger-rgb), 0.12);
      border-color: rgba(var(--ux-danger-rgb), 0.25);
    }

    .ux-dark .ux-callout--danger .ux-callout__title,
    .ux-theme-dark .ux-callout--danger .ux-callout__title {
      color: var(--ux-danger-tint);
    }

    .ux-dark .ux-callout__text code,
    .ux-theme-dark .ux-callout__text code {
      background-color: rgba(255, 255, 255, 0.08);
    }

    .ux-dark .ux-callout__close:hover,
    .ux-theme-dark .ux-callout__close:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .ux-dark .ux-callout--glass .ux-callout__close:hover,
    .ux-theme-dark .ux-callout--glass .ux-callout__close:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-callout {
        transition: opacity 0.1s ease;
      }

      .ux-callout--dismissed {
        transform: none;
      }

      .ux-callout__close {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-callout-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-callout-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for callout with dismiss functionality
  // ARIA: role="note" for informational callouts, "alert" for warnings/errors
  const calloutComponent = (config = {}) => ({
    visible: config.visible !== false,
    dismissible: config.dismissible !== false,
    dismissed: false,
    type: config.type || 'info',

    // ARIA attributes based on callout type
    get ariaAttrs() {
      const isUrgent = this.type === 'danger' || this.type === 'warning';
      return {
        'role': isUrgent ? 'alert' : 'note',
        'aria-live': isUrgent ? 'assertive' : 'polite'
      };
    },

    init() {
      // Listen for escape key if dismissible
      if (this.dismissible) {
        this._keyHandler = (e) => {
          if (e.key === 'Escape' && document.activeElement === this.$el) {
            this.dismiss();
          }
        };
        this.$el.addEventListener('keydown', this._keyHandler);
      }
    },

    destroy() {
      if (this._keyHandler) {
        this.$el.removeEventListener('keydown', this._keyHandler);
      }
    },

    dismiss() {
      if (!this.dismissible) return;

      this.dismissed = true;
      this.$dispatch('callout:dismiss');

      // Remove from DOM after animation
      setTimeout(() => {
        this.visible = false;
        this.$dispatch('callout:dismissed');
      }, 200);
    },

    show() {
      this.visible = true;
      this.dismissed = false;
      this.$dispatch('callout:show');
    },

    hide() {
      this.visible = false;
      this.$dispatch('callout:hide');
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxCallout', calloutComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxCallout', calloutComponent);
    });
  }
})();

/**
 * UX Card Component
 * Cards estilo Ionic/iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Card
    ======================================== */

    .ux-card {
      position: relative;
      display: flex;
      flex-direction: column;
      background-color: var(--ux-surface);
      border-radius: var(--ux-card-border-radius);
      box-shadow: var(--ux-shadow-sm);
      overflow: hidden;
      margin: var(--ux-card-margin-x) 0;
      min-height: var(--ux-card-min-height);
      max-height: var(--ux-card-max-height);
    }

    /* ========================================
       Card Header
    ======================================== */

    .ux-card__header {
      display: flex;
      align-items: center;
      padding: var(--ux-card-padding);
      gap: var(--ux-space-md);
    }

    .ux-card__header--bordered {
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-card__avatar {
      flex-shrink: 0;
    }

    .ux-card__header-content,
    .ux-card__header-text {
      flex: 1;
      min-width: 0;
    }

    .ux-card__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      line-height: 1.3;
    }

    .ux-card__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: var(--ux-space-xs) 0 0;
      line-height: 1.4;
    }

    .ux-card__header-actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      flex-shrink: 0;
      margin-left: auto;
    }

    /* ========================================
       Card Media
    ======================================== */

    .ux-card__media {
      position: relative;
      overflow: hidden;
    }

    .ux-card__media img,
    .ux-card__media video {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }

    .ux-card__media--top {
      order: -1;
    }

    .ux-card__media--square {
      aspect-ratio: 1 / 1;
    }

    .ux-card__media--wide {
      aspect-ratio: 16 / 9;
    }

    .ux-card__media--portrait {
      aspect-ratio: 3 / 4;
    }

    .ux-card__media-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: var(--ux-card-padding);
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
      color: white;
    }

    .ux-card__media-overlay .ux-card__title {
      color: white;
    }

    .ux-card__media-overlay .ux-card__subtitle {
      color: rgba(255, 255, 255, 0.8);
    }

    /* ========================================
       Card Body (optional wrapper for padding)
    ======================================== */

    .ux-card__body {
      padding: var(--ux-card-padding);
    }

    .ux-card__body .ux-card__header,
    .ux-card__body .ux-card__content,
    .ux-card__body .ux-card__footer {
      padding-left: 0;
      padding-right: 0;
    }

    .ux-card__body .ux-card__header:first-child {
      padding-top: 0;
    }

    .ux-card__body .ux-card__footer:last-child {
      padding-bottom: 0;
    }

    /* ========================================
       Card Content
    ======================================== */

    .ux-card__content {
      padding: var(--ux-space-lg);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      line-height: 1.6;
    }

    .ux-card__content p {
      margin: 0 0 var(--ux-space-md);
    }

    .ux-card__content p:last-child {
      margin-bottom: 0;
    }

    .ux-card__header + .ux-card__content {
      padding-top: 0;
    }

    /* ========================================
       Card Footer
    ======================================== */

    .ux-card__footer {
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: var(--ux-space-md) var(--ux-space-lg);
      gap: var(--ux-space-sm);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-card__footer--transparent {
      border-top: none;
      background: transparent;
    }

    .ux-card__footer-start {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-card__footer-end {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      margin-left: auto;
    }

    /* ========================================
       Card Actions (buttons row)
    ======================================== */

    .ux-card__actions {
      display: flex;
      align-items: center;
      padding: var(--ux-space-sm) var(--ux-space-md);
      gap: var(--ux-space-sm);
    }

    .ux-card__actions--full {
      flex-direction: column;
    }

    .ux-card__actions--full .ux-button {
      width: 100%;
    }

    .ux-card__actions--space-between {
      justify-content: space-between;
    }

    .ux-card__actions--end {
      justify-content: flex-end;
    }

    /* ========================================
       Variants
    ======================================== */

    /* Outlined */
    .ux-card--outline {
      box-shadow: none;
      border: 1px solid var(--ux-border-color);
    }

    /* Flat */
    .ux-card--flat {
      box-shadow: none;
      border-radius: 0;
    }

    /* Elevated */
    .ux-card--elevated {
      box-shadow: var(--ux-shadow-lg);
    }

    /* Inset (iOS grouped style) */
    .ux-card--inset {
      margin-left: var(--ux-space-lg);
      margin-right: var(--ux-space-lg);
    }

    /* Full width */
    .ux-card--full {
      margin-left: 0;
      margin-right: 0;
      border-radius: 0;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-card--glass {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-card--glass .ux-card__header--bordered {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-card--glass .ux-card__footer {
      border-top-color: var(--ux-glass-border);
    }

    .ux-card--glass.ux-card--clickable:hover {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight), 0 12px 40px rgba(0, 0, 0, 0.12);
    }

    /* ========================================
       Clickable Card
    ======================================== */

    .ux-card--clickable {
      cursor: pointer;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-card--clickable:hover {
      box-shadow: var(--ux-shadow-md);
    }

    .ux-card--clickable:active {
      transform: scale(0.98);
    }

    /* ========================================
       Color Variants (Composition System)
       Use: .ux-card.ux-color-primary, .ux-card.ux-color-success, etc.
    ======================================== */

    .ux-card[class*="ux-color-"] {
      background-color: var(--ux-variant-bg);
      color: var(--ux-variant-color);
    }

    .ux-card[class*="ux-color-"] .ux-card__title,
    .ux-card[class*="ux-color-"] .ux-card__content {
      color: var(--ux-variant-color);
    }

    .ux-card[class*="ux-color-"] .ux-card__subtitle {
      color: var(--ux-variant-color);
      opacity: 0.8;
    }

    /* ========================================
       Legacy Color Variants (deprecated, use composition)
    ======================================== */

    .ux-card--primary {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-card--primary .ux-card__title,
    .ux-card--primary .ux-card__content {
      color: var(--ux-primary-contrast);
    }

    .ux-card--primary .ux-card__subtitle {
      color: rgba(255, 255, 255, 0.8);
    }

    .ux-card--secondary {
      background-color: var(--ux-secondary);
      color: var(--ux-secondary-contrast);
    }

    .ux-card--success {
      background-color: var(--ux-success);
      color: var(--ux-success-contrast);
    }

    .ux-card--warning {
      background-color: var(--ux-warning);
      color: var(--ux-warning-contrast);
    }

    .ux-card--danger {
      background-color: var(--ux-danger);
      color: var(--ux-danger-contrast);
    }

    /* ========================================
       Card Sizes
    ======================================== */

    .ux-card--sm .ux-card__header,
    .ux-card--sm .ux-card__content,
    .ux-card--sm .ux-card__footer {
      padding: var(--ux-space-md);
    }

    .ux-card--sm .ux-card__title {
      font-size: var(--ux-font-size-md);
    }

    .ux-card--lg .ux-card__header,
    .ux-card--lg .ux-card__content,
    .ux-card--lg .ux-card__footer {
      padding: var(--ux-space-xl);
    }

    .ux-card--lg .ux-card__title {
      font-size: var(--ux-font-size-xl);
    }

    /* ========================================
       Horizontal Card
    ======================================== */

    .ux-card--horizontal {
      flex-direction: row;
    }

    .ux-card--horizontal .ux-card__media {
      width: 120px;
      flex-shrink: 0;
    }

    .ux-card--horizontal .ux-card__media img {
      height: 100%;
      object-fit: cover;
    }

    .ux-card--horizontal .ux-card__body {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 0;
    }

    @media (max-width: 480px) {
      .ux-card--horizontal {
        flex-direction: column;
      }

      .ux-card--horizontal .ux-card__media {
        width: 100%;
      }
    }

    /* ========================================
       Card Grid
    ======================================== */

    .ux-card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--ux-space-lg);
      padding: var(--ux-space-md);
    }

    .ux-card-grid .ux-card {
      margin: 0;
    }

    /* ========================================
       Card Stack
    ======================================== */

    .ux-card-stack {
      position: relative;
    }

    .ux-card-stack .ux-card {
      margin: 0;
    }

    .ux-card-stack .ux-card:not(:first-child) {
      margin-top: calc(-1 * var(--ux-space-lg));
      padding-top: calc(var(--ux-space-lg) + var(--ux-space-md));
      border-top-left-radius: var(--ux-border-radius-xl);
      border-top-right-radius: var(--ux-border-radius-xl);
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-card--loading {
      pointer-events: none;
    }

    .ux-card--loading::after {
      content: '';
      position: absolute;
      inset: 0;
      background-color: rgba(255, 255, 255, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-card--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* ========================================
       Card Content - Centered variant (Ionic style)
       Use for icon cards with avatar/icon + name + badge
    ======================================== */

    .ux-card__content--centered {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    /* Avatar inside centered content */
    .ux-card__content--centered .ux-avatar {
      margin-bottom: var(--ux-space-md);
    }

    /* Name text */
    .ux-card__content--centered .ux-card__name {
      font-weight: 500;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      line-height: 1.3;
      margin: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }

    /* Badge/chip container */
    .ux-card__content--centered .ux-badge,
    .ux-card__content--centered .ux-chip {
      margin-top: var(--ux-space-sm);
    }

    /* ========================================
       Icon Card (component/feature card style)
       Supports icons, avatars, or any element
    ======================================== */

    .ux-card--icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: var(--ux-space-lg);
      text-decoration: none;
      cursor: pointer;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-card--icon:hover {
      transform: translateY(-2px);
      box-shadow: var(--ux-shadow-lg);
      border-color: var(--ux-primary);
    }

    .ux-card--icon:active {
      transform: translateY(0) scale(0.98);
    }

    /* Generic slot for icon, avatar, or any element */
    .ux-card__slot {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: var(--ux-space-md);
      flex-shrink: 0;
    }

    /* Legacy .ux-card__icon support + default icon styling */
    .ux-card__icon,
    .ux-card__slot--icon {
      width: 48px;
      height: 48px;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-primary);
      flex-shrink: 0;
    }

    .ux-card__icon svg,
    .ux-card__slot--icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-card__name {
      font-weight: 500;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      line-height: 1.3;
      margin: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Description - now supports any content (text, badges, etc.) */
    .ux-card__description {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xs);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-sm);
    }

    /* When description contains only text */
    .ux-card__description--text {
      display: block;
    }

    /* Icon card sizes */
    .ux-card--icon.ux-card--sm {
      padding: var(--ux-space-md);
    }

    .ux-card--icon.ux-card--sm .ux-card__icon,
    .ux-card--icon.ux-card--sm .ux-card__slot--icon {
      width: 32px;
      height: 32px;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-card--icon.ux-card--sm .ux-card__slot {
      margin-bottom: var(--ux-space-sm);
    }

    .ux-card--icon.ux-card--sm .ux-card__name {
      font-size: var(--ux-font-size-xs);
    }

    .ux-card--icon.ux-card--sm .ux-card__description {
      margin-top: var(--ux-space-xs);
    }

    .ux-card--icon.ux-card--lg {
      padding: var(--ux-space-xl);
    }

    .ux-card--icon.ux-card--lg .ux-card__icon,
    .ux-card--icon.ux-card--lg .ux-card__slot--icon {
      width: 64px;
      height: 64px;
      margin-bottom: var(--ux-space-lg);
    }

    .ux-card--icon.ux-card--lg .ux-card__slot {
      margin-bottom: var(--ux-space-lg);
    }

    .ux-card--icon.ux-card--lg .ux-card__name {
      font-size: var(--ux-font-size-md);
    }

    .ux-card--icon.ux-card--lg .ux-card__description {
      margin-top: var(--ux-space-md);
    }

    /* Icon card color variants (icon-only, not background) */
    .ux-card--icon.ux-card--icon-success .ux-card__icon,
    .ux-card--icon.ux-card--icon-success .ux-card__slot--icon {
      color: var(--ux-success);
    }

    .ux-card--icon.ux-card--icon-success:hover {
      border-color: var(--ux-success);
    }

    .ux-card--icon.ux-card--icon-warning .ux-card__icon,
    .ux-card--icon.ux-card--icon-warning .ux-card__slot--icon {
      color: var(--ux-warning);
    }

    .ux-card--icon.ux-card--icon-warning:hover {
      border-color: var(--ux-warning);
    }

    .ux-card--icon.ux-card--icon-danger .ux-card__icon,
    .ux-card--icon.ux-card--icon-danger .ux-card__slot--icon {
      color: var(--ux-danger);
    }

    .ux-card--icon.ux-card--icon-danger:hover {
      border-color: var(--ux-danger);
    }

    .ux-card--icon.ux-card--icon-secondary .ux-card__icon,
    .ux-card--icon.ux-card--icon-secondary .ux-card__slot--icon {
      color: var(--ux-secondary);
    }

    .ux-card--icon.ux-card--icon-secondary:hover {
      border-color: var(--ux-secondary);
    }

    .ux-card--icon.ux-card--icon-tertiary .ux-card__icon,
    .ux-card--icon.ux-card--icon-tertiary .ux-card__slot--icon {
      color: var(--ux-tertiary);
    }

    .ux-card--icon.ux-card--icon-tertiary:hover {
      border-color: var(--ux-tertiary);
    }

    /* Icon card grid */
    .ux-card-grid--icon {
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: var(--ux-space-md);
    }

    .ux-card-grid--icon .ux-card {
      margin: 0;
    }

    /* ========================================
       App Icon Card (iOS-style launcher icons)
    ======================================== */

    .ux-card--app {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      text-decoration: none;
      color: inherit;
      padding: var(--ux-space-md) var(--ux-space-sm);
      border-radius: var(--ux-border-radius);
      background: transparent;
      box-shadow: none;
      margin: 0;
      cursor: pointer;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease),
        background-color var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
      /* Reset button styles when used as button */
      border: none;
      font-family: inherit;
    }

    .ux-card--app:hover {
      background-color: rgba(0, 0, 0, 0.04);
      transform: scale(1.02);
    }

    .ux-card--app:active {
      transform: scale(0.95);
    }

    /* App icon - iOS rounded square */
    .ux-card--app .ux-card__icon {
      width: 60px;
      height: 60px;
      border-radius: 13.5px; /* iOS corner radius: 22.5% */
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: var(--ux-space-sm);
      background: linear-gradient(
        135deg,
        var(--ux-card-app-color, var(--ux-primary)) 0%,
        var(--ux-card-app-shade, var(--ux-primary-shade)) 100%
      );
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2);
      color: #fff;
      position: relative;
      flex-shrink: 0;
    }

    .ux-card--app .ux-card__icon svg {
      width: 28px;
      height: 28px;
      fill: currentColor;
    }

    /* Text content in icon (e.g., initials) */
    .ux-card--app .ux-card__icon > span {
      font-size: 18px;
      font-weight: 600;
      color: inherit;
      line-height: 1;
    }

    /* App icon name */
    .ux-card--app .ux-card__name {
      font-size: 12px;
      font-weight: 500;
      line-height: 1.2;
      max-width: 80px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: var(--ux-text);
    }

    /* App icon sizes */
    .ux-card--app.ux-card--sm .ux-card__icon {
      width: 48px;
      height: 48px;
      border-radius: 10.8px;
    }

    .ux-card--app.ux-card--sm .ux-card__icon svg {
      width: 22px;
      height: 22px;
    }

    .ux-card--app.ux-card--sm .ux-card__name {
      font-size: 11px;
      max-width: 64px;
    }

    .ux-card--app.ux-card--lg .ux-card__icon {
      width: 72px;
      height: 72px;
      border-radius: 16px;
    }

    .ux-card--app.ux-card--lg .ux-card__icon svg {
      width: 32px;
      height: 32px;
    }

    .ux-card--app.ux-card--lg .ux-card__name {
      font-size: 13px;
      max-width: 90px;
    }

    .ux-card--app.ux-card--xl .ux-card__icon {
      width: 84px;
      height: 84px;
      border-radius: 18.9px;
    }

    .ux-card--app.ux-card--xl .ux-card__icon svg {
      width: 38px;
      height: 38px;
    }

    .ux-card--app.ux-card--xl .ux-card__name {
      font-size: 14px;
      max-width: 100px;
    }

    /* App icon color variants */
    .ux-card--app.ux-card--app-primary .ux-card__icon {
      --ux-card-app-color: var(--ux-primary);
      --ux-card-app-shade: var(--ux-primary-shade);
    }

    .ux-card--app.ux-card--app-secondary .ux-card__icon {
      --ux-card-app-color: var(--ux-secondary);
      --ux-card-app-shade: var(--ux-secondary-shade);
    }

    .ux-card--app.ux-card--app-tertiary .ux-card__icon {
      --ux-card-app-color: var(--ux-tertiary);
      --ux-card-app-shade: var(--ux-tertiary-shade);
    }

    .ux-card--app.ux-card--app-success .ux-card__icon {
      --ux-card-app-color: var(--ux-success);
      --ux-card-app-shade: var(--ux-success-shade);
    }

    .ux-card--app.ux-card--app-warning .ux-card__icon {
      --ux-card-app-color: var(--ux-warning);
      --ux-card-app-shade: var(--ux-warning-shade);
    }

    .ux-card--app.ux-card--app-danger .ux-card__icon {
      --ux-card-app-color: var(--ux-danger);
      --ux-card-app-shade: var(--ux-danger-shade);
    }

    .ux-card--app.ux-card--app-dark .ux-card__icon {
      --ux-card-app-color: var(--ux-dark, #334155);
      --ux-card-app-shade: var(--ux-dark-shade, #1e293b);
    }

    .ux-card--app.ux-card--app-medium .ux-card__icon {
      --ux-card-app-color: var(--ux-medium, #94a3b8);
      --ux-card-app-shade: var(--ux-medium-shade, #64748b);
    }

    /* Dashed/outline variant for "Add" buttons */
    .ux-card--app .ux-card__icon--dashed,
    .ux-card--app .ux-card__icon--outline {
      background: transparent;
      border: 2px dashed var(--ux-border-color);
      box-shadow: none;
      color: var(--ux-text-secondary);
    }

    .ux-card--app .ux-card__icon--outline {
      border-style: solid;
    }

    .ux-card--app:hover .ux-card__icon--dashed,
    .ux-card--app:hover .ux-card__icon--outline {
      border-color: var(--ux-primary);
      color: var(--ux-primary);
    }

    /* Favorite badge */
    .ux-card--app .ux-card__favorite {
      position: absolute;
      top: -4px;
      right: -4px;
      color: var(--ux-warning);
      filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
    }

    .ux-card--app .ux-card__favorite svg {
      width: 14px;
      height: 14px;
    }

    /* Notification badge */
    .ux-card--app .ux-card__badge {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 18px;
      height: 18px;
      padding: 0 5px;
      border-radius: 9px;
      background-color: var(--ux-danger);
      color: white;
      font-size: 11px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    /* App card grid */
    .ux-card-grid--app {
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: var(--ux-space-sm);
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
      :root:not(.ux-theme-light):not(.ux-light) .ux-card--app:hover {
        background-color: rgba(255, 255, 255, 0.06);
      }

      :root:not(.ux-theme-light):not(.ux-light) .ux-card--app .ux-card__icon {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
      }

      :root:not(.ux-theme-light):not(.ux-light) .ux-card--app .ux-card__icon--dashed,
      :root:not(.ux-theme-light):not(.ux-light) .ux-card--app .ux-card__icon--outline {
        box-shadow: none;
      }
    }

    .ux-dark .ux-card--app:hover,
    .ux-theme-dark .ux-card--app:hover {
      background-color: rgba(255, 255, 255, 0.06);
    }

    .ux-dark .ux-card--app .ux-card__icon,
    .ux-theme-dark .ux-card--app .ux-card__icon {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-card--clickable {
        transition: none;
      }

      .ux-card--clickable:active {
        transform: none;
      }

      .ux-card--icon {
        transition: none;
      }

      .ux-card--icon:hover {
        transform: none;
      }

      .ux-card--icon:active {
        transform: none;
      }

      .ux-card--app {
        transition: none;
      }

      .ux-card--app:hover {
        transform: none;
      }

      .ux-card--app:active {
        transform: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-card-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-card-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for expandable card
  const cardComponent = (config = {}) => ({
    expanded: config.expanded || false,
    loading: config.loading || false,

    toggle() {
      this.expanded = !this.expanded;
    },

    expand() {
      this.expanded = true;
    },

    collapse() {
      this.expanded = false;
    },

    setLoading(state) {
      this.loading = state;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxCard', cardComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxCard', cardComponent);
    });
  }
})();

/**
 * UX Carousel Component
 * Carrusel con navegacion por flechas
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Carousel Container
    ======================================== */

    .ux-carousel {
      position: relative;
      width: 100%;
      overflow: hidden;
    }

    .ux-carousel__viewport {
      overflow: hidden;
      width: 100%;
    }

    .ux-carousel__track {
      display: flex;
      transition: transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
      will-change: transform;
    }

    /* Variantes de transicion */
    .ux-carousel--smooth .ux-carousel__track {
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .ux-carousel--fast .ux-carousel__track {
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .ux-carousel--spring .ux-carousel__track {
      transition: transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .ux-carousel--dragging .ux-carousel__track {
      transition: none;
      cursor: grabbing;
    }

    .ux-carousel__slide {
      flex-shrink: 0;
      box-sizing: border-box;
    }

    /* Gap between slides */
    .ux-carousel--gap-xs .ux-carousel__slide { padding: 0 var(--ux-space-xs); }
    .ux-carousel--gap-sm .ux-carousel__slide { padding: 0 var(--ux-space-sm); }
    .ux-carousel--gap-md .ux-carousel__slide { padding: 0 var(--ux-space-md); }
    .ux-carousel--gap-lg .ux-carousel__slide { padding: 0 var(--ux-space-lg); }

    /* Negative margin to compensate for padding */
    .ux-carousel--gap-xs .ux-carousel__track { margin: 0 calc(-1 * var(--ux-space-xs)); }
    .ux-carousel--gap-sm .ux-carousel__track { margin: 0 calc(-1 * var(--ux-space-sm)); }
    .ux-carousel--gap-md .ux-carousel__track { margin: 0 calc(-1 * var(--ux-space-md)); }
    .ux-carousel--gap-lg .ux-carousel__track { margin: 0 calc(-1 * var(--ux-space-lg)); }

    /* ========================================
       Navigation Arrows
    ======================================== */

    .ux-carousel__nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: 50%;
      box-shadow: var(--ux-shadow-md);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease),
        opacity var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-carousel__nav:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-carousel__nav:active {
      transform: translateY(-50%) scale(0.95);
    }

    .ux-carousel__nav:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
    }

    .ux-carousel__nav--prev {
      left: var(--ux-space-sm);
    }

    .ux-carousel__nav--next {
      right: var(--ux-space-sm);
    }

    .ux-carousel__nav svg {
      width: 20px;
      height: 20px;
      color: var(--ux-text);
    }

    /* Navigation outside */
    .ux-carousel--nav-outside .ux-carousel__nav--prev {
      left: calc(-1 * (40px + var(--ux-space-md)));
    }

    .ux-carousel--nav-outside .ux-carousel__nav--next {
      right: calc(-1 * (40px + var(--ux-space-md)));
    }

    /* Navigation small */
    .ux-carousel--nav-sm .ux-carousel__nav {
      width: 32px;
      height: 32px;
    }

    .ux-carousel--nav-sm .ux-carousel__nav svg {
      width: 16px;
      height: 16px;
    }

    /* Navigation hidden on mobile */
    @media (max-width: 768px) {
      .ux-carousel--nav-hide-mobile .ux-carousel__nav {
        display: none;
      }
    }

    /* ========================================
       Pagination Dots
    ======================================== */

    .ux-carousel__pagination {
      display: flex;
      justify-content: center;
      gap: var(--ux-space-xs);
      margin-top: var(--ux-space-md);
    }

    .ux-carousel__dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: var(--ux-border-color);
      border: none;
      padding: 0;
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-carousel__dot:hover {
      background-color: var(--ux-text-tertiary);
    }

    .ux-carousel__dot--active {
      background-color: var(--ux-primary);
      transform: scale(1.2);
    }

    /* Pagination lines */
    .ux-carousel--pagination-lines .ux-carousel__dot {
      width: 24px;
      height: 4px;
      border-radius: 2px;
    }

    .ux-carousel--pagination-lines .ux-carousel__dot--active {
      transform: scaleX(1.2);
    }

    /* ========================================
       Slide Widths (Responsive)
    ======================================== */

    /* 1 slide visible */
    .ux-carousel--show-1 .ux-carousel__slide { width: 100%; }

    /* 2 slides visible */
    .ux-carousel--show-2 .ux-carousel__slide { width: 50%; }

    /* 3 slides visible */
    .ux-carousel--show-3 .ux-carousel__slide { width: 33.333333%; }

    /* 4 slides visible */
    .ux-carousel--show-4 .ux-carousel__slide { width: 25%; }

    /* 5 slides visible */
    .ux-carousel--show-5 .ux-carousel__slide { width: 20%; }

    /* 6 slides visible */
    .ux-carousel--show-6 .ux-carousel__slide { width: 16.666666%; }

    /* Responsive breakpoints */
    @media (max-width: 1024px) {
      .ux-carousel--show-lg-1 .ux-carousel__slide { width: 100%; }
      .ux-carousel--show-lg-2 .ux-carousel__slide { width: 50%; }
      .ux-carousel--show-lg-3 .ux-carousel__slide { width: 33.333333%; }
      .ux-carousel--show-lg-4 .ux-carousel__slide { width: 25%; }
    }

    @media (max-width: 768px) {
      .ux-carousel--show-md-1 .ux-carousel__slide { width: 100%; }
      .ux-carousel--show-md-2 .ux-carousel__slide { width: 50%; }
      .ux-carousel--show-md-3 .ux-carousel__slide { width: 33.333333%; }
    }

    @media (max-width: 480px) {
      .ux-carousel--show-sm-1 .ux-carousel__slide { width: 100%; }
      .ux-carousel--show-sm-2 .ux-carousel__slide { width: 50%; }
    }

    /* ========================================
       Peek (Partial slides visible)
    ======================================== */

    .ux-carousel--peek .ux-carousel__viewport {
      overflow: visible;
    }

    .ux-carousel--peek {
      overflow: hidden;
    }

    .ux-carousel--peek-sm .ux-carousel__slide:last-child {
      margin-right: 20px;
    }

    .ux-carousel--peek-md .ux-carousel__slide:last-child {
      margin-right: 40px;
    }

    /* ========================================
       Auto Width
    ======================================== */

    .ux-carousel--auto .ux-carousel__slide {
      width: auto;
    }

    /* ========================================
       Center Mode
    ======================================== */

    .ux-carousel--center .ux-carousel__slide {
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-carousel--center .ux-carousel__slide--active {
      transform: scale(1.05);
      z-index: 1;
    }

    /* ========================================
       Fade Effect
    ======================================== */

    .ux-carousel--fade .ux-carousel__track {
      display: block;
      position: relative;
    }

    .ux-carousel--fade .ux-carousel__slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      opacity: 0;
      transition: opacity var(--ux-transition-base) var(--ux-ease);
    }

    .ux-carousel--fade .ux-carousel__slide--active {
      position: relative;
      opacity: 1;
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-carousel--loading .ux-carousel__track {
      opacity: 0;
    }

    .ux-carousel--loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 32px;
      height: 32px;
      border: 3px solid var(--ux-border-color);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-carousel-spin 0.8s linear infinite;
    }

    @keyframes ux-carousel-spin {
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .ux-carousel__track {
        transition: none;
      }

      .ux-carousel--smooth .ux-carousel__track,
      .ux-carousel--fast .ux-carousel__track,
      .ux-carousel--spring .ux-carousel__track {
        transition: none;
      }

      .ux-carousel--fade .ux-carousel__slide {
        transition: opacity 0.1s ease;
      }

      .ux-carousel--center .ux-carousel__slide {
        transition: none;
      }

      .ux-carousel--loading::after {
        animation: none;
      }
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-carousel--glass .ux-carousel__nav-button {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-carousel--glass .ux-carousel__nav-button:hover {
      background: var(--ux-glass-bg-thick);
    }

    .ux-carousel--glass .ux-carousel__pagination {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-radius: 100px;
      padding: var(--ux-space-xs) var(--ux-space-sm);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-carousel-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-carousel-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component
  // ARIA: group role, aria-roledescription, aria-label for navigation
  const carouselComponent = (config = {}) => ({
    currentIndex: 0,
    slidesCount: 0,
    slidesPerView: config.slidesPerView || 1,
    loop: config.loop || false,
    autoplay: config.autoplay || false,
    autoplayInterval: config.autoplayInterval || 5000,
    showPagination: config.showPagination !== false,
    showNavigation: config.showNavigation !== false,
    draggable: config.draggable !== false,
    _autoplayTimer: null,
    _startX: 0,
    _currentX: 0,
    _isDragging: false,
    _trackEl: null,
    carouselId: config.id || 'ux-carousel-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for the carousel container
    get ariaAttrs() {
      return {
        'role': 'group',
        'aria-roledescription': 'carousel',
        'aria-label': config.ariaLabel || 'Carousel'
      };
    },

    // ARIA attributes for navigation prev button
    get prevButtonAriaAttrs() {
      return {
        'aria-label': 'Previous slide',
        'aria-controls': this.carouselId + '-track'
      };
    },

    // ARIA attributes for navigation next button
    get nextButtonAriaAttrs() {
      return {
        'aria-label': 'Next slide',
        'aria-controls': this.carouselId + '-track'
      };
    },

    // ARIA attributes for slide
    getSlideAriaAttrs(index) {
      return {
        'role': 'group',
        'aria-roledescription': 'slide',
        'aria-label': `Slide ${index + 1} of ${this.slidesCount}`
      };
    },

    // ARIA attributes for pagination dot
    getDotAriaAttrs(pageIndex) {
      const isCurrentPage = this.getCurrentPage() === pageIndex;
      return {
        'role': 'button',
        'aria-label': `Go to slide ${pageIndex + 1}`,
        'aria-current': isCurrentPage ? 'true' : 'false'
      };
    },

    get trackId() {
      return this.carouselId + '-track';
    },

    init() {
      this.$nextTick(() => {
        this._trackEl = this.$refs.track;
        if (this._trackEl) {
          this.slidesCount = this._trackEl.children.length;
        }

        // Setup touch/mouse events for dragging
        if (this.draggable) {
          this.setupDrag();
        }

        // Start autoplay
        if (this.autoplay) {
          this.startAutoplay();
        }

        // Dispatch init event
        this.$dispatch('ux-carousel:init', {
          slidesCount: this.slidesCount,
          currentIndex: this.currentIndex
        });
      });
    },

    destroy() {
      this.stopAutoplay();
    },

    get canGoPrev() {
      if (this.loop) return true;
      return this.currentIndex > 0;
    },

    get canGoNext() {
      if (this.loop) return true;
      return this.currentIndex < this.maxIndex;
    },

    get maxIndex() {
      return Math.max(0, this.slidesCount - this.slidesPerView);
    },

    get translateX() {
      const slideWidth = 100 / this.slidesPerView;
      return -(this.currentIndex * slideWidth);
    },

    get paginationDots() {
      // Show dots for each "page"
      const pages = Math.ceil(this.slidesCount / this.slidesPerView);
      return Array.from({ length: pages }, (_, i) => i);
    },

    prev() {
      if (!this.canGoPrev && !this.loop) return;

      if (this.currentIndex === 0 && this.loop) {
        this.currentIndex = this.maxIndex;
      } else {
        this.currentIndex = Math.max(0, this.currentIndex - 1);
      }

      this.$dispatch('ux-carousel:change', {
        index: this.currentIndex,
        direction: 'prev'
      });

      // Reset autoplay timer
      if (this.autoplay) {
        this.stopAutoplay();
        this.startAutoplay();
      }
    },

    next() {
      if (!this.canGoNext && !this.loop) return;

      if (this.currentIndex >= this.maxIndex && this.loop) {
        this.currentIndex = 0;
      } else {
        this.currentIndex = Math.min(this.maxIndex, this.currentIndex + 1);
      }

      this.$dispatch('ux-carousel:change', {
        index: this.currentIndex,
        direction: 'next'
      });

      // Reset autoplay timer
      if (this.autoplay) {
        this.stopAutoplay();
        this.startAutoplay();
      }
    },

    goTo(index) {
      const targetIndex = Math.max(0, Math.min(this.maxIndex, index));
      if (targetIndex !== this.currentIndex) {
        this.currentIndex = targetIndex;
        this.$dispatch('ux-carousel:change', {
          index: this.currentIndex,
          direction: targetIndex > this.currentIndex ? 'next' : 'prev'
        });
      }
    },

    goToPage(pageIndex) {
      this.goTo(pageIndex * this.slidesPerView);
    },

    getCurrentPage() {
      return Math.floor(this.currentIndex / this.slidesPerView);
    },

    startAutoplay() {
      if (this._autoplayTimer) return;
      this._autoplayTimer = setInterval(() => {
        this.next();
      }, this.autoplayInterval);
    },

    stopAutoplay() {
      if (this._autoplayTimer) {
        clearInterval(this._autoplayTimer);
        this._autoplayTimer = null;
      }
    },

    setupDrag() {
      const viewport = this.$refs.viewport;
      if (!viewport) return;

      // Touch events
      viewport.addEventListener('touchstart', (e) => this.onDragStart(e), { passive: true });
      viewport.addEventListener('touchmove', (e) => this.onDragMove(e), { passive: false });
      viewport.addEventListener('touchend', (e) => this.onDragEnd(e));

      // Mouse events
      viewport.addEventListener('mousedown', (e) => this.onDragStart(e));
      viewport.addEventListener('mousemove', (e) => this.onDragMove(e));
      viewport.addEventListener('mouseup', (e) => this.onDragEnd(e));
      viewport.addEventListener('mouseleave', (e) => this.onDragEnd(e));
    },

    onDragStart(e) {
      this._isDragging = true;
      this._startX = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
      this._currentX = this._startX;
      this.$el.classList.add('ux-carousel--dragging');

      if (this.autoplay) {
        this.stopAutoplay();
      }
    },

    onDragMove(e) {
      if (!this._isDragging) return;

      this._currentX = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
      const diff = this._currentX - this._startX;

      // Apply drag transform
      if (this._trackEl) {
        const baseTranslate = this.translateX;
        const dragPercent = (diff / this.$refs.viewport.offsetWidth) * 100;
        this._trackEl.style.transform = `translateX(${baseTranslate + dragPercent}%)`;
      }

      // Prevent scrolling while dragging horizontally
      if (Math.abs(diff) > 10) {
        e.preventDefault();
      }
    },

    onDragEnd(e) {
      if (!this._isDragging) return;

      this._isDragging = false;
      this.$el.classList.remove('ux-carousel--dragging');

      const diff = this._currentX - this._startX;
      const threshold = this.$refs.viewport.offsetWidth * 0.2; // 20% threshold

      // Reset track transform
      if (this._trackEl) {
        this._trackEl.style.transform = '';
      }

      // Determine direction
      if (diff > threshold) {
        this.prev();
      } else if (diff < -threshold) {
        this.next();
      }

      // Resume autoplay
      if (this.autoplay) {
        this.startAutoplay();
      }
    },

    // Keyboard navigation handler
    handleKeydown(event) {
      switch (event.key) {
        case 'ArrowLeft':
          event.preventDefault();
          this.prev();
          // Announce to screen readers
          if (window.UX && window.UX.announce) {
            window.UX.announce(`Slide ${this.currentIndex + 1} of ${this.slidesCount}`, 'polite');
          }
          break;
        case 'ArrowRight':
          event.preventDefault();
          this.next();
          if (window.UX && window.UX.announce) {
            window.UX.announce(`Slide ${this.currentIndex + 1} of ${this.slidesCount}`, 'polite');
          }
          break;
        case 'Home':
          event.preventDefault();
          this.goTo(0);
          if (window.UX && window.UX.announce) {
            window.UX.announce(`First slide`, 'polite');
          }
          break;
        case 'End':
          event.preventDefault();
          this.goTo(this.maxIndex);
          if (window.UX && window.UX.announce) {
            window.UX.announce(`Last slide`, 'polite');
          }
          break;
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxCarousel', carouselComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxCarousel', carouselComponent);
    });
  }
})();

/**
 * UX Cart Components
 * Shopping cart components for POS and e-commerce
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Cart Container
    ======================================== */

    :root {
      --ux-cart-item-height: auto;
      --ux-cart-item-padding: var(--ux-space-md);
      --ux-cart-border-radius: var(--ux-border-radius-lg);
    }

    .ux-cart {
      display: flex;
      flex-direction: column;
      height: 100%;
      background-color: var(--ux-surface);
      border-radius: var(--ux-cart-border-radius);
      overflow: hidden;
    }

    .ux-cart--bordered {
      border: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Cart Header
    ======================================== */

    .ux-cart__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-cart__title {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-cart__count {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 24px;
      padding: 0 var(--ux-space-xs);
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-radius: 12px;
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
    }

    .ux-cart__clear {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: none;
      border: none;
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-danger);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-cart__clear:hover {
      background-color: rgba(var(--ux-danger-rgb, 255, 59, 48), 0.1);
    }

    .ux-cart__clear svg {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Cart Items List
    ======================================== */

    .ux-cart__items {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
    }

    .ux-cart__items-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    /* ========================================
       Cart Item
    ======================================== */

    .ux-cart-item {
      display: flex;
      align-items: flex-start;
      gap: var(--ux-space-md);
      padding: var(--ux-cart-item-padding);
      border-bottom: 1px solid var(--ux-border-color);
      background-color: var(--ux-surface);
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-cart-item:last-child {
      border-bottom: none;
    }

    .ux-cart-item:hover {
      background-color: var(--ux-surface-secondary);
    }

    /* Item image */
    .ux-cart-item__image {
      width: 56px;
      height: 56px;
      border-radius: var(--ux-border-radius);
      object-fit: cover;
      background-color: var(--ux-surface-secondary);
      flex-shrink: 0;
    }

    .ux-cart-item__image-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 56px;
      height: 56px;
      border-radius: var(--ux-border-radius);
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text-tertiary);
      flex-shrink: 0;
    }

    .ux-cart-item__image-placeholder svg {
      width: 24px;
      height: 24px;
    }

    /* Item content */
    .ux-cart-item__content {
      flex: 1;
      min-width: 0;
    }

    .ux-cart-item__name {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .ux-cart-item__meta {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-cart-item__unit-price {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    /* Item price */
    .ux-cart-item__price {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      text-align: right;
      white-space: nowrap;
      font-variant-numeric: tabular-nums;
    }

    /* Item quantity controls */
    .ux-cart-item__qty {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      margin-top: var(--ux-space-xs);
    }

    .ux-cart-item__qty-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      padding: 0;
      background-color: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      color: var(--ux-text);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-cart-item__qty-btn:hover {
      background-color: var(--ux-surface-tertiary);
      border-color: var(--ux-primary);
    }

    .ux-cart-item__qty-btn:active {
      transform: scale(0.95);
    }

    .ux-cart-item__qty-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .ux-cart-item__qty-btn svg {
      width: 14px;
      height: 14px;
    }

    .ux-cart-item__qty-value {
      min-width: 32px;
      text-align: center;
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
    }

    /* Item remove button */
    .ux-cart-item__remove {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      padding: 0;
      background: none;
      border: none;
      border-radius: var(--ux-border-radius);
      color: var(--ux-text-tertiary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
      margin-left: auto;
    }

    .ux-cart-item__remove:hover {
      background-color: rgba(var(--ux-danger-rgb, 255, 59, 48), 0.1);
      color: var(--ux-danger);
    }

    .ux-cart-item__remove svg {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Compact Item Variant
    ======================================== */

    .ux-cart-item--compact {
      padding: var(--ux-space-sm) var(--ux-space-md);
      gap: var(--ux-space-sm);
    }

    .ux-cart-item--compact .ux-cart-item__image,
    .ux-cart-item--compact .ux-cart-item__image-placeholder {
      width: 40px;
      height: 40px;
    }

    .ux-cart-item--compact .ux-cart-item__name {
      font-size: var(--ux-font-size-xs);
      -webkit-line-clamp: 1;
    }

    /* ========================================
       Swipe to Delete
    ======================================== */

    .ux-cart-item--swipeable {
      position: relative;
      overflow: hidden;
    }

    .ux-cart-item__swipe-action {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 80px;
      background-color: var(--ux-danger);
      color: white;
      transform: translateX(100%);
      transition: transform var(--ux-transition-normal) var(--ux-ease);
    }

    .ux-cart-item--swiped .ux-cart-item__swipe-action {
      transform: translateX(0);
    }

    .ux-cart-item__swipe-action svg {
      width: 24px;
      height: 24px;
    }

    /* ========================================
       Cart Empty State
    ======================================== */

    .ux-cart__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-2xl);
      text-align: center;
      flex: 1;
    }

    .ux-cart__empty-icon {
      width: 64px;
      height: 64px;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-text-tertiary);
    }

    .ux-cart__empty-title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
    }

    .ux-cart__empty-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    /* ========================================
       Cart Summary
    ======================================== */

    .ux-cart-summary {
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-cart-summary__row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-cart-summary__row:last-child {
      margin-bottom: 0;
    }

    .ux-cart-summary__label {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-cart-summary__value {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
    }

    .ux-cart-summary__row--subtotal {
      padding-top: var(--ux-space-sm);
      border-top: 1px dashed var(--ux-border-color);
    }

    .ux-cart-summary__row--total {
      padding-top: var(--ux-space-md);
      margin-top: var(--ux-space-sm);
      border-top: 2px solid var(--ux-border-color);
    }

    .ux-cart-summary__row--total .ux-cart-summary__label {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-cart-summary__row--total .ux-cart-summary__value {
      font-size: var(--ux-font-size-xl);
      font-weight: 700;
      color: var(--ux-primary);
    }

    /* Discount row */
    .ux-cart-summary__row--discount .ux-cart-summary__value {
      color: var(--ux-success);
    }

    /* ========================================
       Cart Actions
    ======================================== */

    .ux-cart__actions {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface);
      border-top: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-cart__actions--row {
      flex-direction: row;
    }

    .ux-cart__actions--row > * {
      flex: 1;
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-cart--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-cart--glass .ux-cart__header,
    .ux-cart--glass .ux-cart-item,
    .ux-cart--glass .ux-cart-summary,
    .ux-cart--glass .ux-cart__actions {
      background: transparent;
      border-color: var(--ux-glass-border);
    }

    .ux-cart--glass .ux-cart-summary {
      background: var(--ux-glass-bg-thin);
    }

    /* ========================================
       Mini Cart (Dropdown)
    ======================================== */

    .ux-cart--mini {
      max-height: 400px;
      width: 320px;
    }

    .ux-cart--mini .ux-cart__items {
      max-height: 240px;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-cart-item__qty-btn {
        border-color: var(--ux-border-color);
      }
    }

    .ux-dark .ux-cart-item__qty-btn {
      border-color: var(--ux-border-color);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-cart__header {
        padding: var(--ux-space-sm) var(--ux-space-md);
      }

      .ux-cart-item {
        padding: var(--ux-space-sm) var(--ux-space-md);
      }

      .ux-cart-summary,
      .ux-cart__actions {
        padding: var(--ux-space-sm) var(--ux-space-md);
      }
    }
  `;

  // Icons
  const icons = {
    plus: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>',
    minus: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg>',
    trash: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>',
    cart: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"/></svg>',
    placeholder: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>'
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-cart-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-cart-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for cart
  const cartComponent = (config = {}) => ({
    // Cart items
    items: config.items || [],

    // Configuration
    currency: config.currency || '$',
    locale: config.locale || 'en-US',
    taxRate: config.taxRate || 0,
    discountAmount: config.discountAmount || 0,
    discountPercent: config.discountPercent || 0,
    shippingCost: config.shippingCost || 0,

    // Labels
    labels: {
      title: config.labels?.title || 'Cart',
      empty: config.labels?.empty || 'Your cart is empty',
      emptyText: config.labels?.emptyText || 'Add products to get started',
      subtotal: config.labels?.subtotal || 'Subtotal',
      tax: config.labels?.tax || 'Tax',
      discount: config.labels?.discount || 'Discount',
      shipping: config.labels?.shipping || 'Shipping',
      total: config.labels?.total || 'Total',
      clearCart: config.labels?.clearCart || 'Clear',
      checkout: config.labels?.checkout || 'Checkout',
      items: config.labels?.items || 'items',
      ...config.labels
    },

    // Computed: Total items count
    get itemCount() {
      return this.items.reduce((sum, item) => sum + (item.quantity || 1), 0);
    },

    // Computed: Subtotal
    get subtotal() {
      return this.items.reduce((sum, item) => {
        const price = item.price || 0;
        const qty = item.quantity || 1;
        return sum + (price * qty);
      }, 0);
    },

    // Computed: Discount
    get discount() {
      if (this.discountAmount > 0) {
        return this.discountAmount;
      }
      if (this.discountPercent > 0) {
        return this.subtotal * (this.discountPercent / 100);
      }
      return 0;
    },

    // Computed: Tax
    get tax() {
      const taxableAmount = this.subtotal - this.discount;
      return taxableAmount * (this.taxRate / 100);
    },

    // Computed: Total
    get total() {
      return this.subtotal - this.discount + this.tax + this.shippingCost;
    },

    // Computed: Is cart empty
    get isEmpty() {
      return this.items.length === 0;
    },

    // Format price
    formatPrice(price) {
      return new Intl.NumberFormat(this.locale, {
        style: 'currency',
        currency: this.getCurrencyCode()
      }).format(price);
    },

    // Get currency code
    getCurrencyCode() {
      const map = { '$': 'USD', 'â¬': 'EUR', 'Â£': 'GBP', 'Â¥': 'JPY' };
      return map[this.currency] || 'USD';
    },

    // Add item to cart
    addItem(product, quantity = 1) {
      const existingIndex = this.items.findIndex(item =>
        item.id === product.id && JSON.stringify(item.options) === JSON.stringify(product.options)
      );

      if (existingIndex > -1) {
        this.items[existingIndex].quantity += quantity;
      } else {
        this.items.push({
          ...product,
          quantity: quantity
        });
      }

      this.$dispatch('cart-update', { items: this.items, total: this.total });
    },

    // Remove item from cart
    removeItem(index) {
      const removed = this.items.splice(index, 1)[0];
      this.$dispatch('cart-item-removed', { item: removed, items: this.items });
      this.$dispatch('cart-update', { items: this.items, total: this.total });
    },

    // Update item quantity
    updateQuantity(index, quantity) {
      if (quantity <= 0) {
        this.removeItem(index);
        return;
      }

      this.items[index].quantity = quantity;
      this.$dispatch('cart-update', { items: this.items, total: this.total });
    },

    // Increment quantity
    incrementQuantity(index) {
      const item = this.items[index];
      const maxQty = item.maxQuantity || Infinity;

      if (item.quantity < maxQty) {
        this.updateQuantity(index, item.quantity + 1);
      }
    },

    // Decrement quantity
    decrementQuantity(index) {
      const item = this.items[index];
      this.updateQuantity(index, item.quantity - 1);
    },

    // Clear cart
    clearCart() {
      this.items = [];
      this.$dispatch('cart-cleared');
      this.$dispatch('cart-update', { items: [], total: 0 });
    },

    // Checkout
    checkout() {
      this.$dispatch('cart-checkout', {
        items: this.items,
        subtotal: this.subtotal,
        discount: this.discount,
        tax: this.tax,
        shipping: this.shippingCost,
        total: this.total
      });
    },

    // Apply discount
    applyDiscount(amount, isPercent = false) {
      if (isPercent) {
        this.discountPercent = amount;
        this.discountAmount = 0;
      } else {
        this.discountAmount = amount;
        this.discountPercent = 0;
      }
      this.$dispatch('cart-update', { items: this.items, total: this.total });
    },

    // Clear discount
    clearDiscount() {
      this.discountAmount = 0;
      this.discountPercent = 0;
      this.$dispatch('cart-update', { items: this.items, total: this.total });
    },

    // Get icon
    getIcon(name) {
      return icons[name] || '';
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxCart', cartComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxCart', cartComponent);
    });
  }
})();

/**
 * UX Category Tabs Component
 * Horizontal scrolling category tabs for POS systems
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Category Tabs
       Horizontal scrolling tabs for POS product categories
    ======================================== */

    :root {
      --ux-category-tabs-height: 48px;
      --ux-category-tabs-gap: var(--ux-space-sm);
      --ux-category-tabs-padding: var(--ux-space-sm) var(--ux-space-md);
      --ux-category-tabs-item-padding: var(--ux-space-sm) var(--ux-space-lg);
      --ux-category-tabs-font-size: var(--ux-font-size-sm);
      --ux-category-tabs-border-radius: var(--ux-radius-md, 8px);
      --ux-category-tabs-indicator-height: 3px;
    }

    .ux-category-tabs {
      display: flex;
      align-items: center;
      gap: var(--ux-category-tabs-gap);
      padding: var(--ux-category-tabs-padding);
      background-color: var(--ux-surface);
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
      position: relative;
    }

    /* Hide scrollbar but allow scroll */
    .ux-category-tabs {
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .ux-category-tabs::-webkit-scrollbar {
      display: none;
    }

    /* ========================================
       Category Tab Item
    ======================================== */

    .ux-category-tabs__item {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 0 0 auto;
      min-height: var(--ux-category-tabs-height);
      padding: var(--ux-category-tabs-item-padding);
      background: transparent;
      border: none;
      color: var(--ux-text-secondary);
      font-family: var(--ux-font-family);
      font-size: var(--ux-category-tabs-font-size);
      font-weight: 500;
      white-space: nowrap;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        color var(--ux-transition-fast) var(--ux-ease-default),
        background-color var(--ux-transition-fast) var(--ux-ease-default),
        transform 150ms var(--ux-ease-default);
    }

    .ux-category-tabs__item:hover {
      color: var(--ux-text);
    }

    .ux-category-tabs__item:active {
      transform: scale(0.96);
    }

    /* Active state */
    .ux-category-tabs__item--active {
      color: var(--ux-primary);
    }

    /* Disabled state */
    .ux-category-tabs__item--disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    /* ========================================
       Tab Item Icon
    ======================================== */

    .ux-category-tabs__icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      margin-right: var(--ux-space-xs);
    }

    .ux-category-tabs__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-category-tabs__item--icon-only .ux-category-tabs__icon {
      margin-right: 0;
    }

    .ux-category-tabs__item--icon-only .ux-category-tabs__label {
      display: none;
    }

    /* ========================================
       Tab Item Label
    ======================================== */

    .ux-category-tabs__label {
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ========================================
       Sliding Indicator (Underline)
    ======================================== */

    .ux-category-tabs--indicator {
      position: relative;
    }

    .ux-category-tabs__indicator {
      position: absolute;
      bottom: 0;
      height: var(--ux-category-tabs-indicator-height);
      background-color: var(--ux-primary);
      border-radius: var(--ux-category-tabs-indicator-height) var(--ux-category-tabs-indicator-height) 0 0;
      transition:
        left 300ms cubic-bezier(0.4, 0.0, 0.2, 1),
        width 300ms cubic-bezier(0.4, 0.0, 0.2, 1);
      will-change: left, width;
    }

    /* ========================================
       Pill Variant (Rounded)
    ======================================== */

    .ux-category-tabs--pill {
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs);
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-lg, 12px);
    }

    .ux-category-tabs--pill .ux-category-tabs__item {
      min-height: 36px;
      padding: var(--ux-space-xs) var(--ux-space-md);
      border-radius: 100px;
    }

    .ux-category-tabs--pill .ux-category-tabs__item--active {
      background-color: var(--ux-surface);
      color: var(--ux-text);
      box-shadow: var(--ux-shadow-sm);
    }

    .ux-category-tabs--pill .ux-category-tabs__indicator {
      display: none;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
       Note: backdrop-filter comes from universal selector [class*="--glass"] in ux-core.js
    ======================================== */

    .ux-category-tabs--glass {
      background: var(--ux-glass-bg);
      border-bottom: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }

    .ux-category-tabs--glass .ux-category-tabs__item--active {
      color: var(--ux-text);
    }

    .ux-category-tabs--glass .ux-category-tabs__indicator {
      background: var(--ux-glass-bg-thick);
      box-shadow: var(--ux-glass-shadow);
    }

    /* Glass + Pill combo */
    .ux-category-tabs--glass.ux-category-tabs--pill {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
      border-radius: var(--ux-radius-lg, 12px);
    }

    .ux-category-tabs--glass.ux-category-tabs--pill .ux-category-tabs__item--active {
      background: var(--ux-glass-bg-thick);
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-category-tabs--sm {
      --ux-category-tabs-height: 36px;
      --ux-category-tabs-item-padding: var(--ux-space-xs) var(--ux-space-md);
      --ux-category-tabs-font-size: var(--ux-font-size-xs);
      --ux-category-tabs-indicator-height: 2px;
    }

    .ux-category-tabs--sm .ux-category-tabs__icon {
      width: 16px;
      height: 16px;
    }

    .ux-category-tabs--lg {
      --ux-category-tabs-height: 56px;
      --ux-category-tabs-item-padding: var(--ux-space-md) var(--ux-space-xl);
      --ux-category-tabs-font-size: var(--ux-font-size-md);
      --ux-category-tabs-indicator-height: 4px;
    }

    .ux-category-tabs--lg .ux-category-tabs__icon {
      width: 24px;
      height: 24px;
    }

    /* ========================================
       Border Variant (with bottom border)
    ======================================== */

    .ux-category-tabs--bordered {
      border-bottom: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-category-tabs--primary .ux-category-tabs__item--active {
      color: var(--ux-primary);
    }

    .ux-category-tabs--primary .ux-category-tabs__indicator {
      background-color: var(--ux-primary);
    }

    .ux-category-tabs--success .ux-category-tabs__item--active {
      color: var(--ux-success);
    }

    .ux-category-tabs--success .ux-category-tabs__indicator {
      background-color: var(--ux-success);
    }

    .ux-category-tabs--danger .ux-category-tabs__item--active {
      color: var(--ux-danger);
    }

    .ux-category-tabs--danger .ux-category-tabs__indicator {
      background-color: var(--ux-danger);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-category-tabs {
        background-color: var(--ux-surface);
      }

      .ux-category-tabs--pill {
        background-color: var(--ux-surface-secondary);
      }

      .ux-category-tabs--pill .ux-category-tabs__item--active {
        background-color: var(--ux-surface-tertiary);
      }
    }

    .ux-dark .ux-category-tabs {
      background-color: var(--ux-surface);
    }

    .ux-dark .ux-category-tabs--pill {
      background-color: var(--ux-surface-secondary);
    }

    .ux-dark .ux-category-tabs--pill .ux-category-tabs__item--active {
      background-color: var(--ux-surface-tertiary);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-category-tabs {
        scroll-behavior: auto;
      }

      .ux-category-tabs__item {
        transition: none;
      }

      .ux-category-tabs__indicator {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-category-tabs-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-category-tabs-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for category tabs
  const categoryTabsComponent = (config = {}) => ({
    activeTab: config.activeTab || config.value || null,
    categories: config.categories || [],
    indicatorStyle: {},
    scrollOnSelect: config.scrollOnSelect !== false,

    init() {
      // Set first category as default if no active tab
      if (this.activeTab === null && this.categories.length > 0) {
        this.activeTab = this.categories[0].value || this.categories[0].id || 0;
      }
      this.$nextTick(() => {
        this.updateIndicator();
        this.scrollToActiveTab();
      });
    },

    selectTab(value) {
      const category = this.categories.find(c => (c.value || c.id) === value);
      if (category?.disabled) return;
      if (this.activeTab === value) return;

      this.activeTab = value;
      this.updateIndicator();

      if (this.scrollOnSelect) {
        this.scrollToTab(value);
      }

      this.$dispatch('category-change', { value, category });
    },

    scrollToTab(value) {
      const container = this.$refs.container || this.$el;
      if (!container) return;

      const index = this.categories.findIndex(c => (c.value || c.id) === value);
      const buttons = container.querySelectorAll('.ux-category-tabs__item');
      const targetButton = buttons[index];

      if (targetButton) {
        const containerRect = container.getBoundingClientRect();
        const buttonRect = targetButton.getBoundingClientRect();

        // Calculate scroll position to center the tab
        const scrollLeft = targetButton.offsetLeft - (containerRect.width / 2) + (buttonRect.width / 2);

        container.scrollTo({
          left: Math.max(0, scrollLeft),
          behavior: 'smooth'
        });
      }
    },

    scrollToActiveTab() {
      if (this.activeTab !== null) {
        this.scrollToTab(this.activeTab);
      }
    },

    isActive(value) {
      return this.activeTab === value;
    },

    updateIndicator() {
      const container = this.$refs.container || this.$el;
      if (!container) return;

      const index = this.categories.findIndex(c => (c.value || c.id) === this.activeTab);
      const buttons = container.querySelectorAll('.ux-category-tabs__item');
      const activeButton = buttons[index];

      if (activeButton) {
        this.indicatorStyle = {
          left: activeButton.offsetLeft + 'px',
          width: activeButton.offsetWidth + 'px'
        };
      }
    },

    get activeCategory() {
      return this.categories.find(c => (c.value || c.id) === this.activeTab);
    },

    get activeIndex() {
      return this.categories.findIndex(c => (c.value || c.id) === this.activeTab);
    },

    // Navigate to next/previous tab
    next() {
      const currentIndex = this.activeIndex;
      if (currentIndex < this.categories.length - 1) {
        const nextCategory = this.categories[currentIndex + 1];
        this.selectTab(nextCategory.value || nextCategory.id);
      }
    },

    prev() {
      const currentIndex = this.activeIndex;
      if (currentIndex > 0) {
        const prevCategory = this.categories[currentIndex - 1];
        this.selectTab(prevCategory.value || prevCategory.id);
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxCategoryTabs', categoryTabsComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxCategoryTabs', categoryTabsComponent);
    });
  }
})();

/**
 * UX Checkbox Component
 * Checkboxes estilo Ionic
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Checkbox
    ======================================== */

    .ux-checkbox {
      display: inline-flex;
      align-items: flex-start;
      gap: var(--ux-space-md);
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-sm) 0;
    }

    .ux-checkbox__input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .ux-checkbox__box {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-checkbox-size);
      height: var(--ux-checkbox-size);
      background-color: transparent;
      border: 2px solid var(--ux-medium);
      border-radius: var(--ux-checkbox-border-radius);
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease-spring);
      flex-shrink: 0;
    }

    /* Expanded touch target for accessibility (44px minimum) */
    .ux-checkbox__box::before {
      content: '';
      position: absolute;
      inset: -10px;
      z-index: 1;
    }

    .ux-checkbox__checkmark {
      display: none;
      width: 14px;
      height: 14px;
      color: white;
    }

    .ux-checkbox__checkmark svg {
      width: 100%;
      height: 100%;
    }

    /* Checked State */
    .ux-checkbox__input:checked + .ux-checkbox__box {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
    }

    .ux-checkbox__input:checked + .ux-checkbox__box .ux-checkbox__checkmark {
      display: block;
      animation: ux-checkbox-check 0.2s var(--ux-ease-spring);
    }

    @keyframes ux-checkbox-check {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.2);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Hover State */
    .ux-checkbox:hover .ux-checkbox__box {
      border-color: var(--ux-primary);
    }

    /* Active State */
    .ux-checkbox:active .ux-checkbox__box {
      transform: scale(0.9);
    }

    /* Focus State */
    .ux-checkbox__input:focus-visible + .ux-checkbox__box {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    /* Disabled State */
    .ux-checkbox--disabled,
    .ux-checkbox__input:disabled + .ux-checkbox__box {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Indeterminate State */
    .ux-checkbox__input:indeterminate + .ux-checkbox__box {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
    }

    .ux-checkbox__input:indeterminate + .ux-checkbox__box .ux-checkbox__checkmark {
      display: none;
    }

    .ux-checkbox__input:indeterminate + .ux-checkbox__box::after {
      content: '';
      width: 12px;
      height: 2px;
      background-color: white;
      border-radius: 1px;
    }

    /* ========================================
       Color - Uses composition system
       Default: primary (blue)
       Override with .ux-color-* classes
    ======================================== */

    .ux-checkbox {
      --ux-checkbox-color: var(--ux-variant-bg, var(--ux-primary));
    }

    .ux-checkbox__input:checked + .ux-checkbox__box {
      background-color: var(--ux-checkbox-color);
      border-color: var(--ux-checkbox-color);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-checkbox--sm .ux-checkbox__box {
      width: var(--ux-checkbox-size-sm);
      height: var(--ux-checkbox-size-sm);
    }

    .ux-checkbox--sm .ux-checkbox__checkmark {
      width: calc(var(--ux-checkbox-size-sm) * 0.55);
      height: calc(var(--ux-checkbox-size-sm) * 0.55);
    }

    .ux-checkbox--lg .ux-checkbox__box {
      width: var(--ux-checkbox-size-lg);
      height: var(--ux-checkbox-size-lg);
    }

    .ux-checkbox--lg .ux-checkbox__checkmark {
      width: calc(var(--ux-checkbox-size-lg) * 0.65);
      height: calc(var(--ux-checkbox-size-lg) * 0.65);
    }

    /* ========================================
       Label
    ======================================== */

    .ux-checkbox__label {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      line-height: 1.4;
      padding-top: 2px;
    }

    .ux-checkbox__description {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    /* ========================================
       Checkbox Group
    ======================================== */

    .ux-checkbox-group {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-checkbox-group--horizontal {
      flex-direction: row;
      flex-wrap: wrap;
      gap: var(--ux-space-lg);
    }

    .ux-checkbox-group__label {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-sm);
    }

    /* ========================================
       Checkbox List Item
    ======================================== */

    .ux-checkbox-item {
      display: flex;
      align-items: center;
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      cursor: pointer;
    }

    .ux-checkbox-item:last-child {
      border-bottom: none;
    }

    .ux-checkbox-item:active {
      background-color: var(--ux-surface-secondary);
    }

    .ux-checkbox-item__content {
      flex: 1;
      margin-left: var(--ux-space-md);
    }

    .ux-checkbox-item__title {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
    }

    .ux-checkbox-item__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    /* ========================================
       Round Variant
    ======================================== */

    .ux-checkbox--round .ux-checkbox__box {
      border-radius: 50%;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-checkbox--glass .ux-checkbox__box {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-checkbox--glass .ux-checkbox__input:checked + .ux-checkbox__box {
      background: var(--ux-checkbox-color, var(--ux-primary));
      border-color: var(--ux-checkbox-color, var(--ux-primary));
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .ux-checkbox__box {
        transition: none;
      }

      .ux-checkbox__input:checked + .ux-checkbox__box .ux-checkbox__checkmark {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-checkbox-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-checkbox-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for checkbox
  const checkboxComponent = (config = {}) => ({
    checked: config.checked || false,
    indeterminate: config.indeterminate || false,
    disabled: config.disabled || false,

    toggle() {
      if (!this.disabled) {
        this.indeterminate = false;
        this.checked = !this.checked;
      }
    },

    check() {
      if (!this.disabled) {
        this.indeterminate = false;
        this.checked = true;
      }
    },

    uncheck() {
      if (!this.disabled) {
        this.indeterminate = false;
        this.checked = false;
      }
    },

    setIndeterminate() {
      this.indeterminate = true;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxCheckbox', checkboxComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxCheckbox', checkboxComponent);
    });
  }

  // Alpine component for checkbox group
  const checkboxGroupComponent = (config = {}) => ({
    values: config.values || [],
    disabled: config.disabled || false,

    isChecked(value) {
      return this.values.includes(value);
    },

    toggle(value) {
      if (this.disabled) return;
      const index = this.values.indexOf(value);
      if (index === -1) {
        this.values.push(value);
      } else {
        this.values.splice(index, 1);
      }
    },

    checkAll(allValues) {
      if (!this.disabled) {
        this.values = [...allValues];
      }
    },

    uncheckAll() {
      if (!this.disabled) {
        this.values = [];
      }
    },

    get allChecked() {
      return this.values.length > 0;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxCheckboxGroup', checkboxGroupComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxCheckboxGroup', checkboxGroupComponent);
    });
  }
})();

/**
 * UX Chip Component
 * Chips para etiquetas, filtros y selecciÃ³n
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Chip
    ======================================== */

    .ux-chip {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      height: var(--ux-chip-height);
      padding: 0 var(--ux-chip-padding-x);
      font-family: var(--ux-font-family);
      font-size: var(--ux-chip-font-size);
      font-weight: 500;
      line-height: 1;
      white-space: nowrap;
      border-radius: var(--ux-chip-border-radius);
      /* Uses composition system: combine with .ux-color-* classes */
      /* Default is soft/tinted style - use .ux-color-*--soft */
      background-color: var(--ux-variant-bg, var(--ux-light));
      color: var(--ux-variant-color, var(--ux-text));
      border: 1px solid var(--ux-variant-border, transparent);
      cursor: default;
      user-select: none;
      -webkit-user-select: none;
      transition: var(--ux-transition-colors),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-chip:hover {
      background-color: var(--ux-variant-bg-hover, var(--ux-light-shade));
    }

    /* ========================================
       Interactive Chips
    ======================================== */

    .ux-chip--interactive {
      cursor: pointer;
    }

    .ux-chip--interactive:active {
      transform: scale(0.96);
    }

    /* ========================================
       Filled Variant
       Use with .ux-color-* classes (not --soft)
    ======================================== */

    .ux-chip--filled {
      background-color: var(--ux-variant-bg, var(--ux-primary));
      color: var(--ux-variant-color, var(--ux-primary-contrast));
    }

    /* ========================================
       Outline Variant
       Use with .ux-color-*--outline classes
    ======================================== */

    .ux-chip--outline {
      background-color: var(--ux-variant-bg, transparent);
      color: var(--ux-variant-color, var(--ux-text));
      border: 1px solid var(--ux-variant-border, var(--ux-border-color));
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-chip--sm {
      height: var(--ux-chip-height-sm);
      padding: 0 calc(var(--ux-chip-padding-x) * 0.75);
      font-size: calc(var(--ux-chip-font-size) * 0.85);
      border-radius: calc(var(--ux-chip-height-sm) / 2);
    }

    .ux-chip--lg {
      height: var(--ux-chip-height-lg);
      padding: 0 calc(var(--ux-chip-padding-x) * 1.25);
      font-size: calc(var(--ux-chip-font-size) * 1.15);
      border-radius: calc(var(--ux-chip-height-lg) / 2);
    }

    /* ========================================
       Selected State
    ======================================== */

    .ux-chip--selected {
      background-color: var(--ux-variant-bg, var(--ux-primary));
      color: var(--ux-variant-color, var(--ux-primary-contrast));
    }

    .ux-chip--selected.ux-chip--outline {
      background-color: var(--ux-variant-bg, var(--ux-primary));
      border-color: var(--ux-variant-border, var(--ux-primary));
      color: var(--ux-variant-color, var(--ux-primary-contrast));
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-chip--disabled,
    .ux-chip:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* ========================================
       Chip Avatar
    ======================================== */

    .ux-chip__avatar {
      width: 24px;
      height: 24px;
      margin-left: -8px;
      border-radius: 50%;
      object-fit: cover;
    }

    .ux-chip--sm .ux-chip__avatar {
      width: 18px;
      height: 18px;
      margin-left: -4px;
    }

    .ux-chip--lg .ux-chip__avatar {
      width: 32px;
      height: 32px;
      margin-left: -12px;
    }

    /* ========================================
       Chip Icon
    ======================================== */

    .ux-chip__icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .ux-chip__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-chip--sm .ux-chip__icon {
      width: 14px;
      height: 14px;
    }

    .ux-chip--lg .ux-chip__icon {
      width: 20px;
      height: 20px;
    }

    /* ========================================
       Chip Close Button
    ======================================== */

    .ux-chip__close {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      margin-right: -6px;
      margin-left: 2px;
      padding: 0;
      border: none;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-chip__close:hover {
      background: rgba(0, 0, 0, 0.2);
    }

    .ux-chip__close svg {
      width: 12px;
      height: 12px;
    }

    .ux-chip--filled .ux-chip__close,
    .ux-chip--selected .ux-chip__close {
      background: rgba(255, 255, 255, 0.2);
    }

    .ux-chip--filled .ux-chip__close:hover,
    .ux-chip--selected .ux-chip__close:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* ========================================
       Chip Group
    ======================================== */

    .ux-chip-group {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-sm);
    }

    .ux-chip-group--scroll {
      flex-wrap: nowrap;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding-bottom: var(--ux-space-xs);
    }

    .ux-chip-group--scroll::-webkit-scrollbar {
      display: none;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-chip--glass {
      border: 0.5px solid var(--ux-glass-border);
      color: var(--ux-text);
    }

    .ux-chip--glass:hover {
      background: var(--ux-glass-bg-thick);
    }

    .ux-chip--glass.ux-chip--selected {
      background: var(--ux-glass-bg-thick);
      box-shadow: var(--ux-glass-highlight);
    }

    .ux-chip--glass .ux-chip__close {
      background: var(--ux-glass-bg-thin);
    }

    .ux-chip--glass .ux-chip__close:hover {
      background: var(--ux-glass-bg-thick);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-chip {
        transition: none;
      }

      .ux-chip--interactive:active {
        transform: none;
      }

      .ux-chip__close {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-chip-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-chip-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for selectable chips
  const chipComponent = () => ({
    selected: false,

    toggle() {
      this.selected = !this.selected;
    },

    select() {
      this.selected = true;
    },

    deselect() {
      this.selected = false;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxChip', chipComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxChip', chipComponent);
    });
  }

  // Alpine component for chip group (single/multi select)
  const chipGroupComponent = (config = {}) => ({
    multiple: config.multiple || false,
    selected: config.multiple ? [] : null,

    isSelected(value) {
      if (this.multiple) {
        return this.selected.includes(value);
      }
      return this.selected === value;
    },

    toggle(value) {
      if (this.multiple) {
        const index = this.selected.indexOf(value);
        if (index === -1) {
          this.selected.push(value);
        } else {
          this.selected.splice(index, 1);
        }
      } else {
        this.selected = this.selected === value ? null : value;
      }
    },

    select(value) {
      if (this.multiple) {
        if (!this.selected.includes(value)) {
          this.selected.push(value);
        }
      } else {
        this.selected = value;
      }
    },

    clear() {
      this.selected = this.multiple ? [] : null;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxChipGroup', chipGroupComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxChipGroup', chipGroupComponent);
    });
  }
})();

/**
 * UX Code Block Component
 * Syntax highlighted code display with copy button, line numbers, and theming
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Code Block - Base
    ======================================== */

    .ux-code-block {
      position: relative;
      font-family: 'SF Mono', 'Fira Code', 'Monaco', 'Consolas', monospace;
      font-size: 0.875rem;
      line-height: 1.6;
      border-radius: var(--ux-radius-lg);
      overflow: hidden;
      background: var(--ux-gray-900);
      color: var(--ux-gray-100);
    }

    /* ========================================
       Header
    ======================================== */

    .ux-code-block__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--ux-gray-800);
      border-bottom: 1px solid var(--ux-gray-700);
    }

    .ux-code-block__title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--ux-gray-400);
    }

    .ux-code-block__lang {
      padding: 0.125rem 0.5rem;
      background: var(--ux-gray-700);
      border-radius: var(--ux-radius-sm);
      font-size: 0.6875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--ux-gray-300);
    }

    .ux-code-block__actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .ux-code-block__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      padding: 0.375rem 0.625rem;
      background: transparent;
      border: none;
      border-radius: var(--ux-radius-sm);
      color: var(--ux-gray-400);
      font-size: 0.75rem;
      font-family: inherit;
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-code-block__btn:hover {
      background: var(--ux-gray-700);
      color: var(--ux-gray-200);
    }

    .ux-code-block__btn--copied {
      color: var(--ux-success);
    }

    .ux-code-block__btn svg {
      width: 14px;
      height: 14px;
    }

    /* ========================================
       Content
    ======================================== */

    .ux-code-block__content {
      display: flex;
      overflow-x: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--ux-gray-600) transparent;
    }

    .ux-code-block__content::-webkit-scrollbar {
      height: 8px;
    }

    .ux-code-block__content::-webkit-scrollbar-track {
      background: transparent;
    }

    .ux-code-block__content::-webkit-scrollbar-thumb {
      background: var(--ux-gray-600);
      border-radius: 4px;
    }

    /* ========================================
       Line Numbers
    ======================================== */

    .ux-code-block__line-numbers {
      display: flex;
      flex-direction: column;
      padding: 1rem 0;
      background: var(--ux-gray-850, rgba(0, 0, 0, 0.2));
      border-right: 1px solid var(--ux-gray-700);
      user-select: none;
      flex-shrink: 0;
    }

    .ux-code-block__line-number {
      padding: 0 1rem;
      color: var(--ux-gray-500);
      text-align: right;
      font-size: 0.75rem;
      line-height: 1.6;
    }

    .ux-code-block__line-number--highlight {
      background: rgba(var(--ux-primary-rgb), 0.15);
      color: var(--ux-gray-300);
    }

    /* ========================================
       Code
    ======================================== */

    .ux-code-block__code {
      flex: 1;
      margin: 0;
      padding: 1rem;
      overflow: visible;
      white-space: pre;
      background: transparent;
      font: inherit;
    }

    .ux-code-block__line {
      display: block;
      padding: 0 0.5rem;
      border-left: 3px solid transparent;
    }

    .ux-code-block__line--highlight {
      background: rgba(var(--ux-primary-rgb), 0.15);
      border-left-color: var(--ux-primary);
    }

    /* ========================================
       Syntax Highlighting (Basic Tokens)
    ======================================== */

    .ux-code-block .token-keyword {
      color: #c678dd;
    }

    .ux-code-block .token-string {
      color: #98c379;
    }

    .ux-code-block .token-number {
      color: #d19a66;
    }

    .ux-code-block .token-comment {
      color: #5c6370;
      font-style: italic;
    }

    .ux-code-block .token-function {
      color: #61afef;
    }

    .ux-code-block .token-class {
      color: #e5c07b;
    }

    .ux-code-block .token-operator {
      color: #56b6c2;
    }

    .ux-code-block .token-punctuation {
      color: #abb2bf;
    }

    .ux-code-block .token-property {
      color: #e06c75;
    }

    .ux-code-block .token-tag {
      color: #e06c75;
    }

    .ux-code-block .token-attr-name {
      color: #d19a66;
    }

    .ux-code-block .token-attr-value {
      color: #98c379;
    }

    .ux-code-block .token-selector {
      color: #c678dd;
    }

    .ux-code-block .token-variable {
      color: #e06c75;
    }

    .ux-code-block .token-constant {
      color: #56b6c2;
    }

    .ux-code-block .token-boolean {
      color: #d19a66;
    }

    .ux-code-block .token-regex {
      color: #56b6c2;
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-code-block--sm {
      font-size: 0.75rem;
    }

    .ux-code-block--sm .ux-code-block__line-number {
      font-size: 0.6875rem;
    }

    .ux-code-block--lg {
      font-size: 1rem;
    }

    .ux-code-block--lg .ux-code-block__line-number {
      font-size: 0.875rem;
    }

    /* ========================================
       Themes
    ======================================== */

    /* Light Theme */
    .ux-code-block--light {
      background: var(--ux-gray-50);
      color: var(--ux-gray-800);
    }

    .ux-code-block--light .ux-code-block__header {
      background: var(--ux-gray-100);
      border-bottom-color: var(--ux-gray-200);
    }

    .ux-code-block--light .ux-code-block__lang {
      background: var(--ux-gray-200);
      color: var(--ux-gray-600);
    }

    .ux-code-block--light .ux-code-block__btn {
      color: var(--ux-gray-500);
    }

    .ux-code-block--light .ux-code-block__btn:hover {
      background: var(--ux-gray-200);
      color: var(--ux-gray-700);
    }

    .ux-code-block--light .ux-code-block__line-numbers {
      background: var(--ux-gray-100);
      border-right-color: var(--ux-gray-200);
    }

    .ux-code-block--light .ux-code-block__line-number {
      color: var(--ux-gray-400);
    }

    .ux-code-block--light .token-keyword { color: #8250df; }
    .ux-code-block--light .token-string { color: #0a3069; }
    .ux-code-block--light .token-number { color: #0550ae; }
    .ux-code-block--light .token-comment { color: #6e7781; }
    .ux-code-block--light .token-function { color: #8250df; }
    .ux-code-block--light .token-class { color: #953800; }
    .ux-code-block--light .token-operator { color: #cf222e; }
    .ux-code-block--light .token-punctuation { color: #24292f; }
    .ux-code-block--light .token-property { color: #0550ae; }
    .ux-code-block--light .token-tag { color: #116329; }
    .ux-code-block--light .token-attr-name { color: #0550ae; }
    .ux-code-block--light .token-attr-value { color: #0a3069; }

    /* ========================================
       Inline Code
    ======================================== */

    .ux-code-inline {
      display: inline;
      padding: 0.125rem 0.375rem;
      background: var(--ux-gray-100);
      border-radius: var(--ux-radius-sm);
      font-family: 'SF Mono', 'Fira Code', 'Monaco', 'Consolas', monospace;
      font-size: 0.875em;
      color: var(--ux-gray-700);
    }

    .ux-dark .ux-code-inline {
      background: var(--ux-gray-800);
      color: var(--ux-gray-200);
    }

    /* ========================================
       No Header Variant
    ======================================== */

    .ux-code-block--no-header .ux-code-block__header {
      display: none;
    }

    /* ========================================
       Collapsible
    ======================================== */

    .ux-code-block--collapsed .ux-code-block__content {
      max-height: 200px;
      overflow: hidden;
      position: relative;
    }

    .ux-code-block--collapsed .ux-code-block__content::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: linear-gradient(transparent, var(--ux-gray-900));
      pointer-events: none;
    }

    .ux-code-block__expand {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem;
      background: var(--ux-gray-800);
      border-top: 1px solid var(--ux-gray-700);
      color: var(--ux-gray-400);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-code-block__expand:hover {
      background: var(--ux-gray-750, var(--ux-gray-700));
      color: var(--ux-gray-200);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-code-block--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 1px solid var(--ux-glass-border);
    }

    .ux-code-block--glass .ux-code-block__header {
      background: rgba(255, 255, 255, 0.05);
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-code-block--glass .ux-code-block__line-numbers {
      background: rgba(0, 0, 0, 0.1);
      border-right-color: var(--ux-glass-border);
    }

    /* ========================================
       Diff View
    ======================================== */

    .ux-code-block__line--added {
      background: rgba(46, 160, 67, 0.15);
      border-left-color: var(--ux-success);
    }

    .ux-code-block__line--removed {
      background: rgba(248, 81, 73, 0.15);
      border-left-color: var(--ux-danger);
    }

    .ux-code-block__line--added::before {
      content: '+';
      margin-right: 0.5rem;
      color: var(--ux-success);
    }

    .ux-code-block__line--removed::before {
      content: '-';
      margin-right: 0.5rem;
      color: var(--ux-danger);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-code-block__btn {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-code-block-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-code-block-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Simple syntax highlighting rules
  const syntaxRules = {
    javascript: [
      { pattern: /(\/\/.*$)/gm, className: 'token-comment' },
      { pattern: /(\/\*[\s\S]*?\*\/)/g, className: 'token-comment' },
      { pattern: /("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*'|`(?:[^`\\]|\\.)*`)/g, className: 'token-string' },
      { pattern: /\b(const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|new|this|class|extends|import|export|from|default|async|await|try|catch|finally|throw|typeof|instanceof|in|of)\b/g, className: 'token-keyword' },
      { pattern: /\b(\d+\.?\d*)\b/g, className: 'token-number' },
      { pattern: /\b(true|false|null|undefined|NaN|Infinity)\b/g, className: 'token-boolean' },
      { pattern: /([a-zA-Z_$][\w$]*)\s*\(/g, className: 'token-function', group: 1 },
      { pattern: /\b([A-Z][a-zA-Z0-9_]*)\b/g, className: 'token-class' },
      { pattern: /([\+\-\*\/\%\=\!\<\>\&\|\^\~\?])/g, className: 'token-operator' },
      { pattern: /([\{\}\[\]\(\)\;\,\.])/g, className: 'token-punctuation' }
    ],
    html: [
      { pattern: /(&lt;!--[\s\S]*?--&gt;|<!--[\s\S]*?-->)/g, className: 'token-comment' },
      { pattern: /(&lt;\/?)([\w-]+)/g, className: 'token-tag', group: 2 },
      { pattern: /(\s)([\w-]+)(=)/g, className: 'token-attr-name', group: 2 },
      { pattern: /(=)("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')/g, className: 'token-attr-value', group: 2 }
    ],
    css: [
      { pattern: /(\/\*[\s\S]*?\*\/)/g, className: 'token-comment' },
      { pattern: /([.#]?[\w-]+)\s*\{/g, className: 'token-selector', group: 1 },
      { pattern: /([\w-]+)\s*:/g, className: 'token-property', group: 1 },
      { pattern: /:\s*([^;{}]+)/g, className: 'token-string', group: 1 },
      { pattern: /(\d+\.?\d*)(px|em|rem|%|vh|vw|deg|s|ms)?/g, className: 'token-number' }
    ],
    json: [
      { pattern: /("(?:[^"\\]|\\.)*")\s*:/g, className: 'token-property', group: 1 },
      { pattern: /:\s*("(?:[^"\\]|\\.)*")/g, className: 'token-string', group: 1 },
      { pattern: /:\s*(\d+\.?\d*)/g, className: 'token-number', group: 1 },
      { pattern: /:\s*(true|false|null)/g, className: 'token-boolean', group: 1 }
    ],
    python: [
      { pattern: /(#.*$)/gm, className: 'token-comment' },
      { pattern: /("""[\s\S]*?"""|'''[\s\S]*?''')/g, className: 'token-string' },
      { pattern: /("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')/g, className: 'token-string' },
      { pattern: /\b(def|class|if|elif|else|for|while|return|import|from|as|try|except|finally|raise|with|lambda|yield|pass|break|continue|and|or|not|in|is|True|False|None)\b/g, className: 'token-keyword' },
      { pattern: /\b(\d+\.?\d*)\b/g, className: 'token-number' },
      { pattern: /\b([a-zA-Z_]\w*)\s*\(/g, className: 'token-function', group: 1 }
    ],
    bash: [
      { pattern: /(#.*$)/gm, className: 'token-comment' },
      { pattern: /("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')/g, className: 'token-string' },
      { pattern: /\b(if|then|else|elif|fi|for|while|do|done|case|esac|function|return|exit|echo|cd|ls|mkdir|rm|cp|mv|cat|grep|sed|awk|export|source)\b/g, className: 'token-keyword' },
      { pattern: /(\$[\w]+|\$\{[\w]+\})/g, className: 'token-variable' }
    ]
  };

  // Escape HTML
  const escapeHtml = (str) => {
    return str
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  };

  // Apply syntax highlighting
  const highlight = (code, language) => {
    if (!code) return '';

    let escaped = escapeHtml(code);
    const rules = syntaxRules[language] || syntaxRules.javascript;

    // Apply rules in order
    for (const rule of rules) {
      escaped = escaped.replace(rule.pattern, (...args) => {
        const match = rule.group !== undefined ? args[rule.group] : args[0];
        const fullMatch = args[0];

        if (rule.group !== undefined) {
          return fullMatch.replace(match, `<span class="${rule.className}">${match}</span>`);
        }

        return `<span class="${rule.className}">${match}</span>`;
      });
    }

    return escaped;
  };

  // Icons
  const icons = {
    copy: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>',
    check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>',
    expand: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>',
    collapse: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18 15 12 9 6 15"/></svg>'
  };

  // Alpine.js component for code block
  const codeBlockData = (options = {}) => ({
    // Configuration
    code: options.code || '',
    language: options.language || 'javascript',
    filename: options.filename || '',
    showLineNumbers: options.showLineNumbers ?? true,
    showHeader: options.showHeader ?? true,
    showCopy: options.showCopy ?? true,
    highlightLines: options.highlightLines || [], // Array of line numbers to highlight
    startLine: options.startLine || 1,
    maxHeight: options.maxHeight || null,
    collapsible: options.collapsible ?? false,

    // State
    copied: false,
    collapsed: options.collapsed ?? false,
    icons,

    // Get highlighted code
    get highlightedCode() {
      return highlight(this.code, this.language);
    },

    // Get lines
    get lines() {
      return this.code.split('\n');
    },

    // Get highlighted lines
    getHighlightedLines() {
      const lines = this.highlightedCode.split('\n');
      return lines.map((line, index) => ({
        content: line || ' ', // Ensure empty lines have content
        number: this.startLine + index,
        isHighlighted: this.highlightLines.includes(this.startLine + index)
      }));
    },

    // Copy to clipboard
    async copyCode() {
      try {
        await navigator.clipboard.writeText(this.code);
        this.copied = true;
        setTimeout(() => {
          this.copied = false;
        }, 2000);

        this.$dispatch('codeblock:copy', { code: this.code });
      } catch (err) {
        console.error('Failed to copy code:', err);
      }
    },

    // Toggle collapsed state
    toggleCollapse() {
      this.collapsed = !this.collapsed;
      this.$dispatch('codeblock:toggle', { collapsed: this.collapsed });
    },

    // Set code programmatically
    setCode(newCode, newLanguage) {
      this.code = newCode;
      if (newLanguage) {
        this.language = newLanguage;
      }
    },

    // Get language display name
    get languageDisplay() {
      const names = {
        javascript: 'JS',
        typescript: 'TS',
        python: 'Python',
        html: 'HTML',
        css: 'CSS',
        json: 'JSON',
        bash: 'Bash',
        shell: 'Shell',
        jsx: 'JSX',
        tsx: 'TSX',
        sql: 'SQL',
        yaml: 'YAML',
        markdown: 'MD'
      };
      return names[this.language] || this.language.toUpperCase();
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxCodeBlock', codeBlockData);
  }

  // Also expose highlight function globally
  if (window.UX) {
    window.UX.highlightCode = highlight;
  }

  // ========================================
  // Auto-initialize simple <pre> blocks
  // Adds copy button to any <pre> with class="ux-code-block"
  // Works without Alpine.js for simple use cases
  // ========================================

  function initSimpleCodeBlocks() {
    // Find all pre elements with ux-code-block class that aren't already initialized
    const preElements = document.querySelectorAll('pre.ux-code-block:not([data-ux-initialized])');

    preElements.forEach(pre => {
      pre.setAttribute('data-ux-initialized', 'true');

      // Create wrapper
      const wrapper = document.createElement('div');
      wrapper.className = 'ux-code-block';
      wrapper.style.position = 'relative';

      // Create header with copy button
      const header = document.createElement('div');
      header.className = 'ux-code-block__header';
      header.innerHTML = `
        <div class="ux-code-block__title">
          <span class="ux-code-block__lang">${pre.dataset.lang || 'CODE'}</span>
        </div>
        <div class="ux-code-block__actions">
          <button class="ux-code-block__btn" type="button" aria-label="Copiar cÃ³digo">
            ${icons.copy}
            <span>Copiar</span>
          </button>
        </div>
      `;

      // Get the copy button
      const copyBtn = header.querySelector('.ux-code-block__btn');
      const code = pre.textContent;

      // Add click handler
      copyBtn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(code);
          copyBtn.innerHTML = `${icons.check}<span>Copiado</span>`;
          copyBtn.classList.add('ux-code-block__btn--copied');

          setTimeout(() => {
            copyBtn.innerHTML = `${icons.copy}<span>Copiar</span>`;
            copyBtn.classList.remove('ux-code-block__btn--copied');
          }, 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
        }
      });

      // Create content wrapper
      const content = document.createElement('div');
      content.className = 'ux-code-block__content';

      // Move pre styles to code block styles
      pre.className = 'ux-code-block__code';
      pre.style.margin = '0';
      pre.style.borderRadius = '0';

      // Wrap elements
      pre.parentNode.insertBefore(wrapper, pre);
      content.appendChild(pre);
      wrapper.appendChild(header);
      wrapper.appendChild(content);
    });
  }

  // Run on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSimpleCodeBlocks);
  } else {
    initSimpleCodeBlocks();
  }

  // Expose for dynamic content
  if (window.UX) {
    window.UX.initCodeBlocks = initSimpleCodeBlocks;
  }

})();

/**
 * UX Color Picker Component
 * Color selection with visual picker and presets
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Color Picker - Base
    ======================================== */

    .ux-color-picker {
      position: relative;
      display: inline-block;
      font-family: var(--ux-font-family);
    }

    /* ========================================
       Color Trigger Button
    ======================================== */

    .ux-color-picker__trigger {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-color-picker__trigger:hover {
      border-color: var(--ux-primary);
    }

    .ux-color-picker__trigger:focus {
      outline: none;
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.2);
    }

    .ux-color-picker__swatch {
      width: 24px;
      height: 24px;
      border-radius: var(--ux-radius-sm);
      border: 1px solid rgba(0, 0, 0, 0.1);
      background-image: linear-gradient(45deg, #ccc 25%, transparent 25%),
                        linear-gradient(-45deg, #ccc 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #ccc 75%),
                        linear-gradient(-45deg, transparent 75%, #ccc 75%);
      background-size: 8px 8px;
      background-position: 0 0, 0 4px, 4px -4px, -4px 0px;
    }

    .ux-color-picker__swatch-color {
      width: 100%;
      height: 100%;
      border-radius: inherit;
    }

    .ux-color-picker__value {
      font-size: var(--ux-font-size-sm);
      font-family: monospace;
      color: var(--ux-text);
      min-width: 70px;
    }

    .ux-color-picker__arrow {
      width: 16px;
      height: 16px;
      color: var(--ux-text-tertiary);
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-color-picker--open .ux-color-picker__arrow {
      transform: rotate(180deg);
    }

    /* ========================================
       Color Picker Dropdown
    ======================================== */

    .ux-color-picker__dropdown {
      position: absolute;
      top: calc(100% + var(--ux-space-xs));
      left: 0;
      z-index: var(--ux-z-dropdown);
      min-width: 260px;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      box-shadow: var(--ux-shadow-lg);
      padding: var(--ux-space-md);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-color-picker--open .ux-color-picker__dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-color-picker__dropdown--right {
      left: auto;
      right: 0;
    }

    .ux-color-picker__dropdown--top {
      top: auto;
      bottom: calc(100% + var(--ux-space-xs));
      transform: translateY(8px);
    }

    .ux-color-picker--open .ux-color-picker__dropdown--top {
      transform: translateY(0);
    }

    /* ========================================
       Color Spectrum
    ======================================== */

    .ux-color-picker__spectrum {
      position: relative;
      width: 100%;
      height: 150px;
      border-radius: var(--ux-radius-md);
      cursor: crosshair;
      margin-bottom: var(--ux-space-md);
    }

    .ux-color-picker__spectrum-saturation {
      position: absolute;
      inset: 0;
      background: linear-gradient(to right, #fff, transparent);
      border-radius: inherit;
    }

    .ux-color-picker__spectrum-lightness {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, #000, transparent);
      border-radius: inherit;
    }

    .ux-color-picker__spectrum-handle {
      position: absolute;
      width: 16px;
      height: 16px;
      border: 2px solid white;
      border-radius: 50%;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.3), var(--ux-shadow-sm);
      transform: translate(-50%, -50%);
      pointer-events: none;
    }

    /* ========================================
       Hue Slider
    ======================================== */

    .ux-color-picker__hue {
      position: relative;
      width: 100%;
      height: 14px;
      border-radius: 7px;
      background: linear-gradient(to right,
        #ff0000 0%,
        #ffff00 17%,
        #00ff00 33%,
        #00ffff 50%,
        #0000ff 67%,
        #ff00ff 83%,
        #ff0000 100%
      );
      cursor: pointer;
      margin-bottom: var(--ux-space-md);
    }

    .ux-color-picker__hue-handle {
      position: absolute;
      top: 50%;
      width: 18px;
      height: 18px;
      background: white;
      border: 2px solid white;
      border-radius: 50%;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2), var(--ux-shadow-sm);
      transform: translate(-50%, -50%);
      pointer-events: none;
    }

    /* ========================================
       Alpha Slider
    ======================================== */

    .ux-color-picker__alpha {
      position: relative;
      width: 100%;
      height: 14px;
      border-radius: 7px;
      background-image: linear-gradient(45deg, #ccc 25%, transparent 25%),
                        linear-gradient(-45deg, #ccc 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #ccc 75%),
                        linear-gradient(-45deg, transparent 75%, #ccc 75%);
      background-size: 8px 8px;
      background-position: 0 0, 0 4px, 4px -4px, -4px 0px;
      cursor: pointer;
      margin-bottom: var(--ux-space-md);
    }

    .ux-color-picker__alpha-gradient {
      position: absolute;
      inset: 0;
      border-radius: inherit;
    }

    .ux-color-picker__alpha-handle {
      position: absolute;
      top: 50%;
      width: 18px;
      height: 18px;
      background: white;
      border: 2px solid white;
      border-radius: 50%;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2), var(--ux-shadow-sm);
      transform: translate(-50%, -50%);
      pointer-events: none;
    }

    /* ========================================
       Input Fields
    ======================================== */

    .ux-color-picker__inputs {
      display: flex;
      gap: var(--ux-space-sm);
      margin-bottom: var(--ux-space-md);
    }

    .ux-color-picker__input-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ux-color-picker__input-label {
      font-size: 10px;
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
    }

    .ux-color-picker__input {
      width: 100%;
      padding: var(--ux-space-xs);
      background: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-sm);
      font-size: var(--ux-font-size-sm);
      font-family: monospace;
      text-align: center;
      color: var(--ux-text);
    }

    .ux-color-picker__input:focus {
      outline: none;
      border-color: var(--ux-primary);
    }

    .ux-color-picker__input--hex {
      flex: 2;
    }

    /* ========================================
       Preset Colors
    ======================================== */

    .ux-color-picker__presets {
      margin-top: var(--ux-space-sm);
    }

    .ux-color-picker__presets-label {
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-color-picker__presets-grid {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
    }

    .ux-color-picker__preset {
      width: 24px;
      height: 24px;
      border-radius: var(--ux-radius-sm);
      border: 1px solid transparent;
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-color-picker__preset:hover {
      transform: scale(1.15);
    }

    .ux-color-picker__preset--active {
      border-color: var(--ux-text);
      box-shadow: 0 0 0 2px var(--ux-surface), 0 0 0 3px var(--ux-text);
    }

    /* ========================================
       Format Toggle
    ======================================== */

    .ux-color-picker__format-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-xs);
      background: none;
      border: none;
      border-radius: var(--ux-radius-sm);
      color: var(--ux-text-tertiary);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-color-picker__format-toggle:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-color-picker__format-toggle svg {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Actions
    ======================================== */

    .ux-color-picker__actions {
      display: flex;
      gap: var(--ux-space-sm);
      margin-top: var(--ux-space-md);
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Simple Mode
    ======================================== */

    .ux-color-picker--simple .ux-color-picker__dropdown {
      min-width: 200px;
    }

    .ux-color-picker--simple .ux-color-picker__presets-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: var(--ux-space-xs);
    }

    /* ========================================
       Inline Mode
    ======================================== */

    .ux-color-picker--inline .ux-color-picker__dropdown {
      position: static;
      opacity: 1;
      visibility: visible;
      transform: none;
      box-shadow: none;
      border: none;
      padding: 0;
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-color-picker--sm .ux-color-picker__trigger {
      padding: var(--ux-space-xs) var(--ux-space-sm);
    }

    .ux-color-picker--sm .ux-color-picker__swatch {
      width: 20px;
      height: 20px;
    }

    .ux-color-picker--sm .ux-color-picker__value {
      font-size: var(--ux-font-size-xs);
    }

    .ux-color-picker--lg .ux-color-picker__trigger {
      padding: var(--ux-space-md) var(--ux-space-lg);
    }

    .ux-color-picker--lg .ux-color-picker__swatch {
      width: 32px;
      height: 32px;
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-color-picker--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-color-picker--glass .ux-color-picker__dropdown {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-color-picker__swatch {
        border-color: rgba(255, 255, 255, 0.1);
      }
    }

    .ux-dark .ux-color-picker__swatch {
      border-color: rgba(255, 255, 255, 0.1);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-color-picker__dropdown,
      .ux-color-picker__arrow,
      .ux-color-picker__preset {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-color-picker-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-color-picker-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Default preset colors
  const defaultPresets = [
    '#000000', '#ffffff', '#f44336', '#e91e63', '#9c27b0', '#673ab7',
    '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50',
    '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722',
    '#795548', '#9e9e9e', '#607d8b'
  ];

  // Alpine.js component
  const colorPickerData = (options = {}) => ({
    // State
    isOpen: false,
    color: options.value || options.color || '#3b82f6',
    format: options.format || 'hex', // hex, rgb, hsl
    showAlpha: options.showAlpha ?? false,

    // HSL values for internal manipulation
    hue: 220,
    saturation: 100,
    lightness: 50,
    alpha: 1,

    // Presets
    presets: options.presets || defaultPresets,
    showPresets: options.showPresets ?? true,

    // Options
    disabled: options.disabled || false,
    closeOnSelect: options.closeOnSelect ?? false,
    inline: options.inline || false,

    init() {
      this.parseColor(this.color);

      // Close on outside click
      this._outsideClickHandler = (e) => {
        if (this.isOpen && !this.$el.contains(e.target)) {
          this.close();
        }
      };
      document.addEventListener('click', this._outsideClickHandler);

      // Close on escape
      this._escapeHandler = (e) => {
        if (e.key === 'Escape' && this.isOpen) {
          this.close();
        }
      };
      document.addEventListener('keydown', this._escapeHandler);
    },

    destroy() {
      document.removeEventListener('click', this._outsideClickHandler);
      document.removeEventListener('keydown', this._escapeHandler);
    },

    toggle() {
      this.isOpen = !this.isOpen;
    },

    open() {
      if (!this.disabled) {
        this.isOpen = true;
      }
    },

    close() {
      this.isOpen = false;
    },

    // Parse color string to HSL
    parseColor(color) {
      if (!color) return;

      // Handle hex
      if (color.startsWith('#')) {
        const rgb = this.hexToRgb(color);
        if (rgb) {
          const hsl = this.rgbToHsl(rgb.r, rgb.g, rgb.b);
          this.hue = hsl.h;
          this.saturation = hsl.s;
          this.lightness = hsl.l;
        }
      }
      // Handle rgb/rgba
      else if (color.startsWith('rgb')) {
        const match = color.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);
        if (match) {
          const hsl = this.rgbToHsl(parseInt(match[1]), parseInt(match[2]), parseInt(match[3]));
          this.hue = hsl.h;
          this.saturation = hsl.s;
          this.lightness = hsl.l;
          if (match[4]) this.alpha = parseFloat(match[4]);
        }
      }
      // Handle hsl/hsla
      else if (color.startsWith('hsl')) {
        const match = color.match(/hsla?\((\d+),\s*([\d.]+)%,\s*([\d.]+)%(?:,\s*([\d.]+))?\)/);
        if (match) {
          this.hue = parseInt(match[1]);
          this.saturation = parseFloat(match[2]);
          this.lightness = parseFloat(match[3]);
          if (match[4]) this.alpha = parseFloat(match[4]);
        }
      }
    },

    // Convert hex to RGB
    hexToRgb(hex) {
      hex = hex.replace('#', '');
      if (hex.length === 3) {
        hex = hex.split('').map(c => c + c).join('');
      }
      const result = /^([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    },

    // Convert RGB to HSL
    rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;

      if (max === min) {
        h = s = 0;
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
          case g: h = ((b - r) / d + 2) / 6; break;
          case b: h = ((r - g) / d + 4) / 6; break;
        }
      }

      return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
    },

    // Convert HSL to RGB
    hslToRgb(h, s, l) {
      h /= 360; s /= 100; l /= 100;
      let r, g, b;

      if (s === 0) {
        r = g = b = l;
      } else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        };

        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
      }

      return {
        r: Math.round(r * 255),
        g: Math.round(g * 255),
        b: Math.round(b * 255)
      };
    },

    // Convert RGB to Hex
    rgbToHex(r, g, b) {
      return '#' + [r, g, b].map(x => {
        const hex = x.toString(16);
        return hex.length === 1 ? '0' + hex : hex;
      }).join('');
    },

    // Get current color in specified format
    getColor(format = this.format) {
      const rgb = this.hslToRgb(this.hue, this.saturation, this.lightness);

      switch (format) {
        case 'hex':
          return this.rgbToHex(rgb.r, rgb.g, rgb.b);
        case 'rgb':
          if (this.showAlpha && this.alpha < 1) {
            return `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${this.alpha})`;
          }
          return `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
        case 'hsl':
          if (this.showAlpha && this.alpha < 1) {
            return `hsla(${this.hue}, ${this.saturation}%, ${this.lightness}%, ${this.alpha})`;
          }
          return `hsl(${this.hue}, ${this.saturation}%, ${this.lightness}%)`;
        default:
          return this.rgbToHex(rgb.r, rgb.g, rgb.b);
      }
    },

    // Get RGB values
    get rgb() {
      return this.hslToRgb(this.hue, this.saturation, this.lightness);
    },

    // Get display value
    get displayValue() {
      return this.getColor();
    },

    // Get spectrum background color
    get spectrumBg() {
      return `hsl(${this.hue}, 100%, 50%)`;
    },

    // Set color from spectrum position
    setFromSpectrum(x, y, rect) {
      this.saturation = Math.round(Math.max(0, Math.min(100, (x / rect.width) * 100)));
      this.lightness = Math.round(Math.max(0, Math.min(100, 100 - (y / rect.height) * 100)));
      this.updateColor();
    },

    // Set hue from slider
    setHue(x, rect) {
      this.hue = Math.round(Math.max(0, Math.min(360, (x / rect.width) * 360)));
      this.updateColor();
    },

    // Set alpha from slider
    setAlpha(x, rect) {
      this.alpha = Math.round(Math.max(0, Math.min(1, x / rect.width)) * 100) / 100;
      this.updateColor();
    },

    // Update color and dispatch event
    updateColor() {
      this.color = this.getColor();
      this.$dispatch('colorpicker:change', { color: this.color, rgb: this.rgb, hsl: { h: this.hue, s: this.saturation, l: this.lightness }, alpha: this.alpha });

      if (this.closeOnSelect) {
        this.close();
      }
    },

    // Select preset color
    selectPreset(color) {
      this.parseColor(color);
      this.updateColor();
    },

    // Cycle through formats
    cycleFormat() {
      const formats = ['hex', 'rgb', 'hsl'];
      const currentIndex = formats.indexOf(this.format);
      this.format = formats[(currentIndex + 1) % formats.length];
    },

    // Spectrum drag handling
    onSpectrumMouseDown(e) {
      const rect = e.currentTarget.getBoundingClientRect();
      this.setFromSpectrum(e.clientX - rect.left, e.clientY - rect.top, rect);

      const onMove = (e) => {
        this.setFromSpectrum(e.clientX - rect.left, e.clientY - rect.top, rect);
      };
      const onUp = () => {
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onUp);
      };
      document.addEventListener('mousemove', onMove);
      document.addEventListener('mouseup', onUp);
    },

    // Hue slider drag handling
    onHueMouseDown(e) {
      const rect = e.currentTarget.getBoundingClientRect();
      this.setHue(e.clientX - rect.left, rect);

      const onMove = (e) => {
        this.setHue(e.clientX - rect.left, rect);
      };
      const onUp = () => {
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onUp);
      };
      document.addEventListener('mousemove', onMove);
      document.addEventListener('mouseup', onUp);
    },

    // Alpha slider drag handling
    onAlphaMouseDown(e) {
      const rect = e.currentTarget.getBoundingClientRect();
      this.setAlpha(e.clientX - rect.left, rect);

      const onMove = (e) => {
        this.setAlpha(e.clientX - rect.left, rect);
      };
      const onUp = () => {
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onUp);
      };
      document.addEventListener('mousemove', onMove);
      document.addEventListener('mouseup', onUp);
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxColorPicker', colorPickerData);
  }

})();

/**
 * UX Command Palette Component
 * Command palette (Cmd+K) for quick actions and navigation
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Command Palette Backdrop
       ========================================================================== */

    .ux-command-backdrop {
      position: fixed;
      inset: 0;
      z-index: var(--ux-z-modal-backdrop);
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: all var(--ux-transition-fast) var(--ux-ease-out);
    }

    .ux-command-backdrop--open {
      opacity: 1;
      visibility: visible;
    }

    /* ==========================================================================
       Command Palette Container
       ========================================================================== */

    .ux-command {
      position: fixed;
      top: 15%;
      left: 50%;
      transform: translateX(-50%) scale(0.95);
      z-index: var(--ux-z-modal);
      width: 95%;
      max-width: 640px;
      max-height: 70dvh;
      background: var(--ux-surface);
      border-radius: var(--ux-radius-xl);
      box-shadow: var(--ux-shadow-2xl);
      overflow: hidden;
      opacity: 0;
      visibility: hidden;
      transition: all var(--ux-transition-normal) var(--ux-ease-out);
    }

    .ux-command--open {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) scale(1);
    }

    /* ==========================================================================
       Search Input
       ========================================================================== */

    .ux-command__search {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md) var(--ux-space-lg);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-command__search-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      color: var(--ux-text-tertiary);
    }

    .ux-command__input {
      flex: 1;
      min-width: 0;
      height: 40px;
      padding: 0;
      border: none;
      background: transparent;
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-lg);
      color: var(--ux-text);
      outline: none;
    }

    .ux-command__input::placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-command__shortcut {
      display: flex;
      align-items: center;
      gap: 2px;
      flex-shrink: 0;
    }

    .ux-command__key {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 24px;
      padding: 0 6px;
      font-size: 0.75rem;
      font-weight: 500;
      font-family: var(--ux-font-family);
      color: var(--ux-text-tertiary);
      background: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-sm);
    }

    /* ==========================================================================
       Results List
       ========================================================================== */

    .ux-command__results {
      max-height: calc(70dvh - 80px);
      overflow-y: auto;
      overscroll-behavior: contain;
    }

    .ux-command__group {
      padding: var(--ux-space-sm) 0;
    }

    .ux-command__group-title {
      padding: var(--ux-space-xs) var(--ux-space-lg);
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--ux-text-tertiary);
    }

    .ux-command__list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    /* ==========================================================================
       Result Item
       ========================================================================== */

    .ux-command__item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-sm) var(--ux-space-lg);
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-command__item:hover,
    .ux-command__item--active {
      background: var(--ux-surface-secondary);
    }

    .ux-command__item--active {
      background: var(--ux-primary-tint);
    }

    .ux-command__item-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      flex-shrink: 0;
      color: var(--ux-text-secondary);
      background: var(--ux-surface-tertiary);
      border-radius: var(--ux-radius-md);
    }

    .ux-command__item-icon svg {
      width: 18px;
      height: 18px;
    }

    .ux-command__item--active .ux-command__item-icon {
      background: var(--ux-primary);
      color: white;
    }

    .ux-command__item-content {
      flex: 1;
      min-width: 0;
    }

    .ux-command__item-title {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-command__item-description {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-command__item-shortcut {
      display: flex;
      align-items: center;
      gap: 4px;
      flex-shrink: 0;
    }

    /* ==========================================================================
       Highlight
       ========================================================================== */

    .ux-command__highlight {
      color: var(--ux-primary);
      font-weight: 600;
      background: transparent;
    }

    /* ==========================================================================
       Footer
       ========================================================================== */

    .ux-command__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      padding: var(--ux-space-sm) var(--ux-space-lg);
      border-top: 1px solid var(--ux-border-color);
      background: var(--ux-surface-secondary);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
    }

    .ux-command__footer-hints {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
    }

    .ux-command__footer-hint {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .ux-command__footer-hint .ux-command__key {
      min-width: 20px;
      height: 20px;
      padding: 0 4px;
      font-size: 0.6875rem;
    }

    /* ==========================================================================
       Empty State
       ========================================================================== */

    .ux-command__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-2xl);
      text-align: center;
    }

    .ux-command__empty-icon {
      width: 48px;
      height: 48px;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-text-tertiary);
      opacity: 0.5;
    }

    .ux-command__empty-title {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-command__empty-description {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       Loading State
       ========================================================================== */

    .ux-command__loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-xl);
    }

    .ux-command__loading-spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--ux-border-color);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-command-spin 0.8s linear infinite;
    }

    @keyframes ux-command-spin {
      to { transform: rotate(360deg); }
    }

    /* ==========================================================================
       Recent Items
       ========================================================================== */

    .ux-command__recent {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      font-size: 0.6875rem;
      color: var(--ux-text-tertiary);
      background: var(--ux-surface-tertiary);
      border-radius: var(--ux-radius-sm);
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-command--glass {
      background: var(--ux-glass-bg-thick);
      backdrop-filter: blur(var(--ux-glass-blur-heavy));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy));
      border: 1px solid var(--ux-glass-border);
    }

    .ux-command--glass .ux-command__search {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-command--glass .ux-command__footer {
      background: rgba(0, 0, 0, 0.05);
      border-top-color: var(--ux-glass-border);
    }

    /* ==========================================================================
       Mobile Adjustments
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-command {
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        transform: translateY(100%);
        width: 100%;
        max-width: none;
        max-height: none;
        border-radius: 0;
      }

      .ux-command--open {
        transform: translateY(0);
      }

      .ux-command__search {
        padding: var(--ux-space-md);
        padding-top: calc(var(--ux-safe-top) + var(--ux-space-md));
      }

      .ux-command__results {
        max-height: none;
        height: 100%;
      }

      .ux-command__footer {
        padding-bottom: calc(var(--ux-safe-bottom) + var(--ux-space-sm));
      }

      .ux-command__shortcut {
        display: none;
      }
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      .ux-command-backdrop {
        background: rgba(0, 0, 0, 0.7);
      }

      .ux-command--glass .ux-command__footer {
        background: rgba(255, 255, 255, 0.03);
      }
    }

    .ux-dark .ux-command-backdrop {
      background: rgba(0, 0, 0, 0.7);
    }

    .ux-dark .ux-command--glass .ux-command__footer {
      background: rgba(255, 255, 255, 0.03);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-command,
      .ux-command-backdrop,
      .ux-command__item {
        transition: none;
      }

      .ux-command__loading-spinner {
        animation: none;
      }
    }
  `;

  // Icons
  const icons = {
    search: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>`,
    arrow: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>`,
    enter: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 10l-5 5 5 5"/><path d="M20 4v7a4 4 0 0 1-4 4H4"/></svg>`,
    command: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"/></svg>`,
    file: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>`,
    folder: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>`,
    settings: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>`,
    user: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
    clock: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`,
    empty: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/><path d="M8 8l6 6M14 8l-6 6"/></svg>`
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-command-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-command-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const commandData = (options = {}) => ({
    // Configuration
    placeholder: options.placeholder || 'Buscar comandos...',
    commands: options.commands || [],
    groups: options.groups || [],
    maxRecent: options.maxRecent ?? 5,
    closeOnSelect: options.closeOnSelect ?? true,
    fuzzySearch: options.fuzzySearch ?? true,
    showShortcuts: options.showShortcuts ?? true,
    showFooter: options.showFooter ?? true,
    loading: false,
    loadResults: options.loadResults || null,

    // State
    isOpen: false,
    query: '',
    activeIndex: 0,
    recentCommands: [],
    filteredCommands: [],

    // Icons
    icons: icons,

    // Lifecycle
    init() {
      // Load recent commands from localStorage
      this.loadRecent();

      // Global keyboard shortcut
      this._keyHandler = (e) => {
        // Cmd/Ctrl + K
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
          e.preventDefault();
          this.toggle();
        }

        // Escape to close
        if (e.key === 'Escape' && this.isOpen) {
          e.preventDefault();
          this.close();
        }
      };
      document.addEventListener('keydown', this._keyHandler);

      // Initialize filtered results
      this.filterCommands();
    },

    destroy() {
      if (this._keyHandler) {
        document.removeEventListener('keydown', this._keyHandler);
      }
    },

    // Open palette
    open() {
      this.isOpen = true;
      this.query = '';
      this.activeIndex = 0;
      this.filterCommands();

      // Lock scroll
      if (window.UX && window.UX.lockScroll) {
        window.UX.lockScroll();
      }

      // Focus input
      this.$nextTick(() => {
        const input = this.$el.querySelector('.ux-command__input');
        if (input) input.focus();
      });

      this.$dispatch('command:open');
    },

    // Close palette
    close() {
      this.isOpen = false;
      this.query = '';

      // Unlock scroll
      if (window.UX && window.UX.unlockScroll) {
        window.UX.unlockScroll();
      }

      this.$dispatch('command:close');
    },

    // Toggle palette
    toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    },

    // Filter commands based on query
    async filterCommands() {
      const query = this.query.toLowerCase().trim();

      // If custom loader provided
      if (this.loadResults && query.length > 0) {
        this.loading = true;
        try {
          this.filteredCommands = await this.loadResults(query);
        } catch (error) {
          console.error('Command search error:', error);
          this.filteredCommands = [];
        } finally {
          this.loading = false;
        }
        return;
      }

      // Get all commands from groups or flat list
      let allCommands = [...this.commands];
      this.groups.forEach(group => {
        if (group.commands) {
          allCommands = allCommands.concat(group.commands.map(cmd => ({
            ...cmd,
            group: group.name
          })));
        }
      });

      // No query - show recent + all
      if (!query) {
        this.filteredCommands = this.recentCommands.length > 0
          ? [
              { group: 'Recientes', commands: this.recentCommands.slice(0, this.maxRecent) },
              ...this.groupCommands(allCommands)
            ]
          : this.groupCommands(allCommands);
        return;
      }

      // Filter by query
      const results = allCommands.filter(cmd => {
        const title = (cmd.title || cmd.name || '').toLowerCase();
        const description = (cmd.description || '').toLowerCase();
        const keywords = (cmd.keywords || []).join(' ').toLowerCase();

        if (this.fuzzySearch) {
          return this.fuzzyMatch(query, title) ||
                 this.fuzzyMatch(query, description) ||
                 this.fuzzyMatch(query, keywords);
        } else {
          return title.includes(query) ||
                 description.includes(query) ||
                 keywords.includes(query);
        }
      });

      this.filteredCommands = this.groupCommands(results);
      this.activeIndex = 0;
    },

    // Group commands by their group property
    groupCommands(commands) {
      const grouped = {};
      commands.forEach(cmd => {
        const groupName = cmd.group || 'Comandos';
        if (!grouped[groupName]) {
          grouped[groupName] = [];
        }
        grouped[groupName].push(cmd);
      });

      return Object.entries(grouped).map(([name, cmds]) => ({
        group: name,
        commands: cmds
      }));
    },

    // Simple fuzzy matching
    fuzzyMatch(query, text) {
      if (!text) return false;
      let queryIndex = 0;
      for (let i = 0; i < text.length && queryIndex < query.length; i++) {
        if (text[i] === query[queryIndex]) {
          queryIndex++;
        }
      }
      return queryIndex === query.length;
    },

    // Highlight matching text
    highlightMatch(text, query) {
      if (!query || !text) return text;

      const lowerText = text.toLowerCase();
      const lowerQuery = query.toLowerCase();
      const index = lowerText.indexOf(lowerQuery);

      if (index === -1) return text;

      const before = text.slice(0, index);
      const match = text.slice(index, index + query.length);
      const after = text.slice(index + query.length);

      return `${before}<span class="ux-command__highlight">${match}</span>${after}`;
    },

    // Get flat list of all visible commands
    getFlatCommands() {
      const flat = [];
      this.filteredCommands.forEach(group => {
        if (group.commands) {
          group.commands.forEach(cmd => flat.push(cmd));
        }
      });
      return flat;
    },

    // Handle keyboard navigation
    handleKeydown(e) {
      const flatCommands = this.getFlatCommands();

      switch (e.key) {
        case 'ArrowDown':
          e.preventDefault();
          this.activeIndex = Math.min(this.activeIndex + 1, flatCommands.length - 1);
          this.scrollToActive();
          break;

        case 'ArrowUp':
          e.preventDefault();
          this.activeIndex = Math.max(this.activeIndex - 1, 0);
          this.scrollToActive();
          break;

        case 'Enter':
          e.preventDefault();
          const activeCommand = flatCommands[this.activeIndex];
          if (activeCommand) {
            this.executeCommand(activeCommand);
          }
          break;

        case 'Tab':
          e.preventDefault();
          if (e.shiftKey) {
            this.activeIndex = Math.max(this.activeIndex - 1, 0);
          } else {
            this.activeIndex = Math.min(this.activeIndex + 1, flatCommands.length - 1);
          }
          this.scrollToActive();
          break;
      }
    },

    // Scroll to keep active item visible
    scrollToActive() {
      this.$nextTick(() => {
        const activeEl = this.$el.querySelector('.ux-command__item--active');
        if (activeEl) {
          activeEl.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
      });
    },

    // Execute a command
    executeCommand(command) {
      // Add to recent
      this.addToRecent(command);

      // Dispatch event
      this.$dispatch('command:execute', { command });

      // Run action if provided
      if (command.action && typeof command.action === 'function') {
        command.action(command);
      }

      // Handle URL navigation
      if (command.url) {
        window.location.href = command.url;
      }

      // Close if configured
      if (this.closeOnSelect) {
        this.close();
      }
    },

    // Add command to recent list
    addToRecent(command) {
      // Remove if already exists
      this.recentCommands = this.recentCommands.filter(c => c.id !== command.id);

      // Add to beginning
      this.recentCommands.unshift({
        ...command,
        recent: true
      });

      // Limit size
      if (this.recentCommands.length > this.maxRecent) {
        this.recentCommands = this.recentCommands.slice(0, this.maxRecent);
      }

      // Save to localStorage
      this.saveRecent();
    },

    // Load recent from localStorage
    loadRecent() {
      try {
        const stored = localStorage.getItem('ux-command-recent');
        if (stored) {
          this.recentCommands = JSON.parse(stored);
        }
      } catch (e) {
        console.warn('Could not load recent commands:', e);
      }
    },

    // Save recent to localStorage
    saveRecent() {
      try {
        localStorage.setItem('ux-command-recent', JSON.stringify(
          this.recentCommands.map(({ action, ...cmd }) => cmd)
        ));
      } catch (e) {
        console.warn('Could not save recent commands:', e);
      }
    },

    // Clear recent commands
    clearRecent() {
      this.recentCommands = [];
      localStorage.removeItem('ux-command-recent');
      this.filterCommands();
    },

    // Check if item is active
    isActiveItem(groupIndex, itemIndex) {
      let count = 0;
      for (let g = 0; g < groupIndex; g++) {
        if (this.filteredCommands[g] && this.filteredCommands[g].commands) {
          count += this.filteredCommands[g].commands.length;
        }
      }
      return count + itemIndex === this.activeIndex;
    },

    // Get default icon for command
    getIcon(command) {
      if (command.icon) {
        // If it's an SVG string, return as-is
        if (command.icon.includes('<svg')) {
          return command.icon;
        }
        // If it's a key to our icons object
        if (this.icons[command.icon]) {
          return this.icons[command.icon];
        }
      }
      // Default icon
      return this.icons.arrow;
    },

    // Format shortcut for display
    formatShortcut(shortcut) {
      if (!shortcut) return [];

      // Replace common symbols
      return shortcut
        .replace('Cmd', 'â')
        .replace('Ctrl', 'Ctrl')
        .replace('Alt', 'â¥')
        .replace('Shift', 'â§')
        .replace('Enter', 'âµ')
        .split('+')
        .map(key => key.trim());
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxCommand', commandData);
  }

  // Expose icons for external use
  window.UX = window.UX || {};
  window.UX.commandIcons = icons;
})();

/**
 * UX Content Component
 * Contenedor principal de contenido estilo Ionic
 * @requires ux-core.js
 */
(function () {
  'use strict';

  const styles = `
    /* ========================================
       UX App Container
    ======================================== */

    .ux-app {
      display: flex;
      flex-direction: column;
      min-height: 100dvh;
      background-color: var(--ux-background);
    }

    /* ========================================
       UX Page
    ======================================== */

    .ux-page {
      position: relative;
      display: grid;
      grid-template-rows: auto 1fr auto;
      grid-template-areas:
        "header"
        "content"
        "footer";
      flex: 1;
      width: 100%;
      height: 100%;
      min-height: 0;
      contain: layout style;
    }

    .ux-page > .ux-header {
      grid-area: header;
    }

    .ux-page > .ux-content {
      grid-area: content;
      min-height: 0;
    }

    .ux-page > .ux-footer {
      grid-area: footer;
    }

    /* ========================================
       UX Header
    ======================================== */

    .ux-header {
      position: sticky;
      top: 0;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      z-index: var(--ux-z-sticky);
      background-color: var(--ux-surface);
    }

    .ux-header--fixed {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: var(--ux-z-fixed);
    }

    .ux-header--translucent {
      background-color: rgba(var(--ux-surface-rgb, 255, 255, 255), 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    .ux-header--collapse {
      transition: transform var(--ux-transition-base) var(--ux-ease);
    }

    .ux-header--collapsed {
      transform: translateY(-100%);
    }

    /* ========================================
       UX Content
    ======================================== */

    .ux-content {
      position: relative;
      display: flex;
      flex-direction: column;
      flex: 1;
      width: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-y: contain;
    }

    .ux-content--fullscreen {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }

    .ux-content--scroll-y {
      overflow-y: scroll;
    }

    .ux-content--no-scroll {
      overflow: hidden;
    }

    /* Header offset */
    .ux-content--has-header {
      padding-top: var(--ux-header-height, 56px);
    }

    .ux-content--has-footer {
      padding-bottom: var(--ux-footer-height, 56px);
    }

    /* Safe area padding */
    .ux-content--safe-area {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
    }

    /* Content inner wrapper */
    .ux-content__inner {
      display: flex;
      flex-direction: column;
      flex: 1;
      padding: var(--ux-content-padding, var(--ux-space-lg));
    }

    .ux-content__inner--centered {
      align-items: center;
      justify-content: center;
    }

    /* ========================================
       UX Footer
    ======================================== */

    .ux-footer {
      position: sticky;
      bottom: 0;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      z-index: var(--ux-z-sticky);
      background-color: var(--ux-surface);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-footer--fixed {
      position: fixed;
      bottom: 0;
      z-index: var(--ux-z-fixed);
      left: 0;
      right: 0;
    }

    .ux-footer--translucent {
      background-color: rgba(var(--ux-surface-rgb, 255, 255, 255), 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: none;
    }

    .ux-footer--safe-area {
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* ========================================
       UX Split Pane (iPad/Tablet layout)
       Like Ionic: responsive sidebar with
       push/overlay modes
    ======================================== */

    .ux-split-pane {
      --ux-split-pane-side-width: 270px;
      --ux-split-pane-side-min-width: 270px;
      --ux-split-pane-side-max-width: 28%;
      --ux-split-pane-breakpoint: 992px;

      position: relative;
      display: flex;
      width: 100%;
      height: 100dvh;
      max-height: 100dvh;
      overflow: hidden;
    }

    /* Backdrop for overlay mode (mobile) */
    .ux-split-pane__backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: var(--ux-z-modal-backdrop);
      opacity: 0;
      visibility: hidden;
      transition:
        opacity 350ms var(--ux-ease-ios),
        visibility 350ms var(--ux-ease-ios);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-split-pane--open .ux-split-pane__backdrop {
      opacity: 1;
      visibility: visible;
    }

    /* Hide backdrop on large screens (push mode) */
    @media (min-width: 992px) {
      .ux-split-pane__backdrop {
        display: none;
      }
    }

    /* Side Panel */
    .ux-split-pane__side {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      z-index: var(--ux-z-modal);
      display: flex;
      flex-direction: column;
      width: var(--ux-split-pane-side-width);
      max-width: 85dvw;
      background-color: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-right: 0.5px solid var(--ux-glass-border);
      overflow: hidden;
      transform: translateX(-100%);
      /* iOS-style smooth transition */
      transition: transform 350ms var(--ux-ease-ios);
      will-change: transform;
    }

    /* Open state for mobile (overlay) */
    .ux-split-pane--open .ux-split-pane__side {
      transform: translateX(0);
    }

    /* Large screens: always visible, push mode */
    @media (min-width: 992px) {
      .ux-split-pane__side {
        position: relative;
        z-index: auto;
        width: clamp(
          var(--ux-split-pane-side-min-width),
          var(--ux-split-pane-side-max-width),
          350px
        );
        max-width: none;
        height: 100dvh;
        max-height: 100dvh;
        transform: translateX(0);
        flex-shrink: 0;
      }

      /* Collapsed state - slide out with animation */
      .ux-split-pane--collapsed .ux-split-pane__side {
        transform: translateX(-100%);
        position: absolute;
      }

      .ux-split-pane--collapsed.ux-split-pane--end .ux-split-pane__side {
        transform: translateX(100%);
      }
    }

    /* Main Content */
    .ux-split-pane__main {
      flex: 1;
      min-width: 0;
      width: 100%;
      height: 100dvh;
      max-height: 100dvh;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      /* iOS-style smooth transition for layout changes */
      transition: margin-left 350ms var(--ux-ease-ios);
    }

    /* Navbar inside main is sticky */
    .ux-split-pane__main > .ux-navbar {
      position: sticky;
      top: 0;
      z-index: var(--ux-z-sticky);
    }

    /* Navbar inside sidebar inherits glass effect */
    .ux-split-pane__side > .ux-navbar {
      background: transparent;
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    /* When sidebar visible on large screens, no margin needed (flexbox handles it) */
    @media (min-width: 992px) {
      .ux-split-pane__main {
        /* Push mode: content automatically adjusts via flex */
      }
    }

    /* ========================================
       Split Pane Variants
    ======================================== */

    /* Right side panel */
    .ux-split-pane--end .ux-split-pane__side {
      left: auto;
      right: 0;
      border-right: none;
      border-left: 0.5px solid var(--ux-glass-border);
      transform: translateX(100%);
    }

    .ux-split-pane--end.ux-split-pane--open .ux-split-pane__side {
      transform: translateX(0);
    }

    @media (min-width: 992px) {
      .ux-split-pane--end {
        flex-direction: row-reverse;
      }

      .ux-split-pane--end .ux-split-pane__side {
        transform: translateX(0);
      }
    }

    /* Always visible (no toggle needed) */
    .ux-split-pane--visible .ux-split-pane__side {
      transform: translateX(0);
    }

    .ux-split-pane--visible .ux-split-pane__backdrop {
      display: none;
    }

    @media (max-width: 991px) {
      .ux-split-pane--visible .ux-split-pane__side {
        position: relative;
        max-width: 50%;
      }
    }

    /* Always hidden (use as drawer only) */
    @media (min-width: 992px) {
      .ux-split-pane--drawer .ux-split-pane__side {
        position: fixed;
        transform: translateX(-100%);
      }

      .ux-split-pane--drawer.ux-split-pane--end .ux-split-pane__side {
        transform: translateX(100%);
      }

      .ux-split-pane--drawer.ux-split-pane--open .ux-split-pane__side {
        transform: translateX(0);
      }

      .ux-split-pane--drawer .ux-split-pane__backdrop {
        display: block;
      }
    }

    /* Glass variant */
    .ux-split-pane__side--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-right-color: var(--ux-glass-border);
    }

    /* ========================================
       Split Pane Menu Button
    ======================================== */

    .ux-split-pane__toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      padding: 0;
      background: none;
      border: none;
      color: var(--ux-primary);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-split-pane__toggle:hover {
      opacity: 0.7;
    }

    .ux-split-pane__toggle svg {
      width: 24px;
      height: 24px;
    }

    /* Hide toggle on large screens when not in drawer mode */
    @media (min-width: 992px) {
      .ux-split-pane:not(.ux-split-pane--drawer) .ux-split-pane__toggle {
        display: none;
      }
    }

    /* Collapse button for desktop - sits on sidebar edge */
    .ux-split-pane__collapse {
      display: none;
      position: absolute;
      top: 50%;
      right: -12px;
      transform: translateY(-50%);
      z-index: 10;
      width: 24px;
      height: 24px;
      padding: 0;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: 50%;
      color: var(--ux-text-secondary);
      cursor: pointer;
      box-shadow: var(--ux-shadow-sm);
      transition: all 250ms var(--ux-ease-ios);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-split-pane__collapse:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-split-pane__collapse svg {
      width: 14px;
      height: 14px;
      transition: transform 250ms var(--ux-ease-ios);
    }

    /* Rotate icon when collapsed */
    .ux-split-pane--collapsed .ux-split-pane__collapse svg {
      transform: rotate(180deg);
    }

    /* Show collapse button only on large screens */
    @media (min-width: 992px) {
      .ux-split-pane__collapse {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* When collapsed, position button at left edge of viewport */
      .ux-split-pane--collapsed .ux-split-pane__collapse {
        position: fixed;
        left: 0;
        right: auto;
        top: 50%;
        border-radius: 0 50% 50% 0;
        border-left: none;
      }
    }

    /* End position adjustments */
    .ux-split-pane--end .ux-split-pane__collapse {
      right: auto;
      left: -12px;
    }

    .ux-split-pane--end .ux-split-pane__collapse svg {
      transform: rotate(180deg);
    }

    .ux-split-pane--end.ux-split-pane--collapsed .ux-split-pane__collapse svg {
      transform: rotate(0deg);
    }

    @media (min-width: 992px) {
      .ux-split-pane--end.ux-split-pane--collapsed .ux-split-pane__collapse {
        left: auto;
        right: 0;
        border-radius: 50% 0 0 50%;
        border-left: 1px solid var(--ux-border-color);
        border-right: none;
      }
    }

    /* ========================================
       Scroll Utilities
    ======================================== */

    .ux-scroll {
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-y: contain;
    }

    .ux-scroll--x {
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
    }

    .ux-scroll--hidden {
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .ux-scroll--hidden::-webkit-scrollbar {
      display: none;
    }

    /* Snap scrolling */
    .ux-scroll--snap-x {
      scroll-snap-type: x mandatory;
    }

    .ux-scroll--snap-y {
      scroll-snap-type: y mandatory;
    }

    .ux-scroll__item--snap {
      scroll-snap-align: start;
    }

    .ux-scroll__item--snap-center {
      scroll-snap-align: center;
    }

    /* ========================================
       Container Utilities
    ======================================== */

    .ux-container {
      width: 100%;
      max-width: var(--ux-container-max-width, 1200px);
      margin-left: auto;
      margin-right: auto;
      padding-left: var(--ux-space-lg);
      padding-right: var(--ux-space-lg);
    }

    .ux-container--fluid {
      max-width: none;
    }

    .ux-container--narrow {
      max-width: 680px;
    }

    .ux-container--wide {
      max-width: 1400px;
    }

    /* ========================================
       Section
    ======================================== */

    .ux-section {
      padding: var(--ux-space-xl) 0;
    }

    .ux-section--sm {
      padding: var(--ux-space-lg) 0;
    }

    .ux-section--lg {
      padding: var(--ux-space-2xl) 0;
    }

    .ux-section__header {
      margin-bottom: var(--ux-space-lg);
    }

    .ux-section__title {
      font-size: var(--ux-font-size-xl);
      font-weight: 700;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-sm);
    }

    .ux-section__subtitle {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    /* ========================================
       Divider
    ======================================== */

    .ux-divider {
      height: 1px;
      background-color: var(--ux-border-color);
      margin: var(--ux-space-md) 0;
    }

    .ux-divider--inset {
      margin-left: var(--ux-space-lg);
      margin-right: var(--ux-space-lg);
    }

    .ux-divider--thick {
      height: 8px;
      background-color: var(--ux-surface-secondary);
    }

    .ux-divider--with-text {
      display: flex;
      align-items: center;
      height: auto;
      background: none;
    }

    .ux-divider--with-text::before,
    .ux-divider--with-text::after {
      content: '';
      flex: 1;
      height: 1px;
      background-color: var(--ux-border-color);
    }

    .ux-divider__text {
      padding: 0 var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Spacer Utilities
    ======================================== */

    .ux-spacer { flex: 1; }
    .ux-spacer-xs { height: var(--ux-space-xs); }
    .ux-spacer-sm { height: var(--ux-space-sm); }
    .ux-spacer-md { height: var(--ux-space-md); }
    .ux-spacer-lg { height: var(--ux-space-lg); }
    .ux-spacer-xl { height: var(--ux-space-xl); }
    .ux-spacer-2xl { height: var(--ux-space-2xl); }

    /* ========================================
       Padding Utilities
    ======================================== */

    .ux-p-0 { padding: 0 !important; }
    .ux-p-xs { padding: var(--ux-space-xs) !important; }
    .ux-p-sm { padding: var(--ux-space-sm) !important; }
    .ux-p-md { padding: var(--ux-space-md) !important; }
    .ux-p-lg { padding: var(--ux-space-lg) !important; }
    .ux-p-xl { padding: var(--ux-space-xl) !important; }

    .ux-px-0 { padding-left: 0 !important; padding-right: 0 !important; }
    .ux-px-xs { padding-left: var(--ux-space-xs) !important; padding-right: var(--ux-space-xs) !important; }
    .ux-px-sm { padding-left: var(--ux-space-sm) !important; padding-right: var(--ux-space-sm) !important; }
    .ux-px-md { padding-left: var(--ux-space-md) !important; padding-right: var(--ux-space-md) !important; }
    .ux-px-lg { padding-left: var(--ux-space-lg) !important; padding-right: var(--ux-space-lg) !important; }
    .ux-px-xl { padding-left: var(--ux-space-xl) !important; padding-right: var(--ux-space-xl) !important; }

    .ux-py-0 { padding-top: 0 !important; padding-bottom: 0 !important; }
    .ux-py-xs { padding-top: var(--ux-space-xs) !important; padding-bottom: var(--ux-space-xs) !important; }
    .ux-py-sm { padding-top: var(--ux-space-sm) !important; padding-bottom: var(--ux-space-sm) !important; }
    .ux-py-md { padding-top: var(--ux-space-md) !important; padding-bottom: var(--ux-space-md) !important; }
    .ux-py-lg { padding-top: var(--ux-space-lg) !important; padding-bottom: var(--ux-space-lg) !important; }
    .ux-py-xl { padding-top: var(--ux-space-xl) !important; padding-bottom: var(--ux-space-xl) !important; }

    /* ========================================
       Margin Utilities
    ======================================== */

    .ux-m-0 { margin: 0 !important; }
    .ux-m-auto { margin: auto !important; }
    .ux-m-xs { margin: var(--ux-space-xs) !important; }
    .ux-m-sm { margin: var(--ux-space-sm) !important; }
    .ux-m-md { margin: var(--ux-space-md) !important; }
    .ux-m-lg { margin: var(--ux-space-lg) !important; }
    .ux-m-xl { margin: var(--ux-space-xl) !important; }

    .ux-mx-auto { margin-left: auto !important; margin-right: auto !important; }
    .ux-my-auto { margin-top: auto !important; margin-bottom: auto !important; }

    .ux-mt-0 { margin-top: 0 !important; }
    .ux-mt-xs { margin-top: var(--ux-space-xs) !important; }
    .ux-mt-sm { margin-top: var(--ux-space-sm) !important; }
    .ux-mt-md { margin-top: var(--ux-space-md) !important; }
    .ux-mt-lg { margin-top: var(--ux-space-lg) !important; }
    .ux-mt-xl { margin-top: var(--ux-space-xl) !important; }

    .ux-mb-0 { margin-bottom: 0 !important; }
    .ux-mb-xs { margin-bottom: var(--ux-space-xs) !important; }
    .ux-mb-sm { margin-bottom: var(--ux-space-sm) !important; }
    .ux-mb-md { margin-bottom: var(--ux-space-md) !important; }
    .ux-mb-lg { margin-bottom: var(--ux-space-lg) !important; }
    .ux-mb-xl { margin-bottom: var(--ux-space-xl) !important; }

    /* ========================================
       Pull to Refresh Target
    ======================================== */

    .ux-content__refresher {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      transform: translateY(-100%);
      transition: transform var(--ux-transition-base) var(--ux-ease);
    }

    .ux-content--refreshing .ux-content__refresher {
      transform: translateY(0);
    }

    /* ========================================
       Fixed Slot (elements outside scroll)
    ======================================== */

    .ux-content__fixed {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 2;
    }

    .ux-content__fixed > * {
      pointer-events: auto;
    }

    /* Fixed position helpers */
    .ux-fixed-top {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
    }

    .ux-fixed-bottom {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
    }

    .ux-fixed-top-left {
      position: absolute;
      top: 0;
      left: 0;
    }

    .ux-fixed-top-right {
      position: absolute;
      top: 0;
      right: 0;
    }

    .ux-fixed-bottom-left {
      position: absolute;
      bottom: 0;
      left: 0;
    }

    .ux-fixed-bottom-right {
      position: absolute;
      bottom: 0;
      right: 0;
    }

    .ux-fixed-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    /* ========================================
       Content Color Variants
    ======================================== */

    .ux-content--primary {
      --ux-content-background: var(--ux-primary);
      --ux-content-color: var(--ux-primary-contrast);
      background-color: var(--ux-content-background);
      color: var(--ux-content-color);
    }

    .ux-content--secondary {
      --ux-content-background: var(--ux-secondary);
      --ux-content-color: var(--ux-secondary-contrast);
      background-color: var(--ux-content-background);
      color: var(--ux-content-color);
    }

    .ux-content--tertiary {
      --ux-content-background: var(--ux-tertiary);
      --ux-content-color: var(--ux-tertiary-contrast);
      background-color: var(--ux-content-background);
      color: var(--ux-content-color);
    }

    .ux-content--success {
      --ux-content-background: var(--ux-success);
      --ux-content-color: var(--ux-success-contrast);
      background-color: var(--ux-content-background);
      color: var(--ux-content-color);
    }

    .ux-content--warning {
      --ux-content-background: var(--ux-warning);
      --ux-content-color: var(--ux-warning-contrast);
      background-color: var(--ux-content-background);
      color: var(--ux-content-color);
    }

    .ux-content--danger {
      --ux-content-background: var(--ux-danger);
      --ux-content-color: var(--ux-danger-contrast);
      background-color: var(--ux-content-background);
      color: var(--ux-content-color);
    }

    .ux-content--light {
      --ux-content-background: var(--ux-light);
      --ux-content-color: var(--ux-light-contrast);
      background-color: var(--ux-content-background);
      color: var(--ux-content-color);
    }

    .ux-content--dark {
      --ux-content-background: var(--ux-dark);
      --ux-content-color: var(--ux-dark-contrast);
      background-color: var(--ux-content-background);
      color: var(--ux-content-color);
    }

    .ux-content--medium {
      --ux-content-background: var(--ux-medium);
      --ux-content-color: var(--ux-medium-contrast);
      background-color: var(--ux-content-background);
      color: var(--ux-content-color);
    }

    /* ========================================
       Scroll to Top Button
    ======================================== */

    .ux-scroll-top {
      position: fixed;
      bottom: calc(var(--ux-space-lg) + env(safe-area-inset-bottom));
      right: var(--ux-space-lg);
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: 50%;
      box-shadow: var(--ux-shadow-md);
      cursor: pointer;
      opacity: 0;
      visibility: hidden;
      transform: translateY(20px);
      transition:
        opacity var(--ux-transition-base) var(--ux-ease),
        visibility var(--ux-transition-base) var(--ux-ease),
        transform var(--ux-transition-base) var(--ux-ease);
      z-index: 100;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-scroll-top--visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-scroll-top:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-scroll-top:active {
      transform: scale(0.95);
    }

    .ux-scroll-top__icon {
      width: 24px;
      height: 24px;
      color: var(--ux-text);
    }

    .ux-scroll-top__icon svg {
      width: 100%;
      height: 100%;
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-content-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-content-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for content with scroll events and methods
  // ARIA: Main content landmark
  const contentComponent = (config = {}) => ({
    scrollTop: 0,
    scrollLeft: 0,
    scrollHeight: 0,
    scrollWidth: 0,
    clientHeight: 0,
    clientWidth: 0,
    isScrolling: false,
    scrollEvents: config.scrollEvents || false,
    _scrollTimeout: null,
    _lastScrollTop: 0,
    _scrollDirection: 'down',
    contentId: config.id || 'ux-content-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes
    get ariaAttrs() {
      return {
        'role': 'main',
        'id': this.contentId
      };
    },

    init() {
      this.$nextTick(() => {
        this.updateScrollInfo();
      });
    },

    // Get content element
    getContentElement() {
      return this.$refs.content || this.$el;
    },

    // Update scroll information
    updateScrollInfo() {
      const el = this.getContentElement();
      if (!el) return;

      this.scrollTop = el.scrollTop;
      this.scrollLeft = el.scrollLeft;
      this.scrollHeight = el.scrollHeight;
      this.scrollWidth = el.scrollWidth;
      this.clientHeight = el.clientHeight;
      this.clientWidth = el.clientWidth;
    },

    // Handle scroll event
    handleScroll(event) {
      const el = event.target;

      // Determine scroll direction
      this._scrollDirection = el.scrollTop > this._lastScrollTop ? 'down' : 'up';
      this._lastScrollTop = el.scrollTop;

      // Update scroll info
      this.scrollTop = el.scrollTop;
      this.scrollLeft = el.scrollLeft;

      // Dispatch scroll start
      if (!this.isScrolling) {
        this.isScrolling = true;
        this.$dispatch('ux-scroll-start', {
          scrollTop: this.scrollTop,
          scrollLeft: this.scrollLeft,
          direction: this._scrollDirection
        });
      }

      // Dispatch scroll event (throttled if scrollEvents is false)
      if (this.scrollEvents) {
        this.$dispatch('ux-scroll', {
          scrollTop: this.scrollTop,
          scrollLeft: this.scrollLeft,
          scrollHeight: el.scrollHeight,
          clientHeight: el.clientHeight,
          direction: this._scrollDirection,
          detail: {
            currentY: this.scrollTop,
            currentX: this.scrollLeft,
            deltaY: el.scrollTop - this._lastScrollTop,
            velocityY: 0 // Would need RAF for accurate velocity
          }
        });
      }

      // Dispatch scroll end (debounced)
      clearTimeout(this._scrollTimeout);
      this._scrollTimeout = setTimeout(() => {
        this.isScrolling = false;
        this.$dispatch('ux-scroll-end', {
          scrollTop: this.scrollTop,
          scrollLeft: this.scrollLeft,
          direction: this._scrollDirection
        });
      }, 150);
    },

    // Scroll to top
    scrollToTop(duration = 300) {
      return this.scrollToPoint(0, 0, duration);
    },

    // Scroll to bottom
    scrollToBottom(duration = 300) {
      const el = this.getContentElement();
      if (!el) return Promise.resolve();

      return this.scrollToPoint(0, el.scrollHeight - el.clientHeight, duration);
    },

    // Scroll to specific point
    scrollToPoint(x, y, duration = 300) {
      const el = this.getContentElement();
      if (!el) return Promise.resolve();

      return new Promise((resolve) => {
        if (duration === 0) {
          el.scrollTop = y;
          el.scrollLeft = x;
          this.updateScrollInfo();
          resolve();
          return;
        }

        el.scrollTo({
          top: y,
          left: x,
          behavior: 'smooth'
        });

        // Resolve after animation
        setTimeout(() => {
          this.updateScrollInfo();
          resolve();
        }, duration);
      });
    },

    // Scroll by amount
    scrollByPoint(x, y, duration = 300) {
      const el = this.getContentElement();
      if (!el) return Promise.resolve();

      return this.scrollToPoint(
        el.scrollLeft + x,
        el.scrollTop + y,
        duration
      );
    },

    // Scroll to element
    scrollToElement(selector, duration = 300) {
      const el = this.getContentElement();
      const target = el?.querySelector(selector);
      if (!target) return Promise.resolve();

      const targetRect = target.getBoundingClientRect();
      const contentRect = el.getBoundingClientRect();

      return this.scrollToPoint(
        el.scrollLeft,
        el.scrollTop + (targetRect.top - contentRect.top),
        duration
      );
    },

    // Get scroll element (for external use)
    getScrollElement() {
      return this.getContentElement();
    },

    // Check if scrolled to top
    get isAtTop() {
      return this.scrollTop <= 0;
    },

    // Check if scrolled to bottom
    get isAtBottom() {
      const el = this.getContentElement();
      if (!el) return false;
      return this.scrollTop >= el.scrollHeight - el.clientHeight - 1;
    },

    // Get scroll progress (0 to 1)
    get scrollProgress() {
      const el = this.getContentElement();
      if (!el || el.scrollHeight <= el.clientHeight) return 0;
      return this.scrollTop / (el.scrollHeight - el.clientHeight);
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxContent', contentComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxContent', contentComponent);
    });
  }

  // Alpine component for page
  // Handles page-level concerns like visibility, lifecycle
  const pageComponent = (config = {}) => ({
    isActive: config.isActive !== false,
    pageId: config.id || 'ux-page-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes
    get ariaAttrs() {
      return {
        'role': 'document',
        'id': this.pageId,
        'aria-hidden': !this.isActive ? 'true' : 'false'
      };
    },

    // Lifecycle methods
    onEnter() {
      this.isActive = true;
      this.$dispatch('ux-page-enter', { pageId: this.pageId });
    },

    onLeave() {
      this.isActive = false;
      this.$dispatch('ux-page-leave', { pageId: this.pageId });
    },

    // For use with routers
    activate() {
      this.onEnter();
    },

    deactivate() {
      this.onLeave();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxPage', pageComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxPage', pageComponent);
    });
  }

  // Alpine component for scroll-to-top
  const scrollTopComponent = (config = {}) => ({
    visible: false,
    threshold: config.threshold || 300,

    init() {
      this.checkScroll = this.checkScroll.bind(this);
    },

    checkScroll(scrollTop) {
      this.visible = scrollTop > this.threshold;
    },

    scrollToTop() {
      const content = document.querySelector('.ux-content');
      if (content) {
        content.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      } else {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxScrollTop', scrollTopComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxScrollTop', scrollTopComponent);
    });
  }

  // Alpine component for collapsible header
  const collapsibleHeaderComponent = (config = {}) => ({
    collapsed: false,
    lastScrollTop: 0,
    threshold: config.threshold || 50,

    handleScroll(scrollTop) {
      if (scrollTop > this.lastScrollTop && scrollTop > this.threshold) {
        this.collapsed = true;
      } else {
        this.collapsed = false;
      }
      this.lastScrollTop = scrollTop;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxCollapsibleHeader', collapsibleHeaderComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxCollapsibleHeader', collapsibleHeaderComponent);
    });
  }

  // Alpine component for Split Pane (Ionic-style)
  // Handles responsive sidebar with push/overlay modes
  const splitPaneComponent = (config = {}) => ({
    isOpen: false,
    isCollapsed: config.collapsed || false,
    mode: config.mode || 'auto', // 'auto', 'push', 'overlay', 'visible'
    side: config.side || 'start', // 'start' or 'end'
    breakpoint: config.breakpoint || 992,
    closeOnBackdrop: config.closeOnBackdrop !== false,
    closeOnEscape: config.closeOnEscape !== false,
    _mediaQuery: null,
    _isLargeScreen: false,

    init() {
      // Setup media query listener
      this._mediaQuery = window.matchMedia(`(min-width: ${this.breakpoint}px)`);
      this._isLargeScreen = this._mediaQuery.matches;

      const handleChange = (e) => {
        this._isLargeScreen = e.matches;
        // Auto-close on resize to large screen (push mode takes over)
        if (e.matches && this.mode !== 'overlay') {
          this.isOpen = false;
        }
        this.$dispatch('splitpane-breakpoint', { isLargeScreen: e.matches });
      };

      this._mediaQuery.addEventListener('change', handleChange);

      // Escape key handler
      if (this.closeOnEscape) {
        this._escapeHandler = (e) => {
          if (e.key === 'Escape' && this.isOpen) {
            this.close();
          }
        };
        document.addEventListener('keydown', this._escapeHandler);
      }
    },

    destroy() {
      if (this._escapeHandler) {
        document.removeEventListener('keydown', this._escapeHandler);
      }
    },

    // Open the sidebar (for mobile/overlay mode)
    open() {
      this.isOpen = true;
      if (!this._isLargeScreen || this.mode === 'overlay') {
        if (window.UX?.lockScroll) {
          window.UX.lockScroll();
        } else {
          document.body.style.overflow = 'hidden';
        }
      }
      this.$dispatch('splitpane-open');
    },

    // Close the sidebar
    close() {
      this.isOpen = false;
      if (window.UX?.unlockScroll) {
        window.UX.unlockScroll();
      } else {
        document.body.style.overflow = '';
      }
      this.$dispatch('splitpane-close');
    },

    // Toggle the sidebar
    toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    },

    // Handle backdrop click
    handleBackdropClick() {
      if (this.closeOnBackdrop) {
        this.close();
      }
    },

    // Collapse/expand on large screens
    collapse() {
      this.isCollapsed = true;
      this.$dispatch('splitpane-collapse');
    },

    expand() {
      this.isCollapsed = false;
      this.$dispatch('splitpane-expand');
    },

    toggleCollapse() {
      if (this.isCollapsed) {
        this.expand();
      } else {
        this.collapse();
      }
    },

    // Check if sidebar is visible (either open or on large screen)
    get isVisible() {
      if (this.mode === 'visible') return true;
      if (this._isLargeScreen && this.mode !== 'overlay' && !this.isCollapsed) {
        return true;
      }
      return this.isOpen;
    },

    // Check if we're in overlay mode (mobile or forced overlay)
    get isOverlay() {
      return !this._isLargeScreen || this.mode === 'overlay';
    },

    // Get container classes
    get containerClasses() {
      return {
        'ux-split-pane--open': this.isOpen,
        'ux-split-pane--collapsed': this.isCollapsed,
        'ux-split-pane--end': this.side === 'end',
        'ux-split-pane--visible': this.mode === 'visible',
        'ux-split-pane--drawer': this.mode === 'overlay'
      };
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSplitPane', splitPaneComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSplitPane', splitPaneComponent);
    });
  }

  // Menu icon SVG for split pane toggle button
  const menuIconSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>`;

  // Export for use in templates
  window.UX = window.UX || {};
  window.UX.menuIconSvg = menuIconSvg;
})();

/**
 * UX Context Menu Component
 * Right-click context menus with iOS 26 Liquid Glass design
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       UX Context Menu
       iOS 26 Style - Liquid Glass Design
       ========================================================================== */

    :root {
      /* Context Menu Tokens */
      --ux-context-menu-min-width: 180px;
      --ux-context-menu-max-width: 280px;
      --ux-context-menu-padding: var(--ux-space-xs);
      --ux-context-menu-border-radius: var(--ux-border-radius-lg);
      --ux-context-menu-shadow: 0 10px 40px rgba(0, 0, 0, 0.18), 0 2px 10px rgba(0, 0, 0, 0.12);
      --ux-context-menu-item-height: 36px;
      --ux-context-menu-item-padding: 0 var(--ux-space-md);
      --ux-context-menu-item-gap: var(--ux-space-sm);
      --ux-context-menu-divider-margin: var(--ux-space-xs);
      --ux-context-menu-section-padding: var(--ux-space-sm) var(--ux-space-md);
    }

    /* ==========================================================================
       Context Menu Container
       ========================================================================== */

    .ux-context-menu {
      position: fixed;
      z-index: var(--ux-z-popover);
      min-width: var(--ux-context-menu-min-width);
      max-width: var(--ux-context-menu-max-width);
      max-height: calc(100dvh - 32px);
      overflow-y: auto;
      overscroll-behavior: contain;
      padding: var(--ux-context-menu-padding);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-context-menu-border-radius);
      box-shadow: var(--ux-context-menu-shadow);

      /* Hidden by default */
      opacity: 0;
      visibility: hidden;
      transform: scale(0.95);
      transform-origin: top left;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease-ios),
        transform var(--ux-transition-fast) var(--ux-ease-ios),
        visibility var(--ux-transition-fast);
    }

    /* Visible state */
    .ux-context-menu--open {
      opacity: 1;
      visibility: visible;
      transform: scale(1);
    }

    /* Transform origin based on position */
    .ux-context-menu--origin-top-left {
      transform-origin: top left;
    }

    .ux-context-menu--origin-top-right {
      transform-origin: top right;
    }

    .ux-context-menu--origin-bottom-left {
      transform-origin: bottom left;
    }

    .ux-context-menu--origin-bottom-right {
      transform-origin: bottom right;
    }

    /* ==========================================================================
       Context Menu Item
       ========================================================================== */

    .ux-context-menu__item {
      display: flex;
      align-items: center;
      gap: var(--ux-context-menu-item-gap);
      min-height: var(--ux-context-menu-item-height);
      padding: var(--ux-context-menu-item-padding);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      text-decoration: none;
      border-radius: var(--ux-border-radius);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease-ios);
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-context-menu__item:hover,
    .ux-context-menu__item:focus {
      background: var(--ux-surface-secondary);
      outline: none;
    }

    .ux-context-menu__item:active {
      background: var(--ux-surface-tertiary);
    }

    .ux-context-menu__item:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: -2px;
    }

    /* Item icon */
    .ux-context-menu__item-icon {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      opacity: 0.7;
    }

    .ux-context-menu__item-icon svg {
      width: 100%;
      height: 100%;
    }

    /* Item text */
    .ux-context-menu__item-text {
      flex: 1;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Item shortcut */
    .ux-context-menu__item-shortcut {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      margin-left: auto;
      padding-left: var(--ux-space-md);
      font-family: system-ui, -apple-system, sans-serif;
    }

    /* Item arrow for submenus */
    .ux-context-menu__item-arrow {
      width: 14px;
      height: 14px;
      margin-left: auto;
      opacity: 0.5;
      flex-shrink: 0;
    }

    .ux-context-menu__item-arrow svg {
      width: 100%;
      height: 100%;
    }

    /* ==========================================================================
       Item Variants
       ========================================================================== */

    /* Danger item */
    .ux-context-menu__item--danger {
      color: var(--ux-danger);
    }

    .ux-context-menu__item--danger:hover,
    .ux-context-menu__item--danger:focus {
      background: rgba(var(--ux-danger-rgb), 0.1);
    }

    .ux-context-menu__item--danger .ux-context-menu__item-icon {
      opacity: 1;
    }

    /* Disabled item */
    .ux-context-menu__item--disabled,
    .ux-context-menu__item:disabled {
      opacity: 0.4;
      pointer-events: none;
      cursor: not-allowed;
    }

    /* Selected/checked item */
    .ux-context-menu__item--selected {
      color: var(--ux-primary);
    }

    .ux-context-menu__item--selected .ux-context-menu__item-icon {
      opacity: 1;
    }

    /* Active item (keyboard navigation) */
    .ux-context-menu__item--active {
      background: var(--ux-surface-secondary);
    }

    /* ==========================================================================
       Context Menu Divider
       ========================================================================== */

    .ux-context-menu__divider {
      height: 1px;
      background: var(--ux-border-color);
      margin: var(--ux-context-menu-divider-margin) 0;
    }

    /* ==========================================================================
       Context Menu Section Label
       ========================================================================== */

    .ux-context-menu__section {
      padding: var(--ux-context-menu-section-padding);
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      user-select: none;
    }

    .ux-context-menu__section:not(:first-child) {
      margin-top: var(--ux-space-xs);
    }

    /* ==========================================================================
       Context Menu Submenu
       ========================================================================== */

    .ux-context-menu__submenu {
      position: relative;
    }

    .ux-context-menu__submenu-content {
      position: absolute;
      left: 100%;
      top: 0;
      margin-left: var(--ux-space-xs);
      min-width: var(--ux-context-menu-min-width);
      max-width: var(--ux-context-menu-max-width);
      padding: var(--ux-context-menu-padding);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-context-menu-border-radius);
      box-shadow: var(--ux-context-menu-shadow);
      opacity: 0;
      visibility: hidden;
      transform: scale(0.95) translateX(-8px);
      transform-origin: left top;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease-ios),
        transform var(--ux-transition-fast) var(--ux-ease-ios),
        visibility var(--ux-transition-fast);
    }

    /* Submenu opens on hover or when active */
    .ux-context-menu__submenu:hover > .ux-context-menu__submenu-content,
    .ux-context-menu__submenu--open > .ux-context-menu__submenu-content {
      opacity: 1;
      visibility: visible;
      transform: scale(1) translateX(0);
    }

    /* Submenu opens to the left when near right edge */
    .ux-context-menu__submenu-content--left {
      left: auto;
      right: 100%;
      margin-left: 0;
      margin-right: var(--ux-space-xs);
      transform-origin: right top;
      transform: scale(0.95) translateX(8px);
    }

    .ux-context-menu__submenu:hover > .ux-context-menu__submenu-content--left,
    .ux-context-menu__submenu--open > .ux-context-menu__submenu-content--left {
      transform: scale(1) translateX(0);
    }

    /* Submenu item with arrow indicator */
    .ux-context-menu__submenu > .ux-context-menu__item::after {
      content: '';
      width: 14px;
      height: 14px;
      margin-left: auto;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpolyline points='9 18 15 12 9 6'%3E%3C/polyline%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.5;
      flex-shrink: 0;
    }

    /* ==========================================================================
       Glass Variant (iOS 26 Liquid Glass)
       ========================================================================== */

    .ux-context-menu--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-context-menu--glass .ux-context-menu__item:hover,
    .ux-context-menu--glass .ux-context-menu__item:focus {
      background: rgba(255, 255, 255, 0.15);
    }

    .ux-context-menu--glass .ux-context-menu__item:active {
      background: rgba(255, 255, 255, 0.25);
    }

    .ux-context-menu--glass .ux-context-menu__divider {
      background: var(--ux-glass-border);
    }

    .ux-context-menu--glass .ux-context-menu__submenu-content {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    /* ==========================================================================
       Compact Variant
       ========================================================================== */

    .ux-context-menu--compact {
      --ux-context-menu-item-height: 32px;
      --ux-context-menu-padding: 4px;
    }

    .ux-context-menu--compact .ux-context-menu__item {
      font-size: var(--ux-font-size-xs);
    }

    .ux-context-menu--compact .ux-context-menu__item-icon {
      width: 14px;
      height: 14px;
    }

    /* ==========================================================================
       Large Variant
       ========================================================================== */

    .ux-context-menu--lg {
      --ux-context-menu-item-height: 44px;
      --ux-context-menu-min-width: 220px;
    }

    .ux-context-menu--lg .ux-context-menu__item {
      font-size: var(--ux-font-size-md);
    }

    .ux-context-menu--lg .ux-context-menu__item-icon {
      width: 20px;
      height: 20px;
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light) {
        --ux-context-menu-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      :root:not(.ux-light) .ux-context-menu--glass .ux-context-menu__item:hover,
      :root:not(.ux-light) .ux-context-menu--glass .ux-context-menu__item:focus {
        background: rgba(255, 255, 255, 0.1);
      }

      :root:not(.ux-light) .ux-context-menu--glass .ux-context-menu__item:active {
        background: rgba(255, 255, 255, 0.15);
      }
    }

    .ux-dark {
      --ux-context-menu-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .ux-dark .ux-context-menu--glass .ux-context-menu__item:hover,
    .ux-dark .ux-context-menu--glass .ux-context-menu__item:focus {
      background: rgba(255, 255, 255, 0.1);
    }

    .ux-dark .ux-context-menu--glass .ux-context-menu__item:active {
      background: rgba(255, 255, 255, 0.15);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-context-menu {
        transition: opacity var(--ux-transition-fast), visibility var(--ux-transition-fast);
        transform: none !important;
      }

      .ux-context-menu--open {
        transform: none !important;
      }

      .ux-context-menu__submenu-content {
        transition: opacity var(--ux-transition-fast), visibility var(--ux-transition-fast);
        transform: none !important;
      }

      .ux-context-menu__submenu:hover > .ux-context-menu__submenu-content,
      .ux-context-menu__submenu--open > .ux-context-menu__submenu-content {
        transform: none !important;
      }
    }

    /* ==========================================================================
       Mobile Styles
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-context-menu {
        --ux-context-menu-item-height: 44px;
        --ux-context-menu-min-width: 200px;
      }

      .ux-context-menu__item {
        font-size: var(--ux-font-size-md);
      }

      /* Submenus appear inline on mobile */
      .ux-context-menu__submenu-content {
        position: static;
        margin-left: 0;
        margin-top: var(--ux-space-xs);
        padding-left: var(--ux-space-md);
        border: none;
        box-shadow: none;
        background: transparent;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        opacity: 1;
        visibility: visible;
        transform: none;
      }

      .ux-context-menu__submenu-content--left {
        margin-right: 0;
      }

      .ux-context-menu__submenu-content .ux-context-menu__item {
        padding-left: var(--ux-space-lg);
      }
    }

    /* ==========================================================================
       Backdrop (optional overlay)
       ========================================================================== */

    .ux-context-menu-backdrop {
      position: fixed;
      inset: 0;
      z-index: calc(var(--ux-z-popover) - 1);
      background: transparent;
    }

    .ux-context-menu-backdrop--visible {
      background: rgba(0, 0, 0, 0.1);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-context-menu-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-context-menu-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const contextMenuComponent = (config = {}) => ({
    isOpen: false,
    x: 0,
    y: 0,
    items: config.items || [],
    activeIndex: -1,
    originClass: 'ux-context-menu--origin-top-left',
    menuId: config.id || 'ux-context-menu-' + Math.random().toString(36).substr(2, 9),

    // Config options
    closeOnSelect: config.closeOnSelect !== false,
    closeOnClickOutside: config.closeOnClickOutside !== false,
    closeOnEscape: config.closeOnEscape !== false,
    showBackdrop: config.showBackdrop || false,

    // Focusable items cache
    _items: [],

    init() {
      // Escape handler
      if (this.closeOnEscape) {
        this._escapeHandler = (e) => {
          if (this.isOpen && e.key === 'Escape') {
            e.preventDefault();
            this.close();
          }
        };
        document.addEventListener('keydown', this._escapeHandler);
      }

      // Click outside handler
      if (this.closeOnClickOutside) {
        this._clickOutsideHandler = (e) => {
          if (this.isOpen) {
            const menu = this.$refs.menu;
            if (menu && !menu.contains(e.target)) {
              this.close();
            }
          }
        };
        // Use mousedown for quicker response
        document.addEventListener('mousedown', this._clickOutsideHandler);
      }

      // Close on scroll
      this._scrollHandler = () => {
        if (this.isOpen) {
          this.close();
        }
      };
      window.addEventListener('scroll', this._scrollHandler, { passive: true });

      // Close on resize
      this._resizeHandler = () => {
        if (this.isOpen) {
          this.close();
        }
      };
      window.addEventListener('resize', this._resizeHandler, { passive: true });
    },

    destroy() {
      if (this._escapeHandler) {
        document.removeEventListener('keydown', this._escapeHandler);
      }
      if (this._clickOutsideHandler) {
        document.removeEventListener('mousedown', this._clickOutsideHandler);
      }
      if (this._scrollHandler) {
        window.removeEventListener('scroll', this._scrollHandler);
      }
      if (this._resizeHandler) {
        window.removeEventListener('resize', this._resizeHandler);
      }
    },

    /**
     * Open the context menu at the specified position
     * @param {MouseEvent|Object} event - Mouse event or {x, y} coordinates
     * @param {Array} items - Optional array of menu items to display
     */
    open(event, items) {
      // Update items if provided
      if (items && Array.isArray(items)) {
        this.items = items;
      }

      // Get coordinates from event or object
      if (event instanceof Event) {
        event.preventDefault();
        this.x = event.clientX;
        this.y = event.clientY;
      } else if (event && typeof event === 'object') {
        this.x = event.x || event.clientX || 0;
        this.y = event.y || event.clientY || 0;
      }

      this.isOpen = true;
      this.activeIndex = -1;

      // Position adjustment and focus after render
      this.$nextTick(() => {
        this._adjustPosition();
        this._updateItemsList();

        // Focus first item for keyboard navigation
        if (this._items.length > 0) {
          this._items[0].focus();
          this.activeIndex = 0;
        }
      });

      this.$dispatch('contextmenu:open', { x: this.x, y: this.y, items: this.items });
    },

    /**
     * Close the context menu
     */
    close() {
      if (!this.isOpen) return;

      this.isOpen = false;
      this.activeIndex = -1;

      this.$dispatch('contextmenu:close');
    },

    /**
     * Toggle the context menu
     */
    toggle(event, items) {
      if (this.isOpen) {
        this.close();
      } else {
        this.open(event, items);
      }
    },

    /**
     * Select an item
     * @param {Object} item - The menu item object
     * @param {Event} event - The triggering event
     */
    select(item, event) {
      if (item.disabled) return;

      // Dispatch event with item data
      this.$dispatch('contextmenu:select', { item, event });

      // Execute action if provided
      if (item.action && typeof item.action === 'function') {
        item.action(item, event);
      }

      // Close menu if configured
      if (this.closeOnSelect && !item.keepOpen && !item.submenu) {
        this.close();
      }
    },

    /**
     * Adjust menu position to stay within viewport
     */
    _adjustPosition() {
      const menu = this.$refs.menu;
      if (!menu) return;

      const rect = menu.getBoundingClientRect();
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      const margin = 8;

      let adjustedX = this.x;
      let adjustedY = this.y;
      let originH = 'left';
      let originV = 'top';

      // Horizontal adjustment
      if (this.x + rect.width > viewportWidth - margin) {
        adjustedX = Math.max(margin, viewportWidth - rect.width - margin);
        // If menu would appear to the left of cursor, adjust origin
        if (adjustedX < this.x) {
          originH = 'right';
        }
      }

      // Vertical adjustment
      if (this.y + rect.height > viewportHeight - margin) {
        adjustedY = Math.max(margin, viewportHeight - rect.height - margin);
        // If menu would appear above cursor, adjust origin
        if (adjustedY < this.y) {
          originV = 'bottom';
        }
      }

      // Update position
      this.x = adjustedX;
      this.y = adjustedY;

      // Update transform origin for animation
      this.originClass = `ux-context-menu--origin-${originV}-${originH}`;
    },

    /**
     * Update the list of focusable items
     */
    _updateItemsList() {
      const menu = this.$refs.menu;
      if (!menu) return;

      this._items = Array.from(
        menu.querySelectorAll('.ux-context-menu__item:not(.ux-context-menu__item--disabled)')
      );
    },

    /**
     * Handle keyboard navigation
     */
    handleKeydown(e) {
      if (!this.isOpen) return;

      switch (e.key) {
        case 'ArrowDown':
          e.preventDefault();
          this.focusNext();
          break;

        case 'ArrowUp':
          e.preventDefault();
          this.focusPrev();
          break;

        case 'ArrowRight':
          // Open submenu if focused item has one
          e.preventDefault();
          this._openSubmenu();
          break;

        case 'ArrowLeft':
          // Close submenu
          e.preventDefault();
          this._closeSubmenu();
          break;

        case 'Home':
          e.preventDefault();
          this.focusFirst();
          break;

        case 'End':
          e.preventDefault();
          this.focusLast();
          break;

        case 'Enter':
        case ' ':
          e.preventDefault();
          if (this.activeIndex >= 0 && this._items[this.activeIndex]) {
            this._items[this.activeIndex].click();
          }
          break;

        case 'Tab':
          // Close on tab
          this.close();
          break;
      }
    },

    /**
     * Focus the next menu item
     */
    focusNext() {
      if (this._items.length === 0) return;

      this.activeIndex = this.activeIndex < this._items.length - 1 ? this.activeIndex + 1 : 0;
      this._items[this.activeIndex]?.focus();
    },

    /**
     * Focus the previous menu item
     */
    focusPrev() {
      if (this._items.length === 0) return;

      this.activeIndex = this.activeIndex > 0 ? this.activeIndex - 1 : this._items.length - 1;
      this._items[this.activeIndex]?.focus();
    },

    /**
     * Focus the first menu item
     */
    focusFirst() {
      if (this._items.length === 0) return;

      this.activeIndex = 0;
      this._items[0]?.focus();
    },

    /**
     * Focus the last menu item
     */
    focusLast() {
      if (this._items.length === 0) return;

      this.activeIndex = this._items.length - 1;
      this._items[this.activeIndex]?.focus();
    },

    /**
     * Open submenu for the currently focused item
     */
    _openSubmenu() {
      const currentItem = this._items[this.activeIndex];
      if (!currentItem) return;

      const submenu = currentItem.closest('.ux-context-menu__submenu');
      if (submenu) {
        submenu.classList.add('ux-context-menu__submenu--open');
        // Focus first item in submenu
        const submenuContent = submenu.querySelector('.ux-context-menu__submenu-content');
        const firstItem = submenuContent?.querySelector('.ux-context-menu__item:not(.ux-context-menu__item--disabled)');
        if (firstItem) {
          firstItem.focus();
          this._updateItemsList();
          this.activeIndex = this._items.indexOf(firstItem);
        }
      }
    },

    /**
     * Close the current submenu
     */
    _closeSubmenu() {
      const openSubmenu = this.$refs.menu?.querySelector('.ux-context-menu__submenu--open');
      if (openSubmenu) {
        openSubmenu.classList.remove('ux-context-menu__submenu--open');
        // Focus the submenu trigger
        const trigger = openSubmenu.querySelector(':scope > .ux-context-menu__item');
        if (trigger) {
          trigger.focus();
          this._updateItemsList();
          this.activeIndex = this._items.indexOf(trigger);
        }
      }
    },

    /**
     * Get inline styles for positioning
     */
    getStyle() {
      return {
        left: this.x + 'px',
        top: this.y + 'px'
      };
    },

    /**
     * ARIA attributes for the menu
     */
    get menuAriaAttrs() {
      return {
        'role': 'menu',
        'id': this.menuId,
        'aria-orientation': 'vertical'
      };
    },

    /**
     * ARIA attributes for menu items
     */
    getItemAriaAttrs(item, index) {
      return {
        'role': item.submenu ? 'menuitem' : 'menuitem',
        'tabindex': index === this.activeIndex ? '0' : '-1',
        'aria-disabled': item.disabled ? 'true' : 'false',
        'aria-haspopup': item.submenu ? 'menu' : undefined,
        'aria-expanded': item.submenu ? 'false' : undefined
      };
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxContextMenu', contextMenuComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxContextMenu', contextMenuComponent);
    });
  }

})();

/**
 * UX Currency Input Component
 * Formatted currency input with locale support, symbols, and precision
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Currency Input - Wrapper & Symbol
       Uses .ux-input for the actual input styling
    ======================================== */

    .ux-currency {
      position: relative;
      display: inline-flex;
      align-items: center;
      width: 100%;
    }

    /* Currency input uses .ux-input base styles with tabular nums */
    .ux-currency .ux-input {
      font-variant-numeric: tabular-nums;
      -moz-appearance: textfield;
    }

    .ux-currency .ux-input::-webkit-outer-spin-button,
    .ux-currency .ux-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* ========================================
       Symbol Positions
    ======================================== */

    .ux-currency__symbol {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      min-width: 2rem;
      color: var(--ux-text-secondary);
      font-size: var(--ux-input-font-size);
      font-weight: 500;
      pointer-events: none;
      user-select: none;
    }

    .ux-currency__symbol--prefix {
      left: 0.75rem;
    }

    .ux-currency__symbol--suffix {
      right: 0.75rem;
    }

    /* Symbol prefix - adjust input padding */
    .ux-currency--prefix .ux-input {
      padding-left: 2.5rem;
    }

    /* Symbol suffix - adjust input padding */
    .ux-currency--suffix .ux-input {
      padding-right: 2.5rem;
    }

    /* ========================================
       Size Variants
    ======================================== */

    /* Small */
    .ux-currency--sm .ux-input {
      height: var(--ux-input-height-sm);
      font-size: var(--ux-font-size-sm);
    }

    .ux-currency--sm .ux-currency__symbol {
      font-size: var(--ux-font-size-sm);
    }

    .ux-currency--sm.ux-currency--prefix .ux-input {
      padding-left: 2rem;
    }

    .ux-currency--sm.ux-currency--suffix .ux-input {
      padding-right: 2rem;
    }

    /* Large */
    .ux-currency--lg .ux-input {
      height: var(--ux-input-height-lg);
      font-size: var(--ux-font-size-lg);
    }

    .ux-currency--lg .ux-currency__symbol {
      font-size: var(--ux-font-size-lg);
    }

    .ux-currency--lg.ux-currency--prefix .ux-input {
      padding-left: 3rem;
    }

    .ux-currency--lg.ux-currency--suffix .ux-input {
      padding-right: 3rem;
    }

    /* ========================================
       Text Alignment
    ======================================== */

    .ux-currency--align-left .ux-input {
      text-align: left;
    }

    .ux-currency--align-center .ux-input {
      text-align: center;
    }

    .ux-currency--align-right .ux-input {
      text-align: right;
    }

    /* ========================================
       Display Mode (Read-only large)
    ======================================== */

    .ux-currency--display {
      font-size: 2rem;
      font-weight: 600;
    }

    .ux-currency--display .ux-input {
      height: auto;
      padding: 0;
      border: none;
      background: transparent;
      font-size: inherit;
      font-weight: inherit;
    }

    .ux-currency--display .ux-input:focus {
      box-shadow: none;
    }

    .ux-currency--display .ux-currency__symbol {
      position: static;
      font-size: 1.25rem;
      font-weight: 400;
      margin-right: 0.25rem;
    }

    .ux-currency--display.ux-currency--suffix .ux-currency__symbol {
      margin-right: 0;
      margin-left: 0.25rem;
      order: 2;
    }

    /* ========================================
       With Label (reuses ux-input-group pattern)
    ======================================== */

    .ux-currency-field {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
    }

    .ux-currency-field__label {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-currency-field__helper {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
    }

    .ux-currency-field__helper--error {
      color: var(--ux-danger);
    }

    /* ========================================
       Validation States (on wrapper)
    ======================================== */

    .ux-currency--error .ux-input {
      border-color: var(--ux-danger);
    }

    .ux-currency--error .ux-input:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-danger-rgb), 0.15);
    }

    .ux-currency--success .ux-input {
      border-color: var(--ux-success);
    }

    .ux-currency--success .ux-input:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-success-rgb), 0.15);
    }

    /* ========================================
       Glass Variant (on wrapper)
    ======================================== */

    .ux-currency--glass .ux-input {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
    }

    .ux-currency--glass .ux-input:hover {
      background: var(--ux-glass-bg);
    }

    .ux-currency--glass .ux-input:focus {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-currency-input-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-currency-input-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Currency configurations
  const currencyConfigs = {
    USD: { symbol: '$', locale: 'en-US', position: 'prefix' },
    EUR: { symbol: 'â¬', locale: 'es-ES', position: 'suffix' },
    GBP: { symbol: 'Â£', locale: 'en-GB', position: 'prefix' },
    JPY: { symbol: 'Â¥', locale: 'ja-JP', position: 'prefix', decimals: 0 },
    CNY: { symbol: 'Â¥', locale: 'zh-CN', position: 'prefix' },
    MXN: { symbol: '$', locale: 'es-MX', position: 'prefix' },
    BRL: { symbol: 'R$', locale: 'pt-BR', position: 'prefix' },
    ARS: { symbol: '$', locale: 'es-AR', position: 'prefix' },
    CLP: { symbol: '$', locale: 'es-CL', position: 'prefix', decimals: 0 },
    COP: { symbol: '$', locale: 'es-CO', position: 'prefix' },
    PEN: { symbol: 'S/', locale: 'es-PE', position: 'prefix' },
    INR: { symbol: 'â¹', locale: 'en-IN', position: 'prefix' },
    KRW: { symbol: 'â©', locale: 'ko-KR', position: 'prefix', decimals: 0 },
    CAD: { symbol: '$', locale: 'en-CA', position: 'prefix' },
    AUD: { symbol: '$', locale: 'en-AU', position: 'prefix' },
    CHF: { symbol: 'CHF', locale: 'de-CH', position: 'prefix' }
  };

  // Alpine.js component for currency input
  const currencyInputData = (options = {}) => ({
    // Configuration
    currency: options.currency || 'USD',
    symbol: options.symbol || null,
    position: options.position || null, // 'prefix', 'suffix'
    locale: options.locale || null,
    decimals: options.decimals ?? 2,
    min: options.min ?? null,
    max: options.max ?? null,
    step: options.step || 1,

    // State
    rawValue: options.value ?? 0,
    displayValue: '',
    focused: false,
    disabled: options.disabled || false,
    readonly: options.readonly || false,

    // Separators
    decimalSeparator: '.',
    thousandSeparator: ',',

    init() {
      // Get currency config
      const config = currencyConfigs[this.currency] || currencyConfigs.USD;

      // Override with options if provided
      if (!this.symbol) this.symbol = config.symbol;
      if (!this.position) this.position = config.position;
      if (!this.locale) this.locale = config.locale;
      if (this.decimals === 2 && config.decimals !== undefined) {
        this.decimals = config.decimals;
      }

      // Detect locale separators
      this.detectSeparators();

      // Format initial value
      this.updateDisplay();
    },

    // Detect separators based on locale
    detectSeparators() {
      const formatted = new Intl.NumberFormat(this.locale).format(1234.5);
      this.thousandSeparator = formatted.charAt(1);
      this.decimalSeparator = formatted.charAt(5);
    },

    // Format number for display
    formatNumber(value) {
      if (value === null || value === undefined || isNaN(value)) {
        return '';
      }

      return new Intl.NumberFormat(this.locale, {
        minimumFractionDigits: this.decimals,
        maximumFractionDigits: this.decimals
      }).format(value);
    },

    // Parse input string to number
    parseInput(str) {
      if (!str || str === '') return 0;

      // Remove all non-numeric chars except decimal separator
      let cleaned = str.replace(new RegExp(`[^0-9${this.decimalSeparator}-]`, 'g'), '');

      // Replace locale decimal separator with standard dot
      cleaned = cleaned.replace(this.decimalSeparator, '.');

      // Parse to float
      const value = parseFloat(cleaned);

      return isNaN(value) ? 0 : value;
    },

    // Update display value
    updateDisplay() {
      this.displayValue = this.formatNumber(this.rawValue);
    },

    // Handle input
    onInput(event) {
      const input = event.target;
      let cursorPos = input.selectionStart;
      const oldLength = input.value.length;

      // Parse the input
      const newValue = this.parseInput(input.value);

      // Apply min/max constraints
      this.rawValue = this.clamp(newValue);

      // Update display
      this.updateDisplay();

      // Restore cursor position
      this.$nextTick(() => {
        const newLength = this.displayValue.length;
        const diff = newLength - oldLength;
        const newPos = Math.max(0, cursorPos + diff);
        input.setSelectionRange(newPos, newPos);
      });

      this.dispatchChange();
    },

    // Handle focus
    onFocus(event) {
      this.focused = true;

      // Select all on focus
      this.$nextTick(() => {
        event.target.select();
      });
    },

    // Handle blur
    onBlur() {
      this.focused = false;

      // Ensure proper formatting on blur
      this.updateDisplay();
    },

    // Handle key down
    onKeyDown(event) {
      const key = event.key;

      // Allow navigation keys
      if (['ArrowLeft', 'ArrowRight', 'Home', 'End', 'Tab', 'Backspace', 'Delete'].includes(key)) {
        return;
      }

      // Allow Ctrl/Cmd shortcuts
      if (event.ctrlKey || event.metaKey) {
        return;
      }

      // Arrow up/down to increment/decrement
      if (key === 'ArrowUp') {
        event.preventDefault();
        this.increment();
        return;
      }

      if (key === 'ArrowDown') {
        event.preventDefault();
        this.decrement();
        return;
      }

      // Only allow numbers, decimal separator, and minus sign
      const allowedChars = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', this.decimalSeparator, '-'];

      if (!allowedChars.includes(key)) {
        event.preventDefault();
      }

      // Only one decimal separator
      if (key === this.decimalSeparator && event.target.value.includes(this.decimalSeparator)) {
        event.preventDefault();
      }

      // Minus only at beginning
      if (key === '-' && event.target.selectionStart !== 0) {
        event.preventDefault();
      }
    },

    // Clamp value to min/max
    clamp(value) {
      if (this.min !== null && value < this.min) return this.min;
      if (this.max !== null && value > this.max) return this.max;
      return value;
    },

    // Increment value
    increment() {
      this.rawValue = this.clamp(this.rawValue + this.step);
      this.updateDisplay();
      this.dispatchChange();
    },

    // Decrement value
    decrement() {
      this.rawValue = this.clamp(this.rawValue - this.step);
      this.updateDisplay();
      this.dispatchChange();
    },

    // Set value programmatically
    setValue(value) {
      this.rawValue = this.clamp(parseFloat(value) || 0);
      this.updateDisplay();
      this.dispatchChange();
    },

    // Get raw numeric value
    getValue() {
      return this.rawValue;
    },

    // Get formatted value with symbol
    getFormattedValue() {
      const formatted = this.formatNumber(this.rawValue);
      return this.position === 'prefix'
        ? `${this.symbol}${formatted}`
        : `${formatted} ${this.symbol}`;
    },

    // Clear value
    clear() {
      this.rawValue = 0;
      this.updateDisplay();
      this.dispatchChange();
    },

    // Dispatch change event
    dispatchChange() {
      this.$dispatch('currency:change', {
        value: this.rawValue,
        formatted: this.getFormattedValue(),
        display: this.displayValue
      });
    },

    // Get symbol position class
    getPositionClass() {
      return this.position === 'prefix' ? 'ux-currency--prefix' : 'ux-currency--suffix';
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxCurrencyInput', currencyInputData);
  }

})();

/**
 * UX Dashboard Grid Component
 * Responsive grid for dashboard widgets with drag-and-drop reordering
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Dashboard Grid - CSS Variables
    ======================================== */

    :root {
      --ux-dashboard-grid-gap: var(--ux-space-md);
      --ux-dashboard-grid-gap-sm: var(--ux-space-sm);
      --ux-dashboard-grid-gap-lg: var(--ux-space-lg);
      --ux-dashboard-grid-item-min-height: 200px;
      --ux-dashboard-grid-item-radius: var(--ux-radius-lg);
    }

    /* ========================================
       UX Dashboard Grid - Base
    ======================================== */

    .ux-dashboard-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--ux-dashboard-grid-gap);
      padding: var(--ux-space-md);
      font-family: var(--ux-font-family);
    }

    /* ========================================
       Column Variants
    ======================================== */

    .ux-dashboard-grid--cols-2 {
      grid-template-columns: repeat(2, 1fr);
    }

    .ux-dashboard-grid--cols-3 {
      grid-template-columns: repeat(3, 1fr);
    }

    .ux-dashboard-grid--cols-4 {
      grid-template-columns: repeat(4, 1fr);
    }

    .ux-dashboard-grid--cols-6 {
      grid-template-columns: repeat(6, 1fr);
    }

    /* ========================================
       Gap Variants
    ======================================== */

    .ux-dashboard-grid--gap-sm {
      gap: var(--ux-dashboard-grid-gap-sm);
    }

    .ux-dashboard-grid--gap-md {
      gap: var(--ux-dashboard-grid-gap);
    }

    .ux-dashboard-grid--gap-lg {
      gap: var(--ux-dashboard-grid-gap-lg);
    }

    .ux-dashboard-grid--gap-none {
      gap: 0;
    }

    /* ========================================
       Dashboard Grid Item
    ======================================== */

    .ux-dashboard-grid__item {
      position: relative;
      display: flex;
      flex-direction: column;
      min-height: var(--ux-dashboard-grid-item-min-height);
      background: var(--ux-surface);
      border-radius: var(--ux-dashboard-grid-item-radius);
      box-shadow: var(--ux-shadow-sm);
      overflow: hidden;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-dashboard-grid__item:hover {
      box-shadow: var(--ux-shadow-md);
    }

    /* ========================================
       Item Size Variants
    ======================================== */

    /* Small - 1 column */
    .ux-dashboard-grid__item--sm {
      grid-column: span 1;
    }

    /* Medium - 2 columns */
    .ux-dashboard-grid__item--md {
      grid-column: span 2;
    }

    /* Large - 3 columns */
    .ux-dashboard-grid__item--lg {
      grid-column: span 3;
    }

    /* Full - all columns */
    .ux-dashboard-grid__item--full {
      grid-column: 1 / -1;
    }

    /* Tall variants (row span) */
    .ux-dashboard-grid__item--tall {
      grid-row: span 2;
      min-height: calc(var(--ux-dashboard-grid-item-min-height) * 2 + var(--ux-dashboard-grid-gap));
    }

    .ux-dashboard-grid__item--tall-sm {
      grid-row: span 2;
      grid-column: span 1;
    }

    .ux-dashboard-grid__item--tall-md {
      grid-row: span 2;
      grid-column: span 2;
    }

    /* ========================================
       Item Structure
    ======================================== */

    .ux-dashboard-grid__item-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-dashboard-grid__item-header-start {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      min-width: 0;
    }

    .ux-dashboard-grid__item-title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-dashboard-grid__item-subtitle {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    .ux-dashboard-grid__item-icon {
      width: 24px;
      height: 24px;
      color: var(--ux-primary);
      flex-shrink: 0;
    }

    .ux-dashboard-grid__item-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-dashboard-grid__item-actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      margin-left: auto;
    }

    .ux-dashboard-grid__item-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
      background: none;
      border: none;
      border-radius: var(--ux-radius-sm);
      color: var(--ux-text-tertiary);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-dashboard-grid__item-btn:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-dashboard-grid__item-btn svg {
      width: 18px;
      height: 18px;
    }

    .ux-dashboard-grid__item-content {
      flex: 1;
      padding: var(--ux-space-md);
      overflow: auto;
    }

    .ux-dashboard-grid__item-content--centered {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ux-dashboard-grid__item-content--no-padding {
      padding: 0;
    }

    .ux-dashboard-grid__item-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm) var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      flex-shrink: 0;
    }

    /* ========================================
       Drag and Drop States
    ======================================== */

    .ux-dashboard-grid--editing .ux-dashboard-grid__item {
      cursor: grab;
    }

    .ux-dashboard-grid--editing .ux-dashboard-grid__item:active {
      cursor: grabbing;
    }

    .ux-dashboard-grid__item--dragging {
      opacity: 0.5;
      transform: scale(1.02) rotate(1deg);
      box-shadow: var(--ux-shadow-xl);
      z-index: 100;
    }

    .ux-dashboard-grid__item--drag-over {
      border: 2px dashed var(--ux-primary);
      background: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-dashboard-grid__item--ghost {
      opacity: 0.3;
      border: 2px dashed var(--ux-border-color);
    }

    /* Drag Handle */
    .ux-dashboard-grid__drag-handle {
      display: none;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      color: var(--ux-text-tertiary);
      cursor: grab;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-dashboard-grid--editing .ux-dashboard-grid__drag-handle {
      display: flex;
    }

    .ux-dashboard-grid__drag-handle:active {
      cursor: grabbing;
    }

    .ux-dashboard-grid__drag-handle svg {
      width: 18px;
      height: 18px;
    }

    /* ========================================
       Drop Zone Placeholder
    ======================================== */

    .ux-dashboard-grid__placeholder {
      background: rgba(var(--ux-primary-rgb), 0.08);
      border: 2px dashed var(--ux-primary);
      border-radius: var(--ux-dashboard-grid-item-radius);
      min-height: var(--ux-dashboard-grid-item-min-height);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--ux-primary);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
    }

    /* ========================================
       Add Item Button
    ======================================== */

    .ux-dashboard-grid__add-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
      min-height: var(--ux-dashboard-grid-item-min-height);
      background: transparent;
      border: 2px dashed var(--ux-border-color);
      border-radius: var(--ux-dashboard-grid-item-radius);
      color: var(--ux-text-secondary);
      font-size: var(--ux-font-size-sm);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-dashboard-grid__add-item:hover {
      border-color: var(--ux-primary);
      color: var(--ux-primary);
      background: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-dashboard-grid__add-item svg {
      width: 32px;
      height: 32px;
    }

    /* ========================================
       Stat Widget
    ======================================== */

    .ux-dashboard-grid__stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      height: 100%;
    }

    .ux-dashboard-grid__stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--ux-text);
      line-height: 1;
      margin-bottom: var(--ux-space-xs);
    }

    .ux-dashboard-grid__stat-label {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-dashboard-grid__stat-trend {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      margin-top: var(--ux-space-sm);
      padding: 2px var(--ux-space-sm);
      border-radius: var(--ux-radius-sm);
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
    }

    .ux-dashboard-grid__stat-trend--up {
      background: rgba(var(--ux-success-rgb, 52, 199, 89), 0.15);
      color: var(--ux-success);
    }

    .ux-dashboard-grid__stat-trend--down {
      background: rgba(var(--ux-danger-rgb, 255, 59, 48), 0.15);
      color: var(--ux-danger);
    }

    .ux-dashboard-grid__stat-trend svg {
      width: 12px;
      height: 12px;
    }

    /* ========================================
       Style Variants
    ======================================== */

    /* Outline */
    .ux-dashboard-grid__item--outline {
      box-shadow: none;
      border: 1px solid var(--ux-border-color);
    }

    .ux-dashboard-grid__item--outline:hover {
      box-shadow: none;
      border-color: var(--ux-primary);
    }

    /* Flat */
    .ux-dashboard-grid__item--flat {
      box-shadow: none;
      border-radius: 0;
    }

    /* Elevated */
    .ux-dashboard-grid__item--elevated {
      box-shadow: var(--ux-shadow-lg);
    }

    .ux-dashboard-grid__item--elevated:hover {
      box-shadow: var(--ux-shadow-xl);
      transform: translateY(-2px);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-dashboard-grid--glass .ux-dashboard-grid__item,
    .ux-dashboard-grid__item--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
    }

    .ux-dashboard-grid--glass .ux-dashboard-grid__item:hover,
    .ux-dashboard-grid__item--glass:hover {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight), 0 12px 40px rgba(0, 0, 0, 0.12);
    }

    .ux-dashboard-grid--glass .ux-dashboard-grid__item-header,
    .ux-dashboard-grid__item--glass .ux-dashboard-grid__item-header {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-dashboard-grid--glass .ux-dashboard-grid__item-footer,
    .ux-dashboard-grid__item--glass .ux-dashboard-grid__item-footer {
      border-top-color: var(--ux-glass-border);
    }

    .ux-dashboard-grid--glass .ux-dashboard-grid__add-item,
    .ux-dashboard-grid--glass .ux-dashboard-grid__placeholder {
      border-color: var(--ux-glass-border);
      background: var(--ux-glass-bg-thin);
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-dashboard-grid__item--primary {
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-dashboard-grid__item--primary .ux-dashboard-grid__item-title,
    .ux-dashboard-grid__item--primary .ux-dashboard-grid__stat-value {
      color: var(--ux-primary-contrast);
    }

    .ux-dashboard-grid__item--primary .ux-dashboard-grid__item-subtitle,
    .ux-dashboard-grid__item--primary .ux-dashboard-grid__stat-label,
    .ux-dashboard-grid__item--primary .ux-dashboard-grid__item-btn {
      color: rgba(255, 255, 255, 0.8);
    }

    .ux-dashboard-grid__item--success {
      background: var(--ux-success);
      color: var(--ux-success-contrast);
    }

    .ux-dashboard-grid__item--success .ux-dashboard-grid__item-title,
    .ux-dashboard-grid__item--success .ux-dashboard-grid__stat-value {
      color: var(--ux-success-contrast);
    }

    .ux-dashboard-grid__item--warning {
      background: var(--ux-warning);
      color: var(--ux-warning-contrast);
    }

    .ux-dashboard-grid__item--warning .ux-dashboard-grid__item-title,
    .ux-dashboard-grid__item--warning .ux-dashboard-grid__stat-value {
      color: var(--ux-warning-contrast);
    }

    .ux-dashboard-grid__item--danger {
      background: var(--ux-danger);
      color: var(--ux-danger-contrast);
    }

    .ux-dashboard-grid__item--danger .ux-dashboard-grid__item-title,
    .ux-dashboard-grid__item--danger .ux-dashboard-grid__stat-value {
      color: var(--ux-danger-contrast);
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-dashboard-grid__item--loading {
      pointer-events: none;
    }

    .ux-dashboard-grid__item--loading::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light):not(.ux-theme-light) {
        .ux-dashboard-grid__item {
          background: var(--ux-surface);
        }

        .ux-dashboard-grid__item--loading::after {
          background: rgba(0, 0, 0, 0.5);
        }
      }
    }

    .ux-dark .ux-dashboard-grid__item,
    .ux-theme-dark .ux-dashboard-grid__item {
      background: var(--ux-surface);
    }

    .ux-dark .ux-dashboard-grid__item--loading::after,
    .ux-theme-dark .ux-dashboard-grid__item--loading::after {
      background: rgba(0, 0, 0, 0.5);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 1199px) {
      .ux-dashboard-grid {
        grid-template-columns: repeat(3, 1fr);
      }

      .ux-dashboard-grid--cols-4 {
        grid-template-columns: repeat(3, 1fr);
      }

      .ux-dashboard-grid--cols-6 {
        grid-template-columns: repeat(4, 1fr);
      }

      .ux-dashboard-grid__item--lg {
        grid-column: span 2;
      }
    }

    @media (max-width: 991px) {
      .ux-dashboard-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .ux-dashboard-grid--cols-3,
      .ux-dashboard-grid--cols-4 {
        grid-template-columns: repeat(2, 1fr);
      }

      .ux-dashboard-grid--cols-6 {
        grid-template-columns: repeat(3, 1fr);
      }

      .ux-dashboard-grid__item--lg {
        grid-column: span 2;
      }

      .ux-dashboard-grid__item--md {
        grid-column: span 2;
      }
    }

    @media (max-width: 767px) {
      .ux-dashboard-grid,
      .ux-dashboard-grid--cols-2,
      .ux-dashboard-grid--cols-3,
      .ux-dashboard-grid--cols-4,
      .ux-dashboard-grid--cols-6 {
        grid-template-columns: 1fr;
        padding: var(--ux-space-sm);
      }

      .ux-dashboard-grid__item--sm,
      .ux-dashboard-grid__item--md,
      .ux-dashboard-grid__item--lg,
      .ux-dashboard-grid__item--full {
        grid-column: span 1;
      }

      .ux-dashboard-grid__item--tall,
      .ux-dashboard-grid__item--tall-sm,
      .ux-dashboard-grid__item--tall-md {
        grid-row: span 1;
        min-height: var(--ux-dashboard-grid-item-min-height);
      }

      .ux-dashboard-grid__stat-value {
        font-size: 2rem;
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-dashboard-grid__item {
        transition: none;
      }

      .ux-dashboard-grid__item--dragging {
        transform: none;
      }

      .ux-dashboard-grid__item--elevated:hover {
        transform: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-dashboard-grid-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-dashboard-grid-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for Dashboard Grid
  const dashboardGridData = (options = {}) => ({
    items: options.items || [],
    editing: options.editing ?? false,
    columns: options.columns || 4,
    gap: options.gap || 'md',
    draggingIndex: null,
    dragOverIndex: null,
    startX: 0,
    startY: 0,
    currentX: 0,
    currentY: 0,

    // Initialize
    init() {
      // Ensure items have IDs
      this.items = this.items.map((item, index) => ({
        ...item,
        id: item.id || 'item-' + index + '-' + Date.now()
      }));
    },

    // Get item by ID
    getItem(id) {
      return this.items.find(item => item.id === id);
    },

    // Get item index by ID
    getItemIndex(id) {
      return this.items.findIndex(item => item.id === id);
    },

    // Toggle edit mode
    toggleEdit() {
      this.editing = !this.editing;
      this.$dispatch('dashboard:editchange', { editing: this.editing });
    },

    // Start editing
    startEdit() {
      this.editing = true;
      this.$dispatch('dashboard:editchange', { editing: true });
    },

    // End editing
    endEdit() {
      this.editing = false;
      this.draggingIndex = null;
      this.dragOverIndex = null;
      this.$dispatch('dashboard:editchange', { editing: false });
    },

    // Add item
    addItem(itemData = {}) {
      const newItem = {
        id: itemData.id || 'item-' + Date.now(),
        title: itemData.title || 'New Widget',
        size: itemData.size || 'sm',
        ...itemData
      };

      this.items.push(newItem);
      this.$dispatch('dashboard:add', { item: newItem });
      return newItem;
    },

    // Remove item
    removeItem(id) {
      const index = this.getItemIndex(id);
      if (index > -1) {
        const item = this.items[index];
        this.items.splice(index, 1);
        this.$dispatch('dashboard:remove', { item, index });
      }
    },

    // Update item
    updateItem(id, updates) {
      const item = this.getItem(id);
      if (item) {
        Object.assign(item, updates);
        this.$dispatch('dashboard:update', { item, updates });
      }
    },

    // Move item
    moveItem(fromIndex, toIndex) {
      if (fromIndex === toIndex || fromIndex < 0 || toIndex < 0) return;
      if (fromIndex >= this.items.length || toIndex >= this.items.length) return;

      const item = this.items.splice(fromIndex, 1)[0];
      this.items.splice(toIndex, 0, item);

      this.$dispatch('dashboard:move', {
        item,
        fromIndex,
        toIndex
      });
    },

    // Resize item
    resizeItem(id, size) {
      const item = this.getItem(id);
      if (item) {
        const oldSize = item.size;
        item.size = size;
        this.$dispatch('dashboard:resize', { item, oldSize, newSize: size });
      }
    },

    // Drag start handler
    onDragStart(index, event) {
      if (!this.editing) return;

      this.draggingIndex = index;
      this.startX = event.type === 'touchstart' ? event.touches[0].clientX : event.clientX;
      this.startY = event.type === 'touchstart' ? event.touches[0].clientY : event.clientY;

      if (event.dataTransfer) {
        event.dataTransfer.effectAllowed = 'move';
        event.dataTransfer.setData('text/plain', index.toString());
      }

      this.$dispatch('dashboard:dragstart', { index, item: this.items[index] });
    },

    // Drag over handler
    onDragOver(index, event) {
      if (this.draggingIndex === null || this.draggingIndex === index) return;

      event.preventDefault();
      if (event.dataTransfer) {
        event.dataTransfer.dropEffect = 'move';
      }

      this.dragOverIndex = index;
    },

    // Drag end handler
    onDragEnd(event) {
      if (this.draggingIndex !== null && this.dragOverIndex !== null) {
        this.moveItem(this.draggingIndex, this.dragOverIndex);
      }

      this.draggingIndex = null;
      this.dragOverIndex = null;
      this.$dispatch('dashboard:dragend');
    },

    // Drop handler
    onDrop(index, event) {
      event.preventDefault();

      if (this.draggingIndex !== null && this.draggingIndex !== index) {
        this.moveItem(this.draggingIndex, index);
      }

      this.draggingIndex = null;
      this.dragOverIndex = null;
    },

    // Touch handlers
    onTouchStart(index, event) {
      if (!this.editing) return;
      this.onDragStart(index, event);
    },

    onTouchMove(index, event) {
      if (this.draggingIndex === null) return;

      event.preventDefault();
      this.currentX = event.touches[0].clientX;
      this.currentY = event.touches[0].clientY;

      // Find element under touch point
      const elementBelow = document.elementFromPoint(this.currentX, this.currentY);
      if (elementBelow) {
        const gridItem = elementBelow.closest('.ux-dashboard-grid__item');
        if (gridItem && gridItem !== event.currentTarget) {
          const items = Array.from(this.$el.querySelectorAll('.ux-dashboard-grid__item'));
          const overIndex = items.indexOf(gridItem);
          if (overIndex > -1) {
            this.dragOverIndex = overIndex;
          }
        }
      }
    },

    onTouchEnd(event) {
      this.onDragEnd(event);
    },

    // Check if item is being dragged
    isDragging(index) {
      return this.draggingIndex === index;
    },

    // Check if item is being dragged over
    isDragOver(index) {
      return this.dragOverIndex === index && this.draggingIndex !== index;
    },

    // Get grid class based on columns setting
    getGridClass() {
      return `ux-dashboard-grid--cols-${this.columns}`;
    },

    // Get gap class
    getGapClass() {
      return `ux-dashboard-grid--gap-${this.gap}`;
    },

    // Get item size class
    getItemSizeClass(size) {
      return size ? `ux-dashboard-grid__item--${size}` : '';
    },

    // Serialize items for saving
    serialize() {
      return this.items.map(item => ({
        id: item.id,
        size: item.size,
        position: this.getItemIndex(item.id)
      }));
    },

    // Restore items from serialized data
    restore(savedItems) {
      if (!Array.isArray(savedItems)) return;

      const sortedItems = [];
      savedItems.forEach(saved => {
        const item = this.getItem(saved.id);
        if (item) {
          if (saved.size) item.size = saved.size;
          sortedItems.push(item);
        }
      });

      // Add any items not in saved data
      this.items.forEach(item => {
        if (!sortedItems.find(s => s.id === item.id)) {
          sortedItems.push(item);
        }
      });

      this.items = sortedItems;
      this.$dispatch('dashboard:restore', { items: this.items });
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxDashboardGrid', dashboardGridData);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxDashboardGrid', dashboardGridData);
    });
  }
})();

/**
 * UX DataTable Component
 * Responsive data table with standard and "no more tables" mobile views
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX DataTable Container
    ======================================== */

    .ux-datatable {
      display: flex;
      flex-direction: column;
      width: 100%;
      background-color: var(--ux-surface);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
    }

    .ux-datatable--inset {
      margin: var(--ux-space-lg);
    }

    .ux-datatable--bordered {
      border: 1px solid var(--ux-border-color);
    }

    /* ========================================
       DataTable Header (Title & Actions)
    ======================================== */

    .ux-datatable__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-datatable__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-datatable__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: 2px;
    }

    .ux-datatable__actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    /* ========================================
       DataTable Toolbar (Filters & Search)
    ======================================== */

    .ux-datatable__toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      padding: var(--ux-space-sm) var(--ux-space-lg);
      background-color: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
      flex-wrap: wrap;
    }

    .ux-datatable__toolbar-start {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-datatable__toolbar-end {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-datatable__search {
      min-width: 200px;
    }

    @media (max-width: 767px) {
      .ux-datatable__toolbar {
        flex-direction: column;
        align-items: stretch;
      }

      .ux-datatable__search {
        width: 100%;
      }
    }

    /* ========================================
       Bulk Actions Toolbar
    ======================================== */

    .ux-datatable__bulk-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      padding: var(--ux-space-sm) var(--ux-space-lg);
      background: linear-gradient(135deg, rgba(var(--ux-primary-rgb), 0.1), rgba(var(--ux-primary-rgb), 0.05));
      border-bottom: 1px solid rgba(var(--ux-primary-rgb), 0.2);
      flex-shrink: 0;
      animation: ux-datatable-bulk-slide-in 200ms var(--ux-ease);
    }

    @keyframes ux-datatable-bulk-slide-in {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .ux-datatable__bulk-info {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-primary);
    }

    .ux-datatable__bulk-count {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 24px;
      padding: 0 var(--ux-space-xs);
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-radius: 12px;
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
    }

    .ux-datatable__bulk-actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-datatable__bulk-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__bulk-btn:hover {
      background: var(--ux-surface-secondary);
      border-color: var(--ux-primary);
    }

    .ux-datatable__bulk-btn--danger:hover {
      background: rgba(var(--ux-danger-rgb, 255, 59, 48), 0.1);
      border-color: var(--ux-danger);
      color: var(--ux-danger);
    }

    .ux-datatable__bulk-btn svg {
      width: 16px;
      height: 16px;
    }

    .ux-datatable__bulk-clear {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      padding: 0;
      background: none;
      border: none;
      border-radius: var(--ux-border-radius);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__bulk-clear:hover {
      background: var(--ux-surface);
      color: var(--ux-text);
    }

    .ux-datatable__bulk-clear svg {
      width: 18px;
      height: 18px;
    }

    @media (max-width: 767px) {
      .ux-datatable__bulk-toolbar {
        flex-direction: column;
        align-items: stretch;
        gap: var(--ux-space-sm);
      }

      .ux-datatable__bulk-actions {
        justify-content: flex-end;
      }
    }

    /* ========================================
       Column Filters Row
    ======================================== */

    .ux-datatable__filters {
      display: table-row;
      background-color: var(--ux-surface-secondary);
    }

    .ux-datatable__filter-cell {
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-bottom: 1px solid var(--ux-border-color);
      vertical-align: middle;
    }

    .ux-datatable__filter-input {
      width: 100%;
      min-width: 80px;
      max-width: 200px;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-sm);
      background-color: var(--ux-surface);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      transition: border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__filter-input:focus {
      outline: none;
      border-color: var(--ux-primary);
    }

    .ux-datatable__filter-input::placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-datatable__filter-select {
      width: 100%;
      min-width: 80px;
      max-width: 200px;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      padding-right: calc(var(--ux-space-sm) + 16px);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-sm);
      background-color: var(--ux-surface);
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280' stroke-width='2'%3e%3cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right var(--ux-space-xs) center;
      background-size: 16px;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      transition: border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__filter-select:focus {
      outline: none;
      border-color: var(--ux-primary);
    }

    .ux-datatable__filter-date {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-datatable__filter-date input {
      flex: 1;
      min-width: 100px;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-sm);
      background-color: var(--ux-surface);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
    }

    .ux-datatable__filter-date input:focus {
      outline: none;
      border-color: var(--ux-primary);
    }

    .ux-datatable__filter-clear {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      padding: 0;
      background: none;
      border: none;
      border-radius: var(--ux-border-radius-sm);
      color: var(--ux-text-tertiary);
      cursor: pointer;
      opacity: 0;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__filter-cell:hover .ux-datatable__filter-clear,
    .ux-datatable__filter-clear:focus {
      opacity: 1;
    }

    .ux-datatable__filter-clear:hover {
      background: var(--ux-surface-tertiary);
      color: var(--ux-text);
    }

    .ux-datatable__filter-clear svg {
      width: 14px;
      height: 14px;
    }

    .ux-datatable__filter-wrapper {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    /* Active filters indicator */
    .ux-datatable__active-filters {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-lg);
      background-color: var(--ux-surface-tertiary);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-datatable__filter-tag {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: 2px var(--ux-space-sm);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: 999px;
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text);
    }

    .ux-datatable__filter-tag-label {
      color: var(--ux-text-secondary);
    }

    .ux-datatable__filter-tag-remove {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      padding: 0;
      margin-left: 2px;
      background: none;
      border: none;
      border-radius: 50%;
      color: var(--ux-text-tertiary);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__filter-tag-remove:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-datatable__filter-tag-remove svg {
      width: 12px;
      height: 12px;
    }

    .ux-datatable__clear-filters {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: 2px var(--ux-space-sm);
      background: none;
      border: none;
      border-radius: var(--ux-border-radius-sm);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-primary);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__clear-filters:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    /* Hide filters on mobile responsive view */
    @media (max-width: 767px) {
      .ux-datatable--responsive .ux-datatable__filters {
        display: none;
      }
    }

    .ux-datatable--force-responsive .ux-datatable__filters {
      display: none;
    }

    /* ========================================
       DataTable Body (Scrollable Content)
    ======================================== */

    .ux-datatable__body {
      flex: 1;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }

    .ux-datatable__body--fixed-height {
      max-height: 400px;
    }

    /* ========================================
       Standard Table View
    ======================================== */

    .ux-datatable__table {
      width: 100%;
      border-collapse: collapse;
      table-layout: auto;
    }

    .ux-datatable__table--fixed {
      table-layout: fixed;
    }

    /* Table Head */
    .ux-datatable__thead {
      position: sticky;
      top: 0;
      z-index: 10;
      background-color: var(--ux-surface-secondary);
    }

    .ux-datatable__th {
      padding: var(--ux-space-md) var(--ux-space-lg);
      text-align: left;
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
      border-bottom: 2px solid var(--ux-border-color);
      background-color: var(--ux-surface-secondary);
    }

    .ux-datatable__th--sortable {
      cursor: pointer;
      user-select: none;
      transition: color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__th--sortable:hover {
      color: var(--ux-primary);
    }

    .ux-datatable__th--sorted {
      color: var(--ux-primary);
    }

    .ux-datatable__sort-icon {
      display: inline-flex;
      margin-left: var(--ux-space-xs);
      opacity: 0.5;
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__th--sorted .ux-datatable__sort-icon {
      opacity: 1;
    }

    .ux-datatable__th--sorted-desc .ux-datatable__sort-icon {
      transform: rotate(180deg);
    }

    /* Alignment */
    .ux-datatable__th--center,
    .ux-datatable__td--center {
      text-align: center;
    }

    .ux-datatable__th--right,
    .ux-datatable__td--right {
      text-align: right;
    }

    /* Table Body */
    .ux-datatable__tbody {
      background-color: var(--ux-surface);
    }

    .ux-datatable__tr {
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__tr:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-datatable__tr--selected {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-datatable__tr--clickable {
      cursor: pointer;
    }

    .ux-datatable__td {
      padding: var(--ux-space-md) var(--ux-space-lg);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      border-bottom: 1px solid var(--ux-border-color);
      vertical-align: middle;
    }

    .ux-datatable__tr:last-child .ux-datatable__td {
      border-bottom: none;
    }

    /* Cell content truncation */
    .ux-datatable__td--truncate {
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Cell with badge/chip */
    .ux-datatable__td .ux-badge,
    .ux-datatable__td .ux-chip {
      vertical-align: middle;
    }

    /* ========================================
       Checkbox Column
    ======================================== */

    .ux-datatable__th--checkbox,
    .ux-datatable__td--checkbox {
      width: 48px;
      padding-left: var(--ux-space-md);
      padding-right: var(--ux-space-sm);
    }

    /* ========================================
       Actions Column
    ======================================== */

    .ux-datatable__th--actions,
    .ux-datatable__td--actions {
      width: 80px;
      text-align: center;
    }

    .ux-datatable__row-actions {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xs);
    }

    .ux-datatable__row-action {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
      background: none;
      border: none;
      border-radius: var(--ux-border-radius);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__row-action:hover {
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-datatable__row-action--danger:hover {
      background-color: rgba(var(--ux-danger-rgb, 255, 59, 48), 0.1);
      color: var(--ux-danger);
    }

    .ux-datatable__row-action svg {
      width: 18px;
      height: 18px;
    }

    /* ========================================
       Empty State
    ======================================== */

    .ux-datatable__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-2xl) var(--ux-space-lg);
      text-align: center;
    }

    .ux-datatable__empty-icon {
      width: 64px;
      height: 64px;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-text-tertiary);
    }

    .ux-datatable__empty-title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
    }

    .ux-datatable__empty-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-datatable__loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-2xl);
    }

    .ux-datatable--loading .ux-datatable__tbody {
      opacity: 0.5;
      pointer-events: none;
    }

    /* ========================================
       DataTable Footer (Pagination)
    ======================================== */

    .ux-datatable__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface);
      border-top: 1px solid var(--ux-border-color);
      flex-shrink: 0;
      flex-wrap: wrap;
      gap: var(--ux-space-md);
    }

    .ux-datatable__info {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-datatable__pagination {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-datatable__page-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      height: 36px;
      padding: 0 var(--ux-space-sm);
      background: none;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__page-btn:hover:not(:disabled) {
      background-color: var(--ux-surface-secondary);
      border-color: var(--ux-primary);
    }

    .ux-datatable__page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-datatable__page-btn--active {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-datatable__page-btn--active:hover:not(:disabled) {
      background-color: var(--ux-primary-shade);
      border-color: var(--ux-primary-shade);
    }

    .ux-datatable__page-btn svg {
      width: 16px;
      height: 16px;
    }

    .ux-datatable__per-page {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-datatable__per-page select {
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      background-color: var(--ux-surface);
      color: var(--ux-text);
      font-size: var(--ux-font-size-sm);
    }

    @media (max-width: 767px) {
      .ux-datatable__footer {
        flex-direction: column;
        align-items: center;
      }
    }

    /* ========================================
       View Toggle Buttons
    ======================================== */

    .ux-datatable__view-toggle {
      display: inline-flex;
      align-items: center;
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
      padding: 2px;
      gap: 2px;
    }

    .ux-datatable__view-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
      background: none;
      border: none;
      border-radius: calc(var(--ux-border-radius) - 2px);
      color: var(--ux-text-tertiary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__view-btn:hover {
      color: var(--ux-text);
    }

    .ux-datatable__view-btn--active {
      background-color: var(--ux-surface);
      color: var(--ux-primary);
      box-shadow: var(--ux-shadow-sm);
    }

    .ux-datatable__view-btn svg {
      width: 18px;
      height: 18px;
    }

    /* ========================================
       Responsive "No More Tables" View
    ======================================== */

    @media (max-width: 767px) {
      .ux-datatable--responsive .ux-datatable__table,
      .ux-datatable--responsive .ux-datatable__thead,
      .ux-datatable--responsive .ux-datatable__tbody,
      .ux-datatable--responsive .ux-datatable__th,
      .ux-datatable--responsive .ux-datatable__tr,
      .ux-datatable--responsive .ux-datatable__td {
        display: block;
      }

      .ux-datatable--responsive .ux-datatable__thead {
        position: absolute;
        top: -9999px;
        left: -9999px;
        visibility: hidden;
      }

      .ux-datatable--responsive .ux-datatable__tr {
        margin-bottom: var(--ux-space-md);
        background-color: var(--ux-surface);
        border-radius: var(--ux-border-radius-lg);
        border: 1px solid var(--ux-border-color);
        overflow: hidden;
      }

      .ux-datatable--responsive .ux-datatable__tr:last-child {
        margin-bottom: 0;
      }

      .ux-datatable--responsive .ux-datatable__td {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--ux-space-md) var(--ux-space-lg);
        text-align: right;
        border-bottom: 1px solid var(--ux-border-color);
      }

      .ux-datatable--responsive .ux-datatable__tr .ux-datatable__td:last-child {
        border-bottom: none;
      }

      .ux-datatable--responsive .ux-datatable__td::before {
        content: attr(data-label);
        flex: 1;
        font-weight: 600;
        font-size: var(--ux-font-size-sm);
        color: var(--ux-text-secondary);
        text-align: left;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding-right: var(--ux-space-md);
      }

      .ux-datatable--responsive .ux-datatable__td--checkbox,
      .ux-datatable--responsive .ux-datatable__td--actions {
        justify-content: flex-end;
      }

      .ux-datatable--responsive .ux-datatable__td--checkbox::before,
      .ux-datatable--responsive .ux-datatable__td--actions::before {
        content: none;
      }

      /* Card header style for first cell */
      .ux-datatable--responsive .ux-datatable__td--primary {
        background-color: var(--ux-surface-secondary);
        font-weight: 600;
      }

      .ux-datatable--responsive .ux-datatable__td--primary::before {
        display: none;
      }

      .ux-datatable--responsive .ux-datatable__td--primary {
        justify-content: flex-start;
        text-align: left;
      }
    }

    /* Force responsive view */
    .ux-datatable--force-responsive .ux-datatable__table,
    .ux-datatable--force-responsive .ux-datatable__thead,
    .ux-datatable--force-responsive .ux-datatable__tbody,
    .ux-datatable--force-responsive .ux-datatable__th,
    .ux-datatable--force-responsive .ux-datatable__tr,
    .ux-datatable--force-responsive .ux-datatable__td {
      display: block;
    }

    .ux-datatable--force-responsive .ux-datatable__thead {
      position: absolute;
      top: -9999px;
      left: -9999px;
      visibility: hidden;
    }

    .ux-datatable--force-responsive .ux-datatable__tr {
      margin-bottom: var(--ux-space-md);
      background-color: var(--ux-surface);
      border-radius: var(--ux-border-radius-lg);
      border: 1px solid var(--ux-border-color);
      overflow: hidden;
    }

    .ux-datatable--force-responsive .ux-datatable__td {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md) var(--ux-space-lg);
      text-align: right;
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-datatable--force-responsive .ux-datatable__tr .ux-datatable__td:last-child {
      border-bottom: none;
    }

    .ux-datatable--force-responsive .ux-datatable__td::before {
      content: attr(data-label);
      flex: 1;
      font-weight: 600;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      text-align: left;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding-right: var(--ux-space-md);
    }

    /* ========================================
       Striped Rows
    ======================================== */

    .ux-datatable--striped .ux-datatable__tr:nth-child(even) {
      background-color: var(--ux-surface-secondary);
    }

    /* ========================================
       Compact Size
    ======================================== */

    .ux-datatable--compact .ux-datatable__th,
    .ux-datatable--compact .ux-datatable__td {
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
    }

    /* ========================================
       DataTable Sizes
    ======================================== */

    .ux-datatable--sm .ux-datatable__th,
    .ux-datatable--sm .ux-datatable__td {
      padding: var(--ux-space-xs) var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
    }

    .ux-datatable--lg .ux-datatable__th,
    .ux-datatable--lg .ux-datatable__td {
      padding: var(--ux-space-lg) var(--ux-space-xl);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-datatable--glass {
      border: 0.5px solid var(--ux-glass-border);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
    }

    .ux-datatable--glass .ux-datatable__th {
      background: var(--ux-glass-bg-thin);
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-datatable--glass .ux-datatable__td {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-datatable--glass .ux-datatable__tr:hover .ux-datatable__td {
      background: var(--ux-glass-bg-thin);
    }

    .ux-datatable--glass .ux-datatable__tr--selected .ux-datatable__td {
      background: var(--ux-glass-bg);
    }

    .ux-datatable--glass .ux-datatable__footer {
      background: var(--ux-glass-bg-thin);
      border-top-color: var(--ux-glass-border);
    }

    /* ========================================
       Expandable Rows
    ======================================== */

    .ux-datatable__th--expand,
    .ux-datatable__td--expand {
      width: 48px;
      padding-left: var(--ux-space-md);
      padding-right: var(--ux-space-sm);
    }

    .ux-datatable__expand-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
      background: none;
      border: none;
      border-radius: var(--ux-border-radius);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__expand-btn:hover {
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-datatable__expand-btn--expanded {
      transform: rotate(90deg);
      color: var(--ux-primary);
    }

    .ux-datatable__expand-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Expanded row content */
    .ux-datatable__tr--expandable {
      cursor: pointer;
    }

    .ux-datatable__tr--expanded {
      background-color: rgba(var(--ux-primary-rgb), 0.03);
    }

    .ux-datatable__tr--expanded:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.06);
    }

    .ux-datatable__expand-row {
      background-color: var(--ux-surface-secondary);
    }

    .ux-datatable__expand-row > td {
      padding: 0;
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-datatable__expand-content {
      display: grid;
      grid-template-rows: 0fr;
      transition: grid-template-rows var(--ux-transition-normal) var(--ux-ease);
    }

    .ux-datatable__expand-content--open {
      grid-template-rows: 1fr;
    }

    .ux-datatable__expand-inner {
      overflow: hidden;
    }

    .ux-datatable__expand-body {
      padding: var(--ux-space-lg);
      border-left: 3px solid var(--ux-primary);
      margin-left: var(--ux-space-md);
    }

    /* Expand all button in header */
    .ux-datatable__expand-all-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      padding: 0;
      background: none;
      border: none;
      border-radius: var(--ux-border-radius-sm);
      color: var(--ux-text-tertiary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__expand-all-btn:hover {
      background-color: var(--ux-surface);
      color: var(--ux-text);
    }

    .ux-datatable__expand-all-btn--expanded {
      color: var(--ux-primary);
    }

    .ux-datatable__expand-all-btn svg {
      width: 16px;
      height: 16px;
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__expand-all-btn--expanded svg {
      transform: rotate(90deg);
    }

    /* Nested datatable in expanded content */
    .ux-datatable__expand-body .ux-datatable {
      margin: 0;
      border-radius: var(--ux-border-radius);
    }

    /* Detail list in expanded content */
    .ux-datatable__detail-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: var(--ux-space-md);
    }

    .ux-datatable__detail-item {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ux-datatable__detail-label {
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-datatable__detail-value {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
    }

    /* Expand animation for mobile responsive view */
    @media (max-width: 767px) {
      .ux-datatable--responsive .ux-datatable__td--expand {
        display: none;
      }

      .ux-datatable--responsive .ux-datatable__expand-row {
        display: block;
        margin-top: -1px;
        margin-bottom: var(--ux-space-md);
        border-radius: 0 0 var(--ux-border-radius-lg) var(--ux-border-radius-lg);
        border: 1px solid var(--ux-border-color);
        border-top: none;
      }

      .ux-datatable--responsive .ux-datatable__tr--expanded {
        border-radius: var(--ux-border-radius-lg) var(--ux-border-radius-lg) 0 0;
        margin-bottom: 0;
      }

      .ux-datatable--responsive .ux-datatable__expand-body {
        margin-left: 0;
        border-left: none;
        border-top: 3px solid var(--ux-primary);
      }
    }

    .ux-datatable--force-responsive .ux-datatable__td--expand {
      display: none;
    }

    .ux-datatable--force-responsive .ux-datatable__expand-row {
      display: block;
      margin-top: -1px;
      margin-bottom: var(--ux-space-md);
      border-radius: 0 0 var(--ux-border-radius-lg) var(--ux-border-radius-lg);
      border: 1px solid var(--ux-border-color);
      border-top: none;
    }

    /* Glass variant for expanded content */
    .ux-datatable--glass .ux-datatable__expand-row {
      background: var(--ux-glass-bg-thin);
    }

    .ux-datatable--glass .ux-datatable__expand-body {
      border-left-color: var(--ux-primary);
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
      .ux-datatable__expand-row {
        background-color: var(--ux-surface-tertiary);
      }

      .ux-datatable__tr--expanded {
        background-color: rgba(var(--ux-primary-rgb), 0.08);
      }
    }

    .ux-dark .ux-datatable__expand-row {
      background-color: var(--ux-surface-tertiary);
    }

    .ux-dark .ux-datatable__tr--expanded {
      background-color: rgba(var(--ux-primary-rgb), 0.08);
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .ux-datatable__expand-btn,
      .ux-datatable__expand-all-btn svg,
      .ux-datatable__expand-content {
        transition: none;
      }
    }

    /* ========================================
       Export Button & Menu
    ======================================== */

    .ux-datatable__export {
      position: relative;
      display: inline-flex;
    }

    .ux-datatable__export-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__export-btn:hover {
      background: var(--ux-surface-secondary);
      border-color: var(--ux-primary);
    }

    .ux-datatable__export-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-datatable__export-btn svg {
      width: 16px;
      height: 16px;
    }

    .ux-datatable__export-menu {
      position: absolute;
      top: 100%;
      right: 0;
      z-index: var(--ux-z-dropdown, 100);
      min-width: 180px;
      margin-top: var(--ux-space-xs);
      padding: var(--ux-space-xs);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      box-shadow: var(--ux-shadow-lg);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__export-menu--open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-datatable__export-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      width: 100%;
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: none;
      border: none;
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      text-align: left;
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__export-item:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-datatable__export-item svg {
      width: 18px;
      height: 18px;
      color: var(--ux-text-secondary);
    }

    .ux-datatable__export-item-text {
      flex: 1;
    }

    .ux-datatable__export-item-desc {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-datatable__export-divider {
      height: 1px;
      margin: var(--ux-space-xs) 0;
      background: var(--ux-border-color);
    }

    .ux-datatable__export-option {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-xs) var(--ux-space-md);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
    }

    .ux-datatable__export-option input[type="checkbox"] {
      margin: 0;
    }

    /* Glass variant for export menu */
    .ux-datatable--glass .ux-datatable__export-menu {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
      .ux-datatable__export-menu {
        background: var(--ux-surface);
        border-color: var(--ux-border-color);
      }
    }

    .ux-dark .ux-datatable__export-menu {
      background: var(--ux-surface);
      border-color: var(--ux-border-color);
    }

    /* ========================================
       Column Resize
    ======================================== */

    .ux-datatable--resizable .ux-datatable__th {
      position: relative;
      user-select: none;
    }

    .ux-datatable__resize-handle {
      position: absolute;
      top: 0;
      right: 0;
      width: 8px;
      height: 100%;
      cursor: col-resize;
      background: transparent;
      z-index: 1;
      touch-action: none;
    }

    .ux-datatable__resize-handle::after {
      content: '';
      position: absolute;
      top: 25%;
      right: 3px;
      width: 2px;
      height: 50%;
      background: transparent;
      border-radius: 1px;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__resize-handle:hover::after,
    .ux-datatable__resize-handle--active::after {
      background: var(--ux-primary);
    }

    .ux-datatable--resizing {
      cursor: col-resize;
      user-select: none;
    }

    .ux-datatable--resizing .ux-datatable__th,
    .ux-datatable--resizing .ux-datatable__td {
      user-select: none;
    }

    .ux-datatable--resizable .ux-datatable__table {
      table-layout: fixed;
    }

    .ux-datatable__th--resizing {
      background-color: rgba(var(--ux-primary-rgb), 0.05);
    }

    /* Minimum column width indicator */
    .ux-datatable__th--min-width {
      background-color: rgba(var(--ux-warning-rgb, 245, 158, 11), 0.1);
    }

    /* ========================================
       Column Visibility Menu
    ======================================== */

    .ux-datatable__column-toggle {
      position: relative;
      display: inline-flex;
    }

    .ux-datatable__column-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__column-btn:hover {
      background: var(--ux-surface-secondary);
      border-color: var(--ux-primary);
    }

    .ux-datatable__column-btn svg {
      width: 16px;
      height: 16px;
    }

    .ux-datatable__column-btn-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 18px;
      height: 18px;
      padding: 0 4px;
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-radius: 9px;
      font-size: 11px;
      font-weight: 600;
      margin-left: var(--ux-space-xs);
    }

    .ux-datatable__column-menu {
      position: absolute;
      top: 100%;
      right: 0;
      z-index: var(--ux-z-dropdown, 100);
      min-width: 220px;
      max-height: 320px;
      margin-top: var(--ux-space-xs);
      padding: var(--ux-space-xs);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      box-shadow: var(--ux-shadow-lg);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all var(--ux-transition-fast) var(--ux-ease);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .ux-datatable__column-menu--open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-datatable__column-menu-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm) var(--ux-space-md);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-datatable__column-menu-title {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-datatable__column-menu-actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-datatable__column-menu-action {
      padding: 2px var(--ux-space-xs);
      background: none;
      border: none;
      border-radius: var(--ux-border-radius-sm);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-primary);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__column-menu-action:hover {
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-datatable__column-list {
      flex: 1;
      overflow-y: auto;
      padding: var(--ux-space-xs) 0;
    }

    .ux-datatable__column-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datatable__column-item:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-datatable__column-item input[type="checkbox"] {
      flex-shrink: 0;
      margin: 0;
    }

    .ux-datatable__column-item-label {
      flex: 1;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-datatable__column-item--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    .ux-datatable__column-item-drag {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      color: var(--ux-text-tertiary);
      cursor: grab;
    }

    .ux-datatable__column-item-drag:active {
      cursor: grabbing;
    }

    .ux-datatable__column-item-drag svg {
      width: 14px;
      height: 14px;
    }

    /* Hidden column indicator in header */
    .ux-datatable__th--hidden,
    .ux-datatable__td--hidden {
      display: none;
    }

    /* Glass variant for column menu */
    .ux-datatable--glass .ux-datatable__column-menu {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    /* Dark mode for column menu */
    @media (prefers-color-scheme: dark) {
      .ux-datatable__column-menu {
        background: var(--ux-surface);
        border-color: var(--ux-border-color);
      }
    }

    .ux-dark .ux-datatable__column-menu {
      background: var(--ux-surface);
      border-color: var(--ux-border-color);
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .ux-datatable__column-menu,
      .ux-datatable__resize-handle::after {
        transition: none;
      }
    }
  `;

  // Icons
  const icons = {
    sortAsc: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7-7 7 7"/></svg>',
    sortDesc: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg>',
    chevronLeft: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>',
    chevronRight: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>',
    chevronsLeft: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 17l-5-5 5-5M18 17l-5-5 5-5"/></svg>',
    chevronsRight: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 7l5 5-5 5M6 7l5 5-5 5"/></svg>',
    empty: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>',
    edit: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',
    delete: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>',
    view: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>',
    close: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>',
    filter: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>',
    export: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>',
    // View toggle icons
    viewTable: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M3 15h18M9 3v18M15 3v18"/></svg>',
    viewCards: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>',
    viewList: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="4" rx="1"/><rect x="3" y="10" width="18" height="4" rx="1"/><rect x="3" y="16" width="18" height="4" rx="1"/></svg>',
    // Expand icons
    chevronRight: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>',
    expand: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>',
    expandAll: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>',
    collapseAll: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>',
    // Export icons
    download: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>',
    csv: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M8 13h2M8 17h2M14 13h2M14 17h2"/></svg>',
    excel: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M8 13l3 4M11 13l-3 4M14 13h2v4h-2"/></svg>',
    fileText: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>',
    // Column visibility and resize icons
    columns: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18M15 3v18"/></svg>',
    eye: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>',
    eyeOff: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>',
    gripVertical: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="5" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="19" r="1"/></svg>'
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-datatable-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-datatable-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for datatable
  // ARIA: role="table", role="rowgroup", role="row", role="columnheader", role="cell"
  const datatableComponent = (config = {}) => ({
    // Data
    columns: config.columns || [],
    rows: config.rows || [],

    // Selection
    selectable: config.selectable || false,
    selectedRows: [],
    selectAll: false,

    // Sorting
    sortable: config.sortable !== false,
    sortColumn: config.sortColumn || null,
    sortDirection: config.sortDirection || 'asc',

    // Pagination
    paginated: config.paginated !== false,
    currentPage: 1,
    perPage: config.perPage || 10,
    perPageOptions: config.perPageOptions || [10, 25, 50, 100],

    // Search
    searchable: config.searchable !== false,
    searchQuery: '',
    searchPlaceholder: config.searchPlaceholder || 'Search...',

    // Column filters
    filterable: config.filterable || false,
    columnFilters: {},
    showFilters: config.showFilters || false,

    // Bulk actions
    bulkActions: config.bulkActions || [],

    // Responsive
    responsive: config.responsive !== false,
    forceResponsive: config.forceResponsive || false,

    // View mode (table, cards)
    viewMode: config.viewMode || 'table',
    showViewToggle: config.showViewToggle || false,

    // Loading
    loading: config.loading || false,

    // Expandable rows
    expandable: config.expandable || false,
    expandedRows: [],
    expandAllState: false,
    singleExpand: config.singleExpand || false, // Only allow one row expanded at a time

    // Column resize
    resizable: config.resizable || false,
    columnWidths: config.columnWidths || {},
    minColumnWidth: config.minColumnWidth || 50,
    _resizing: false,
    _resizeColumn: null,
    _resizeStartX: 0,
    _resizeStartWidth: 0,

    // Column visibility
    hiddenColumns: config.hiddenColumns || [],
    showColumnMenu: false,

    // Empty state
    emptyTitle: config.emptyTitle || 'No data',
    emptyText: config.emptyText || 'There are no records to display.',

    // Labels (for i18n)
    labels: {
      showing: config.labels?.showing || 'Showing',
      to: config.labels?.to || 'to',
      of: config.labels?.of || 'of',
      entries: config.labels?.entries || 'entries',
      perPage: config.labels?.perPage || 'per page',
      noResults: config.labels?.noResults || 'No results found',
      viewTable: config.labels?.viewTable || 'Table view',
      viewCards: config.labels?.viewCards || 'Cards view',
      selected: config.labels?.selected || 'selected',
      clearSelection: config.labels?.clearSelection || 'Clear selection',
      clearFilters: config.labels?.clearFilters || 'Clear filters',
      filterBy: config.labels?.filterBy || 'Filter',
      all: config.labels?.all || 'All',
      columns: config.labels?.columns || 'Columns',
      showAll: config.labels?.showAll || 'Show all',
      hideAll: config.labels?.hideAll || 'Hide all',
      ...config.labels
    },

    // Component ID
    tableId: config.id || 'ux-datatable-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes
    get ariaAttrs() {
      return {
        'role': 'table',
        'aria-label': config.ariaLabel || 'Data table',
        'aria-busy': this.loading ? 'true' : 'false'
      };
    },

    // Initialize
    init() {
      // Initialize column filters
      this.columns.forEach(col => {
        if (col.filterable !== false && this.filterable) {
          this.columnFilters[col.key] = '';
        }
      });

      // Watch for external data changes
      if (config.watchData) {
        this.$watch('rows', () => {
          this.currentPage = 1;
          this.selectedRows = [];
          this.selectAll = false;
        });
      }
    },

    // Computed: Filtered rows (search + column filters)
    get filteredRows() {
      let result = this.rows;

      // Apply global search
      if (this.searchQuery.trim()) {
        const query = this.searchQuery.toLowerCase().trim();
        result = result.filter(row => {
          return this.columns.some(col => {
            const value = this.getCellValue(row, col);
            if (value === null || value === undefined) return false;
            return String(value).toLowerCase().includes(query);
          });
        });
      }

      // Apply column filters
      if (this.filterable && this.hasActiveFilters) {
        result = result.filter(row => {
          return this.columns.every(col => {
            const filterValue = this.columnFilters[col.key];
            if (!filterValue || filterValue === '') return true;

            const cellValue = this.getCellValue(row, col);
            if (cellValue === null || cellValue === undefined) return false;

            // Handle different filter types
            if (col.filterType === 'select') {
              return String(cellValue) === String(filterValue);
            } else if (col.filterType === 'date-range') {
              // filterValue should be { from: 'date', to: 'date' }
              if (typeof filterValue === 'object') {
                const date = new Date(cellValue).getTime();
                const from = filterValue.from ? new Date(filterValue.from).getTime() : -Infinity;
                const to = filterValue.to ? new Date(filterValue.to).getTime() : Infinity;
                return date >= from && date <= to;
              }
              return true;
            } else {
              // Default: text contains
              return String(cellValue).toLowerCase().includes(String(filterValue).toLowerCase());
            }
          });
        });
      }

      return result;
    },

    // Check if any column filter is active
    get hasActiveFilters() {
      return Object.values(this.columnFilters).some(v => {
        if (typeof v === 'object') {
          return v.from || v.to;
        }
        return v && v !== '';
      });
    },

    // Get active filters as array for display
    get activeFiltersList() {
      const filters = [];
      this.columns.forEach(col => {
        const value = this.columnFilters[col.key];
        if (value && value !== '') {
          if (typeof value === 'object' && (value.from || value.to)) {
            let label = '';
            if (value.from && value.to) {
              label = `${value.from} - ${value.to}`;
            } else if (value.from) {
              label = `>= ${value.from}`;
            } else {
              label = `<= ${value.to}`;
            }
            filters.push({ key: col.key, label: col.label, value: label });
          } else {
            filters.push({ key: col.key, label: col.label, value });
          }
        }
      });
      return filters;
    },

    // Computed: Sorted rows
    get sortedRows() {
      if (!this.sortColumn) {
        return this.filteredRows;
      }

      const col = this.columns.find(c => c.key === this.sortColumn);
      if (!col) return this.filteredRows;

      return [...this.filteredRows].sort((a, b) => {
        let valA = this.getCellValue(a, col);
        let valB = this.getCellValue(b, col);

        // Handle nulls
        if (valA === null || valA === undefined) valA = '';
        if (valB === null || valB === undefined) valB = '';

        // Numeric sort
        if (col.type === 'number') {
          valA = parseFloat(valA) || 0;
          valB = parseFloat(valB) || 0;
        }
        // Date sort
        else if (col.type === 'date') {
          valA = new Date(valA).getTime() || 0;
          valB = new Date(valB).getTime() || 0;
        }
        // String sort
        else {
          valA = String(valA).toLowerCase();
          valB = String(valB).toLowerCase();
        }

        let result = 0;
        if (valA < valB) result = -1;
        if (valA > valB) result = 1;

        return this.sortDirection === 'desc' ? -result : result;
      });
    },

    // Computed: Paginated rows
    get paginatedRows() {
      if (!this.paginated) {
        return this.sortedRows;
      }

      const start = (this.currentPage - 1) * this.perPage;
      const end = start + this.perPage;
      return this.sortedRows.slice(start, end);
    },

    // Computed: Total pages
    get totalPages() {
      return Math.ceil(this.sortedRows.length / this.perPage);
    },

    // Computed: Visible page numbers
    get visiblePages() {
      const pages = [];
      const total = this.totalPages;
      const current = this.currentPage;
      const delta = 2;

      for (let i = 1; i <= total; i++) {
        if (i === 1 || i === total || (i >= current - delta && i <= current + delta)) {
          pages.push(i);
        } else if (pages[pages.length - 1] !== '...') {
          pages.push('...');
        }
      }

      return pages;
    },

    // Computed: Showing info text
    get showingInfo() {
      const total = this.sortedRows.length;
      if (total === 0) return '';

      const start = (this.currentPage - 1) * this.perPage + 1;
      const end = Math.min(this.currentPage * this.perPage, total);

      return `${this.labels.showing} ${start} ${this.labels.to} ${end} ${this.labels.of} ${total} ${this.labels.entries}`;
    },

    // Get cell value
    getCellValue(row, col) {
      if (col.getValue) {
        return col.getValue(row);
      }

      // Support nested keys like "user.name"
      const keys = col.key.split('.');
      let value = row;
      for (const key of keys) {
        value = value?.[key];
      }
      return value;
    },

    // Format cell value
    formatCellValue(row, col) {
      const value = this.getCellValue(row, col);

      if (col.format) {
        return col.format(value, row);
      }

      if (value === null || value === undefined) {
        return col.defaultValue || '-';
      }

      return value;
    },

    // Sort by column
    sortBy(column) {
      if (!this.sortable || !column.sortable) return;

      if (this.sortColumn === column.key) {
        this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        this.sortColumn = column.key;
        this.sortDirection = 'asc';
      }

      this.$dispatch('sort-change', {
        column: this.sortColumn,
        direction: this.sortDirection
      });
    },

    // Check if column is sorted
    isSorted(column) {
      return this.sortColumn === column.key;
    },

    // Go to page
    goToPage(page) {
      if (page < 1 || page > this.totalPages) return;
      this.currentPage = page;
      this.$dispatch('page-change', { page: this.currentPage });
    },

    // Change per page
    changePerPage(value) {
      this.perPage = parseInt(value);
      this.currentPage = 1;
      this.$dispatch('per-page-change', { perPage: this.perPage });
    },

    // Search
    onSearch() {
      this.currentPage = 1;
      this.$dispatch('search', { query: this.searchQuery });
    },

    // View mode
    setViewMode(mode) {
      this.viewMode = mode;
      this.$dispatch('view-mode-change', { mode });
    },

    get viewModeClass() {
      if (this.viewMode === 'cards') {
        return 'ux-datatable--force-responsive';
      }
      return this.responsive ? 'ux-datatable--responsive' : '';
    },

    // Selection
    toggleSelectAll() {
      if (this.selectAll) {
        this.selectedRows = this.paginatedRows.map(row => this.getRowId(row));
      } else {
        this.selectedRows = [];
      }
      this.$dispatch('selection-change', { selected: this.selectedRows });
    },

    toggleRowSelection(row) {
      const rowId = this.getRowId(row);
      const index = this.selectedRows.indexOf(rowId);

      if (index > -1) {
        this.selectedRows.splice(index, 1);
      } else {
        this.selectedRows.push(rowId);
      }

      this.selectAll = this.selectedRows.length === this.paginatedRows.length;
      this.$dispatch('selection-change', { selected: this.selectedRows });
    },

    isRowSelected(row) {
      return this.selectedRows.includes(this.getRowId(row));
    },

    getRowId(row) {
      return row.id || row._id || JSON.stringify(row);
    },

    // Row click
    onRowClick(row, event) {
      this.$dispatch('row-click', { row, event });
    },

    // Actions
    onAction(action, row, event) {
      event.stopPropagation();
      this.$dispatch('row-action', { action, row, event });
    },

    // Column filters
    setColumnFilter(key, value) {
      this.columnFilters[key] = value;
      this.currentPage = 1;
      this.$dispatch('filter-change', { filters: this.columnFilters });
    },

    clearColumnFilter(key) {
      const col = this.columns.find(c => c.key === key);
      if (col && col.filterType === 'date-range') {
        this.columnFilters[key] = { from: '', to: '' };
      } else {
        this.columnFilters[key] = '';
      }
      this.currentPage = 1;
      this.$dispatch('filter-change', { filters: this.columnFilters });
    },

    clearAllFilters() {
      this.columns.forEach(col => {
        if (col.filterType === 'date-range') {
          this.columnFilters[col.key] = { from: '', to: '' };
        } else {
          this.columnFilters[col.key] = '';
        }
      });
      this.currentPage = 1;
      this.$dispatch('filter-change', { filters: this.columnFilters });
    },

    toggleFilters() {
      this.showFilters = !this.showFilters;
    },

    // Get unique values for select filter
    getUniqueValues(columnKey) {
      const values = new Set();
      this.rows.forEach(row => {
        const col = this.columns.find(c => c.key === columnKey);
        if (col) {
          const value = this.getCellValue(row, col);
          if (value !== null && value !== undefined && value !== '') {
            values.add(value);
          }
        }
      });
      return Array.from(values).sort();
    },

    // Bulk actions
    clearSelection() {
      this.selectedRows = [];
      this.selectAll = false;
      this.$dispatch('selection-change', { selected: this.selectedRows });
    },

    onBulkAction(action, event) {
      const selectedData = this.rows.filter(row => this.selectedRows.includes(this.getRowId(row)));
      this.$dispatch('bulk-action', {
        action,
        selectedRows: this.selectedRows,
        selectedData,
        event
      });
    },

    // Get selected rows data
    getSelectedData() {
      return this.rows.filter(row => this.selectedRows.includes(this.getRowId(row)));
    },

    // Get icons
    getIcon(name) {
      return icons[name] || '';
    },

    // Expandable rows methods
    toggleRowExpand(row, event) {
      if (event) {
        event.stopPropagation();
      }

      const rowId = this.getRowId(row);
      const index = this.expandedRows.indexOf(rowId);

      if (index > -1) {
        // Collapse
        this.expandedRows.splice(index, 1);
        this.$dispatch('row-collapse', { row, rowId });
      } else {
        // Expand
        if (this.singleExpand) {
          this.expandedRows = [rowId];
        } else {
          this.expandedRows.push(rowId);
        }
        this.$dispatch('row-expand', { row, rowId });
      }

      this.expandAllState = this.expandedRows.length === this.paginatedRows.length;
    },

    isRowExpanded(row) {
      return this.expandedRows.includes(this.getRowId(row));
    },

    expandRow(row) {
      const rowId = this.getRowId(row);
      if (!this.expandedRows.includes(rowId)) {
        if (this.singleExpand) {
          this.expandedRows = [rowId];
        } else {
          this.expandedRows.push(rowId);
        }
        this.$dispatch('row-expand', { row, rowId });
      }
    },

    collapseRow(row) {
      const rowId = this.getRowId(row);
      const index = this.expandedRows.indexOf(rowId);
      if (index > -1) {
        this.expandedRows.splice(index, 1);
        this.$dispatch('row-collapse', { row, rowId });
      }
    },

    toggleExpandAll() {
      if (this.expandAllState) {
        // Collapse all
        this.expandedRows = [];
        this.$dispatch('expand-all', { expanded: false });
      } else {
        // Expand all
        this.expandedRows = this.paginatedRows.map(row => this.getRowId(row));
        this.$dispatch('expand-all', { expanded: true });
      }
      this.expandAllState = !this.expandAllState;
    },

    expandAll() {
      this.expandedRows = this.paginatedRows.map(row => this.getRowId(row));
      this.expandAllState = true;
      this.$dispatch('expand-all', { expanded: true });
    },

    collapseAll() {
      this.expandedRows = [];
      this.expandAllState = false;
      this.$dispatch('expand-all', { expanded: false });
    },

    // Get expanded rows data
    getExpandedData() {
      return this.rows.filter(row => this.expandedRows.includes(this.getRowId(row)));
    },

    // ========================================
    // Export functionality
    // ========================================

    // Export menu state
    exportMenuOpen: false,
    exportSelectedOnly: false,
    exportVisibleColumnsOnly: true,

    // Toggle export menu
    toggleExportMenu() {
      this.exportMenuOpen = !this.exportMenuOpen;
    },

    closeExportMenu() {
      this.exportMenuOpen = false;
    },

    // Get columns to export (respects visibility)
    getExportColumns() {
      if (this.exportVisibleColumnsOnly) {
        return this.columns.filter(col => col.exportable !== false && col.visible !== false);
      }
      return this.columns.filter(col => col.exportable !== false);
    },

    // Get data to export
    getExportData(selectedOnly = false) {
      let data;
      if (selectedOnly || this.exportSelectedOnly) {
        data = this.getSelectedData();
      } else {
        // Export all filtered/sorted rows (not just current page)
        data = this.sortedRows;
      }
      return data;
    },

    // Format value for export (handles dates, numbers, etc.)
    formatExportValue(value, col, options = {}) {
      if (value === null || value === undefined) {
        return '';
      }

      // Date formatting
      if (col.type === 'date' && value) {
        const date = new Date(value);
        if (!isNaN(date.getTime())) {
          const dateFormat = options.dateFormat || 'YYYY-MM-DD';
          const pad = (n) => n.toString().padStart(2, '0');
          const year = date.getFullYear();
          const month = pad(date.getMonth() + 1);
          const day = pad(date.getDate());
          const hours = pad(date.getHours());
          const minutes = pad(date.getMinutes());
          const seconds = pad(date.getSeconds());

          return dateFormat
            .replace('YYYY', year)
            .replace('MM', month)
            .replace('DD', day)
            .replace('HH', hours)
            .replace('mm', minutes)
            .replace('ss', seconds);
        }
      }

      // Use raw value for export (don't use format function which may add currency symbols, etc.)
      if (options.useRawValue) {
        return value;
      }

      // If column has exportFormat, use it
      if (col.exportFormat) {
        return col.exportFormat(value);
      }

      return value;
    },

    // Escape CSV value
    escapeCSV(value) {
      if (value === null || value === undefined) {
        return '';
      }
      const str = String(value);
      // If contains comma, newline, or quote, wrap in quotes and escape quotes
      if (str.includes(',') || str.includes('\n') || str.includes('"')) {
        return '"' + str.replace(/"/g, '""') + '"';
      }
      return str;
    },

    // Export to CSV
    exportToCSV(options = {}) {
      const {
        filename = 'export',
        selectedOnly = this.exportSelectedOnly,
        dateFormat = 'YYYY-MM-DD',
        delimiter = ',',
        includeHeaders = true,
        useRawValue = true
      } = options;

      const columns = this.getExportColumns();
      const data = this.getExportData(selectedOnly);

      let csv = '';

      // Add headers
      if (includeHeaders) {
        csv += columns.map(col => this.escapeCSV(col.label || col.key)).join(delimiter) + '\n';
      }

      // Add rows
      data.forEach(row => {
        const rowValues = columns.map(col => {
          const value = this.getCellValue(row, col);
          const formatted = this.formatExportValue(value, col, { dateFormat, useRawValue });
          return this.escapeCSV(formatted);
        });
        csv += rowValues.join(delimiter) + '\n';
      });

      // Create and download file
      const timestamp = new Date().toISOString().slice(0, 10);
      const fullFilename = `${filename}_${timestamp}.csv`;
      this.downloadFile(csv, fullFilename, 'text/csv;charset=utf-8;');

      this.closeExportMenu();
      this.$dispatch('export', { type: 'csv', filename: fullFilename, rowCount: data.length });
    },

    // Export to Excel (XLSX format with basic formatting)
    exportToExcel(options = {}) {
      const {
        filename = 'export',
        selectedOnly = this.exportSelectedOnly,
        dateFormat = 'YYYY-MM-DD',
        sheetName = 'Data',
        useRawValue = true
      } = options;

      const columns = this.getExportColumns();
      const data = this.getExportData(selectedOnly);

      // Build XML for Excel (Office Open XML SpreadsheetML)
      let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
      xml += '<?mso-application progid="Excel.Sheet"?>\n';
      xml += '<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"\n';
      xml += '  xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">\n';

      // Styles
      xml += '  <Styles>\n';
      xml += '    <Style ss:ID="Header">\n';
      xml += '      <Font ss:Bold="1"/>\n';
      xml += '      <Interior ss:Color="#F3F4F6" ss:Pattern="Solid"/>\n';
      xml += '      <Borders>\n';
      xml += '        <Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1"/>\n';
      xml += '      </Borders>\n';
      xml += '    </Style>\n';
      xml += '    <Style ss:ID="Date">\n';
      xml += '      <NumberFormat ss:Format="yyyy-mm-dd"/>\n';
      xml += '    </Style>\n';
      xml += '    <Style ss:ID="Number">\n';
      xml += '      <NumberFormat ss:Format="#,##0.00"/>\n';
      xml += '    </Style>\n';
      xml += '  </Styles>\n';

      // Worksheet
      xml += `  <Worksheet ss:Name="${this.escapeXML(sheetName)}">\n`;
      xml += `    <Table ss:ExpandedColumnCount="${columns.length}" ss:ExpandedRowCount="${data.length + 1}">\n`;

      // Column widths
      columns.forEach(col => {
        const width = col.exportWidth || 100;
        xml += `      <Column ss:Width="${width}"/>\n`;
      });

      // Header row
      xml += '      <Row>\n';
      columns.forEach(col => {
        xml += `        <Cell ss:StyleID="Header"><Data ss:Type="String">${this.escapeXML(col.label || col.key)}</Data></Cell>\n`;
      });
      xml += '      </Row>\n';

      // Data rows
      data.forEach(row => {
        xml += '      <Row>\n';
        columns.forEach(col => {
          const value = this.getCellValue(row, col);
          const formatted = this.formatExportValue(value, col, { dateFormat, useRawValue });

          let type = 'String';
          let style = '';

          if (col.type === 'number' && typeof value === 'number') {
            type = 'Number';
            style = ' ss:StyleID="Number"';
          } else if (col.type === 'date' && value) {
            type = 'String';
            style = ' ss:StyleID="Date"';
          }

          xml += `        <Cell${style}><Data ss:Type="${type}">${this.escapeXML(String(formatted))}</Data></Cell>\n`;
        });
        xml += '      </Row>\n';
      });

      xml += '    </Table>\n';
      xml += '  </Worksheet>\n';
      xml += '</Workbook>';

      // Create and download file
      const timestamp = new Date().toISOString().slice(0, 10);
      const fullFilename = `${filename}_${timestamp}.xls`;
      this.downloadFile(xml, fullFilename, 'application/vnd.ms-excel');

      this.closeExportMenu();
      this.$dispatch('export', { type: 'excel', filename: fullFilename, rowCount: data.length });
    },

    // Escape XML special characters
    escapeXML(str) {
      if (str === null || str === undefined) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&apos;');
    },

    // Download file helper
    downloadFile(content, filename, mimeType) {
      const blob = new Blob([content], { type: mimeType });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    },

    // Quick export methods (for direct button binding)
    quickExportCSV() {
      this.exportToCSV({ selectedOnly: this.selectedRows.length > 0 });
    },

    quickExportExcel() {
      this.exportToExcel({ selectedOnly: this.selectedRows.length > 0 });
    },

    // ========================================
    // Column Resize functionality
    // ========================================

    // Get column width style
    getColumnWidth(col) {
      if (this.columnWidths[col.key]) {
        return this.columnWidths[col.key] + 'px';
      }
      if (col.width) {
        return typeof col.width === 'number' ? col.width + 'px' : col.width;
      }
      return 'auto';
    },

    // Set column width
    setColumnWidth(colKey, width) {
      const minWidth = this.minColumnWidth;
      const newWidth = Math.max(width, minWidth);
      this.columnWidths[colKey] = newWidth;
      this.$dispatch('column-resize', { column: colKey, width: newWidth });
    },

    // Start resizing column
    startResize(col, event) {
      if (!this.resizable) return;

      event.preventDefault();
      event.stopPropagation();

      this._resizing = true;
      this._resizeColumn = col.key;

      // Get current width
      const th = event.target.closest('.ux-datatable__th');
      this._resizeStartWidth = th ? th.offsetWidth : 100;
      this._resizeStartX = event.clientX || (event.touches && event.touches[0].clientX);

      // Add event listeners
      this._resizeMove = this._handleResizeMove.bind(this);
      this._resizeEnd = this._handleResizeEnd.bind(this);

      document.addEventListener('mousemove', this._resizeMove);
      document.addEventListener('mouseup', this._resizeEnd);
      document.addEventListener('touchmove', this._resizeMove, { passive: false });
      document.addEventListener('touchend', this._resizeEnd);

      // Add resizing class to datatable
      this.$el.classList.add('ux-datatable--resizing');
    },

    // Handle resize move
    _handleResizeMove(event) {
      if (!this._resizing) return;

      event.preventDefault();

      const clientX = event.clientX || (event.touches && event.touches[0].clientX);
      const diff = clientX - this._resizeStartX;
      const newWidth = this._resizeStartWidth + diff;

      this.setColumnWidth(this._resizeColumn, newWidth);
    },

    // Handle resize end
    _handleResizeEnd() {
      this._resizing = false;
      this._resizeColumn = null;

      document.removeEventListener('mousemove', this._resizeMove);
      document.removeEventListener('mouseup', this._resizeEnd);
      document.removeEventListener('touchmove', this._resizeMove);
      document.removeEventListener('touchend', this._resizeEnd);

      this.$el.classList.remove('ux-datatable--resizing');
    },

    // Check if column is being resized
    isColumnResizing(col) {
      return this._resizing && this._resizeColumn === col.key;
    },

    // Reset column width
    resetColumnWidth(colKey) {
      delete this.columnWidths[colKey];
      this.$dispatch('column-resize', { column: colKey, width: null });
    },

    // Reset all column widths
    resetAllColumnWidths() {
      this.columnWidths = {};
      this.$dispatch('column-resize-reset');
    },

    // ========================================
    // Column Visibility functionality
    // ========================================

    // Toggle column visibility menu
    toggleColumnMenu() {
      this.showColumnMenu = !this.showColumnMenu;
    },

    // Close column visibility menu
    closeColumnMenu() {
      this.showColumnMenu = false;
    },

    // Check if column is visible
    isColumnVisible(col) {
      return !this.hiddenColumns.includes(col.key);
    },

    // Toggle column visibility
    toggleColumnVisibility(col) {
      const index = this.hiddenColumns.indexOf(col.key);
      if (index > -1) {
        // Show column
        this.hiddenColumns.splice(index, 1);
        this.$dispatch('column-show', { column: col.key });
      } else {
        // Hide column (ensure at least one column remains visible)
        const visibleCount = this.columns.filter(c => !this.hiddenColumns.includes(c.key)).length;
        if (visibleCount > 1) {
          this.hiddenColumns.push(col.key);
          this.$dispatch('column-hide', { column: col.key });
        }
      }
      this.$dispatch('column-visibility-change', { hiddenColumns: [...this.hiddenColumns] });
    },

    // Show column
    showColumn(colKey) {
      const index = this.hiddenColumns.indexOf(colKey);
      if (index > -1) {
        this.hiddenColumns.splice(index, 1);
        this.$dispatch('column-show', { column: colKey });
        this.$dispatch('column-visibility-change', { hiddenColumns: [...this.hiddenColumns] });
      }
    },

    // Hide column
    hideColumn(colKey) {
      if (!this.hiddenColumns.includes(colKey)) {
        // Ensure at least one column remains visible
        const visibleCount = this.columns.filter(c => !this.hiddenColumns.includes(c.key)).length;
        if (visibleCount > 1) {
          this.hiddenColumns.push(colKey);
          this.$dispatch('column-hide', { column: colKey });
          this.$dispatch('column-visibility-change', { hiddenColumns: [...this.hiddenColumns] });
        }
      }
    },

    // Show all columns
    showAllColumns() {
      this.hiddenColumns = [];
      this.$dispatch('column-visibility-change', { hiddenColumns: [] });
    },

    // Hide all columns except first
    hideAllColumns() {
      // Keep at least the first column visible
      const firstCol = this.columns[0];
      this.hiddenColumns = this.columns
        .filter(col => col.key !== firstCol?.key)
        .map(col => col.key);
      this.$dispatch('column-visibility-change', { hiddenColumns: [...this.hiddenColumns] });
    },

    // Get visible columns
    get visibleColumns() {
      return this.columns.filter(col => this.isColumnVisible(col));
    },

    // Get hidden columns count
    get hiddenColumnsCount() {
      return this.hiddenColumns.length;
    },

    // Check if can hide column (at least one must remain)
    canHideColumn(col) {
      const visibleCount = this.columns.filter(c => !this.hiddenColumns.includes(c.key)).length;
      return visibleCount > 1 || this.hiddenColumns.includes(col.key);
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxDatatable', datatableComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxDatatable', datatableComponent);
    });
  }
})();

/**
 * UX Date Range Picker Component
 * Select date ranges with presets and dual calendar view
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Date Range Picker - Base
    ======================================== */

    .ux-date-range {
      position: relative;
      display: inline-block;
      font-family: var(--ux-font-family);
    }

    /* ========================================
       Trigger Button
    ======================================== */

    .ux-date-range__trigger {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      min-width: 280px;
      height: var(--ux-input-height);
      padding: 0 var(--ux-input-padding-x);
      font-size: var(--ux-input-font-size);
      color: var(--ux-text);
      background: var(--ux-surface);
      border: var(--ux-input-border-width) solid var(--ux-border-color);
      border-radius: var(--ux-input-border-radius);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-date-range__trigger:hover {
      border-color: var(--ux-gray-400);
    }

    .ux-date-range__trigger:focus {
      outline: none;
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-date-range__trigger-icon {
      width: 18px;
      height: 18px;
      color: var(--ux-text-secondary);
      flex-shrink: 0;
    }

    .ux-date-range__trigger-text {
      flex: 1;
      text-align: left;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-date-range__trigger-text--placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-date-range__trigger-arrow {
      width: 16px;
      height: 16px;
      color: var(--ux-text-tertiary);
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-date-range--open .ux-date-range__trigger-arrow {
      transform: rotate(180deg);
    }

    /* ========================================
       Dropdown Panel
    ======================================== */

    .ux-date-range__panel {
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      z-index: var(--ux-z-dropdown);
      display: none;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      box-shadow: var(--ux-shadow-lg);
      overflow: hidden;
    }

    .ux-date-range--open .ux-date-range__panel {
      display: flex;
    }

    .ux-date-range__panel--right {
      left: auto;
      right: 0;
    }

    /* ========================================
       Presets Sidebar
    ======================================== */

    .ux-date-range__presets {
      width: 160px;
      padding: 0.5rem;
      background: var(--ux-surface-secondary);
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-date-range__preset {
      display: block;
      width: 100%;
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      color: var(--ux-text);
      background: transparent;
      border: none;
      border-radius: var(--ux-radius-sm);
      text-align: left;
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-date-range__preset:hover {
      background: var(--ux-surface);
    }

    .ux-date-range__preset--active {
      background: var(--ux-primary);
      color: white;
    }

    .ux-date-range__preset--active:hover {
      background: var(--ux-primary-shade);
    }

    /* ========================================
       Calendars
    ======================================== */

    .ux-date-range__calendars {
      display: flex;
      padding: 1rem;
      gap: 1.5rem;
    }

    .ux-date-range__calendar {
      width: 280px;
    }

    .ux-date-range__calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .ux-date-range__calendar-title {
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-date-range__calendar-nav {
      display: flex;
      gap: 0.25rem;
    }

    .ux-date-range__nav-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: transparent;
      border: none;
      border-radius: var(--ux-radius-sm);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-date-range__nav-btn:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-date-range__nav-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Weekdays */
    .ux-date-range__weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      margin-bottom: 0.25rem;
    }

    .ux-date-range__weekday {
      padding: 0.5rem 0;
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--ux-text-tertiary);
      text-align: center;
      text-transform: uppercase;
    }

    /* Days Grid */
    .ux-date-range__days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }

    .ux-date-range__day {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 36px;
      font-size: 0.875rem;
      color: var(--ux-text);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-date-range__day:hover:not(:disabled):not(.ux-date-range__day--outside) {
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-sm);
    }

    .ux-date-range__day--outside {
      color: var(--ux-text-tertiary);
      cursor: default;
    }

    .ux-date-range__day--today {
      font-weight: 600;
      color: var(--ux-primary);
    }

    .ux-date-range__day--disabled {
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
      opacity: 0.5;
    }

    /* Selected Range */
    .ux-date-range__day--start,
    .ux-date-range__day--end {
      background: var(--ux-primary);
      color: white;
      border-radius: var(--ux-radius-sm);
      z-index: 1;
    }

    .ux-date-range__day--start:hover,
    .ux-date-range__day--end:hover {
      background: var(--ux-primary-shade);
    }

    .ux-date-range__day--in-range {
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-date-range__day--start {
      border-radius: var(--ux-radius-sm) 0 0 var(--ux-radius-sm);
    }

    .ux-date-range__day--end {
      border-radius: 0 var(--ux-radius-sm) var(--ux-radius-sm) 0;
    }

    .ux-date-range__day--start.ux-date-range__day--end {
      border-radius: var(--ux-radius-sm);
    }

    /* ========================================
       Footer
    ======================================== */

    .ux-date-range__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-date-range__selected {
      font-size: 0.875rem;
      color: var(--ux-text-secondary);
    }

    .ux-date-range__actions {
      display: flex;
      gap: 0.5rem;
    }

    .ux-date-range__btn {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-date-range__btn--cancel {
      color: var(--ux-text-secondary);
      background: transparent;
      border: 1px solid var(--ux-border-color);
    }

    .ux-date-range__btn--cancel:hover {
      background: var(--ux-surface);
    }

    .ux-date-range__btn--apply {
      color: white;
      background: var(--ux-primary);
      border: 1px solid var(--ux-primary);
    }

    .ux-date-range__btn--apply:hover {
      background: var(--ux-primary-shade);
    }

    .ux-date-range__btn--apply:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ========================================
       Single Calendar Mode
    ======================================== */

    .ux-date-range--single .ux-date-range__calendars {
      padding: 0.75rem;
    }

    .ux-date-range--single .ux-date-range__calendar {
      width: 260px;
    }

    /* ========================================
       No Presets
    ======================================== */

    .ux-date-range--no-presets .ux-date-range__presets {
      display: none;
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-date-range--sm .ux-date-range__trigger {
      height: var(--ux-input-height-sm);
      min-width: 220px;
      font-size: var(--ux-font-size-sm);
    }

    .ux-date-range--lg .ux-date-range__trigger {
      height: var(--ux-input-height-lg);
      min-width: 320px;
      font-size: var(--ux-font-size-lg);
    }

    /* ========================================
       Mobile
    ======================================== */

    @media (max-width: 767px) {
      .ux-date-range__panel {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        flex-direction: column;
        max-height: 85dvh;
        border-radius: var(--ux-radius-lg) var(--ux-radius-lg) 0 0;
      }

      .ux-date-range__presets {
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
        padding: 0.75rem;
        border-right: none;
        border-bottom: 1px solid var(--ux-border-color);
      }

      .ux-date-range__preset {
        flex: 0 0 auto;
        padding: 0.375rem 0.625rem;
        font-size: 0.8125rem;
      }

      .ux-date-range__calendars {
        flex-direction: column;
        gap: 1rem;
        overflow-y: auto;
      }

      .ux-date-range__calendar {
        width: 100%;
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-date-range__panel {
        background: var(--ux-surface);
        border-color: var(--ux-border-color);
      }

      .ux-date-range__presets {
        background: var(--ux-surface-secondary);
      }
    }

    .ux-dark .ux-date-range__panel {
      background: var(--ux-surface);
      border-color: var(--ux-border-color);
    }

    .ux-dark .ux-date-range__presets {
      background: var(--ux-surface-secondary);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-date-range__trigger,
      .ux-date-range__trigger-arrow,
      .ux-date-range__preset,
      .ux-date-range__nav-btn,
      .ux-date-range__day,
      .ux-date-range__btn {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-date-range-picker-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-date-range-picker-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Icons
  const icons = {
    calendar: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>',
    chevronDown: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>',
    chevronLeft: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>',
    chevronRight: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>'
  };

  // Default presets
  const defaultPresets = [
    { label: 'Hoy', getValue: () => { const d = new Date(); return [d, d]; } },
    { label: 'Ayer', getValue: () => { const d = new Date(); d.setDate(d.getDate() - 1); return [d, d]; } },
    { label: 'Ãltimos 7 dÃ­as', getValue: () => { const e = new Date(); const s = new Date(); s.setDate(s.getDate() - 6); return [s, e]; } },
    { label: 'Ãltimos 30 dÃ­as', getValue: () => { const e = new Date(); const s = new Date(); s.setDate(s.getDate() - 29); return [s, e]; } },
    { label: 'Este mes', getValue: () => { const e = new Date(); const s = new Date(e.getFullYear(), e.getMonth(), 1); return [s, e]; } },
    { label: 'Mes pasado', getValue: () => { const e = new Date(); const s = new Date(e.getFullYear(), e.getMonth() - 1, 1); e.setDate(0); return [s, e]; } },
    { label: 'Este aÃ±o', getValue: () => { const e = new Date(); const s = new Date(e.getFullYear(), 0, 1); return [s, e]; } }
  ];

  // Weekday names
  const weekdays = ['Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'SÃ¡', 'Do'];
  const monthNames = [
    'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
  ];

  // Alpine.js component
  const dateRangePickerData = (options = {}) => ({
    // Configuration
    placeholder: options.placeholder || 'Seleccionar fechas',
    format: options.format || 'DD/MM/YYYY',
    locale: options.locale || 'es',
    minDate: options.minDate ? new Date(options.minDate) : null,
    maxDate: options.maxDate ? new Date(options.maxDate) : null,
    showPresets: options.showPresets ?? true,
    presets: options.presets || defaultPresets,
    singleCalendar: options.singleCalendar ?? false,
    autoApply: options.autoApply ?? false,

    // State
    isOpen: false,
    startDate: options.startDate ? new Date(options.startDate) : null,
    endDate: options.endDate ? new Date(options.endDate) : null,
    tempStartDate: null,
    tempEndDate: null,
    hoverDate: null,
    leftMonth: new Date(),
    rightMonth: new Date(),
    selectedPreset: null,

    // Icons
    icons,
    weekdays,
    monthNames,

    init() {
      // Initialize months
      const now = new Date();
      this.leftMonth = new Date(now.getFullYear(), now.getMonth(), 1);
      this.rightMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);

      // Set initial temp dates
      this.tempStartDate = this.startDate;
      this.tempEndDate = this.endDate;

      // Close on outside click
      this._clickHandler = (e) => {
        if (this.isOpen && !this.$el.contains(e.target)) {
          this.close();
        }
      };
      document.addEventListener('click', this._clickHandler);

      // Keyboard navigation
      this._keyHandler = (e) => {
        if (!this.isOpen) return;
        if (e.key === 'Escape') this.close();
      };
      document.addEventListener('keydown', this._keyHandler);
    },

    destroy() {
      document.removeEventListener('click', this._clickHandler);
      document.removeEventListener('keydown', this._keyHandler);
    },

    // Open dropdown
    open() {
      this.isOpen = true;
      this.tempStartDate = this.startDate;
      this.tempEndDate = this.endDate;
      this.$dispatch('daterange:open');
    },

    // Close dropdown
    close() {
      this.isOpen = false;
      this.hoverDate = null;
      this.$dispatch('daterange:close');
    },

    // Toggle dropdown
    toggle() {
      this.isOpen ? this.close() : this.open();
    },

    // Apply selection
    apply() {
      this.startDate = this.tempStartDate;
      this.endDate = this.tempEndDate;
      this.close();
      this.$dispatch('daterange:change', {
        startDate: this.startDate,
        endDate: this.endDate
      });
    },

    // Cancel selection
    cancel() {
      this.tempStartDate = this.startDate;
      this.tempEndDate = this.endDate;
      this.close();
    },

    // Clear selection
    clear() {
      this.startDate = null;
      this.endDate = null;
      this.tempStartDate = null;
      this.tempEndDate = null;
      this.selectedPreset = null;
      this.$dispatch('daterange:clear');
    },

    // Select preset
    selectPreset(preset) {
      const [start, end] = preset.getValue();
      this.tempStartDate = start;
      this.tempEndDate = end;
      this.selectedPreset = preset.label;

      // Update visible months
      this.leftMonth = new Date(start.getFullYear(), start.getMonth(), 1);
      this.rightMonth = new Date(start.getFullYear(), start.getMonth() + 1, 1);

      if (this.autoApply) {
        this.apply();
      }
    },

    // Handle day click
    selectDay(date) {
      if (this.isDisabled(date)) return;

      if (!this.tempStartDate || (this.tempStartDate && this.tempEndDate)) {
        // Start new selection
        this.tempStartDate = date;
        this.tempEndDate = null;
        this.selectedPreset = null;
      } else {
        // Complete selection
        if (date < this.tempStartDate) {
          this.tempEndDate = this.tempStartDate;
          this.tempStartDate = date;
        } else {
          this.tempEndDate = date;
        }

        if (this.autoApply) {
          this.apply();
        }
      }
    },

    // Handle day hover
    hoverDay(date) {
      if (this.tempStartDate && !this.tempEndDate) {
        this.hoverDate = date;
      }
    },

    // Navigate months
    prevMonth(calendar) {
      if (calendar === 'left') {
        this.leftMonth = new Date(this.leftMonth.getFullYear(), this.leftMonth.getMonth() - 1, 1);
        if (!this.singleCalendar) {
          this.rightMonth = new Date(this.leftMonth.getFullYear(), this.leftMonth.getMonth() + 1, 1);
        }
      } else {
        this.rightMonth = new Date(this.rightMonth.getFullYear(), this.rightMonth.getMonth() - 1, 1);
      }
    },

    nextMonth(calendar) {
      if (calendar === 'left') {
        this.leftMonth = new Date(this.leftMonth.getFullYear(), this.leftMonth.getMonth() + 1, 1);
        if (!this.singleCalendar) {
          this.rightMonth = new Date(this.leftMonth.getFullYear(), this.leftMonth.getMonth() + 1, 1);
        }
      } else {
        this.rightMonth = new Date(this.rightMonth.getFullYear(), this.rightMonth.getMonth() + 1, 1);
      }
    },

    // Get days for a month
    getDays(month) {
      const days = [];
      const year = month.getFullYear();
      const m = month.getMonth();

      // First day of month
      const firstDay = new Date(year, m, 1);
      // Last day of month
      const lastDay = new Date(year, m + 1, 0);

      // Day of week for first day (0 = Sunday, adjust for Monday start)
      let startDay = firstDay.getDay();
      startDay = startDay === 0 ? 6 : startDay - 1;

      // Days from previous month
      for (let i = startDay - 1; i >= 0; i--) {
        const d = new Date(year, m, -i);
        days.push({ date: d, outside: true });
      }

      // Days of current month
      for (let i = 1; i <= lastDay.getDate(); i++) {
        const d = new Date(year, m, i);
        days.push({ date: d, outside: false });
      }

      // Days from next month (fill to 42 cells)
      const remaining = 42 - days.length;
      for (let i = 1; i <= remaining; i++) {
        const d = new Date(year, m + 1, i);
        days.push({ date: d, outside: true });
      }

      return days;
    },

    // Check if date is disabled
    isDisabled(date) {
      if (this.minDate && date < this.minDate) return true;
      if (this.maxDate && date > this.maxDate) return true;
      return false;
    },

    // Check if date is today
    isToday(date) {
      const today = new Date();
      return this.isSameDay(date, today);
    },

    // Check if two dates are same day
    isSameDay(d1, d2) {
      return d1.getFullYear() === d2.getFullYear() &&
             d1.getMonth() === d2.getMonth() &&
             d1.getDate() === d2.getDate();
    },

    // Check if date is start
    isStart(date) {
      return this.tempStartDate && this.isSameDay(date, this.tempStartDate);
    },

    // Check if date is end
    isEnd(date) {
      const end = this.tempEndDate || this.hoverDate;
      return end && this.isSameDay(date, end);
    },

    // Check if date is in range
    isInRange(date) {
      if (!this.tempStartDate) return false;
      const end = this.tempEndDate || this.hoverDate;
      if (!end) return false;

      const start = this.tempStartDate < end ? this.tempStartDate : end;
      const endDate = this.tempStartDate < end ? end : this.tempStartDate;

      return date > start && date < endDate;
    },

    // Get day classes
    getDayClasses(day) {
      return {
        'ux-date-range__day--outside': day.outside,
        'ux-date-range__day--today': this.isToday(day.date),
        'ux-date-range__day--disabled': this.isDisabled(day.date),
        'ux-date-range__day--start': this.isStart(day.date),
        'ux-date-range__day--end': this.isEnd(day.date),
        'ux-date-range__day--in-range': this.isInRange(day.date)
      };
    },

    // Format date
    formatDate(date) {
      if (!date) return '';
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return this.format
        .replace('DD', day)
        .replace('MM', month)
        .replace('YYYY', year);
    },

    // Get display text
    get displayText() {
      if (!this.startDate && !this.endDate) {
        return '';
      }
      if (this.startDate && this.endDate) {
        if (this.isSameDay(this.startDate, this.endDate)) {
          return this.formatDate(this.startDate);
        }
        return `${this.formatDate(this.startDate)} - ${this.formatDate(this.endDate)}`;
      }
      return this.formatDate(this.startDate);
    },

    // Get selected text (for footer)
    get selectedText() {
      if (!this.tempStartDate) return 'Selecciona fecha inicio';
      if (!this.tempEndDate) return 'Selecciona fecha fin';
      return `${this.formatDate(this.tempStartDate)} - ${this.formatDate(this.tempEndDate)}`;
    },

    // Get month title
    getMonthTitle(month) {
      return `${this.monthNames[month.getMonth()]} ${month.getFullYear()}`;
    },

    // Check if can apply
    get canApply() {
      return this.tempStartDate && this.tempEndDate;
    },

    // Set dates programmatically
    setDates(start, end) {
      this.startDate = start ? new Date(start) : null;
      this.endDate = end ? new Date(end) : null;
      this.tempStartDate = this.startDate;
      this.tempEndDate = this.endDate;

      if (this.startDate) {
        this.leftMonth = new Date(this.startDate.getFullYear(), this.startDate.getMonth(), 1);
        this.rightMonth = new Date(this.leftMonth.getFullYear(), this.leftMonth.getMonth() + 1, 1);
      }

      this.$dispatch('daterange:change', { startDate: this.startDate, endDate: this.endDate });
    },

    // Get dates
    getDates() {
      return { startDate: this.startDate, endDate: this.endDate };
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxDateRangePicker', dateRangePickerData);
  }

})();

/**
 * UX Datetime Component
 * Selectores de fecha y hora estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Datetime Input
    ======================================== */

    .ux-datetime {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .ux-datetime__label {
      display: block;
      margin-bottom: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
    }

    .ux-datetime__trigger {
      display: flex;
      align-items: center;
      width: 100%;
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datetime__trigger:hover {
      border-color: var(--ux-medium);
    }

    .ux-datetime--open .ux-datetime__trigger {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-datetime__value {
      flex: 1;
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
    }

    .ux-datetime__placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-datetime__icon {
      width: 20px;
      height: 20px;
      margin-left: var(--ux-space-sm);
      color: var(--ux-text-secondary);
    }

    .ux-datetime__icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Native Date/Time Input (styled)
    ======================================== */

    .ux-datetime__native {
      width: 100%;
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-md) var(--ux-space-lg);
      font-family: var(--ux-font-family);
      font-size: 16px;
      color: var(--ux-text);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-datetime__native:hover {
      border-color: var(--ux-medium);
    }

    .ux-datetime__native:focus {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-datetime__native::-webkit-calendar-picker-indicator {
      cursor: pointer;
      opacity: 0.6;
    }

    .ux-datetime__native::-webkit-calendar-picker-indicator:hover {
      opacity: 1;
    }

    /* ========================================
       Datetime Picker (Custom)
    ======================================== */

    .ux-datetime-picker {
      position: absolute;
      top: calc(100% + var(--ux-space-xs));
      left: 0;
      min-width: 280px;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      box-shadow: var(--ux-shadow-xl);
      z-index: 100;
      overflow: hidden;
    }

    /* ========================================
       Calendar Header
    ======================================== */

    .ux-calendar__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-calendar__nav {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      padding: 0;
      background: none;
      border: none;
      color: var(--ux-primary);
      cursor: pointer;
      border-radius: 50%;
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-calendar__nav:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-calendar__nav:active {
      background-color: rgba(var(--ux-primary-rgb), 0.2);
    }

    .ux-calendar__nav:disabled {
      opacity: 0.3;
      pointer-events: none;
    }

    .ux-calendar__nav-icon {
      width: 20px;
      height: 20px;
    }

    .ux-calendar__nav-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-calendar__title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      cursor: pointer;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-radius: var(--ux-border-radius-sm);
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-calendar__title:hover {
      background-color: var(--ux-surface-secondary);
    }

    /* ========================================
       Calendar Grid
    ======================================== */

    .ux-calendar__weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-calendar__weekday {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 32px;
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
    }

    .ux-calendar__days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      padding: var(--ux-space-sm);
      gap: 2px;
    }

    .ux-calendar__day {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      margin: auto;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      background: none;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-calendar__day:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-calendar__day--other-month {
      color: var(--ux-text-tertiary);
    }

    .ux-calendar__day--today {
      font-weight: 600;
      color: var(--ux-primary);
    }

    .ux-calendar__day--selected {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-calendar__day--selected:hover {
      background-color: var(--ux-primary-shade);
    }

    .ux-calendar__day--disabled {
      opacity: 0.3;
      pointer-events: none;
    }

    .ux-calendar__day--range-start {
      border-radius: 50% 0 0 50%;
    }

    .ux-calendar__day--range-end {
      border-radius: 0 50% 50% 0;
    }

    .ux-calendar__day--in-range {
      background-color: rgba(var(--ux-primary-rgb), 0.15);
      border-radius: 0;
    }

    /* ========================================
       Month/Year Selector
    ======================================== */

    .ux-calendar__months,
    .ux-calendar__years {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md);
    }

    .ux-calendar__month,
    .ux-calendar__year {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 40px;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      background: none;
      border: none;
      border-radius: var(--ux-border-radius);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-calendar__month:hover,
    .ux-calendar__year:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-calendar__month--selected,
    .ux-calendar__year--selected {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    /* ========================================
       Time Picker
    ======================================== */

    .ux-time-picker {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-lg);
      gap: var(--ux-space-sm);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-time-picker__column {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .ux-time-picker__label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-time-picker__input {
      width: 60px;
      height: 44px;
      padding: 0;
      font-size: var(--ux-font-size-xl);
      font-weight: 600;
      text-align: center;
      color: var(--ux-text);
      background-color: var(--ux-surface-secondary);
      border: none;
      border-radius: var(--ux-border-radius);
      outline: none;
      -moz-appearance: textfield;
    }

    .ux-time-picker__input::-webkit-outer-spin-button,
    .ux-time-picker__input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .ux-time-picker__input:focus {
      background-color: rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-time-picker__separator {
      font-size: var(--ux-font-size-xl);
      font-weight: 600;
      color: var(--ux-text);
      padding-top: var(--ux-space-md);
    }

    .ux-time-picker__period {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-left: var(--ux-space-sm);
    }

    .ux-time-picker__period-btn {
      padding: var(--ux-space-xs) var(--ux-space-sm);
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-secondary);
      background: none;
      border: none;
      border-radius: var(--ux-border-radius-sm);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-time-picker__period-btn:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-time-picker__period-btn--active {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    /* ========================================
       Datetime Footer
    ======================================== */

    .ux-datetime-picker__footer {
      display: flex;
      justify-content: flex-end;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Inline Calendar
    ======================================== */

    .ux-calendar--inline {
      position: static;
      box-shadow: none;
      border: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-datetime--sm .ux-datetime__trigger,
    .ux-datetime--sm .ux-datetime__native {
      min-height: var(--ux-touch-target-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
    }

    .ux-datetime--lg .ux-datetime__trigger,
    .ux-datetime--lg .ux-datetime__native {
      min-height: 52px;
      padding: var(--ux-space-lg) var(--ux-space-xl);
      font-size: var(--ux-font-size-lg);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-datetime--glass .ux-datetime__trigger {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-datetime--glass .ux-datetime__trigger:hover {
      background: var(--ux-glass-bg);
    }

    .ux-calendar--glass {
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-calendar--glass .ux-calendar__header {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-calendar--glass .ux-calendar__day:hover:not(.ux-calendar__day--selected) {
      background: var(--ux-glass-bg-thin);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-datetime-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-datetime-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for datetime picker
  const datetimeComponent = (config = {}) => ({
    isOpen: false,
    value: config.value || null,
    displayValue: '',
    mode: config.mode || 'date', // date, time, datetime
    view: 'days', // days, months, years
    format: config.format || 'YYYY-MM-DD',
    min: config.min || null,
    max: config.max || null,
    currentMonth: new Date().getMonth(),
    currentYear: new Date().getFullYear(),
    hours: 12,
    minutes: 0,
    period: 'AM',
    use24Hour: config.use24Hour || false,

    weekdays: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
    months: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],

    init() {
      if (this.value) {
        const date = new Date(this.value);
        this.currentMonth = date.getMonth();
        this.currentYear = date.getFullYear();
        this.hours = date.getHours();
        this.minutes = date.getMinutes();
        this.updateDisplayValue();
      }
    },

    open() {
      this.isOpen = true;
      this.view = 'days';
    },

    close() {
      this.isOpen = false;
    },

    toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    },

    get daysInMonth() {
      const days = [];
      const firstDay = new Date(this.currentYear, this.currentMonth, 1);
      const lastDay = new Date(this.currentYear, this.currentMonth + 1, 0);

      // Days from previous month
      const startDay = firstDay.getDay();
      const prevMonth = new Date(this.currentYear, this.currentMonth, 0);
      for (let i = startDay - 1; i >= 0; i--) {
        days.push({
          day: prevMonth.getDate() - i,
          month: this.currentMonth - 1,
          year: this.currentYear,
          isOtherMonth: true
        });
      }

      // Days in current month
      for (let i = 1; i <= lastDay.getDate(); i++) {
        days.push({
          day: i,
          month: this.currentMonth,
          year: this.currentYear,
          isOtherMonth: false
        });
      }

      // Days from next month
      const remaining = 42 - days.length;
      for (let i = 1; i <= remaining; i++) {
        days.push({
          day: i,
          month: this.currentMonth + 1,
          year: this.currentYear,
          isOtherMonth: true
        });
      }

      return days;
    },

    isToday(date) {
      const today = new Date();
      return date.day === today.getDate() &&
             date.month === today.getMonth() &&
             date.year === today.getFullYear();
    },

    isSelected(date) {
      if (!this.value) return false;
      const selected = new Date(this.value);
      return date.day === selected.getDate() &&
             date.month === selected.getMonth() &&
             date.year === selected.getFullYear();
    },

    selectDate(date) {
      const selected = new Date(date.year, date.month, date.day, this.hours, this.minutes);
      this.value = selected.toISOString();
      this.currentMonth = date.month;
      this.currentYear = date.year;
      this.updateDisplayValue();

      if (this.mode === 'date') {
        this.close();
      }
    },

    prevMonth() {
      if (this.currentMonth === 0) {
        this.currentMonth = 11;
        this.currentYear--;
      } else {
        this.currentMonth--;
      }
    },

    nextMonth() {
      if (this.currentMonth === 11) {
        this.currentMonth = 0;
        this.currentYear++;
      } else {
        this.currentMonth++;
      }
    },

    selectMonth(month) {
      this.currentMonth = month;
      this.view = 'days';
    },

    selectYear(year) {
      this.currentYear = year;
      this.view = 'months';
    },

    updateDisplayValue() {
      if (!this.value) {
        this.displayValue = '';
        return;
      }

      const date = new Date(this.value);
      const options = {};

      if (this.mode === 'date' || this.mode === 'datetime') {
        options.year = 'numeric';
        options.month = 'short';
        options.day = 'numeric';
      }

      if (this.mode === 'time' || this.mode === 'datetime') {
        options.hour = '2-digit';
        options.minute = '2-digit';
        options.hour12 = !this.use24Hour;
      }

      this.displayValue = date.toLocaleString(undefined, options);
    },

    confirm() {
      this.updateDisplayValue();
      this.close();
    },

    clear() {
      this.value = null;
      this.displayValue = '';
      this.close();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxDatetime', datetimeComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxDatetime', datetimeComponent);
    });
  }
})();

/**
 * UX Diff Viewer Component
 * Visual comparison of text/code changes with unified and split views
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Diff Viewer - Base
    ======================================== */

    .ux-diff {
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Consolas', monospace;
      font-size: 0.8125rem;
      line-height: 1.5;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      overflow: hidden;
    }

    /* ========================================
       Header
    ======================================== */

    .ux-diff__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-diff__title {
      font-family: var(--ux-font-family);
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-diff__stats {
      display: flex;
      gap: 0.75rem;
      font-family: var(--ux-font-family);
      font-size: 0.75rem;
    }

    .ux-diff__stat--added {
      color: var(--ux-success);
    }

    .ux-diff__stat--removed {
      color: var(--ux-danger);
    }

    .ux-diff__actions {
      display: flex;
      gap: 0.5rem;
    }

    .ux-diff__action {
      padding: 0.375rem 0.75rem;
      font-family: var(--ux-font-family);
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--ux-text-secondary);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-sm);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-diff__action:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-diff__action--active {
      background: var(--ux-primary);
      color: white;
      border-color: var(--ux-primary);
    }

    /* ========================================
       Content
    ======================================== */

    .ux-diff__content {
      overflow-x: auto;
    }

    .ux-diff__table {
      width: 100%;
      border-collapse: collapse;
    }

    /* ========================================
       Unified View
    ======================================== */

    .ux-diff--unified .ux-diff__line {
      display: flex;
    }

    .ux-diff__gutter {
      flex-shrink: 0;
      width: 3.5rem;
      padding: 0 0.5rem;
      text-align: right;
      color: var(--ux-text-tertiary);
      background: var(--ux-surface-secondary);
      border-right: 1px solid var(--ux-border-color);
      user-select: none;
    }

    .ux-diff__gutter--old {
      width: 3rem;
    }

    .ux-diff__gutter--new {
      width: 3rem;
    }

    .ux-diff__code {
      flex: 1;
      padding: 0 1rem;
      white-space: pre;
      overflow-x: auto;
    }

    .ux-diff__marker {
      flex-shrink: 0;
      width: 1.5rem;
      text-align: center;
      font-weight: 600;
      user-select: none;
    }

    /* Line Types */
    .ux-diff__line--added {
      background: rgba(var(--ux-success-rgb), 0.1);
    }

    .ux-diff__line--added .ux-diff__marker {
      color: var(--ux-success);
    }

    .ux-diff__line--added .ux-diff__gutter {
      background: rgba(var(--ux-success-rgb), 0.15);
    }

    .ux-diff__line--removed {
      background: rgba(var(--ux-danger-rgb), 0.1);
    }

    .ux-diff__line--removed .ux-diff__marker {
      color: var(--ux-danger);
    }

    .ux-diff__line--removed .ux-diff__gutter {
      background: rgba(var(--ux-danger-rgb), 0.15);
    }

    .ux-diff__line--context {
      background: var(--ux-surface);
    }

    .ux-diff__line--header {
      background: var(--ux-surface-tertiary);
      color: var(--ux-text-secondary);
      font-style: italic;
    }

    /* Inline Highlights */
    .ux-diff__highlight--added {
      background: rgba(var(--ux-success-rgb), 0.3);
      border-radius: 2px;
    }

    .ux-diff__highlight--removed {
      background: rgba(var(--ux-danger-rgb), 0.3);
      border-radius: 2px;
    }

    /* ========================================
       Split View
    ======================================== */

    .ux-diff--split .ux-diff__content {
      display: flex;
    }

    .ux-diff--split .ux-diff__pane {
      flex: 1;
      min-width: 0;
    }

    .ux-diff--split .ux-diff__pane--old {
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-diff--split .ux-diff__pane-header {
      padding: 0.5rem 1rem;
      font-family: var(--ux-font-family);
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--ux-text-secondary);
      background: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-diff--split .ux-diff__pane-header--old {
      color: var(--ux-danger);
    }

    .ux-diff--split .ux-diff__pane-header--new {
      color: var(--ux-success);
    }

    .ux-diff--split .ux-diff__line {
      display: flex;
      min-height: 1.5em;
    }

    .ux-diff--split .ux-diff__gutter {
      width: 3rem;
    }

    .ux-diff--split .ux-diff__code {
      padding: 0 0.75rem;
    }

    .ux-diff--split .ux-diff__line--empty {
      background: var(--ux-surface-secondary);
    }

    .ux-diff--split .ux-diff__line--empty .ux-diff__code {
      background: repeating-linear-gradient(
        -45deg,
        transparent,
        transparent 4px,
        var(--ux-border-color) 4px,
        var(--ux-border-color) 5px
      );
    }

    /* ========================================
       Expandable Sections
    ======================================== */

    .ux-diff__expand {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.25rem 1rem;
      background: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
      border-bottom: 1px solid var(--ux-border-color);
      cursor: pointer;
      transition: background var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-diff__expand:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-diff__expand-text {
      font-family: var(--ux-font-family);
      font-size: 0.75rem;
      color: var(--ux-primary);
    }

    .ux-diff__expand-icon {
      width: 16px;
      height: 16px;
      margin-right: 0.5rem;
      color: var(--ux-primary);
    }

    /* ========================================
       Word Diff Mode
    ======================================== */

    .ux-diff--word .ux-diff__word--added {
      background: rgba(var(--ux-success-rgb), 0.25);
      padding: 0 2px;
      border-radius: 2px;
    }

    .ux-diff--word .ux-diff__word--removed {
      background: rgba(var(--ux-danger-rgb), 0.25);
      text-decoration: line-through;
      padding: 0 2px;
      border-radius: 2px;
    }

    /* ========================================
       File Info
    ======================================== */

    .ux-diff__file {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-diff__file-icon {
      width: 16px;
      height: 16px;
      color: var(--ux-text-secondary);
    }

    .ux-diff__file-name {
      font-family: var(--ux-font-family);
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-diff__file-status {
      padding: 0.125rem 0.5rem;
      font-family: var(--ux-font-family);
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      border-radius: var(--ux-radius-sm);
    }

    .ux-diff__file-status--modified {
      background: rgba(var(--ux-warning-rgb), 0.15);
      color: var(--ux-warning);
    }

    .ux-diff__file-status--added {
      background: rgba(var(--ux-success-rgb), 0.15);
      color: var(--ux-success);
    }

    .ux-diff__file-status--deleted {
      background: rgba(var(--ux-danger-rgb), 0.15);
      color: var(--ux-danger);
    }

    .ux-diff__file-status--renamed {
      background: rgba(var(--ux-primary-rgb), 0.15);
      color: var(--ux-primary);
    }

    /* ========================================
       Empty State
    ======================================== */

    .ux-diff__empty {
      padding: 3rem 2rem;
      text-align: center;
      font-family: var(--ux-font-family);
    }

    .ux-diff__empty-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 1rem;
      color: var(--ux-text-tertiary);
    }

    .ux-diff__empty-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--ux-text);
      margin-bottom: 0.5rem;
    }

    .ux-diff__empty-text {
      font-size: 0.875rem;
      color: var(--ux-text-secondary);
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-diff--sm {
      font-size: 0.75rem;
    }

    .ux-diff--sm .ux-diff__gutter {
      width: 2.5rem;
      padding: 0 0.375rem;
    }

    .ux-diff--sm .ux-diff__code {
      padding: 0 0.75rem;
    }

    .ux-diff--lg {
      font-size: 0.875rem;
    }

    .ux-diff--lg .ux-diff__gutter {
      width: 4rem;
    }

    /* ========================================
       Line Numbers Only
    ======================================== */

    .ux-diff--no-gutter .ux-diff__gutter {
      display: none;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-diff {
        background: var(--ux-surface);
        border-color: var(--ux-border-color);
      }

      .ux-diff__line--added {
        background: rgba(var(--ux-success-rgb), 0.15);
      }

      .ux-diff__line--removed {
        background: rgba(var(--ux-danger-rgb), 0.15);
      }
    }

    .ux-dark .ux-diff {
      background: var(--ux-surface);
      border-color: var(--ux-border-color);
    }

    .ux-dark .ux-diff__line--added {
      background: rgba(var(--ux-success-rgb), 0.15);
    }

    .ux-dark .ux-diff__line--removed {
      background: rgba(var(--ux-danger-rgb), 0.15);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-diff__action,
      .ux-diff__expand {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-diff-viewer-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-diff-viewer-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Icons
  const icons = {
    file: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>',
    expand: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>',
    check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>'
  };

  // Simple diff algorithm (Myers-like for lines)
  function computeDiff(oldText, newText) {
    const oldLines = oldText.split('\n');
    const newLines = newText.split('\n');
    const result = [];

    // LCS-based diff
    const lcs = computeLCS(oldLines, newLines);
    let oldIndex = 0;
    let newIndex = 0;
    let lcsIndex = 0;

    while (oldIndex < oldLines.length || newIndex < newLines.length) {
      if (lcsIndex < lcs.length) {
        // Output removed lines
        while (oldIndex < oldLines.length && oldLines[oldIndex] !== lcs[lcsIndex]) {
          result.push({
            type: 'removed',
            oldLine: oldIndex + 1,
            newLine: null,
            content: oldLines[oldIndex]
          });
          oldIndex++;
        }

        // Output added lines
        while (newIndex < newLines.length && newLines[newIndex] !== lcs[lcsIndex]) {
          result.push({
            type: 'added',
            oldLine: null,
            newLine: newIndex + 1,
            content: newLines[newIndex]
          });
          newIndex++;
        }

        // Output context line
        if (oldIndex < oldLines.length && newIndex < newLines.length) {
          result.push({
            type: 'context',
            oldLine: oldIndex + 1,
            newLine: newIndex + 1,
            content: oldLines[oldIndex]
          });
          oldIndex++;
          newIndex++;
          lcsIndex++;
        }
      } else {
        // Output remaining removed lines
        while (oldIndex < oldLines.length) {
          result.push({
            type: 'removed',
            oldLine: oldIndex + 1,
            newLine: null,
            content: oldLines[oldIndex]
          });
          oldIndex++;
        }

        // Output remaining added lines
        while (newIndex < newLines.length) {
          result.push({
            type: 'added',
            oldLine: null,
            newLine: newIndex + 1,
            content: newLines[newIndex]
          });
          newIndex++;
        }
      }
    }

    return result;
  }

  // Compute Longest Common Subsequence
  function computeLCS(a, b) {
    const m = a.length;
    const n = b.length;
    const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

    for (let i = 1; i <= m; i++) {
      for (let j = 1; j <= n; j++) {
        if (a[i - 1] === b[j - 1]) {
          dp[i][j] = dp[i - 1][j - 1] + 1;
        } else {
          dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
        }
      }
    }

    // Backtrack to find LCS
    const lcs = [];
    let i = m, j = n;
    while (i > 0 && j > 0) {
      if (a[i - 1] === b[j - 1]) {
        lcs.unshift(a[i - 1]);
        i--;
        j--;
      } else if (dp[i - 1][j] > dp[i][j - 1]) {
        i--;
      } else {
        j--;
      }
    }

    return lcs;
  }

  // Compute word-level diff for inline highlighting
  function computeWordDiff(oldLine, newLine) {
    const oldWords = oldLine.split(/(\s+)/);
    const newWords = newLine.split(/(\s+)/);
    const lcs = computeLCS(oldWords, newWords);

    const result = {
      old: [],
      new: []
    };

    let oldIndex = 0;
    let newIndex = 0;
    let lcsIndex = 0;

    while (oldIndex < oldWords.length || newIndex < newWords.length) {
      if (lcsIndex < lcs.length) {
        while (oldIndex < oldWords.length && oldWords[oldIndex] !== lcs[lcsIndex]) {
          result.old.push({ text: oldWords[oldIndex], type: 'removed' });
          oldIndex++;
        }
        while (newIndex < newWords.length && newWords[newIndex] !== lcs[lcsIndex]) {
          result.new.push({ text: newWords[newIndex], type: 'added' });
          newIndex++;
        }
        if (oldIndex < oldWords.length) {
          result.old.push({ text: oldWords[oldIndex], type: 'context' });
          oldIndex++;
        }
        if (newIndex < newWords.length) {
          result.new.push({ text: newWords[newIndex], type: 'context' });
          newIndex++;
        }
        lcsIndex++;
      } else {
        while (oldIndex < oldWords.length) {
          result.old.push({ text: oldWords[oldIndex], type: 'removed' });
          oldIndex++;
        }
        while (newIndex < newWords.length) {
          result.new.push({ text: newWords[newIndex], type: 'added' });
          newIndex++;
        }
      }
    }

    return result;
  }

  // Alpine.js component
  const diffViewerData = (options = {}) => ({
    // Configuration
    oldText: options.oldText || '',
    newText: options.newText || '',
    oldTitle: options.oldTitle || 'Original',
    newTitle: options.newTitle || 'Modified',
    fileName: options.fileName || null,
    fileStatus: options.fileStatus || 'modified', // modified, added, deleted, renamed

    // View options
    view: options.view || 'unified', // 'unified', 'split'
    showLineNumbers: options.showLineNumbers ?? true,
    contextLines: options.contextLines ?? 3,
    wordDiff: options.wordDiff ?? false,
    expandable: options.expandable ?? true,

    // State
    diff: [],
    expandedSections: {},
    icons,

    init() {
      this.computeDiff();
    },

    // Compute diff
    computeDiff() {
      this.diff = computeDiff(this.oldText, this.newText);
    },

    // Set texts
    setTexts(oldText, newText) {
      this.oldText = oldText;
      this.newText = newText;
      this.computeDiff();
    },

    // Get lines for display (with context collapsing)
    get displayLines() {
      if (!this.expandable || this.contextLines === -1) {
        return this.diff;
      }

      const result = [];
      let contextCount = 0;
      let hiddenStart = -1;

      for (let i = 0; i < this.diff.length; i++) {
        const line = this.diff[i];
        const isChange = line.type === 'added' || line.type === 'removed';

        // Look ahead to see if there's a change nearby
        let nearChange = false;
        for (let j = Math.max(0, i - this.contextLines); j <= Math.min(this.diff.length - 1, i + this.contextLines); j++) {
          if (this.diff[j].type === 'added' || this.diff[j].type === 'removed') {
            nearChange = true;
            break;
          }
        }

        if (isChange || nearChange) {
          // Add expand marker if we had hidden lines
          if (hiddenStart !== -1) {
            const hiddenCount = i - hiddenStart;
            if (hiddenCount > 0) {
              result.push({
                type: 'expand',
                startIndex: hiddenStart,
                endIndex: i - 1,
                count: hiddenCount
              });
            }
            hiddenStart = -1;
          }
          result.push({ ...line, index: i });
          contextCount = 0;
        } else {
          if (hiddenStart === -1) {
            hiddenStart = i;
          }
        }
      }

      // Handle trailing hidden lines
      if (hiddenStart !== -1) {
        const hiddenCount = this.diff.length - hiddenStart;
        if (hiddenCount > 0) {
          result.push({
            type: 'expand',
            startIndex: hiddenStart,
            endIndex: this.diff.length - 1,
            count: hiddenCount
          });
        }
      }

      return result;
    },

    // Get split view lines (paired old/new)
    get splitLines() {
      const pairs = [];
      let i = 0;

      while (i < this.diff.length) {
        const line = this.diff[i];

        if (line.type === 'context') {
          pairs.push({
            old: line,
            new: line
          });
          i++;
        } else if (line.type === 'removed') {
          // Check if next is added (modification)
          if (i + 1 < this.diff.length && this.diff[i + 1].type === 'added') {
            pairs.push({
              old: line,
              new: this.diff[i + 1]
            });
            i += 2;
          } else {
            pairs.push({
              old: line,
              new: { type: 'empty', content: '' }
            });
            i++;
          }
        } else if (line.type === 'added') {
          pairs.push({
            old: { type: 'empty', content: '' },
            new: line
          });
          i++;
        } else {
          i++;
        }
      }

      return pairs;
    },

    // Stats
    get stats() {
      let added = 0;
      let removed = 0;

      for (const line of this.diff) {
        if (line.type === 'added') added++;
        if (line.type === 'removed') removed++;
      }

      return { added, removed };
    },

    // Expand section
    expandSection(startIndex, endIndex) {
      const key = `${startIndex}-${endIndex}`;
      this.expandedSections[key] = true;
    },

    // Check if section is expanded
    isExpanded(startIndex, endIndex) {
      const key = `${startIndex}-${endIndex}`;
      return this.expandedSections[key] === true;
    },

    // Get lines for an expand section
    getExpandedLines(startIndex, endIndex) {
      return this.diff.slice(startIndex, endIndex + 1);
    },

    // Get word diff HTML for a line
    getWordDiffHtml(line, type) {
      if (!this.wordDiff) {
        return this.escapeHtml(line.content);
      }

      // Find paired line
      const index = this.diff.indexOf(line);
      let pairedLine = null;

      if (line.type === 'removed') {
        // Look for next added line
        for (let i = index + 1; i < this.diff.length && i < index + 5; i++) {
          if (this.diff[i].type === 'added') {
            pairedLine = this.diff[i];
            break;
          }
          if (this.diff[i].type === 'context') break;
        }
      } else if (line.type === 'added') {
        // Look for previous removed line
        for (let i = index - 1; i >= 0 && i > index - 5; i--) {
          if (this.diff[i].type === 'removed') {
            pairedLine = this.diff[i];
            break;
          }
          if (this.diff[i].type === 'context') break;
        }
      }

      if (!pairedLine) {
        return this.escapeHtml(line.content);
      }

      const wordDiff = computeWordDiff(
        line.type === 'removed' ? line.content : pairedLine.content,
        line.type === 'added' ? line.content : pairedLine.content
      );

      const words = line.type === 'removed' ? wordDiff.old : wordDiff.new;

      return words.map(w => {
        if (w.type === 'context') {
          return this.escapeHtml(w.text);
        }
        const className = w.type === 'added' ? 'ux-diff__highlight--added' : 'ux-diff__highlight--removed';
        return `<span class="${className}">${this.escapeHtml(w.text)}</span>`;
      }).join('');
    },

    // Escape HTML
    escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    },

    // Toggle view
    toggleView() {
      this.view = this.view === 'unified' ? 'split' : 'unified';
    },

    // Set view
    setView(view) {
      this.view = view;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxDiffViewer', diffViewerData);
  }

})();

/**
 * UX Divider Component
 * LÃ­neas divisorias horizontales y verticales con variantes
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Divider
    ======================================== */

    .ux-divider {
      --ux-divider-color: var(--ux-border-color);
      --ux-divider-thickness: 1px;
      --ux-divider-spacing: var(--ux-space-md);

      display: flex;
      align-items: center;
      margin: var(--ux-divider-spacing) 0;
      color: var(--ux-text-tertiary);
      font-size: var(--ux-font-size-sm);
    }

    .ux-divider::before,
    .ux-divider::after {
      content: '';
      flex: 1;
      height: var(--ux-divider-thickness);
      background-color: var(--ux-divider-color);
    }

    /* Sin contenido - lÃ­nea simple */
    .ux-divider:empty::before {
      flex: 1;
    }

    .ux-divider:empty::after {
      display: none;
    }

    /* Con contenido - texto centrado */
    .ux-divider:not(:empty)::before {
      margin-right: var(--ux-space-md);
    }

    .ux-divider:not(:empty)::after {
      margin-left: var(--ux-space-md);
    }

    /* ========================================
       Vertical Divider
    ======================================== */

    .ux-divider--vertical {
      flex-direction: column;
      width: var(--ux-divider-thickness);
      height: auto;
      min-height: 1rem;
      margin: 0 var(--ux-divider-spacing);
      align-self: stretch;
    }

    .ux-divider--vertical::before,
    .ux-divider--vertical::after {
      width: var(--ux-divider-thickness);
      height: auto;
      flex: 1;
    }

    .ux-divider--vertical:not(:empty)::before {
      margin-right: 0;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-divider--vertical:not(:empty)::after {
      margin-left: 0;
      margin-top: var(--ux-space-sm);
    }

    /* ========================================
       Thickness Variants
    ======================================== */

    .ux-divider--thin {
      --ux-divider-thickness: 1px;
    }

    .ux-divider--medium {
      --ux-divider-thickness: 2px;
    }

    .ux-divider--thick {
      --ux-divider-thickness: 4px;
    }

    /* ========================================
       Spacing Variants
    ======================================== */

    .ux-divider--xs {
      --ux-divider-spacing: var(--ux-space-xs);
    }

    .ux-divider--sm {
      --ux-divider-spacing: var(--ux-space-sm);
    }

    .ux-divider--lg {
      --ux-divider-spacing: var(--ux-space-lg);
    }

    .ux-divider--xl {
      --ux-divider-spacing: var(--ux-space-xl);
    }

    .ux-divider--none {
      --ux-divider-spacing: 0;
    }

    /* ========================================
       Style Variants
    ======================================== */

    .ux-divider--dashed::before,
    .ux-divider--dashed::after {
      background: repeating-linear-gradient(
        90deg,
        var(--ux-divider-color) 0,
        var(--ux-divider-color) 6px,
        transparent 6px,
        transparent 12px
      );
    }

    .ux-divider--vertical.ux-divider--dashed::before,
    .ux-divider--vertical.ux-divider--dashed::after {
      background: repeating-linear-gradient(
        180deg,
        var(--ux-divider-color) 0,
        var(--ux-divider-color) 6px,
        transparent 6px,
        transparent 12px
      );
    }

    .ux-divider--dotted::before,
    .ux-divider--dotted::after {
      background: repeating-linear-gradient(
        90deg,
        var(--ux-divider-color) 0,
        var(--ux-divider-color) 2px,
        transparent 2px,
        transparent 6px
      );
    }

    .ux-divider--vertical.ux-divider--dotted::before,
    .ux-divider--vertical.ux-divider--dotted::after {
      background: repeating-linear-gradient(
        180deg,
        var(--ux-divider-color) 0,
        var(--ux-divider-color) 2px,
        transparent 2px,
        transparent 6px
      );
    }

    /* ========================================
       Gradient Variant
    ======================================== */

    .ux-divider--gradient::before {
      background: linear-gradient(90deg, transparent, var(--ux-divider-color));
    }

    .ux-divider--gradient::after {
      background: linear-gradient(90deg, var(--ux-divider-color), transparent);
    }

    .ux-divider--gradient:empty::before {
      background: linear-gradient(90deg, transparent, var(--ux-divider-color) 50%, transparent);
    }

    .ux-divider--vertical.ux-divider--gradient::before {
      background: linear-gradient(180deg, transparent, var(--ux-divider-color));
    }

    .ux-divider--vertical.ux-divider--gradient::after {
      background: linear-gradient(180deg, var(--ux-divider-color), transparent);
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-divider--primary {
      --ux-divider-color: var(--ux-primary);
    }

    .ux-divider--secondary {
      --ux-divider-color: var(--ux-text-secondary);
    }

    .ux-divider--light {
      --ux-divider-color: var(--ux-gray-200);
    }

    .ux-divider--dark {
      --ux-divider-color: var(--ux-gray-600);
    }

    /* ========================================
       Text Position (with content)
    ======================================== */

    .ux-divider--left::before {
      flex: 0 0 2rem;
    }

    .ux-divider--right::after {
      flex: 0 0 2rem;
    }

    /* ========================================
       Inset (for lists)
    ======================================== */

    .ux-divider--inset {
      margin-left: var(--ux-space-lg);
    }

    .ux-divider--inset-end {
      margin-right: var(--ux-space-lg);
    }

    .ux-divider--inset-both {
      margin-left: var(--ux-space-lg);
      margin-right: var(--ux-space-lg);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-divider {
        --ux-divider-color: var(--ux-border-color);
      }

      .ux-divider--light {
        --ux-divider-color: var(--ux-gray-700);
      }

      .ux-divider--dark {
        --ux-divider-color: var(--ux-gray-400);
      }
    }

    .ux-dark .ux-divider {
      --ux-divider-color: var(--ux-border-color);
    }

    .ux-dark .ux-divider--light {
      --ux-divider-color: var(--ux-gray-700);
    }

    .ux-dark .ux-divider--dark {
      --ux-divider-color: var(--ux-gray-400);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-divider {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-divider-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-divider-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

})();

/**
 * UX Drawer Component
 * Panel lateral deslizable (sidebar modal)
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Drawer Backdrop
    ======================================== */

    .ux-drawer-backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: var(--ux-z-modal-backdrop);
      opacity: 0;
      visibility: hidden;
      transition:
        opacity 350ms var(--ux-ease-ios),
        visibility 350ms var(--ux-ease-ios);
    }

    .ux-drawer-backdrop--open {
      opacity: 1;
      visibility: visible;
      transition:
        opacity 300ms var(--ux-ease-ios),
        visibility 300ms var(--ux-ease-ios);
    }

    /* ========================================
       UX Drawer
    ======================================== */

    .ux-drawer {
      --ux-drawer-width: 320px;

      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      width: var(--ux-drawer-width);
      max-width: calc(100vw - 56px);
      background-color: var(--ux-surface);
      display: flex;
      flex-direction: column;
      z-index: var(--ux-z-modal);
      transform: translateX(-100%);
      transition: transform 350ms var(--ux-ease-ios);
      will-change: transform;
      box-shadow: var(--ux-shadow-xl);
    }

    .ux-drawer-backdrop--open .ux-drawer {
      transform: translateX(0);
      transition: transform 400ms var(--ux-ease-ios);
    }

    /* ========================================
       Right Position
    ======================================== */

    .ux-drawer--right {
      left: auto;
      right: 0;
      transform: translateX(100%);
    }

    .ux-drawer-backdrop--open .ux-drawer--right {
      transform: translateX(0);
    }

    /* ========================================
       Drawer Header
    ======================================== */

    .ux-drawer__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md) var(--ux-space-lg);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
      min-height: 56px;
      padding-top: calc(var(--ux-space-md) + env(safe-area-inset-top));
    }

    .ux-drawer__header--no-border {
      border-bottom: none;
    }

    .ux-drawer__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-drawer__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
      margin-top: 2px;
    }

    .ux-drawer__close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      padding: 0;
      background-color: transparent;
      border: none;
      border-radius: 50%;
      color: var(--ux-text-secondary);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-drawer__close:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-drawer__close:active {
      background-color: var(--ux-surface-tertiary);
    }

    .ux-drawer__close-icon {
      width: 20px;
      height: 20px;
    }

    /* ========================================
       Drawer Content
    ======================================== */

    .ux-drawer__content {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }

    .ux-drawer__content--padded {
      padding: var(--ux-space-lg);
    }

    /* ========================================
       Drawer Footer
    ======================================== */

    .ux-drawer__footer {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md) var(--ux-space-lg);
      border-top: 1px solid var(--ux-border-color);
      flex-shrink: 0;
      padding-bottom: calc(var(--ux-space-md) + env(safe-area-inset-bottom));
    }

    .ux-drawer__footer--no-border {
      border-top: none;
    }

    .ux-drawer__footer--sticky {
      position: sticky;
      bottom: 0;
      background-color: var(--ux-surface);
    }

    /* ========================================
       Width Variants
    ======================================== */

    .ux-drawer--sm {
      --ux-drawer-width: 280px;
    }

    .ux-drawer--lg {
      --ux-drawer-width: 400px;
    }

    .ux-drawer--xl {
      --ux-drawer-width: 500px;
    }

    .ux-drawer--full {
      --ux-drawer-width: 100vw;
      max-width: 100vw;
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-drawer--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border-right: 0.5px solid var(--ux-glass-border);
    }

    .ux-drawer--glass.ux-drawer--right {
      border-right: none;
      border-left: 0.5px solid var(--ux-glass-border);
    }

    .ux-drawer--glass .ux-drawer__header {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-drawer--glass .ux-drawer__footer {
      border-top-color: var(--ux-glass-border);
      background: transparent;
    }

    /* ========================================
       Push Mode (content shifts)
    ======================================== */

    .ux-drawer--push {
      box-shadow: none;
    }

    /* ========================================
       Persistent (no backdrop, stays open)
    ======================================== */

    .ux-drawer--persistent {
      position: relative;
      transform: translateX(0);
      box-shadow: none;
      z-index: auto;
    }

    .ux-drawer--persistent.ux-drawer--collapsed {
      transform: translateX(-100%);
      margin-left: calc(var(--ux-drawer-width) * -1);
    }

    .ux-drawer--persistent.ux-drawer--right.ux-drawer--collapsed {
      transform: translateX(100%);
      margin-right: calc(var(--ux-drawer-width) * -1);
      margin-left: 0;
    }

    /* ========================================
       Mini Variant (collapsed to icons)
    ======================================== */

    .ux-drawer--mini {
      --ux-drawer-mini-width: 64px;
    }

    .ux-drawer--mini.ux-drawer--collapsed {
      width: var(--ux-drawer-mini-width);
      transform: translateX(0);
      margin-left: 0;
    }

    .ux-drawer--mini.ux-drawer--collapsed .ux-drawer__header {
      padding: var(--ux-space-md) var(--ux-space-sm);
      justify-content: center;
    }

    .ux-drawer--mini.ux-drawer--collapsed .ux-drawer__title,
    .ux-drawer--mini.ux-drawer--collapsed .ux-drawer__subtitle {
      display: none;
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-drawer {
        max-width: calc(100vw - 48px);
      }

      .ux-drawer--lg,
      .ux-drawer--xl {
        --ux-drawer-width: calc(100vw - 48px);
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-drawer {
        background-color: var(--ux-surface);
      }

      .ux-drawer--glass {
        background: var(--ux-glass-bg);
      }
    }

    .ux-dark .ux-drawer {
      background-color: var(--ux-surface);
    }

    .ux-dark .ux-drawer--glass {
      background: var(--ux-glass-bg);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-drawer,
      .ux-drawer-backdrop {
        transition: none;
      }

      .ux-drawer-backdrop--open .ux-drawer {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-drawer-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-drawer-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const drawerData = (options = {}) => ({
    isOpen: options.isOpen ?? false,
    closeOnBackdrop: options.closeOnBackdrop ?? true,
    closeOnEscape: options.closeOnEscape ?? true,
    lockScroll: options.lockScroll ?? true,
    position: options.position ?? 'left', // 'left' | 'right'

    init() {
      // Escape key handler
      if (this.closeOnEscape) {
        this._escapeHandler = (e) => {
          if (e.key === 'Escape' && this.isOpen) {
            this.close();
          }
        };
        document.addEventListener('keydown', this._escapeHandler);
      }

      // Watch isOpen changes
      this.$watch('isOpen', (value) => {
        if (value) {
          this._onOpen();
        } else {
          this._onClose();
        }
      });

      // Initial state
      if (this.isOpen) {
        this._onOpen();
      }
    },

    destroy() {
      if (this._escapeHandler) {
        document.removeEventListener('keydown', this._escapeHandler);
      }
      this._onClose();
    },

    _onOpen() {
      if (this.lockScroll && window.UX) {
        window.UX.lockScroll();
      }

      // Focus trap
      this.$nextTick(() => {
        if (window.UX) {
          window.UX.trapFocus(this.$el.querySelector('.ux-drawer'));
        }
      });

      this.$dispatch('drawer:open');
    },

    _onClose() {
      if (this.lockScroll && window.UX) {
        window.UX.unlockScroll();
      }
      this.$dispatch('drawer:close');
    },

    open() {
      this.isOpen = true;
    },

    close() {
      this.isOpen = false;
    },

    toggle() {
      this.isOpen = !this.isOpen;
    },

    onBackdropClick() {
      if (this.closeOnBackdrop) {
        this.close();
      }
    },

    get backdropClasses() {
      return {
        'ux-drawer-backdrop--open': this.isOpen
      };
    },

    get drawerClasses() {
      return {
        'ux-drawer--right': this.position === 'right'
      };
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxDrawer', drawerData);
  }

})();

(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       UX Dropdown - Menu Dropdown Component
       iOS 26 Style - Liquid Glass Design
       ========================================================================== */

    :root {
      /* Dropdown Tokens */
      --ux-dropdown-min-width: 180px;
      --ux-dropdown-max-width: 320px;
      --ux-dropdown-padding: var(--ux-space-xs);
      --ux-dropdown-border-radius: var(--ux-border-radius-lg);
      --ux-dropdown-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 2px 10px rgba(0, 0, 0, 0.1);
      --ux-dropdown-item-height: 44px;
      --ux-dropdown-item-padding: 0 var(--ux-space-md);
      --ux-dropdown-item-gap: var(--ux-space-sm);
      --ux-dropdown-divider-margin: var(--ux-space-xs);
      --ux-dropdown-header-padding: var(--ux-space-sm) var(--ux-space-md);
    }

    /* ==========================================================================
       Dropdown Container
       ========================================================================== */

    .ux-dropdown {
      position: relative;
      display: inline-block;
    }

    /* ==========================================================================
       Dropdown Trigger
       ========================================================================== */

    .ux-dropdown__trigger {
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-dropdown__trigger[aria-expanded="true"] .ux-dropdown__caret {
      transform: rotate(180deg);
    }

    .ux-dropdown__caret {
      width: 16px;
      height: 16px;
      transition: transform var(--ux-transition-fast) var(--ux-ease-ios);
      opacity: 0.6;
    }

    .ux-dropdown__caret svg {
      width: 100%;
      height: 100%;
    }

    /* ==========================================================================
       Dropdown Menu
       ========================================================================== */

    .ux-dropdown__menu {
      position: absolute;
      z-index: var(--ux-z-dropdown);
      min-width: var(--ux-dropdown-min-width);
      max-width: var(--ux-dropdown-max-width);
      max-height: 320px;
      overflow-y: auto;
      overscroll-behavior: contain;
      padding: var(--ux-dropdown-padding);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-dropdown-border-radius);
      box-shadow: var(--ux-dropdown-shadow);

      /* Hidden by default */
      opacity: 0;
      visibility: hidden;
      transform: scale(0.95) translateY(-8px);
      transform-origin: top left;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease-ios),
        transform var(--ux-transition-fast) var(--ux-ease-ios),
        visibility var(--ux-transition-fast);
    }

    /* Visible state */
    .ux-dropdown--open .ux-dropdown__menu,
    .ux-dropdown__menu[data-show] {
      opacity: 1;
      visibility: visible;
      transform: scale(1) translateY(0);
    }

    /* Position variants */
    .ux-dropdown__menu--top {
      bottom: 100%;
      top: auto;
      margin-bottom: var(--ux-space-xs);
      transform-origin: bottom left;
      transform: scale(0.95) translateY(8px);
    }

    .ux-dropdown--open .ux-dropdown__menu--top,
    .ux-dropdown__menu--top[data-show] {
      transform: scale(1) translateY(0);
    }

    .ux-dropdown__menu--right {
      right: 0;
      left: auto;
      transform-origin: top right;
    }

    .ux-dropdown__menu--top.ux-dropdown__menu--right {
      transform-origin: bottom right;
    }

    .ux-dropdown__menu--left {
      left: 0;
      right: auto;
    }

    .ux-dropdown__menu--center {
      left: 50%;
      transform: scale(0.95) translateY(-8px) translateX(-50%);
      transform-origin: top center;
    }

    .ux-dropdown--open .ux-dropdown__menu--center,
    .ux-dropdown__menu--center[data-show] {
      transform: scale(1) translateY(0) translateX(-50%);
    }

    /* ==========================================================================
       Dropdown Item
       ========================================================================== */

    .ux-dropdown__item {
      display: flex;
      align-items: center;
      gap: var(--ux-dropdown-item-gap);
      min-height: var(--ux-dropdown-item-height);
      padding: var(--ux-dropdown-item-padding);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      text-decoration: none;
      border-radius: var(--ux-border-radius);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease-ios);
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-dropdown__item:hover,
    .ux-dropdown__item:focus {
      background: var(--ux-surface-secondary);
      outline: none;
    }

    .ux-dropdown__item:active {
      background: var(--ux-surface-tertiary);
    }

    .ux-dropdown__item:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: -2px;
    }

    /* Item icon */
    .ux-dropdown__item-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      opacity: 0.7;
    }

    .ux-dropdown__item-icon svg {
      width: 100%;
      height: 100%;
    }

    /* Item text */
    .ux-dropdown__item-text {
      flex: 1;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Item shortcut */
    .ux-dropdown__item-shortcut {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      margin-left: auto;
      padding-left: var(--ux-space-md);
    }

    /* Item badge */
    .ux-dropdown__item-badge {
      font-size: var(--ux-font-size-xs);
      background: var(--ux-primary);
      color: white;
      padding: 2px 6px;
      border-radius: var(--ux-border-radius-pill);
      margin-left: auto;
    }

    /* Item check (for selectable items) */
    .ux-dropdown__item-check {
      width: 16px;
      height: 16px;
      margin-left: auto;
      opacity: 0;
      color: var(--ux-primary);
      transition: opacity var(--ux-transition-fast);
    }

    .ux-dropdown__item--selected .ux-dropdown__item-check {
      opacity: 1;
    }

    .ux-dropdown__item-check svg {
      width: 100%;
      height: 100%;
    }

    /* ==========================================================================
       Item Variants
       ========================================================================== */

    /* Danger item */
    .ux-dropdown__item--danger {
      color: var(--ux-danger);
    }

    .ux-dropdown__item--danger:hover,
    .ux-dropdown__item--danger:focus {
      background: rgba(var(--ux-danger-rgb), 0.1);
    }

    .ux-dropdown__item--danger .ux-dropdown__item-icon {
      opacity: 1;
    }

    /* Disabled item */
    .ux-dropdown__item--disabled,
    .ux-dropdown__item:disabled {
      opacity: 0.5;
      pointer-events: none;
      cursor: not-allowed;
    }

    /* Selected item */
    .ux-dropdown__item--selected {
      color: var(--ux-primary);
      font-weight: 500;
    }

    /* Active item (keyboard navigation) */
    .ux-dropdown__item--active {
      background: var(--ux-surface-secondary);
    }

    /* ==========================================================================
       Dropdown Divider
       ========================================================================== */

    .ux-dropdown__divider {
      height: 1px;
      background: var(--ux-border-color);
      margin: var(--ux-dropdown-divider-margin) 0;
    }

    /* ==========================================================================
       Dropdown Header
       ========================================================================== */

    .ux-dropdown__header {
      padding: var(--ux-dropdown-header-padding);
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ==========================================================================
       Dropdown Group
       ========================================================================== */

    .ux-dropdown__group {
      padding: var(--ux-space-xs) 0;
    }

    .ux-dropdown__group:first-child {
      padding-top: 0;
    }

    .ux-dropdown__group:last-child {
      padding-bottom: 0;
    }

    .ux-dropdown__group + .ux-dropdown__group {
      border-top: 1px solid var(--ux-border-color);
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-dropdown__menu--glass,
    .ux-dropdown--glass .ux-dropdown__menu {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-dropdown__menu--glass .ux-dropdown__item:hover,
    .ux-dropdown--glass .ux-dropdown__item:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .ux-dropdown__menu--glass .ux-dropdown__item:active,
    .ux-dropdown--glass .ux-dropdown__item:active {
      background: rgba(255, 255, 255, 0.25);
    }

    /* ==========================================================================
       Compact Variant
       ========================================================================== */

    .ux-dropdown__menu--compact {
      --ux-dropdown-item-height: 36px;
      --ux-dropdown-padding: 4px;
    }

    .ux-dropdown__menu--compact .ux-dropdown__item {
      font-size: var(--ux-font-size-sm);
    }

    /* ==========================================================================
       Wide Variant
       ========================================================================== */

    .ux-dropdown__menu--wide {
      --ux-dropdown-min-width: 240px;
    }

    .ux-dropdown__menu--full {
      width: 100%;
      max-width: none;
    }

    /* ==========================================================================
       Submenu
       ========================================================================== */

    .ux-dropdown__submenu {
      position: relative;
    }

    .ux-dropdown__submenu > .ux-dropdown__item::after {
      content: '';
      width: 16px;
      height: 16px;
      margin-left: auto;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpolyline points='9 18 15 12 9 6'%3E%3C/polyline%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.5;
    }

    .ux-dropdown__submenu .ux-dropdown__menu {
      left: 100%;
      top: 0;
      margin-left: var(--ux-space-xs);
      transform-origin: left top;
    }

    .ux-dropdown__submenu:hover > .ux-dropdown__menu {
      opacity: 1;
      visibility: visible;
      transform: scale(1) translateY(0);
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light) {
        --ux-dropdown-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      :root:not(.ux-light) .ux-dropdown__menu--glass .ux-dropdown__item:hover,
      :root:not(.ux-light) .ux-dropdown--glass .ux-dropdown__item:hover {
        background: rgba(255, 255, 255, 0.1);
      }
    }

    .ux-dark {
      --ux-dropdown-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .ux-dark .ux-dropdown__menu--glass .ux-dropdown__item:hover,
    .ux-dark .ux-dropdown--glass .ux-dropdown__item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-dropdown__menu {
        transition: opacity var(--ux-transition-fast), visibility var(--ux-transition-fast);
        transform: none !important;
      }

      .ux-dropdown--open .ux-dropdown__menu,
      .ux-dropdown__menu[data-show] {
        transform: none !important;
      }
    }

    /* ==========================================================================
       Mobile Styles
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-dropdown__menu {
        --ux-dropdown-item-height: 48px;
      }

      /* Full width on very small screens */
      .ux-dropdown--mobile-full .ux-dropdown__menu {
        position: fixed;
        left: var(--ux-space-md) !important;
        right: var(--ux-space-md) !important;
        bottom: var(--ux-space-md);
        top: auto !important;
        max-width: none;
        width: auto;
        border-radius: var(--ux-border-radius-xl);
        transform-origin: bottom center;
        transform: scale(0.95) translateY(20px);
      }

      .ux-dropdown--mobile-full.ux-dropdown--open .ux-dropdown__menu {
        transform: scale(1) translateY(0);
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-dropdown-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-dropdown-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const dropdownComponent = (config = {}) => ({
    isOpen: false,
    activeIndex: -1,
    items: [],

    // Config
    closeOnSelect: config.closeOnSelect !== false,
    closeOnClickOutside: config.closeOnClickOutside !== false,
    closeOnEscape: config.closeOnEscape !== false,
    triggerOnHover: config.triggerOnHover || false,
    hoverDelay: config.hoverDelay || 150,

    // Hover timer
    _hoverTimer: null,

    init() {
      // Get focusable items
      this.$nextTick(() => {
        this.items = Array.from(this.$el.querySelectorAll('.ux-dropdown__item:not(.ux-dropdown__item--disabled)'));
      });

      // Click outside handler
      if (this.closeOnClickOutside) {
        this._clickOutsideHandler = (e) => {
          if (this.isOpen && !this.$el.contains(e.target)) {
            this.close();
          }
        };
        document.addEventListener('click', this._clickOutsideHandler);
      }

      // Escape handler
      if (this.closeOnEscape) {
        this._escapeHandler = (e) => {
          if (this.isOpen && e.key === 'Escape') {
            this.close();
            this.focusTrigger();
          }
        };
        document.addEventListener('keydown', this._escapeHandler);
      }
    },

    destroy() {
      if (this._clickOutsideHandler) {
        document.removeEventListener('click', this._clickOutsideHandler);
      }
      if (this._escapeHandler) {
        document.removeEventListener('keydown', this._escapeHandler);
      }
      if (this._hoverTimer) {
        clearTimeout(this._hoverTimer);
      }
    },

    // Open dropdown
    open() {
      if (this.isOpen) return;

      this.isOpen = true;
      this.activeIndex = -1;

      // Refresh items list
      this.$nextTick(() => {
        this.items = Array.from(this.$el.querySelectorAll('.ux-dropdown__item:not(.ux-dropdown__item--disabled)'));
      });

      this.$dispatch('dropdown:open');
    },

    // Close dropdown
    close() {
      if (!this.isOpen) return;

      this.isOpen = false;
      this.activeIndex = -1;

      this.$dispatch('dropdown:close');
    },

    // Toggle dropdown
    toggle() {
      this.isOpen ? this.close() : this.open();
    },

    // Select an item
    select(value, closeAfter = this.closeOnSelect) {
      this.$dispatch('dropdown:select', { value });

      if (closeAfter) {
        this.close();
        this.focusTrigger();
      }
    },

    // Focus management
    focusTrigger() {
      const trigger = this.$el.querySelector('.ux-dropdown__trigger');
      if (trigger) trigger.focus();
    },

    focusItem(index) {
      if (index >= 0 && index < this.items.length) {
        this.activeIndex = index;
        this.items[index].focus();
      }
    },

    focusFirst() {
      this.focusItem(0);
    },

    focusLast() {
      this.focusItem(this.items.length - 1);
    },

    focusNext() {
      const nextIndex = this.activeIndex < this.items.length - 1 ? this.activeIndex + 1 : 0;
      this.focusItem(nextIndex);
    },

    focusPrev() {
      const prevIndex = this.activeIndex > 0 ? this.activeIndex - 1 : this.items.length - 1;
      this.focusItem(prevIndex);
    },

    // Keyboard navigation
    handleKeydown(e) {
      switch (e.key) {
        case 'ArrowDown':
          e.preventDefault();
          if (!this.isOpen) {
            this.open();
            this.$nextTick(() => this.focusFirst());
          } else {
            this.focusNext();
          }
          break;

        case 'ArrowUp':
          e.preventDefault();
          if (!this.isOpen) {
            this.open();
            this.$nextTick(() => this.focusLast());
          } else {
            this.focusPrev();
          }
          break;

        case 'Home':
          if (this.isOpen) {
            e.preventDefault();
            this.focusFirst();
          }
          break;

        case 'End':
          if (this.isOpen) {
            e.preventDefault();
            this.focusLast();
          }
          break;

        case 'Enter':
        case ' ':
          if (this.isOpen && this.activeIndex >= 0) {
            e.preventDefault();
            this.items[this.activeIndex].click();
          } else if (!this.isOpen) {
            e.preventDefault();
            this.open();
          }
          break;

        case 'Tab':
          if (this.isOpen) {
            this.close();
          }
          break;
      }
    },

    // Hover handlers (for hover-triggered dropdowns)
    handleMouseEnter() {
      if (!this.triggerOnHover) return;

      if (this._hoverTimer) {
        clearTimeout(this._hoverTimer);
      }

      this._hoverTimer = setTimeout(() => {
        this.open();
      }, this.hoverDelay);
    },

    handleMouseLeave() {
      if (!this.triggerOnHover) return;

      if (this._hoverTimer) {
        clearTimeout(this._hoverTimer);
      }

      this._hoverTimer = setTimeout(() => {
        this.close();
      }, this.hoverDelay);
    },

    // ARIA attributes for trigger
    get triggerAttrs() {
      return {
        'aria-haspopup': 'true',
        'aria-expanded': this.isOpen.toString()
      };
    },

    // Container classes
    get containerClasses() {
      return {
        'ux-dropdown--open': this.isOpen
      };
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxDropdown', dropdownComponent);
  }

})();

/**
 * UX Electron - Electron Desktop Integration
 * Native menus, window controls, IPC communication, and desktop features
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Electron Styles
    ======================================== */

    /* Traffic light buttons (macOS style) */
    .ux-electron-traffic {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 var(--ux-space-md);
      height: 100%;
      -webkit-app-region: no-drag;
    }

    .ux-electron-traffic__btn {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      transition: opacity 0.15s ease;
      position: relative;
    }

    .ux-electron-traffic__btn:hover {
      opacity: 0.8;
    }

    .ux-electron-traffic__btn--close {
      background: #ff5f57;
    }

    .ux-electron-traffic__btn--minimize {
      background: #febc2e;
    }

    .ux-electron-traffic__btn--maximize {
      background: #28c840;
    }

    /* Show icons on hover */
    .ux-electron-traffic:hover .ux-electron-traffic__btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 8px;
      height: 8px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    .ux-electron-traffic:hover .ux-electron-traffic__btn--close::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 10'%3E%3Cpath d='M1 1l8 8M9 1L1 9' stroke='%23730a00' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    .ux-electron-traffic:hover .ux-electron-traffic__btn--minimize::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 10'%3E%3Cpath d='M1 5h8' stroke='%23985700' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    .ux-electron-traffic:hover .ux-electron-traffic__btn--maximize::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 10'%3E%3Cpath d='M1 1h8v8H1z' stroke='%23006400' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");
    }

    /* Windows style controls */
    .ux-electron-controls {
      display: flex;
      align-items: stretch;
      height: 100%;
      -webkit-app-region: no-drag;
    }

    .ux-electron-controls__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 46px;
      height: 100%;
      border: none;
      background: transparent;
      color: var(--ux-text);
      cursor: pointer;
      transition: background-color 0.1s ease;
    }

    .ux-electron-controls__btn:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-electron-controls__btn--close:hover {
      background: #e81123;
      color: white;
    }

    .ux-electron-controls__btn svg {
      width: 10px;
      height: 10px;
    }

    /* Titlebar */
    .ux-electron-titlebar {
      display: flex;
      align-items: center;
      height: 32px;
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      -webkit-app-region: drag;
      user-select: none;
    }

    .ux-electron-titlebar--macos {
      padding-left: 78px; /* Space for traffic lights */
    }

    .ux-electron-titlebar__title {
      flex: 1;
      text-align: center;
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-electron-titlebar__menu {
      display: flex;
      -webkit-app-region: no-drag;
    }

    .ux-electron-titlebar__menu-item {
      padding: 0 var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      cursor: pointer;
      transition: background-color 0.1s ease;
    }

    .ux-electron-titlebar__menu-item:hover {
      background: var(--ux-surface-secondary);
    }

    /* Frameless window body adjustment */
    .ux-electron-frameless {
      padding-top: 32px;
    }

    .ux-electron-frameless .ux-electron-titlebar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: var(--ux-z-fixed);
    }

    /* Native context menu indicator */
    .ux-electron-context-menu {
      cursor: context-menu;
    }

    /* Drag and drop zones */
    .ux-electron-drop-zone {
      position: relative;
      transition: background-color 0.2s ease, border-color 0.2s ease;
    }

    .ux-electron-drop-zone--active {
      background: var(--ux-primary-soft);
      border-color: var(--ux-primary);
    }

    .ux-electron-drop-zone--active::after {
      content: 'Drop files here';
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(var(--ux-primary-rgb), 0.1);
      border: 2px dashed var(--ux-primary);
      border-radius: inherit;
      font-weight: 500;
      color: var(--ux-primary);
    }

    /* Update indicator */
    .ux-electron-update {
      position: fixed;
      bottom: var(--ux-space-lg);
      right: var(--ux-space-lg);
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background: var(--ux-primary);
      color: white;
      border-radius: var(--ux-border-radius-lg);
      box-shadow: var(--ux-shadow-lg);
      z-index: var(--ux-z-toast);
      transform: translateY(calc(100% + var(--ux-space-xl)));
      transition: transform 0.3s ease;
    }

    .ux-electron-update--visible {
      transform: translateY(0);
    }

    .ux-electron-update__text {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
    }

    .ux-electron-update__btn {
      padding: var(--ux-space-xs) var(--ux-space-md);
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: var(--ux-border-radius);
      color: white;
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .ux-electron-update__btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Glass titlebar */
    .ux-electron-titlebar--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
      .ux-electron-titlebar {
        background: var(--ux-surface);
      }

      .ux-electron-controls__btn {
        color: var(--ux-text);
      }
    }

    .ux-dark .ux-electron-titlebar {
      background: var(--ux-surface);
    }

    .ux-dark .ux-electron-controls__btn {
      color: var(--ux-text);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-electron-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-electron-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  /**
   * Electron detection and IPC wrapper
   */
  const UXElectron = {
    // Is running in Electron
    isElectron: false,

    // Platform
    platform: null,

    // IPC renderer (if available)
    ipc: null,

    // Window state
    windowState: {
      isMaximized: false,
      isFullscreen: false,
      isFocused: true
    },

    // Update state
    updateState: {
      available: false,
      downloaded: false,
      version: null,
      releaseNotes: null
    },

    // Callbacks
    callbacks: {
      ready: [],
      maximize: [],
      unmaximize: [],
      focus: [],
      blur: [],
      updateAvailable: [],
      updateDownloaded: []
    },

    /**
     * Initialize Electron integration
     */
    init() {
      // Detect Electron
      this.isElectron = !!(
        typeof window !== 'undefined' &&
        window.process &&
        window.process.type === 'renderer'
      );

      // Alternative detection via user agent
      if (!this.isElectron) {
        this.isElectron = /electron/i.test(navigator.userAgent);
      }

      // Check for preload exposed API
      if (window.electronAPI) {
        this.ipc = window.electronAPI;
      } else if (window.electron) {
        this.ipc = window.electron;
      }

      if (this.isElectron) {
        this.detectPlatform();
        this.setupListeners();
        console.log('UX Electron initialized:', this.platform);
      }

      return this.isElectron;
    },

    /**
     * Detect platform
     */
    detectPlatform() {
      if (navigator.platform.includes('Mac')) {
        this.platform = 'darwin';
      } else if (navigator.platform.includes('Win')) {
        this.platform = 'win32';
      } else {
        this.platform = 'linux';
      }
    },

    /**
     * Setup IPC listeners
     */
    setupListeners() {
      if (!this.ipc) return;

      // Window state listeners
      if (this.ipc.onMaximize) {
        this.ipc.onMaximize(() => {
          this.windowState.isMaximized = true;
          this.callbacks.maximize.forEach(cb => cb());
        });
      }

      if (this.ipc.onUnmaximize) {
        this.ipc.onUnmaximize(() => {
          this.windowState.isMaximized = false;
          this.callbacks.unmaximize.forEach(cb => cb());
        });
      }

      if (this.ipc.onFocus) {
        this.ipc.onFocus(() => {
          this.windowState.isFocused = true;
          this.callbacks.focus.forEach(cb => cb());
        });
      }

      if (this.ipc.onBlur) {
        this.ipc.onBlur(() => {
          this.windowState.isFocused = false;
          this.callbacks.blur.forEach(cb => cb());
        });
      }

      // Auto-update listeners
      if (this.ipc.onUpdateAvailable) {
        this.ipc.onUpdateAvailable((info) => {
          this.updateState.available = true;
          this.updateState.version = info?.version;
          this.updateState.releaseNotes = info?.releaseNotes;
          this.callbacks.updateAvailable.forEach(cb => cb(info));
        });
      }

      if (this.ipc.onUpdateDownloaded) {
        this.ipc.onUpdateDownloaded((info) => {
          this.updateState.downloaded = true;
          this.callbacks.updateDownloaded.forEach(cb => cb(info));
        });
      }
    },

    /**
     * Window control methods
     */
    minimize() {
      if (this.ipc?.minimize) {
        this.ipc.minimize();
      }
    },

    maximize() {
      if (this.ipc?.maximize) {
        this.ipc.maximize();
      }
    },

    unmaximize() {
      if (this.ipc?.unmaximize) {
        this.ipc.unmaximize();
      }
    },

    toggleMaximize() {
      if (this.windowState.isMaximized) {
        this.unmaximize();
      } else {
        this.maximize();
      }
    },

    close() {
      if (this.ipc?.close) {
        this.ipc.close();
      }
    },

    setFullscreen(fullscreen) {
      if (this.ipc?.setFullscreen) {
        this.ipc.setFullscreen(fullscreen);
        this.windowState.isFullscreen = fullscreen;
      }
    },

    toggleFullscreen() {
      this.setFullscreen(!this.windowState.isFullscreen);
    },

    /**
     * App methods
     */
    getVersion() {
      return this.ipc?.getVersion?.() || null;
    },

    getPath(name) {
      return this.ipc?.getPath?.(name) || null;
    },

    openExternal(url) {
      if (this.ipc?.openExternal) {
        this.ipc.openExternal(url);
      } else {
        window.open(url, '_blank');
      }
    },

    showItemInFolder(path) {
      if (this.ipc?.showItemInFolder) {
        this.ipc.showItemInFolder(path);
      }
    },

    /**
     * Dialog methods
     */
    async showOpenDialog(options = {}) {
      if (this.ipc?.showOpenDialog) {
        return await this.ipc.showOpenDialog(options);
      }
      return null;
    },

    async showSaveDialog(options = {}) {
      if (this.ipc?.showSaveDialog) {
        return await this.ipc.showSaveDialog(options);
      }
      return null;
    },

    async showMessageBox(options = {}) {
      if (this.ipc?.showMessageBox) {
        return await this.ipc.showMessageBox(options);
      }
      // Fallback to web dialog
      if (options.type === 'question' && options.buttons) {
        const result = window.confirm(options.message);
        return { response: result ? 0 : 1 };
      }
      window.alert(options.message);
      return { response: 0 };
    },

    /**
     * Notification
     */
    showNotification(title, body, options = {}) {
      if (this.ipc?.showNotification) {
        this.ipc.showNotification({ title, body, ...options });
      } else if ('Notification' in window && Notification.permission === 'granted') {
        new Notification(title, { body, ...options });
      }
    },

    /**
     * Auto-update methods
     */
    checkForUpdates() {
      if (this.ipc?.checkForUpdates) {
        this.ipc.checkForUpdates();
      }
    },

    downloadUpdate() {
      if (this.ipc?.downloadUpdate) {
        this.ipc.downloadUpdate();
      }
    },

    installUpdate() {
      if (this.ipc?.quitAndInstall) {
        this.ipc.quitAndInstall();
      }
    },

    /**
     * Menu methods
     */
    setApplicationMenu(template) {
      if (this.ipc?.setApplicationMenu) {
        this.ipc.setApplicationMenu(template);
      }
    },

    showContextMenu(template, options = {}) {
      if (this.ipc?.showContextMenu) {
        this.ipc.showContextMenu(template, options);
      }
    },

    /**
     * Store (electron-store)
     */
    async storeGet(key) {
      if (this.ipc?.storeGet) {
        return await this.ipc.storeGet(key);
      }
      return localStorage.getItem(key);
    },

    async storeSet(key, value) {
      if (this.ipc?.storeSet) {
        return await this.ipc.storeSet(key, value);
      }
      localStorage.setItem(key, JSON.stringify(value));
    },

    async storeDelete(key) {
      if (this.ipc?.storeDelete) {
        return await this.ipc.storeDelete(key);
      }
      localStorage.removeItem(key);
    },

    /**
     * Event listeners
     */
    on(event, callback) {
      if (this.callbacks[event]) {
        this.callbacks[event].push(callback);
      }
      return () => this.off(event, callback);
    },

    off(event, callback) {
      if (this.callbacks[event]) {
        const idx = this.callbacks[event].indexOf(callback);
        if (idx > -1) this.callbacks[event].splice(idx, 1);
      }
    },

    /**
     * Send IPC message
     */
    send(channel, ...args) {
      if (this.ipc?.send) {
        this.ipc.send(channel, ...args);
      }
    },

    /**
     * Invoke IPC (async)
     */
    async invoke(channel, ...args) {
      if (this.ipc?.invoke) {
        return await this.ipc.invoke(channel, ...args);
      }
      return null;
    }
  };

  /**
   * Alpine.js component for Electron integration
   */
  const electronComponent = (config = {}) => ({
    // State
    isElectron: UXElectron.isElectron,
    platform: UXElectron.platform,
    isMaximized: false,
    isFocused: true,
    updateAvailable: false,
    updateDownloaded: false,
    updateVersion: null,
    showUpdateBanner: false,

    // Config
    showTrafficLights: config.showTrafficLights ?? true,
    showWindowControls: config.showWindowControls ?? true,
    customTitlebar: config.customTitlebar ?? false,
    title: config.title || document.title,

    init() {
      if (!UXElectron.isElectron) {
        UXElectron.init();
        this.isElectron = UXElectron.isElectron;
        this.platform = UXElectron.platform;
      }

      if (!this.isElectron) return;

      // Sync state
      this.isMaximized = UXElectron.windowState.isMaximized;
      this.isFocused = UXElectron.windowState.isFocused;

      // Listen to window events
      UXElectron.on('maximize', () => {
        this.isMaximized = true;
      });

      UXElectron.on('unmaximize', () => {
        this.isMaximized = false;
      });

      UXElectron.on('focus', () => {
        this.isFocused = true;
      });

      UXElectron.on('blur', () => {
        this.isFocused = false;
      });

      // Listen to update events
      UXElectron.on('updateAvailable', (info) => {
        this.updateAvailable = true;
        this.updateVersion = info?.version;
        if (config.autoShowUpdate !== false) {
          this.showUpdateBanner = true;
        }
        this.$dispatch('electron-update-available', info);
      });

      UXElectron.on('updateDownloaded', (info) => {
        this.updateDownloaded = true;
        this.showUpdateBanner = true;
        this.$dispatch('electron-update-downloaded', info);
      });

      // Add frameless class if custom titlebar
      if (this.customTitlebar) {
        document.body.classList.add('ux-electron-frameless');
      }
    },

    // Window controls
    minimize: () => UXElectron.minimize(),
    maximize: () => UXElectron.maximize(),
    unmaximize: () => UXElectron.unmaximize(),
    toggleMaximize: () => UXElectron.toggleMaximize(),
    close: () => UXElectron.close(),
    toggleFullscreen: () => UXElectron.toggleFullscreen(),

    // Update controls
    checkForUpdates: () => UXElectron.checkForUpdates(),
    downloadUpdate: () => UXElectron.downloadUpdate(),
    installUpdate: () => UXElectron.installUpdate(),
    dismissUpdate() {
      this.showUpdateBanner = false;
    },

    // Helpers
    isMac() {
      return this.platform === 'darwin';
    },

    isWindows() {
      return this.platform === 'win32';
    },

    isLinux() {
      return this.platform === 'linux';
    },

    openExternal(url) {
      UXElectron.openExternal(url);
    },

    async openFile(options = {}) {
      return await UXElectron.showOpenDialog(options);
    },

    async saveFile(options = {}) {
      return await UXElectron.showSaveDialog(options);
    },

    async confirm(message, title = 'Confirm') {
      const result = await UXElectron.showMessageBox({
        type: 'question',
        buttons: ['Yes', 'No'],
        defaultId: 0,
        title: title,
        message: message
      });
      return result.response === 0;
    },

    notify(title, body) {
      UXElectron.showNotification(title, body);
    }
  });

  // Register Alpine component
  if (window.UX) {
    window.UX.registerComponent('uxElectron', electronComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxElectron', electronComponent);
    });
  }

  // Export to window
  window.UXElectron = UXElectron;

  // Auto-init
  UXElectron.init();

})();

/**
 * UX Employee Card Component
 * Employee cards for directories, team pages, and HR applications
 * CSS-only component that composes ux-avatar, ux-badge, ux-status-indicator, ux-button
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Employee Card
    ======================================== */

    :root {
      --ux-employee-card-radius: var(--ux-border-radius-lg);
      --ux-employee-card-padding: var(--ux-space-md);
      --ux-employee-card-gap: var(--ux-space-sm);
      --ux-employee-card-avatar-size: 64px;
      --ux-employee-card-avatar-size-compact: 40px;
    }

    .ux-employee-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-employee-card-gap);
      padding: var(--ux-employee-card-padding);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-employee-card-radius);
      text-align: center;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-employee-card:hover {
      box-shadow: var(--ux-shadow-md);
    }

    /* Clickable variant */
    .ux-employee-card--clickable {
      cursor: pointer;
    }

    .ux-employee-card--clickable:hover {
      border-color: var(--ux-primary);
    }

    .ux-employee-card--clickable:active {
      transform: scale(0.98);
    }

    /* Selected state */
    .ux-employee-card--selected {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 2px rgba(var(--ux-primary-rgb), 0.2);
    }

    /* ========================================
       Avatar Section
    ======================================== */

    .ux-employee-card__avatar {
      position: relative;
      width: var(--ux-employee-card-avatar-size);
      height: var(--ux-employee-card-avatar-size);
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
      background-color: var(--ux-medium);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--ux-font-size-xl);
      font-weight: 600;
      color: var(--ux-medium-contrast);
      text-transform: uppercase;
    }

    .ux-employee-card__avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .ux-employee-card__avatar--primary { background-color: var(--ux-primary); color: var(--ux-primary-contrast); }
    .ux-employee-card__avatar--secondary { background-color: var(--ux-secondary); color: var(--ux-secondary-contrast); }
    .ux-employee-card__avatar--tertiary { background-color: var(--ux-tertiary); color: var(--ux-tertiary-contrast); }
    .ux-employee-card__avatar--success { background-color: var(--ux-success); color: var(--ux-success-contrast); }
    .ux-employee-card__avatar--warning { background-color: var(--ux-warning); color: var(--ux-warning-contrast); }
    .ux-employee-card__avatar--danger { background-color: var(--ux-danger); color: var(--ux-danger-contrast); }

    /* ========================================
       Status Indicator (positioned on avatar)
    ======================================== */

    .ux-employee-card__status {
      position: absolute;
      bottom: 2px;
      right: 2px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 2px solid var(--ux-surface);
      background-color: var(--ux-gray-400);
    }

    .ux-employee-card__status--available,
    .ux-employee-card__status--online {
      background-color: var(--ux-success);
    }

    .ux-employee-card__status--busy,
    .ux-employee-card__status--dnd {
      background-color: var(--ux-danger);
    }

    .ux-employee-card__status--away,
    .ux-employee-card__status--idle {
      background-color: var(--ux-warning);
    }

    .ux-employee-card__status--offline {
      background-color: var(--ux-gray-400);
    }

    /* Pulse animation for available status */
    .ux-employee-card__status--pulse {
      animation: ux-employee-status-pulse 2s ease-in-out infinite;
    }

    @keyframes ux-employee-status-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* ========================================
       Info Section
    ======================================== */

    .ux-employee-card__info {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
      width: 100%;
    }

    .ux-employee-card__name {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      line-height: 1.3;
      margin: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-employee-card__title {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      line-height: 1.3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ========================================
       Department Badge
    ======================================== */

    .ux-employee-card__department {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px var(--ux-space-sm);
      background-color: rgba(var(--ux-primary-rgb), 0.1);
      color: var(--ux-primary);
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      border-radius: var(--ux-border-radius-full);
      margin-top: var(--ux-space-xs);
    }

    .ux-employee-card__department--engineering { background-color: rgba(var(--ux-blue-500-rgb, 59, 130, 246), 0.1); color: var(--ux-blue-600, #2563eb); }
    .ux-employee-card__department--design { background-color: rgba(var(--ux-purple-500-rgb, 168, 85, 247), 0.1); color: var(--ux-purple-600, #9333ea); }
    .ux-employee-card__department--marketing { background-color: rgba(var(--ux-rose-500-rgb, 244, 63, 94), 0.1); color: var(--ux-rose-600, #e11d48); }
    .ux-employee-card__department--sales { background-color: rgba(var(--ux-green-500-rgb, 34, 197, 94), 0.1); color: var(--ux-green-600, #16a34a); }
    .ux-employee-card__department--hr { background-color: rgba(var(--ux-amber-500-rgb, 245, 158, 11), 0.1); color: var(--ux-amber-600, #d97706); }
    .ux-employee-card__department--finance { background-color: rgba(var(--ux-cyan-500-rgb, 6, 182, 212), 0.1); color: var(--ux-cyan-600, #0891b2); }
    .ux-employee-card__department--operations { background-color: rgba(var(--ux-gray-500-rgb, 107, 114, 128), 0.1); color: var(--ux-gray-600, #4b5563); }
    .ux-employee-card__department--support { background-color: rgba(var(--ux-teal-500-rgb, 20, 184, 166), 0.1); color: var(--ux-teal-600, #0d9488); }

    /* ========================================
       Contact Info
    ======================================== */

    .ux-employee-card__contact {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
      width: 100%;
      margin-top: var(--ux-space-xs);
      padding-top: var(--ux-space-sm);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-employee-card__contact-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      text-decoration: none;
      transition: color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-employee-card__contact-item:hover {
      color: var(--ux-primary);
    }

    .ux-employee-card__contact-item svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
      opacity: 0.7;
    }

    .ux-employee-card__contact-text {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ========================================
       Actions
    ======================================== */

    .ux-employee-card__actions {
      display: flex;
      gap: var(--ux-space-xs);
      margin-top: var(--ux-space-sm);
      width: 100%;
      justify-content: center;
    }

    .ux-employee-card__action {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border: 1px solid var(--ux-border-color);
      border-radius: 50%;
      background-color: var(--ux-surface);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-employee-card__action:hover {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-employee-card__action:active {
      transform: scale(0.95);
    }

    .ux-employee-card__action svg {
      width: 18px;
      height: 18px;
    }

    .ux-employee-card__action--call:hover { background-color: var(--ux-success); border-color: var(--ux-success); }
    .ux-employee-card__action--email:hover { background-color: var(--ux-primary); border-color: var(--ux-primary); }
    .ux-employee-card__action--chat:hover { background-color: var(--ux-tertiary); border-color: var(--ux-tertiary); }

    /* ========================================
       Compact Variant
    ======================================== */

    .ux-employee-card--compact {
      flex-direction: row;
      text-align: left;
      padding: var(--ux-space-sm);
    }

    .ux-employee-card--compact .ux-employee-card__avatar {
      width: var(--ux-employee-card-avatar-size-compact);
      height: var(--ux-employee-card-avatar-size-compact);
      font-size: var(--ux-font-size-md);
    }

    .ux-employee-card--compact .ux-employee-card__status {
      width: 10px;
      height: 10px;
      bottom: 0;
      right: 0;
    }

    .ux-employee-card--compact .ux-employee-card__info {
      flex: 1;
      align-items: flex-start;
    }

    .ux-employee-card--compact .ux-employee-card__name {
      font-size: var(--ux-font-size-sm);
    }

    .ux-employee-card--compact .ux-employee-card__title {
      font-size: var(--ux-font-size-xs);
    }

    .ux-employee-card--compact .ux-employee-card__department {
      margin-top: 2px;
      padding: 1px var(--ux-space-xs);
      font-size: 10px;
    }

    .ux-employee-card--compact .ux-employee-card__contact {
      display: none;
    }

    .ux-employee-card--compact .ux-employee-card__actions {
      margin-top: 0;
      width: auto;
      flex-shrink: 0;
    }

    .ux-employee-card--compact .ux-employee-card__action {
      width: 32px;
      height: 32px;
    }

    .ux-employee-card--compact .ux-employee-card__action svg {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Horizontal Layout
    ======================================== */

    .ux-employee-card--horizontal {
      flex-direction: row;
      text-align: left;
      align-items: flex-start;
    }

    .ux-employee-card--horizontal .ux-employee-card__info {
      flex: 1;
      align-items: flex-start;
    }

    .ux-employee-card--horizontal .ux-employee-card__contact {
      flex-direction: row;
      flex-wrap: wrap;
      border-top: none;
      padding-top: 0;
      margin-top: var(--ux-space-sm);
    }

    .ux-employee-card--horizontal .ux-employee-card__actions {
      flex-direction: column;
      width: auto;
      margin-top: 0;
      margin-left: var(--ux-space-md);
    }

    /* ========================================
       Employee Grid
    ======================================== */

    .ux-employee-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: var(--ux-space-md);
    }

    .ux-employee-grid--2 { grid-template-columns: repeat(2, 1fr); }
    .ux-employee-grid--3 { grid-template-columns: repeat(3, 1fr); }
    .ux-employee-grid--4 { grid-template-columns: repeat(4, 1fr); }
    .ux-employee-grid--5 { grid-template-columns: repeat(5, 1fr); }

    .ux-employee-grid--compact {
      gap: var(--ux-space-sm);
    }

    /* Responsive grid */
    @media (max-width: 991px) {
      .ux-employee-grid--4,
      .ux-employee-grid--5 {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 767px) {
      .ux-employee-grid--3,
      .ux-employee-grid--4,
      .ux-employee-grid--5 {
        grid-template-columns: repeat(2, 1fr);
      }

      .ux-employee-grid {
        gap: var(--ux-space-sm);
      }
    }

    @media (max-width: 480px) {
      .ux-employee-grid,
      .ux-employee-grid--2,
      .ux-employee-grid--3,
      .ux-employee-grid--4,
      .ux-employee-grid--5 {
        grid-template-columns: 1fr;
      }
    }

    /* ========================================
       Employee List (for compact cards)
    ======================================== */

    .ux-employee-list {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
    }

    .ux-employee-list .ux-employee-card--compact {
      border-radius: var(--ux-border-radius);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-employee-card--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-employee-card--glass .ux-employee-card__status {
      border-color: var(--ux-glass-bg);
    }

    .ux-employee-card--glass .ux-employee-card__contact {
      border-color: var(--ux-glass-border);
    }

    .ux-employee-card--glass .ux-employee-card__action {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-employee-card {
        background-color: var(--ux-surface);
        border-color: var(--ux-border-color);
      }

      .ux-employee-card__status {
        border-color: var(--ux-surface);
      }

      .ux-employee-card__department {
        background-color: rgba(var(--ux-primary-rgb), 0.15);
      }
    }

    .ux-dark .ux-employee-card {
      background-color: var(--ux-surface);
      border-color: var(--ux-border-color);
    }

    .ux-dark .ux-employee-card__status {
      border-color: var(--ux-surface);
    }

    .ux-dark .ux-employee-card__department {
      background-color: rgba(var(--ux-primary-rgb), 0.15);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-employee-card,
      .ux-employee-card__action,
      .ux-employee-card__contact-item {
        transition: none;
      }

      .ux-employee-card__status--pulse {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-employee-card-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-employee-card-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }
})();

/**
 * UX Event Card Component
 * Cards para mostrar eventos de calendario con detalles, asistentes y acciones
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Event Card
    ======================================== */

    .ux-event-card {
      position: relative;
      display: flex;
      flex-direction: column;
      background-color: var(--ux-surface);
      border-radius: var(--ux-card-border-radius);
      box-shadow: var(--ux-shadow-sm);
      overflow: hidden;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-event-card:hover {
      box-shadow: var(--ux-shadow-md);
    }

    /* ========================================
       Category Color Bar (left border)
    ======================================== */

    .ux-event-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background-color: var(--ux-event-category-color, var(--ux-primary));
      border-radius: var(--ux-card-border-radius) 0 0 var(--ux-card-border-radius);
    }

    /* Category Colors */
    .ux-event-card--work { --ux-event-category-color: var(--ux-blue-500); }
    .ux-event-card--personal { --ux-event-category-color: var(--ux-green-500); }
    .ux-event-card--meeting { --ux-event-category-color: var(--ux-purple-500); }
    .ux-event-card--deadline { --ux-event-category-color: var(--ux-red-500); }
    .ux-event-card--reminder { --ux-event-category-color: var(--ux-yellow-500); }
    .ux-event-card--holiday { --ux-event-category-color: var(--ux-orange-500); }
    .ux-event-card--travel { --ux-event-category-color: var(--ux-cyan-500); }
    .ux-event-card--health { --ux-event-category-color: var(--ux-rose-500); }
    .ux-event-card--social { --ux-event-category-color: var(--ux-indigo-500); }
    .ux-event-card--other { --ux-event-category-color: var(--ux-gray-500); }

    /* ========================================
       Event Card Header
    ======================================== */

    .ux-event-card__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      padding: var(--ux-space-md) var(--ux-space-md) var(--ux-space-sm);
      padding-left: calc(var(--ux-space-md) + 8px); /* Account for color bar */
      gap: var(--ux-space-sm);
    }

    .ux-event-card__header-content {
      flex: 1;
      min-width: 0;
    }

    .ux-event-card__header-actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      flex-shrink: 0;
    }

    /* ========================================
       Event Title
    ======================================== */

    .ux-event-card__title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      line-height: 1.3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-event-card__title a {
      color: inherit;
      text-decoration: none;
    }

    .ux-event-card__title a:hover {
      color: var(--ux-primary);
    }

    /* ========================================
       Event Description
    ======================================== */

    .ux-event-card__description {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: var(--ux-space-xs) 0 0;
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    /* ========================================
       Event Content (details area)
    ======================================== */

    .ux-event-card__content {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
      padding: 0 var(--ux-space-md) var(--ux-space-md);
      padding-left: calc(var(--ux-space-md) + 8px);
    }

    /* ========================================
       Event Meta Row (time, duration, location)
    ======================================== */

    .ux-event-card__meta {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-event-card__meta-item {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-event-card__meta-item svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
      opacity: 0.7;
    }

    /* ========================================
       Time Display
    ======================================== */

    .ux-event-card__time {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-event-card__time svg {
      width: 16px;
      height: 16px;
      color: var(--ux-event-category-color, var(--ux-primary));
    }

    .ux-event-card__time-range {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-event-card__time-separator {
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Duration Badge
    ======================================== */

    .ux-event-card__duration {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: 2px 8px;
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text-secondary);
      border-radius: var(--ux-radius-full);
    }

    .ux-event-card__duration svg {
      width: 12px;
      height: 12px;
    }

    /* ========================================
       Location
    ======================================== */

    .ux-event-card__location {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      color: var(--ux-text-secondary);
      font-size: var(--ux-font-size-sm);
    }

    .ux-event-card__location svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
      color: var(--ux-text-tertiary);
    }

    .ux-event-card__location a {
      color: var(--ux-primary);
      text-decoration: none;
    }

    .ux-event-card__location a:hover {
      text-decoration: underline;
    }

    /* ========================================
       Attendees (Avatar Stack)
    ======================================== */

    .ux-event-card__attendees {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-event-card__attendees-stack {
      display: flex;
      flex-direction: row-reverse;
    }

    .ux-event-card__attendees-stack .ux-avatar {
      width: 28px;
      height: 28px;
      font-size: 10px;
      margin-left: -8px;
      border: 2px solid var(--ux-surface);
      box-sizing: content-box;
    }

    .ux-event-card__attendees-stack .ux-avatar:last-child {
      margin-left: 0;
    }

    .ux-event-card__attendees-more {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      margin-left: -8px;
      font-size: 10px;
      font-weight: 600;
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text-secondary);
      border-radius: 50%;
      border: 2px solid var(--ux-surface);
      box-sizing: content-box;
    }

    .ux-event-card__attendees-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Category Tag
    ======================================== */

    .ux-event-card__category {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: 2px 8px;
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      background-color: rgba(var(--ux-event-category-color-rgb, var(--ux-primary-rgb)), 0.12);
      color: var(--ux-event-category-color, var(--ux-primary));
      border-radius: var(--ux-radius-full);
    }

    .ux-event-card__category::before {
      content: '';
      width: 6px;
      height: 6px;
      background-color: var(--ux-event-category-color, var(--ux-primary));
      border-radius: 50%;
    }

    /* Category tag colors */
    .ux-event-card--work .ux-event-card__category {
      background-color: rgba(59, 130, 246, 0.12);
      color: var(--ux-blue-600);
    }
    .ux-event-card--personal .ux-event-card__category {
      background-color: rgba(34, 197, 94, 0.12);
      color: var(--ux-green-600);
    }
    .ux-event-card--meeting .ux-event-card__category {
      background-color: rgba(168, 85, 247, 0.12);
      color: var(--ux-purple-600);
    }
    .ux-event-card--deadline .ux-event-card__category {
      background-color: rgba(239, 68, 68, 0.12);
      color: var(--ux-red-600);
    }
    .ux-event-card--reminder .ux-event-card__category {
      background-color: rgba(234, 179, 8, 0.12);
      color: var(--ux-yellow-600);
    }
    .ux-event-card--holiday .ux-event-card__category {
      background-color: rgba(249, 115, 22, 0.12);
      color: var(--ux-orange-600);
    }
    .ux-event-card--travel .ux-event-card__category {
      background-color: rgba(6, 182, 212, 0.12);
      color: var(--ux-cyan-600);
    }
    .ux-event-card--health .ux-event-card__category {
      background-color: rgba(244, 63, 94, 0.12);
      color: var(--ux-rose-600);
    }
    .ux-event-card--social .ux-event-card__category {
      background-color: rgba(99, 102, 241, 0.12);
      color: var(--ux-indigo-600);
    }
    .ux-event-card--other .ux-event-card__category {
      background-color: rgba(107, 114, 128, 0.12);
      color: var(--ux-gray-600);
    }

    /* ========================================
       Indicators (Reminder, Recurring)
    ======================================== */

    .ux-event-card__indicators {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-event-card__indicator {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text-tertiary);
    }

    .ux-event-card__indicator svg {
      width: 12px;
      height: 12px;
    }

    .ux-event-card__indicator--reminder {
      background-color: rgba(234, 179, 8, 0.15);
      color: var(--ux-yellow-600);
    }

    .ux-event-card__indicator--recurring {
      background-color: rgba(59, 130, 246, 0.15);
      color: var(--ux-blue-600);
    }

    /* ========================================
       Footer (Actions)
    ======================================== */

    .ux-event-card__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm) var(--ux-space-md);
      padding-left: calc(var(--ux-space-md) + 8px);
      border-top: 1px solid var(--ux-border-color);
      gap: var(--ux-space-sm);
    }

    .ux-event-card__footer-start,
    .ux-event-card__footer-end {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-event-card__footer-end {
      margin-left: auto;
    }

    /* ========================================
       RSVP Status
    ======================================== */

    .ux-event-card__rsvp {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: 4px 10px;
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      border-radius: var(--ux-radius-full);
    }

    .ux-event-card__rsvp--going {
      background-color: rgba(34, 197, 94, 0.12);
      color: var(--ux-green-600);
    }

    .ux-event-card__rsvp--maybe {
      background-color: rgba(234, 179, 8, 0.12);
      color: var(--ux-yellow-600);
    }

    .ux-event-card__rsvp--declined {
      background-color: rgba(239, 68, 68, 0.12);
      color: var(--ux-red-600);
    }

    .ux-event-card__rsvp--pending {
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text-secondary);
    }

    .ux-event-card__rsvp svg {
      width: 14px;
      height: 14px;
    }

    /* ========================================
       Compact Variant (for calendar cells)
    ======================================== */

    .ux-event-card--compact {
      flex-direction: row;
      align-items: center;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      padding-left: calc(var(--ux-space-sm) + 6px);
      gap: var(--ux-space-sm);
      min-height: 32px;
      box-shadow: none;
      border: 1px solid var(--ux-border-color);
    }

    .ux-event-card--compact::before {
      width: 3px;
    }

    .ux-event-card--compact:hover {
      box-shadow: var(--ux-shadow-sm);
    }

    .ux-event-card--compact .ux-event-card__header {
      padding: 0;
      flex: 1;
      min-width: 0;
    }

    .ux-event-card--compact .ux-event-card__title {
      font-size: var(--ux-font-size-sm);
    }

    .ux-event-card--compact .ux-event-card__content,
    .ux-event-card--compact .ux-event-card__footer,
    .ux-event-card--compact .ux-event-card__description {
      display: none;
    }

    .ux-event-card--compact .ux-event-card__time {
      font-size: var(--ux-font-size-xs);
      font-weight: 400;
      color: var(--ux-text-secondary);
      white-space: nowrap;
    }

    .ux-event-card--compact .ux-event-card__time svg {
      display: none;
    }

    .ux-event-card--compact .ux-event-card__indicators {
      flex-shrink: 0;
    }

    .ux-event-card--compact .ux-event-card__indicator {
      width: 16px;
      height: 16px;
    }

    .ux-event-card--compact .ux-event-card__indicator svg {
      width: 10px;
      height: 10px;
    }

    /* ========================================
       All-Day Event Variant
    ======================================== */

    .ux-event-card--all-day {
      background-color: rgba(var(--ux-event-category-color-rgb, var(--ux-primary-rgb)), 0.08);
      border-left: none;
    }

    .ux-event-card--all-day::before {
      display: none;
    }

    .ux-event-card--all-day .ux-event-card__title {
      color: var(--ux-event-category-color, var(--ux-primary));
    }

    .ux-event-card--all-day .ux-event-card__time {
      display: none;
    }

    .ux-event-card--all-day .ux-event-card__all-day-badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      background-color: var(--ux-event-category-color, var(--ux-primary));
      color: white;
      border-radius: var(--ux-radius-full);
    }

    .ux-event-card__all-day-badge {
      display: none;
    }

    /* All-day category backgrounds */
    .ux-event-card--all-day.ux-event-card--work { background-color: rgba(59, 130, 246, 0.1); }
    .ux-event-card--all-day.ux-event-card--personal { background-color: rgba(34, 197, 94, 0.1); }
    .ux-event-card--all-day.ux-event-card--meeting { background-color: rgba(168, 85, 247, 0.1); }
    .ux-event-card--all-day.ux-event-card--deadline { background-color: rgba(239, 68, 68, 0.1); }
    .ux-event-card--all-day.ux-event-card--reminder { background-color: rgba(234, 179, 8, 0.1); }
    .ux-event-card--all-day.ux-event-card--holiday { background-color: rgba(249, 115, 22, 0.1); }
    .ux-event-card--all-day.ux-event-card--travel { background-color: rgba(6, 182, 212, 0.1); }
    .ux-event-card--all-day.ux-event-card--health { background-color: rgba(244, 63, 94, 0.1); }
    .ux-event-card--all-day.ux-event-card--social { background-color: rgba(99, 102, 241, 0.1); }
    .ux-event-card--all-day.ux-event-card--other { background-color: rgba(107, 114, 128, 0.1); }

    /* ========================================
       Recurring Event Indicator
    ======================================== */

    .ux-event-card--recurring .ux-event-card__title::after {
      content: '';
      display: inline-block;
      width: 14px;
      height: 14px;
      margin-left: var(--ux-space-xs);
      vertical-align: middle;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15'/%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.6;
    }

    /* ========================================
       Clickable Event Card
    ======================================== */

    .ux-event-card--clickable {
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-event-card--clickable:active {
      transform: scale(0.98);
    }

    /* ========================================
       Past Event
    ======================================== */

    .ux-event-card--past {
      opacity: 0.6;
    }

    .ux-event-card--past::before {
      opacity: 0.5;
    }

    /* ========================================
       Cancelled Event
    ======================================== */

    .ux-event-card--cancelled {
      opacity: 0.5;
    }

    .ux-event-card--cancelled .ux-event-card__title {
      text-decoration: line-through;
      color: var(--ux-text-secondary);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-event-card--glass {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-event-card--glass::before {
      background-color: var(--ux-event-category-color, var(--ux-primary));
    }

    .ux-event-card--glass:hover {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight), 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .ux-event-card--glass .ux-event-card__footer {
      border-top-color: var(--ux-glass-border);
    }

    .ux-event-card--glass .ux-event-card__duration,
    .ux-event-card--glass .ux-event-card__indicator,
    .ux-event-card--glass .ux-event-card__attendees-more {
      background: var(--ux-glass-bg-thin);
    }

    /* ========================================
       Outline Variant
    ======================================== */

    .ux-event-card--outline {
      box-shadow: none;
      border: 1px solid var(--ux-border-color);
    }

    .ux-event-card--outline:hover {
      box-shadow: var(--ux-shadow-sm);
      border-color: var(--ux-event-category-color, var(--ux-primary));
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-event-card--sm .ux-event-card__header {
      padding: var(--ux-space-sm) var(--ux-space-sm) var(--ux-space-xs);
      padding-left: calc(var(--ux-space-sm) + 6px);
    }

    .ux-event-card--sm .ux-event-card__content {
      padding: 0 var(--ux-space-sm) var(--ux-space-sm);
      padding-left: calc(var(--ux-space-sm) + 6px);
    }

    .ux-event-card--sm .ux-event-card__title {
      font-size: var(--ux-font-size-sm);
    }

    .ux-event-card--sm .ux-event-card__description {
      font-size: var(--ux-font-size-xs);
    }

    .ux-event-card--sm::before {
      width: 3px;
    }

    .ux-event-card--lg .ux-event-card__header {
      padding: var(--ux-space-lg) var(--ux-space-lg) var(--ux-space-md);
      padding-left: calc(var(--ux-space-lg) + 10px);
    }

    .ux-event-card--lg .ux-event-card__content {
      padding: 0 var(--ux-space-lg) var(--ux-space-lg);
      padding-left: calc(var(--ux-space-lg) + 10px);
      gap: var(--ux-space-md);
    }

    .ux-event-card--lg .ux-event-card__footer {
      padding: var(--ux-space-md) var(--ux-space-lg);
      padding-left: calc(var(--ux-space-lg) + 10px);
    }

    .ux-event-card--lg .ux-event-card__title {
      font-size: var(--ux-font-size-lg);
    }

    .ux-event-card--lg::before {
      width: 5px;
    }

    /* ========================================
       Event Card Grid
    ======================================== */

    .ux-event-card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: var(--ux-space-md);
    }

    .ux-event-card-grid .ux-event-card {
      margin: 0;
    }

    /* ========================================
       Event Card List (stacked)
    ======================================== */

    .ux-event-card-list {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-event-card-list .ux-event-card {
      margin: 0;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-theme-light):not(.ux-light) .ux-event-card--all-day {
        background-color: rgba(var(--ux-event-category-color-rgb, var(--ux-primary-rgb)), 0.15);
      }

      :root:not(.ux-theme-light):not(.ux-light) .ux-event-card__category {
        background-color: rgba(var(--ux-event-category-color-rgb, var(--ux-primary-rgb)), 0.2);
      }

      :root:not(.ux-theme-light):not(.ux-light) .ux-event-card--recurring .ux-event-card__title::after {
        filter: invert(1);
        opacity: 0.5;
      }
    }

    .ux-dark .ux-event-card--all-day,
    .ux-theme-dark .ux-event-card--all-day {
      background-color: rgba(var(--ux-event-category-color-rgb, var(--ux-primary-rgb)), 0.15);
    }

    .ux-dark .ux-event-card__category,
    .ux-theme-dark .ux-event-card__category {
      background-color: rgba(var(--ux-event-category-color-rgb, var(--ux-primary-rgb)), 0.2);
    }

    .ux-dark .ux-event-card--recurring .ux-event-card__title::after,
    .ux-theme-dark .ux-event-card--recurring .ux-event-card__title::after {
      filter: invert(1);
      opacity: 0.5;
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-event-card-grid {
        grid-template-columns: 1fr;
      }

      .ux-event-card__meta {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--ux-space-xs);
      }

      .ux-event-card__footer {
        flex-wrap: wrap;
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-event-card {
        transition: none;
      }

      .ux-event-card--clickable:active {
        transform: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-event-card-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-event-card-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }
})();

/**
 * UX FAB Component
 * Floating Action Buttons estilo Material/iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX FAB (Floating Action Button)
    ======================================== */

    .ux-fab {
      position: fixed;
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-md);
    }

    /* Positions */
    .ux-fab--bottom-end {
      bottom: var(--ux-space-lg);
      right: var(--ux-space-lg);
      bottom: calc(var(--ux-space-lg) + env(safe-area-inset-bottom));
    }

    .ux-fab--bottom-start {
      bottom: var(--ux-space-lg);
      left: var(--ux-space-lg);
      bottom: calc(var(--ux-space-lg) + env(safe-area-inset-bottom));
    }

    .ux-fab--bottom-center {
      bottom: var(--ux-space-lg);
      left: 50%;
      transform: translateX(-50%);
      bottom: calc(var(--ux-space-lg) + env(safe-area-inset-bottom));
    }

    .ux-fab--top-end {
      top: var(--ux-space-lg);
      right: var(--ux-space-lg);
      top: calc(var(--ux-space-lg) + env(safe-area-inset-top));
    }

    .ux-fab--top-start {
      top: var(--ux-space-lg);
      left: var(--ux-space-lg);
      top: calc(var(--ux-space-lg) + env(safe-area-inset-top));
    }

    .ux-fab--center-end {
      top: 50%;
      right: var(--ux-space-lg);
      transform: translateY(-50%);
    }

    .ux-fab--center-start {
      top: 50%;
      left: var(--ux-space-lg);
      transform: translateY(-50%);
    }

    /* ========================================
       FAB Button
    ======================================== */

    .ux-fab__button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-fab-size);
      height: var(--ux-fab-size);
      padding: 0;
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border: none;
      border-radius: 50%;
      box-shadow: var(--ux-shadow-lg);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease-spring),
        box-shadow var(--ux-transition-fast) var(--ux-ease),
        background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-fab__button:hover {
      box-shadow: var(--ux-shadow-xl);
      transform: scale(1.05);
    }

    .ux-fab__button:active {
      transform: scale(0.95);
    }

    .ux-fab__button:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    .ux-fab__button-icon {
      width: 24px;
      height: 24px;
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-fab__button-icon svg {
      width: 100%;
      height: 100%;
    }

    /* Rotate icon when open */
    .ux-fab--open .ux-fab__button-icon {
      transform: rotate(45deg);
    }

    /* ========================================
       FAB Button Sizes
    ======================================== */

    .ux-fab__button--sm {
      width: var(--ux-fab-size-sm);
      height: var(--ux-fab-size-sm);
    }

    .ux-fab__button--sm .ux-fab__button-icon {
      width: var(--ux-fab-icon-size-sm);
      height: var(--ux-fab-icon-size-sm);
    }

    .ux-fab__button--lg {
      width: var(--ux-fab-size-lg);
      height: var(--ux-fab-size-lg);
    }

    .ux-fab__button--lg .ux-fab__button-icon {
      width: var(--ux-fab-icon-size-lg);
      height: var(--ux-fab-icon-size-lg);
    }

    /* ========================================
       FAB Button Colors
    ======================================== */

    .ux-fab__button--secondary {
      background-color: var(--ux-secondary);
      color: var(--ux-secondary-contrast);
    }

    .ux-fab__button--tertiary {
      background-color: var(--ux-tertiary);
      color: var(--ux-tertiary-contrast);
    }

    .ux-fab__button--success {
      background-color: var(--ux-success);
      color: var(--ux-success-contrast);
    }

    .ux-fab__button--warning {
      background-color: var(--ux-warning);
      color: var(--ux-warning-contrast);
    }

    .ux-fab__button--danger {
      background-color: var(--ux-danger);
      color: var(--ux-danger-contrast);
    }

    .ux-fab__button--light {
      background-color: var(--ux-surface);
      color: var(--ux-text);
    }

    .ux-fab__button--dark {
      background-color: var(--ux-dark);
      color: var(--ux-dark-contrast);
    }

    /* ========================================
       Extended FAB (with label)
    ======================================== */

    .ux-fab__button--extended {
      width: auto;
      height: 48px;
      padding: 0 var(--ux-space-lg) 0 var(--ux-space-md);
      border-radius: 24px;
      gap: var(--ux-space-sm);
    }

    .ux-fab__button-label {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      white-space: nowrap;
    }

    /* ========================================
       FAB List (Speed Dial)
    ======================================== */

    .ux-fab__list {
      display: flex;
      flex-direction: column-reverse;
      align-items: center;
      gap: var(--ux-space-md);
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-transition-base) var(--ux-ease),
        visibility var(--ux-transition-base) var(--ux-ease);
    }

    .ux-fab--open .ux-fab__list {
      opacity: 1;
      visibility: visible;
    }

    /* FAB List Items */
    .ux-fab__list-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      opacity: 0;
      transform: translateY(20px) scale(0.8);
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease-spring);
    }

    .ux-fab--open .ux-fab__list-item {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    /* Stagger animation */
    .ux-fab--open .ux-fab__list-item:nth-child(1) { transition-delay: 0ms; }
    .ux-fab--open .ux-fab__list-item:nth-child(2) { transition-delay: 50ms; }
    .ux-fab--open .ux-fab__list-item:nth-child(3) { transition-delay: 100ms; }
    .ux-fab--open .ux-fab__list-item:nth-child(4) { transition-delay: 150ms; }
    .ux-fab--open .ux-fab__list-item:nth-child(5) { transition-delay: 200ms; }

    /* Mini FAB button */
    .ux-fab__mini-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      padding: 0;
      background-color: var(--ux-surface);
      color: var(--ux-text);
      border: none;
      border-radius: 50%;
      box-shadow: var(--ux-shadow-md);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-fab__mini-button:hover {
      box-shadow: var(--ux-shadow-lg);
      transform: scale(1.1);
    }

    .ux-fab__mini-button:active {
      transform: scale(0.95);
    }

    .ux-fab__mini-button-icon {
      width: 20px;
      height: 20px;
    }

    .ux-fab__mini-button-icon svg {
      width: 100%;
      height: 100%;
    }

    /* Mini button colors */
    .ux-fab__mini-button--primary {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-fab__mini-button--secondary {
      background-color: var(--ux-secondary);
      color: var(--ux-secondary-contrast);
    }

    .ux-fab__mini-button--success {
      background-color: var(--ux-success);
      color: var(--ux-success-contrast);
    }

    .ux-fab__mini-button--danger {
      background-color: var(--ux-danger);
      color: var(--ux-danger-contrast);
    }

    /* Label */
    .ux-fab__list-label {
      padding: var(--ux-space-xs) var(--ux-space-md);
      background-color: var(--ux-dark);
      color: var(--ux-dark-contrast);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      border-radius: var(--ux-border-radius);
      white-space: nowrap;
      box-shadow: var(--ux-shadow-sm);
    }

    /* Label position */
    .ux-fab--bottom-end .ux-fab__list-label,
    .ux-fab--center-end .ux-fab__list-label,
    .ux-fab--top-end .ux-fab__list-label {
      order: -1;
    }

    /* ========================================
       Horizontal FAB List
    ======================================== */

    .ux-fab--horizontal .ux-fab__list {
      flex-direction: row;
    }

    .ux-fab--horizontal.ux-fab--bottom-end .ux-fab__list,
    .ux-fab--horizontal.ux-fab--top-end .ux-fab__list {
      flex-direction: row-reverse;
    }

    .ux-fab--horizontal .ux-fab__list-item {
      flex-direction: column;
      transform: translateX(20px) scale(0.8);
    }

    .ux-fab--horizontal.ux-fab--bottom-start .ux-fab__list-item,
    .ux-fab--horizontal.ux-fab--top-start .ux-fab__list-item {
      transform: translateX(-20px) scale(0.8);
    }

    .ux-fab--horizontal.ux-fab--open .ux-fab__list-item {
      transform: translateX(0) scale(1);
    }

    /* ========================================
       FAB Backdrop
    ======================================== */

    .ux-fab__backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.3);
      z-index: 99;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-transition-base) var(--ux-ease),
        visibility var(--ux-transition-base) var(--ux-ease);
    }

    .ux-fab--open .ux-fab__backdrop {
      opacity: 1;
      visibility: visible;
    }

    /* ========================================
       FAB Badge
    ======================================== */

    .ux-fab__badge {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 20px;
      height: 20px;
      padding: 0 6px;
      background-color: var(--ux-danger);
      color: white;
      font-size: 11px;
      font-weight: 600;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ========================================
       FAB Scroll Behavior
    ======================================== */

    .ux-fab--hide-on-scroll {
      transition:
        transform var(--ux-transition-base) var(--ux-ease),
        opacity var(--ux-transition-base) var(--ux-ease);
    }

    .ux-fab--hidden {
      transform: translateY(100px);
      opacity: 0;
      pointer-events: none;
    }

    .ux-fab--bottom-center.ux-fab--hidden {
      transform: translateX(-50%) translateY(100px);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-fab__button--glass {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      border: 0.5px solid var(--ux-glass-border);
      color: var(--ux-text);
    }

    .ux-fab__button--glass:hover {
      background: var(--ux-glass-bg-thick);
    }

    .ux-fab__action--glass {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      border: 0.5px solid var(--ux-glass-border);
      color: var(--ux-text);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-fab-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-fab-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for FAB with speed dial
  const fabComponent = (config = {}) => ({
    isOpen: false,
    hidden: false,
    lastScrollTop: 0,
    hideOnScroll: config.hideOnScroll || false,
    threshold: config.threshold || 50,

    toggle() {
      this.isOpen = !this.isOpen;
    },

    open() {
      this.isOpen = true;
    },

    close() {
      this.isOpen = false;
    },

    handleScroll(scrollTop) {
      if (!this.hideOnScroll) return;

      if (scrollTop > this.lastScrollTop && scrollTop > this.threshold) {
        this.hidden = true;
        this.close();
      } else {
        this.hidden = false;
      }

      this.lastScrollTop = scrollTop;
    },

    handleAction(action) {
      if (action && typeof action === 'function') {
        action();
      }
      this.close();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxFab', fabComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxFab', fabComponent);
    });
  }
})();

/**
 * UX Form Wizard Component
 * Multi-step form wizard with validation support
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Form Wizard
    ======================================== */

    .ux-form-wizard {
      display: flex;
      flex-direction: column;
      width: 100%;
      background-color: var(--ux-surface);
      border-radius: var(--ux-border-radius-lg);
    }

    /* ========================================
       Steps Progress Indicator
    ======================================== */

    .ux-form-wizard__steps {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      padding: var(--ux-space-lg) var(--ux-space-xl);
      position: relative;
      background-color: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg) var(--ux-border-radius-lg) 0 0;
    }

    /* Connector line behind steps */
    .ux-form-wizard__steps::before {
      content: '';
      position: absolute;
      top: calc(var(--ux-space-lg) + 18px);
      left: calc(var(--ux-space-xl) + 18px);
      right: calc(var(--ux-space-xl) + 18px);
      height: 2px;
      background-color: var(--ux-border-color);
      z-index: 0;
    }

    /* Progress line (completed portion) */
    .ux-form-wizard__progress-line {
      position: absolute;
      top: calc(var(--ux-space-lg) + 18px);
      left: calc(var(--ux-space-xl) + 18px);
      height: 2px;
      background-color: var(--ux-primary);
      z-index: 1;
      transition: width var(--ux-transition-normal) var(--ux-ease-out);
    }

    /* ========================================
       Individual Step
    ======================================== */

    .ux-form-wizard__step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
      flex: 1;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-form-wizard__step--disabled {
      cursor: not-allowed;
      pointer-events: none;
    }

    .ux-form-wizard__step--clickable {
      cursor: pointer;
    }

    /* Step indicator (circle with number/icon) */
    .ux-form-wizard__step-indicator {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-color: var(--ux-surface);
      border: 2px solid var(--ux-border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text-secondary);
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease-out),
        border-color var(--ux-transition-fast) var(--ux-ease-out),
        color var(--ux-transition-fast) var(--ux-ease-out),
        transform var(--ux-transition-fast) var(--ux-ease-out),
        box-shadow var(--ux-transition-fast) var(--ux-ease-out);
    }

    .ux-form-wizard__step:hover:not(.ux-form-wizard__step--disabled) .ux-form-wizard__step-indicator {
      border-color: var(--ux-primary);
      transform: scale(1.08);
    }

    .ux-form-wizard__step-indicator svg {
      width: 18px;
      height: 18px;
    }

    /* Step label */
    .ux-form-wizard__step-label {
      margin-top: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
      text-align: center;
      max-width: 100px;
      line-height: 1.3;
      transition: color var(--ux-transition-fast) var(--ux-ease-out);
    }

    /* Step description (optional) */
    .ux-form-wizard__step-description {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-align: center;
      max-width: 120px;
      margin-top: var(--ux-space-xs);
    }

    /* ========================================
       Step States
    ======================================== */

    /* Active step */
    .ux-form-wizard__step--active .ux-form-wizard__step-indicator {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
      box-shadow: 0 2px 8px rgba(var(--ux-primary-rgb), 0.35);
    }

    .ux-form-wizard__step--active .ux-form-wizard__step-label {
      color: var(--ux-primary);
      font-weight: 600;
    }

    /* Completed step */
    .ux-form-wizard__step--completed .ux-form-wizard__step-indicator {
      background-color: var(--ux-success);
      border-color: var(--ux-success);
      color: var(--ux-success-contrast);
    }

    .ux-form-wizard__step--completed .ux-form-wizard__step-label {
      color: var(--ux-success);
    }

    /* Error step */
    .ux-form-wizard__step--error .ux-form-wizard__step-indicator {
      background-color: var(--ux-danger);
      border-color: var(--ux-danger);
      color: var(--ux-danger-contrast);
      animation: uxFormWizardShake 0.4s ease-out;
    }

    .ux-form-wizard__step--error .ux-form-wizard__step-label {
      color: var(--ux-danger);
    }

    @keyframes uxFormWizardShake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-4px); }
      40%, 80% { transform: translateX(4px); }
    }

    /* Disabled step */
    .ux-form-wizard__step--disabled .ux-form-wizard__step-indicator {
      opacity: 0.5;
    }

    .ux-form-wizard__step--disabled .ux-form-wizard__step-label {
      opacity: 0.5;
    }

    /* ========================================
       Step Content Area
    ======================================== */

    .ux-form-wizard__content {
      flex: 1;
      padding: var(--ux-space-xl);
      min-height: 200px;
    }

    .ux-form-wizard__panel {
      display: none;
      animation: uxFormWizardFadeIn var(--ux-transition-normal) var(--ux-ease-out);
    }

    .ux-form-wizard__panel--active {
      display: block;
    }

    @keyframes uxFormWizardFadeIn {
      from {
        opacity: 0;
        transform: translateX(16px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* Panel header */
    .ux-form-wizard__panel-header {
      margin-bottom: var(--ux-space-xl);
    }

    .ux-form-wizard__panel-title {
      font-size: var(--ux-font-size-xl);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs) 0;
    }

    .ux-form-wizard__panel-subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    /* Panel body (form fields) */
    .ux-form-wizard__panel-body {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-lg);
    }

    /* ========================================
       Actions (Navigation Buttons)
    ======================================== */

    .ux-form-wizard__actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--ux-space-lg) var(--ux-space-xl);
      border-top: 1px solid var(--ux-border-color);
      background-color: var(--ux-surface-secondary);
      border-radius: 0 0 var(--ux-border-radius-lg) var(--ux-border-radius-lg);
      gap: var(--ux-space-md);
    }

    .ux-form-wizard__actions-start {
      display: flex;
      gap: var(--ux-space-sm);
    }

    .ux-form-wizard__actions-end {
      display: flex;
      gap: var(--ux-space-sm);
    }

    /* Progress text in actions */
    .ux-form-wizard__progress-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-left: auto;
      margin-right: auto;
    }

    /* ========================================
       Vertical Variant (Sidebar Steps)
    ======================================== */

    .ux-form-wizard--vertical {
      flex-direction: row;
    }

    .ux-form-wizard--vertical .ux-form-wizard__steps {
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      min-width: 220px;
      max-width: 280px;
      padding: var(--ux-space-xl);
      border-bottom: none;
      border-right: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg) 0 0 var(--ux-border-radius-lg);
      gap: var(--ux-space-md);
    }

    /* Vertical connector line */
    .ux-form-wizard--vertical .ux-form-wizard__steps::before {
      top: calc(var(--ux-space-xl) + 18px);
      bottom: calc(var(--ux-space-xl) + 18px);
      left: calc(var(--ux-space-xl) + 17px);
      right: auto;
      width: 2px;
      height: auto;
    }

    .ux-form-wizard--vertical .ux-form-wizard__progress-line {
      top: calc(var(--ux-space-xl) + 18px);
      left: calc(var(--ux-space-xl) + 17px);
      width: 2px !important;
      height: 0;
      transition: height var(--ux-transition-normal) var(--ux-ease-out);
    }

    .ux-form-wizard--vertical .ux-form-wizard__step {
      flex-direction: row;
      align-items: center;
      justify-content: flex-start;
    }

    .ux-form-wizard--vertical .ux-form-wizard__step-label {
      margin-top: 0;
      margin-left: var(--ux-space-md);
      text-align: left;
      max-width: none;
    }

    .ux-form-wizard--vertical .ux-form-wizard__step-description {
      text-align: left;
      margin-left: var(--ux-space-md);
      margin-top: var(--ux-space-xs);
      max-width: none;
    }

    .ux-form-wizard--vertical .ux-form-wizard__body {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-radius: 0 var(--ux-border-radius-lg) var(--ux-border-radius-lg) 0;
    }

    .ux-form-wizard--vertical .ux-form-wizard__content {
      flex: 1;
      border-radius: 0 var(--ux-border-radius-lg) 0 0;
    }

    .ux-form-wizard--vertical .ux-form-wizard__actions {
      border-radius: 0 0 var(--ux-border-radius-lg) 0;
    }

    /* ========================================
       Compact Variant
    ======================================== */

    .ux-form-wizard--compact .ux-form-wizard__steps {
      padding: var(--ux-space-md) var(--ux-space-lg);
    }

    .ux-form-wizard--compact .ux-form-wizard__step-indicator {
      width: 28px;
      height: 28px;
      font-size: var(--ux-font-size-xs);
    }

    .ux-form-wizard--compact .ux-form-wizard__step-indicator svg {
      width: 14px;
      height: 14px;
    }

    .ux-form-wizard--compact .ux-form-wizard__steps::before {
      top: calc(var(--ux-space-md) + 14px);
    }

    .ux-form-wizard--compact .ux-form-wizard__progress-line {
      top: calc(var(--ux-space-md) + 14px);
    }

    .ux-form-wizard--compact .ux-form-wizard__step-label {
      font-size: var(--ux-font-size-xs);
    }

    .ux-form-wizard--compact .ux-form-wizard__content {
      padding: var(--ux-space-lg);
    }

    .ux-form-wizard--compact .ux-form-wizard__actions {
      padding: var(--ux-space-md) var(--ux-space-lg);
    }

    /* ========================================
       Dots Variant (Minimal Progress)
    ======================================== */

    .ux-form-wizard--dots .ux-form-wizard__steps {
      justify-content: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md);
    }

    .ux-form-wizard--dots .ux-form-wizard__steps::before {
      display: none;
    }

    .ux-form-wizard--dots .ux-form-wizard__progress-line {
      display: none;
    }

    .ux-form-wizard--dots .ux-form-wizard__step {
      flex: none;
    }

    .ux-form-wizard--dots .ux-form-wizard__step-indicator {
      width: 10px;
      height: 10px;
      border-width: 0;
      background-color: var(--ux-border-color);
    }

    .ux-form-wizard--dots .ux-form-wizard__step-indicator span,
    .ux-form-wizard--dots .ux-form-wizard__step-indicator svg {
      display: none;
    }

    .ux-form-wizard--dots .ux-form-wizard__step-label {
      display: none;
    }

    .ux-form-wizard--dots .ux-form-wizard__step--active .ux-form-wizard__step-indicator {
      transform: scale(1.3);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-form-wizard--glass {
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-form-wizard--glass .ux-form-wizard__steps {
      background: var(--ux-glass-bg-thin);
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-form-wizard--glass .ux-form-wizard__step-indicator {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
    }

    .ux-form-wizard--glass .ux-form-wizard__step--active .ux-form-wizard__step-indicator {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
    }

    .ux-form-wizard--glass .ux-form-wizard__step--completed .ux-form-wizard__step-indicator {
      background: var(--ux-success);
      border-color: var(--ux-success);
    }

    .ux-form-wizard--glass .ux-form-wizard__step--error .ux-form-wizard__step-indicator {
      background: var(--ux-danger);
      border-color: var(--ux-danger);
    }

    .ux-form-wizard--glass .ux-form-wizard__content {
      background: transparent;
    }

    .ux-form-wizard--glass .ux-form-wizard__actions {
      background: var(--ux-glass-bg-thin);
      border-top-color: var(--ux-glass-border);
    }

    .ux-form-wizard--glass.ux-form-wizard--vertical .ux-form-wizard__steps {
      border-right-color: var(--ux-glass-border);
    }

    /* ========================================
       Borderless Variant
    ======================================== */

    .ux-form-wizard--borderless {
      background: transparent;
    }

    .ux-form-wizard--borderless .ux-form-wizard__steps {
      background: transparent;
      border-bottom: none;
    }

    .ux-form-wizard--borderless .ux-form-wizard__actions {
      background: transparent;
      border-top: none;
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-form-wizard.ux-color-success .ux-form-wizard__step--active .ux-form-wizard__step-indicator {
      background-color: var(--ux-success);
      border-color: var(--ux-success);
      box-shadow: 0 2px 8px rgba(var(--ux-success-rgb), 0.35);
    }

    .ux-form-wizard.ux-color-success .ux-form-wizard__step--active .ux-form-wizard__step-label {
      color: var(--ux-success);
    }

    .ux-form-wizard.ux-color-success .ux-form-wizard__progress-line {
      background-color: var(--ux-success);
    }

    .ux-form-wizard.ux-color-warning .ux-form-wizard__step--active .ux-form-wizard__step-indicator {
      background-color: var(--ux-warning);
      border-color: var(--ux-warning);
      box-shadow: 0 2px 8px rgba(var(--ux-warning-rgb), 0.35);
    }

    .ux-form-wizard.ux-color-warning .ux-form-wizard__step--active .ux-form-wizard__step-label {
      color: var(--ux-warning);
    }

    .ux-form-wizard.ux-color-warning .ux-form-wizard__progress-line {
      background-color: var(--ux-warning);
    }

    .ux-form-wizard.ux-color-tertiary .ux-form-wizard__step--active .ux-form-wizard__step-indicator {
      background-color: var(--ux-tertiary);
      border-color: var(--ux-tertiary);
      box-shadow: 0 2px 8px rgba(var(--ux-tertiary-rgb), 0.35);
    }

    .ux-form-wizard.ux-color-tertiary .ux-form-wizard__step--active .ux-form-wizard__step-label {
      color: var(--ux-tertiary);
    }

    .ux-form-wizard.ux-color-tertiary .ux-form-wizard__progress-line {
      background-color: var(--ux-tertiary);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-form-wizard__steps {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        padding: var(--ux-space-md) var(--ux-space-lg);
      }

      .ux-form-wizard__steps::-webkit-scrollbar {
        display: none;
      }

      .ux-form-wizard__step-label {
        display: none;
      }

      .ux-form-wizard__step--active .ux-form-wizard__step-label {
        display: block;
      }

      .ux-form-wizard__step-description {
        display: none;
      }

      .ux-form-wizard__content {
        padding: var(--ux-space-lg);
      }

      .ux-form-wizard__actions {
        padding: var(--ux-space-md) var(--ux-space-lg);
        flex-wrap: wrap;
      }

      .ux-form-wizard__progress-text {
        width: 100%;
        text-align: center;
        order: -1;
        margin-bottom: var(--ux-space-sm);
      }

      /* Vertical becomes horizontal on mobile */
      .ux-form-wizard--vertical {
        flex-direction: column;
      }

      .ux-form-wizard--vertical .ux-form-wizard__steps {
        flex-direction: row;
        min-width: auto;
        max-width: none;
        border-right: none;
        border-bottom: 1px solid var(--ux-border-color);
        border-radius: var(--ux-border-radius-lg) var(--ux-border-radius-lg) 0 0;
      }

      .ux-form-wizard--vertical .ux-form-wizard__steps::before {
        top: calc(var(--ux-space-md) + 18px);
        bottom: auto;
        left: calc(var(--ux-space-lg) + 18px);
        right: calc(var(--ux-space-lg) + 18px);
        width: auto;
        height: 2px;
      }

      .ux-form-wizard--vertical .ux-form-wizard__progress-line {
        top: calc(var(--ux-space-md) + 18px);
        left: calc(var(--ux-space-lg) + 18px);
        width: 0 !important;
        height: 2px !important;
      }

      .ux-form-wizard--vertical .ux-form-wizard__step {
        flex-direction: column;
      }

      .ux-form-wizard--vertical .ux-form-wizard__step-label {
        margin-left: 0;
        margin-top: var(--ux-space-sm);
        text-align: center;
      }

      .ux-form-wizard--vertical .ux-form-wizard__body {
        border-radius: 0 0 var(--ux-border-radius-lg) var(--ux-border-radius-lg);
      }

      .ux-form-wizard--vertical .ux-form-wizard__content {
        border-radius: 0;
      }

      .ux-form-wizard--vertical .ux-form-wizard__actions {
        border-radius: 0 0 var(--ux-border-radius-lg) var(--ux-border-radius-lg);
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-form-wizard {
        background-color: var(--ux-surface);
      }

      .ux-form-wizard__steps {
        background-color: var(--ux-surface-secondary);
      }

      .ux-form-wizard__actions {
        background-color: var(--ux-surface-secondary);
      }
    }

    .ux-dark .ux-form-wizard {
      background-color: var(--ux-surface);
    }

    .ux-dark .ux-form-wizard__steps {
      background-color: var(--ux-surface-secondary);
    }

    .ux-dark .ux-form-wizard__actions {
      background-color: var(--ux-surface-secondary);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-form-wizard__step-indicator,
      .ux-form-wizard__progress-line,
      .ux-form-wizard__panel {
        transition: none;
        animation: none;
      }

      .ux-form-wizard__step--error .ux-form-wizard__step-indicator {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-form-wizard-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-form-wizard-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // SVG icons
  const icons = {
    check: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',
    error: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>'
  };

  // Alpine component for form wizard
  const formWizardComponent = (config = {}) => ({
    // State
    currentStep: config.initialStep || 0,
    totalSteps: config.totalSteps || 3,
    steps: config.steps || [],
    completedSteps: config.completedSteps || [],
    errorSteps: config.errorSteps || [],
    isVertical: config.vertical || false,

    // Configuration
    linear: config.linear !== false, // Default: must complete steps in order
    allowSkip: config.allowSkip || false,
    validateOnNext: config.validateOnNext !== false, // Default: validate before advancing
    showProgressText: config.showProgressText || false,

    // Validation callback (can be overridden)
    validateStep: config.validateStep || null,

    // Lifecycle
    init() {
      // Initialize totalSteps from steps array if provided
      if (this.steps.length > 0 && !config.totalSteps) {
        this.totalSteps = this.steps.length;
      }

      // Auto-complete previous steps if starting from later step
      if (this.currentStep > 0 && this.completedSteps.length === 0) {
        for (let i = 0; i < this.currentStep; i++) {
          this.completedSteps.push(i);
        }
      }

      // Dispatch init event
      this.$dispatch('form-wizard:init', { currentStep: this.currentStep, totalSteps: this.totalSteps });
    },

    // Navigation methods
    async nextStep() {
      if (this.currentStep >= this.totalSteps - 1) return false;

      // Validate current step before advancing
      if (this.validateOnNext && this.validateStep) {
        const isValid = await this.validateStep(this.currentStep);
        if (!isValid) {
          this.setError(this.currentStep);
          this.$dispatch('form-wizard:validation-error', { step: this.currentStep });
          return false;
        }
      }

      // Mark current step as completed
      this.complete(this.currentStep);

      // Move to next step
      this.currentStep++;
      this.$dispatch('form-wizard:step-change', { step: this.currentStep, direction: 'next' });
      return true;
    },

    prevStep() {
      if (this.currentStep <= 0) return false;

      this.currentStep--;
      this.$dispatch('form-wizard:step-change', { step: this.currentStep, direction: 'prev' });
      return true;
    },

    goToStep(step) {
      if (step < 0 || step >= this.totalSteps) return false;

      // In linear mode, restrict navigation
      if (this.linear && !this.allowSkip) {
        // Can only go to completed steps or next available step
        if (step > this.currentStep + 1) return false;
        if (step > this.currentStep && !this.completedSteps.includes(this.currentStep)) return false;
      }

      const direction = step > this.currentStep ? 'next' : 'prev';
      this.currentStep = step;
      this.$dispatch('form-wizard:step-change', { step: this.currentStep, direction });
      return true;
    },

    // Step state methods
    isActive(step) {
      return this.currentStep === step;
    },

    isCompleted(step) {
      return this.completedSteps.includes(step);
    },

    isError(step) {
      return this.errorSteps.includes(step);
    },

    canGoTo(step) {
      if (!this.linear || this.allowSkip) return true;
      return step <= this.currentStep || this.completedSteps.includes(step - 1);
    },

    // Mark step states
    complete(step = null) {
      const targetStep = step !== null ? step : this.currentStep;
      if (!this.completedSteps.includes(targetStep)) {
        this.completedSteps.push(targetStep);
      }
      // Remove from errors
      this.clearError(targetStep);
      this.$dispatch('form-wizard:step-completed', { step: targetStep });
    },

    setError(step = null) {
      const targetStep = step !== null ? step : this.currentStep;
      if (!this.errorSteps.includes(targetStep)) {
        this.errorSteps.push(targetStep);
      }
      // Remove from completed
      this.completedSteps = this.completedSteps.filter(s => s !== targetStep);
      this.$dispatch('form-wizard:step-error', { step: targetStep });
    },

    clearError(step = null) {
      const targetStep = step !== null ? step : this.currentStep;
      this.errorSteps = this.errorSteps.filter(s => s !== targetStep);
    },

    // Get step classes for template binding
    getStepClasses(step) {
      return {
        'ux-form-wizard__step--active': this.isActive(step),
        'ux-form-wizard__step--completed': this.isCompleted(step) && !this.isActive(step),
        'ux-form-wizard__step--error': this.isError(step),
        'ux-form-wizard__step--disabled': !this.canGoTo(step),
        'ux-form-wizard__step--clickable': this.canGoTo(step)
      };
    },

    // Get icon for step indicator
    getStepIcon(step) {
      if (this.isError(step)) return icons.error;
      if (this.isCompleted(step) && !this.isActive(step)) return icons.check;
      return null;
    },

    // Progress calculation
    get progress() {
      return Math.round((this.completedSteps.length / this.totalSteps) * 100);
    },

    get progressWidth() {
      if (this.totalSteps <= 1) return '0%';
      const stepWidth = 100 / (this.totalSteps - 1);
      return `${Math.min(this.completedSteps.length * stepWidth, 100)}%`;
    },

    get progressHeight() {
      // For vertical layout
      if (this.totalSteps <= 1) return '0%';
      const stepHeight = 100 / (this.totalSteps - 1);
      return `${Math.min(this.completedSteps.length * stepHeight, 100)}%`;
    },

    // Utility getters
    get isFirst() {
      return this.currentStep === 0;
    },

    get isLast() {
      return this.currentStep === this.totalSteps - 1;
    },

    get allCompleted() {
      return this.completedSteps.length === this.totalSteps;
    },

    get progressText() {
      return `Step ${this.currentStep + 1} of ${this.totalSteps}`;
    },

    get currentStepData() {
      return this.steps[this.currentStep] || null;
    },

    // Reset wizard
    reset() {
      this.currentStep = 0;
      this.completedSteps = [];
      this.errorSteps = [];
      this.$dispatch('form-wizard:reset');
    },

    // Submit handler (for final step)
    async submit() {
      // Validate final step
      if (this.validateOnNext && this.validateStep) {
        const isValid = await this.validateStep(this.currentStep);
        if (!isValid) {
          this.setError(this.currentStep);
          this.$dispatch('form-wizard:validation-error', { step: this.currentStep });
          return false;
        }
      }

      // Mark final step as completed
      this.complete(this.currentStep);
      this.$dispatch('form-wizard:submit', { completedSteps: this.completedSteps });
      return true;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxFormWizard', formWizardComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxFormWizard', formWizardComponent);
    });
  }
})();

(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       UX Form - Form Groups with Validation States
       iOS 26 Style - Liquid Glass Design
       ========================================================================== */

    :root {
      /* Form Group Tokens */
      --ux-form-gap: var(--ux-space-xs);
      --ux-form-label-size: var(--ux-font-size-sm);
      --ux-form-label-color: var(--ux-text-secondary);
      --ux-form-label-weight: 500;
      --ux-form-helper-size: var(--ux-font-size-xs);
      --ux-form-helper-color: var(--ux-text-tertiary);
      --ux-form-error-color: var(--ux-danger);
      --ux-form-success-color: var(--ux-success);
      --ux-form-warning-color: var(--ux-warning);
      --ux-form-icon-size: 16px;
    }

    /* ==========================================================================
       Form Group - Container for label + input + helper/error
       ========================================================================== */

    .ux-form-group {
      display: flex;
      flex-direction: column;
      gap: var(--ux-form-gap);
      margin-bottom: var(--ux-space-md);
    }

    .ux-form-group:last-child {
      margin-bottom: 0;
    }

    /* Horizontal layout (inline) */
    .ux-form-group--horizontal {
      flex-direction: row;
      align-items: center;
      gap: var(--ux-space-md);
    }

    .ux-form-group--horizontal .ux-form-group__label {
      flex-shrink: 0;
      min-width: 120px;
      margin-bottom: 0;
    }

    .ux-form-group--horizontal .ux-form-group__control {
      flex: 1;
    }

    /* ==========================================================================
       Label
       ========================================================================== */

    .ux-form-group__label {
      font-size: var(--ux-form-label-size);
      font-weight: var(--ux-form-label-weight);
      color: var(--ux-form-label-color);
      line-height: 1.4;
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-form-group__label--required::after {
      content: '*';
      color: var(--ux-form-error-color);
      font-weight: 600;
    }

    /* Optional badge */
    .ux-form-group__optional {
      font-size: var(--ux-font-size-xs);
      font-weight: 400;
      color: var(--ux-text-tertiary);
      margin-left: auto;
    }

    /* ==========================================================================
       Control Wrapper (input + icons)
       ========================================================================== */

    .ux-form-group__control {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: var(--ux-form-gap);
    }

    .ux-form-group__input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    /* Input with validation icon */
    .ux-form-group__input-wrapper .ux-input,
    .ux-form-group__input-wrapper .ux-textarea,
    .ux-form-group__input-wrapper .ux-select,
    .ux-form-group__input-wrapper input,
    .ux-form-group__input-wrapper textarea,
    .ux-form-group__input-wrapper select {
      width: 100%;
      padding-right: calc(var(--ux-space-md) + var(--ux-form-icon-size) + var(--ux-space-sm));
    }

    /* Validation icon */
    .ux-form-group__icon {
      position: absolute;
      right: var(--ux-space-md);
      top: 50%;
      transform: translateY(-50%);
      width: var(--ux-form-icon-size);
      height: var(--ux-form-icon-size);
      pointer-events: none;
      opacity: 0;
      transition: opacity var(--ux-transition-fast) var(--ux-ease-ios);
    }

    .ux-form-group__icon svg {
      width: 100%;
      height: 100%;
    }

    /* ==========================================================================
       Helper Text
       ========================================================================== */

    .ux-form-group__helper {
      font-size: var(--ux-form-helper-size);
      color: var(--ux-form-helper-color);
      line-height: 1.4;
      display: flex;
      align-items: flex-start;
      gap: var(--ux-space-xs);
    }

    .ux-form-group__helper svg {
      width: 14px;
      height: 14px;
      flex-shrink: 0;
      margin-top: 1px;
    }

    /* ==========================================================================
       Error Message
       ========================================================================== */

    .ux-form-group__error {
      font-size: var(--ux-form-helper-size);
      color: var(--ux-form-error-color);
      line-height: 1.4;
      display: flex;
      align-items: flex-start;
      gap: var(--ux-space-xs);
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease-ios),
        max-height var(--ux-transition-fast) var(--ux-ease-ios);
    }

    .ux-form-group__error svg {
      width: 14px;
      height: 14px;
      flex-shrink: 0;
      margin-top: 1px;
      fill: currentColor;
    }

    /* ==========================================================================
       Success Message
       ========================================================================== */

    .ux-form-group__success {
      font-size: var(--ux-form-helper-size);
      color: var(--ux-form-success-color);
      line-height: 1.4;
      display: flex;
      align-items: flex-start;
      gap: var(--ux-space-xs);
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease-ios),
        max-height var(--ux-transition-fast) var(--ux-ease-ios);
    }

    .ux-form-group__success svg {
      width: 14px;
      height: 14px;
      flex-shrink: 0;
      margin-top: 1px;
      fill: currentColor;
    }

    /* ==========================================================================
       Validation States
       ========================================================================== */

    /* Error State */
    .ux-form-group--error .ux-form-group__label {
      color: var(--ux-form-error-color);
    }

    .ux-form-group--error .ux-input,
    .ux-form-group--error .ux-textarea,
    .ux-form-group--error .ux-select,
    .ux-form-group--error input,
    .ux-form-group--error textarea,
    .ux-form-group--error select {
      border-color: var(--ux-form-error-color) !important;
      background-color: rgba(var(--ux-danger-rgb), 0.03);
    }

    .ux-form-group--error .ux-input:focus,
    .ux-form-group--error .ux-textarea:focus,
    .ux-form-group--error .ux-select:focus,
    .ux-form-group--error input:focus,
    .ux-form-group--error textarea:focus,
    .ux-form-group--error select:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-danger-rgb), 0.15);
    }

    .ux-form-group--error .ux-form-group__icon--error {
      opacity: 1;
      color: var(--ux-form-error-color);
    }

    .ux-form-group--error .ux-form-group__error {
      opacity: 1;
      max-height: 100px;
    }

    .ux-form-group--error .ux-form-group__helper {
      display: none;
    }

    /* Success State */
    .ux-form-group--success .ux-form-group__label {
      color: var(--ux-form-success-color);
    }

    .ux-form-group--success .ux-input,
    .ux-form-group--success .ux-textarea,
    .ux-form-group--success .ux-select,
    .ux-form-group--success input,
    .ux-form-group--success textarea,
    .ux-form-group--success select {
      border-color: var(--ux-form-success-color) !important;
      background-color: rgba(var(--ux-success-rgb), 0.03);
    }

    .ux-form-group--success .ux-input:focus,
    .ux-form-group--success .ux-textarea:focus,
    .ux-form-group--success .ux-select:focus,
    .ux-form-group--success input:focus,
    .ux-form-group--success textarea:focus,
    .ux-form-group--success select:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-success-rgb), 0.15);
    }

    .ux-form-group--success .ux-form-group__icon--success {
      opacity: 1;
      color: var(--ux-form-success-color);
    }

    .ux-form-group--success .ux-form-group__success {
      opacity: 1;
      max-height: 100px;
    }

    .ux-form-group--success .ux-form-group__helper {
      display: none;
    }

    /* Warning State */
    .ux-form-group--warning .ux-form-group__label {
      color: var(--ux-form-warning-color);
    }

    .ux-form-group--warning .ux-input,
    .ux-form-group--warning .ux-textarea,
    .ux-form-group--warning .ux-select,
    .ux-form-group--warning input,
    .ux-form-group--warning textarea,
    .ux-form-group--warning select {
      border-color: var(--ux-form-warning-color) !important;
      background-color: rgba(var(--ux-warning-rgb), 0.03);
    }

    .ux-form-group--warning .ux-input:focus,
    .ux-form-group--warning .ux-textarea:focus,
    .ux-form-group--warning .ux-select:focus,
    .ux-form-group--warning input:focus,
    .ux-form-group--warning textarea:focus,
    .ux-form-group--warning select:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-warning-rgb), 0.15);
    }

    .ux-form-group--warning .ux-form-group__icon--warning {
      opacity: 1;
      color: var(--ux-form-warning-color);
    }

    /* Disabled State */
    .ux-form-group--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    .ux-form-group--disabled .ux-form-group__label {
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       Form Section (Fieldset with Title)
       ========================================================================== */

    .ux-form-section {
      margin-bottom: var(--ux-space-xl);
      padding: 0;
      border: none;
    }

    .ux-form-section__header {
      margin-bottom: var(--ux-space-lg);
      padding-bottom: var(--ux-space-sm);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-form-section__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs) 0;
    }

    .ux-form-section__description {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    .ux-form-section__content {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md);
    }

    /* Compact section */
    .ux-form-section--compact .ux-form-section__header {
      margin-bottom: var(--ux-space-md);
    }

    .ux-form-section--compact .ux-form-section__title {
      font-size: var(--ux-font-size-md);
    }

    /* ==========================================================================
       Form Row (Multiple inputs inline)
       ========================================================================== */

    .ux-form-row {
      display: flex;
      gap: var(--ux-space-md);
      margin-bottom: var(--ux-space-md);
    }

    .ux-form-row:last-child {
      margin-bottom: 0;
    }

    .ux-form-row > .ux-form-group {
      flex: 1;
      margin-bottom: 0;
    }

    /* Fixed width columns */
    .ux-form-row > .ux-form-group--auto {
      flex: 0 0 auto;
    }

    .ux-form-row > .ux-form-group--fixed {
      flex: 0 0 200px;
    }

    /* Responsive: stack on mobile */
    @media (max-width: 767px) {
      .ux-form-row {
        flex-direction: column;
        gap: var(--ux-space-md);
      }

      .ux-form-row > .ux-form-group--fixed {
        flex: 1;
      }

      .ux-form-group--horizontal {
        flex-direction: column;
        align-items: stretch;
      }

      .ux-form-group--horizontal .ux-form-group__label {
        min-width: 0;
        margin-bottom: var(--ux-space-xs);
      }
    }

    /* ==========================================================================
       Form Actions (Submit buttons)
       ========================================================================== */

    .ux-form-actions {
      display: flex;
      gap: var(--ux-space-sm);
      justify-content: flex-end;
      padding-top: var(--ux-space-lg);
      margin-top: var(--ux-space-lg);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-form-actions--start {
      justify-content: flex-start;
    }

    .ux-form-actions--center {
      justify-content: center;
    }

    .ux-form-actions--between {
      justify-content: space-between;
    }

    .ux-form-actions--sticky {
      position: sticky;
      bottom: 0;
      background: var(--ux-surface);
      padding: var(--ux-space-md);
      margin: var(--ux-space-lg) calc(var(--ux-space-lg) * -1) 0;
      border-top: 1px solid var(--ux-border-color);
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
    }

    /* ==========================================================================
       Character Counter
       ========================================================================== */

    .ux-form-group__counter {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-align: right;
      margin-left: auto;
    }

    .ux-form-group__counter--warning {
      color: var(--ux-form-warning-color);
    }

    .ux-form-group__counter--error {
      color: var(--ux-form-error-color);
    }

    .ux-form-group__footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    /* ==========================================================================
       Input Prefix/Suffix
       ========================================================================== */

    .ux-form-group__addon {
      display: flex;
      align-items: center;
      padding: 0 var(--ux-space-sm);
      background: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      color: var(--ux-text-secondary);
      font-size: var(--ux-font-size-sm);
      white-space: nowrap;
    }

    .ux-form-group__addon--start {
      border-right: none;
      border-radius: var(--ux-border-radius) 0 0 var(--ux-border-radius);
    }

    .ux-form-group__addon--end {
      border-left: none;
      border-radius: 0 var(--ux-border-radius) var(--ux-border-radius) 0;
    }

    .ux-form-group__input-wrapper--has-addon-start input,
    .ux-form-group__input-wrapper--has-addon-start .ux-input {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }

    .ux-form-group__input-wrapper--has-addon-end input,
    .ux-form-group__input-wrapper--has-addon-end .ux-input {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-form-group--glass .ux-input,
    .ux-form-group--glass .ux-textarea,
    .ux-form-group--glass .ux-select,
    .ux-form-group--glass input,
    .ux-form-group--glass textarea,
    .ux-form-group--glass select {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    .ux-form-group--glass .ux-form-group__addon {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light) {
        --ux-form-label-color: var(--ux-text-secondary);
        --ux-form-helper-color: var(--ux-text-tertiary);
      }

      :root:not(.ux-light) .ux-form-group--error .ux-input,
      :root:not(.ux-light) .ux-form-group--error input {
        background-color: rgba(var(--ux-danger-rgb), 0.08);
      }

      :root:not(.ux-light) .ux-form-group--success .ux-input,
      :root:not(.ux-light) .ux-form-group--success input {
        background-color: rgba(var(--ux-success-rgb), 0.08);
      }

      :root:not(.ux-light) .ux-form-actions--sticky {
        background: var(--ux-surface);
        box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.2);
      }
    }

    .ux-dark {
      --ux-form-label-color: var(--ux-text-secondary);
      --ux-form-helper-color: var(--ux-text-tertiary);
    }

    .ux-dark .ux-form-group--error .ux-input,
    .ux-dark .ux-form-group--error input {
      background-color: rgba(var(--ux-danger-rgb), 0.08);
    }

    .ux-dark .ux-form-group--success .ux-input,
    .ux-dark .ux-form-group--success input {
      background-color: rgba(var(--ux-success-rgb), 0.08);
    }

    .ux-dark .ux-form-actions--sticky {
      background: var(--ux-surface);
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.2);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-form-group__error,
      .ux-form-group__success,
      .ux-form-group__icon {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-form-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-form-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for form validation
  const formGroupComponent = (config = {}) => ({
    // State
    value: config.value || '',
    error: config.error || '',
    success: config.success || '',
    touched: false,
    dirty: false,

    // Validation rules
    rules: config.rules || [],

    // Character counter
    maxLength: config.maxLength || null,

    // Computed state
    get state() {
      if (this.error) return 'error';
      if (this.success) return 'success';
      return '';
    },

    get charCount() {
      return this.value ? this.value.length : 0;
    },

    get charCountState() {
      if (!this.maxLength) return '';
      const ratio = this.charCount / this.maxLength;
      if (ratio >= 1) return 'error';
      if (ratio >= 0.9) return 'warning';
      return '';
    },

    get containerClasses() {
      return {
        'ux-form-group--error': this.state === 'error',
        'ux-form-group--success': this.state === 'success',
        'ux-form-group--touched': this.touched,
        'ux-form-group--dirty': this.dirty
      };
    },

    // Methods
    init() {
      // Watch for external value changes
      if (config.watchValue) {
        this.$watch('value', () => this.validate());
      }
    },

    onInput(e) {
      this.value = e.target.value;
      this.dirty = true;

      // Clear error on input
      if (config.clearOnInput !== false) {
        this.error = '';
      }

      // Validate on input (optional)
      if (config.validateOnInput) {
        this.validate();
      }

      this.$dispatch('form-input', { value: this.value, name: config.name });
    },

    onBlur() {
      this.touched = true;

      // Validate on blur
      if (config.validateOnBlur !== false) {
        this.validate();
      }

      this.$dispatch('form-blur', { value: this.value, name: config.name });
    },

    onFocus() {
      this.$dispatch('form-focus', { value: this.value, name: config.name });
    },

    validate() {
      this.error = '';
      this.success = '';

      for (const rule of this.rules) {
        const result = rule(this.value);
        if (result !== true && result !== '') {
          this.error = result;
          return false;
        }
      }

      // Show success if configured and has value
      if (config.showSuccess && this.value && this.touched) {
        this.success = config.successMessage || '';
      }

      return true;
    },

    setError(message) {
      this.error = message;
      this.success = '';
    },

    setSuccess(message) {
      this.error = '';
      this.success = message;
    },

    reset() {
      this.value = config.value || '';
      this.error = '';
      this.success = '';
      this.touched = false;
      this.dirty = false;
    }
  });

  // Common validation rules
  const validationRules = {
    required: (message = 'This field is required') => (value) => {
      if (!value || (typeof value === 'string' && !value.trim())) {
        return message;
      }
      return true;
    },

    email: (message = 'Please enter a valid email') => (value) => {
      if (!value) return true;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(value) ? true : message;
    },

    minLength: (min, message) => (value) => {
      if (!value) return true;
      const msg = message || `Minimum ${min} characters required`;
      return value.length >= min ? true : msg;
    },

    maxLength: (max, message) => (value) => {
      if (!value) return true;
      const msg = message || `Maximum ${max} characters allowed`;
      return value.length <= max ? true : msg;
    },

    pattern: (regex, message = 'Invalid format') => (value) => {
      if (!value) return true;
      return regex.test(value) ? true : message;
    },

    numeric: (message = 'Please enter a number') => (value) => {
      if (!value) return true;
      return !isNaN(value) && !isNaN(parseFloat(value)) ? true : message;
    },

    phone: (message = 'Please enter a valid phone number') => (value) => {
      if (!value) return true;
      const phoneRegex = /^[\d\s\-+()]{7,}$/;
      return phoneRegex.test(value) ? true : message;
    },

    url: (message = 'Please enter a valid URL') => (value) => {
      if (!value) return true;
      try {
        new URL(value);
        return true;
      } catch {
        return message;
      }
    },

    match: (field, message = 'Fields do not match') => (value, formData) => {
      if (!value) return true;
      return value === formData[field] ? true : message;
    }
  };

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxFormGroup', formGroupComponent);
    window.UX.formRules = validationRules;
  }

  // Export for non-Alpine usage
  window.UXFormRules = validationRules;

})();

/**
 * UX Fullscreen Modal Component
 * Full-screen modal dialog for immersive experiences
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Fullscreen Modal
    ======================================== */

    .ux-fullscreen-modal {
      position: fixed;
      inset: 0;
      z-index: var(--ux-z-modal);
      display: flex;
      flex-direction: column;
      background: var(--ux-surface);
      font-family: var(--ux-font-family);
      opacity: 0;
      visibility: hidden;
      transform: translateY(100%);
      transition: transform var(--ux-transition-slow) var(--ux-ease-out),
                  opacity var(--ux-transition-slow),
                  visibility var(--ux-transition-slow);
    }

    .ux-fullscreen-modal--open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    /* ========================================
       Animation Variants
    ======================================== */

    /* Slide from right */
    .ux-fullscreen-modal--slide-right {
      transform: translateX(100%);
    }

    .ux-fullscreen-modal--slide-right.ux-fullscreen-modal--open {
      transform: translateX(0);
    }

    /* Slide from left */
    .ux-fullscreen-modal--slide-left {
      transform: translateX(-100%);
    }

    .ux-fullscreen-modal--slide-left.ux-fullscreen-modal--open {
      transform: translateX(0);
    }

    /* Fade only */
    .ux-fullscreen-modal--fade {
      transform: none;
    }

    /* Scale */
    .ux-fullscreen-modal--scale {
      transform: scale(0.9);
    }

    .ux-fullscreen-modal--scale.ux-fullscreen-modal--open {
      transform: scale(1);
    }

    /* ========================================
       Header
    ======================================== */

    .ux-fullscreen-modal__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 56px;
      padding: var(--ux-space-sm) var(--ux-space-md);
      padding-top: max(var(--ux-space-sm), var(--ux-safe-top));
      border-bottom: 1px solid var(--ux-border-color);
      background: var(--ux-surface);
      flex-shrink: 0;
    }

    .ux-fullscreen-modal__header-start {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      min-width: 44px;
    }

    .ux-fullscreen-modal__header-center {
      flex: 1;
      text-align: center;
      min-width: 0;
    }

    .ux-fullscreen-modal__header-end {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: var(--ux-space-sm);
      min-width: 44px;
    }

    .ux-fullscreen-modal__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-fullscreen-modal__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    /* ========================================
       Close Button
    ======================================== */

    .ux-fullscreen-modal__close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      padding: 0;
      background: transparent;
      border: none;
      border-radius: 50%;
      color: var(--ux-text);
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-fullscreen-modal__close:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-fullscreen-modal__close:active {
      background: var(--ux-surface-tertiary);
    }

    .ux-fullscreen-modal__close svg {
      width: 24px;
      height: 24px;
    }

    /* ========================================
       Content
    ======================================== */

    .ux-fullscreen-modal__content {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }

    .ux-fullscreen-modal__content-inner {
      padding: var(--ux-space-md);
    }

    /* Content variants */
    .ux-fullscreen-modal__content--padded {
      padding: var(--ux-space-lg);
    }

    .ux-fullscreen-modal__content--centered {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ux-fullscreen-modal__content--constrained {
      max-width: 800px;
      margin: 0 auto;
    }

    /* ========================================
       Footer
    ======================================== */

    .ux-fullscreen-modal__footer {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md);
      padding-bottom: max(var(--ux-space-md), var(--ux-safe-bottom));
      border-top: 1px solid var(--ux-border-color);
      background: var(--ux-surface);
      flex-shrink: 0;
    }

    .ux-fullscreen-modal__footer--sticky {
      position: sticky;
      bottom: 0;
    }

    .ux-fullscreen-modal__footer--spaced {
      justify-content: space-between;
    }

    /* ========================================
       Toolbar Variant
    ======================================== */

    .ux-fullscreen-modal--toolbar .ux-fullscreen-modal__header {
      border-bottom: none;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    /* ========================================
       Transparent Header
    ======================================== */

    .ux-fullscreen-modal--transparent-header .ux-fullscreen-modal__header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.3), transparent);
      border-bottom: none;
      color: white;
      z-index: 10;
    }

    .ux-fullscreen-modal--transparent-header .ux-fullscreen-modal__title {
      color: white;
    }

    .ux-fullscreen-modal--transparent-header .ux-fullscreen-modal__close {
      color: white;
    }

    .ux-fullscreen-modal--transparent-header .ux-fullscreen-modal__close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .ux-fullscreen-modal--transparent-header .ux-fullscreen-modal__content {
      padding-top: 56px;
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-fullscreen-modal--dark {
      background: var(--ux-gray-900);
      color: white;
    }

    .ux-fullscreen-modal--dark .ux-fullscreen-modal__header {
      background: var(--ux-gray-900);
      border-color: var(--ux-gray-700);
    }

    .ux-fullscreen-modal--dark .ux-fullscreen-modal__title {
      color: white;
    }

    .ux-fullscreen-modal--dark .ux-fullscreen-modal__close {
      color: white;
    }

    .ux-fullscreen-modal--dark .ux-fullscreen-modal__close:hover {
      background: var(--ux-gray-800);
    }

    .ux-fullscreen-modal--dark .ux-fullscreen-modal__footer {
      background: var(--ux-gray-900);
      border-color: var(--ux-gray-700);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-fullscreen-modal--glass {
      background: var(--ux-glass-bg-thick);
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
    }

    .ux-fullscreen-modal--glass .ux-fullscreen-modal__header {
      background: transparent;
      border-color: var(--ux-glass-border);
    }

    .ux-fullscreen-modal--glass .ux-fullscreen-modal__footer {
      background: transparent;
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-fullscreen-modal--loading .ux-fullscreen-modal__content {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ux-fullscreen-modal__loader {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-md);
    }

    .ux-fullscreen-modal__spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--ux-border-color);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-fullscreen-modal-spin 0.8s linear infinite;
    }

    @keyframes ux-fullscreen-modal-spin {
      to { transform: rotate(360deg); }
    }

    /* ========================================
       With Backdrop
    ======================================== */

    .ux-fullscreen-modal-backdrop {
      position: fixed;
      inset: 0;
      z-index: calc(var(--ux-z-modal) - 1);
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--ux-transition-normal), visibility var(--ux-transition-normal);
    }

    .ux-fullscreen-modal-backdrop--visible {
      opacity: 1;
      visibility: visible;
    }

    /* ========================================
       Steps / Progress Header
    ======================================== */

    .ux-fullscreen-modal__steps {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-sm) 0;
    }

    .ux-fullscreen-modal__step-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--ux-gray-300);
      transition: all var(--ux-transition-fast);
    }

    .ux-fullscreen-modal__step-dot--active {
      background: var(--ux-primary);
      transform: scale(1.25);
    }

    .ux-fullscreen-modal__step-dot--completed {
      background: var(--ux-primary);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-fullscreen-modal__step-dot {
        background: var(--ux-gray-600);
      }
    }

    .ux-dark .ux-fullscreen-modal__step-dot {
      background: var(--ux-gray-600);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-fullscreen-modal {
        transition: opacity var(--ux-transition-fast), visibility var(--ux-transition-fast);
        transform: none !important;
      }

      .ux-fullscreen-modal__spinner {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-fullscreen-modal-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-fullscreen-modal-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const fullscreenModalData = (options = {}) => ({
    isOpen: false,
    loading: options.loading ?? false,
    closeOnEscape: options.closeOnEscape ?? true,
    animation: options.animation ?? 'slide-up', // slide-up, slide-right, slide-left, fade, scale
    showBackdrop: options.showBackdrop ?? false,
    currentStep: options.currentStep ?? 0,
    totalSteps: options.totalSteps ?? 0,

    init() {
      if (this.closeOnEscape) {
        this._escapeHandler = (e) => {
          if (e.key === 'Escape' && this.isOpen) {
            this.close();
          }
        };
        document.addEventListener('keydown', this._escapeHandler);
      }
    },

    destroy() {
      if (this._escapeHandler) {
        document.removeEventListener('keydown', this._escapeHandler);
      }
    },

    open() {
      this.isOpen = true;

      if (window.UX) {
        window.UX.lockScroll();
      }

      this.$dispatch('fullscreenmodal:open');

      // Focus first focusable element
      this.$nextTick(() => {
        const focusable = this.$el.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if (focusable) {
          focusable.focus();
        }
      });
    },

    close() {
      this.isOpen = false;

      if (window.UX) {
        window.UX.unlockScroll();
      }

      this.$dispatch('fullscreenmodal:close');
    },

    toggle() {
      this.isOpen ? this.close() : this.open();
    },

    setLoading(value) {
      this.loading = value;
    },

    // Step navigation for multi-step modals
    nextStep() {
      if (this.currentStep < this.totalSteps - 1) {
        this.currentStep++;
        this.$dispatch('fullscreenmodal:stepchange', { step: this.currentStep });
      }
    },

    prevStep() {
      if (this.currentStep > 0) {
        this.currentStep--;
        this.$dispatch('fullscreenmodal:stepchange', { step: this.currentStep });
      }
    },

    goToStep(step) {
      if (step >= 0 && step < this.totalSteps) {
        this.currentStep = step;
        this.$dispatch('fullscreenmodal:stepchange', { step: this.currentStep });
      }
    },

    isStepActive(step) {
      return step === this.currentStep;
    },

    isStepCompleted(step) {
      return step < this.currentStep;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxFullscreenModal', fullscreenModalData);
  }

})();

/**
 * UX Gantt Chart Component
 * Interactive Gantt chart for project management and task scheduling
 * @requires ux-core.js
 * @requires Alpine.js for interactivity
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Gantt Chart - CSS Variables
    ======================================== */

    :root {
      --ux-gantt-row-height: 40px;
      --ux-gantt-header-height: 48px;
      --ux-gantt-task-panel-width: 280px;
      --ux-gantt-cell-width-day: 40px;
      --ux-gantt-cell-width-week: 100px;
      --ux-gantt-cell-width-month: 120px;
      --ux-gantt-bar-height: 24px;
      --ux-gantt-bar-radius: 4px;
      --ux-gantt-milestone-size: 16px;
      --ux-gantt-today-line-color: var(--ux-danger);
      --ux-gantt-weekend-bg: rgba(0, 0, 0, 0.02);
      --ux-gantt-grid-color: var(--ux-border-color);
      --ux-gantt-dependency-color: var(--ux-gray-400);
    }

    /* ========================================
       Gantt Container
    ======================================== */

    .ux-gantt {
      display: flex;
      flex-direction: column;
      width: 100%;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      overflow: hidden;
      font-family: var(--ux-font-family);
    }

    .ux-gantt--bordered {
      border: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Gantt Toolbar
    ======================================== */

    .ux-gantt__toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-gantt__toolbar-start,
    .ux-gantt__toolbar-end {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-gantt__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-gantt__zoom-controls {
      display: flex;
      align-items: center;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      overflow: hidden;
    }

    .ux-gantt__zoom-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 32px;
      height: 32px;
      padding: 0 var(--ux-space-sm);
      background: none;
      border: none;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-gantt__zoom-btn:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-gantt__zoom-btn--active {
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-gantt__zoom-btn--active:hover {
      background: var(--ux-primary-shade);
    }

    .ux-gantt__zoom-btn:not(:last-child) {
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-gantt__nav-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-gantt__nav-btn:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
      border-color: var(--ux-primary);
    }

    .ux-gantt__nav-btn svg {
      width: 16px;
      height: 16px;
    }

    .ux-gantt__today-btn {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-gantt__today-btn:hover {
      background: var(--ux-surface-secondary);
      border-color: var(--ux-primary);
    }

    /* ========================================
       Gantt Body (Main Area)
    ======================================== */

    .ux-gantt__body {
      display: flex;
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    /* ========================================
       Task Panel (Left Side)
    ======================================== */

    .ux-gantt__tasks {
      flex-shrink: 0;
      width: var(--ux-gantt-task-panel-width);
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--ux-border-color);
      background: var(--ux-surface);
      z-index: 10;
    }

    .ux-gantt__tasks-header {
      display: flex;
      align-items: center;
      height: var(--ux-gantt-header-height);
      padding: 0 var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-gantt__tasks-body {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .ux-gantt__task-row {
      display: flex;
      align-items: center;
      height: var(--ux-gantt-row-height);
      padding: 0 var(--ux-space-md);
      border-bottom: 1px solid var(--ux-gantt-grid-color);
      transition: background var(--ux-transition-fast);
    }

    .ux-gantt__task-row:hover {
      background: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-gantt__task-row--selected {
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-gantt__task-row--group {
      background: var(--ux-surface-secondary);
      font-weight: 600;
    }

    .ux-gantt__task-indent {
      flex-shrink: 0;
    }

    .ux-gantt__task-expand {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      margin-right: var(--ux-space-xs);
      background: none;
      border: none;
      color: var(--ux-text-secondary);
      cursor: pointer;
      border-radius: var(--ux-radius-sm);
      transition: all var(--ux-transition-fast);
    }

    .ux-gantt__task-expand:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-gantt__task-expand svg {
      width: 14px;
      height: 14px;
      transition: transform var(--ux-transition-fast);
    }

    .ux-gantt__task-expand--expanded svg {
      transform: rotate(90deg);
    }

    .ux-gantt__task-name {
      flex: 1;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-gantt__task-status {
      flex-shrink: 0;
      margin-left: var(--ux-space-sm);
    }

    /* ========================================
       Resizer
    ======================================== */

    .ux-gantt__resizer {
      position: absolute;
      left: var(--ux-gantt-task-panel-width);
      top: 0;
      bottom: 0;
      width: 4px;
      background: transparent;
      cursor: col-resize;
      z-index: 20;
      transition: background var(--ux-transition-fast);
    }

    .ux-gantt__resizer:hover,
    .ux-gantt__resizer--active {
      background: var(--ux-primary);
    }

    /* ========================================
       Chart Area (Right Side)
    ======================================== */

    .ux-gantt__chart {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    .ux-gantt__chart-scroll {
      flex: 1;
      overflow: auto;
      position: relative;
    }

    .ux-gantt__chart-inner {
      position: relative;
      min-width: 100%;
    }

    /* ========================================
       Timeline Header
    ======================================== */

    .ux-gantt__header {
      position: sticky;
      top: 0;
      z-index: 5;
      background: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-gantt__header-row {
      display: flex;
      height: calc(var(--ux-gantt-header-height) / 2);
    }

    .ux-gantt__header-row--primary {
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-gantt__header-cell {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      color: var(--ux-text-secondary);
      border-right: 1px solid var(--ux-gantt-grid-color);
      white-space: nowrap;
      flex-shrink: 0;
    }

    .ux-gantt__header-cell--primary {
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-gantt__header-cell--today {
      background: rgba(var(--ux-danger-rgb, 255, 59, 48), 0.1);
      color: var(--ux-danger);
    }

    .ux-gantt__header-cell--weekend {
      background: var(--ux-gantt-weekend-bg);
    }

    /* ========================================
       Chart Grid
    ======================================== */

    .ux-gantt__grid {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .ux-gantt__grid-row {
      display: flex;
      height: var(--ux-gantt-row-height);
      border-bottom: 1px solid var(--ux-gantt-grid-color);
    }

    .ux-gantt__grid-cell {
      flex-shrink: 0;
      border-right: 1px solid var(--ux-gantt-grid-color);
    }

    .ux-gantt__grid-cell--weekend {
      background: var(--ux-gantt-weekend-bg);
    }

    /* ========================================
       Today Line
    ======================================== */

    .ux-gantt__today-line {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--ux-gantt-today-line-color);
      z-index: 4;
      pointer-events: none;
    }

    .ux-gantt__today-line::before {
      content: '';
      position: absolute;
      top: -6px;
      left: -4px;
      width: 10px;
      height: 10px;
      background: var(--ux-gantt-today-line-color);
      border-radius: 50%;
    }

    /* ========================================
       Bars Container
    ======================================== */

    .ux-gantt__bars {
      position: relative;
      z-index: 3;
    }

    .ux-gantt__bar-row {
      position: relative;
      height: var(--ux-gantt-row-height);
      display: flex;
      align-items: center;
    }

    /* ========================================
       Task Bar
    ======================================== */

    .ux-gantt__bar {
      position: absolute;
      height: var(--ux-gantt-bar-height);
      background: var(--ux-primary);
      border-radius: var(--ux-gantt-bar-radius);
      cursor: pointer;
      display: flex;
      align-items: center;
      overflow: hidden;
      transition: box-shadow var(--ux-transition-fast), transform var(--ux-transition-fast);
    }

    .ux-gantt__bar:hover {
      box-shadow: var(--ux-shadow-md);
      z-index: 2;
    }

    .ux-gantt__bar--selected {
      box-shadow: 0 0 0 2px var(--ux-surface), 0 0 0 4px var(--ux-primary);
    }

    .ux-gantt__bar--dragging {
      opacity: 0.8;
      z-index: 10;
    }

    /* Bar States */
    .ux-gantt__bar--not-started {
      background: var(--ux-gray-300);
    }

    .ux-gantt__bar--in-progress {
      background: var(--ux-primary);
    }

    .ux-gantt__bar--completed {
      background: var(--ux-success);
    }

    .ux-gantt__bar--delayed {
      background: var(--ux-danger);
    }

    .ux-gantt__bar--on-hold {
      background: var(--ux-warning);
    }

    /* Category Colors */
    .ux-gantt__bar--category-design {
      background: var(--ux-purple-500);
    }

    .ux-gantt__bar--category-development {
      background: var(--ux-blue-500);
    }

    .ux-gantt__bar--category-testing {
      background: var(--ux-cyan-500);
    }

    .ux-gantt__bar--category-marketing {
      background: var(--ux-orange-500);
    }

    .ux-gantt__bar--category-management {
      background: var(--ux-indigo-500);
    }

    /* Progress indicator within bar */
    .ux-gantt__bar-progress {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.15);
      border-radius: var(--ux-gantt-bar-radius) 0 0 var(--ux-gantt-bar-radius);
      transition: width var(--ux-transition-normal);
    }

    .ux-gantt__bar-label {
      position: relative;
      padding: 0 var(--ux-space-sm);
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      color: white;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      z-index: 1;
    }

    /* Bar resize handles */
    .ux-gantt__bar-handle {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 8px;
      cursor: ew-resize;
      opacity: 0;
      transition: opacity var(--ux-transition-fast);
    }

    .ux-gantt__bar:hover .ux-gantt__bar-handle {
      opacity: 1;
    }

    .ux-gantt__bar-handle--start {
      left: 0;
      border-radius: var(--ux-gantt-bar-radius) 0 0 var(--ux-gantt-bar-radius);
      background: linear-gradient(to right, rgba(0,0,0,0.2), transparent);
    }

    .ux-gantt__bar-handle--end {
      right: 0;
      border-radius: 0 var(--ux-gantt-bar-radius) var(--ux-gantt-bar-radius) 0;
      background: linear-gradient(to left, rgba(0,0,0,0.2), transparent);
    }

    /* Group bar */
    .ux-gantt__bar--group {
      height: 8px;
      background: var(--ux-gray-600);
      border-radius: 0;
    }

    .ux-gantt__bar--group::before,
    .ux-gantt__bar--group::after {
      content: '';
      position: absolute;
      bottom: 0;
      width: 0;
      height: 0;
      border-style: solid;
    }

    .ux-gantt__bar--group::before {
      left: 0;
      border-width: 0 0 8px 8px;
      border-color: transparent transparent var(--ux-gray-600) transparent;
    }

    .ux-gantt__bar--group::after {
      right: 0;
      border-width: 8px 0 0 8px;
      border-color: transparent transparent transparent var(--ux-gray-600);
    }

    /* ========================================
       Milestone
    ======================================== */

    .ux-gantt__milestone {
      position: absolute;
      width: var(--ux-gantt-milestone-size);
      height: var(--ux-gantt-milestone-size);
      background: var(--ux-warning);
      transform: rotate(45deg) translateX(-50%);
      cursor: pointer;
      transition: box-shadow var(--ux-transition-fast), transform var(--ux-transition-fast);
    }

    .ux-gantt__milestone:hover {
      box-shadow: var(--ux-shadow-md);
      transform: rotate(45deg) translateX(-50%) scale(1.2);
    }

    .ux-gantt__milestone--completed {
      background: var(--ux-success);
    }

    .ux-gantt__milestone--delayed {
      background: var(--ux-danger);
    }

    /* ========================================
       Dependencies (Arrows)
    ======================================== */

    .ux-gantt__dependencies {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .ux-gantt__dependency {
      fill: none;
      stroke: var(--ux-gantt-dependency-color);
      stroke-width: 1.5;
    }

    .ux-gantt__dependency-arrow {
      fill: var(--ux-gantt-dependency-color);
    }

    /* ========================================
       Compact Mode
    ======================================== */

    .ux-gantt--compact {
      --ux-gantt-row-height: 32px;
      --ux-gantt-header-height: 40px;
      --ux-gantt-bar-height: 18px;
      --ux-gantt-milestone-size: 12px;
    }

    .ux-gantt--compact .ux-gantt__task-name {
      font-size: var(--ux-font-size-xs);
    }

    .ux-gantt--compact .ux-gantt__bar-label {
      font-size: 10px;
    }

    /* ========================================
       Read Only Mode
    ======================================== */

    .ux-gantt--readonly .ux-gantt__bar {
      cursor: default;
    }

    .ux-gantt--readonly .ux-gantt__bar-handle {
      display: none;
    }

    .ux-gantt--readonly .ux-gantt__milestone {
      cursor: default;
    }

    .ux-gantt--readonly .ux-gantt__milestone:hover {
      transform: rotate(45deg) translateX(-50%);
    }

    /* ========================================
       Empty State
    ======================================== */

    .ux-gantt__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-2xl);
      text-align: center;
      color: var(--ux-text-secondary);
    }

    .ux-gantt__empty-icon {
      width: 64px;
      height: 64px;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-text-tertiary);
    }

    .ux-gantt__empty-title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
    }

    .ux-gantt__empty-text {
      font-size: var(--ux-font-size-sm);
      margin: 0;
    }

    /* ========================================
       Tooltip
    ======================================== */

    .ux-gantt__tooltip {
      position: fixed;
      z-index: 1000;
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-gray-900);
      color: white;
      font-size: var(--ux-font-size-sm);
      border-radius: var(--ux-radius-md);
      box-shadow: var(--ux-shadow-lg);
      pointer-events: none;
      opacity: 0;
      transform: translateY(4px);
      transition: opacity var(--ux-transition-fast), transform var(--ux-transition-fast);
    }

    .ux-gantt__tooltip--visible {
      opacity: 1;
      transform: translateY(0);
    }

    .ux-gantt__tooltip-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .ux-gantt__tooltip-dates {
      font-size: var(--ux-font-size-xs);
      opacity: 0.8;
    }

    .ux-gantt__tooltip-progress {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      margin-top: 4px;
      font-size: var(--ux-font-size-xs);
    }

    .ux-gantt__tooltip-progress-bar {
      flex: 1;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      overflow: hidden;
    }

    .ux-gantt__tooltip-progress-fill {
      height: 100%;
      background: white;
      border-radius: 2px;
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-gantt--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-gantt--glass .ux-gantt__toolbar,
    .ux-gantt--glass .ux-gantt__tasks,
    .ux-gantt--glass .ux-gantt__header {
      background: var(--ux-glass-bg-thin);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      :root {
        --ux-gantt-weekend-bg: rgba(255, 255, 255, 0.02);
      }

      .ux-gantt__bar--not-started {
        background: var(--ux-gray-600);
      }

      .ux-gantt__bar--group {
        background: var(--ux-gray-400);
      }

      .ux-gantt__bar--group::before {
        border-color: transparent transparent var(--ux-gray-400) transparent;
      }

      .ux-gantt__bar--group::after {
        border-color: transparent transparent transparent var(--ux-gray-400);
      }
    }

    .ux-dark {
      --ux-gantt-weekend-bg: rgba(255, 255, 255, 0.02);
    }

    .ux-dark .ux-gantt__bar--not-started {
      background: var(--ux-gray-600);
    }

    .ux-dark .ux-gantt__bar--group {
      background: var(--ux-gray-400);
    }

    .ux-dark .ux-gantt__bar--group::before {
      border-color: transparent transparent var(--ux-gray-400) transparent;
    }

    .ux-dark .ux-gantt__bar--group::after {
      border-color: transparent transparent transparent var(--ux-gray-400);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-gantt {
        --ux-gantt-task-panel-width: 180px;
      }

      .ux-gantt__toolbar {
        flex-wrap: wrap;
      }

      .ux-gantt__title {
        width: 100%;
        margin-bottom: var(--ux-space-xs);
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-gantt__bar,
      .ux-gantt__milestone,
      .ux-gantt__bar-progress,
      .ux-gantt__tooltip {
        transition: none;
      }

      .ux-gantt__task-expand svg {
        transition: none;
      }
    }

    /* ========================================
       Print Styles
    ======================================== */

    @media print {
      .ux-gantt {
        border: 1px solid #ccc;
        break-inside: avoid;
      }

      .ux-gantt__toolbar {
        display: none;
      }

      .ux-gantt__bar {
        print-color-adjust: exact;
        -webkit-print-color-adjust: exact;
      }
    }
  `;

  // Icons used in the component
  const icons = {
    chevronRight: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>',
    chevronLeft: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>',
    chevronsLeft: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 17l-5-5 5-5M18 17l-5-5 5-5"/></svg>',
    chevronsRight: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 7l5 5-5 5M6 7l5 5-5 5"/></svg>',
    calendar: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>',
    empty: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>'
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-gantt-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-gantt-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const ganttComponent = (config = {}) => ({
    // Data
    tasks: config.tasks || [],

    // View settings
    zoom: config.zoom || 'week', // 'day', 'week', 'month'
    startDate: config.startDate ? new Date(config.startDate) : null,
    endDate: config.endDate ? new Date(config.endDate) : null,

    // State
    selectedTask: null,
    expandedGroups: new Set(config.expandedGroups || []),
    scrollLeft: 0,
    taskPanelWidth: config.taskPanelWidth || 280,
    isResizing: false,
    isDragging: false,
    dragTask: null,
    dragType: null, // 'move', 'resize-start', 'resize-end'

    // Options
    readonly: config.readonly || false,
    showToday: config.showToday !== false,
    showWeekends: config.showWeekends !== false,
    showDependencies: config.showDependencies !== false,
    showProgress: config.showProgress !== false,
    highlightWeekends: config.highlightWeekends !== false,

    // Tooltip
    tooltip: {
      visible: false,
      x: 0,
      y: 0,
      task: null
    },

    // Labels
    labels: {
      tasks: config.labels?.tasks || 'Tasks',
      day: config.labels?.day || 'Day',
      week: config.labels?.week || 'Week',
      month: config.labels?.month || 'Month',
      today: config.labels?.today || 'Today',
      noTasks: config.labels?.noTasks || 'No tasks',
      noTasksDesc: config.labels?.noTasksDesc || 'Add tasks to see them on the Gantt chart.'
    },

    // Computed cell width based on zoom
    get cellWidth() {
      switch (this.zoom) {
        case 'day': return 40;
        case 'week': return 100;
        case 'month': return 120;
        default: return 100;
      }
    },

    // Initialize
    init() {
      // Calculate date range if not provided
      if (!this.startDate || !this.endDate) {
        this.calculateDateRange();
      }

      // Set up scroll sync
      this.$nextTick(() => {
        this.setupScrollSync();
      });

      // Listen for keyboard events
      this._keyHandler = this.handleKeydown.bind(this);
      document.addEventListener('keydown', this._keyHandler);
    },

    destroy() {
      if (this._keyHandler) {
        document.removeEventListener('keydown', this._keyHandler);
      }
    },

    // Calculate date range from tasks
    calculateDateRange() {
      if (this.tasks.length === 0) {
        const today = new Date();
        this.startDate = new Date(today.getFullYear(), today.getMonth(), 1);
        this.endDate = new Date(today.getFullYear(), today.getMonth() + 2, 0);
        return;
      }

      let minDate = null;
      let maxDate = null;

      const processTask = (task) => {
        if (task.start) {
          const start = new Date(task.start);
          if (!minDate || start < minDate) minDate = start;
        }
        if (task.end) {
          const end = new Date(task.end);
          if (!maxDate || end > maxDate) maxDate = end;
        }
        if (task.date) {
          const date = new Date(task.date);
          if (!minDate || date < minDate) minDate = date;
          if (!maxDate || date > maxDate) maxDate = date;
        }
        if (task.children) {
          task.children.forEach(processTask);
        }
      };

      this.tasks.forEach(processTask);

      // Add padding
      if (minDate) {
        this.startDate = new Date(minDate);
        this.startDate.setDate(this.startDate.getDate() - 7);
      }
      if (maxDate) {
        this.endDate = new Date(maxDate);
        this.endDate.setDate(this.endDate.getDate() + 14);
      }
    },

    // Setup scroll synchronization
    setupScrollSync() {
      const chartScroll = this.$refs.chartScroll;
      const tasksBody = this.$refs.tasksBody;

      if (chartScroll && tasksBody) {
        chartScroll.addEventListener('scroll', () => {
          tasksBody.scrollTop = chartScroll.scrollTop;
          this.scrollLeft = chartScroll.scrollLeft;
        });

        tasksBody.addEventListener('scroll', () => {
          chartScroll.scrollTop = tasksBody.scrollTop;
        });
      }
    },

    // Get flattened task list (with expanded groups)
    get flattenedTasks() {
      const result = [];

      const flatten = (tasks, level = 0, parentId = null) => {
        tasks.forEach(task => {
          result.push({
            ...task,
            _level: level,
            _parentId: parentId,
            _hasChildren: task.children && task.children.length > 0
          });

          if (task.children && task.children.length > 0 && this.expandedGroups.has(task.id)) {
            flatten(task.children, level + 1, task.id);
          }
        });
      };

      flatten(this.tasks);
      return result;
    },

    // Generate timeline dates
    get timelineDates() {
      const dates = [];
      const current = new Date(this.startDate);

      while (current <= this.endDate) {
        dates.push(new Date(current));

        switch (this.zoom) {
          case 'day':
            current.setDate(current.getDate() + 1);
            break;
          case 'week':
            current.setDate(current.getDate() + 7);
            break;
          case 'month':
            current.setMonth(current.getMonth() + 1);
            break;
        }
      }

      return dates;
    },

    // Get total chart width
    get chartWidth() {
      return this.timelineDates.length * this.cellWidth;
    },

    // Format header date based on zoom level
    formatHeaderDate(date, isPrimary = false) {
      const options = { month: 'short' };

      switch (this.zoom) {
        case 'day':
          if (isPrimary) {
            return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
          }
          return date.getDate();
        case 'week':
          if (isPrimary) {
            return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
          }
          return `W${this.getWeekNumber(date)}`;
        case 'month':
          if (isPrimary) {
            return date.getFullYear();
          }
          return date.toLocaleDateString('en-US', options);
      }
    },

    // Get week number
    getWeekNumber(date) {
      const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      const dayNum = d.getUTCDay() || 7;
      d.setUTCDate(d.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    },

    // Check if date is weekend
    isWeekend(date) {
      const day = date.getDay();
      return day === 0 || day === 6;
    },

    // Check if date is today
    isToday(date) {
      const today = new Date();
      return date.getDate() === today.getDate() &&
             date.getMonth() === today.getMonth() &&
             date.getFullYear() === today.getFullYear();
    },

    // Get today's position on chart
    get todayPosition() {
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      if (today < this.startDate || today > this.endDate) {
        return null;
      }

      const daysDiff = Math.floor((today - this.startDate) / (1000 * 60 * 60 * 24));

      switch (this.zoom) {
        case 'day':
          return daysDiff * this.cellWidth;
        case 'week':
          return (daysDiff / 7) * this.cellWidth;
        case 'month':
          const monthsDiff = (today.getFullYear() - this.startDate.getFullYear()) * 12 +
                            (today.getMonth() - this.startDate.getMonth());
          const dayOfMonth = today.getDate();
          const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
          return (monthsDiff + (dayOfMonth / daysInMonth)) * this.cellWidth;
      }
    },

    // Calculate bar position and width
    getBarStyle(task) {
      if (task.type === 'milestone') {
        const date = new Date(task.date);
        const left = this.dateToPosition(date);
        return {
          left: `${left}px`,
          top: `${(40 - 16) / 2}px`
        };
      }

      const start = new Date(task.start);
      const end = new Date(task.end);

      const left = this.dateToPosition(start);
      const right = this.dateToPosition(end);
      const width = Math.max(right - left, 20);

      return {
        left: `${left}px`,
        width: `${width}px`
      };
    },

    // Convert date to X position
    dateToPosition(date) {
      const daysDiff = Math.floor((date - this.startDate) / (1000 * 60 * 60 * 24));

      switch (this.zoom) {
        case 'day':
          return daysDiff * this.cellWidth;
        case 'week':
          return (daysDiff / 7) * this.cellWidth;
        case 'month':
          const monthsDiff = (date.getFullYear() - this.startDate.getFullYear()) * 12 +
                            (date.getMonth() - this.startDate.getMonth());
          const dayOfMonth = date.getDate();
          const daysInMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
          return (monthsDiff + (dayOfMonth / daysInMonth)) * this.cellWidth;
      }
    },

    // Get bar CSS class
    getBarClass(task) {
      const classes = ['ux-gantt__bar'];

      if (task.type === 'group') {
        classes.push('ux-gantt__bar--group');
      }

      if (task.status) {
        classes.push(`ux-gantt__bar--${task.status}`);
      }

      if (task.category) {
        classes.push(`ux-gantt__bar--category-${task.category}`);
      }

      if (this.selectedTask === task.id) {
        classes.push('ux-gantt__bar--selected');
      }

      if (this.isDragging && this.dragTask === task.id) {
        classes.push('ux-gantt__bar--dragging');
      }

      return classes.join(' ');
    },

    // Zoom controls
    setZoom(level) {
      this.zoom = level;
      this.calculateDateRange();
      this.$dispatch('gantt:zoom', { zoom: level });
    },

    // Navigation
    scrollToToday() {
      const chartScroll = this.$refs.chartScroll;
      if (chartScroll && this.todayPosition !== null) {
        chartScroll.scrollLeft = this.todayPosition - chartScroll.clientWidth / 2;
      }
    },

    scrollToStart() {
      const chartScroll = this.$refs.chartScroll;
      if (chartScroll) {
        chartScroll.scrollLeft = 0;
      }
    },

    scrollToEnd() {
      const chartScroll = this.$refs.chartScroll;
      if (chartScroll) {
        chartScroll.scrollLeft = chartScroll.scrollWidth;
      }
    },

    navigate(direction) {
      const chartScroll = this.$refs.chartScroll;
      if (chartScroll) {
        const scrollAmount = chartScroll.clientWidth * 0.8;
        chartScroll.scrollLeft += direction === 'next' ? scrollAmount : -scrollAmount;
      }
    },

    // Task interaction
    toggleGroup(taskId) {
      if (this.expandedGroups.has(taskId)) {
        this.expandedGroups.delete(taskId);
      } else {
        this.expandedGroups.add(taskId);
      }
      this.$dispatch('gantt:toggle-group', { taskId, expanded: this.expandedGroups.has(taskId) });
    },

    selectTask(task) {
      this.selectedTask = task.id;
      this.$dispatch('gantt:select', { task });
    },

    // Tooltip
    showTooltip(task, event) {
      this.tooltip = {
        visible: true,
        x: event.clientX + 10,
        y: event.clientY + 10,
        task
      };
    },

    hideTooltip() {
      this.tooltip.visible = false;
    },

    // Drag & drop (for editable mode)
    startDrag(task, type, event) {
      if (this.readonly) return;

      this.isDragging = true;
      this.dragTask = task.id;
      this.dragType = type;
      this._dragStartX = event.clientX;
      this._dragStartDate = new Date(type === 'resize-end' ? task.end : task.start);

      document.addEventListener('mousemove', this._onDrag = this.onDrag.bind(this));
      document.addEventListener('mouseup', this._onDragEnd = this.endDrag.bind(this));
    },

    onDrag(event) {
      if (!this.isDragging) return;

      const dx = event.clientX - this._dragStartX;
      let daysDelta = 0;

      switch (this.zoom) {
        case 'day':
          daysDelta = Math.round(dx / this.cellWidth);
          break;
        case 'week':
          daysDelta = Math.round((dx / this.cellWidth) * 7);
          break;
        case 'month':
          daysDelta = Math.round((dx / this.cellWidth) * 30);
          break;
      }

      const task = this.flattenedTasks.find(t => t.id === this.dragTask);
      if (!task) return;

      const newDate = new Date(this._dragStartDate);
      newDate.setDate(newDate.getDate() + daysDelta);

      if (this.dragType === 'move') {
        const duration = new Date(task.end) - new Date(task.start);
        task.start = newDate.toISOString().split('T')[0];
        task.end = new Date(newDate.getTime() + duration).toISOString().split('T')[0];
      } else if (this.dragType === 'resize-start') {
        task.start = newDate.toISOString().split('T')[0];
      } else if (this.dragType === 'resize-end') {
        task.end = newDate.toISOString().split('T')[0];
      }
    },

    endDrag() {
      if (this.isDragging) {
        const task = this.flattenedTasks.find(t => t.id === this.dragTask);
        this.$dispatch('gantt:task-update', { task });
      }

      this.isDragging = false;
      this.dragTask = null;
      this.dragType = null;

      document.removeEventListener('mousemove', this._onDrag);
      document.removeEventListener('mouseup', this._onDragEnd);
    },

    // Panel resize
    startResize(event) {
      this.isResizing = true;
      this._resizeStartX = event.clientX;
      this._resizeStartWidth = this.taskPanelWidth;

      document.addEventListener('mousemove', this._onResize = this.onResize.bind(this));
      document.addEventListener('mouseup', this._onResizeEnd = this.endResize.bind(this));
    },

    onResize(event) {
      if (!this.isResizing) return;
      const dx = event.clientX - this._resizeStartX;
      this.taskPanelWidth = Math.max(150, Math.min(500, this._resizeStartWidth + dx));
    },

    endResize() {
      this.isResizing = false;
      document.removeEventListener('mousemove', this._onResize);
      document.removeEventListener('mouseup', this._onResizeEnd);
    },

    // Keyboard navigation
    handleKeydown(event) {
      if (!this.selectedTask) return;

      if (event.key === 'Escape') {
        this.selectedTask = null;
      }
    },

    // Generate dependency paths (SVG)
    getDependencyPaths() {
      const paths = [];

      this.flattenedTasks.forEach((task, index) => {
        if (task.dependencies && task.dependencies.length > 0) {
          task.dependencies.forEach(depId => {
            const depIndex = this.flattenedTasks.findIndex(t => t.id === depId);
            if (depIndex === -1) return;

            const depTask = this.flattenedTasks[depIndex];
            const depEnd = this.dateToPosition(new Date(depTask.end || depTask.date));
            const taskStart = this.dateToPosition(new Date(task.start || task.date));

            const startY = depIndex * 40 + 20;
            const endY = index * 40 + 20;

            // Simple right-angle path
            const midX = depEnd + 15;

            paths.push({
              path: `M ${depEnd} ${startY} L ${midX} ${startY} L ${midX} ${endY} L ${taskStart - 5} ${endY}`,
              arrowX: taskStart - 5,
              arrowY: endY
            });
          });
        }
      });

      return paths;
    },

    // Get icon HTML
    getIcon(name) {
      return icons[name] || '';
    },

    // Format date for display
    formatDate(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxGantt', ganttComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxGantt', ganttComponent);
    });
  }

})();

/**
 * UX Gauge / Meter Component
 * Visual gauge/meter indicator with arc, needle, and segments
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Gauge - Base
    ======================================== */

    .ux-gauge {
      position: relative;
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      font-family: var(--ux-font-family);
    }

    .ux-gauge__svg {
      display: block;
      overflow: visible;
    }

    /* ========================================
       Arc Track & Fill
    ======================================== */

    .ux-gauge__track {
      fill: none;
      stroke: var(--ux-surface-secondary);
      stroke-linecap: round;
    }

    .ux-gauge__fill {
      fill: none;
      stroke: var(--ux-primary);
      stroke-linecap: round;
      transition: stroke-dashoffset var(--ux-transition-slow) var(--ux-ease);
    }

    /* Color variants */
    .ux-gauge--success .ux-gauge__fill {
      stroke: var(--ux-success);
    }

    .ux-gauge--warning .ux-gauge__fill {
      stroke: var(--ux-warning);
    }

    .ux-gauge--danger .ux-gauge__fill {
      stroke: var(--ux-danger);
    }

    /* ========================================
       Segments (Multi-color)
    ======================================== */

    .ux-gauge__segment {
      fill: none;
      stroke-linecap: round;
      opacity: 0.25;
    }

    .ux-gauge__segment--active {
      opacity: 1;
    }

    .ux-gauge__segment--danger {
      stroke: var(--ux-danger);
    }

    .ux-gauge__segment--warning {
      stroke: var(--ux-warning);
    }

    .ux-gauge__segment--success {
      stroke: var(--ux-success);
    }

    /* ========================================
       Needle
    ======================================== */

    .ux-gauge__needle {
      fill: var(--ux-text);
      transform-origin: center center;
      transition: transform var(--ux-transition-slow) var(--ux-ease-bounce);
    }

    .ux-gauge__needle-center {
      fill: var(--ux-surface);
      stroke: var(--ux-border-color);
      stroke-width: 2;
    }

    /* ========================================
       Value Display
    ======================================== */

    .ux-gauge__value-container {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .ux-gauge__value {
      font-size: 2rem;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      color: var(--ux-text);
      line-height: 1;
    }

    .ux-gauge__unit {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ux-text-secondary);
      margin-top: 0.25rem;
    }

    .ux-gauge__label {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--ux-text-tertiary);
      margin-top: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* ========================================
       Min/Max Labels
    ======================================== */

    .ux-gauge__labels {
      display: flex;
      justify-content: space-between;
      width: 100%;
      margin-top: 0.5rem;
      padding: 0 0.5rem;
    }

    .ux-gauge__min,
    .ux-gauge__max {
      font-size: 0.75rem;
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Ticks
    ======================================== */

    .ux-gauge__tick {
      stroke: var(--ux-border-color);
      stroke-width: 2;
    }

    .ux-gauge__tick--major {
      stroke-width: 3;
      stroke: var(--ux-text-secondary);
    }

    .ux-gauge__tick-label {
      fill: var(--ux-text-tertiary);
      font-size: 10px;
      text-anchor: middle;
    }

    /* ========================================
       Size Variants
    ======================================== */

    /* Small */
    .ux-gauge--sm {
      --gauge-size: 120px;
    }

    .ux-gauge--sm .ux-gauge__value {
      font-size: 1.25rem;
    }

    .ux-gauge--sm .ux-gauge__unit {
      font-size: 0.75rem;
    }

    /* Default */
    .ux-gauge--md {
      --gauge-size: 180px;
    }

    /* Large */
    .ux-gauge--lg {
      --gauge-size: 240px;
    }

    .ux-gauge--lg .ux-gauge__value {
      font-size: 2.5rem;
    }

    .ux-gauge--lg .ux-gauge__unit {
      font-size: 1rem;
    }

    /* Extra Large */
    .ux-gauge--xl {
      --gauge-size: 320px;
    }

    .ux-gauge--xl .ux-gauge__value {
      font-size: 3rem;
    }

    .ux-gauge--xl .ux-gauge__unit {
      font-size: 1.125rem;
    }

    /* ========================================
       Arc Angles
    ======================================== */

    .ux-gauge--half {
      /* 180 degree arc (default) */
    }

    .ux-gauge--three-quarter {
      /* 270 degree arc */
    }

    .ux-gauge--full {
      /* 360 degree arc */
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-gauge--glass .ux-gauge__track {
      stroke: var(--ux-glass-bg);
    }

    .ux-gauge--glass .ux-gauge__needle-center {
      fill: var(--ux-glass-bg);
      stroke: var(--ux-glass-border);
    }

    /* ========================================
       Animated
    ======================================== */

    .ux-gauge--animated .ux-gauge__fill {
      animation: ux-gauge-fill 1s ease-out forwards;
    }

    @keyframes ux-gauge-fill {
      from {
        stroke-dashoffset: var(--gauge-circumference);
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-gauge__track {
        stroke: var(--ux-surface-secondary);
      }
    }

    .ux-dark .ux-gauge__track {
      stroke: var(--ux-surface-secondary);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-gauge__fill,
      .ux-gauge__needle {
        transition: none;
      }

      .ux-gauge--animated .ux-gauge__fill {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-gauge-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-gauge-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for gauge
  const gaugeData = (options = {}) => ({
    // Configuration
    value: options.value ?? 0,
    min: options.min ?? 0,
    max: options.max ?? 100,
    size: options.size || 180,
    strokeWidth: options.strokeWidth || 12,
    startAngle: options.startAngle ?? -135,
    endAngle: options.endAngle ?? 135,
    unit: options.unit || '',
    label: options.label || '',
    showValue: options.showValue ?? true,
    showLabels: options.showLabels ?? true,
    showNeedle: options.showNeedle ?? false,
    showTicks: options.showTicks ?? false,
    tickCount: options.tickCount || 10,
    animated: options.animated ?? true,
    decimals: options.decimals ?? 0,

    // Segments (for multi-color gauge)
    segments: options.segments || null,
    // Example: [
    //   { value: 30, color: 'danger' },
    //   { value: 60, color: 'warning' },
    //   { value: 100, color: 'success' }
    // ]

    // Thresholds for auto-color
    thresholds: options.thresholds || null,
    // Example: { warning: 60, danger: 80 }

    // Computed properties
    get normalizedValue() {
      return Math.min(Math.max(this.value, this.min), this.max);
    },

    get percentage() {
      return ((this.normalizedValue - this.min) / (this.max - this.min)) * 100;
    },

    get radius() {
      return (this.size - this.strokeWidth) / 2;
    },

    get center() {
      return this.size / 2;
    },

    get angleRange() {
      return this.endAngle - this.startAngle;
    },

    get circumference() {
      return 2 * Math.PI * this.radius * (this.angleRange / 360);
    },

    get dashOffset() {
      return this.circumference * (1 - this.percentage / 100);
    },

    get needleAngle() {
      return this.startAngle + (this.percentage / 100) * this.angleRange;
    },

    get valueColor() {
      if (this.thresholds) {
        if (this.percentage >= (this.thresholds.danger || 80)) return 'danger';
        if (this.percentage >= (this.thresholds.warning || 60)) return 'warning';
        return 'success';
      }
      return null;
    },

    get displayValue() {
      return this.normalizedValue.toFixed(this.decimals);
    },

    // SVG path calculations
    get arcPath() {
      const startRad = (this.startAngle * Math.PI) / 180;
      const endRad = (this.endAngle * Math.PI) / 180;

      const startX = this.center + this.radius * Math.cos(startRad);
      const startY = this.center + this.radius * Math.sin(startRad);
      const endX = this.center + this.radius * Math.cos(endRad);
      const endY = this.center + this.radius * Math.sin(endRad);

      const largeArc = this.angleRange > 180 ? 1 : 0;

      return `M ${startX} ${startY} A ${this.radius} ${this.radius} 0 ${largeArc} 1 ${endX} ${endY}`;
    },

    // Get point on arc at given percentage
    getPointOnArc(percent) {
      const angle = this.startAngle + (percent / 100) * this.angleRange;
      const rad = (angle * Math.PI) / 180;
      return {
        x: this.center + this.radius * Math.cos(rad),
        y: this.center + this.radius * Math.sin(rad)
      };
    },

    // Get tick positions
    get ticks() {
      const ticks = [];
      const step = 100 / this.tickCount;

      for (let i = 0; i <= this.tickCount; i++) {
        const percent = i * step;
        const angle = this.startAngle + (percent / 100) * this.angleRange;
        const rad = (angle * Math.PI) / 180;

        const innerRadius = this.radius - 8;
        const outerRadius = this.radius + 4;
        const labelRadius = this.radius + 16;

        ticks.push({
          x1: this.center + innerRadius * Math.cos(rad),
          y1: this.center + innerRadius * Math.sin(rad),
          x2: this.center + outerRadius * Math.cos(rad),
          y2: this.center + outerRadius * Math.sin(rad),
          labelX: this.center + labelRadius * Math.cos(rad),
          labelY: this.center + labelRadius * Math.sin(rad),
          value: Math.round(this.min + (percent / 100) * (this.max - this.min)),
          isMajor: i % 2 === 0
        });
      }

      return ticks;
    },

    // Get segments for multi-color gauge
    getSegments() {
      if (!this.segments) return [];

      const result = [];
      let prevValue = this.min;

      for (const segment of this.segments) {
        const startPercent = ((prevValue - this.min) / (this.max - this.min)) * 100;
        const endPercent = ((segment.value - this.min) / (this.max - this.min)) * 100;
        const segmentLength = this.circumference * ((endPercent - startPercent) / 100);

        result.push({
          ...segment,
          startPercent,
          endPercent,
          length: segmentLength,
          offset: this.circumference * (startPercent / 100),
          isActive: this.percentage >= startPercent
        });

        prevValue = segment.value;
      }

      return result;
    },

    // Methods
    setValue(newValue) {
      this.value = newValue;
      this.$dispatch('gauge:change', {
        value: this.normalizedValue,
        percentage: this.percentage
      });
    },

    increment(amount = 1) {
      this.setValue(Math.min(this.value + amount, this.max));
    },

    decrement(amount = 1) {
      this.setValue(Math.max(this.value - amount, this.min));
    },

    // Get needle path
    get needlePath() {
      const length = this.radius - 10;
      const width = 4;

      return `M ${-width} 0 L 0 ${-length} L ${width} 0 L 0 ${width * 2} Z`;
    },

    // Value container position
    get valueContainerStyle() {
      // For half circle, position at bottom center
      if (this.angleRange <= 180) {
        return {
          bottom: '10%',
          left: '50%',
          transform: 'translateX(-50%)'
        };
      }
      // For larger arcs, center it
      return {
        top: '50%',
        left: '50%',
        transform: 'translate(-50%, -50%)'
      };
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxGauge', gaugeData);
  }

})();

/**
 * UX Icon Button Component
 * Botones circulares/cuadrados solo con icono
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Icon Button
    ======================================== */

    .ux-icon-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-icon-button-size, 44px);
      height: var(--ux-icon-button-size, 44px);
      padding: 0;
      font-family: var(--ux-font-family);
      font-size: var(--ux-icon-button-icon-size, 20px);
      line-height: 1;
      /* Uses composition system: combine with .ux-color-* classes */
      background-color: var(--ux-variant-bg, transparent);
      color: var(--ux-variant-color, var(--ux-text));
      border: 2px solid var(--ux-variant-border, transparent);
      border-radius: var(--ux-icon-button-radius, 50%);
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      transition: var(--ux-transition-colors),
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
    }

    .ux-icon-button:hover {
      background-color: var(--ux-variant-bg-hover, var(--ux-surface-secondary));
    }

    /* Ripple effect */
    .ux-icon-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease, opacity 0.4s ease;
      opacity: 0;
      pointer-events: none;
    }

    .ux-icon-button:active::before {
      width: 200%;
      height: 200%;
      opacity: 1;
      transition: 0s;
    }

    /* Press effect */
    .ux-icon-button:active {
      transform: scale(0.92);
    }

    /* Focus state */
    .ux-icon-button:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    /* Icon styling */
    .ux-icon-button svg {
      width: 1em;
      height: 1em;
      flex-shrink: 0;
    }

    /* ========================================
       Filled Variant
       Use with .ux-color-* classes
    ======================================== */

    .ux-icon-button--filled {
      background-color: var(--ux-variant-bg, var(--ux-primary));
      color: var(--ux-variant-color, var(--ux-primary-contrast));
    }

    .ux-icon-button--filled:hover {
      background-color: var(--ux-variant-bg-hover, var(--ux-primary-shade));
    }

    /* ========================================
       Outline Variant
    ======================================== */

    .ux-icon-button--outline {
      background-color: transparent;
      color: var(--ux-variant-color, var(--ux-text));
      border: 2px solid var(--ux-variant-border, var(--ux-border-color));
    }

    .ux-icon-button--outline:hover {
      background-color: var(--ux-variant-bg-hover, var(--ux-surface-secondary));
    }

    /* ========================================
       Soft/Tinted Variant
    ======================================== */

    .ux-icon-button--soft {
      background-color: var(--ux-variant-bg, var(--ux-surface-secondary));
      color: var(--ux-variant-color, var(--ux-text));
    }

    .ux-icon-button--soft:hover {
      background-color: var(--ux-variant-bg-hover, var(--ux-surface-tertiary));
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-icon-button--xs {
      --ux-icon-button-size: 28px;
      --ux-icon-button-icon-size: 14px;
    }

    .ux-icon-button--sm {
      --ux-icon-button-size: 36px;
      --ux-icon-button-icon-size: 16px;
    }

    .ux-icon-button--lg {
      --ux-icon-button-size: 52px;
      --ux-icon-button-icon-size: 24px;
    }

    .ux-icon-button--xl {
      --ux-icon-button-size: 64px;
      --ux-icon-button-icon-size: 28px;
    }

    /* ========================================
       Shapes
    ======================================== */

    .ux-icon-button--square {
      --ux-icon-button-radius: var(--ux-border-radius);
    }

    .ux-icon-button--rounded {
      --ux-icon-button-radius: var(--ux-border-radius-lg);
    }

    /* ========================================
       States
    ======================================== */

    .ux-icon-button--disabled,
    .ux-icon-button:disabled {
      opacity: 0.5;
      pointer-events: none;
      cursor: not-allowed;
    }

    .ux-icon-button--loading {
      pointer-events: none;
    }

    .ux-icon-button--loading > *:not(.ux-icon-button__spinner) {
      opacity: 0;
    }

    .ux-icon-button__spinner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 1em;
      height: 1em;
      border: 2px solid currentColor;
      border-top-color: transparent;
      border-radius: 50%;
      animation: ux-icon-button-spin 0.8s linear infinite;
    }

    @keyframes ux-icon-button-spin {
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* Active/Pressed state */
    .ux-icon-button--active,
    .ux-icon-button[aria-pressed="true"] {
      background-color: var(--ux-variant-bg, var(--ux-primary));
      color: var(--ux-variant-color, var(--ux-primary-contrast));
    }

    /* ========================================
       Badge (notification dot)
    ======================================== */

    .ux-icon-button--badge {
      position: relative;
    }

    .ux-icon-button--badge::after {
      content: '';
      position: absolute;
      top: 4px;
      right: 4px;
      width: 8px;
      height: 8px;
      background-color: var(--ux-danger);
      border: 2px solid var(--ux-surface);
      border-radius: 50%;
    }

    .ux-icon-button--badge-count {
      position: relative;
    }

    .ux-icon-button__badge {
      position: absolute;
      top: 0;
      right: 0;
      min-width: 18px;
      height: 18px;
      padding: 0 5px;
      font-size: 11px;
      font-weight: 600;
      line-height: 18px;
      text-align: center;
      background-color: var(--ux-danger);
      color: white;
      border-radius: 9px;
      transform: translate(25%, -25%);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-icon-button--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
      color: var(--ux-text);
    }

    .ux-icon-button--glass:hover {
      background: var(--ux-glass-bg-thick);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-icon-button:hover {
        background-color: var(--ux-variant-bg-hover, var(--ux-surface-secondary));
      }

      .ux-icon-button--badge::after {
        border-color: var(--ux-surface);
      }
    }

    .ux-dark .ux-icon-button:hover {
      background-color: var(--ux-variant-bg-hover, var(--ux-surface-secondary));
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-icon-button {
        transition: none;
      }

      .ux-icon-button:active {
        transform: none;
      }

      .ux-icon-button::before {
        display: none;
      }

      .ux-icon-button__spinner {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-icon-button-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-icon-button-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

})();

/**
 * UX Image Crop Component
 * Image cropping with drag handles, aspect ratio, zoom, and rotate
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Image Crop
    ======================================== */

    .ux-image-crop {
      position: relative;
      width: 100%;
      max-width: 600px;
      background-color: var(--ux-gray-900);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
      touch-action: none;
    }

    /* ========================================
       Canvas / Workspace
    ======================================== */

    .ux-image-crop__canvas {
      position: relative;
      width: 100%;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background-color: var(--ux-gray-900);
    }

    .ux-image-crop__canvas--empty {
      min-height: 200px;
      border: 2px dashed var(--ux-gray-600);
      background-color: var(--ux-gray-800);
      cursor: pointer;
    }

    .ux-image-crop__canvas--empty:hover {
      border-color: var(--ux-primary);
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-image-crop__placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
      color: var(--ux-gray-400);
      text-align: center;
      padding: var(--ux-space-xl);
    }

    .ux-image-crop__placeholder svg {
      width: 48px;
      height: 48px;
      opacity: 0.6;
    }

    .ux-image-crop__placeholder-text {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
    }

    .ux-image-crop__placeholder-hint {
      font-size: var(--ux-font-size-sm);
      opacity: 0.7;
    }

    /* Image Container */
    .ux-image-crop__image-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    .ux-image-crop__image {
      max-width: 100%;
      max-height: 100%;
      transform-origin: center center;
      pointer-events: none;
    }

    /* ========================================
       Overlay (darkens non-crop area)
    ======================================== */

    .ux-image-crop__overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .ux-image-crop__overlay-bg {
      position: absolute;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.5);
      pointer-events: none;
    }

    /* ========================================
       Crop Area
    ======================================== */

    .ux-image-crop__crop-area {
      position: absolute;
      border: 2px solid white;
      box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
      cursor: move;
      touch-action: none;
    }

    .ux-image-crop__crop-area::before {
      content: '';
      position: absolute;
      inset: 0;
      background: transparent;
    }

    /* Grid Lines */
    .ux-image-crop__grid {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .ux-image-crop__grid--thirds {
      background-image:
        linear-gradient(to right, rgba(255,255,255,0.3) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,0.3) 1px, transparent 1px);
      background-size: 33.333% 33.333%;
      background-position: center;
    }

    .ux-image-crop--dragging .ux-image-crop__grid {
      opacity: 1;
    }

    .ux-image-crop__grid {
      opacity: 0;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-image-crop__crop-area:hover .ux-image-crop__grid,
    .ux-image-crop--active .ux-image-crop__grid {
      opacity: 1;
    }

    /* ========================================
       Resize Handles
    ======================================== */

    .ux-image-crop__handles {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .ux-image-crop__handle {
      position: absolute;
      width: 20px;
      height: 20px;
      background-color: white;
      border: 2px solid var(--ux-primary);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      pointer-events: auto;
      cursor: pointer;
      transition: transform var(--ux-transition-fast) var(--ux-ease);
      touch-action: none;
    }

    .ux-image-crop__handle:hover,
    .ux-image-crop__handle:active {
      transform: translate(-50%, -50%) scale(1.2);
    }

    /* Corner handles */
    .ux-image-crop__handle--nw { top: 0; left: 0; cursor: nwse-resize; }
    .ux-image-crop__handle--ne { top: 0; left: 100%; cursor: nesw-resize; }
    .ux-image-crop__handle--sw { top: 100%; left: 0; cursor: nesw-resize; }
    .ux-image-crop__handle--se { top: 100%; left: 100%; cursor: nwse-resize; }

    /* Edge handles */
    .ux-image-crop__handle--n { top: 0; left: 50%; cursor: ns-resize; }
    .ux-image-crop__handle--s { top: 100%; left: 50%; cursor: ns-resize; }
    .ux-image-crop__handle--w { top: 50%; left: 0; cursor: ew-resize; }
    .ux-image-crop__handle--e { top: 50%; left: 100%; cursor: ew-resize; }

    /* Hide edge handles when aspect ratio is locked */
    .ux-image-crop--aspect-locked .ux-image-crop__handle--n,
    .ux-image-crop--aspect-locked .ux-image-crop__handle--s,
    .ux-image-crop--aspect-locked .ux-image-crop__handle--w,
    .ux-image-crop--aspect-locked .ux-image-crop__handle--e {
      display: none;
    }

    /* Mobile-friendly larger handles */
    @media (max-width: 767px) {
      .ux-image-crop__handle {
        width: 28px;
        height: 28px;
      }
    }

    /* ========================================
       Controls Bar
    ======================================== */

    .ux-image-crop__controls {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
      background-color: var(--ux-surface);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-image-crop__control-row {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
    }

    .ux-image-crop__control-group {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      flex: 1;
    }

    .ux-image-crop__control-label {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
      min-width: 50px;
    }

    .ux-image-crop__control-value {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
      min-width: 40px;
      text-align: right;
    }

    /* Zoom Slider */
    .ux-image-crop__slider {
      flex: 1;
      height: 4px;
      -webkit-appearance: none;
      appearance: none;
      background: var(--ux-gray-200);
      border-radius: 2px;
      outline: none;
      cursor: pointer;
    }

    .ux-image-crop__slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: var(--ux-primary);
      border-radius: 50%;
      cursor: pointer;
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-image-crop__slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
    }

    .ux-image-crop__slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: var(--ux-primary);
      border-radius: 50%;
      border: none;
      cursor: pointer;
    }

    /* Aspect Ratio Buttons */
    .ux-image-crop__aspect-buttons {
      display: flex;
      gap: var(--ux-space-xs);
      flex-wrap: wrap;
    }

    .ux-image-crop__aspect-btn {
      padding: var(--ux-space-xs) var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      background-color: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-sm);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-image-crop__aspect-btn:hover {
      background-color: var(--ux-surface-tertiary);
      color: var(--ux-text);
    }

    .ux-image-crop__aspect-btn--active {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
      color: white;
    }

    .ux-image-crop__aspect-btn--active:hover {
      background-color: var(--ux-primary-shade);
      color: white;
    }

    /* Rotate Buttons */
    .ux-image-crop__rotate-buttons {
      display: flex;
      gap: var(--ux-space-xs);
    }

    .ux-image-crop__rotate-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background-color: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-sm);
      color: var(--ux-text);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-image-crop__rotate-btn:hover {
      background-color: var(--ux-surface-tertiary);
    }

    .ux-image-crop__rotate-btn:active {
      transform: scale(0.95);
    }

    .ux-image-crop__rotate-btn svg {
      width: 20px;
      height: 20px;
    }

    /* Action Buttons */
    .ux-image-crop__actions {
      display: flex;
      gap: var(--ux-space-sm);
      justify-content: flex-end;
      padding-top: var(--ux-space-sm);
      border-top: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Preview
    ======================================== */

    .ux-image-crop__preview {
      position: relative;
      background-color: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-md);
      overflow: hidden;
    }

    .ux-image-crop__preview-label {
      position: absolute;
      top: var(--ux-space-xs);
      left: var(--ux-space-xs);
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      color: var(--ux-text-secondary);
      background-color: rgba(255, 255, 255, 0.9);
      padding: 2px 6px;
      border-radius: var(--ux-border-radius-sm);
    }

    .ux-image-crop__preview-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Preview sizes */
    .ux-image-crop__preview--sm {
      width: 80px;
      height: 80px;
    }

    .ux-image-crop__preview--md {
      width: 120px;
      height: 120px;
    }

    .ux-image-crop__preview--lg {
      width: 200px;
      height: 200px;
    }

    .ux-image-crop__preview--circle {
      border-radius: 50%;
    }

    /* ========================================
       Variants
    ======================================== */

    /* Compact variant */
    .ux-image-crop--compact .ux-image-crop__canvas {
      min-height: 200px;
    }

    .ux-image-crop--compact .ux-image-crop__controls {
      padding: var(--ux-space-sm);
    }

    /* Large variant */
    .ux-image-crop--lg .ux-image-crop__canvas {
      min-height: 400px;
    }

    /* Fullscreen variant */
    .ux-image-crop--fullscreen {
      position: fixed;
      inset: 0;
      max-width: none;
      border-radius: 0;
      z-index: var(--ux-z-modal);
    }

    .ux-image-crop--fullscreen .ux-image-crop__canvas {
      flex: 1;
      min-height: 0;
    }

    /* Circle crop indicator */
    .ux-image-crop--circle .ux-image-crop__crop-area {
      border-radius: 50%;
    }

    .ux-image-crop--circle .ux-image-crop__crop-area::after {
      content: '';
      position: absolute;
      inset: -2px;
      border: 2px solid white;
      border-radius: 50%;
      pointer-events: none;
    }

    /* ========================================
       States
    ======================================== */

    .ux-image-crop--loading .ux-image-crop__canvas::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 32px;
      height: 32px;
      margin: -16px 0 0 -16px;
      border: 3px solid var(--ux-gray-600);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-image-crop-spin 0.8s linear infinite;
    }

    @keyframes ux-image-crop-spin {
      to { transform: rotate(360deg); }
    }

    .ux-image-crop--disabled {
      opacity: 0.6;
      pointer-events: none;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-image-crop__controls {
        background-color: var(--ux-gray-900);
        border-color: var(--ux-gray-700);
      }

      .ux-image-crop__slider {
        background: var(--ux-gray-700);
      }

      .ux-image-crop__aspect-btn {
        background-color: var(--ux-gray-800);
        border-color: var(--ux-gray-700);
        color: var(--ux-gray-300);
      }

      .ux-image-crop__aspect-btn:hover {
        background-color: var(--ux-gray-700);
        color: var(--ux-gray-100);
      }

      .ux-image-crop__rotate-btn {
        background-color: var(--ux-gray-800);
        border-color: var(--ux-gray-700);
        color: var(--ux-gray-200);
      }

      .ux-image-crop__rotate-btn:hover {
        background-color: var(--ux-gray-700);
      }

      .ux-image-crop__preview {
        background-color: var(--ux-gray-800);
        border-color: var(--ux-gray-700);
      }

      .ux-image-crop__preview-label {
        background-color: rgba(0, 0, 0, 0.8);
        color: var(--ux-gray-300);
      }
    }

    .ux-dark .ux-image-crop__controls {
      background-color: var(--ux-gray-900);
      border-color: var(--ux-gray-700);
    }

    .ux-dark .ux-image-crop__slider {
      background: var(--ux-gray-700);
    }

    .ux-dark .ux-image-crop__aspect-btn {
      background-color: var(--ux-gray-800);
      border-color: var(--ux-gray-700);
      color: var(--ux-gray-300);
    }

    .ux-dark .ux-image-crop__aspect-btn:hover {
      background-color: var(--ux-gray-700);
      color: var(--ux-gray-100);
    }

    .ux-dark .ux-image-crop__rotate-btn {
      background-color: var(--ux-gray-800);
      border-color: var(--ux-gray-700);
      color: var(--ux-gray-200);
    }

    .ux-dark .ux-image-crop__rotate-btn:hover {
      background-color: var(--ux-gray-700);
    }

    .ux-dark .ux-image-crop__preview {
      background-color: var(--ux-gray-800);
      border-color: var(--ux-gray-700);
    }

    .ux-dark .ux-image-crop__preview-label {
      background-color: rgba(0, 0, 0, 0.8);
      color: var(--ux-gray-300);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-image-crop__handle,
      .ux-image-crop__slider::-webkit-slider-thumb,
      .ux-image-crop__aspect-btn,
      .ux-image-crop__rotate-btn,
      .ux-image-crop__grid {
        transition: none;
      }

      .ux-image-crop--loading .ux-image-crop__canvas::after {
        animation: none;
      }
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-image-crop--glass .ux-image-crop__controls {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-image-crop--glass .ux-image-crop__aspect-btn,
    .ux-image-crop--glass .ux-image-crop__rotate-btn {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-image-crop-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-image-crop-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component
  const imageCropComponent = (config = {}) => ({
    // State
    imageSrc: config.imageSrc || null,
    imageLoaded: false,
    isLoading: false,

    // Image dimensions
    imageWidth: 0,
    imageHeight: 0,
    containerWidth: 0,
    containerHeight: 0,

    // Crop area (percentages relative to displayed image)
    cropX: 10,
    cropY: 10,
    cropWidth: 80,
    cropHeight: 80,

    // Transform
    zoom: config.zoom || 1,
    rotation: config.rotation || 0,
    minZoom: config.minZoom || 0.5,
    maxZoom: config.maxZoom || 3,

    // Aspect ratio
    aspectRatio: config.aspectRatio || null, // null = free, or value like 1, 4/3, 16/9
    aspectRatioLabel: config.aspectRatioLabel || 'Free',

    // Configuration
    showGrid: config.showGrid !== false,
    showPreview: config.showPreview !== false,
    previewSize: config.previewSize || 'md',
    circlePreview: config.circlePreview || false,
    outputFormat: config.outputFormat || 'image/jpeg',
    outputQuality: config.outputQuality || 0.92,

    // Drag state
    isDragging: false,
    isResizing: false,
    activeHandle: null,
    dragStartX: 0,
    dragStartY: 0,
    cropStartX: 0,
    cropStartY: 0,
    cropStartWidth: 0,
    cropStartHeight: 0,

    // References
    _imageEl: null,
    _canvasEl: null,
    _cropAreaEl: null,

    // Initialize
    init() {
      this.$nextTick(() => {
        this._canvasEl = this.$refs.canvas;
        this._cropAreaEl = this.$refs.cropArea;

        // Setup resize observer
        if (this._canvasEl && window.ResizeObserver) {
          const ro = new ResizeObserver(() => {
            this.updateContainerSize();
          });
          ro.observe(this._canvasEl);
        }

        // Load initial image if provided
        if (this.imageSrc) {
          this.loadImage(this.imageSrc);
        }

        // Global mouse/touch events for drag
        document.addEventListener('mousemove', this._onMouseMove.bind(this));
        document.addEventListener('mouseup', this._onMouseUp.bind(this));
        document.addEventListener('touchmove', this._onTouchMove.bind(this), { passive: false });
        document.addEventListener('touchend', this._onTouchEnd.bind(this));
      });
    },

    destroy() {
      document.removeEventListener('mousemove', this._onMouseMove.bind(this));
      document.removeEventListener('mouseup', this._onMouseUp.bind(this));
      document.removeEventListener('touchmove', this._onTouchMove.bind(this));
      document.removeEventListener('touchend', this._onTouchEnd.bind(this));
    },

    // Set image source
    setImage(src) {
      this.loadImage(src);
    },

    // Load image
    async loadImage(src) {
      this.isLoading = true;
      this.imageLoaded = false;

      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';

        img.onload = () => {
          this.imageSrc = src;
          this.imageWidth = img.naturalWidth;
          this.imageHeight = img.naturalHeight;
          this.imageLoaded = true;
          this.isLoading = false;
          this._imageEl = img;

          // Reset crop to full image with aspect ratio
          this.resetCrop();
          this.updateContainerSize();

          this.$dispatch('image-crop:load', {
            width: this.imageWidth,
            height: this.imageHeight
          });

          resolve({ width: this.imageWidth, height: this.imageHeight });
        };

        img.onerror = () => {
          this.isLoading = false;
          this.$dispatch('image-crop:error', { src });
          reject(new Error('Failed to load image'));
        };

        img.src = src;
      });
    },

    // Update container size
    updateContainerSize() {
      if (this._canvasEl) {
        this.containerWidth = this._canvasEl.offsetWidth;
        this.containerHeight = this._canvasEl.offsetHeight;
      }
    },

    // Reset crop to default
    resetCrop() {
      if (this.aspectRatio) {
        // Calculate crop area based on aspect ratio
        const imgAspect = this.imageWidth / this.imageHeight;
        const cropAspect = this.aspectRatio;

        if (cropAspect > imgAspect) {
          // Crop is wider than image
          this.cropWidth = 80;
          this.cropHeight = (this.cropWidth / cropAspect) * imgAspect;
        } else {
          // Crop is taller than image
          this.cropHeight = 80;
          this.cropWidth = (this.cropHeight * cropAspect) / imgAspect;
        }

        this.cropX = (100 - this.cropWidth) / 2;
        this.cropY = (100 - this.cropHeight) / 2;
      } else {
        this.cropX = 10;
        this.cropY = 10;
        this.cropWidth = 80;
        this.cropHeight = 80;
      }
    },

    // Set aspect ratio
    setAspectRatio(ratio, label) {
      this.aspectRatio = ratio;
      this.aspectRatioLabel = label || (ratio ? `${ratio}` : 'Free');

      if (ratio) {
        // Adjust current crop to match new aspect ratio
        const currentCenterX = this.cropX + this.cropWidth / 2;
        const currentCenterY = this.cropY + this.cropHeight / 2;
        const imgAspect = this.imageWidth / this.imageHeight;

        // Calculate new dimensions
        let newWidth = this.cropWidth;
        let newHeight = (this.cropWidth / ratio) * imgAspect;

        if (newHeight > 100) {
          newHeight = Math.min(this.cropHeight, 90);
          newWidth = (newHeight * ratio) / imgAspect;
        }

        // Center the new crop area
        this.cropWidth = Math.min(newWidth, 90);
        this.cropHeight = Math.min(newHeight, 90);
        this.cropX = Math.max(0, Math.min(100 - this.cropWidth, currentCenterX - this.cropWidth / 2));
        this.cropY = Math.max(0, Math.min(100 - this.cropHeight, currentCenterY - this.cropHeight / 2));
      }

      this.$dispatch('image-crop:aspect-change', { ratio, label: this.aspectRatioLabel });
    },

    // Zoom
    setZoom(level) {
      this.zoom = Math.max(this.minZoom, Math.min(this.maxZoom, level));
      this.$dispatch('image-crop:zoom', { zoom: this.zoom });
    },

    zoomIn(step = 0.1) {
      this.setZoom(this.zoom + step);
    },

    zoomOut(step = 0.1) {
      this.setZoom(this.zoom - step);
    },

    // Rotate
    rotate(degrees) {
      this.rotation = (this.rotation + degrees) % 360;
      if (this.rotation < 0) this.rotation += 360;
      this.$dispatch('image-crop:rotate', { rotation: this.rotation });
    },

    rotateLeft() {
      this.rotate(-90);
    },

    rotateRight() {
      this.rotate(90);
    },

    // Get image transform style
    get imageTransform() {
      return `scale(${this.zoom}) rotate(${this.rotation}deg)`;
    },

    // Get crop area style
    get cropAreaStyle() {
      return {
        left: `${this.cropX}%`,
        top: `${this.cropY}%`,
        width: `${this.cropWidth}%`,
        height: `${this.cropHeight}%`
      };
    },

    // Check if aspect ratio is locked
    get isAspectLocked() {
      return this.aspectRatio !== null;
    },

    // Drag/Resize handlers
    onCropMouseDown(e) {
      if (e.target.classList.contains('ux-image-crop__handle')) return;

      this.isDragging = true;
      this.dragStartX = e.clientX || e.touches?.[0]?.clientX || 0;
      this.dragStartY = e.clientY || e.touches?.[0]?.clientY || 0;
      this.cropStartX = this.cropX;
      this.cropStartY = this.cropY;

      this.$el.classList.add('ux-image-crop--active');
      e.preventDefault();
    },

    onCropTouchStart(e) {
      this.onCropMouseDown(e);
    },

    onHandleMouseDown(e, handle) {
      this.isResizing = true;
      this.activeHandle = handle;
      this.dragStartX = e.clientX || e.touches?.[0]?.clientX || 0;
      this.dragStartY = e.clientY || e.touches?.[0]?.clientY || 0;
      this.cropStartX = this.cropX;
      this.cropStartY = this.cropY;
      this.cropStartWidth = this.cropWidth;
      this.cropStartHeight = this.cropHeight;

      this.$el.classList.add('ux-image-crop--active');
      e.preventDefault();
      e.stopPropagation();
    },

    onHandleTouchStart(e, handle) {
      this.onHandleMouseDown(e, handle);
    },

    _onMouseMove(e) {
      if (!this.isDragging && !this.isResizing) return;

      const clientX = e.clientX || e.touches?.[0]?.clientX || 0;
      const clientY = e.clientY || e.touches?.[0]?.clientY || 0;

      const rect = this._canvasEl.getBoundingClientRect();
      const deltaXPercent = ((clientX - this.dragStartX) / rect.width) * 100;
      const deltaYPercent = ((clientY - this.dragStartY) / rect.height) * 100;

      if (this.isDragging) {
        // Move crop area
        let newX = this.cropStartX + deltaXPercent;
        let newY = this.cropStartY + deltaYPercent;

        // Constrain to bounds
        newX = Math.max(0, Math.min(100 - this.cropWidth, newX));
        newY = Math.max(0, Math.min(100 - this.cropHeight, newY));

        this.cropX = newX;
        this.cropY = newY;
      } else if (this.isResizing) {
        this._handleResize(deltaXPercent, deltaYPercent);
      }
    },

    _onTouchMove(e) {
      if (this.isDragging || this.isResizing) {
        e.preventDefault();
      }
      this._onMouseMove(e);
    },

    _onMouseUp() {
      this.isDragging = false;
      this.isResizing = false;
      this.activeHandle = null;
      this.$el.classList.remove('ux-image-crop--active');
    },

    _onTouchEnd() {
      this._onMouseUp();
    },

    _handleResize(deltaX, deltaY) {
      const handle = this.activeHandle;
      let newX = this.cropStartX;
      let newY = this.cropStartY;
      let newWidth = this.cropStartWidth;
      let newHeight = this.cropStartHeight;

      const imgAspect = this.imageWidth / this.imageHeight;
      const minSize = 10; // Minimum 10%

      // Calculate new dimensions based on handle
      switch (handle) {
        case 'se':
          newWidth = Math.max(minSize, this.cropStartWidth + deltaX);
          newHeight = this.aspectRatio
            ? (newWidth / this.aspectRatio) * imgAspect
            : Math.max(minSize, this.cropStartHeight + deltaY);
          break;
        case 'sw':
          newWidth = Math.max(minSize, this.cropStartWidth - deltaX);
          newHeight = this.aspectRatio
            ? (newWidth / this.aspectRatio) * imgAspect
            : Math.max(minSize, this.cropStartHeight + deltaY);
          newX = this.cropStartX + this.cropStartWidth - newWidth;
          break;
        case 'ne':
          newWidth = Math.max(minSize, this.cropStartWidth + deltaX);
          newHeight = this.aspectRatio
            ? (newWidth / this.aspectRatio) * imgAspect
            : Math.max(minSize, this.cropStartHeight - deltaY);
          if (!this.aspectRatio) {
            newY = this.cropStartY + this.cropStartHeight - newHeight;
          } else {
            newY = this.cropStartY - (newHeight - this.cropStartHeight);
          }
          break;
        case 'nw':
          newWidth = Math.max(minSize, this.cropStartWidth - deltaX);
          newHeight = this.aspectRatio
            ? (newWidth / this.aspectRatio) * imgAspect
            : Math.max(minSize, this.cropStartHeight - deltaY);
          newX = this.cropStartX + this.cropStartWidth - newWidth;
          newY = this.aspectRatio
            ? this.cropStartY + this.cropStartHeight - newHeight
            : this.cropStartY + this.cropStartHeight - newHeight;
          break;
        case 'n':
          if (!this.aspectRatio) {
            newHeight = Math.max(minSize, this.cropStartHeight - deltaY);
            newY = this.cropStartY + this.cropStartHeight - newHeight;
          }
          break;
        case 's':
          if (!this.aspectRatio) {
            newHeight = Math.max(minSize, this.cropStartHeight + deltaY);
          }
          break;
        case 'e':
          if (!this.aspectRatio) {
            newWidth = Math.max(minSize, this.cropStartWidth + deltaX);
          }
          break;
        case 'w':
          if (!this.aspectRatio) {
            newWidth = Math.max(minSize, this.cropStartWidth - deltaX);
            newX = this.cropStartX + this.cropStartWidth - newWidth;
          }
          break;
      }

      // Constrain to bounds
      newX = Math.max(0, newX);
      newY = Math.max(0, newY);
      newWidth = Math.min(100 - newX, newWidth);
      newHeight = Math.min(100 - newY, newHeight);

      // Apply
      this.cropX = newX;
      this.cropY = newY;
      this.cropWidth = newWidth;
      this.cropHeight = newHeight;
    },

    // Get cropped image as blob
    async getCroppedImage(format, quality) {
      if (!this._imageEl || !this.imageLoaded) {
        throw new Error('No image loaded');
      }

      const outputFormat = format || this.outputFormat;
      const outputQuality = quality || this.outputQuality;

      // Create canvas
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      // Calculate actual pixel values for crop
      const cropXPx = (this.cropX / 100) * this.imageWidth;
      const cropYPx = (this.cropY / 100) * this.imageHeight;
      const cropWidthPx = (this.cropWidth / 100) * this.imageWidth;
      const cropHeightPx = (this.cropHeight / 100) * this.imageHeight;

      // Handle rotation
      let outputWidth = cropWidthPx;
      let outputHeight = cropHeightPx;

      if (this.rotation === 90 || this.rotation === 270) {
        outputWidth = cropHeightPx;
        outputHeight = cropWidthPx;
      }

      canvas.width = outputWidth * this.zoom;
      canvas.height = outputHeight * this.zoom;

      // Apply transformations
      ctx.save();
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.rotate((this.rotation * Math.PI) / 180);
      ctx.scale(this.zoom, this.zoom);

      // Draw cropped portion
      const drawWidth = this.rotation === 90 || this.rotation === 270 ? cropHeightPx : cropWidthPx;
      const drawHeight = this.rotation === 90 || this.rotation === 270 ? cropWidthPx : cropHeightPx;

      ctx.drawImage(
        this._imageEl,
        cropXPx, cropYPx, cropWidthPx, cropHeightPx,
        -drawWidth / 2, -drawHeight / 2, drawWidth, drawHeight
      );

      ctx.restore();

      // Return as blob
      return new Promise((resolve, reject) => {
        canvas.toBlob(
          (blob) => {
            if (blob) {
              resolve(blob);
            } else {
              reject(new Error('Failed to create blob'));
            }
          },
          outputFormat,
          outputQuality
        );
      });
    },

    // Get cropped image as data URL
    async getCroppedImageDataURL(format, quality) {
      const blob = await this.getCroppedImage(format, quality);
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(blob);
      });
    },

    // Get crop data (useful for server-side cropping)
    getCropData() {
      return {
        x: Math.round((this.cropX / 100) * this.imageWidth),
        y: Math.round((this.cropY / 100) * this.imageHeight),
        width: Math.round((this.cropWidth / 100) * this.imageWidth),
        height: Math.round((this.cropHeight / 100) * this.imageHeight),
        rotation: this.rotation,
        zoom: this.zoom,
        aspectRatio: this.aspectRatio,
        imageWidth: this.imageWidth,
        imageHeight: this.imageHeight
      };
    },

    // Reset all transformations
    reset() {
      this.zoom = 1;
      this.rotation = 0;
      this.resetCrop();
      this.$dispatch('image-crop:reset');
    },

    // File input handler
    onFileSelect(e) {
      const file = e.target.files?.[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (event) => {
          this.loadImage(event.target.result);
        };
        reader.readAsDataURL(file);
      }
    },

    // Zoom percentage display
    get zoomPercent() {
      return Math.round(this.zoom * 100);
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxImageCrop', imageCropComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxImageCrop', imageCropComponent);
    });
  }
})();

/**
 * UX Image Gallery Component
 * Responsive image gallery with lightbox, thumbnails, and multiple layouts
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Image Gallery - Base
    ======================================== */

    .ux-gallery {
      --ux-gallery-gap: 0.5rem;
      --ux-gallery-radius: var(--ux-radius-md);
      --ux-gallery-thumb-size: 80px;

      font-family: var(--ux-font-family);
    }

    /* ========================================
       Grid Layout
    ======================================== */

    .ux-gallery__grid {
      display: grid;
      gap: var(--ux-gallery-gap);
    }

    .ux-gallery--cols-2 .ux-gallery__grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .ux-gallery--cols-3 .ux-gallery__grid {
      grid-template-columns: repeat(3, 1fr);
    }

    .ux-gallery--cols-4 .ux-gallery__grid {
      grid-template-columns: repeat(4, 1fr);
    }

    .ux-gallery--cols-5 .ux-gallery__grid {
      grid-template-columns: repeat(5, 1fr);
    }

    .ux-gallery--cols-auto .ux-gallery__grid {
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }

    /* ========================================
       Gallery Item
    ======================================== */

    .ux-gallery__item {
      position: relative;
      aspect-ratio: 1;
      overflow: hidden;
      border-radius: var(--ux-gallery-radius);
      cursor: pointer;
      background: var(--ux-gray-100);
    }

    .ux-gallery__item:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.3);
    }

    .ux-gallery__item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform var(--ux-transition-normal) var(--ux-ease);
    }

    .ux-gallery__item:hover img {
      transform: scale(1.05);
    }

    /* Item overlay */
    .ux-gallery__item-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0);
      transition: background var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-gallery__item:hover .ux-gallery__item-overlay {
      background: rgba(0, 0, 0, 0.3);
    }

    .ux-gallery__item-icon {
      width: 32px;
      height: 32px;
      color: white;
      opacity: 0;
      transform: scale(0.8);
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-gallery__item:hover .ux-gallery__item-icon {
      opacity: 1;
      transform: scale(1);
    }

    /* More indicator */
    .ux-gallery__more {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      font-size: 1.5rem;
      font-weight: 600;
    }

    /* ========================================
       Aspect Ratios
    ======================================== */

    .ux-gallery--square .ux-gallery__item {
      aspect-ratio: 1;
    }

    .ux-gallery--landscape .ux-gallery__item {
      aspect-ratio: 4/3;
    }

    .ux-gallery--portrait .ux-gallery__item {
      aspect-ratio: 3/4;
    }

    .ux-gallery--wide .ux-gallery__item {
      aspect-ratio: 16/9;
    }

    /* ========================================
       Masonry Layout
    ======================================== */

    .ux-gallery--masonry .ux-gallery__grid {
      display: block;
      column-count: 3;
      column-gap: var(--ux-gallery-gap);
    }

    .ux-gallery--masonry .ux-gallery__item {
      aspect-ratio: auto;
      break-inside: avoid;
      margin-bottom: var(--ux-gallery-gap);
    }

    .ux-gallery--masonry.ux-gallery--cols-2 .ux-gallery__grid {
      column-count: 2;
    }

    .ux-gallery--masonry.ux-gallery--cols-4 .ux-gallery__grid {
      column-count: 4;
    }

    /* ========================================
       Featured Layout (First image large)
    ======================================== */

    .ux-gallery--featured .ux-gallery__grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      grid-template-rows: repeat(2, 1fr);
    }

    .ux-gallery--featured .ux-gallery__item:first-child {
      grid-row: span 2;
    }

    /* ========================================
       Lightbox
    ======================================== */

    .ux-gallery-lightbox {
      position: fixed;
      inset: 0;
      z-index: var(--ux-z-modal);
      display: flex;
      flex-direction: column;
      background: rgba(0, 0, 0, 0.95);
      opacity: 0;
      visibility: hidden;
      transition: all var(--ux-transition-normal) var(--ux-ease);
    }

    .ux-gallery-lightbox--open {
      opacity: 1;
      visibility: visible;
    }

    .ux-gallery-lightbox__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      color: white;
    }

    .ux-gallery-lightbox__counter {
      font-size: 0.875rem;
      opacity: 0.8;
    }

    .ux-gallery-lightbox__actions {
      display: flex;
      gap: 0.5rem;
    }

    .ux-gallery-lightbox__action {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: transparent;
      border: none;
      border-radius: var(--ux-radius-full);
      color: white;
      cursor: pointer;
      transition: background var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-gallery-lightbox__action:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .ux-gallery-lightbox__action svg {
      width: 24px;
      height: 24px;
    }

    .ux-gallery-lightbox__content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 0 4rem;
      overflow: hidden;
    }

    .ux-gallery-lightbox__image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      user-select: none;
      transform: scale(1);
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-gallery-lightbox__image--zoomed {
      cursor: zoom-out;
    }

    .ux-gallery-lightbox__nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: var(--ux-radius-full);
      color: white;
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-gallery-lightbox__nav:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .ux-gallery-lightbox__nav:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .ux-gallery-lightbox__nav--prev {
      left: 1rem;
    }

    .ux-gallery-lightbox__nav--next {
      right: 1rem;
    }

    .ux-gallery-lightbox__nav svg {
      width: 24px;
      height: 24px;
    }

    /* Lightbox caption */
    .ux-gallery-lightbox__caption {
      padding: 1rem 1.5rem;
      text-align: center;
      color: white;
    }

    .ux-gallery-lightbox__title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .ux-gallery-lightbox__description {
      font-size: 0.875rem;
      opacity: 0.7;
    }

    /* ========================================
       Thumbnails
    ======================================== */

    .ux-gallery-lightbox__thumbs {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      padding: 1rem;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .ux-gallery-lightbox__thumbs::-webkit-scrollbar {
      display: none;
    }

    .ux-gallery-lightbox__thumb {
      flex-shrink: 0;
      width: var(--ux-gallery-thumb-size);
      height: var(--ux-gallery-thumb-size);
      border-radius: var(--ux-radius-sm);
      overflow: hidden;
      opacity: 0.5;
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
      border: 2px solid transparent;
    }

    .ux-gallery-lightbox__thumb:hover {
      opacity: 0.8;
    }

    .ux-gallery-lightbox__thumb--active {
      opacity: 1;
      border-color: white;
    }

    .ux-gallery-lightbox__thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-gallery__item--loading {
      background: linear-gradient(
        90deg,
        var(--ux-gray-100) 0%,
        var(--ux-gray-200) 50%,
        var(--ux-gray-100) 100%
      );
      background-size: 200% 100%;
      animation: ux-gallery-shimmer 1.5s infinite;
    }

    @keyframes ux-gallery-shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .ux-gallery-lightbox__loading {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ux-gallery-lightbox__spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-top-color: white;
      border-radius: 50%;
      animation: ux-spin 1s linear infinite;
    }

    @keyframes ux-spin {
      to { transform: rotate(360deg); }
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-gallery--cols-4 .ux-gallery__grid,
      .ux-gallery--cols-5 .ux-gallery__grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .ux-gallery--masonry.ux-gallery--cols-4 .ux-gallery__grid,
      .ux-gallery--masonry .ux-gallery__grid {
        column-count: 2;
      }

      .ux-gallery-lightbox__content {
        padding: 0 1rem;
      }

      .ux-gallery-lightbox__nav {
        width: 40px;
        height: 40px;
      }

      .ux-gallery-lightbox__nav--prev {
        left: 0.5rem;
      }

      .ux-gallery-lightbox__nav--next {
        right: 0.5rem;
      }

      .ux-gallery-lightbox__thumbs {
        display: none;
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-gallery__item {
        background: var(--ux-gray-800);
      }

      .ux-gallery__item--loading {
        background: linear-gradient(
          90deg,
          var(--ux-gray-800) 0%,
          var(--ux-gray-700) 50%,
          var(--ux-gray-800) 100%
        );
        background-size: 200% 100%;
      }
    }

    .ux-dark .ux-gallery__item {
      background: var(--ux-gray-800);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-gallery__item img,
      .ux-gallery__item-overlay,
      .ux-gallery__item-icon,
      .ux-gallery-lightbox,
      .ux-gallery-lightbox__action,
      .ux-gallery-lightbox__nav,
      .ux-gallery-lightbox__thumb,
      .ux-gallery-lightbox__image {
        transition: none;
      }

      .ux-gallery__item--loading {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-image-gallery-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-image-gallery-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Icons
  const icons = {
    zoom: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>',
    close: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',
    prev: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>',
    next: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>',
    download: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',
    fullscreen: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>'
  };

  // Alpine.js component
  const imageGalleryData = (options = {}) => ({
    // Images array: [{ src, thumb, title, description }]
    images: options.images || [],

    // Configuration
    columns: options.columns || 3,
    layout: options.layout || 'grid', // 'grid', 'masonry', 'featured'
    aspect: options.aspect || 'square', // 'square', 'landscape', 'portrait', 'wide'
    maxVisible: options.maxVisible || 0, // 0 = show all
    showThumbs: options.showThumbs ?? true,
    enableZoom: options.enableZoom ?? true,
    enableDownload: options.enableDownload ?? false,
    loop: options.loop ?? true,

    // Lightbox state
    lightboxOpen: false,
    currentIndex: 0,
    loading: false,
    zoomed: false,
    zoomLevel: 1,

    // Icons
    icons,

    init() {
      // Keyboard navigation
      this._keyHandler = (e) => {
        if (!this.lightboxOpen) return;

        switch (e.key) {
          case 'Escape':
            this.closeLightbox();
            break;
          case 'ArrowLeft':
            this.prev();
            break;
          case 'ArrowRight':
            this.next();
            break;
        }
      };
      document.addEventListener('keydown', this._keyHandler);
    },

    destroy() {
      document.removeEventListener('keydown', this._keyHandler);
    },

    // Get visible images
    get visibleImages() {
      if (this.maxVisible === 0) {
        return this.images;
      }
      return this.images.slice(0, this.maxVisible);
    },

    // Get remaining count
    get remainingCount() {
      if (this.maxVisible === 0) return 0;
      return Math.max(0, this.images.length - this.maxVisible);
    },

    // Current image
    get currentImage() {
      return this.images[this.currentIndex] || {};
    },

    // Open lightbox
    openLightbox(index) {
      this.currentIndex = index;
      this.lightboxOpen = true;
      this.zoomed = false;
      this.zoomLevel = 1;

      if (window.UX) {
        window.UX.lockScroll();
      } else {
        document.body.style.overflow = 'hidden';
      }

      this.$dispatch('gallery:open', { index, image: this.currentImage });
    },

    // Close lightbox
    closeLightbox() {
      this.lightboxOpen = false;
      this.zoomed = false;
      this.zoomLevel = 1;

      if (window.UX) {
        window.UX.unlockScroll();
      } else {
        document.body.style.overflow = '';
      }

      this.$dispatch('gallery:close');
    },

    // Go to specific image
    goTo(index) {
      if (index >= 0 && index < this.images.length) {
        this.currentIndex = index;
        this.zoomed = false;
        this.zoomLevel = 1;
        this.$dispatch('gallery:change', { index, image: this.currentImage });
      }
    },

    // Previous image
    prev() {
      if (this.currentIndex > 0) {
        this.goTo(this.currentIndex - 1);
      } else if (this.loop) {
        this.goTo(this.images.length - 1);
      }
    },

    // Next image
    next() {
      if (this.currentIndex < this.images.length - 1) {
        this.goTo(this.currentIndex + 1);
      } else if (this.loop) {
        this.goTo(0);
      }
    },

    // Can go previous
    get canPrev() {
      return this.loop || this.currentIndex > 0;
    },

    // Can go next
    get canNext() {
      return this.loop || this.currentIndex < this.images.length - 1;
    },

    // Toggle zoom
    toggleZoom() {
      if (!this.enableZoom) return;

      this.zoomed = !this.zoomed;
      this.zoomLevel = this.zoomed ? 2 : 1;
    },

    // Download current image
    downloadImage() {
      const image = this.currentImage;
      if (!image.src) return;

      const link = document.createElement('a');
      link.href = image.src;
      link.download = image.title || 'image';
      link.click();
    },

    // Handle swipe (for mobile)
    handleSwipe(direction) {
      if (direction === 'left') {
        this.next();
      } else if (direction === 'right') {
        this.prev();
      }
    },

    // Get thumbnail URL
    getThumb(image) {
      return image.thumb || image.src;
    },

    // Set images
    setImages(images) {
      this.images = images;
      this.currentIndex = 0;
    },

    // Add image
    addImage(image) {
      this.images.push(image);
    },

    // Remove image
    removeImage(index) {
      this.images.splice(index, 1);
      if (this.currentIndex >= this.images.length) {
        this.currentIndex = Math.max(0, this.images.length - 1);
      }
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxImageGallery', imageGalleryData);
  }

})();

/**
 * UX Image Zoom Component
 * Hover magnifier, click fullscreen, pinch to zoom on touch
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Image Zoom Variables
    ======================================== */

    :root {
      --ux-image-zoom-lens-size: 150px;
      --ux-image-zoom-lens-border: 2px solid rgba(255, 255, 255, 0.8);
      --ux-image-zoom-lens-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      --ux-image-zoom-zoom-factor: 2.5;
      --ux-image-zoom-transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);
      --ux-image-zoom-result-width: 400px;
      --ux-image-zoom-result-height: 400px;
    }

    /* ========================================
       UX Image Zoom Container
    ======================================== */

    .ux-image-zoom {
      position: relative;
      display: inline-block;
      overflow: visible;
      cursor: zoom-in;
      line-height: 0;
    }

    .ux-image-zoom--active {
      cursor: none;
    }

    .ux-image-zoom--fullscreen-active {
      cursor: pointer;
    }

    /* ========================================
       Image
    ======================================== */

    .ux-image-zoom__img {
      display: block;
      max-width: 100%;
      height: auto;
      user-select: none;
      -webkit-user-drag: none;
    }

    /* ========================================
       Lens Mode (Magnifying Glass)
    ======================================== */

    .ux-image-zoom__lens {
      position: absolute;
      width: var(--ux-image-zoom-lens-size);
      height: var(--ux-image-zoom-lens-size);
      border-radius: 50%;
      border: var(--ux-image-zoom-lens-border);
      box-shadow: var(--ux-image-zoom-lens-shadow);
      background-repeat: no-repeat;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transform: translate(-50%, -50%) scale(0.8);
      transition:
        opacity var(--ux-image-zoom-transition),
        visibility var(--ux-image-zoom-transition),
        transform var(--ux-image-zoom-transition);
      z-index: var(--ux-z-tooltip);
      overflow: hidden;
    }

    .ux-image-zoom--active .ux-image-zoom__lens {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }

    /* Square lens variant */
    .ux-image-zoom--lens-square .ux-image-zoom__lens {
      border-radius: var(--ux-radius-md);
    }

    /* ========================================
       Inner Mode (Zoom Inside Image)
    ======================================== */

    .ux-image-zoom--inner-mode .ux-image-zoom__inner {
      position: absolute;
      inset: 0;
      background-repeat: no-repeat;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-image-zoom-transition),
        visibility var(--ux-image-zoom-transition);
      z-index: 1;
    }

    .ux-image-zoom--inner-mode.ux-image-zoom--active .ux-image-zoom__inner {
      opacity: 1;
      visibility: visible;
    }

    /* ========================================
       Result Window (Side Preview)
    ======================================== */

    .ux-image-zoom__result {
      position: absolute;
      top: 0;
      left: calc(100% + var(--ux-space-md));
      width: var(--ux-image-zoom-result-width);
      height: var(--ux-image-zoom-result-height);
      background-repeat: no-repeat;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      box-shadow: var(--ux-shadow-lg);
      background-color: var(--ux-surface);
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transform: translateX(-10px);
      transition:
        opacity var(--ux-image-zoom-transition),
        visibility var(--ux-image-zoom-transition),
        transform var(--ux-image-zoom-transition);
      z-index: var(--ux-z-tooltip);
      overflow: hidden;
    }

    .ux-image-zoom--active .ux-image-zoom__result {
      opacity: 1;
      visibility: visible;
      transform: translateX(0);
    }

    /* Result on left side */
    .ux-image-zoom--result-left .ux-image-zoom__result {
      left: auto;
      right: calc(100% + var(--ux-space-md));
      transform: translateX(10px);
    }

    .ux-image-zoom--result-left.ux-image-zoom--active .ux-image-zoom__result {
      transform: translateX(0);
    }

    /* Result on top */
    .ux-image-zoom--result-top .ux-image-zoom__result {
      top: auto;
      bottom: calc(100% + var(--ux-space-md));
      left: 50%;
      transform: translate(-50%, 10px);
    }

    .ux-image-zoom--result-top.ux-image-zoom--active .ux-image-zoom__result {
      transform: translate(-50%, 0);
    }

    /* Result on bottom */
    .ux-image-zoom--result-bottom .ux-image-zoom__result {
      top: calc(100% + var(--ux-space-md));
      left: 50%;
      transform: translate(-50%, -10px);
    }

    .ux-image-zoom--result-bottom.ux-image-zoom--active .ux-image-zoom__result {
      transform: translate(-50%, 0);
    }

    /* ========================================
       Fullscreen Mode
    ======================================== */

    .ux-image-zoom-fullscreen {
      position: fixed;
      inset: 0;
      z-index: var(--ux-z-modal);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity 300ms cubic-bezier(0.32, 0.72, 0, 1),
        visibility 300ms cubic-bezier(0.32, 0.72, 0, 1);
    }

    .ux-image-zoom-fullscreen--open {
      opacity: 1;
      visibility: visible;
    }

    .ux-image-zoom-fullscreen__backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: -1;
    }

    .ux-image-zoom-fullscreen__container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ========================================
       Fullscreen Header
    ======================================== */

    .ux-image-zoom-fullscreen__header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md);
      padding-top: max(var(--ux-space-md), var(--ux-safe-top));
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.5), transparent);
      z-index: 10;
      opacity: 1;
      transition: opacity var(--ux-transition-normal);
    }

    .ux-image-zoom-fullscreen--hide-ui .ux-image-zoom-fullscreen__header {
      opacity: 0;
      pointer-events: none;
    }

    .ux-image-zoom-fullscreen__title {
      color: white;
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      margin: 0;
    }

    .ux-image-zoom-fullscreen__zoom-level {
      color: rgba(255, 255, 255, 0.7);
      font-size: var(--ux-font-size-sm);
    }

    /* ========================================
       Fullscreen Image Container
    ======================================== */

    .ux-image-zoom-fullscreen__image-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      cursor: grab;
      touch-action: none;
    }

    .ux-image-zoom-fullscreen__image-container:active {
      cursor: grabbing;
    }

    .ux-image-zoom-fullscreen__image-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 200ms cubic-bezier(0.4, 0, 0.2, 1);
      will-change: transform;
    }

    .ux-image-zoom-fullscreen--panning .ux-image-zoom-fullscreen__image-wrapper {
      transition: none;
    }

    .ux-image-zoom-fullscreen__image {
      max-width: 100%;
      max-height: calc(100dvh - 120px);
      object-fit: contain;
      user-select: none;
      -webkit-user-drag: none;
    }

    .ux-image-zoom-fullscreen--zoomed .ux-image-zoom-fullscreen__image {
      max-width: none;
      max-height: none;
    }

    /* ========================================
       Fullscreen Controls
    ======================================== */

    .ux-image-zoom-fullscreen__controls {
      position: absolute;
      bottom: var(--ux-space-xl);
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm);
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: var(--ux-radius-full);
      z-index: 10;
      opacity: 1;
      transition: opacity var(--ux-transition-normal);
    }

    .ux-image-zoom-fullscreen--hide-ui .ux-image-zoom-fullscreen__controls {
      opacity: 0;
      pointer-events: none;
    }

    .ux-image-zoom-fullscreen__btn {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: background var(--ux-transition-fast);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-image-zoom-fullscreen__btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .ux-image-zoom-fullscreen__btn:active {
      background: rgba(255, 255, 255, 0.3);
    }

    .ux-image-zoom-fullscreen__btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .ux-image-zoom-fullscreen__btn svg {
      width: 22px;
      height: 22px;
    }

    .ux-image-zoom-fullscreen__zoom-display {
      color: white;
      font-size: var(--ux-font-size-sm);
      min-width: 48px;
      text-align: center;
      font-weight: 500;
    }

    /* Close Button */
    .ux-image-zoom-fullscreen__close {
      position: absolute;
      top: var(--ux-space-md);
      right: var(--ux-space-md);
      top: max(var(--ux-space-md), var(--ux-safe-top));
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      z-index: 11;
      transition: background var(--ux-transition-fast);
    }

    .ux-image-zoom-fullscreen__close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .ux-image-zoom-fullscreen__close svg {
      width: 24px;
      height: 24px;
    }

    /* ========================================
       Zoom Icon Overlay
    ======================================== */

    .ux-image-zoom__icon {
      position: absolute;
      bottom: var(--ux-space-sm);
      right: var(--ux-space-sm);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border-radius: 50%;
      pointer-events: none;
      opacity: 0.8;
      transition: opacity var(--ux-transition-fast);
    }

    .ux-image-zoom:hover .ux-image-zoom__icon {
      opacity: 1;
    }

    .ux-image-zoom--active .ux-image-zoom__icon {
      opacity: 0;
    }

    .ux-image-zoom__icon svg {
      width: 18px;
      height: 18px;
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-image-zoom--loading .ux-image-zoom__img {
      opacity: 0.5;
    }

    .ux-image-zoom__spinner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 32px;
      height: 32px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: ux-image-zoom-spin 0.8s linear infinite;
    }

    @keyframes ux-image-zoom-spin {
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* ========================================
       Mobile Adjustments
    ======================================== */

    @media (max-width: 767px) {
      .ux-image-zoom__result {
        display: none;
      }

      .ux-image-zoom__lens {
        --ux-image-zoom-lens-size: 120px;
      }

      .ux-image-zoom-fullscreen__btn {
        width: 40px;
        height: 40px;
      }

      .ux-image-zoom-fullscreen__btn svg {
        width: 20px;
        height: 20px;
      }

      .ux-image-zoom-fullscreen__controls {
        bottom: max(var(--ux-space-lg), var(--ux-safe-bottom));
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-image-zoom__result {
        background-color: var(--ux-gray-900);
        border-color: var(--ux-gray-700);
      }
    }

    .ux-dark .ux-image-zoom__result {
      background-color: var(--ux-gray-900);
      border-color: var(--ux-gray-700);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-image-zoom__lens,
      .ux-image-zoom__result,
      .ux-image-zoom__inner,
      .ux-image-zoom-fullscreen,
      .ux-image-zoom-fullscreen__image-wrapper {
        transition: none;
      }

      .ux-image-zoom__spinner {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-image-zoom-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-image-zoom-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const imageZoomData = (options = {}) => ({
    // State
    isActive: false,
    isFullscreenOpen: false,
    hideUI: false,
    loading: false,

    // Mode: 'lens', 'inner', 'result'
    mode: options.mode || 'lens',

    // Zoom settings
    zoomFactor: options.zoomFactor || 2.5,
    minZoom: options.minZoom || 1,
    maxZoom: options.maxZoom || 5,
    zoomStep: options.zoomStep || 0.5,
    currentZoom: 1,

    // Image dimensions
    imgWidth: 0,
    imgHeight: 0,
    highResLoaded: false,

    // Lens/cursor position
    lensX: 0,
    lensY: 0,

    // Pan state for fullscreen
    panX: 0,
    panY: 0,
    isPanning: false,
    startX: 0,
    startY: 0,
    lastPanX: 0,
    lastPanY: 0,

    // Pinch zoom state
    initialDistance: 0,
    initialZoom: 1,

    // Options
    src: options.src || '',
    highResSrc: options.highResSrc || '',
    enableFullscreen: options.enableFullscreen !== false,
    enableKeyboard: options.enableKeyboard !== false,
    showZoomIcon: options.showZoomIcon !== false,
    lensSize: options.lensSize || 150,
    resultPosition: options.resultPosition || 'right',

    get zoomPercent() {
      return Math.round(this.currentZoom * 100);
    },

    get canZoomIn() {
      return this.currentZoom < this.maxZoom;
    },

    get canZoomOut() {
      return this.currentZoom > this.minZoom;
    },

    init() {
      // Get image element and dimensions
      this.$nextTick(() => {
        const img = this.$el.querySelector('.ux-image-zoom__img');
        if (img) {
          if (img.complete) {
            this.updateDimensions(img);
          } else {
            img.addEventListener('load', () => this.updateDimensions(img), { once: true });
          }

          // Set src from image if not provided
          if (!this.src) {
            this.src = img.src;
          }
          if (!this.highResSrc) {
            this.highResSrc = img.dataset.zoomSrc || this.src;
          }
        }
      });

      // Keyboard handler
      if (this.enableKeyboard) {
        this._keyHandler = (e) => {
          if (!this.isFullscreenOpen) return;

          switch (e.key) {
            case 'Escape':
              this.closeFullscreen();
              break;
            case '+':
            case '=':
              e.preventDefault();
              this.zoomIn();
              break;
            case '-':
              e.preventDefault();
              this.zoomOut();
              break;
            case '0':
              e.preventDefault();
              this.resetZoom();
              break;
          }
        };
        document.addEventListener('keydown', this._keyHandler);
      }
    },

    destroy() {
      if (this._keyHandler) {
        document.removeEventListener('keydown', this._keyHandler);
      }
    },

    updateDimensions(img) {
      this.imgWidth = img.naturalWidth || img.width;
      this.imgHeight = img.naturalHeight || img.height;
    },

    // Lens/hover zoom methods
    activate() {
      if (this.mode !== 'fullscreen') {
        this.isActive = true;
        this.preloadHighRes();
      }
    },

    deactivate() {
      this.isActive = false;
    },

    handleMouseMove(e) {
      if (!this.isActive) return;

      const rect = this.$el.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      // Update lens position
      this.lensX = x;
      this.lensY = y;

      // Update background position for lens/inner/result
      this.updateZoomBackground(x, y, rect.width, rect.height);
    },

    updateZoomBackground(x, y, containerWidth, containerHeight) {
      const lens = this.$refs.lens;
      const inner = this.$refs.inner;
      const result = this.$refs.result;

      const zoomSrc = this.highResLoaded ? this.highResSrc : this.src;
      const bgWidth = this.imgWidth * this.zoomFactor;
      const bgHeight = this.imgHeight * this.zoomFactor;

      // Calculate background position
      const ratioX = x / containerWidth;
      const ratioY = y / containerHeight;

      if (lens && this.mode === 'lens') {
        const lensSize = this.lensSize;
        const bgX = -(ratioX * bgWidth - lensSize / 2);
        const bgY = -(ratioY * bgHeight - lensSize / 2);

        lens.style.backgroundImage = `url(${zoomSrc})`;
        lens.style.backgroundSize = `${bgWidth}px ${bgHeight}px`;
        lens.style.backgroundPosition = `${bgX}px ${bgY}px`;
        lens.style.left = `${x}px`;
        lens.style.top = `${y}px`;
      }

      if (inner && this.mode === 'inner') {
        const bgX = -(ratioX * bgWidth - containerWidth / 2);
        const bgY = -(ratioY * bgHeight - containerHeight / 2);

        inner.style.backgroundImage = `url(${zoomSrc})`;
        inner.style.backgroundSize = `${bgWidth}px ${bgHeight}px`;
        inner.style.backgroundPosition = `${bgX}px ${bgY}px`;
      }

      if (result && this.mode === 'result') {
        const resultRect = result.getBoundingClientRect();
        const bgX = -(ratioX * bgWidth - resultRect.width / 2);
        const bgY = -(ratioY * bgHeight - resultRect.height / 2);

        result.style.backgroundImage = `url(${zoomSrc})`;
        result.style.backgroundSize = `${bgWidth}px ${bgHeight}px`;
        result.style.backgroundPosition = `${bgX}px ${bgY}px`;
      }
    },

    preloadHighRes() {
      if (this.highResLoaded || !this.highResSrc || this.highResSrc === this.src) {
        this.highResLoaded = true;
        return;
      }

      const img = new Image();
      img.onload = () => {
        this.highResLoaded = true;
        this.imgWidth = img.naturalWidth;
        this.imgHeight = img.naturalHeight;
      };
      img.src = this.highResSrc;
    },

    // Fullscreen methods
    openFullscreen() {
      if (!this.enableFullscreen) return;

      this.isFullscreenOpen = true;
      this.currentZoom = 1;
      this.panX = 0;
      this.panY = 0;
      this.hideUI = false;
      this.preloadHighRes();

      if (window.UX && window.UX.lockScroll) {
        window.UX.lockScroll();
      }

      this.$dispatch('image-zoom:fullscreen-open');
    },

    closeFullscreen() {
      this.isFullscreenOpen = false;
      this.resetZoom();

      if (window.UX && window.UX.unlockScroll) {
        window.UX.unlockScroll();
      }

      this.$dispatch('image-zoom:fullscreen-close');
    },

    toggleFullscreen() {
      if (this.isFullscreenOpen) {
        this.closeFullscreen();
      } else {
        this.openFullscreen();
      }
    },

    handleImageClick() {
      if (this.enableFullscreen) {
        this.openFullscreen();
      }
    },

    handleBackdropClick(e) {
      if (e.target === e.currentTarget || e.target.classList.contains('ux-image-zoom-fullscreen__backdrop')) {
        this.closeFullscreen();
      }
    },

    toggleUI() {
      this.hideUI = !this.hideUI;
    },

    // Zoom controls
    zoomIn() {
      if (this.canZoomIn) {
        this.currentZoom = Math.min(this.currentZoom + this.zoomStep, this.maxZoom);
        this.$dispatch('image-zoom:zoom-change', { zoom: this.currentZoom });
      }
    },

    zoomOut() {
      if (this.canZoomOut) {
        this.currentZoom = Math.max(this.currentZoom - this.zoomStep, this.minZoom);
        if (this.currentZoom === this.minZoom) {
          this.panX = 0;
          this.panY = 0;
        }
        this.$dispatch('image-zoom:zoom-change', { zoom: this.currentZoom });
      }
    },

    resetZoom() {
      this.currentZoom = this.minZoom;
      this.panX = 0;
      this.panY = 0;
      this.$dispatch('image-zoom:zoom-change', { zoom: this.currentZoom });
    },

    setZoom(level) {
      this.currentZoom = Math.max(this.minZoom, Math.min(level, this.maxZoom));
      if (this.currentZoom === this.minZoom) {
        this.panX = 0;
        this.panY = 0;
      }
      this.$dispatch('image-zoom:zoom-change', { zoom: this.currentZoom });
    },

    setMode(mode) {
      this.mode = mode;
      this.$dispatch('image-zoom:mode-change', { mode });
    },

    // Double tap/click to toggle zoom
    handleDoubleTap() {
      if (this.currentZoom > this.minZoom) {
        this.resetZoom();
      } else {
        this.setZoom(2);
      }
    },

    // Pan handlers for fullscreen zoomed images
    startPan(e) {
      if (this.currentZoom <= this.minZoom) return;

      this.isPanning = true;
      this.startX = (e.clientX || e.touches?.[0]?.clientX || 0) - this.panX;
      this.startY = (e.clientY || e.touches?.[0]?.clientY || 0) - this.panY;
    },

    pan(e) {
      if (!this.isPanning) return;

      e.preventDefault();
      const clientX = e.clientX || e.touches?.[0]?.clientX || 0;
      const clientY = e.clientY || e.touches?.[0]?.clientY || 0;

      this.panX = clientX - this.startX;
      this.panY = clientY - this.startY;

      // Limit panning based on zoom level
      const maxPan = (this.currentZoom - 1) * 200;
      this.panX = Math.max(-maxPan, Math.min(maxPan, this.panX));
      this.panY = Math.max(-maxPan, Math.min(maxPan, this.panY));
    },

    endPan() {
      this.isPanning = false;
    },

    // Pinch zoom handlers for touch
    handleTouchStart(e) {
      if (e.touches.length === 2) {
        // Pinch start
        this.initialDistance = this.getDistance(e.touches[0], e.touches[1]);
        this.initialZoom = this.currentZoom;
      } else if (e.touches.length === 1 && this.currentZoom > this.minZoom) {
        // Pan start
        this.startPan(e);
      }
    },

    handleTouchMove(e) {
      if (e.touches.length === 2) {
        // Pinch zoom
        e.preventDefault();
        const distance = this.getDistance(e.touches[0], e.touches[1]);
        const scale = distance / this.initialDistance;
        this.setZoom(this.initialZoom * scale);
      } else if (e.touches.length === 1 && this.isPanning) {
        // Pan
        this.pan(e);
      }
    },

    handleTouchEnd(e) {
      if (e.touches.length < 2) {
        this.initialDistance = 0;
      }
      if (e.touches.length === 0) {
        this.endPan();
      }
    },

    getDistance(touch1, touch2) {
      const dx = touch1.clientX - touch2.clientX;
      const dy = touch1.clientY - touch2.clientY;
      return Math.sqrt(dx * dx + dy * dy);
    },

    // Wheel zoom
    handleWheel(e) {
      if (!this.isFullscreenOpen) return;

      e.preventDefault();
      if (e.deltaY < 0) {
        this.zoomIn();
      } else {
        this.zoomOut();
      }
    },

    // Transform style for fullscreen image
    get imageTransform() {
      return `scale(${this.currentZoom}) translate(${this.panX / this.currentZoom}px, ${this.panY / this.currentZoom}px)`;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxImageZoom', imageZoomData);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxImageZoom', imageZoomData);
    });
  }
})();

/**
 * UX Img Component
 * Componente de imagen con lazy loading, skeleton y manejo de errores estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Img Container
    ======================================== */

    .ux-img {
      position: relative;
      display: block;
      overflow: hidden;
      background-color: var(--ux-img-bg, var(--ux-light));
    }

    .ux-img--rounded {
      border-radius: var(--ux-border-radius);
    }

    .ux-img--circle {
      border-radius: 50%;
    }

    /* ========================================
       Image Element
    ======================================== */

    .ux-img__image {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: var(--ux-img-object-fit, cover);
      object-position: var(--ux-img-object-position, center);
      opacity: 0;
      transition: opacity var(--ux-transition-base) var(--ux-ease);
    }

    .ux-img--loaded .ux-img__image {
      opacity: 1;
    }

    /* Object fit variants */
    .ux-img--contain .ux-img__image {
      object-fit: contain;
    }

    .ux-img--cover .ux-img__image {
      object-fit: cover;
    }

    .ux-img--fill .ux-img__image {
      object-fit: fill;
    }

    .ux-img--none .ux-img__image {
      object-fit: none;
    }

    .ux-img--scale-down .ux-img__image {
      object-fit: scale-down;
    }

    /* ========================================
       Skeleton / Placeholder
    ======================================== */

    .ux-img__skeleton {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--ux-img-skeleton-bg, var(--ux-light));
      overflow: hidden;
    }

    .ux-img__skeleton::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.4) 50%,
        transparent 100%
      );
      transform: translateX(-100%);
      animation: ux-img-shimmer 1.5s infinite;
    }

    @keyframes ux-img-shimmer {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100%);
      }
    }

    .ux-img--loaded .ux-img__skeleton,
    .ux-img--error .ux-img__skeleton {
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--ux-transition-base) var(--ux-ease);
    }

    /* Placeholder icon */
    .ux-img__placeholder {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--ux-text-tertiary);
      opacity: 0.5;
    }

    .ux-img__placeholder svg {
      width: 48px;
      height: 48px;
    }

    .ux-img--sm .ux-img__placeholder svg {
      width: 24px;
      height: 24px;
    }

    .ux-img--lg .ux-img__placeholder svg {
      width: 64px;
      height: 64px;
    }

    .ux-img--loaded .ux-img__placeholder {
      display: none;
    }

    /* ========================================
       Error State
    ======================================== */

    .ux-img__error {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
      background-color: var(--ux-surface-alt);
      color: var(--ux-text-tertiary);
    }

    .ux-img--error .ux-img__error {
      display: flex;
    }

    .ux-img__error-icon {
      width: 32px;
      height: 32px;
      opacity: 0.5;
    }

    .ux-img--sm .ux-img__error-icon {
      width: 20px;
      height: 20px;
    }

    .ux-img--lg .ux-img__error-icon {
      width: 48px;
      height: 48px;
    }

    .ux-img__error-text {
      font-size: var(--ux-font-size-xs);
      text-align: center;
      max-width: 80%;
    }

    .ux-img--sm .ux-img__error-text {
      display: none;
    }

    /* ========================================
       Aspect Ratios
    ======================================== */

    .ux-img--square {
      aspect-ratio: 1 / 1;
    }

    .ux-img--video {
      aspect-ratio: 16 / 9;
    }

    .ux-img--portrait {
      aspect-ratio: 3 / 4;
    }

    .ux-img--landscape {
      aspect-ratio: 4 / 3;
    }

    .ux-img--wide {
      aspect-ratio: 21 / 9;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-img--xs {
      width: 32px;
      height: 32px;
    }

    .ux-img--sm {
      width: 48px;
      height: 48px;
    }

    .ux-img--md {
      width: 80px;
      height: 80px;
    }

    .ux-img--lg {
      width: 120px;
      height: 120px;
    }

    .ux-img--xl {
      width: 200px;
      height: 200px;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-img {
        --ux-img-bg: rgba(255, 255, 255, 0.1);
        --ux-img-skeleton-bg: rgba(255, 255, 255, 0.1);
      }

      .ux-img__skeleton::after {
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.15) 50%,
          transparent 100%
        );
      }
    }

    .ux-dark .ux-img {
      --ux-img-bg: rgba(255, 255, 255, 0.1);
      --ux-img-skeleton-bg: rgba(255, 255, 255, 0.1);
    }

    .ux-dark .ux-img__skeleton::after {
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.15) 50%,
        transparent 100%
      );
    }

    /* ========================================
       Blur-up / LQIP (Low Quality Image Placeholder)
    ======================================== */

    .ux-img__lqip {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-size: cover;
      background-position: center;
      filter: blur(20px);
      transform: scale(1.1);
      transition: opacity var(--ux-transition-base) var(--ux-ease);
    }

    .ux-img--loaded .ux-img__lqip {
      opacity: 0;
      pointer-events: none;
    }

    /* ========================================
       Fade-in Animation
    ======================================== */

    .ux-img--fade .ux-img__image {
      transition: opacity 0.5s var(--ux-ease);
    }

    .ux-img--zoom .ux-img__image {
      transform: scale(1.05);
      transition: opacity 0.5s var(--ux-ease), transform 0.5s var(--ux-ease);
    }

    .ux-img--zoom.ux-img--loaded .ux-img__image {
      transform: scale(1);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-img-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-img-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Intersection Observer for lazy loading
  let observer = null;

  function getObserver() {
    if (observer) return observer;

    if ('IntersectionObserver' in window) {
      observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            const event = new CustomEvent('ux-img:visible', { bubbles: true });
            img.dispatchEvent(event);
            observer.unobserve(img);
          }
        });
      }, {
        rootMargin: '50px 0px',
        threshold: 0.01
      });
    }

    return observer;
  }

  // Alpine component
  const imgComponent = (config = {}) => ({
    src: config.src || '',
    alt: config.alt || '',
    lqip: config.lqip || '', // Low quality image placeholder URL
    lazy: config.lazy !== false, // Lazy load by default
    state: 'loading', // loading | loaded | error

    get isLoading() { return this.state === 'loading'; },
    get isLoaded() { return this.state === 'loaded'; },
    get isError() { return this.state === 'error'; },

    get containerClass() {
      return {
        'ux-img--loaded': this.isLoaded,
        'ux-img--error': this.isError
      };
    },

    init() {
      if (this.lazy) {
        const obs = getObserver();
        if (obs) {
          obs.observe(this.$el);
          this.$el.addEventListener('ux-img:visible', () => {
            this.loadImage();
          }, { once: true });
        } else {
          // Fallback: load immediately if IntersectionObserver not available
          this.loadImage();
        }
      } else {
        this.loadImage();
      }
    },

    loadImage() {
      if (!this.src) {
        this.state = 'error';
        return;
      }

      const img = new Image();

      img.onload = () => {
        this.state = 'loaded';
        this.$dispatch('ux-img:load', { src: this.src });
      };

      img.onerror = () => {
        this.state = 'error';
        this.$dispatch('ux-img:error', { src: this.src });
      };

      img.src = this.src;
    },

    reload() {
      this.state = 'loading';
      this.loadImage();
    },

    setSrc(newSrc) {
      this.src = newSrc;
      this.state = 'loading';
      this.loadImage();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxImg', imgComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxImg', imgComponent);
    });
  }

  // Directive for simpler usage
  document.addEventListener('alpine:init', () => {
    Alpine.directive('img', (el, { expression, modifiers }, { evaluate, effect }) => {
      const src = expression ? evaluate(expression) : el.dataset.src;
      const lazy = !modifiers.includes('eager');

      if (!src) return;

      el.classList.add('ux-img');

      // Create skeleton
      const skeleton = document.createElement('div');
      skeleton.className = 'ux-img__skeleton';
      el.appendChild(skeleton);

      // Create image
      const img = document.createElement('img');
      img.className = 'ux-img__image';
      img.alt = el.dataset.alt || '';
      el.appendChild(img);

      // Create error state
      const error = document.createElement('div');
      error.className = 'ux-img__error';
      error.innerHTML = `
        <svg class="ux-img__error-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
      `;
      el.appendChild(error);

      function loadImage() {
        img.onload = () => {
          el.classList.add('ux-img--loaded');
          el.classList.remove('ux-img--error');
        };

        img.onerror = () => {
          el.classList.add('ux-img--error');
          el.classList.remove('ux-img--loaded');
        };

        img.src = src;
      }

      if (lazy && 'IntersectionObserver' in window) {
        const obs = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              loadImage();
              obs.unobserve(el);
            }
          });
        }, { rootMargin: '50px 0px', threshold: 0.01 });
        obs.observe(el);
      } else {
        loadImage();
      }
    });
  });
})();

/**
 * UX Infinite Scroll Component
 * Scroll infinito para listas
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Infinite Scroll
    ======================================== */

    .ux-infinite-scroll {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: var(--ux-space-lg);
      min-height: 60px;
    }

    .ux-infinite-scroll--hidden {
      display: none;
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-infinite-scroll__spinner {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-md);
    }

    .ux-infinite-scroll__icon {
      width: 24px;
      height: 24px;
      border: 2px solid var(--ux-light);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-spin 0.8s linear infinite;
    }

    @keyframes ux-spin {
      to {
        transform: rotate(360deg);
      }
    }

    .ux-infinite-scroll__text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* ========================================
       End State
    ======================================== */

    .ux-infinite-scroll--complete {
      color: var(--ux-text-tertiary);
    }

    .ux-infinite-scroll__end-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
    }

    .ux-infinite-scroll__end-icon {
      width: 20px;
      height: 20px;
      margin-bottom: var(--ux-space-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-infinite-scroll__end-icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Error State
    ======================================== */

    .ux-infinite-scroll--error {
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-infinite-scroll__error-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-danger);
    }

    .ux-infinite-scroll__retry {
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-primary);
      background: none;
      border: none;
      cursor: pointer;
    }

    .ux-infinite-scroll__retry:hover {
      text-decoration: underline;
    }

    /* ========================================
       Scroll Progress Bar
    ======================================== */

    .ux-scroll-progress {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background-color: var(--ux-light);
      z-index: 1000;
    }

    .ux-scroll-progress__bar {
      height: 100%;
      background-color: var(--ux-primary);
      transition: width 0.1s ease-out;
    }

    /* ========================================
       Virtual Scroll Container
    ======================================== */

    .ux-virtual-scroll {
      position: relative;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .ux-virtual-scroll__spacer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      pointer-events: none;
    }

    .ux-virtual-scroll__content {
      position: relative;
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-infinite-scroll-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-infinite-scroll-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for infinite scroll
  const infiniteScrollComponent = (config = {}) => ({
    loading: false,
    complete: false,
    error: false,
    threshold: config.threshold || 100,
    disabled: config.disabled || false,

    async checkScroll(scrollContainer) {
      if (this.loading || this.complete || this.disabled) return;

      const { scrollTop, scrollHeight, clientHeight } = scrollContainer;
      const distanceFromBottom = scrollHeight - scrollTop - clientHeight;

      if (distanceFromBottom < this.threshold) {
        await this.loadMore();
      }
    },

    async loadMore() {
      if (this.loading || this.complete) return;

      this.loading = true;
      this.error = false;

      // The actual loading should be handled by the parent component
      // via @load-more event
    },

    setComplete() {
      this.complete = true;
      this.loading = false;
    },

    setError() {
      this.error = true;
      this.loading = false;
    },

    reset() {
      this.loading = false;
      this.complete = false;
      this.error = false;
    },

    finishLoading() {
      this.loading = false;
    },

    retry() {
      this.error = false;
      this.loadMore();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxInfiniteScroll', infiniteScrollComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxInfiniteScroll', infiniteScrollComponent);
    });
  }

  // Alpine component for scroll progress
  const scrollProgressComponent = () => ({
    progress: 0,

    updateProgress(scrollContainer) {
      const { scrollTop, scrollHeight, clientHeight } = scrollContainer;
      const maxScroll = scrollHeight - clientHeight;
      this.progress = maxScroll > 0 ? (scrollTop / maxScroll) * 100 : 0;
    },

    get progressStyle() {
      return { width: this.progress + '%' };
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxScrollProgress', scrollProgressComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxScrollProgress', scrollProgressComponent);
    });
  }

  // Alpine component for simple virtual scroll
  const virtualScrollComponent = (config = {}) => ({
    items: config.items || [],
    itemHeight: config.itemHeight || 50,
    containerHeight: config.containerHeight || 400,
    buffer: config.buffer || 5,
    scrollTop: 0,

    get totalHeight() {
      return this.items.length * this.itemHeight;
    },

    get visibleCount() {
      return Math.ceil(this.containerHeight / this.itemHeight) + this.buffer * 2;
    },

    get startIndex() {
      return Math.max(0, Math.floor(this.scrollTop / this.itemHeight) - this.buffer);
    },

    get endIndex() {
      return Math.min(this.items.length, this.startIndex + this.visibleCount);
    },

    get visibleItems() {
      return this.items.slice(this.startIndex, this.endIndex).map((item, index) => ({
        ...item,
        _index: this.startIndex + index,
        _style: {
          position: 'absolute',
          top: (this.startIndex + index) * this.itemHeight + 'px',
          left: 0,
          right: 0,
          height: this.itemHeight + 'px'
        }
      }));
    },

    handleScroll(event) {
      this.scrollTop = event.target.scrollTop;
    },

    scrollToIndex(index) {
      const container = this.$refs.container;
      if (container) {
        container.scrollTop = index * this.itemHeight;
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxVirtualScroll', virtualScrollComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxVirtualScroll', virtualScrollComponent);
    });
  }
})();

/**
 * UX Input Component
 * Campos de texto estilo Ionic con labels flotantes
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Input - Base Styles (direct on input)
    ======================================== */

    .ux-input,
    input.ux-input,
    textarea.ux-input,
    select.ux-input {
      width: 100%;
      height: var(--ux-input-height);
      min-height: var(--ux-input-min-height);
      max-height: var(--ux-input-max-height);
      padding: var(--ux-input-padding-y) var(--ux-input-padding-x);
      font-family: var(--ux-font-family);
      font-size: var(--ux-input-font-size);
      line-height: 1.5;
      color: var(--ux-text);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      outline: none;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease),
        background-color var(--ux-transition-fast) var(--ux-ease);
      -webkit-appearance: none;
      appearance: none;
    }

    .ux-input::placeholder,
    input.ux-input::placeholder,
    textarea.ux-input::placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-input:hover,
    input.ux-input:hover,
    textarea.ux-input:hover,
    select.ux-input:hover {
      border-color: var(--ux-medium);
    }

    .ux-input:focus,
    input.ux-input:focus,
    textarea.ux-input:focus,
    select.ux-input:focus {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-input:disabled,
    input.ux-input:disabled,
    textarea.ux-input:disabled,
    select.ux-input:disabled {
      background-color: var(--ux-light);
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
      opacity: 0.6;
    }

    .ux-input[readonly],
    input.ux-input[readonly],
    textarea.ux-input[readonly] {
      background-color: var(--ux-light);
      cursor: default;
    }

    /* Size variants for direct input */
    .ux-input--sm,
    input.ux-input--sm,
    textarea.ux-input--sm {
      height: var(--ux-input-height-sm);
      min-height: var(--ux-input-min-height-sm);
      padding: var(--ux-input-padding-y-sm) var(--ux-input-padding-x-sm);
      font-size: var(--ux-input-font-size-sm);
    }

    .ux-input--lg,
    input.ux-input--lg,
    textarea.ux-input--lg {
      height: var(--ux-input-height-lg);
      min-height: var(--ux-input-min-height-lg);
      padding: var(--ux-input-padding-y-lg) var(--ux-input-padding-x-lg);
      font-size: var(--ux-input-font-size-lg);
    }

    /* Variant styles for direct input */
    .ux-input--filled,
    input.ux-input--filled,
    textarea.ux-input--filled {
      background-color: var(--ux-surface-secondary);
      border-color: transparent;
      border-radius: var(--ux-border-radius) var(--ux-border-radius) 0 0;
      border-bottom: 2px solid var(--ux-border-color);
    }

    .ux-input--filled:focus,
    input.ux-input--filled:focus,
    textarea.ux-input--filled:focus {
      border-bottom-color: var(--ux-primary);
      box-shadow: none;
    }

    .ux-input--outline,
    input.ux-input--outline,
    textarea.ux-input--outline {
      background-color: transparent;
    }

    .ux-input--underline,
    input.ux-input--underline,
    textarea.ux-input--underline {
      background-color: transparent;
      border: none;
      border-bottom: 1px solid var(--ux-border-color);
      border-radius: 0;
      padding-left: 0;
      padding-right: 0;
    }

    .ux-input--underline:focus,
    input.ux-input--underline:focus,
    textarea.ux-input--underline:focus {
      border-bottom-color: var(--ux-primary);
      border-bottom-width: 2px;
      box-shadow: none;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-input--glass,
    input.ux-input--glass,
    textarea.ux-input--glass,
    select.ux-input--glass {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-input--glass:hover,
    input.ux-input--glass:hover,
    textarea.ux-input--glass:hover,
    select.ux-input--glass:hover {
      background: var(--ux-glass-bg);
    }

    .ux-input--glass:focus,
    input.ux-input--glass:focus,
    textarea.ux-input--glass:focus,
    select.ux-input--glass:focus {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }

    /* Textarea specific */
    textarea.ux-input {
      height: auto;
      min-height: 100px;
      max-height: none;
      resize: vertical;
    }

    /* ========================================
       UX Input Group (wrapper structure)
    ======================================== */

    .ux-input-group {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .ux-input-group--horizontal {
      flex-direction: row;
      align-items: stretch;
    }

    /* ========================================
       Label
    ======================================== */

    .ux-input__label {
      display: block;
      margin-bottom: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
    }

    .ux-input__label--required::after {
      content: ' *';
      color: var(--ux-danger);
    }

    /* ========================================
       Helper & Error Text
    ======================================== */

    .ux-input__helper {
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-input__error {
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-danger);
    }

    .ux-input__counter {
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-align: right;
    }

    /* ========================================
       Validation States
    ======================================== */

    .ux-input-group--error .ux-input,
    .ux-input-group--error input.ux-input {
      border-color: var(--ux-danger);
    }

    .ux-input-group--error .ux-input:focus,
    .ux-input-group--error input.ux-input:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-danger-rgb), 0.15);
    }

    .ux-input-group--error .ux-input__label {
      color: var(--ux-danger);
    }

    .ux-input-group--success .ux-input,
    .ux-input-group--success input.ux-input {
      border-color: var(--ux-success);
    }

    .ux-input-group--success .ux-input:focus,
    .ux-input-group--success input.ux-input:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-success-rgb), 0.15);
    }

    .ux-input-group--warning .ux-input,
    .ux-input-group--warning input.ux-input {
      border-color: var(--ux-warning);
    }

    /* ========================================
       Floating Label
    ======================================== */

    .ux-input-group--floating {
      position: relative;
    }

    .ux-input-group--floating .ux-input {
      padding-top: 24px;
      padding-bottom: 8px;
    }

    .ux-input-group--floating .ux-input__label {
      position: absolute;
      top: 50%;
      left: var(--ux-space-lg);
      transform: translateY(-50%);
      margin: 0;
      font-size: var(--ux-font-size-md);
      color: var(--ux-text-tertiary);
      pointer-events: none;
      transition:
        top var(--ux-transition-fast) var(--ux-ease),
        font-size var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-input-group--floating .ux-input:focus ~ .ux-input__label,
    .ux-input-group--floating .ux-input:not(:placeholder-shown) ~ .ux-input__label {
      top: 12px;
      transform: translateY(0);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-primary);
    }

    /* ========================================
       Input Wrapper (for icons, password toggle)
    ======================================== */

    .ux-input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
    }

    .ux-input-wrapper .ux-input {
      width: 100%;
    }

    .ux-input__icon {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      color: var(--ux-text-tertiary);
      pointer-events: none;
    }

    .ux-input__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-input-wrapper--icon-start .ux-input__icon {
      left: var(--ux-space-md);
    }

    .ux-input-wrapper--icon-start .ux-input {
      padding-left: calc(var(--ux-space-lg) + 24px);
    }

    .ux-input-wrapper--icon-end .ux-input__icon {
      right: var(--ux-space-md);
    }

    .ux-input-wrapper--icon-end .ux-input {
      padding-right: calc(var(--ux-space-lg) + 24px);
    }

    /* ========================================
       Password Toggle
    ======================================== */

    .ux-input-password {
      position: relative;
      width: 100%;
    }

    .ux-input-password .ux-input {
      padding-right: calc(var(--ux-space-lg) + 32px);
    }

    .ux-input-password__toggle {
      position: absolute;
      top: 50%;
      right: var(--ux-space-md);
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      padding: 0;
      border: none;
      background: transparent;
      color: var(--ux-text-tertiary);
      cursor: pointer;
      border-radius: var(--ux-border-radius-sm);
      transition: color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-input-password__toggle:hover {
      color: var(--ux-text-secondary);
    }

    .ux-input-password__toggle svg {
      width: 20px;
      height: 20px;
    }

    /* ========================================
       Clearable
    ======================================== */

    .ux-input__clear {
      position: absolute;
      top: 50%;
      right: var(--ux-space-md);
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      padding: 0;
      border: none;
      background: var(--ux-medium);
      border-radius: 50%;
      color: white;
      cursor: pointer;
      opacity: 0;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-input__clear svg {
      width: 12px;
      height: 12px;
    }

    .ux-input:not(:placeholder-shown) ~ .ux-input__clear {
      opacity: 1;
    }

    .ux-input-wrapper--clearable .ux-input {
      padding-right: calc(var(--ux-space-lg) + 28px);
    }

    /* ========================================
       Addon (prefixes/suffixes)
    ======================================== */

    .ux-input-group--horizontal .ux-input {
      flex: 1;
      border-radius: 0;
    }

    .ux-input-group--horizontal .ux-input:first-child,
    .ux-input-group--horizontal .ux-input-wrapper:first-child .ux-input {
      border-radius: var(--ux-border-radius) 0 0 var(--ux-border-radius);
    }

    .ux-input-group--horizontal .ux-input:last-child,
    .ux-input-group--horizontal .ux-input-wrapper:last-child .ux-input {
      border-radius: 0 var(--ux-border-radius) var(--ux-border-radius) 0;
    }

    .ux-input-group__addon {
      display: flex;
      align-items: center;
      padding: 0 var(--ux-space-md);
      background-color: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      color: var(--ux-text-secondary);
      font-size: var(--ux-font-size-sm);
      white-space: nowrap;
    }

    .ux-input-group__addon:first-child {
      border-right: none;
      border-radius: var(--ux-border-radius) 0 0 var(--ux-border-radius);
    }

    .ux-input-group__addon:last-child {
      border-left: none;
      border-radius: 0 var(--ux-border-radius) var(--ux-border-radius) 0;
    }

    /* ========================================
       Date/Time Input Icons (Native Browser)
    ======================================== */

    /* Webkit browsers (Chrome, Safari, Edge) */
    input.ux-input[type="date"]::-webkit-calendar-picker-indicator,
    input.ux-input[type="time"]::-webkit-calendar-picker-indicator,
    input.ux-input[type="datetime-local"]::-webkit-calendar-picker-indicator,
    input.ux-input[type="month"]::-webkit-calendar-picker-indicator,
    input.ux-input[type="week"]::-webkit-calendar-picker-indicator {
      cursor: pointer;
      opacity: 0.6;
      filter: var(--ux-icon-filter, none);
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
    }

    input.ux-input[type="date"]::-webkit-calendar-picker-indicator:hover,
    input.ux-input[type="time"]::-webkit-calendar-picker-indicator:hover,
    input.ux-input[type="datetime-local"]::-webkit-calendar-picker-indicator:hover,
    input.ux-input[type="month"]::-webkit-calendar-picker-indicator:hover,
    input.ux-input[type="week"]::-webkit-calendar-picker-indicator:hover {
      opacity: 1;
    }

    /* Dark mode support for date/time icons */
    .ux-dark input.ux-input[type="date"]::-webkit-calendar-picker-indicator,
    .ux-dark input.ux-input[type="time"]::-webkit-calendar-picker-indicator,
    .ux-dark input.ux-input[type="datetime-local"]::-webkit-calendar-picker-indicator,
    .ux-dark input.ux-input[type="month"]::-webkit-calendar-picker-indicator,
    .ux-dark input.ux-input[type="week"]::-webkit-calendar-picker-indicator {
      filter: invert(1);
    }

    /* Also support data-theme dark */
    [data-theme="dark"] input.ux-input[type="date"]::-webkit-calendar-picker-indicator,
    [data-theme="dark"] input.ux-input[type="time"]::-webkit-calendar-picker-indicator,
    [data-theme="dark"] input.ux-input[type="datetime-local"]::-webkit-calendar-picker-indicator,
    [data-theme="dark"] input.ux-input[type="month"]::-webkit-calendar-picker-indicator,
    [data-theme="dark"] input.ux-input[type="week"]::-webkit-calendar-picker-indicator {
      filter: invert(1);
    }

    /* Match color with text-tertiary using CSS filters */
    input.ux-input[type="date"]::-webkit-calendar-picker-indicator,
    input.ux-input[type="time"]::-webkit-calendar-picker-indicator,
    input.ux-input[type="datetime-local"]::-webkit-calendar-picker-indicator,
    input.ux-input[type="month"]::-webkit-calendar-picker-indicator,
    input.ux-input[type="week"]::-webkit-calendar-picker-indicator {
      /* Subtle gray filter to match text-tertiary color */
      filter: opacity(0.5);
    }

    .ux-dark input.ux-input[type="date"]::-webkit-calendar-picker-indicator,
    .ux-dark input.ux-input[type="time"]::-webkit-calendar-picker-indicator,
    .ux-dark input.ux-input[type="datetime-local"]::-webkit-calendar-picker-indicator,
    .ux-dark input.ux-input[type="month"]::-webkit-calendar-picker-indicator,
    .ux-dark input.ux-input[type="week"]::-webkit-calendar-picker-indicator,
    [data-theme="dark"] input.ux-input[type="date"]::-webkit-calendar-picker-indicator,
    [data-theme="dark"] input.ux-input[type="time"]::-webkit-calendar-picker-indicator,
    [data-theme="dark"] input.ux-input[type="datetime-local"]::-webkit-calendar-picker-indicator,
    [data-theme="dark"] input.ux-input[type="month"]::-webkit-calendar-picker-indicator,
    [data-theme="dark"] input.ux-input[type="week"]::-webkit-calendar-picker-indicator {
      filter: invert(1) opacity(0.6);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-input,
      input.ux-input,
      textarea.ux-input,
      select.ux-input {
        transition: none;
      }

      .ux-input-group--floating .ux-input__label {
        transition: none;
      }

      .ux-input-password__toggle {
        transition: none;
      }

      .ux-input__clear {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-input-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-input-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for input with validation
  const inputComponent = (config = {}) => ({
    value: config.value || '',
    error: '',
    touched: false,
    maxLength: config.maxLength || null,

    get hasValue() {
      return this.value && this.value.length > 0;
    },

    get charCount() {
      return this.value ? this.value.length : 0;
    },

    get isValid() {
      return !this.error;
    },

    clear() {
      this.value = '';
      this.error = '';
    },

    validate(rules = []) {
      this.touched = true;
      for (const rule of rules) {
        const result = rule(this.value);
        if (result !== true) {
          this.error = result;
          return false;
        }
      }
      this.error = '';
      return true;
    },

    // Common validators
    required(message = 'This field is required') {
      return (value) => !!value && value.trim() !== '' ? true : message;
    },

    email(message = 'Please enter a valid email') {
      return (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value) ? true : message;
    },

    minLength(min, message) {
      return (value) => value.length >= min ? true : (message || `Minimum ${min} characters`);
    },

    maxLengthValidator(max, message) {
      return (value) => value.length <= max ? true : (message || `Maximum ${max} characters`);
    }
  });

  // Alpine component for password input with toggle
  const passwordComponent = (config = {}) => ({
    value: config.value || '',
    showPassword: false,
    error: '',

    get inputType() {
      return this.showPassword ? 'text' : 'password';
    },

    toggle() {
      this.showPassword = !this.showPassword;
    },

    clear() {
      this.value = '';
      this.error = '';
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxInput', inputComponent);
    window.UX.registerComponent('uxPassword', passwordComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxInput', inputComponent);
      Alpine.data('uxPassword', passwordComponent);
    });
  }
})();

/**
 * UX JSON Viewer Component
 * Interactive JSON tree viewer with collapsible nodes and syntax highlighting
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX JSON Viewer - Base
    ======================================== */

    .ux-json-viewer {
      font-family: 'SF Mono', 'Fira Code', 'Monaco', 'Consolas', monospace;
      font-size: 0.875rem;
      line-height: 1.6;
      background: var(--ux-gray-900);
      border-radius: var(--ux-radius-lg);
      overflow: hidden;
    }

    /* ========================================
       Header
    ======================================== */

    .ux-json-viewer__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--ux-gray-800);
      border-bottom: 1px solid var(--ux-gray-700);
    }

    .ux-json-viewer__title {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--ux-gray-400);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .ux-json-viewer__badge {
      padding: 0.125rem 0.5rem;
      background: var(--ux-gray-700);
      border-radius: var(--ux-radius-sm);
      font-size: 0.6875rem;
      color: var(--ux-gray-300);
    }

    .ux-json-viewer__actions {
      display: flex;
      gap: 0.5rem;
    }

    .ux-json-viewer__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      padding: 0.375rem 0.625rem;
      background: transparent;
      border: none;
      border-radius: var(--ux-radius-sm);
      color: var(--ux-gray-400);
      font-size: 0.75rem;
      font-family: inherit;
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-json-viewer__btn:hover {
      background: var(--ux-gray-700);
      color: var(--ux-gray-200);
    }

    .ux-json-viewer__btn--active {
      background: var(--ux-gray-700);
      color: var(--ux-primary);
    }

    .ux-json-viewer__btn svg {
      width: 14px;
      height: 14px;
    }

    /* ========================================
       Content
    ======================================== */

    .ux-json-viewer__content {
      padding: 1rem;
      overflow-x: auto;
      max-height: 500px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--ux-gray-600) transparent;
    }

    .ux-json-viewer__content::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    .ux-json-viewer__content::-webkit-scrollbar-track {
      background: transparent;
    }

    .ux-json-viewer__content::-webkit-scrollbar-thumb {
      background: var(--ux-gray-600);
      border-radius: 4px;
    }

    /* ========================================
       Tree Structure
    ======================================== */

    .ux-json-viewer__tree {
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .ux-json-viewer__node {
      position: relative;
    }

    .ux-json-viewer__row {
      display: flex;
      align-items: flex-start;
      padding: 0.125rem 0;
      cursor: default;
    }

    .ux-json-viewer__row:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    /* Toggle Button */
    .ux-json-viewer__toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 20px;
      padding: 0;
      margin-right: 0.25rem;
      background: transparent;
      border: none;
      color: var(--ux-gray-500);
      cursor: pointer;
      flex-shrink: 0;
    }

    .ux-json-viewer__toggle:hover {
      color: var(--ux-gray-300);
    }

    .ux-json-viewer__toggle svg {
      width: 10px;
      height: 10px;
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-json-viewer__toggle--expanded svg {
      transform: rotate(90deg);
    }

    .ux-json-viewer__toggle--hidden {
      visibility: hidden;
    }

    /* Indentation */
    .ux-json-viewer__indent {
      width: 1.25rem;
      flex-shrink: 0;
    }

    /* ========================================
       Syntax Highlighting
    ======================================== */

    .ux-json-viewer__key {
      color: #e06c75;
      margin-right: 0.25rem;
    }

    .ux-json-viewer__key::after {
      content: ':';
      color: var(--ux-gray-500);
      margin-left: 0.125rem;
    }

    .ux-json-viewer__value--string {
      color: #98c379;
    }

    .ux-json-viewer__value--string::before,
    .ux-json-viewer__value--string::after {
      content: '"';
      color: #98c379;
    }

    .ux-json-viewer__value--number {
      color: #d19a66;
    }

    .ux-json-viewer__value--boolean {
      color: #56b6c2;
    }

    .ux-json-viewer__value--null {
      color: #c678dd;
      font-style: italic;
    }

    .ux-json-viewer__value--url {
      color: #61afef;
      text-decoration: underline;
      cursor: pointer;
    }

    .ux-json-viewer__value--url:hover {
      color: #7ec8ff;
    }

    /* Brackets */
    .ux-json-viewer__bracket {
      color: var(--ux-gray-500);
    }

    .ux-json-viewer__bracket--open {
      margin-left: 0.25rem;
    }

    /* Collapsed Preview */
    .ux-json-viewer__preview {
      color: var(--ux-gray-500);
      font-style: italic;
      margin-left: 0.25rem;
    }

    /* Children */
    .ux-json-viewer__children {
      margin: 0;
      padding: 0;
      padding-left: 1.25rem;
      list-style: none;
      border-left: 1px solid var(--ux-gray-700);
      margin-left: 0.5rem;
    }

    /* ========================================
       Count Badge
    ======================================== */

    .ux-json-viewer__count {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 1.25rem;
      height: 1rem;
      padding: 0 0.375rem;
      margin-left: 0.5rem;
      background: var(--ux-gray-700);
      border-radius: 10px;
      font-size: 0.625rem;
      color: var(--ux-gray-400);
    }

    /* ========================================
       Search Highlight
    ======================================== */

    .ux-json-viewer__highlight {
      background: rgba(255, 213, 0, 0.3);
      border-radius: 2px;
      padding: 0 2px;
    }

    /* ========================================
       Search Box
    ======================================== */

    .ux-json-viewer__search {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--ux-gray-700);
    }

    .ux-json-viewer__search-input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      background: var(--ux-gray-800);
      border: 1px solid var(--ux-gray-700);
      border-radius: var(--ux-radius-md);
      color: var(--ux-gray-100);
      font-size: 0.875rem;
      font-family: inherit;
    }

    .ux-json-viewer__search-input:focus {
      outline: none;
      border-color: var(--ux-primary);
    }

    .ux-json-viewer__search-input::placeholder {
      color: var(--ux-gray-500);
    }

    /* ========================================
       Raw Mode
    ======================================== */

    .ux-json-viewer__raw {
      white-space: pre-wrap;
      word-break: break-word;
      color: var(--ux-gray-300);
      margin: 0;
    }

    /* ========================================
       Light Theme
    ======================================== */

    .ux-json-viewer--light {
      background: var(--ux-gray-50);
    }

    .ux-json-viewer--light .ux-json-viewer__header {
      background: var(--ux-gray-100);
      border-bottom-color: var(--ux-gray-200);
    }

    .ux-json-viewer--light .ux-json-viewer__badge {
      background: var(--ux-gray-200);
      color: var(--ux-gray-600);
    }

    .ux-json-viewer--light .ux-json-viewer__btn {
      color: var(--ux-gray-500);
    }

    .ux-json-viewer--light .ux-json-viewer__btn:hover {
      background: var(--ux-gray-200);
      color: var(--ux-gray-700);
    }

    .ux-json-viewer--light .ux-json-viewer__row:hover {
      background: rgba(0, 0, 0, 0.03);
    }

    .ux-json-viewer--light .ux-json-viewer__children {
      border-left-color: var(--ux-gray-300);
    }

    .ux-json-viewer--light .ux-json-viewer__key { color: #a626a4; }
    .ux-json-viewer--light .ux-json-viewer__value--string { color: #50a14f; }
    .ux-json-viewer--light .ux-json-viewer__value--number { color: #986801; }
    .ux-json-viewer--light .ux-json-viewer__value--boolean { color: #0184bc; }
    .ux-json-viewer--light .ux-json-viewer__value--null { color: #a626a4; }
    .ux-json-viewer--light .ux-json-viewer__bracket { color: var(--ux-gray-500); }

    /* ========================================
       Compact Mode
    ======================================== */

    .ux-json-viewer--compact .ux-json-viewer__row {
      padding: 0;
    }

    .ux-json-viewer--compact .ux-json-viewer__children {
      padding-left: 1rem;
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-json-viewer--sm {
      font-size: 0.75rem;
    }

    .ux-json-viewer--lg {
      font-size: 1rem;
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-json-viewer__toggle svg {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-json-viewer-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-json-viewer-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Icons
  const icons = {
    chevron: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9.29 6.71a1 1 0 000 1.41L13.17 12l-3.88 3.88a1 1 0 101.41 1.41l4.59-4.59a1 1 0 000-1.41L10.7 6.7a1 1 0 00-1.41.01z"/></svg>',
    copy: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>',
    expand: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>',
    collapse: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 14h6v6M20 10h-6V4M14 10l7-7M3 21l7-7"/></svg>',
    search: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>',
    check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>'
  };

  // Alpine.js component for JSON viewer
  const jsonViewerData = (options = {}) => ({
    // Data
    data: options.data || null,
    rawJson: '',

    // Configuration
    initialExpanded: options.initialExpanded ?? 2, // Depth to expand initially
    maxHeight: options.maxHeight || '500px',
    showHeader: options.showHeader ?? true,
    showSearch: options.showSearch ?? false,
    showLineNumbers: options.showLineNumbers ?? false,
    linkUrls: options.linkUrls ?? true,

    // State
    expanded: {},
    searchQuery: '',
    viewMode: 'tree', // 'tree' or 'raw'
    copied: false,
    icons,

    init() {
      // Parse JSON if string
      if (typeof options.data === 'string') {
        try {
          this.data = JSON.parse(options.data);
          this.rawJson = options.data;
        } catch (e) {
          this.data = null;
          this.rawJson = options.data;
          console.error('Invalid JSON:', e);
        }
      } else {
        this.data = options.data;
        this.rawJson = JSON.stringify(options.data, null, 2);
      }

      // Initialize expanded state
      this.initExpandedState(this.data, '', 0);
    },

    // Initialize expanded state based on depth
    initExpandedState(obj, path, depth) {
      if (obj === null || typeof obj !== 'object') return;

      const key = path || 'root';
      this.expanded[key] = depth < this.initialExpanded;

      if (Array.isArray(obj)) {
        obj.forEach((item, index) => {
          this.initExpandedState(item, `${path}[${index}]`, depth + 1);
        });
      } else {
        Object.keys(obj).forEach(k => {
          this.initExpandedState(obj[k], path ? `${path}.${k}` : k, depth + 1);
        });
      }
    },

    // Toggle node expansion
    toggleNode(path) {
      this.expanded[path] = !this.expanded[path];
    },

    // Expand all nodes
    expandAll() {
      const expand = (obj, path) => {
        if (obj === null || typeof obj !== 'object') return;

        const key = path || 'root';
        this.expanded[key] = true;

        if (Array.isArray(obj)) {
          obj.forEach((item, index) => expand(item, `${path}[${index}]`));
        } else {
          Object.keys(obj).forEach(k => expand(obj[k], path ? `${path}.${k}` : k));
        }
      };

      expand(this.data, '');
    },

    // Collapse all nodes
    collapseAll() {
      Object.keys(this.expanded).forEach(key => {
        this.expanded[key] = false;
      });
    },

    // Check if node is expanded
    isExpanded(path) {
      return this.expanded[path || 'root'] ?? false;
    },

    // Get value type
    getType(value) {
      if (value === null) return 'null';
      if (Array.isArray(value)) return 'array';
      return typeof value;
    },

    // Check if value is expandable
    isExpandable(value) {
      return value !== null && typeof value === 'object';
    },

    // Get preview for collapsed objects/arrays
    getPreview(value) {
      if (Array.isArray(value)) {
        return `${value.length} items`;
      }
      if (typeof value === 'object' && value !== null) {
        const keys = Object.keys(value);
        if (keys.length <= 3) {
          return keys.join(', ');
        }
        return `${keys.length} properties`;
      }
      return '';
    },

    // Get item count
    getCount(value) {
      if (Array.isArray(value)) return value.length;
      if (typeof value === 'object' && value !== null) return Object.keys(value).length;
      return 0;
    },

    // Check if value is a URL
    isUrl(value) {
      if (typeof value !== 'string') return false;
      try {
        new URL(value);
        return value.startsWith('http://') || value.startsWith('https://');
      } catch {
        return false;
      }
    },

    // Format value for display
    formatValue(value) {
      if (value === null) return 'null';
      if (typeof value === 'boolean') return value ? 'true' : 'false';
      if (typeof value === 'number') return String(value);
      if (typeof value === 'string') return value;
      return '';
    },

    // Copy JSON to clipboard
    async copyJson() {
      try {
        const text = typeof this.data === 'object'
          ? JSON.stringify(this.data, null, 2)
          : this.rawJson;

        await navigator.clipboard.writeText(text);
        this.copied = true;

        setTimeout(() => {
          this.copied = false;
        }, 2000);

        this.$dispatch('jsonviewer:copy');
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    },

    // Toggle view mode
    toggleViewMode() {
      this.viewMode = this.viewMode === 'tree' ? 'raw' : 'tree';
    },

    // Set data
    setData(newData) {
      if (typeof newData === 'string') {
        try {
          this.data = JSON.parse(newData);
          this.rawJson = newData;
        } catch (e) {
          this.data = null;
          this.rawJson = newData;
        }
      } else {
        this.data = newData;
        this.rawJson = JSON.stringify(newData, null, 2);
      }

      // Reset expanded state
      this.expanded = {};
      this.initExpandedState(this.data, '', 0);
    },

    // Search functionality
    matchesSearch(key, value) {
      if (!this.searchQuery) return true;

      const query = this.searchQuery.toLowerCase();
      const keyMatch = key && key.toLowerCase().includes(query);
      const valueMatch = typeof value === 'string' && value.toLowerCase().includes(query);

      return keyMatch || valueMatch;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxJsonViewer', jsonViewerData);
  }

})();

/**
 * UX Kanban Board Component
 * Drag-and-drop kanban board for task management
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Kanban - Base
    ======================================== */

    .ux-kanban {
      display: flex;
      gap: var(--ux-space-md);
      overflow-x: auto;
      padding: var(--ux-space-md);
      min-height: 400px;
      -webkit-overflow-scrolling: touch;
      font-family: var(--ux-font-family);
    }

    .ux-kanban--compact {
      gap: var(--ux-space-sm);
    }

    /* ========================================
       Kanban Column
    ======================================== */

    .ux-kanban__column {
      flex: 0 0 auto;
      width: 300px;
      min-width: 280px;
      max-width: 350px;
      display: flex;
      flex-direction: column;
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-lg);
      max-height: 100%;
    }

    .ux-kanban__column--collapsed {
      width: 48px;
      min-width: 48px;
    }

    .ux-kanban__column--drag-over {
      background: rgba(var(--ux-primary-rgb), 0.05);
      border: 2px dashed var(--ux-primary);
    }

    /* Column Header */
    .ux-kanban__column-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-kanban__column-header-start {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      min-width: 0;
    }

    .ux-kanban__column-title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-kanban__column-count {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 24px;
      padding: 0 var(--ux-space-xs);
      background: var(--ux-surface);
      border-radius: 12px;
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-secondary);
    }

    .ux-kanban__column-color {
      width: 4px;
      height: 24px;
      border-radius: 2px;
      flex-shrink: 0;
    }

    .ux-kanban__column-actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-kanban__column-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      padding: 0;
      background: none;
      border: none;
      border-radius: var(--ux-radius-sm);
      color: var(--ux-text-tertiary);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-kanban__column-btn:hover {
      background: var(--ux-surface);
      color: var(--ux-text);
    }

    .ux-kanban__column-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Column Body (Cards Container) */
    .ux-kanban__column-body {
      flex: 1;
      overflow-y: auto;
      padding: var(--ux-space-sm);
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
      min-height: 100px;
    }

    .ux-kanban__column-body:empty::after {
      content: attr(data-empty-text);
      display: block;
      padding: var(--ux-space-lg);
      text-align: center;
      color: var(--ux-text-tertiary);
      font-size: var(--ux-font-size-sm);
    }

    /* Column Footer */
    .ux-kanban__column-footer {
      padding: var(--ux-space-sm);
      border-top: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-kanban__add-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xs);
      width: 100%;
      padding: var(--ux-space-sm);
      background: transparent;
      border: 1px dashed var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      color: var(--ux-text-secondary);
      font-size: var(--ux-font-size-sm);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-kanban__add-btn:hover {
      background: var(--ux-surface);
      border-color: var(--ux-primary);
      color: var(--ux-primary);
    }

    .ux-kanban__add-btn svg {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Kanban Card
    ======================================== */

    .ux-kanban__card {
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      padding: var(--ux-space-md);
      cursor: grab;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-kanban__card:hover {
      box-shadow: var(--ux-shadow-md);
      border-color: var(--ux-primary);
    }

    .ux-kanban__card:active {
      cursor: grabbing;
    }

    .ux-kanban__card--dragging {
      opacity: 0.5;
      transform: rotate(3deg);
      box-shadow: var(--ux-shadow-lg);
    }

    .ux-kanban__card--ghost {
      opacity: 0.4;
      border-style: dashed;
    }

    /* Card Color Stripe */
    .ux-kanban__card--color {
      border-left-width: 4px;
    }

    .ux-kanban__card--color-primary { border-left-color: var(--ux-primary); }
    .ux-kanban__card--color-success { border-left-color: var(--ux-success); }
    .ux-kanban__card--color-warning { border-left-color: var(--ux-warning); }
    .ux-kanban__card--color-danger { border-left-color: var(--ux-danger); }
    .ux-kanban__card--color-info { border-left-color: var(--ux-cyan-500); }

    /* Card Header */
    .ux-kanban__card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--ux-space-sm);
      margin-bottom: var(--ux-space-sm);
    }

    .ux-kanban__card-title {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
      margin: 0;
      line-height: 1.4;
    }

    .ux-kanban__card-id {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      font-family: monospace;
    }

    /* Card Body */
    .ux-kanban__card-body {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-sm);
    }

    /* Card Labels */
    .ux-kanban__card-labels {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
      margin-bottom: var(--ux-space-sm);
    }

    .ux-kanban__card-label {
      display: inline-block;
      padding: 2px var(--ux-space-sm);
      border-radius: var(--ux-radius-sm);
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
    }

    .ux-kanban__card-label--primary {
      background: rgba(var(--ux-primary-rgb), 0.15);
      color: var(--ux-primary);
    }

    .ux-kanban__card-label--success {
      background: rgba(var(--ux-success-rgb, 52, 199, 89), 0.15);
      color: var(--ux-success);
    }

    .ux-kanban__card-label--warning {
      background: rgba(var(--ux-warning-rgb, 255, 204, 0), 0.15);
      color: var(--ux-amber-700);
    }

    .ux-kanban__card-label--danger {
      background: rgba(var(--ux-danger-rgb, 255, 59, 48), 0.15);
      color: var(--ux-danger);
    }

    /* Card Footer */
    .ux-kanban__card-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-sm);
      padding-top: var(--ux-space-sm);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-kanban__card-meta {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
    }

    .ux-kanban__card-meta-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-kanban__card-meta-item svg {
      width: 14px;
      height: 14px;
    }

    /* Card Assignees */
    .ux-kanban__card-assignees {
      display: flex;
      align-items: center;
    }

    .ux-kanban__card-assignee {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--ux-surface);
      margin-left: -8px;
      overflow: hidden;
      background: var(--ux-surface-tertiary);
    }

    .ux-kanban__card-assignee:first-child {
      margin-left: 0;
    }

    .ux-kanban__card-assignee img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .ux-kanban__card-assignee--more {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 600;
      color: var(--ux-text-secondary);
    }

    /* Card Priority */
    .ux-kanban__card-priority {
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .ux-kanban__card-priority svg {
      width: 12px;
      height: 12px;
    }

    .ux-kanban__card-priority--high { color: var(--ux-danger); }
    .ux-kanban__card-priority--medium { color: var(--ux-warning); }
    .ux-kanban__card-priority--low { color: var(--ux-success); }

    /* Card Checkbox */
    .ux-kanban__card-checkbox {
      display: flex;
      align-items: flex-start;
      gap: var(--ux-space-sm);
    }

    .ux-kanban__card--completed {
      opacity: 0.6;
    }

    .ux-kanban__card--completed .ux-kanban__card-title {
      text-decoration: line-through;
    }

    /* ========================================
       Drop Zone Indicator
    ======================================== */

    .ux-kanban__drop-zone {
      height: 4px;
      border-radius: 2px;
      background: transparent;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-kanban__drop-zone--active {
      height: 40px;
      background: rgba(var(--ux-primary-rgb), 0.1);
      border: 2px dashed var(--ux-primary);
      margin: var(--ux-space-xs) 0;
    }

    /* ========================================
       Swimlanes
    ======================================== */

    .ux-kanban--swimlanes {
      flex-direction: column;
    }

    .ux-kanban__swimlane {
      display: flex;
      flex-direction: column;
      margin-bottom: var(--ux-space-lg);
    }

    .ux-kanban__swimlane-header {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) 0;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-kanban__swimlane-title {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-kanban__swimlane-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: none;
      border: none;
      border-radius: var(--ux-radius-sm);
      color: var(--ux-text-tertiary);
      cursor: pointer;
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-kanban__swimlane-toggle--collapsed {
      transform: rotate(-90deg);
    }

    .ux-kanban__swimlane-toggle svg {
      width: 16px;
      height: 16px;
    }

    .ux-kanban__swimlane-body {
      display: flex;
      gap: var(--ux-space-md);
      overflow-x: auto;
    }

    .ux-kanban__swimlane-body--collapsed {
      display: none;
    }

    /* ========================================
       Column Colors
    ======================================== */

    .ux-kanban__column--todo .ux-kanban__column-color { background: var(--ux-gray-400); }
    .ux-kanban__column--progress .ux-kanban__column-color { background: var(--ux-primary); }
    .ux-kanban__column--review .ux-kanban__column-color { background: var(--ux-warning); }
    .ux-kanban__column--done .ux-kanban__column-color { background: var(--ux-success); }

    /* ========================================
       Compact Cards
    ======================================== */

    .ux-kanban--compact .ux-kanban__card {
      padding: var(--ux-space-sm);
    }

    .ux-kanban--compact .ux-kanban__card-title {
      font-size: var(--ux-font-size-sm);
    }

    .ux-kanban--compact .ux-kanban__card-body {
      font-size: var(--ux-font-size-xs);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-kanban--glass .ux-kanban__column {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-kanban--glass .ux-kanban__card {
      background: var(--ux-glass-bg-thick);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-kanban__column {
        background: var(--ux-surface-tertiary);
      }

      .ux-kanban__card {
        background: var(--ux-surface);
      }
    }

    .ux-dark .ux-kanban__column {
      background: var(--ux-surface-tertiary);
    }

    .ux-dark .ux-kanban__card {
      background: var(--ux-surface);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-kanban {
        padding: var(--ux-space-sm);
      }

      .ux-kanban__column {
        width: 280px;
        min-width: 260px;
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-kanban__card,
      .ux-kanban__drop-zone {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-kanban-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-kanban-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for Kanban board
  const kanbanData = (options = {}) => ({
    columns: options.columns || [],
    cards: options.cards || [],
    dragging: null,
    dragOverColumn: null,
    dragOverIndex: null,
    allowAddCards: options.allowAddCards ?? true,
    allowAddColumns: options.allowAddColumns ?? false,
    emptyText: options.emptyText || 'No hay tarjetas',

    init() {
      // Initialize cards by column
      this.columns.forEach(col => {
        if (!col.cards) {
          col.cards = this.cards.filter(card => card.columnId === col.id);
        }
      });
    },

    // Get cards for a column
    getColumnCards(columnId) {
      const column = this.columns.find(c => c.id === columnId);
      return column ? column.cards || [] : [];
    },

    // Get card count for a column
    getColumnCount(columnId) {
      return this.getColumnCards(columnId).length;
    },

    // Start dragging
    onDragStart(card, columnId, event) {
      this.dragging = { card, columnId };
      event.dataTransfer.effectAllowed = 'move';
      event.dataTransfer.setData('text/plain', JSON.stringify({ cardId: card.id, columnId }));

      // Add dragging class after a small delay
      setTimeout(() => {
        event.target.classList.add('ux-kanban__card--dragging');
      }, 0);

      this.$dispatch('kanban:dragstart', { card, columnId });
    },

    // End dragging
    onDragEnd(event) {
      event.target.classList.remove('ux-kanban__card--dragging');
      this.dragging = null;
      this.dragOverColumn = null;
      this.dragOverIndex = null;
      this.$dispatch('kanban:dragend');
    },

    // Drag over column
    onDragOver(columnId, event) {
      event.preventDefault();
      event.dataTransfer.dropEffect = 'move';
      this.dragOverColumn = columnId;
    },

    // Drag leave column
    onDragLeave(columnId, event) {
      // Only clear if leaving the column entirely
      if (!event.currentTarget.contains(event.relatedTarget)) {
        this.dragOverColumn = null;
      }
    },

    // Drop card
    onDrop(targetColumnId, targetIndex, event) {
      event.preventDefault();

      if (!this.dragging) return;

      const { card, columnId: sourceColumnId } = this.dragging;

      // Remove from source column
      const sourceColumn = this.columns.find(c => c.id === sourceColumnId);
      if (sourceColumn && sourceColumn.cards) {
        const cardIndex = sourceColumn.cards.findIndex(c => c.id === card.id);
        if (cardIndex > -1) {
          sourceColumn.cards.splice(cardIndex, 1);
        }
      }

      // Add to target column
      const targetColumn = this.columns.find(c => c.id === targetColumnId);
      if (targetColumn) {
        if (!targetColumn.cards) targetColumn.cards = [];

        // Update card's columnId
        card.columnId = targetColumnId;

        // Insert at position
        if (typeof targetIndex === 'number') {
          targetColumn.cards.splice(targetIndex, 0, card);
        } else {
          targetColumn.cards.push(card);
        }
      }

      // Reset drag state
      this.dragging = null;
      this.dragOverColumn = null;
      this.dragOverIndex = null;

      // Dispatch event
      this.$dispatch('kanban:move', {
        card,
        fromColumn: sourceColumnId,
        toColumn: targetColumnId,
        toIndex: targetIndex
      });
    },

    // Add new card
    addCard(columnId, cardData = {}) {
      const column = this.columns.find(c => c.id === columnId);
      if (!column) return;

      const newCard = {
        id: cardData.id || 'card-' + Date.now(),
        title: cardData.title || 'Nueva tarjeta',
        columnId,
        ...cardData
      };

      if (!column.cards) column.cards = [];
      column.cards.push(newCard);

      this.$dispatch('kanban:add', { card: newCard, columnId });
      return newCard;
    },

    // Remove card
    removeCard(cardId, columnId) {
      const column = this.columns.find(c => c.id === columnId);
      if (!column || !column.cards) return;

      const cardIndex = column.cards.findIndex(c => c.id === cardId);
      if (cardIndex > -1) {
        const card = column.cards[cardIndex];
        column.cards.splice(cardIndex, 1);
        this.$dispatch('kanban:remove', { card, columnId });
      }
    },

    // Update card
    updateCard(cardId, columnId, updates) {
      const column = this.columns.find(c => c.id === columnId);
      if (!column || !column.cards) return;

      const card = column.cards.find(c => c.id === cardId);
      if (card) {
        Object.assign(card, updates);
        this.$dispatch('kanban:update', { card, columnId, updates });
      }
    },

    // Add new column
    addColumn(columnData = {}) {
      const newColumn = {
        id: columnData.id || 'column-' + Date.now(),
        title: columnData.title || 'Nueva columna',
        cards: [],
        ...columnData
      };

      this.columns.push(newColumn);
      this.$dispatch('kanban:addcolumn', { column: newColumn });
      return newColumn;
    },

    // Remove column
    removeColumn(columnId) {
      const columnIndex = this.columns.findIndex(c => c.id === columnId);
      if (columnIndex > -1) {
        const column = this.columns[columnIndex];
        this.columns.splice(columnIndex, 1);
        this.$dispatch('kanban:removecolumn', { column });
      }
    },

    // Card click handler
    onCardClick(card, columnId, event) {
      this.$dispatch('kanban:click', { card, columnId, event });
    },

    // Check if column is being dragged over
    isColumnDragOver(columnId) {
      return this.dragOverColumn === columnId;
    },

    // Get all cards (flat array)
    getAllCards() {
      return this.columns.flatMap(col => col.cards || []);
    },

    // Move card to specific position
    moveCard(cardId, fromColumnId, toColumnId, toIndex) {
      const fromColumn = this.columns.find(c => c.id === fromColumnId);
      const toColumn = this.columns.find(c => c.id === toColumnId);

      if (!fromColumn || !toColumn) return;

      const cardIndex = fromColumn.cards.findIndex(c => c.id === cardId);
      if (cardIndex === -1) return;

      const [card] = fromColumn.cards.splice(cardIndex, 1);
      card.columnId = toColumnId;

      if (!toColumn.cards) toColumn.cards = [];
      toColumn.cards.splice(toIndex, 0, card);

      this.$dispatch('kanban:move', {
        card,
        fromColumn: fromColumnId,
        toColumn: toColumnId,
        toIndex
      });
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxKanban', kanbanData);
  }

})();

/**
 * UX Keyboard - Unified keyboard navigation and shortcuts system
 * Global hotkeys, focus management, and keyboard navigation helpers
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Keyboard Styles
    ======================================== */

    /* Skip to main content link */
    .ux-skip-link {
      position: fixed;
      top: -100px;
      left: var(--ux-space-md);
      z-index: calc(var(--ux-z-toast) + 100);
      padding: var(--ux-space-sm) var(--ux-space-lg);
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      text-decoration: none;
      transition: top 0.2s ease;
      box-shadow: var(--ux-shadow-lg);
    }

    .ux-skip-link:focus {
      top: var(--ux-space-md);
      outline: none;
    }

    /* Keyboard shortcut hint badge */
    .ux-kbd {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 1.5em;
      height: 1.5em;
      padding: 0 0.4em;
      background: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-sm);
      font-family: var(--ux-font-mono, 'SF Mono', 'Monaco', 'Consolas', monospace);
      font-size: 0.75em;
      font-weight: 500;
      color: var(--ux-text-secondary);
      box-shadow: 0 1px 0 var(--ux-border-color);
      white-space: nowrap;
    }

    .ux-kbd--sm {
      min-width: 1.25em;
      height: 1.25em;
      padding: 0 0.3em;
      font-size: 0.65em;
    }

    .ux-kbd--lg {
      min-width: 2em;
      height: 2em;
      padding: 0 0.5em;
      font-size: 0.85em;
    }

    /* Keyboard shortcut combo */
    .ux-kbd-combo {
      display: inline-flex;
      align-items: center;
      gap: 0.25em;
    }

    .ux-kbd-combo__separator {
      color: var(--ux-text-tertiary);
      font-size: 0.75em;
    }

    /* Focus visible enhancement */
    .ux-keyboard-nav *:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    /* Hide focus ring for mouse users */
    .ux-keyboard-nav--mouse *:focus:not(:focus-visible) {
      outline: none;
    }

    /* Shortcut palette/command menu trigger hint */
    .ux-keyboard-hint {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
    }

    .ux-keyboard-hint__text {
      opacity: 0.8;
    }

    /* Roving tabindex indicator */
    [data-ux-roving] [tabindex="0"]:focus {
      background: var(--ux-surface-secondary);
    }

    /* Arrow key navigation indicator */
    .ux-arrow-nav {
      position: relative;
    }

    .ux-arrow-nav::after {
      content: '';
      position: absolute;
      inset: 0;
      border: 2px solid transparent;
      border-radius: inherit;
      pointer-events: none;
      transition: border-color 0.15s ease;
    }

    .ux-arrow-nav:focus-within::after {
      border-color: var(--ux-primary-soft);
    }

    /* Glass variant */
    .ux-kbd--glass {
      background: var(--ux-glass-bg-thin);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
      .ux-kbd {
        background: var(--ux-surface-tertiary);
        border-color: var(--ux-border-color);
      }
    }

    .ux-dark .ux-kbd {
      background: var(--ux-surface-tertiary);
      border-color: var(--ux-border-color);
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .ux-skip-link {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-keyboard-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-keyboard-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Platform detection
  const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
  const modKey = isMac ? 'Meta' : 'Control';
  const modKeySymbol = isMac ? 'â' : 'Ctrl';
  const altKeySymbol = isMac ? 'â¥' : 'Alt';
  const shiftKeySymbol = isMac ? 'â§' : 'Shift';

  // Key symbols mapping
  const keySymbols = {
    'ArrowUp': 'â',
    'ArrowDown': 'â',
    'ArrowLeft': 'â',
    'ArrowRight': 'â',
    'Enter': 'âµ',
    'Escape': 'Esc',
    'Backspace': 'â«',
    'Delete': 'â¦',
    'Tab': 'â¥',
    'Space': 'â£',
    'Meta': 'â',
    'Control': 'Ctrl',
    'Alt': isMac ? 'â¥' : 'Alt',
    'Shift': isMac ? 'â§' : 'Shift'
  };

  /**
   * Global keyboard manager
   */
  const UXKeyboard = {
    // Registered shortcuts
    shortcuts: new Map(),

    // Shortcut scopes (global, modal, etc.)
    scopes: ['global'],

    // Active scope
    activeScope: 'global',

    // Whether keyboard navigation is active
    isKeyboardNav: false,

    // Callbacks
    callbacks: {
      shortcut: [],
      scopeChange: []
    },

    /**
     * Initialize keyboard manager
     */
    init() {
      // Track keyboard vs mouse navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Tab') {
          this.setKeyboardNav(true);
        }
        this.handleKeydown(e);
      });

      document.addEventListener('mousedown', () => {
        this.setKeyboardNav(false);
      });

      // Add keyboard nav class to body
      document.body.classList.add('ux-keyboard-nav');

      // Create skip link if not exists
      this.createSkipLink();

      console.log('UX Keyboard initialized');
    },

    /**
     * Set keyboard navigation mode
     */
    setKeyboardNav(isKeyboard) {
      this.isKeyboardNav = isKeyboard;
      document.body.classList.toggle('ux-keyboard-nav--mouse', !isKeyboard);
    },

    /**
     * Create skip to main content link
     */
    createSkipLink() {
      if (document.querySelector('.ux-skip-link')) return;

      const main = document.querySelector('main, [role="main"], #main, .main-content');
      if (!main) return;

      if (!main.id) main.id = 'main-content';

      const skipLink = document.createElement('a');
      skipLink.href = `#${main.id}`;
      skipLink.className = 'ux-skip-link';
      skipLink.textContent = 'Skip to main content';
      document.body.insertBefore(skipLink, document.body.firstChild);
    },

    /**
     * Register a keyboard shortcut
     * @param {string} combo - Key combination (e.g., 'mod+k', 'shift+?', 'escape')
     * @param {Function} callback - Handler function
     * @param {Object} options - Options (scope, description, preventDefault)
     */
    register(combo, callback, options = {}) {
      const {
        scope = 'global',
        description = '',
        preventDefault = true,
        allowInInput = false
      } = options;

      const normalizedCombo = this.normalizeCombo(combo);
      const key = `${scope}:${normalizedCombo}`;

      this.shortcuts.set(key, {
        combo: normalizedCombo,
        original: combo,
        callback,
        scope,
        description,
        preventDefault,
        allowInInput
      });

      return () => this.unregister(combo, scope);
    },

    /**
     * Unregister a shortcut
     */
    unregister(combo, scope = 'global') {
      const normalizedCombo = this.normalizeCombo(combo);
      const key = `${scope}:${normalizedCombo}`;
      this.shortcuts.delete(key);
    },

    /**
     * Normalize key combination
     */
    normalizeCombo(combo) {
      return combo
        .toLowerCase()
        .replace(/\s+/g, '')
        .replace('mod', modKey.toLowerCase())
        .replace('cmd', 'meta')
        .replace('ctrl', 'control')
        .replace('opt', 'alt')
        .replace('option', 'alt')
        .split('+')
        .sort()
        .join('+');
    },

    /**
     * Get combo from event
     */
    getComboFromEvent(e) {
      const parts = [];

      if (e.ctrlKey) parts.push('control');
      if (e.metaKey) parts.push('meta');
      if (e.altKey) parts.push('alt');
      if (e.shiftKey) parts.push('shift');

      // Add the actual key
      const key = e.key.toLowerCase();
      if (!['control', 'meta', 'alt', 'shift'].includes(key)) {
        parts.push(key);
      }

      return parts.sort().join('+');
    },

    /**
     * Handle keydown event
     */
    handleKeydown(e) {
      // Skip if in input and not allowed
      const isInput = ['INPUT', 'TEXTAREA', 'SELECT'].includes(e.target.tagName) ||
                      e.target.isContentEditable;

      const combo = this.getComboFromEvent(e);

      // Check shortcuts in active scope first, then global
      const scopes = this.activeScope === 'global'
        ? ['global']
        : [this.activeScope, 'global'];

      for (const scope of scopes) {
        const key = `${scope}:${combo}`;
        const shortcut = this.shortcuts.get(key);

        if (shortcut) {
          if (isInput && !shortcut.allowInInput) continue;

          if (shortcut.preventDefault) {
            e.preventDefault();
          }

          shortcut.callback(e);

          // Emit event
          this.callbacks.shortcut.forEach(cb => cb(shortcut, e));

          return;
        }
      }
    },

    /**
     * Push a new scope (e.g., when modal opens)
     */
    pushScope(scope) {
      this.scopes.push(scope);
      this.activeScope = scope;
      this.callbacks.scopeChange.forEach(cb => cb(scope, 'push'));
    },

    /**
     * Pop current scope (e.g., when modal closes)
     */
    popScope() {
      if (this.scopes.length > 1) {
        const removed = this.scopes.pop();
        this.activeScope = this.scopes[this.scopes.length - 1];
        this.callbacks.scopeChange.forEach(cb => cb(this.activeScope, 'pop'));
        return removed;
      }
      return null;
    },

    /**
     * Get all registered shortcuts for a scope
     */
    getShortcuts(scope = null) {
      const results = [];
      this.shortcuts.forEach((shortcut, key) => {
        if (!scope || shortcut.scope === scope) {
          results.push(shortcut);
        }
      });
      return results;
    },

    /**
     * Format combo for display
     */
    formatCombo(combo) {
      return combo
        .split('+')
        .map(key => {
          const k = key.charAt(0).toUpperCase() + key.slice(1);
          if (k === 'Meta') return modKeySymbol;
          if (k === 'Control') return 'Ctrl';
          if (k === 'Alt') return altKeySymbol;
          if (k === 'Shift') return shiftKeySymbol;
          return keySymbols[k] || k;
        })
        .join(' + ');
    },

    /**
     * Create HTML for keyboard shortcut display
     */
    renderCombo(combo, options = {}) {
      const { size = '', glass = false } = options;
      const keys = combo.split('+').map(key => {
        const k = key.charAt(0).toUpperCase() + key.slice(1);
        let display = k;
        if (k === 'Meta') display = modKeySymbol;
        else if (k === 'Control') display = 'Ctrl';
        else if (k === 'Alt') display = altKeySymbol;
        else if (k === 'Shift') display = shiftKeySymbol;
        else if (keySymbols[k]) display = keySymbols[k];

        const classes = ['ux-kbd'];
        if (size) classes.push(`ux-kbd--${size}`);
        if (glass) classes.push('ux-kbd--glass');

        return `<kbd class="${classes.join(' ')}">${display}</kbd>`;
      });

      return `<span class="ux-kbd-combo">${keys.join('<span class="ux-kbd-combo__separator">+</span>')}</span>`;
    },

    /**
     * Event listeners
     */
    on(event, callback) {
      if (this.callbacks[event]) {
        this.callbacks[event].push(callback);
      }
      return () => this.off(event, callback);
    },

    off(event, callback) {
      if (this.callbacks[event]) {
        const idx = this.callbacks[event].indexOf(callback);
        if (idx > -1) this.callbacks[event].splice(idx, 1);
      }
    }
  };

  /**
   * Roving tabindex helper for arrow key navigation
   */
  const rovingTabindex = {
    /**
     * Initialize roving tabindex on a container
     * @param {HTMLElement} container - Container element
     * @param {Object} options - Options
     */
    init(container, options = {}) {
      const {
        selector = '[role="menuitem"], [role="option"], [role="tab"], button, a',
        orientation = 'both', // 'horizontal', 'vertical', 'both'
        wrap = true,
        onSelect = null
      } = options;

      container.setAttribute('data-ux-roving', '');

      const getItems = () => Array.from(container.querySelectorAll(selector))
        .filter(el => !el.disabled && el.offsetParent !== null);

      const setFocus = (index, items) => {
        items.forEach((item, i) => {
          item.setAttribute('tabindex', i === index ? '0' : '-1');
        });
        items[index]?.focus();
      };

      // Set initial tabindex
      const items = getItems();
      items.forEach((item, i) => {
        item.setAttribute('tabindex', i === 0 ? '0' : '-1');
      });

      container.addEventListener('keydown', (e) => {
        const items = getItems();
        const currentIndex = items.indexOf(document.activeElement);
        if (currentIndex === -1) return;

        let nextIndex = currentIndex;
        const isHorizontal = orientation === 'horizontal' || orientation === 'both';
        const isVertical = orientation === 'vertical' || orientation === 'both';

        switch (e.key) {
          case 'ArrowRight':
            if (isHorizontal) {
              e.preventDefault();
              nextIndex = wrap
                ? (currentIndex + 1) % items.length
                : Math.min(currentIndex + 1, items.length - 1);
            }
            break;
          case 'ArrowLeft':
            if (isHorizontal) {
              e.preventDefault();
              nextIndex = wrap
                ? (currentIndex - 1 + items.length) % items.length
                : Math.max(currentIndex - 1, 0);
            }
            break;
          case 'ArrowDown':
            if (isVertical) {
              e.preventDefault();
              nextIndex = wrap
                ? (currentIndex + 1) % items.length
                : Math.min(currentIndex + 1, items.length - 1);
            }
            break;
          case 'ArrowUp':
            if (isVertical) {
              e.preventDefault();
              nextIndex = wrap
                ? (currentIndex - 1 + items.length) % items.length
                : Math.max(currentIndex - 1, 0);
            }
            break;
          case 'Home':
            e.preventDefault();
            nextIndex = 0;
            break;
          case 'End':
            e.preventDefault();
            nextIndex = items.length - 1;
            break;
          case 'Enter':
          case ' ':
            if (onSelect) {
              e.preventDefault();
              onSelect(items[currentIndex], currentIndex);
            }
            return;
        }

        if (nextIndex !== currentIndex) {
          setFocus(nextIndex, items);
        }
      });

      return {
        refresh: () => {
          const items = getItems();
          const focused = items.find(i => i === document.activeElement);
          const focusIndex = focused ? items.indexOf(focused) : 0;
          items.forEach((item, i) => {
            item.setAttribute('tabindex', i === focusIndex ? '0' : '-1');
          });
        },
        destroy: () => {
          container.removeAttribute('data-ux-roving');
        }
      };
    }
  };

  /**
   * Focus trap helper
   */
  const focusTrap = {
    /**
     * Create a focus trap
     * @param {HTMLElement} container - Container element
     * @param {Object} options - Options
     */
    create(container, options = {}) {
      const {
        initialFocus = null,
        returnFocus = true,
        escapeDeactivates = true,
        onEscape = null
      } = options;

      const previouslyFocused = document.activeElement;

      const getFocusable = () => {
        const selector = [
          'a[href]',
          'button:not([disabled])',
          'input:not([disabled])',
          'select:not([disabled])',
          'textarea:not([disabled])',
          '[tabindex]:not([tabindex="-1"])',
          '[contenteditable="true"]'
        ].join(', ');

        return Array.from(container.querySelectorAll(selector))
          .filter(el => el.offsetParent !== null);
      };

      const handleKeydown = (e) => {
        if (e.key === 'Tab') {
          const focusable = getFocusable();
          const first = focusable[0];
          const last = focusable[focusable.length - 1];

          if (e.shiftKey && document.activeElement === first) {
            e.preventDefault();
            last?.focus();
          } else if (!e.shiftKey && document.activeElement === last) {
            e.preventDefault();
            first?.focus();
          }
        }

        if (e.key === 'Escape' && escapeDeactivates) {
          e.preventDefault();
          if (onEscape) onEscape();
        }
      };

      container.addEventListener('keydown', handleKeydown);

      // Set initial focus
      const focusable = getFocusable();
      const toFocus = initialFocus
        ? container.querySelector(initialFocus)
        : focusable[0];

      setTimeout(() => toFocus?.focus(), 0);

      return {
        deactivate: () => {
          container.removeEventListener('keydown', handleKeydown);
          if (returnFocus && previouslyFocused) {
            previouslyFocused.focus();
          }
        }
      };
    }
  };

  /**
   * Alpine.js component for keyboard shortcuts
   */
  const keyboardComponent = (config = {}) => ({
    shortcuts: [],
    showHelp: false,

    init() {
      // Register shortcuts from config
      if (config.shortcuts) {
        config.shortcuts.forEach(s => {
          UXKeyboard.register(s.combo, (e) => {
            if (s.action) {
              this[s.action]?.(e);
            }
            this.$dispatch('ux-shortcut', { combo: s.combo, ...s });
          }, {
            scope: config.scope || 'global',
            description: s.description,
            allowInInput: s.allowInInput
          });
        });
      }

      // Update shortcuts list
      this.shortcuts = UXKeyboard.getShortcuts(config.scope || 'global');

      // ? to show help
      if (config.showHelpOnQuestion !== false) {
        UXKeyboard.register('shift+?', () => {
          this.showHelp = !this.showHelp;
        }, {
          scope: config.scope || 'global',
          description: 'Show keyboard shortcuts'
        });
      }

      // Push scope if not global
      if (config.scope && config.scope !== 'global') {
        UXKeyboard.pushScope(config.scope);
      }
    },

    destroy() {
      // Pop scope if not global
      if (config.scope && config.scope !== 'global') {
        UXKeyboard.popScope();
      }
    },

    formatCombo(combo) {
      return UXKeyboard.formatCombo(combo);
    },

    renderCombo(combo) {
      return UXKeyboard.renderCombo(combo);
    }
  });

  // Register Alpine component
  if (window.UX) {
    window.UX.registerComponent('uxKeyboard', keyboardComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxKeyboard', keyboardComponent);
    });
  }

  // Export to window
  window.UXKeyboard = UXKeyboard;
  window.UXRovingTabindex = rovingTabindex;
  window.UXFocusTrap = focusTrap;

  // Auto-init
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => UXKeyboard.init());
  } else {
    UXKeyboard.init();
  }

  // Register common shortcuts
  UXKeyboard.register('escape', () => {
    // Close any open modal/sheet/popover
    const event = new CustomEvent('ux-escape');
    document.dispatchEvent(event);
  }, {
    description: 'Close modal/popover'
  });

})();
/**
 * UX Leave Request Component
 * Leave request cards for HR/employee management systems
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Leave Request Card
    ======================================== */

    :root {
      --ux-leave-request-border-radius: var(--ux-border-radius-lg, 12px);
      --ux-leave-request-padding: var(--ux-space-lg, 1.5rem);
      --ux-leave-request-gap: var(--ux-space-md, 1rem);
    }

    .ux-leave-request {
      position: relative;
      display: flex;
      flex-direction: column;
      background-color: var(--ux-surface);
      border-radius: var(--ux-leave-request-border-radius);
      box-shadow: var(--ux-shadow-sm);
      overflow: hidden;
      width: 100%;
      max-width: 420px;
    }

    /* Status indicator border */
    .ux-leave-request::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background-color: var(--ux-leave-request-status-color, var(--ux-warning));
      border-radius: var(--ux-leave-request-border-radius) 0 0 var(--ux-leave-request-border-radius);
    }

    /* ========================================
       Header
    ======================================== */

    .ux-leave-request__header {
      display: flex;
      align-items: flex-start;
      gap: var(--ux-space-md);
      padding: var(--ux-leave-request-padding);
      padding-bottom: var(--ux-space-md);
    }

    .ux-leave-request__avatar {
      flex-shrink: 0;
    }

    .ux-leave-request__employee {
      flex: 1;
      min-width: 0;
    }

    .ux-leave-request__name {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      line-height: 1.3;
    }

    .ux-leave-request__role {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: var(--ux-space-xs) 0 0;
    }

    .ux-leave-request__department {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      margin: var(--ux-space-xs) 0 0;
    }

    .ux-leave-request__status {
      flex-shrink: 0;
    }

    /* ========================================
       Leave Type
    ======================================== */

    .ux-leave-request__type {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-radius: var(--ux-border-radius);
      background-color: var(--ux-leave-type-bg, var(--ux-surface-secondary));
      color: var(--ux-leave-type-color, var(--ux-text-secondary));
    }

    .ux-leave-request__type-icon {
      width: 14px;
      height: 14px;
    }

    .ux-leave-request__type-icon svg {
      width: 100%;
      height: 100%;
    }

    /* Leave type variants */
    .ux-leave-request__type--vacation {
      --ux-leave-type-bg: rgba(var(--ux-blue-500-rgb, 59, 130, 246), 0.12);
      --ux-leave-type-color: var(--ux-blue-600, #2563eb);
    }

    .ux-leave-request__type--sick {
      --ux-leave-type-bg: rgba(var(--ux-red-500-rgb, 239, 68, 68), 0.12);
      --ux-leave-type-color: var(--ux-red-600, #dc2626);
    }

    .ux-leave-request__type--personal {
      --ux-leave-type-bg: rgba(var(--ux-purple-500-rgb, 168, 85, 247), 0.12);
      --ux-leave-type-color: var(--ux-purple-600, #9333ea);
    }

    .ux-leave-request__type--maternity {
      --ux-leave-type-bg: rgba(var(--ux-pink-500-rgb, 236, 72, 153), 0.12);
      --ux-leave-type-color: var(--ux-pink-600, #db2777);
    }

    .ux-leave-request__type--paternity {
      --ux-leave-type-bg: rgba(var(--ux-cyan-500-rgb, 6, 182, 212), 0.12);
      --ux-leave-type-color: var(--ux-cyan-600, #0891b2);
    }

    .ux-leave-request__type--bereavement {
      --ux-leave-type-bg: rgba(var(--ux-gray-500-rgb, 107, 114, 128), 0.12);
      --ux-leave-type-color: var(--ux-gray-600, #4b5563);
    }

    .ux-leave-request__type--unpaid {
      --ux-leave-type-bg: rgba(var(--ux-orange-500-rgb, 249, 115, 22), 0.12);
      --ux-leave-type-color: var(--ux-orange-600, #ea580c);
    }

    .ux-leave-request__type--work-from-home {
      --ux-leave-type-bg: rgba(var(--ux-green-500-rgb, 34, 197, 94), 0.12);
      --ux-leave-type-color: var(--ux-green-600, #16a34a);
    }

    /* ========================================
       Content Body
    ======================================== */

    .ux-leave-request__body {
      padding: 0 var(--ux-leave-request-padding);
    }

    /* ========================================
       Dates Section
    ======================================== */

    .ux-leave-request__dates {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
      margin-bottom: var(--ux-space-md);
    }

    .ux-leave-request__date {
      flex: 1;
      text-align: center;
    }

    .ux-leave-request__date-label {
      display: block;
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--ux-space-xs);
    }

    .ux-leave-request__date-value {
      display: block;
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-leave-request__date-day {
      display: block;
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      margin-top: 2px;
    }

    .ux-leave-request__dates-arrow {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      color: var(--ux-text-tertiary);
    }

    .ux-leave-request__dates-arrow svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Duration
    ======================================== */

    .ux-leave-request__duration {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background-color: var(--ux-surface-tertiary);
      border-radius: var(--ux-border-radius);
      margin-bottom: var(--ux-space-md);
    }

    .ux-leave-request__duration-icon {
      width: 16px;
      height: 16px;
      color: var(--ux-text-secondary);
    }

    .ux-leave-request__duration-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-leave-request__duration-value {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-leave-request__duration-label {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* ========================================
       Reason/Notes
    ======================================== */

    .ux-leave-request__reason {
      padding: var(--ux-space-md);
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
      margin-bottom: var(--ux-space-md);
      border-left: 3px solid var(--ux-border-color);
    }

    .ux-leave-request__reason-label {
      display: block;
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--ux-space-xs);
    }

    .ux-leave-request__reason-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      line-height: 1.5;
      margin: 0;
    }

    /* ========================================
       Meta Information (submitted date, etc)
    ======================================== */

    .ux-leave-request__meta {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-md);
      padding: var(--ux-space-sm) 0;
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-leave-request__meta-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-leave-request__meta-icon {
      width: 12px;
      height: 12px;
    }

    .ux-leave-request__meta-icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Actions
    ======================================== */

    .ux-leave-request__actions {
      display: flex;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md) var(--ux-leave-request-padding);
      border-top: 1px solid var(--ux-border-color);
      background-color: var(--ux-surface-secondary);
    }

    .ux-leave-request__action {
      flex: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xs);
      height: var(--ux-touch-target-sm, 36px);
      padding: 0 var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      border: none;
      border-radius: var(--ux-border-radius);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease),
        opacity var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-leave-request__action:active {
      transform: scale(0.98);
    }

    .ux-leave-request__action--approve {
      background-color: var(--ux-success);
      color: var(--ux-success-contrast, #fff);
    }

    .ux-leave-request__action--approve:hover {
      background-color: var(--ux-success-shade);
    }

    .ux-leave-request__action--reject {
      background-color: var(--ux-danger);
      color: var(--ux-danger-contrast, #fff);
    }

    .ux-leave-request__action--reject:hover {
      background-color: var(--ux-danger-shade);
    }

    .ux-leave-request__action--secondary {
      background-color: var(--ux-surface);
      color: var(--ux-text-secondary);
      border: 1px solid var(--ux-border-color);
    }

    .ux-leave-request__action--secondary:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-leave-request__action:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .ux-leave-request__action-icon {
      width: 16px;
      height: 16px;
    }

    .ux-leave-request__action-icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Status Variants
    ======================================== */

    .ux-leave-request--pending {
      --ux-leave-request-status-color: var(--ux-warning);
    }

    .ux-leave-request--approved {
      --ux-leave-request-status-color: var(--ux-success);
    }

    .ux-leave-request--rejected {
      --ux-leave-request-status-color: var(--ux-danger);
    }

    .ux-leave-request--cancelled {
      --ux-leave-request-status-color: var(--ux-gray-400);
      opacity: 0.7;
    }

    .ux-leave-request--approved .ux-leave-request__actions,
    .ux-leave-request--rejected .ux-leave-request__actions,
    .ux-leave-request--cancelled .ux-leave-request__actions {
      background-color: transparent;
      border-top: none;
      padding-top: 0;
    }

    /* ========================================
       Status Badge (inside header)
    ======================================== */

    .ux-leave-request__status-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      border-radius: var(--ux-border-radius-full, 9999px);
    }

    .ux-leave-request__status-badge--pending {
      background-color: rgba(var(--ux-warning-rgb, 234, 179, 8), 0.15);
      color: var(--ux-warning-shade, #ca8a04);
    }

    .ux-leave-request__status-badge--approved {
      background-color: rgba(var(--ux-success-rgb, 34, 197, 94), 0.15);
      color: var(--ux-success-shade, #16a34a);
    }

    .ux-leave-request__status-badge--rejected {
      background-color: rgba(var(--ux-danger-rgb, 239, 68, 68), 0.15);
      color: var(--ux-danger-shade, #dc2626);
    }

    .ux-leave-request__status-badge--cancelled {
      background-color: var(--ux-surface-tertiary);
      color: var(--ux-text-tertiary);
    }

    .ux-leave-request__status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: currentColor;
    }

    .ux-leave-request__status-badge--pending .ux-leave-request__status-dot {
      animation: ux-leave-request-pulse 1.5s ease-in-out infinite;
    }

    @keyframes ux-leave-request-pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.8); }
    }

    /* ========================================
       Compact Variant
    ======================================== */

    .ux-leave-request--compact {
      max-width: 360px;
    }

    .ux-leave-request--compact .ux-leave-request__header {
      padding: var(--ux-space-md);
    }

    .ux-leave-request--compact .ux-leave-request__body {
      padding: 0 var(--ux-space-md);
    }

    .ux-leave-request--compact .ux-leave-request__dates {
      padding: var(--ux-space-sm);
    }

    .ux-leave-request--compact .ux-leave-request__actions {
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-leave-request--glass {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-leave-request--glass .ux-leave-request__dates,
    .ux-leave-request--glass .ux-leave-request__duration,
    .ux-leave-request--glass .ux-leave-request__reason {
      background-color: rgba(255, 255, 255, 0.3);
    }

    .ux-leave-request--glass .ux-leave-request__actions {
      background-color: rgba(255, 255, 255, 0.2);
      border-top-color: var(--ux-glass-border);
    }

    /* ========================================
       Leave Request Form
    ======================================== */

    .ux-leave-request-form {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md);
      background-color: var(--ux-surface);
      border-radius: var(--ux-leave-request-border-radius);
      box-shadow: var(--ux-shadow-sm);
      padding: var(--ux-leave-request-padding);
      max-width: 480px;
    }

    .ux-leave-request-form__title {
      font-size: var(--ux-font-size-xl);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-sm);
    }

    .ux-leave-request-form__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0 0 var(--ux-space-md);
    }

    .ux-leave-request-form__row {
      display: flex;
      gap: var(--ux-space-md);
    }

    .ux-leave-request-form__row > * {
      flex: 1;
    }

    .ux-leave-request-form__field {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
    }

    .ux-leave-request-form__label {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
    }

    .ux-leave-request-form__label--required::after {
      content: ' *';
      color: var(--ux-danger);
    }

    .ux-leave-request-form__balance {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--ux-space-md);
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
      margin-bottom: var(--ux-space-sm);
    }

    .ux-leave-request-form__balance-label {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-leave-request-form__balance-value {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-primary);
    }

    .ux-leave-request-form__balance-value--low {
      color: var(--ux-danger);
    }

    .ux-leave-request-form__actions {
      display: flex;
      gap: var(--ux-space-sm);
      margin-top: var(--ux-space-md);
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-leave-request-form__actions > * {
      flex: 1;
    }

    /* Leave type selector grid */
    .ux-leave-request-form__types {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: var(--ux-space-sm);
    }

    .ux-leave-request-form__type-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-md);
      background-color: var(--ux-surface-secondary);
      border: 2px solid transparent;
      border-radius: var(--ux-border-radius);
      cursor: pointer;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        background-color var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-leave-request-form__type-option:hover {
      background-color: var(--ux-surface-tertiary);
    }

    .ux-leave-request-form__type-option--selected {
      border-color: var(--ux-primary);
      background-color: rgba(var(--ux-primary-rgb), 0.08);
    }

    .ux-leave-request-form__type-option input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .ux-leave-request-form__type-icon {
      width: 24px;
      height: 24px;
      color: var(--ux-text-secondary);
    }

    .ux-leave-request-form__type-option--selected .ux-leave-request-form__type-icon {
      color: var(--ux-primary);
    }

    .ux-leave-request-form__type-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-leave-request-form__type-name {
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      color: var(--ux-text);
      text-align: center;
    }

    /* Glass form variant */
    .ux-leave-request-form--glass {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-leave-request-form--glass .ux-leave-request-form__balance,
    .ux-leave-request-form--glass .ux-leave-request-form__type-option {
      background-color: rgba(255, 255, 255, 0.3);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 480px) {
      .ux-leave-request-form__row {
        flex-direction: column;
      }

      .ux-leave-request__dates {
        flex-direction: column;
        text-align: center;
      }

      .ux-leave-request__dates-arrow {
        transform: rotate(90deg);
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light):not(.ux-theme-light) {
        .ux-leave-request--glass .ux-leave-request__dates,
        .ux-leave-request--glass .ux-leave-request__duration,
        .ux-leave-request--glass .ux-leave-request__reason,
        .ux-leave-request--glass .ux-leave-request__actions {
          background-color: rgba(0, 0, 0, 0.2);
        }

        .ux-leave-request-form--glass .ux-leave-request-form__balance,
        .ux-leave-request-form--glass .ux-leave-request-form__type-option {
          background-color: rgba(0, 0, 0, 0.2);
        }
      }
    }

    .ux-dark .ux-leave-request--glass .ux-leave-request__dates,
    .ux-dark .ux-leave-request--glass .ux-leave-request__duration,
    .ux-dark .ux-leave-request--glass .ux-leave-request__reason,
    .ux-dark .ux-leave-request--glass .ux-leave-request__actions,
    .ux-theme-dark .ux-leave-request--glass .ux-leave-request__dates,
    .ux-theme-dark .ux-leave-request--glass .ux-leave-request__duration,
    .ux-theme-dark .ux-leave-request--glass .ux-leave-request__reason,
    .ux-theme-dark .ux-leave-request--glass .ux-leave-request__actions {
      background-color: rgba(0, 0, 0, 0.2);
    }

    .ux-dark .ux-leave-request-form--glass .ux-leave-request-form__balance,
    .ux-dark .ux-leave-request-form--glass .ux-leave-request-form__type-option,
    .ux-theme-dark .ux-leave-request-form--glass .ux-leave-request-form__balance,
    .ux-theme-dark .ux-leave-request-form--glass .ux-leave-request-form__type-option {
      background-color: rgba(0, 0, 0, 0.2);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-leave-request__status-badge--pending .ux-leave-request__status-dot {
        animation: none;
      }

      .ux-leave-request__action {
        transition: none;
      }

      .ux-leave-request-form__type-option {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-leave-request-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-leave-request-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for leave request form
  const leaveRequestFormComponent = (config = {}) => ({
    // Form state
    leaveType: config.leaveType || '',
    startDate: config.startDate || '',
    endDate: config.endDate || '',
    reason: config.reason || '',
    isHalfDay: config.isHalfDay || false,
    halfDayPeriod: config.halfDayPeriod || 'morning', // 'morning' or 'afternoon'

    // Available leave types
    leaveTypes: config.leaveTypes || [
      { id: 'vacation', name: 'Vacation', icon: 'sun' },
      { id: 'sick', name: 'Sick', icon: 'medical' },
      { id: 'personal', name: 'Personal', icon: 'user' },
      { id: 'maternity', name: 'Maternity', icon: 'heart' },
      { id: 'paternity', name: 'Paternity', icon: 'heart' },
      { id: 'bereavement', name: 'Bereavement', icon: 'flower' },
      { id: 'unpaid', name: 'Unpaid', icon: 'wallet' },
      { id: 'work-from-home', name: 'WFH', icon: 'home' }
    ],

    // Leave balance
    balance: config.balance || {
      vacation: 15,
      sick: 10,
      personal: 3
    },

    // Validation
    errors: {},
    submitting: false,
    submitted: false,

    // Computed
    get duration() {
      if (!this.startDate || !this.endDate) return 0;
      const start = new Date(this.startDate);
      const end = new Date(this.endDate);
      if (end < start) return 0;

      let days = 0;
      const current = new Date(start);
      while (current <= end) {
        const dayOfWeek = current.getDay();
        if (dayOfWeek !== 0 && dayOfWeek !== 6) {
          days++;
        }
        current.setDate(current.getDate() + 1);
      }

      if (this.isHalfDay && days === 1) {
        return 0.5;
      }
      return days;
    },

    get currentBalance() {
      const type = this.leaveType;
      if (type === 'vacation' || type === 'sick' || type === 'personal') {
        return this.balance[type] || 0;
      }
      return null;
    },

    get remainingBalance() {
      if (this.currentBalance === null) return null;
      return Math.max(0, this.currentBalance - this.duration);
    },

    get isBalanceLow() {
      return this.remainingBalance !== null && this.remainingBalance < 3;
    },

    get isValid() {
      return this.leaveType && this.startDate && this.endDate && this.duration > 0;
    },

    // Methods
    selectType(type) {
      this.leaveType = type;
      this.errors.leaveType = '';
    },

    validate() {
      this.errors = {};

      if (!this.leaveType) {
        this.errors.leaveType = 'Please select a leave type';
      }

      if (!this.startDate) {
        this.errors.startDate = 'Start date is required';
      }

      if (!this.endDate) {
        this.errors.endDate = 'End date is required';
      }

      if (this.startDate && this.endDate) {
        const start = new Date(this.startDate);
        const end = new Date(this.endDate);
        if (end < start) {
          this.errors.endDate = 'End date must be after start date';
        }
      }

      if (this.duration <= 0 && this.startDate && this.endDate) {
        this.errors.endDate = 'Selected dates have no working days';
      }

      if (this.currentBalance !== null && this.duration > this.currentBalance) {
        this.errors.duration = 'Insufficient leave balance';
      }

      return Object.keys(this.errors).length === 0;
    },

    async submit() {
      if (!this.validate()) return;

      this.submitting = true;

      try {
        const data = {
          leaveType: this.leaveType,
          startDate: this.startDate,
          endDate: this.endDate,
          duration: this.duration,
          reason: this.reason,
          isHalfDay: this.isHalfDay,
          halfDayPeriod: this.halfDayPeriod
        };

        this.$dispatch('leave-request:submit', data);
        this.submitted = true;

        // Reset form after successful submission
        if (config.resetOnSubmit !== false) {
          this.reset();
        }
      } catch (error) {
        this.errors.submit = error.message || 'Failed to submit request';
      } finally {
        this.submitting = false;
      }
    },

    reset() {
      this.leaveType = '';
      this.startDate = '';
      this.endDate = '';
      this.reason = '';
      this.isHalfDay = false;
      this.halfDayPeriod = 'morning';
      this.errors = {};
      this.submitted = false;
    },

    cancel() {
      this.$dispatch('leave-request:cancel');
      this.reset();
    }
  });

  // Register Alpine component
  if (window.UX) {
    window.UX.registerComponent('uxLeaveRequestForm', leaveRequestFormComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxLeaveRequestForm', leaveRequestFormComponent);
    });
  }
})();

/**
 * UX Lightbox Component
 * Image viewer with zoom, navigation, and gallery support
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Lightbox
    ======================================== */

    .ux-lightbox {
      position: fixed;
      inset: 0;
      z-index: var(--ux-z-modal);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--ux-transition-normal), visibility var(--ux-transition-normal);
      font-family: var(--ux-font-family);
    }

    .ux-lightbox--open {
      opacity: 1;
      visibility: visible;
    }

    /* ========================================
       Backdrop
    ======================================== */

    .ux-lightbox__backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: -1;
    }

    /* ========================================
       Content Container
    ======================================== */

    .ux-lightbox__container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    /* ========================================
       Header
    ======================================== */

    .ux-lightbox__header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md);
      padding-top: max(var(--ux-space-md), var(--ux-safe-top));
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.5), transparent);
      z-index: 10;
      opacity: 1;
      transition: opacity var(--ux-transition-normal);
    }

    .ux-lightbox--hide-ui .ux-lightbox__header {
      opacity: 0;
      pointer-events: none;
    }

    .ux-lightbox__title {
      color: white;
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-lightbox__counter {
      color: rgba(255, 255, 255, 0.7);
      font-size: var(--ux-font-size-sm);
    }

    .ux-lightbox__actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    /* ========================================
       Image Container
    ======================================== */

    .ux-lightbox__image-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      padding: var(--ux-space-lg);
      cursor: grab;
    }

    .ux-lightbox__image-container:active {
      cursor: grabbing;
    }

    .ux-lightbox__image-wrapper {
      position: relative;
      max-width: 100%;
      max-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform var(--ux-transition-normal);
    }

    .ux-lightbox__image {
      max-width: 100%;
      max-height: calc(100dvh - 120px);
      object-fit: contain;
      user-select: none;
      -webkit-user-drag: none;
      border-radius: var(--ux-radius-sm);
    }

    .ux-lightbox--zoomed .ux-lightbox__image {
      max-width: none;
      max-height: none;
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-lightbox__loading {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ux-lightbox__spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-top-color: white;
      border-radius: 50%;
      animation: ux-lightbox-spin 0.8s linear infinite;
    }

    @keyframes ux-lightbox-spin {
      to { transform: rotate(360deg); }
    }

    /* ========================================
       Navigation Arrows
    ======================================== */

    .ux-lightbox__nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: all var(--ux-transition-fast);
      z-index: 10;
      opacity: 1;
    }

    .ux-lightbox--hide-ui .ux-lightbox__nav {
      opacity: 0;
      pointer-events: none;
    }

    .ux-lightbox__nav:hover {
      background: rgba(0, 0, 0, 0.7);
    }

    .ux-lightbox__nav:active {
      transform: translateY(-50%) scale(0.95);
    }

    .ux-lightbox__nav:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .ux-lightbox__nav--prev {
      left: var(--ux-space-md);
    }

    .ux-lightbox__nav--next {
      right: var(--ux-space-md);
    }

    .ux-lightbox__nav svg {
      width: 24px;
      height: 24px;
    }

    /* ========================================
       Toolbar Button
    ======================================== */

    .ux-lightbox__btn {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-lightbox__btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .ux-lightbox__btn:active {
      background: rgba(255, 255, 255, 0.3);
    }

    .ux-lightbox__btn svg {
      width: 22px;
      height: 22px;
    }

    /* ========================================
       Footer / Thumbnails
    ======================================== */

    .ux-lightbox__footer {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: var(--ux-space-md);
      padding-bottom: max(var(--ux-space-md), var(--ux-safe-bottom));
      background: linear-gradient(to top, rgba(0, 0, 0, 0.5), transparent);
      z-index: 10;
      opacity: 1;
      transition: opacity var(--ux-transition-normal);
    }

    .ux-lightbox--hide-ui .ux-lightbox__footer {
      opacity: 0;
      pointer-events: none;
    }

    .ux-lightbox__thumbnails {
      display: flex;
      gap: var(--ux-space-xs);
      justify-content: center;
      overflow-x: auto;
      padding: var(--ux-space-xs) 0;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .ux-lightbox__thumbnails::-webkit-scrollbar {
      display: none;
    }

    .ux-lightbox__thumbnail {
      flex-shrink: 0;
      width: 48px;
      height: 48px;
      border-radius: var(--ux-radius-sm);
      overflow: hidden;
      cursor: pointer;
      opacity: 0.5;
      transition: all var(--ux-transition-fast);
      border: 2px solid transparent;
    }

    .ux-lightbox__thumbnail:hover {
      opacity: 0.8;
    }

    .ux-lightbox__thumbnail--active {
      opacity: 1;
      border-color: white;
    }

    .ux-lightbox__thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ========================================
       Caption
    ======================================== */

    .ux-lightbox__caption {
      text-align: center;
      color: white;
      font-size: var(--ux-font-size-sm);
      margin-top: var(--ux-space-sm);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .ux-lightbox__caption-title {
      font-weight: 500;
      margin-bottom: var(--ux-space-xs);
    }

    .ux-lightbox__caption-description {
      color: rgba(255, 255, 255, 0.7);
    }

    /* ========================================
       Zoom Controls
    ======================================== */

    .ux-lightbox__zoom-controls {
      position: absolute;
      bottom: 80px;
      right: var(--ux-space-md);
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
      z-index: 10;
      opacity: 1;
      transition: opacity var(--ux-transition-normal);
    }

    .ux-lightbox--hide-ui .ux-lightbox__zoom-controls {
      opacity: 0;
      pointer-events: none;
    }

    .ux-lightbox__zoom-level {
      color: white;
      font-size: var(--ux-font-size-xs);
      text-align: center;
      background: rgba(0, 0, 0, 0.5);
      padding: 2px 8px;
      border-radius: var(--ux-radius-full);
    }

    /* ========================================
       Mobile Adjustments
    ======================================== */

    @media (max-width: 767px) {
      .ux-lightbox__nav {
        width: 40px;
        height: 40px;
      }

      .ux-lightbox__nav svg {
        width: 20px;
        height: 20px;
      }

      .ux-lightbox__btn {
        width: 40px;
        height: 40px;
      }

      .ux-lightbox__btn svg {
        width: 20px;
        height: 20px;
      }

      .ux-lightbox__thumbnail {
        width: 40px;
        height: 40px;
      }

      .ux-lightbox__zoom-controls {
        bottom: 100px;
      }
    }

    /* ========================================
       Trigger Element
    ======================================== */

    .ux-lightbox-trigger {
      cursor: pointer;
    }

    .ux-lightbox-trigger:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-lightbox {
        transition: none;
      }

      .ux-lightbox__spinner {
        animation: none;
      }

      .ux-lightbox__image-wrapper {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-lightbox-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-lightbox-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const lightboxData = (options = {}) => ({
    isOpen: false,
    images: options.images || [],
    currentIndex: 0,
    loading: true,
    zoom: 1,
    minZoom: 1,
    maxZoom: 4,
    hideUI: false,
    showThumbnails: options.showThumbnails ?? true,
    enableZoom: options.enableZoom ?? true,
    enableKeyboard: options.enableKeyboard ?? true,
    enableSwipe: options.enableSwipe ?? true,
    closeOnBackdrop: options.closeOnBackdrop ?? true,

    // Pan state
    panX: 0,
    panY: 0,
    isPanning: false,
    startX: 0,
    startY: 0,

    get currentImage() {
      return this.images[this.currentIndex] || {};
    },

    get hasPrev() {
      return this.currentIndex > 0;
    },

    get hasNext() {
      return this.currentIndex < this.images.length - 1;
    },

    get zoomPercent() {
      return Math.round(this.zoom * 100);
    },

    init() {
      // Keyboard navigation
      if (this.enableKeyboard) {
        this._keyHandler = (e) => {
          if (!this.isOpen) return;

          switch (e.key) {
            case 'Escape':
              this.close();
              break;
            case 'ArrowLeft':
              this.prev();
              break;
            case 'ArrowRight':
              this.next();
              break;
            case '+':
            case '=':
              this.zoomIn();
              break;
            case '-':
              this.zoomOut();
              break;
            case '0':
              this.resetZoom();
              break;
          }
        };
        document.addEventListener('keydown', this._keyHandler);
      }

      // Collect images from gallery if not provided
      if (this.images.length === 0) {
        this.$nextTick(() => {
          const gallery = this.$el.closest('[data-lightbox-gallery]');
          if (gallery) {
            const triggers = gallery.querySelectorAll('[data-lightbox-src]');
            this.images = Array.from(triggers).map(el => ({
              src: el.dataset.lightboxSrc || el.src || el.href,
              thumbnail: el.dataset.lightboxThumb || el.src,
              title: el.dataset.lightboxTitle || el.alt || '',
              description: el.dataset.lightboxDesc || ''
            }));
          }
        });
      }
    },

    destroy() {
      if (this._keyHandler) {
        document.removeEventListener('keydown', this._keyHandler);
      }
    },

    open(index = 0) {
      this.currentIndex = index;
      this.isOpen = true;
      this.loading = true;
      this.resetZoom();

      if (window.UX) {
        window.UX.lockScroll();
      }

      this.$dispatch('lightbox:open', { index, image: this.currentImage });

      // Preload current image
      this.preloadImage(this.currentImage.src);
    },

    close() {
      this.isOpen = false;
      this.resetZoom();

      if (window.UX) {
        window.UX.unlockScroll();
      }

      this.$dispatch('lightbox:close');
    },

    prev() {
      if (this.hasPrev) {
        this.goTo(this.currentIndex - 1);
      }
    },

    next() {
      if (this.hasNext) {
        this.goTo(this.currentIndex + 1);
      }
    },

    goTo(index) {
      if (index < 0 || index >= this.images.length) return;

      this.currentIndex = index;
      this.loading = true;
      this.resetZoom();

      this.$dispatch('lightbox:change', { index, image: this.currentImage });

      this.preloadImage(this.currentImage.src);
    },

    preloadImage(src) {
      const img = new Image();
      img.onload = () => {
        this.loading = false;
      };
      img.onerror = () => {
        this.loading = false;
      };
      img.src = src;
    },

    zoomIn() {
      if (!this.enableZoom) return;
      this.zoom = Math.min(this.zoom + 0.5, this.maxZoom);
    },

    zoomOut() {
      if (!this.enableZoom) return;
      this.zoom = Math.max(this.zoom - 0.5, this.minZoom);
      if (this.zoom === this.minZoom) {
        this.panX = 0;
        this.panY = 0;
      }
    },

    resetZoom() {
      this.zoom = this.minZoom;
      this.panX = 0;
      this.panY = 0;
    },

    toggleZoom() {
      if (this.zoom > this.minZoom) {
        this.resetZoom();
      } else {
        this.zoom = 2;
      }
    },

    toggleUI() {
      this.hideUI = !this.hideUI;
    },

    handleBackdropClick(e) {
      if (this.closeOnBackdrop && e.target === e.currentTarget) {
        this.close();
      }
    },

    // Pan handlers for zoomed images
    startPan(e) {
      if (this.zoom <= this.minZoom) return;
      this.isPanning = true;
      this.startX = (e.clientX || e.touches?.[0]?.clientX) - this.panX;
      this.startY = (e.clientY || e.touches?.[0]?.clientY) - this.panY;
    },

    pan(e) {
      if (!this.isPanning) return;
      e.preventDefault();
      this.panX = (e.clientX || e.touches?.[0]?.clientX) - this.startX;
      this.panY = (e.clientY || e.touches?.[0]?.clientY) - this.startY;
    },

    endPan() {
      this.isPanning = false;
    },

    // Touch swipe for navigation
    handleSwipe(direction) {
      if (this.zoom > this.minZoom) return;

      if (direction === 'left') {
        this.next();
      } else if (direction === 'right') {
        this.prev();
      }
    },

    // Double tap to zoom
    handleDoubleTap() {
      this.toggleZoom();
    }
  });

  // Global lightbox API
  window.UXLightbox = {
    _instance: null,

    open(images, index = 0) {
      // Create temporary lightbox if none exists
      if (!this._instance) {
        const container = document.createElement('div');
        container.innerHTML = `
          <div x-data="uxLightbox({ images: [], showThumbnails: true })" x-ref="lightbox">
            <div class="ux-lightbox" :class="{ 'ux-lightbox--open': isOpen, 'ux-lightbox--hide-ui': hideUI, 'ux-lightbox--zoomed': zoom > 1 }">
              <div class="ux-lightbox__backdrop" @click="handleBackdropClick($event)"></div>
              <div class="ux-lightbox__container">
                <header class="ux-lightbox__header">
                  <div>
                    <span class="ux-lightbox__counter" x-text="(currentIndex + 1) + ' / ' + images.length"></span>
                  </div>
                  <div class="ux-lightbox__actions">
                    <button class="ux-lightbox__btn" @click="close()" aria-label="Close">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                      </svg>
                    </button>
                  </div>
                </header>
                <div class="ux-lightbox__image-container" @click="toggleUI()" @dblclick="handleDoubleTap()"
                     @mousedown="startPan($event)" @mousemove="pan($event)" @mouseup="endPan()" @mouseleave="endPan()"
                     @touchstart="startPan($event)" @touchmove="pan($event)" @touchend="endPan()">
                  <div class="ux-lightbox__loading" x-show="loading">
                    <div class="ux-lightbox__spinner"></div>
                  </div>
                  <div class="ux-lightbox__image-wrapper" :style="{ transform: 'scale(' + zoom + ') translate(' + panX/zoom + 'px, ' + panY/zoom + 'px)' }">
                    <img class="ux-lightbox__image" :src="currentImage.src" :alt="currentImage.title" x-show="!loading">
                  </div>
                </div>
                <button class="ux-lightbox__nav ux-lightbox__nav--prev" @click.stop="prev()" :disabled="!hasPrev" x-show="images.length > 1">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15,18 9,12 15,6"></polyline></svg>
                </button>
                <button class="ux-lightbox__nav ux-lightbox__nav--next" @click.stop="next()" :disabled="!hasNext" x-show="images.length > 1">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"></polyline></svg>
                </button>
                <div class="ux-lightbox__zoom-controls" x-show="enableZoom">
                  <button class="ux-lightbox__btn" @click.stop="zoomIn()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.35-4.35M11 8v6M8 11h6"></path></svg>
                  </button>
                  <span class="ux-lightbox__zoom-level" x-text="zoomPercent + '%'"></span>
                  <button class="ux-lightbox__btn" @click.stop="zoomOut()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.35-4.35M8 11h6"></path></svg>
                  </button>
                </div>
                <footer class="ux-lightbox__footer" x-show="showThumbnails && images.length > 1">
                  <div class="ux-lightbox__thumbnails">
                    <template x-for="(img, idx) in images" :key="idx">
                      <button class="ux-lightbox__thumbnail" :class="{ 'ux-lightbox__thumbnail--active': idx === currentIndex }" @click.stop="goTo(idx)">
                        <img :src="img.thumbnail || img.src" :alt="img.title">
                      </button>
                    </template>
                  </div>
                  <div class="ux-lightbox__caption" x-show="currentImage.title || currentImage.description">
                    <div class="ux-lightbox__caption-title" x-text="currentImage.title" x-show="currentImage.title"></div>
                    <div class="ux-lightbox__caption-description" x-text="currentImage.description" x-show="currentImage.description"></div>
                  </div>
                </footer>
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(container.firstElementChild);
      }

      // Open with provided images
      this.$nextTick(() => {
        const lightbox = document.querySelector('[x-ref="lightbox"]');
        if (lightbox && lightbox.__x) {
          lightbox.__x.$data.images = Array.isArray(images) ? images : [{ src: images }];
          lightbox.__x.$data.open(index);
        }
      });
    }
  };

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxLightbox', lightboxData);
  }

})();

/**
 * UX List Component
 * Listas estilo iOS/Ionic
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX List
    ======================================== */

    .ux-list {
      display: flex;
      flex-direction: column;
      width: 100%;
      margin: 0;
      padding: 0;
      list-style: none;
      background-color: var(--ux-surface);
    }

    /* ========================================
       List Variants
    ======================================== */

    /* Inset (iOS grouped style) */
    .ux-list--inset {
      margin: var(--ux-space-lg);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
    }

    /* Lines */
    .ux-list--lines-full .ux-item {
      --item-border-start: 0;
    }

    .ux-list--lines-inset .ux-item {
      --item-border-start: var(--ux-space-lg);
    }

    .ux-list--lines-none .ux-item {
      border-bottom: none;
    }

    /* ========================================
       List Header
    ======================================== */

    .ux-list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-lg) var(--ux-space-lg) var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background-color: var(--ux-background);
    }

    .ux-list-header__action {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-primary);
      text-transform: none;
      letter-spacing: 0;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
    }

    .ux-list-header__action:hover {
      color: var(--ux-primary-shade);
    }

    /* Sticky Header */
    .ux-list-header--sticky {
      position: sticky;
      top: 0;
      z-index: 10;
    }

    /* ========================================
       List Note (footer)
    ======================================== */

    .ux-list-note {
      padding: var(--ux-space-sm) var(--ux-space-lg) var(--ux-space-lg);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
      line-height: 1.4;
      background-color: var(--ux-background);
    }

    /* ========================================
       UX Item
    ======================================== */

    .ux-item {
      --item-border-start: var(--ux-space-lg);

      position: relative;
      display: flex;
      align-items: center;
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface);
      color: var(--ux-text);
      text-decoration: none;
      border-bottom: 1px solid var(--ux-border-color);
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-item::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: var(--item-border-start);
      right: 0;
      height: 1px;
      background-color: var(--ux-border-color);
    }

    .ux-item:last-child::after {
      display: none;
    }

    .ux-item:last-child {
      border-bottom: none;
    }

    /* Clickable Item */
    .ux-item--clickable {
      cursor: pointer;
    }

    .ux-item--clickable:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-item--clickable:active {
      background-color: var(--ux-light);
    }

    /* ========================================
       Item Start/End Slots
    ======================================== */

    .ux-item__start {
      display: flex;
      align-items: center;
      margin-right: var(--ux-space-md);
      flex-shrink: 0;
    }

    .ux-item__end {
      display: flex;
      align-items: center;
      margin-left: auto;
      padding-left: var(--ux-space-md);
      flex-shrink: 0;
    }

    /* ========================================
       Item Content
    ======================================== */

    .ux-item__content {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .ux-item__label {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      line-height: 1.4;
    }

    .ux-item__label--stacked {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-item__note {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: 2px;
      line-height: 1.4;
    }

    .ux-item__value {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text-secondary);
    }

    /* ========================================
       Item Icon
    ======================================== */

    .ux-item__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      color: var(--ux-text-secondary);
    }

    .ux-item__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-item__icon--colored {
      color: var(--ux-primary);
    }

    /* Chevron (disclosure indicator) */
    .ux-item__chevron {
      width: 16px;
      height: 16px;
      color: var(--ux-text-tertiary);
    }

    .ux-item__chevron svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Item Avatar
    ======================================== */

    .ux-item__avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
    }

    .ux-item__avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .ux-item__avatar--sm {
      width: 32px;
      height: 32px;
    }

    .ux-item__avatar--lg {
      width: 56px;
      height: 56px;
    }

    /* ========================================
       Item Thumbnail
    ======================================== */

    .ux-item__thumbnail {
      width: 56px;
      height: 56px;
      border-radius: var(--ux-border-radius-sm);
      overflow: hidden;
      flex-shrink: 0;
    }

    .ux-item__thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ========================================
       Item Variants
    ======================================== */

    /* Detail Item */
    .ux-item--detail {
      padding-right: var(--ux-space-md);
    }

    .ux-item--detail::before {
      content: '';
      position: absolute;
      right: var(--ux-space-lg);
      top: 50%;
      transform: translateY(-50%);
      width: 8px;
      height: 8px;
      border-right: 2px solid var(--ux-text-tertiary);
      border-bottom: 2px solid var(--ux-text-tertiary);
      transform: translateY(-50%) rotate(-45deg);
    }

    /* Multiline Item */
    .ux-item--multiline {
      align-items: flex-start;
      padding-top: var(--ux-space-md);
      padding-bottom: var(--ux-space-md);
    }

    .ux-item--multiline .ux-item__start {
      margin-top: 2px;
    }

    /* Disabled Item */
    .ux-item--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* Selected Item */
    .ux-item--selected {
      background-color: rgba(var(--ux-primary-rgb), 0.08);
    }

    .ux-item--selected::after {
      background-color: var(--ux-primary);
    }

    /* Active Item (iOS native style navigation) */
    .ux-item--active {
      background-color: rgba(var(--ux-primary-rgb), 0.12);
      color: var(--ux-primary);
    }

    .ux-item--active .ux-item__label {
      color: var(--ux-primary);
      font-weight: var(--ux-font-weight-semibold, 600);
    }

    .ux-item--active .ux-item__icon {
      color: var(--ux-primary);
    }

    .ux-item--active .ux-item__note {
      color: rgba(var(--ux-primary-rgb), 0.7);
    }

    .ux-item--active::after {
      background-color: rgba(var(--ux-primary-rgb), 0.2);
    }

    /* Active item with left accent bar (iOS Settings style) */
    .ux-item--active::before {
      content: '';
      position: absolute;
      left: 0;
      top: var(--ux-space-sm);
      bottom: var(--ux-space-sm);
      width: 3px;
      background-color: var(--ux-primary);
      border-radius: 0 2px 2px 0;
    }

    /* Hover only on devices that support it */
    @media (hover: hover) and (pointer: fine) {
      .ux-item--active:hover {
        background-color: rgba(var(--ux-primary-rgb), 0.16);
      }
    }

    /* Active item pressed state */
    .ux-item--active:active {
      background-color: rgba(var(--ux-primary-rgb), 0.2);
    }

    /* Active item in dark mode */
    .ux-dark .ux-item--active,
    @media (prefers-color-scheme: dark) {
      .ux-item--active {
        background-color: rgba(var(--ux-primary-rgb), 0.18);
      }

      .ux-item--active:hover {
        background-color: rgba(var(--ux-primary-rgb), 0.24);
      }
    }

    /* ========================================
       Item Colors
    ======================================== */

    .ux-item--primary {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-item--success {
      background-color: rgba(var(--ux-success-rgb), 0.1);
    }

    .ux-item--warning {
      background-color: rgba(var(--ux-warning-rgb), 0.1);
    }

    .ux-item--danger {
      background-color: rgba(var(--ux-danger-rgb), 0.1);
    }

    /* ========================================
       Item Sizes
    ======================================== */

    .ux-item--sm {
      min-height: 40px;
      padding: var(--ux-space-sm) var(--ux-space-lg);
    }

    .ux-item--sm .ux-item__label {
      font-size: var(--ux-font-size-sm);
    }

    .ux-item--lg {
      min-height: 60px;
      padding: var(--ux-space-lg);
    }

    .ux-item--lg .ux-item__label {
      font-size: var(--ux-font-size-lg);
    }

    /* ========================================
       Swipeable Item
    ======================================== */

    .ux-item-sliding {
      position: relative;
      overflow: hidden;
    }

    .ux-item-sliding__content {
      position: relative;
      z-index: 1;
      background-color: var(--ux-surface);
      transition: transform var(--ux-transition-base) var(--ux-ease);
    }

    .ux-item-sliding__options {
      position: absolute;
      top: 0;
      bottom: 0;
      display: flex;
      align-items: stretch;
    }

    .ux-item-sliding__options--start {
      left: 0;
    }

    .ux-item-sliding__options--end {
      right: 0;
    }

    .ux-item-sliding__option {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 72px;
      padding: 0 var(--ux-space-lg);
      color: white;
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      border: none;
      cursor: pointer;
    }

    .ux-item-sliding__option--primary {
      background-color: var(--ux-primary);
    }

    .ux-item-sliding__option--secondary {
      background-color: var(--ux-secondary);
    }

    .ux-item-sliding__option--success {
      background-color: var(--ux-success);
    }

    .ux-item-sliding__option--warning {
      background-color: var(--ux-warning);
    }

    .ux-item-sliding__option--danger {
      background-color: var(--ux-danger);
    }

    .ux-item-sliding__option-icon {
      width: 24px;
      height: 24px;
    }

    .ux-item-sliding__option-icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Item Divider
    ======================================== */

    .ux-item-divider {
      display: flex;
      align-items: center;
      padding: var(--ux-space-sm) var(--ux-space-lg);
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text-secondary);
      background-color: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-item-divider--sticky {
      position: sticky;
      top: 0;
      z-index: 10;
    }

    /* ========================================
       Virtual List Container
    ======================================== */

    .ux-virtual-list {
      position: relative;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .ux-virtual-list__spacer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      pointer-events: none;
    }

    .ux-virtual-list__content {
      position: relative;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-list--glass {
      border: 0.5px solid var(--ux-glass-border);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
    }

    .ux-list--glass .ux-list__item {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-list--glass .ux-list__item:hover {
      background: var(--ux-glass-bg-thin);
    }

    .ux-list--glass .ux-list__header {
      background: var(--ux-glass-bg-thin);
      border-bottom-color: var(--ux-glass-border);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-list-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-list-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for item sliding (swipe actions)
  const itemSlidingComponent = (config = {}) => ({
    isOpen: false,
    side: null, // 'start' or 'end'
    offset: 0,
    startX: 0,
    threshold: config.threshold || 50,

    close() {
      this.isOpen = false;
      this.offset = 0;
      this.side = null;
    },

    open(side = 'end') {
      this.side = side;
      this.isOpen = true;
    },

    handleTouchStart(event) {
      this.startX = event.touches[0].clientX;
    },

    handleTouchMove(event) {
      const currentX = event.touches[0].clientX;
      const diff = currentX - this.startX;

      if (Math.abs(diff) > 10) {
        this.offset = diff;
        this.side = diff > 0 ? 'start' : 'end';
      }
    },

    handleTouchEnd() {
      if (Math.abs(this.offset) > this.threshold) {
        this.isOpen = true;
        this.offset = this.side === 'end' ? -72 : 72;
      } else {
        this.close();
      }
    },

    getStyle() {
      return {
        transform: `translateX(${this.offset}px)`
      };
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxItemSliding', itemSlidingComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxItemSliding', itemSlidingComponent);
    });
  }

  // Alpine component for selectable list
  const selectableListComponent = (config = {}) => ({
    selected: config.selected || [],
    multiple: config.multiple || false,
    items: config.items || [],

    isSelected(item) {
      if (this.multiple) {
        return this.selected.includes(item);
      }
      return this.selected === item;
    },

    toggle(item) {
      if (this.multiple) {
        const index = this.selected.indexOf(item);
        if (index === -1) {
          this.selected.push(item);
        } else {
          this.selected.splice(index, 1);
        }
      } else {
        this.selected = this.selected === item ? null : item;
      }
    },

    selectAll() {
      if (this.multiple) {
        this.selected = [...this.items];
      }
    },

    clearSelection() {
      this.selected = this.multiple ? [] : null;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSelectableList', selectableListComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSelectableList', selectableListComponent);
    });
  }
})();

/**
 * UX Load More Component
 * Button to load additional content with loading states
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Load More
    ======================================== */

    :root {
      --ux-load-more-height: 44px;
      --ux-load-more-padding: var(--ux-space-md) var(--ux-space-xl);
      --ux-load-more-font-size: var(--ux-font-size-md);
      --ux-load-more-border-radius: var(--ux-radius-full);
      --ux-load-more-gap: var(--ux-space-lg);
    }

    .ux-load-more {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-load-more-gap) 0;
      font-family: var(--ux-font-family);
    }

    /* ========================================
       Load More Button
    ======================================== */

    .ux-load-more__button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
      height: var(--ux-load-more-height);
      padding: var(--ux-load-more-padding);
      font-size: var(--ux-load-more-font-size);
      font-weight: 500;
      color: var(--ux-primary);
      background: transparent;
      border: 1px solid var(--ux-primary);
      border-radius: var(--ux-load-more-border-radius);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
      outline: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-load-more__button:hover {
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-load-more__button:active {
      transform: scale(0.98);
    }

    .ux-load-more__button:focus-visible {
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.3);
    }

    .ux-load-more__button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ========================================
       Icon
    ======================================== */

    .ux-load-more__icon {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-load-more--loading .ux-load-more__button {
      pointer-events: none;
    }

    .ux-load-more__spinner {
      width: 18px;
      height: 18px;
      border: 2px solid currentColor;
      border-top-color: transparent;
      border-radius: 50%;
      animation: ux-load-more-spin 0.8s linear infinite;
    }

    @keyframes ux-load-more-spin {
      to { transform: rotate(360deg); }
    }

    /* ========================================
       Status Text
    ======================================== */

    .ux-load-more__status {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Progress Indicator
    ======================================== */

    .ux-load-more__progress {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-load-more__progress-bar {
      width: 100px;
      height: 4px;
      background: var(--ux-gray-200);
      border-radius: 2px;
      overflow: hidden;
    }

    .ux-load-more__progress-fill {
      height: 100%;
      background: var(--ux-primary);
      border-radius: 2px;
      transition: width var(--ux-transition-normal);
    }

    .ux-load-more__progress-text {
      min-width: 60px;
    }

    /* ========================================
       Variants
    ======================================== */

    /* Filled variant */
    .ux-load-more--filled .ux-load-more__button {
      background: var(--ux-primary);
      color: white;
      border-color: var(--ux-primary);
    }

    .ux-load-more--filled .ux-load-more__button:hover {
      background: var(--ux-primary-shade);
      border-color: var(--ux-primary-shade);
    }

    /* Ghost variant */
    .ux-load-more--ghost .ux-load-more__button {
      border: none;
      color: var(--ux-primary);
    }

    .ux-load-more--ghost .ux-load-more__button:hover {
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    /* Soft variant */
    .ux-load-more--soft .ux-load-more__button {
      background: rgba(var(--ux-primary-rgb), 0.1);
      color: var(--ux-primary);
      border: none;
    }

    .ux-load-more--soft .ux-load-more__button:hover {
      background: rgba(var(--ux-primary-rgb), 0.2);
    }

    /* Link style */
    .ux-load-more--link .ux-load-more__button {
      height: auto;
      padding: var(--ux-space-sm);
      border: none;
      background: transparent;
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    .ux-load-more--link .ux-load-more__button:hover {
      background: transparent;
      opacity: 0.8;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-load-more--sm {
      --ux-load-more-height: 36px;
      --ux-load-more-padding: var(--ux-space-sm) var(--ux-space-lg);
      --ux-load-more-font-size: var(--ux-font-size-sm);
    }

    .ux-load-more--sm .ux-load-more__icon,
    .ux-load-more--sm .ux-load-more__spinner {
      width: 14px;
      height: 14px;
    }

    .ux-load-more--lg {
      --ux-load-more-height: 52px;
      --ux-load-more-padding: var(--ux-space-md) var(--ux-space-2xl);
      --ux-load-more-font-size: var(--ux-font-size-lg);
    }

    .ux-load-more--lg .ux-load-more__icon,
    .ux-load-more--lg .ux-load-more__spinner {
      width: 22px;
      height: 22px;
    }

    /* ========================================
       Full Width
    ======================================== */

    .ux-load-more--full {
      width: 100%;
    }

    .ux-load-more--full .ux-load-more__button {
      width: 100%;
    }

    /* ========================================
       End of List State
    ======================================== */

    .ux-load-more--end {
      pointer-events: none;
    }

    .ux-load-more--end .ux-load-more__button {
      display: none;
    }

    .ux-load-more__end-message {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
    }

    .ux-load-more__end-icon {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Divider Style
    ======================================== */

    .ux-load-more--divider {
      width: 100%;
    }

    .ux-load-more--divider .ux-load-more__button {
      position: relative;
      width: 100%;
      background: transparent;
      border: none;
      border-radius: 0;
    }

    .ux-load-more--divider .ux-load-more__button::before,
    .ux-load-more--divider .ux-load-more__button::after {
      content: '';
      position: absolute;
      top: 50%;
      width: calc(50% - 80px);
      height: 1px;
      background: var(--ux-border-color);
    }

    .ux-load-more--divider .ux-load-more__button::before {
      left: 0;
    }

    .ux-load-more--divider .ux-load-more__button::after {
      right: 0;
    }

    .ux-load-more--divider .ux-load-more__button:hover {
      background: transparent;
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-load-more--glass .ux-load-more__button {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
      color: var(--ux-text);
    }

    .ux-load-more--glass .ux-load-more__button:hover {
      background: var(--ux-glass-bg-thick);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-load-more__progress-bar {
        background: var(--ux-gray-700);
      }
    }

    .ux-dark .ux-load-more__progress-bar {
      background: var(--ux-gray-700);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-load-more__spinner {
        animation: none;
      }

      .ux-load-more__button {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-load-more-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-load-more-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const loadMoreData = (options = {}) => ({
    loading: false,
    hasMore: options.hasMore ?? true,
    currentPage: options.page ?? 1,
    totalPages: options.totalPages ?? null,
    totalItems: options.totalItems ?? null,
    loadedItems: options.loadedItems ?? 0,
    pageSize: options.pageSize ?? 10,
    autoLoadThreshold: options.autoLoadThreshold ?? null,

    get progress() {
      if (this.totalItems && this.loadedItems) {
        return Math.round((this.loadedItems / this.totalItems) * 100);
      }
      if (this.totalPages && this.currentPage) {
        return Math.round((this.currentPage / this.totalPages) * 100);
      }
      return 0;
    },

    get statusText() {
      if (this.totalItems && this.loadedItems) {
        return `${this.loadedItems} of ${this.totalItems}`;
      }
      if (this.totalPages && this.currentPage) {
        return `Page ${this.currentPage} of ${this.totalPages}`;
      }
      return '';
    },

    init() {
      // Auto-load support with intersection observer
      if (this.autoLoadThreshold) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting && this.hasMore && !this.loading) {
              this.load();
            }
          });
        }, {
          rootMargin: `${this.autoLoadThreshold}px`
        });

        observer.observe(this.$el);
        this._observer = observer;
      }
    },

    destroy() {
      if (this._observer) {
        this._observer.disconnect();
      }
    },

    async load() {
      if (this.loading || !this.hasMore) return;

      this.loading = true;
      this.$dispatch('loadmore:start', { page: this.currentPage });

      try {
        // Wait for external handler to complete
        await this.$nextTick();

        // The parent should update hasMore, currentPage, etc.
        this.currentPage++;

        this.$dispatch('loadmore:success', { page: this.currentPage });
      } catch (error) {
        this.$dispatch('loadmore:error', { error });
      } finally {
        this.loading = false;
        this.$dispatch('loadmore:complete', { page: this.currentPage, hasMore: this.hasMore });
      }
    },

    setHasMore(value) {
      this.hasMore = value;
    },

    setLoading(value) {
      this.loading = value;
    },

    updateProgress(loaded, total) {
      this.loadedItems = loaded;
      this.totalItems = total;
      this.hasMore = loaded < total;
    },

    reset() {
      this.currentPage = 1;
      this.loadedItems = 0;
      this.hasMore = true;
      this.loading = false;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxLoadMore', loadMoreData);
  }

})();

/**
 * UX Loading Component
 * Loading indicator with backdrop (iOS style)
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Loading Backdrop
    ======================================== */

    .ux-loading-backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.3);
      z-index: var(--ux-z-toast);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity 200ms cubic-bezier(0.32, 0.72, 0, 1),
        visibility 200ms cubic-bezier(0.32, 0.72, 0, 1);
    }

    .ux-loading-backdrop--open {
      opacity: 1;
      visibility: visible;
    }

    .ux-loading-backdrop--transparent {
      background-color: transparent;
    }

    /* ========================================
       UX Loading Container
    ======================================== */

    .ux-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-md);
      min-width: 100px;
      min-height: 100px;
      padding: var(--ux-space-lg);
      background-color: rgba(var(--ux-surface-rgb, 255, 255, 255), 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--ux-border-radius-lg);
      box-shadow: var(--ux-shadow-lg);
      transform: scale(0.9);
      opacity: 0;
      transition:
        transform 300ms cubic-bezier(0.32, 0.72, 0, 1),
        opacity 200ms cubic-bezier(0.32, 0.72, 0, 1);
    }

    .ux-loading-backdrop--open .ux-loading {
      transform: scale(1);
      opacity: 1;
    }

    /* ========================================
       Loading Spinner
    ======================================== */

    .ux-loading__spinner {
      width: 36px;
      height: 36px;
      border: 3px solid var(--ux-border-color);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-loading-spin 0.8s linear infinite;
    }

    @keyframes ux-loading-spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* iOS-style spinner (dots) */
    .ux-loading__spinner--ios {
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      position: relative;
      animation: none;
    }

    .ux-loading__spinner--ios::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'%3E%3Cg fill='none' stroke='%23999' stroke-width='3' stroke-linecap='round'%3E%3Cline x1='20' y1='4' x2='20' y2='10' opacity='0.125'/%3E%3Cline x1='32.5' y1='7.5' x2='28.5' y2='11.5' opacity='0.25'/%3E%3Cline x1='36' y1='20' x2='30' y2='20' opacity='0.375'/%3E%3Cline x1='32.5' y1='32.5' x2='28.5' y2='28.5' opacity='0.5'/%3E%3Cline x1='20' y1='36' x2='20' y2='30' opacity='0.625'/%3E%3Cline x1='7.5' y1='32.5' x2='11.5' y2='28.5' opacity='0.75'/%3E%3Cline x1='4' y1='20' x2='10' y2='20' opacity='0.875'/%3E%3Cline x1='7.5' y1='7.5' x2='11.5' y2='11.5' opacity='1'/%3E%3C/g%3E%3C/svg%3E");
      animation: ux-loading-ios-spin 0.8s steps(8) infinite;
    }

    @keyframes ux-loading-ios-spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Dots spinner */
    .ux-loading__spinner--dots {
      width: 60px;
      height: 20px;
      border: none;
      display: flex;
      justify-content: center;
      gap: 8px;
      animation: none;
    }

    .ux-loading__spinner--dots::before,
    .ux-loading__spinner--dots::after,
    .ux-loading__dot {
      content: '';
      width: 12px;
      height: 12px;
      background-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-loading-bounce 1.4s ease-in-out infinite both;
    }

    .ux-loading__spinner--dots::before {
      animation-delay: -0.32s;
    }

    .ux-loading__dot {
      animation-delay: -0.16s;
    }

    @keyframes ux-loading-bounce {
      0%, 80%, 100% {
        transform: scale(0.6);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* ========================================
       Loading Message
    ======================================== */

    .ux-loading__message {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      text-align: center;
      max-width: 200px;
    }

    /* ========================================
       Loading Sizes
    ======================================== */

    .ux-loading--sm {
      min-width: 80px;
      min-height: 80px;
      padding: var(--ux-space-md);
    }

    .ux-loading--sm .ux-loading__spinner {
      width: 28px;
      height: 28px;
      border-width: 2px;
    }

    .ux-loading--sm .ux-loading__message {
      font-size: var(--ux-font-size-xs);
    }

    .ux-loading--lg {
      min-width: 140px;
      min-height: 140px;
      padding: var(--ux-space-xl);
    }

    .ux-loading--lg .ux-loading__spinner {
      width: 48px;
      height: 48px;
      border-width: 4px;
    }

    .ux-loading--lg .ux-loading__message {
      font-size: var(--ux-font-size-md);
    }

    /* ========================================
       Loading Colors
    ======================================== */

    .ux-loading--dark {
      background-color: rgba(0, 0, 0, 0.85);
    }

    .ux-loading--dark .ux-loading__spinner {
      border-color: rgba(255, 255, 255, 0.2);
      border-top-color: white;
    }

    .ux-loading--dark .ux-loading__message {
      color: rgba(255, 255, 255, 0.8);
    }

    /* ========================================
       Inline Loading
    ======================================== */

    .ux-loading-inline {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-loading-inline__spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--ux-border-color);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-loading-spin 0.8s linear infinite;
    }

    .ux-loading-inline__text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* Sizes */
    .ux-loading-inline--sm .ux-loading-inline__spinner {
      width: 14px;
      height: 14px;
    }

    .ux-loading-inline--sm .ux-loading-inline__text {
      font-size: var(--ux-font-size-xs);
    }

    .ux-loading-inline--lg .ux-loading-inline__spinner {
      width: 28px;
      height: 28px;
      border-width: 3px;
    }

    /* ========================================
       Full Page Loading
    ======================================== */

    .ux-loading--fullpage {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--ux-background);
      z-index: 9999;
    }

    .ux-loading--fullpage .ux-loading {
      background-color: transparent;
      box-shadow: none;
    }

    /* ========================================
       Loading Overlay (for containers)
    ======================================== */

    .ux-loading-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(var(--ux-background-rgb, 255, 255, 255), 0.8);
      z-index: 10;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        visibility var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-loading-overlay--visible {
      opacity: 1;
      visibility: visible;
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-loading-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-loading-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for loading
  // ARIA: role="alert", aria-busy for loading state
  const loadingComponent = (config = {}) => ({
    isOpen: config.isOpen || false,
    message: config.message || '',
    spinner: config.spinner || 'default', // default, ios, dots
    showBackdrop: config.showBackdrop !== false,
    dismissOnBackdrop: config.dismissOnBackdrop || false,
    loadingId: config.id || 'ux-loading-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes
    get ariaAttrs() {
      return {
        'role': 'alert',
        'aria-live': 'assertive',
        'aria-busy': this.isOpen ? 'true' : 'false',
        'aria-label': this.message || 'Loading'
      };
    },

    show(options = {}) {
      if (options.message !== undefined) this.message = options.message;
      if (options.spinner) this.spinner = options.spinner;

      this.isOpen = true;
      document.body.style.overflow = 'hidden';
    },

    hide() {
      this.isOpen = false;
      document.body.style.overflow = '';
    },

    // Alias methods
    present(options) {
      this.show(options);
    },

    dismiss() {
      this.hide();
    },

    handleBackdropClick(event) {
      if (this.dismissOnBackdrop && event.target === event.currentTarget) {
        this.hide();
      }
    },

    // Show loading with timeout
    showWithTimeout(options = {}, timeout = 30000) {
      this.show(options);

      return new Promise((resolve) => {
        setTimeout(() => {
          this.hide();
          resolve();
        }, timeout);
      });
    },

    // Show loading during async operation
    async during(asyncFn, options = {}) {
      this.show(options);
      try {
        const result = await asyncFn();
        return result;
      } finally {
        this.hide();
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxLoading', loadingComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxLoading', loadingComponent);
    });
  }

  // Global loading controller (singleton)
  const loadingController = {
    _instance: null,
    _queue: [],

    async create(options = {}) {
      return {
        present: () => this.show(options),
        dismiss: () => this.hide()
      };
    },

    show(options = {}) {
      // Create loading element if it doesn't exist
      if (!this._instance) {
        const container = document.createElement('div');
        container.id = 'ux-loading-controller';
        container.innerHTML = `
          <div class="ux-loading-backdrop"
               :class="{ 'ux-loading-backdrop--open': isOpen }"
               @click="handleBackdropClick($event)"
               x-data="uxLoading()">
            <div class="ux-loading" :class="'ux-loading--' + (size || '')" role="alert" aria-live="assertive">
              <div class="ux-loading__spinner" :class="'ux-loading__spinner--' + spinner"></div>
              <div class="ux-loading__message" x-show="message" x-text="message"></div>
            </div>
          </div>
        `;
        document.body.appendChild(container);
      }

      // Show via Alpine
      const el = document.querySelector('#ux-loading-controller [x-data]');
      if (el && el._x_dataStack) {
        const data = el._x_dataStack[0];
        data.show(options);
      }
    },

    hide() {
      const el = document.querySelector('#ux-loading-controller [x-data]');
      if (el && el._x_dataStack) {
        const data = el._x_dataStack[0];
        data.hide();
      }
    }
  };

  // Export to UX namespace
  if (window.UX) {
    window.UX.loading = loadingController;
  }
})();

/**
 * UX Machine Status Component
 * Industrial machine/equipment status cards with real-time metrics
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       UX Machine Status - Industrial Equipment Monitoring
       CSS-only component with iOS-style design
       ========================================================================== */

    :root {
      /* Machine Status Tokens */
      --ux-machine-status-padding: var(--ux-space-lg);
      --ux-machine-status-border-radius: var(--ux-border-radius-lg);
      --ux-machine-status-gap: var(--ux-space-md);
      --ux-machine-status-indicator-size: 12px;
      --ux-machine-status-icon-size: 48px;
    }

    /* ==========================================================================
       Machine Status Card
       ========================================================================== */

    .ux-machine-status {
      display: flex;
      flex-direction: column;
      gap: var(--ux-machine-status-gap);
      padding: var(--ux-machine-status-padding);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-machine-status-border-radius);
      transition: transform var(--ux-transition-fast) var(--ux-ease-ios),
                  box-shadow var(--ux-transition-fast) var(--ux-ease-ios);
    }

    .ux-machine-status:hover {
      transform: translateY(-2px);
      box-shadow: var(--ux-shadow-md);
    }

    /* Clickable card */
    a.ux-machine-status,
    button.ux-machine-status {
      cursor: pointer;
      text-decoration: none;
      text-align: left;
    }

    a.ux-machine-status:active,
    button.ux-machine-status:active {
      transform: scale(0.98);
    }

    /* ==========================================================================
       Header Section
       ========================================================================== */

    .ux-machine-status__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--ux-space-md);
    }

    .ux-machine-status__info {
      flex: 1;
      min-width: 0;
    }

    .ux-machine-status__name {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      line-height: 1.3;
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-machine-status__id {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
      font-weight: 400;
    }

    .ux-machine-status__location {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    .ux-machine-status__icon {
      width: var(--ux-machine-status-icon-size);
      height: var(--ux-machine-status-icon-size);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
      color: var(--ux-primary);
      flex-shrink: 0;
    }

    .ux-machine-status__icon svg {
      width: 24px;
      height: 24px;
    }

    .ux-machine-status__icon img {
      width: 24px;
      height: 24px;
      object-fit: contain;
    }

    /* ==========================================================================
       Status Indicator
       ========================================================================== */

    .ux-machine-status__indicator {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-radius: var(--ux-border-radius-pill);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      background: var(--ux-surface-secondary);
      color: var(--ux-text-secondary);
    }

    .ux-machine-status__indicator-dot {
      width: var(--ux-machine-status-indicator-size);
      height: var(--ux-machine-status-indicator-size);
      border-radius: 50%;
      background: var(--ux-gray-400);
      flex-shrink: 0;
      position: relative;
    }

    /* Running State */
    .ux-machine-status__indicator--running {
      background: rgba(var(--ux-success-rgb), 0.1);
      color: var(--ux-success);
    }

    .ux-machine-status__indicator--running .ux-machine-status__indicator-dot {
      background: var(--ux-success);
    }

    .ux-machine-status__indicator--running .ux-machine-status__indicator-dot::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: inherit;
      animation: ux-machine-pulse 2s ease-in-out infinite;
    }

    /* Idle State */
    .ux-machine-status__indicator--idle {
      background: rgba(var(--ux-primary-rgb), 0.1);
      color: var(--ux-primary);
    }

    .ux-machine-status__indicator--idle .ux-machine-status__indicator-dot {
      background: var(--ux-primary);
    }

    /* Maintenance State */
    .ux-machine-status__indicator--maintenance {
      background: rgba(var(--ux-warning-rgb), 0.1);
      color: var(--ux-warning-shade);
    }

    .ux-machine-status__indicator--maintenance .ux-machine-status__indicator-dot {
      background: var(--ux-warning);
    }

    .ux-machine-status__indicator--maintenance .ux-machine-status__indicator-dot::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: inherit;
      animation: ux-machine-blink 1s ease-in-out infinite;
    }

    /* Offline State */
    .ux-machine-status__indicator--offline {
      background: var(--ux-surface-secondary);
      color: var(--ux-text-tertiary);
    }

    .ux-machine-status__indicator--offline .ux-machine-status__indicator-dot {
      background: var(--ux-gray-400);
    }

    /* Error State */
    .ux-machine-status__indicator--error {
      background: rgba(var(--ux-danger-rgb), 0.1);
      color: var(--ux-danger);
    }

    .ux-machine-status__indicator--error .ux-machine-status__indicator-dot {
      background: var(--ux-danger);
    }

    .ux-machine-status__indicator--error .ux-machine-status__indicator-dot::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: inherit;
      animation: ux-machine-pulse-fast 1s ease-in-out infinite;
    }

    /* Pulse Animation */
    @keyframes ux-machine-pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(2);
        opacity: 0;
      }
      100% {
        transform: scale(1);
        opacity: 0;
      }
    }

    @keyframes ux-machine-pulse-fast {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.8);
        opacity: 0;
      }
      100% {
        transform: scale(1);
        opacity: 0;
      }
    }

    @keyframes ux-machine-blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* ==========================================================================
       Current Job / Work Order
       ========================================================================== */

    .ux-machine-status__job {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
    }

    .ux-machine-status__job-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .ux-machine-status__job-name {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-machine-status__job-details {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      flex-wrap: wrap;
    }

    .ux-machine-status__job-progress {
      margin-top: var(--ux-space-sm);
    }

    .ux-machine-status__job-progress-bar {
      height: 6px;
      background: var(--ux-surface);
      border-radius: var(--ux-border-radius-pill);
      overflow: hidden;
    }

    .ux-machine-status__job-progress-fill {
      height: 100%;
      background: var(--ux-primary);
      border-radius: var(--ux-border-radius-pill);
      transition: width var(--ux-transition-slow) var(--ux-ease-ios);
    }

    .ux-machine-status__job-progress-label {
      display: flex;
      justify-content: space-between;
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      margin-top: var(--ux-space-xs);
    }

    /* ==========================================================================
       Metrics Grid
       ========================================================================== */

    .ux-machine-status__metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: var(--ux-space-sm);
    }

    .ux-machine-status__metric {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: var(--ux-space-sm);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
    }

    .ux-machine-status__metric-value {
      font-size: var(--ux-font-size-lg);
      font-weight: 700;
      color: var(--ux-text);
      line-height: 1.2;
      font-variant-numeric: tabular-nums;
    }

    .ux-machine-status__metric-value--sm {
      font-size: var(--ux-font-size-md);
    }

    .ux-machine-status__metric-value--lg {
      font-size: var(--ux-font-size-xl);
    }

    .ux-machine-status__metric-unit {
      font-size: var(--ux-font-size-xs);
      font-weight: 400;
      color: var(--ux-text-secondary);
    }

    .ux-machine-status__metric-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      margin-top: var(--ux-space-xs);
    }

    /* Metric colors */
    .ux-machine-status__metric--success .ux-machine-status__metric-value {
      color: var(--ux-success);
    }

    .ux-machine-status__metric--warning .ux-machine-status__metric-value {
      color: var(--ux-warning);
    }

    .ux-machine-status__metric--danger .ux-machine-status__metric-value {
      color: var(--ux-danger);
    }

    /* ==========================================================================
       Uptime Display
       ========================================================================== */

    .ux-machine-status__uptime {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
    }

    .ux-machine-status__uptime-circle {
      position: relative;
      width: 60px;
      height: 60px;
      flex-shrink: 0;
    }

    .ux-machine-status__uptime-svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .ux-machine-status__uptime-bg {
      fill: none;
      stroke: var(--ux-surface-secondary);
      stroke-width: 6;
    }

    .ux-machine-status__uptime-fill {
      fill: none;
      stroke: var(--ux-success);
      stroke-width: 6;
      stroke-linecap: round;
      stroke-dasharray: 157; /* 2 * PI * 25 */
      stroke-dashoffset: 157;
      transition: stroke-dashoffset var(--ux-transition-slow) var(--ux-ease-ios);
    }

    .ux-machine-status__uptime-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: var(--ux-font-size-sm);
      font-weight: 700;
      color: var(--ux-text);
    }

    .ux-machine-status__uptime-info {
      flex: 1;
    }

    .ux-machine-status__uptime-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .ux-machine-status__uptime-value {
      font-size: var(--ux-font-size-xl);
      font-weight: 700;
      color: var(--ux-text);
    }

    .ux-machine-status__uptime-time {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* Uptime colors */
    .ux-machine-status__uptime--warning .ux-machine-status__uptime-fill {
      stroke: var(--ux-warning);
    }

    .ux-machine-status__uptime--danger .ux-machine-status__uptime-fill {
      stroke: var(--ux-danger);
    }

    /* ==========================================================================
       Alert Section
       ========================================================================== */

    .ux-machine-status__alert {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-sm);
    }

    .ux-machine-status__alert-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .ux-machine-status__alert-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-machine-status__alert-text {
      flex: 1;
    }

    .ux-machine-status__alert-time {
      font-size: var(--ux-font-size-xs);
      color: inherit;
      opacity: 0.8;
    }

    /* Alert variants */
    .ux-machine-status__alert--warning {
      background: rgba(var(--ux-warning-rgb), 0.1);
      color: var(--ux-warning-shade);
    }

    .ux-machine-status__alert--error {
      background: rgba(var(--ux-danger-rgb), 0.1);
      color: var(--ux-danger);
    }

    .ux-machine-status__alert--info {
      background: rgba(var(--ux-primary-rgb), 0.1);
      color: var(--ux-primary);
    }

    /* Multiple alerts */
    .ux-machine-status__alerts {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
    }

    /* ==========================================================================
       Operator Section
       ========================================================================== */

    .ux-machine-status__operator {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding-top: var(--ux-space-sm);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-machine-status__operator-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      flex-shrink: 0;
    }

    .ux-machine-status__operator-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    .ux-machine-status__operator-info {
      flex: 1;
      min-width: 0;
    }

    .ux-machine-status__operator-name {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-machine-status__operator-role {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-machine-status__operator-shift {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      padding: 2px var(--ux-space-xs);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius-sm);
    }

    /* No operator assigned */
    .ux-machine-status__operator--empty {
      color: var(--ux-text-tertiary);
      font-size: var(--ux-font-size-sm);
      font-style: italic;
    }

    /* ==========================================================================
       Footer Section
       ========================================================================== */

    .ux-machine-status__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-sm);
      padding-top: var(--ux-space-sm);
      border-top: 1px solid var(--ux-border-color);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-machine-status__last-update {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-machine-status__actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    /* ==========================================================================
       Mini Variant
       ========================================================================== */

    .ux-machine-status--mini {
      --ux-machine-status-padding: var(--ux-space-md);
      --ux-machine-status-gap: var(--ux-space-sm);
      --ux-machine-status-indicator-size: 8px;
      --ux-machine-status-icon-size: 36px;
    }

    .ux-machine-status--mini .ux-machine-status__name {
      font-size: var(--ux-font-size-md);
    }

    .ux-machine-status--mini .ux-machine-status__indicator {
      padding: 2px var(--ux-space-xs);
      font-size: var(--ux-font-size-xs);
    }

    .ux-machine-status--mini .ux-machine-status__metrics {
      grid-template-columns: repeat(2, 1fr);
    }

    .ux-machine-status--mini .ux-machine-status__metric-value {
      font-size: var(--ux-font-size-md);
    }

    /* ==========================================================================
       Compact Variant (Single Line)
       ========================================================================== */

    .ux-machine-status--compact {
      flex-direction: row;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
    }

    .ux-machine-status--compact .ux-machine-status__header {
      flex: 1;
      min-width: 0;
    }

    .ux-machine-status--compact .ux-machine-status__metrics {
      display: flex;
      gap: var(--ux-space-lg);
      flex-shrink: 0;
    }

    .ux-machine-status--compact .ux-machine-status__metric {
      padding: 0;
      background: transparent;
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-machine-status--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-machine-status--glass .ux-machine-status__job,
    .ux-machine-status--glass .ux-machine-status__metric {
      background: rgba(255, 255, 255, 0.15);
    }

    /* ==========================================================================
       Machine Grid
       ========================================================================== */

    .ux-machine-grid {
      display: grid;
      gap: var(--ux-space-md);
    }

    /* Auto-fit columns */
    .ux-machine-grid--auto {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    /* Fixed columns */
    .ux-machine-grid--2 { grid-template-columns: repeat(2, 1fr); }
    .ux-machine-grid--3 { grid-template-columns: repeat(3, 1fr); }
    .ux-machine-grid--4 { grid-template-columns: repeat(4, 1fr); }

    /* List layout */
    .ux-machine-grid--list {
      grid-template-columns: 1fr;
    }

    /* Responsive grid */
    @media (max-width: 991px) {
      .ux-machine-grid--4 { grid-template-columns: repeat(2, 1fr); }
      .ux-machine-grid--3 { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 767px) {
      .ux-machine-grid--4,
      .ux-machine-grid--3,
      .ux-machine-grid--2 {
        grid-template-columns: 1fr;
      }

      .ux-machine-status--compact {
        flex-direction: column;
        align-items: stretch;
      }

      .ux-machine-status--compact .ux-machine-status__metrics {
        flex-wrap: wrap;
        justify-content: space-around;
      }
    }

    /* ==========================================================================
       Status Bar (Mini horizontal overview)
       ========================================================================== */

    .ux-machine-status-bar {
      display: flex;
      align-items: center;
      gap: var(--ux-space-lg);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .ux-machine-status-bar__item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      flex-shrink: 0;
    }

    .ux-machine-status-bar__count {
      font-size: var(--ux-font-size-xl);
      font-weight: 700;
      color: var(--ux-text);
    }

    .ux-machine-status-bar__label {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-machine-status-bar__dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .ux-machine-status-bar__dot--running { background: var(--ux-success); }
    .ux-machine-status-bar__dot--idle { background: var(--ux-primary); }
    .ux-machine-status-bar__dot--maintenance { background: var(--ux-warning); }
    .ux-machine-status-bar__dot--offline { background: var(--ux-gray-400); }
    .ux-machine-status-bar__dot--error { background: var(--ux-danger); }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light) .ux-machine-status--glass .ux-machine-status__job,
      :root:not(.ux-light) .ux-machine-status--glass .ux-machine-status__metric {
        background: rgba(255, 255, 255, 0.08);
      }

      :root:not(.ux-light) .ux-machine-status__indicator--maintenance {
        color: var(--ux-warning);
      }

      :root:not(.ux-light) .ux-machine-status__alert--warning {
        color: var(--ux-warning);
      }
    }

    .ux-dark .ux-machine-status--glass .ux-machine-status__job,
    .ux-dark .ux-machine-status--glass .ux-machine-status__metric {
      background: rgba(255, 255, 255, 0.08);
    }

    .ux-dark .ux-machine-status__indicator--maintenance {
      color: var(--ux-warning);
    }

    .ux-dark .ux-machine-status__alert--warning {
      color: var(--ux-warning);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-machine-status {
        transition: none;
      }

      .ux-machine-status:hover {
        transform: none;
      }

      .ux-machine-status__indicator--running .ux-machine-status__indicator-dot::before,
      .ux-machine-status__indicator--maintenance .ux-machine-status__indicator-dot::before,
      .ux-machine-status__indicator--error .ux-machine-status__indicator-dot::before {
        animation: none;
      }

      .ux-machine-status__uptime-fill,
      .ux-machine-status__job-progress-fill {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-machine-status-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-machine-status-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

})();

/**
 * UX Masonry Component
 * CSS Grid-based masonry layout with responsive columns and animations
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Masonry - CSS Variables
    ======================================== */

    :root {
      --ux-masonry-gap: var(--ux-space-md);
      --ux-masonry-radius: var(--ux-radius-lg);
      --ux-masonry-columns: 3;
      --ux-masonry-item-bg: var(--ux-surface);
    }

    /* ========================================
       UX Masonry - Base
    ======================================== */

    .ux-masonry {
      font-family: var(--ux-font-family);
    }

    .ux-masonry__grid {
      display: block;
      column-count: var(--ux-masonry-columns);
      column-gap: var(--ux-masonry-gap);
    }

    /* ========================================
       Column Variants
    ======================================== */

    .ux-masonry--cols-2 { --ux-masonry-columns: 2; }
    .ux-masonry--cols-3 { --ux-masonry-columns: 3; }
    .ux-masonry--cols-4 { --ux-masonry-columns: 4; }
    .ux-masonry--cols-5 { --ux-masonry-columns: 5; }
    .ux-masonry--cols-6 { --ux-masonry-columns: 6; }

    /* ========================================
       Gap Variants
    ======================================== */

    .ux-masonry--gap-none { --ux-masonry-gap: 0; }
    .ux-masonry--gap-xs { --ux-masonry-gap: var(--ux-space-xs); }
    .ux-masonry--gap-sm { --ux-masonry-gap: var(--ux-space-sm); }
    .ux-masonry--gap-md { --ux-masonry-gap: var(--ux-space-md); }
    .ux-masonry--gap-lg { --ux-masonry-gap: var(--ux-space-lg); }
    .ux-masonry--gap-xl { --ux-masonry-gap: var(--ux-space-xl); }

    /* ========================================
       Masonry Item
    ======================================== */

    .ux-masonry__item {
      position: relative;
      display: block;
      break-inside: avoid;
      margin-bottom: var(--ux-masonry-gap);
      overflow: hidden;
      border-radius: var(--ux-masonry-radius);
      background: var(--ux-masonry-item-bg);
    }

    /* Prevent orphans and widows */
    .ux-masonry__item:last-child {
      margin-bottom: 0;
    }

    /* ========================================
       Masonry Item - Image
    ======================================== */

    .ux-masonry__item img {
      display: block;
      width: 100%;
      height: auto;
      border-radius: inherit;
      object-fit: cover;
      transition: transform var(--ux-transition-normal) var(--ux-ease);
    }

    .ux-masonry__item--hover:hover img {
      transform: scale(1.05);
    }

    /* ========================================
       Masonry Item - Overlay
    ======================================== */

    .ux-masonry__item-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0);
      color: white;
      padding: var(--ux-space-md);
      text-align: center;
      transition: background var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-masonry__item:hover .ux-masonry__item-overlay {
      background: rgba(0, 0, 0, 0.4);
    }

    .ux-masonry__item-title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      margin-bottom: var(--ux-space-xs);
      opacity: 0;
      transform: translateY(10px);
      transition: all var(--ux-transition-normal) var(--ux-ease);
    }

    .ux-masonry__item-subtitle {
      font-size: var(--ux-font-size-sm);
      opacity: 0;
      transform: translateY(10px);
      transition: all var(--ux-transition-normal) var(--ux-ease);
      transition-delay: 50ms;
    }

    .ux-masonry__item:hover .ux-masonry__item-title,
    .ux-masonry__item:hover .ux-masonry__item-subtitle {
      opacity: 1;
      transform: translateY(0);
    }

    /* ========================================
       Masonry Item - Content (for cards)
    ======================================== */

    .ux-masonry__item-content {
      padding: var(--ux-space-md);
    }

    .ux-masonry__item-content .ux-masonry__item-title {
      color: var(--ux-text);
      opacity: 1;
      transform: none;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-masonry__item-content .ux-masonry__item-subtitle {
      color: var(--ux-text-secondary);
      opacity: 1;
      transform: none;
    }

    /* ========================================
       Masonry Item - Clickable
    ======================================== */

    .ux-masonry__item--clickable {
      cursor: pointer;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-masonry__item--clickable:hover {
      box-shadow: var(--ux-shadow-lg);
    }

    .ux-masonry__item--clickable:active {
      transform: scale(0.98);
    }

    .ux-masonry__item--clickable:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.3);
    }

    /* ========================================
       Masonry Item - Span (double width/height)
    ======================================== */

    .ux-masonry__item--span-2 {
      column-span: all;
      width: calc((100% - var(--ux-masonry-gap)) / 2);
    }

    /* ========================================
       Animation on Load
    ======================================== */

    .ux-masonry--animated .ux-masonry__item {
      opacity: 0;
      transform: translateY(20px);
      animation: ux-masonry-fade-in var(--ux-transition-slow) var(--ux-ease) forwards;
    }

    .ux-masonry--animated .ux-masonry__item:nth-child(1) { animation-delay: 0ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(2) { animation-delay: 50ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(3) { animation-delay: 100ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(4) { animation-delay: 150ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(5) { animation-delay: 200ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(6) { animation-delay: 250ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(7) { animation-delay: 300ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(8) { animation-delay: 350ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(9) { animation-delay: 400ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(10) { animation-delay: 450ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(11) { animation-delay: 500ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(12) { animation-delay: 550ms; }
    .ux-masonry--animated .ux-masonry__item:nth-child(n+13) { animation-delay: 600ms; }

    @keyframes ux-masonry-fade-in {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ========================================
       Loading State / Skeleton
    ======================================== */

    .ux-masonry__item--loading {
      min-height: 200px;
      background: linear-gradient(
        90deg,
        var(--ux-gray-100) 0%,
        var(--ux-gray-200) 50%,
        var(--ux-gray-100) 100%
      );
      background-size: 200% 100%;
      animation: ux-masonry-shimmer 1.5s infinite;
    }

    @keyframes ux-masonry-shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Image loading state */
    .ux-masonry__item img[loading="lazy"]:not([src]),
    .ux-masonry__item img.ux-masonry__img--loading {
      min-height: 200px;
      background: var(--ux-gray-100);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-masonry__item--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
    }

    .ux-masonry__item--glass .ux-masonry__item-content {
      background: transparent;
    }

    /* ========================================
       Rounded Variants
    ======================================== */

    .ux-masonry--rounded-none .ux-masonry__item { border-radius: 0; }
    .ux-masonry--rounded-sm .ux-masonry__item { border-radius: var(--ux-radius-sm); }
    .ux-masonry--rounded-md .ux-masonry__item { border-radius: var(--ux-radius-md); }
    .ux-masonry--rounded-lg .ux-masonry__item { border-radius: var(--ux-radius-lg); }
    .ux-masonry--rounded-xl .ux-masonry__item { border-radius: var(--ux-radius-xl); }

    /* ========================================
       Shadow Variants
    ======================================== */

    .ux-masonry--shadow-none .ux-masonry__item { box-shadow: none; }
    .ux-masonry--shadow-sm .ux-masonry__item { box-shadow: var(--ux-shadow-sm); }
    .ux-masonry--shadow-md .ux-masonry__item { box-shadow: var(--ux-shadow-md); }
    .ux-masonry--shadow-lg .ux-masonry__item { box-shadow: var(--ux-shadow-lg); }

    /* ========================================
       Responsive Breakpoints
    ======================================== */

    @media (max-width: 1200px) {
      .ux-masonry--cols-6 { --ux-masonry-columns: 4; }
      .ux-masonry--cols-5 { --ux-masonry-columns: 4; }
    }

    @media (max-width: 992px) {
      .ux-masonry--cols-6 { --ux-masonry-columns: 3; }
      .ux-masonry--cols-5 { --ux-masonry-columns: 3; }
      .ux-masonry--cols-4 { --ux-masonry-columns: 3; }
    }

    @media (max-width: 767px) {
      .ux-masonry--cols-6,
      .ux-masonry--cols-5,
      .ux-masonry--cols-4,
      .ux-masonry--cols-3 {
        --ux-masonry-columns: 2;
      }
    }

    @media (max-width: 480px) {
      .ux-masonry--cols-6,
      .ux-masonry--cols-5,
      .ux-masonry--cols-4,
      .ux-masonry--cols-3 {
        --ux-masonry-columns: 1;
      }

      .ux-masonry--cols-2 {
        --ux-masonry-columns: 1;
      }
    }

    /* Keep 2 columns on mobile if explicitly set */
    .ux-masonry--cols-2-always {
      --ux-masonry-columns: 2 !important;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-theme-light):not(.ux-light) {
        --ux-masonry-item-bg: var(--ux-surface);
      }

      :root:not(.ux-theme-light):not(.ux-light) .ux-masonry__item--loading {
        background: linear-gradient(
          90deg,
          var(--ux-gray-800) 0%,
          var(--ux-gray-700) 50%,
          var(--ux-gray-800) 100%
        );
        background-size: 200% 100%;
      }

      :root:not(.ux-theme-light):not(.ux-light) .ux-masonry__item img[loading="lazy"]:not([src]),
      :root:not(.ux-theme-light):not(.ux-light) .ux-masonry__item img.ux-masonry__img--loading {
        background: var(--ux-gray-800);
      }
    }

    .ux-dark .ux-masonry__item--loading,
    .ux-theme-dark .ux-masonry__item--loading {
      background: linear-gradient(
        90deg,
        var(--ux-gray-800) 0%,
        var(--ux-gray-700) 50%,
        var(--ux-gray-800) 100%
      );
      background-size: 200% 100%;
    }

    .ux-dark .ux-masonry__item img[loading="lazy"]:not([src]),
    .ux-dark .ux-masonry__item img.ux-masonry__img--loading,
    .ux-theme-dark .ux-masonry__item img[loading="lazy"]:not([src]),
    .ux-theme-dark .ux-masonry__item img.ux-masonry__img--loading {
      background: var(--ux-gray-800);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-masonry--animated .ux-masonry__item {
        animation: none;
        opacity: 1;
        transform: none;
      }

      .ux-masonry__item img,
      .ux-masonry__item-overlay,
      .ux-masonry__item-title,
      .ux-masonry__item-subtitle,
      .ux-masonry__item--clickable {
        transition: none;
      }

      .ux-masonry__item--loading {
        animation: none;
      }

      .ux-masonry__item--hover:hover img {
        transform: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-masonry-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-masonry-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Intersection Observer for lazy loading animation
  let animationObserver = null;

  function getAnimationObserver() {
    if (animationObserver) return animationObserver;

    if ('IntersectionObserver' in window) {
      animationObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.animationPlayState = 'running';
            animationObserver.unobserve(entry.target);
          }
        });
      }, {
        rootMargin: '50px 0px',
        threshold: 0.1
      });
    }

    return animationObserver;
  }

  // Alpine.js component
  const masonryData = (options = {}) => ({
    // Items array: [{ src, title, subtitle, href }]
    items: options.items || [],

    // Configuration
    columns: options.columns || 3,
    gap: options.gap || 'md',
    animated: options.animated ?? true,
    hoverEffect: options.hoverEffect ?? true,
    lazyLoad: options.lazyLoad ?? true,
    rounded: options.rounded || 'lg',
    shadow: options.shadow || 'none',

    // State
    loaded: [],

    init() {
      // Initialize loaded state for each item
      this.loaded = new Array(this.items.length).fill(false);

      // Observe items for animation
      if (this.animated) {
        this.$nextTick(() => {
          const obs = getAnimationObserver();
          if (obs) {
            const items = this.$el.querySelectorAll('.ux-masonry__item');
            items.forEach(item => {
              item.style.animationPlayState = 'paused';
              obs.observe(item);
            });
          }
        });
      }
    },

    // Mark image as loaded
    onImageLoad(index) {
      this.loaded[index] = true;
      this.$dispatch('masonry:image-load', { index, item: this.items[index] });
    },

    // Mark image as error
    onImageError(index) {
      this.$dispatch('masonry:image-error', { index, item: this.items[index] });
    },

    // Get column class
    get columnClass() {
      return `ux-masonry--cols-${this.columns}`;
    },

    // Get gap class
    get gapClass() {
      return `ux-masonry--gap-${this.gap}`;
    },

    // Get rounded class
    get roundedClass() {
      return `ux-masonry--rounded-${this.rounded}`;
    },

    // Get shadow class
    get shadowClass() {
      return `ux-masonry--shadow-${this.shadow}`;
    },

    // Get container classes
    get containerClasses() {
      return {
        [this.columnClass]: true,
        [this.gapClass]: true,
        [this.roundedClass]: true,
        [this.shadowClass]: true,
        'ux-masonry--animated': this.animated
      };
    },

    // Set items
    setItems(items) {
      this.items = items;
      this.loaded = new Array(items.length).fill(false);
    },

    // Add item
    addItem(item) {
      this.items.push(item);
      this.loaded.push(false);
    },

    // Remove item
    removeItem(index) {
      this.items.splice(index, 1);
      this.loaded.splice(index, 1);
    },

    // Refresh layout (for dynamic content)
    refresh() {
      this.$nextTick(() => {
        this.$dispatch('masonry:refresh');
      });
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxMasonry', masonryData);
  }

})();

/**
 * UX Master-Detail Component
 * Two-panel layout with master list and detail view
 * Ideal for admin interfaces like roles, users, settings
 *
 * Features:
 * - Desktop: Side-by-side panels
 * - Mobile: Stacked panels with collapsible master
 * - Customizable widths and breakpoints
 *
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       Master-Detail Layout
       Panel izquierdo (lista) + panel derecho (detalle)
       Ideal para interfaces de administraciÃ³n
    ======================================== */

    :root {
      --ux-master-detail-master-width: 280px;
      --ux-master-detail-master-min-width: 240px;
      --ux-master-detail-master-max-width: 400px;
      --ux-master-detail-breakpoint: 768px;
      --ux-master-detail-mobile-master-height: 40vh;
    }

    .ux-master-detail {
      display: flex;
      height: 100%;
      width: 100%;
      overflow: hidden;
      background: var(--ux-background);
    }

    /* Full height variant (for pages without footer) */
    .ux-master-detail--full-height {
      height: 100dvh;
    }

    /* With navbar offset */
    .ux-master-detail--has-navbar {
      height: calc(100dvh - var(--ux-navbar-height, 56px));
    }

    /* ========================================
       Master Panel (Left)
    ======================================== */

    .ux-master-detail__master {
      width: var(--ux-master-detail-master-width);
      min-width: var(--ux-master-detail-master-min-width);
      max-width: var(--ux-master-detail-master-max-width);
      flex-shrink: 0;
      border-right: 1px solid var(--ux-border-color);
      display: flex;
      flex-direction: column;
      background: var(--ux-surface);
      overflow: hidden;
    }

    /* Master header (search, title, actions) */
    .ux-master-detail__master-header {
      flex-shrink: 0;
      padding: var(--ux-space-md);
      border-bottom: 1px solid var(--ux-border-color);
    }

    /* Master content (scrollable list) */
    .ux-master-detail__master-content {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-y: contain;
    }

    /* Master footer (optional actions) */
    .ux-master-detail__master-footer {
      flex-shrink: 0;
      padding: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Detail Panel (Right)
    ======================================== */

    .ux-master-detail__detail {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      background: var(--ux-background-secondary, var(--ux-surface-secondary));
      overflow: hidden;
    }

    /* Detail header */
    .ux-master-detail__detail-header {
      flex-shrink: 0;
      padding: var(--ux-space-md);
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
    }

    /* Detail content (scrollable) */
    .ux-master-detail__detail-content {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-y: contain;
    }

    /* Detail footer */
    .ux-master-detail__detail-footer {
      flex-shrink: 0;
      padding: var(--ux-space-md);
      background: var(--ux-surface);
      border-top: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Empty State
    ======================================== */

    .ux-master-detail__empty {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      padding: var(--ux-space-2xl);
      text-align: center;
    }

    .ux-master-detail__empty-icon {
      color: var(--ux-text-tertiary);
      margin-bottom: var(--ux-space-md);
    }

    .ux-master-detail__empty-title {
      font-size: var(--ux-text-xl);
      font-weight: var(--ux-font-medium, 500);
      margin: 0 0 var(--ux-space-sm);
      color: var(--ux-text);
    }

    .ux-master-detail__empty-text {
      font-size: var(--ux-text-base);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    /* ========================================
       Width Variants
    ======================================== */

    .ux-master-detail--narrow-master {
      --ux-master-detail-master-width: 240px;
      --ux-master-detail-master-min-width: 200px;
    }

    .ux-master-detail--wide-master {
      --ux-master-detail-master-width: 350px;
      --ux-master-detail-master-min-width: 300px;
      --ux-master-detail-master-max-width: 500px;
    }

    /* ========================================
       Mobile/Tablet Responsive (< 768px)
    ======================================== */

    @media (max-width: 767px) {
      .ux-master-detail {
        flex-direction: column;
      }

      .ux-master-detail__master {
        width: 100%;
        min-width: 100%;
        max-width: 100%;
        max-height: var(--ux-master-detail-mobile-master-height);
        border-right: none;
        border-bottom: 1px solid var(--ux-border-color);
      }

      .ux-master-detail__detail {
        flex: 1;
        min-height: 0;
      }

      /* Collapsible master on mobile */
      .ux-master-detail--collapsible .ux-master-detail__master {
        max-height: 0;
        border-bottom: none;
        transition: max-height var(--ux-transition-normal) var(--ux-ease-ios);
      }

      .ux-master-detail--collapsible.ux-master-detail--master-open .ux-master-detail__master {
        max-height: var(--ux-master-detail-mobile-master-height);
        border-bottom: 1px solid var(--ux-border-color);
      }

      /* Hide detail content when master is fully open on mobile */
      .ux-master-detail--mobile-master-only .ux-master-detail__detail {
        display: none;
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-master-detail__master {
        background: var(--ux-surface);
      }
      .ux-master-detail__detail {
        background: var(--ux-background-secondary, var(--ux-surface-secondary));
      }
    }

    .ux-dark .ux-master-detail__master {
      background: var(--ux-surface);
    }

    .ux-dark .ux-master-detail__detail {
      background: var(--ux-background-secondary, var(--ux-surface-secondary));
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-master-detail--glass .ux-master-detail__master {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-right-color: var(--ux-glass-border);
    }

    .ux-master-detail--glass .ux-master-detail__detail {
      background: var(--ux-glass-bg-thin);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-master-detail--collapsible .ux-master-detail__master {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-master-detail-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-master-detail-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component (optional, for interactive features)
  const masterDetailComponent = (config = {}) => ({
    selectedId: config.initialSelection ?? null,
    masterOpen: config.masterOpenByDefault ?? false,
    _isDesktop: false,

    init() {
      this._checkScreenSize();
      this._resizeHandler = () => this._checkScreenSize();
      window.addEventListener('resize', this._resizeHandler);
    },

    destroy() {
      if (this._resizeHandler) {
        window.removeEventListener('resize', this._resizeHandler);
      }
    },

    _checkScreenSize() {
      this._isDesktop = window.innerWidth >= 768;
      // Auto-close master when switching to desktop
      if (this._isDesktop && this.masterOpen) {
        this.masterOpen = false;
      }
    },

    select(id) {
      this.selectedId = id;
      // Close master on mobile after selection
      if (!this._isDesktop) {
        this.masterOpen = false;
      }
      this.$dispatch('masterdetail:select', { id });
    },

    toggleMaster() {
      this.masterOpen = !this.masterOpen;
      this.$dispatch('masterdetail:toggle', { open: this.masterOpen });
    },

    openMaster() {
      this.masterOpen = true;
      this.$dispatch('masterdetail:open');
    },

    closeMaster() {
      this.masterOpen = false;
      this.$dispatch('masterdetail:close');
    },

    isSelected(id) {
      return this.selectedId === id;
    },

    get containerClasses() {
      return {
        'ux-master-detail--master-open': this.masterOpen
      };
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxMasterDetail', masterDetailComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxMasterDetail', masterDetailComponent);
    });
  }
})();

/**
 * UX Mega Menu Component
 * Large dropdown menu with multiple columns and rich content
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Mega Menu
    ======================================== */

    .ux-mega-menu {
      position: relative;
      display: inline-flex;
      font-family: var(--ux-font-family);
    }

    /* ========================================
       Trigger
    ======================================== */

    .ux-mega-menu__trigger {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: color var(--ux-transition-fast);
    }

    .ux-mega-menu__trigger:hover {
      color: var(--ux-primary);
    }

    .ux-mega-menu__trigger-icon {
      width: 16px;
      height: 16px;
      transition: transform var(--ux-transition-fast);
    }

    .ux-mega-menu--open .ux-mega-menu__trigger-icon {
      transform: rotate(180deg);
    }

    /* ========================================
       Dropdown Panel
    ======================================== */

    .ux-mega-menu__panel {
      position: absolute;
      top: 100%;
      left: 0;
      min-width: 600px;
      max-width: calc(100vw - 2rem);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      box-shadow: var(--ux-shadow-lg);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all var(--ux-transition-normal) var(--ux-ease-out);
      z-index: var(--ux-z-dropdown);
      overflow: hidden;
    }

    .ux-mega-menu--open .ux-mega-menu__panel {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    /* Panel positions */
    .ux-mega-menu--right .ux-mega-menu__panel {
      left: auto;
      right: 0;
    }

    .ux-mega-menu--center .ux-mega-menu__panel {
      left: 50%;
      transform: translateX(-50%) translateY(-10px);
    }

    .ux-mega-menu--center.ux-mega-menu--open .ux-mega-menu__panel {
      transform: translateX(-50%) translateY(0);
    }

    .ux-mega-menu--full .ux-mega-menu__panel {
      position: fixed;
      left: 1rem;
      right: 1rem;
      min-width: auto;
      max-width: none;
    }

    /* ========================================
       Panel Header
    ======================================== */

    .ux-mega-menu__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md);
      border-bottom: 1px solid var(--ux-border-color);
      background: var(--ux-surface-secondary);
    }

    .ux-mega-menu__header-title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    /* ========================================
       Panel Content
    ======================================== */

    .ux-mega-menu__content {
      padding: var(--ux-space-md);
    }

    .ux-mega-menu__grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: var(--ux-space-lg);
    }

    /* Fixed columns */
    .ux-mega-menu__grid--2 {
      grid-template-columns: repeat(2, 1fr);
    }

    .ux-mega-menu__grid--3 {
      grid-template-columns: repeat(3, 1fr);
    }

    .ux-mega-menu__grid--4 {
      grid-template-columns: repeat(4, 1fr);
    }

    /* ========================================
       Column / Section
    ======================================== */

    .ux-mega-menu__section {
      display: flex;
      flex-direction: column;
    }

    .ux-mega-menu__section-title {
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--ux-space-sm);
      padding: 0 var(--ux-space-sm);
    }

    .ux-mega-menu__section-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
    }

    /* ========================================
       Menu Items
    ======================================== */

    .ux-mega-menu__item {
      display: flex;
      align-items: flex-start;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm);
      border-radius: var(--ux-radius-md);
      color: var(--ux-text);
      text-decoration: none;
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-mega-menu__item:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-mega-menu__item:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: -2px;
    }

    .ux-mega-menu__item-icon {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      color: var(--ux-text-secondary);
    }

    .ux-mega-menu__item-content {
      flex: 1;
      min-width: 0;
    }

    .ux-mega-menu__item-title {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
      margin: 0 0 2px;
    }

    .ux-mega-menu__item-desc {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
      line-height: 1.4;
    }

    /* Item with badge */
    .ux-mega-menu__item-badge {
      flex-shrink: 0;
      padding: 2px 6px;
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      background: rgba(var(--ux-primary-rgb), 0.1);
      color: var(--ux-primary);
      border-radius: var(--ux-radius-full);
    }

    /* Featured item */
    .ux-mega-menu__item--featured {
      background: var(--ux-surface-secondary);
      padding: var(--ux-space-md);
    }

    .ux-mega-menu__item--featured:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-mega-menu__item--featured .ux-mega-menu__item-icon {
      width: 32px;
      height: 32px;
      padding: var(--ux-space-xs);
      background: var(--ux-primary);
      color: white;
      border-radius: var(--ux-radius-md);
    }

    /* ========================================
       Panel Footer
    ======================================== */

    .ux-mega-menu__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm) var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
      background: var(--ux-surface-secondary);
    }

    .ux-mega-menu__footer-link {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-primary);
      text-decoration: none;
    }

    .ux-mega-menu__footer-link:hover {
      text-decoration: underline;
    }

    .ux-mega-menu__footer-link svg {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Promo Card
    ======================================== */

    .ux-mega-menu__promo {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md);
      background: linear-gradient(135deg, var(--ux-primary), var(--ux-primary-shade));
      border-radius: var(--ux-radius-md);
      color: white;
    }

    .ux-mega-menu__promo-title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      margin: 0;
    }

    .ux-mega-menu__promo-desc {
      font-size: var(--ux-font-size-sm);
      opacity: 0.9;
      margin: 0;
    }

    .ux-mega-menu__promo-action {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: white;
      text-decoration: none;
      margin-top: var(--ux-space-xs);
    }

    .ux-mega-menu__promo-action:hover {
      text-decoration: underline;
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-mega-menu__panel {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        min-width: auto;
        max-width: none;
        max-height: 80dvh;
        border-radius: var(--ux-radius-lg) var(--ux-radius-lg) 0 0;
        transform: translateY(100%);
        overflow-y: auto;
      }

      .ux-mega-menu--open .ux-mega-menu__panel {
        transform: translateY(0);
      }

      .ux-mega-menu__grid {
        grid-template-columns: 1fr;
      }

      .ux-mega-menu__grid--2,
      .ux-mega-menu__grid--3,
      .ux-mega-menu__grid--4 {
        grid-template-columns: 1fr;
      }
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-mega-menu--glass .ux-mega-menu__panel {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-mega-menu--glass .ux-mega-menu__header,
    .ux-mega-menu--glass .ux-mega-menu__footer {
      background: transparent;
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-mega-menu__panel {
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
    }

    .ux-dark .ux-mega-menu__panel {
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-mega-menu__panel {
        transition: opacity var(--ux-transition-fast), visibility var(--ux-transition-fast);
        transform: none !important;
      }

      .ux-mega-menu__trigger-icon {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-mega-menu-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-mega-menu-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const megaMenuData = (options = {}) => ({
    isOpen: false,
    closeOnClickOutside: options.closeOnClickOutside ?? true,
    closeOnEscape: options.closeOnEscape ?? true,
    openOnHover: options.openOnHover ?? false,
    hoverDelay: options.hoverDelay ?? 150,
    _hoverTimeout: null,

    init() {
      // Click outside handler
      if (this.closeOnClickOutside) {
        this._clickOutsideHandler = (e) => {
          if (this.isOpen && !this.$el.contains(e.target)) {
            this.close();
          }
        };
        document.addEventListener('click', this._clickOutsideHandler);
      }

      // Escape key handler
      if (this.closeOnEscape) {
        this._escapeHandler = (e) => {
          if (e.key === 'Escape' && this.isOpen) {
            this.close();
          }
        };
        document.addEventListener('keydown', this._escapeHandler);
      }
    },

    destroy() {
      if (this._clickOutsideHandler) {
        document.removeEventListener('click', this._clickOutsideHandler);
      }
      if (this._escapeHandler) {
        document.removeEventListener('keydown', this._escapeHandler);
      }
    },

    open() {
      this.isOpen = true;
      this.$dispatch('megamenu:open');
    },

    close() {
      this.isOpen = false;
      this.$dispatch('megamenu:close');
    },

    toggle() {
      this.isOpen ? this.close() : this.open();
    },

    handleMouseEnter() {
      if (!this.openOnHover) return;
      clearTimeout(this._hoverTimeout);
      this._hoverTimeout = setTimeout(() => this.open(), this.hoverDelay);
    },

    handleMouseLeave() {
      if (!this.openOnHover) return;
      clearTimeout(this._hoverTimeout);
      this._hoverTimeout = setTimeout(() => this.close(), this.hoverDelay);
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxMegaMenu', megaMenuData);
  }

})();

/**
 * UX Menu Component
 * MenÃºs desplegables y contextuales
 * @requires ux-core.js
 */
(function () {
  'use strict';

  const styles = `
    /* ========================================
       UX Menu Container
    ======================================== */

    .ux-menu {
      position: relative;
      display: inline-block;
    }

    /* ========================================
       Menu Content (Dropdown)
    ======================================== */

    .ux-menu__content {
      position: absolute;
      min-width: 180px;
      width: 100%;
      height: 100%;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      box-shadow: var(--ux-shadow-xl);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      z-index: var(--ux-z-dropdown);
      opacity: 0;
      visibility: hidden;
      transform: scale(0.95) translateY(-8px);
      transform-origin: top left;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        visibility var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease-spring);
    }

    .ux-menu--open .ux-menu__content {
      opacity: 1;
      visibility: visible;
      transform: scale(1) translateY(0);
    }

    /* Positioning */
    .ux-menu__content--top {
      bottom: 100%;
      margin-bottom: var(--ux-space-xs);
      transform-origin: bottom left;
    }

    .ux-menu__content--right {
      right: 0;
      left: auto;
      transform-origin: top right;
    }

    .ux-menu__content--top.ux-menu__content--right {
      transform-origin: bottom right;
    }

    .ux-menu__content--bottom {
      top: 100%;
      margin-top: var(--ux-space-xs);
    }

    .ux-menu__content--left {
      left: 0;
    }

    /* Full width on mobile */
    @media (max-width: 480px) {
      .ux-menu--full-mobile .ux-menu__content {
        position: fixed;
        left: var(--ux-space-md);
        right: var(--ux-space-md);
        min-width: auto;
        max-width: none;
      }
    }

    /* ========================================
       Menu List
    ======================================== */

    .ux-menu__list {
      list-style: none;
      margin: 0;
      padding: var(--ux-space-xs) 0;
    }

    /* ========================================
       Menu Item
    ======================================== */

    .ux-menu__item {
      display: flex;
      align-items: center;
      padding: var(--ux-space-sm) var(--ux-space-lg);
      color: var(--ux-text);
      font-size: var(--ux-font-size-md);
      text-decoration: none;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-menu__item:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-menu__item:active {
      background-color: var(--ux-light);
    }

    .ux-menu__item--selected {
      color: var(--ux-primary);
      background-color: rgba(var(--ux-primary-rgb), 0.08);
    }

    .ux-menu__item--disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    .ux-menu__item--danger {
      color: var(--ux-danger);
    }

    .ux-menu__item--danger:hover {
      background-color: rgba(var(--ux-danger-rgb), 0.1);
    }

    /* ========================================
       Menu Item Content
    ======================================== */

    .ux-menu__item-icon {
      width: 20px;
      height: 20px;
      margin-right: var(--ux-space-md);
      color: var(--ux-text-secondary);
      flex-shrink: 0;
    }

    .ux-menu__item--selected .ux-menu__item-icon,
    .ux-menu__item--danger .ux-menu__item-icon {
      color: inherit;
    }

    .ux-menu__item-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-menu__item-content {
      flex: 1;
      min-width: 0;
    }

    .ux-menu__item-label {
      display: block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-menu__item-description {
      display: block;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-menu__item-end {
      margin-left: auto;
      padding-left: var(--ux-space-md);
      display: flex;
      align-items: center;
      flex-shrink: 0;
    }

    .ux-menu__item-shortcut {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-menu__item-check {
      width: 16px;
      height: 16px;
      color: var(--ux-primary);
    }

    .ux-menu__item-check svg {
      width: 100%;
      height: 100%;
    }

    .ux-menu__item-arrow {
      width: 16px;
      height: 16px;
      color: var(--ux-text-tertiary);
    }

    .ux-menu__item-arrow svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Menu Divider
    ======================================== */

    .ux-menu__divider {
      height: 1px;
      margin: var(--ux-space-xs) 0;
      background-color: var(--ux-border-color);
    }

    /* ========================================
       Menu Header
    ======================================== */

    .ux-menu__header {
      padding: var(--ux-space-sm) var(--ux-space-lg);
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ========================================
       Submenu
    ======================================== */

    .ux-menu__item--submenu {
      position: relative;
    }

    .ux-menu__submenu {
      position: absolute;
      left: 100%;
      top: 0;
      margin-left: var(--ux-space-xs);
    }

    .ux-menu__submenu--left {
      left: auto;
      right: 100%;
      margin-left: 0;
      margin-right: var(--ux-space-xs);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-menu__content--sm {
      min-width: 140px;
    }

    .ux-menu__content--sm .ux-menu__item {
      padding: var(--ux-space-xs) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
    }

    .ux-menu__content--sm .ux-menu__item-icon {
      width: 16px;
      height: 16px;
    }

    .ux-menu__content--lg {
      min-width: 240px;
    }

    .ux-menu__content--lg .ux-menu__item {
      padding: var(--ux-space-md) var(--ux-space-lg);
    }

    /* ========================================
       Context Menu
    ======================================== */

    .ux-context-menu {
      position: fixed;
      z-index: var(--ux-z-popover);
    }

    .ux-context-menu .ux-menu__content {
      position: static;
      opacity: 1;
      visibility: visible;
      transform: scale(1);
    }

    /* ========================================
       Action Menu (Bottom Sheet style on mobile)
    ======================================== */

    @media (max-width: 767px) {
      .ux-menu--action-sheet .ux-menu__content {
        position: fixed;
        top: auto;
        left: 0;
        right: 0;
        bottom: 0;
        max-height: 60dvh;
        min-width: auto;
        max-width: none;
        border-radius: var(--ux-border-radius-xl) var(--ux-border-radius-xl) 0 0;
        border: none;
        transform: translateY(100%);
        transform-origin: bottom center;
        padding-bottom: env(safe-area-inset-bottom);
      }

      .ux-menu--action-sheet.ux-menu--open .ux-menu__content {
        transform: translateY(0);
      }

      .ux-menu--action-sheet .ux-menu__content::before {
        content: '';
        display: block;
        width: 36px;
        height: 4px;
        margin: var(--ux-space-sm) auto var(--ux-space-md);
        background-color: var(--ux-light-shade);
        border-radius: 2px;
      }

      .ux-menu--action-sheet .ux-menu__item {
        padding: var(--ux-space-md) var(--ux-space-xl);
        font-size: var(--ux-font-size-lg);
      }
    }

    /* ========================================
       Backdrop for mobile menu
    ======================================== */

    .ux-menu__backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: var(--ux-z-modal-backdrop);
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-transition-base) var(--ux-ease),
        visibility var(--ux-transition-base) var(--ux-ease);
    }

    .ux-menu--open .ux-menu__backdrop {
      opacity: 1;
      visibility: visible;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-menu--glass .ux-menu__content {
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border-right: 0.5px solid var(--ux-glass-border);
    }

    .ux-menu--glass.ux-menu--end .ux-menu__content {
      border-right: none;
      border-left: 0.5px solid var(--ux-glass-border);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-menu-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-menu-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for menu
  // ARIA: role="menu", aria-expanded on trigger, role="menuitem" on items
  const menuComponent = (config = {}) => ({
    isOpen: false,
    position: config.position || 'bottom-left',
    items: config.items || [],
    selectedValue: config.selectedValue || null,
    menuId: config.id || 'ux-menu-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for the trigger button
    get triggerAriaAttrs() {
      return {
        'aria-haspopup': 'menu',
        'aria-expanded': this.isOpen ? 'true' : 'false',
        'aria-controls': this.menuId + '-content'
      };
    },

    // ARIA attributes for the menu content
    get menuAriaAttrs() {
      return {
        'role': 'menu',
        'id': this.menuId + '-content',
        'aria-orientation': 'vertical'
      };
    },

    // ARIA attributes for each menu item
    getItemAriaAttrs(item, index) {
      return {
        'role': 'menuitem',
        'tabindex': index === 0 ? '0' : '-1',
        'aria-disabled': item.disabled ? 'true' : 'false'
      };
    },

    open() {
      this.isOpen = true;
      document.body.style.overflow = 'hidden';
      // Focus first menu item
      this.$nextTick(() => {
        const firstItem = this.$refs.content?.querySelector('.ux-menu__item:not(.ux-menu__item--disabled)');
        if (firstItem) firstItem.focus();
      });
    },

    close() {
      this.isOpen = false;
      document.body.style.overflow = '';
    },

    toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    },

    select(item) {
      if (item.disabled) return;

      this.selectedValue = item.value;

      if (item.action && typeof item.action === 'function') {
        item.action();
      }

      if (!item.keepOpen) {
        this.close();
      }
    },

    isSelected(item) {
      return this.selectedValue === item.value;
    },

    handleKeydown(event) {
      switch (event.key) {
        case 'Escape':
          this.close();
          break;
        case 'ArrowDown':
          event.preventDefault();
          this.focusNext();
          break;
        case 'ArrowUp':
          event.preventDefault();
          this.focusPrev();
          break;
      }
    },

    focusNext() {
      const items = this.$refs.content?.querySelectorAll('.ux-menu__item:not(.ux-menu__item--disabled)');
      if (!items) return;

      const current = document.activeElement;
      const currentIndex = Array.from(items).indexOf(current);
      const nextIndex = currentIndex < items.length - 1 ? currentIndex + 1 : 0;
      items[nextIndex]?.focus();
    },

    focusPrev() {
      const items = this.$refs.content?.querySelectorAll('.ux-menu__item:not(.ux-menu__item--disabled)');
      if (!items) return;

      const current = document.activeElement;
      const currentIndex = Array.from(items).indexOf(current);
      const prevIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;
      items[prevIndex]?.focus();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxMenu', menuComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxMenu', menuComponent);
    });
  }

  // Alpine component for context menu
  // ARIA: role="menu" for context menus
  const contextMenuComponent = (config = {}) => ({
    isOpen: false,
    x: 0,
    y: 0,
    items: config.items || [],
    contextMenuId: config.id || 'ux-context-menu-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for context menu
    get menuAriaAttrs() {
      return {
        'role': 'menu',
        'id': this.contextMenuId,
        'aria-orientation': 'vertical'
      };
    },

    // ARIA attributes for each menu item
    getItemAriaAttrs(item, index) {
      return {
        'role': 'menuitem',
        'tabindex': index === 0 ? '0' : '-1',
        'aria-disabled': item.disabled ? 'true' : 'false'
      };
    },

    show(event) {
      event.preventDefault();

      // Position the menu
      this.x = event.clientX;
      this.y = event.clientY;

      // Adjust if menu would go off screen
      this.$nextTick(() => {
        const menu = this.$refs.menu;
        if (!menu) return;

        const rect = menu.getBoundingClientRect();
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;

        if (this.x + rect.width > viewportWidth) {
          this.x = viewportWidth - rect.width - 8;
        }

        if (this.y + rect.height > viewportHeight) {
          this.y = viewportHeight - rect.height - 8;
        }
      });

      this.isOpen = true;
    },

    hide() {
      this.isOpen = false;
    },

    select(item) {
      if (item.disabled) return;

      if (item.action && typeof item.action === 'function') {
        item.action();
      }

      this.hide();
    },

    getStyle() {
      return {
        left: this.x + 'px',
        top: this.y + 'px'
      };
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxContextMenu', contextMenuComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxContextMenu', contextMenuComponent);
    });
  }
})();

/**
 * UX Modal Component
 * Modal centrado con soporte Bootstrap Grid
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Modal Backdrop
    ======================================== */

    .ux-modal-backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: var(--ux-z-modal-backdrop);
      display: block;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      opacity: 0;
      visibility: hidden;
      /* iOS-style fade - slightly faster than modal */
      transition:
        opacity 300ms cubic-bezier(0.32, 0.72, 0, 1),
        visibility 300ms cubic-bezier(0.32, 0.72, 0, 1);
    }

    .ux-modal-backdrop--open {
      opacity: 1;
      visibility: visible;
    }

    /* Faster fade out when closing */
    .ux-modal-backdrop:not(.ux-modal-backdrop--open) {
      transition:
        opacity 250ms ease-in,
        visibility 250ms ease-in;
    }

    /* ========================================
       UX Modal
    ======================================== */

    .ux-modal {
      position: relative;
      width: 100%;
      background-color: var(--ux-surface);
      border-radius: var(--ux-modal-border-radius);
      box-shadow: var(--ux-shadow-xl);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      /* iOS-style entrance: scale up with spring */
      transform: scale(0.9);
      opacity: 0;
      will-change: transform, opacity;
      /* iOS spring animation curve */
      transition:
        transform 400ms cubic-bezier(0.32, 0.72, 0, 1),
        opacity 250ms ease-out;
    }

    .ux-modal-backdrop--open .ux-modal {
      transform: scale(1);
      opacity: 1;
      will-change: auto;
    }

    /* Closing animation - slightly faster */
    .ux-modal-backdrop:not(.ux-modal-backdrop--open) .ux-modal {
      transition:
        transform 300ms cubic-bezier(0.32, 0.72, 0, 1),
        opacity 200ms ease-in;
    }

    /* Mobile: sheet style from bottom */
    @media (max-width: 767px) {
      .ux-modal {
        border-radius: var(--ux-border-radius-xl) var(--ux-border-radius-xl) 0 0;
        transform: translateY(100%);
        /* iOS sheet animation */
        transition:
          transform 400ms cubic-bezier(0.32, 0.72, 0, 1),
          opacity 250ms ease-out;
      }

      .ux-modal-backdrop--open .ux-modal {
        transform: translateY(0);
      }

      .ux-modal-backdrop:not(.ux-modal-backdrop--open) .ux-modal {
        transition:
          transform 350ms cubic-bezier(0.32, 0.72, 0, 1),
          opacity 200ms ease-in;
      }
    }

    /* ========================================
       Full Height Modifier
    ======================================== */

    .ux-modal--full-height {
      height: 100dvh;
      max-height: 100dvh;
      border-radius: 0;
    }

    @media (max-width: 767px) {
      .ux-modal--full-height {
        border-radius: 0;
      }
    }

    /* ========================================
       Side Modals (Left/Right)
       Full height panels from sides
    ======================================== */

    /* Backdrop for side modals - no grid centering needed */
    .ux-modal-backdrop--side {
      display: flex;
      align-items: stretch;
    }

    .ux-modal-backdrop--side.ux-modal-backdrop--left {
      justify-content: flex-start;
    }

    .ux-modal-backdrop--side.ux-modal-backdrop--right {
      justify-content: flex-end;
    }

    /* Side modal base */
    .ux-modal--side {
      position: relative;
      height: 100dvh;
      max-height: 100dvh;
      border-radius: 0;
      flex-shrink: 0;
    }

    /* Left side modal */
    .ux-modal--left {
      transform: translateX(-100%);
      border-radius: 0 var(--ux-border-radius-xl) var(--ux-border-radius-xl) 0;
    }

    .ux-modal-backdrop--open .ux-modal--left {
      transform: translateX(0);
    }

    /* Right side modal */
    .ux-modal--right {
      transform: translateX(100%);
      border-radius: var(--ux-border-radius-xl) 0 0 var(--ux-border-radius-xl);
    }

    .ux-modal-backdrop--open .ux-modal--right {
      transform: translateX(0);
    }

    /* Side modal animations - iOS spring curve */
    .ux-modal--left,
    .ux-modal--right {
      transition:
        transform 400ms cubic-bezier(0.32, 0.72, 0, 1),
        opacity 300ms var(--ux-ease);
    }

    /* Mobile: side modals take full width */
    @media (max-width: 767px) {
      .ux-modal--left,
      .ux-modal--right {
        width: 100%;
        max-width: 100%;
        border-radius: 0;
      }
    }

    /* Glass variant for side modals */
    .ux-modal--glass.ux-modal--left {
      border-radius: 0 var(--ux-glass-radius-xl) var(--ux-glass-radius-xl) 0;
    }

    .ux-modal--glass.ux-modal--right {
      border-radius: var(--ux-glass-radius-xl) 0 0 var(--ux-glass-radius-xl);
    }

    @media (max-width: 767px) {
      .ux-modal--glass.ux-modal--left,
      .ux-modal--glass.ux-modal--right {
        border-radius: 0;
      }
    }

    /* ========================================
       Modal Header
    ======================================== */

    .ux-modal__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 56px;
      padding: var(--ux-space-md) var(--ux-space-lg);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-modal__header--no-border {
      border-bottom: none;
    }

    .ux-modal__header-start {
      display: flex;
      align-items: center;
      min-width: 60px;
    }

    .ux-modal__header-center {
      flex: 1;
      text-align: center;
    }

    .ux-modal__header-end {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      min-width: 60px;
    }

    .ux-modal__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-modal__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: 2px;
    }

    /* Header buttons */
    .ux-modal__button {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 44px;
      min-height: 44px;
      padding: var(--ux-space-xs);
      background: none;
      border: none;
      color: var(--ux-primary);
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      cursor: pointer;
      border-radius: var(--ux-border-radius);
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-modal__button:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-modal__button:active {
      opacity: 0.7;
    }

    .ux-modal__button-icon {
      width: 24px;
      height: 24px;
    }

    .ux-modal__button-icon svg {
      width: 100%;
      height: 100%;
    }

    /* Close X button */
    .ux-modal__close {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 44px;
      min-height: 44px;
      padding: var(--ux-space-xs);
      background: none;
      border: none;
      color: var(--ux-text-secondary);
      cursor: pointer;
      border-radius: var(--ux-border-radius);
      -webkit-tap-highlight-color: transparent;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-modal__close:hover {
      opacity: 0.7;
    }

    .ux-modal__close:active {
      opacity: 0.5;
    }

    /* ========================================
       Modal Handle (iOS drag indicator)
    ======================================== */

    .ux-modal__handle {
      display: none;
      width: var(--ux-handle-width, 36px);
      height: var(--ux-handle-height, 5px);
      margin: var(--ux-space-sm) auto var(--ux-space-xs);
      background-color: var(--ux-handle-color, var(--ux-gray-300));
      border-radius: var(--ux-handle-radius, 2.5px);
      flex-shrink: 0;
      opacity: 0.6;
    }

    /* Show handle on mobile for sheet-style modals */
    @media (max-width: 767px) {
      .ux-modal__handle {
        display: block;
      }
    }

    /* Force show handle with modifier */
    .ux-modal--with-handle .ux-modal__handle {
      display: block;
    }

    /* ========================================
       Modal Content
    ======================================== */

    .ux-modal__content {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: var(--ux-space-lg);
    }

    .ux-modal__content--no-padding {
      padding: 0;
    }

    .ux-modal__content--centered {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    /* ========================================
       Modal Footer
    ======================================== */

    .ux-modal__footer {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md) var(--ux-space-lg);
      border-top: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-modal__footer--no-border {
      border-top: none;
    }

    .ux-modal__footer--stacked {
      flex-direction: column;
    }

    .ux-modal__footer--stacked .ux-button {
      width: 100%;
    }

    .ux-modal__footer--safe-area {
      padding-bottom: calc(var(--ux-space-md) + env(safe-area-inset-bottom));
    }

    /* ========================================
       Modal Image
    ======================================== */

    .ux-modal__image {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
    }

    /* ========================================
       Glass Modal (iOS 26 Liquid Glass)
    ======================================== */

    .ux-modal--glass {
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      border-radius: var(--ux-glass-radius-xl);
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
    }

    .ux-modal--glass .ux-modal__header {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-modal--glass .ux-modal__footer {
      border-top-color: var(--ux-glass-border);
    }

    @media (max-width: 767px) {
      .ux-modal--glass {
        border-radius: var(--ux-glass-radius-xl) var(--ux-glass-radius-xl) 0 0;
      }
    }

    /* ========================================
       Stacked Modals
    ======================================== */

    .ux-modal-backdrop + .ux-modal-backdrop {
      background-color: rgba(0, 0, 0, 0.2);
    }

    /* ========================================
       CSS-Only Modal (Checkbox Hack)
    ======================================== */

    .ux-modal-toggle {
      display: none;
    }

    .ux-modal-toggle:checked + label + .ux-modal-backdrop {
      opacity: 1;
      visibility: visible;
    }

    .ux-modal-toggle:checked + label + .ux-modal-backdrop .ux-modal {
      transform: scale(1) translateY(0);
      opacity: 1;
    }

    @media (max-width: 767px) {
      .ux-modal-toggle:checked + label + .ux-modal-backdrop .ux-modal {
        transform: translateY(0);
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-modal-backdrop {
        transition: none;
      }

      .ux-modal {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-modal-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-modal-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for modal
  // ARIA: role="dialog", aria-modal="true", aria-labelledby, aria-describedby
  const modalComponent = (config = {}) => ({
    isOpen: config.isOpen || false,
    closeOnBackdrop: config.closeOnBackdrop !== false, // true by default
    closeOnEscape: config.closeOnEscape !== false,
    modalId: config.id || 'ux-modal-' + Math.random().toString(36).substr(2, 9),
    _previousActiveElement: null,
    _focusTrapCleanup: null,

    // ARIA attributes for the modal
    get ariaAttrs() {
      return {
        'role': 'dialog',
        'aria-modal': 'true',
        'aria-labelledby': this.modalId + '-title',
        'aria-describedby': this.modalId + '-content'
      };
    },

    get titleId() {
      return this.modalId + '-title';
    },

    get contentId() {
      return this.modalId + '-content';
    },

    // Get all focusable elements within modal
    _getFocusableElements() {
      const modal = this.$refs.modal || this.$el.querySelector('.ux-modal');
      if (!modal) return [];
      const selector = 'button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])';
      return Array.from(modal.querySelectorAll(selector)).filter(el => el.offsetParent !== null);
    },

    open() {
      // Store current focused element to restore on close
      this._previousActiveElement = document.activeElement;
      this.isOpen = true;

      // Use global scroll lock (supports nested modals)
      if (window.UX && window.UX.lockScroll) {
        window.UX.lockScroll();
      } else {
        document.body.style.overflow = 'hidden';
      }

      // Setup focus trap and focus first element
      this.$nextTick(() => {
        const modal = this.$refs.modal || this.$el.querySelector('.ux-modal');
        if (modal && window.UX && window.UX.trapFocus) {
          this._focusTrapCleanup = window.UX.trapFocus(modal);
        } else {
          // Fallback: focus first focusable element
          const focusable = this._getFocusableElements();
          if (focusable.length > 0) {
            focusable[0].focus();
          }
        }

        // Announce modal opened for screen readers
        if (window.UX && window.UX.announce) {
          const title = this.$el.querySelector('[id$="-title"]');
          if (title) {
            window.UX.announce(title.textContent + ' dialog opened', 'assertive');
          }
        }
      });
    },

    close() {
      this.isOpen = false;

      // Cleanup focus trap
      if (this._focusTrapCleanup) {
        this._focusTrapCleanup();
        this._focusTrapCleanup = null;
      }

      // Use global scroll unlock
      if (window.UX && window.UX.unlockScroll) {
        window.UX.unlockScroll();
      } else {
        document.body.style.overflow = '';
      }

      // Restore focus to previous element
      if (this._previousActiveElement && this._previousActiveElement.focus) {
        this._previousActiveElement.focus();
      }
    },

    toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    },

    handleBackdropClick(event) {
      if (this.closeOnBackdrop && event.target === event.currentTarget) {
        this.close();
      }
    },

    handleKeydown(event) {
      if (this.closeOnEscape && event.key === 'Escape') {
        this.close();
        return;
      }

      // Focus trap: Tab key cycles within modal (fallback if UX.trapFocus not used)
      if (event.key === 'Tab' && !this._focusTrapCleanup) {
        const focusable = this._getFocusableElements();
        if (focusable.length === 0) return;

        const firstElement = focusable[0];
        const lastElement = focusable[focusable.length - 1];

        if (event.shiftKey) {
          // Shift+Tab: if on first element, go to last
          if (document.activeElement === firstElement) {
            event.preventDefault();
            lastElement.focus();
          }
        } else {
          // Tab: if on last element, go to first
          if (document.activeElement === lastElement) {
            event.preventDefault();
            firstElement.focus();
          }
        }
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxModal', modalComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxModal', modalComponent);
    });
  }
})();

/**
 * UX Navbar Component
 * Barra de navegaciÃ³n estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Navbar
    ======================================== */

    .ux-navbar {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 56px;
      padding: 0 var(--ux-space-sm);
      background-color: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      z-index: var(--ux-z-base);
    }

    /* Safe area support */
    .ux-navbar--safe-area {
      padding-top: env(safe-area-inset-top);
    }

    /* ========================================
       Navbar Variants
    ======================================== */

    /* Translucent (iOS style - uses Liquid Glass variables) */
    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-navbar--translucent {
      background-color: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    /* Glass (iOS 26 Liquid Glass style) */
    /* Note: backdrop-filter comes from universal selector [class*="--glass"] in ux-core.js */
    .ux-navbar--glass {
      box-shadow: var(--ux-glass-highlight);
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    /* Fallback for browsers without backdrop-filter (translucent only - glass handled by core) */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-navbar--translucent {
        background-color: var(--ux-surface);
      }
    }

    /* Transparent */
    .ux-navbar--transparent {
      background-color: transparent;
      border-bottom: none;
    }

    /* Colored */
    .ux-navbar--primary {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    .ux-navbar--primary .ux-navbar__title,
    .ux-navbar--primary .ux-navbar__button {
      color: var(--ux-primary-contrast);
    }

    .ux-navbar--dark {
      background-color: var(--ux-dark);
      color: var(--ux-dark-contrast);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    .ux-navbar--dark .ux-navbar__title,
    .ux-navbar--dark .ux-navbar__button {
      color: var(--ux-dark-contrast);
    }

    /* ========================================
       Navbar Content Wrapper
    ======================================== */

    .ux-navbar__content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      min-height: inherit;
      position: relative;
    }

    /* ========================================
       Navbar Slots (3-slot layout like Ionic)
    ======================================== */

    .ux-navbar__start {
      display: flex;
      align-items: center;
      flex-shrink: 0;
      min-width: 60px;
      z-index: 1;
    }

    .ux-navbar__center {
      position: absolute;
      left: var(--ux-touch-target);
      right: var(--ux-touch-target);
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      max-width: calc(100% - var(--ux-touch-target) * 2 - var(--ux-space-md) * 2);
      margin: 0 auto;
    }

    .ux-navbar__center > * {
      pointer-events: auto;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }

    .ux-navbar__end {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      flex-shrink: 0;
      min-width: 60px;
      z-index: 1;
    }

    /* Empty slots still take space */
    .ux-navbar__start:empty,
    .ux-navbar__end:empty {
      min-width: 60px;
    }

    /* Alternative layout (no absolute center, title left-aligned) */
    .ux-navbar--stacked .ux-navbar__center {
      position: static;
      flex: 1;
      justify-content: flex-start;
      padding: 0 var(--ux-space-md);
      pointer-events: auto;
    }

    /* ========================================
       Navbar Title
    ======================================== */

    .ux-navbar__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin: 0;
    }

    .ux-navbar__title--large {
      font-size: var(--ux-font-size-2xl);
    }

    .ux-navbar__subtitle {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      margin-top: 2px;
    }

    /* ========================================
       Navbar Buttons
    ======================================== */

    .ux-navbar__button {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: var(--ux-touch-target);
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-sm);
      background: none;
      border: none;
      color: var(--ux-primary);
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      border-radius: var(--ux-border-radius);
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-navbar__button:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-navbar__button:active {
      opacity: 0.7;
    }

    .ux-navbar__button--icon {
      padding: var(--ux-space-xs);
    }

    .ux-navbar__button-icon {
      width: 24px;
      height: 24px;
    }

    .ux-navbar__button-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-navbar__button-text {
      padding: 0 var(--ux-space-xs);
    }

    /* Back button */
    .ux-navbar__back {
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .ux-navbar__back-icon {
      width: 24px;
      height: 24px;
    }

    .ux-navbar__back-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-navbar__back-text {
      font-size: var(--ux-font-size-md);
    }

    /* ========================================
       Large Title (iOS style)
    ======================================== */

    .ux-navbar--large-title {
      flex-direction: column;
      align-items: stretch;
      min-height: auto;
    }

    .ux-navbar--large-title .ux-navbar__row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 44px;
      padding: var(--ux-space-sm);
    }

    .ux-navbar--large-title .ux-navbar__large-title {
      padding: 0 var(--ux-space-lg) var(--ux-space-md);
    }

    .ux-navbar__large-title h1 {
      font-size: 34px;
      font-weight: 700;
      color: var(--ux-text);
      margin: 0;
      line-height: 1.2;
    }

    /* Collapsible large title */
    .ux-navbar--collapsible .ux-navbar__large-title {
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease),
        height var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-navbar--collapsed .ux-navbar__large-title {
      opacity: 0;
      height: 0;
      padding: 0;
      overflow: hidden;
    }

    .ux-navbar--collapsed .ux-navbar__center {
      opacity: 1;
    }

    .ux-navbar--collapsible .ux-navbar__center {
      opacity: 0;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
    }

    /* ========================================
       Searchbar in Navbar
    ======================================== */

    .ux-navbar__searchbar {
      padding: 0 var(--ux-space-md) var(--ux-space-sm);
    }

    .ux-navbar--large-title .ux-navbar__searchbar {
      padding-top: 0;
    }

    /* ========================================
       Navbar Progress
    ======================================== */

    .ux-navbar__progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--ux-light);
    }

    .ux-navbar__progress-bar {
      height: 100%;
      background-color: var(--ux-primary);
      transition: width var(--ux-transition-base) var(--ux-ease);
    }

    /* ========================================
       Navbar with Tabs
    ======================================== */

    .ux-navbar__tabs {
      display: flex;
      padding: 0 var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Fixed/Sticky Navbar
       Glass effect by default (iOS style)
    ======================================== */

    .ux-navbar--fixed {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: var(--ux-z-fixed);
      /* Glass by default */
      background-color: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    .ux-navbar--sticky {
      position: sticky;
      top: 0;
      z-index: var(--ux-z-sticky);
      /* Glass by default */
      background-color: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-navbar--fixed,
      .ux-navbar--sticky {
        background-color: var(--ux-surface);
      }
    }

    /* ========================================
       Navbar Shadow (on scroll)
    ======================================== */

    .ux-navbar--shadow {
      box-shadow: var(--ux-shadow-sm);
      border-bottom-color: transparent;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-navbar--sm {
      min-height: 44px;
    }

    .ux-navbar--sm .ux-navbar__title {
      font-size: var(--ux-font-size-md);
    }

    .ux-navbar--lg {
      min-height: 64px;
    }

    .ux-navbar--lg .ux-navbar__title {
      font-size: var(--ux-font-size-xl);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-navbar__button {
        transition: none;
      }

      .ux-navbar--collapsible .ux-navbar__large-title {
        transition: none;
      }

      .ux-navbar--collapsible .ux-navbar__center {
        transition: none;
      }

      .ux-navbar__progress-bar {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-navbar-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-navbar-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for collapsible navbar
  const navbarComponent = (config = {}) => ({
    collapsed: false,
    showShadow: false,
    scrollThreshold: config.scrollThreshold || 100,

    handleScroll(scrollTop) {
      this.collapsed = scrollTop > this.scrollThreshold;
      this.showShadow = scrollTop > 0;
    },

    goBack() {
      window.history.back();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxNavbar', navbarComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxNavbar', navbarComponent);
    });
  }
})();

/**
 * UX Notification Center Component
 * Panel for managing and displaying notifications
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Notification Center Trigger
       ========================================================================== */

    .ux-notification-trigger {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-touch-target);
      height: var(--ux-touch-target);
      background: transparent;
      border: none;
      border-radius: var(--ux-radius-full);
      color: var(--ux-text);
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-notification-trigger:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-notification-trigger svg {
      width: 24px;
      height: 24px;
    }

    .ux-notification-trigger__badge {
      position: absolute;
      top: 4px;
      right: 4px;
      min-width: 18px;
      height: 18px;
      padding: 0 5px;
      font-size: 0.6875rem;
      font-weight: 600;
      color: white;
      background: var(--ux-danger);
      border-radius: 9px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--ux-background);
    }

    .ux-notification-trigger__badge--dot {
      min-width: 10px;
      width: 10px;
      height: 10px;
      padding: 0;
    }

    /* ==========================================================================
       Notification Panel
       ========================================================================== */

    .ux-notification-panel {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      max-width: 400px;
      z-index: var(--ux-z-modal);
      background: var(--ux-surface);
      box-shadow: var(--ux-shadow-2xl);
      transform: translateX(100%);
      opacity: 0;
      visibility: hidden;
      transition: all var(--ux-transition-normal) var(--ux-ease-out);
      display: flex;
      flex-direction: column;
    }

    .ux-notification-panel--open {
      transform: translateX(0);
      opacity: 1;
      visibility: visible;
    }

    .ux-notification-panel__backdrop {
      position: fixed;
      inset: 0;
      z-index: calc(var(--ux-z-modal) - 1);
      background: rgba(0, 0, 0, 0.3);
      opacity: 0;
      visibility: hidden;
      transition: all var(--ux-transition-fast);
    }

    .ux-notification-panel__backdrop--open {
      opacity: 1;
      visibility: visible;
    }

    /* ==========================================================================
       Panel Header
       ========================================================================== */

    .ux-notification-panel__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md) var(--ux-space-lg);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-notification-panel__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-notification-panel__actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-notification-panel__action {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: transparent;
      border: none;
      border-radius: var(--ux-radius-md);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-notification-panel__action:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-notification-panel__action svg {
      width: 20px;
      height: 20px;
    }

    /* ==========================================================================
       Panel Filters
       ========================================================================== */

    .ux-notification-panel__filters {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-lg);
      border-bottom: 1px solid var(--ux-border-color);
      overflow-x: auto;
      flex-shrink: 0;
    }

    .ux-notification-panel__filter {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: var(--ux-space-xs) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
      background: var(--ux-surface-secondary);
      border: none;
      border-radius: var(--ux-radius-full);
      cursor: pointer;
      white-space: nowrap;
      transition: all var(--ux-transition-fast);
    }

    .ux-notification-panel__filter:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-notification-panel__filter--active {
      background: var(--ux-primary);
      color: white;
    }

    .ux-notification-panel__filter-count {
      min-width: 18px;
      height: 18px;
      padding: 0 4px;
      font-size: 0.6875rem;
      font-weight: 600;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 9px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ux-notification-panel__filter--active .ux-notification-panel__filter-count {
      background: rgba(255, 255, 255, 0.2);
    }

    /* ==========================================================================
       Panel Content
       ========================================================================== */

    .ux-notification-panel__content {
      flex: 1;
      overflow-y: auto;
      overscroll-behavior: contain;
    }

    .ux-notification-panel__list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .ux-notification-panel__group {
      padding: var(--ux-space-xs) var(--ux-space-lg);
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--ux-text-tertiary);
      background: var(--ux-surface-secondary);
    }

    /* ==========================================================================
       Notification Item
       ========================================================================== */

    .ux-notification-item {
      display: flex;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md) var(--ux-space-lg);
      border-bottom: 1px solid var(--ux-border-color);
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-notification-item:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-notification-item--unread {
      background: var(--ux-primary-tint);
    }

    .ux-notification-item--unread:hover {
      background: rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-notification-item__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      flex-shrink: 0;
      border-radius: var(--ux-radius-full);
      background: var(--ux-surface-tertiary);
      color: var(--ux-text-secondary);
    }

    .ux-notification-item__icon svg {
      width: 20px;
      height: 20px;
    }

    .ux-notification-item__icon--info { background: var(--ux-primary-tint); color: var(--ux-primary); }
    .ux-notification-item__icon--success { background: var(--ux-success-tint); color: var(--ux-success); }
    .ux-notification-item__icon--warning { background: var(--ux-warning-tint); color: var(--ux-warning); }
    .ux-notification-item__icon--error { background: var(--ux-danger-tint); color: var(--ux-danger); }

    .ux-notification-item__content {
      flex: 1;
      min-width: 0;
    }

    .ux-notification-item__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--ux-space-sm);
      margin-bottom: 2px;
    }

    .ux-notification-item__title {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
      line-height: 1.3;
    }

    .ux-notification-item--unread .ux-notification-item__title {
      font-weight: 600;
    }

    .ux-notification-item__time {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      white-space: nowrap;
      flex-shrink: 0;
    }

    .ux-notification-item__message {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .ux-notification-item__actions {
      display: flex;
      gap: var(--ux-space-sm);
      margin-top: var(--ux-space-sm);
    }

    .ux-notification-item__action-btn {
      padding: var(--ux-space-xs) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-primary);
      background: transparent;
      border: 1px solid var(--ux-primary);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-notification-item__action-btn:hover {
      background: var(--ux-primary);
      color: white;
    }

    .ux-notification-item__action-btn--primary {
      background: var(--ux-primary);
      color: white;
      border-color: var(--ux-primary);
    }

    .ux-notification-item__action-btn--primary:hover {
      background: var(--ux-primary-shade);
    }

    /* Indicator dot for unread */
    .ux-notification-item__dot {
      width: 8px;
      height: 8px;
      flex-shrink: 0;
      background: var(--ux-primary);
      border-radius: 50%;
      margin-top: 6px;
    }

    /* ==========================================================================
       Empty State
       ========================================================================== */

    .ux-notification-panel__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-3xl);
      text-align: center;
    }

    .ux-notification-panel__empty-icon {
      width: 64px;
      height: 64px;
      margin-bottom: var(--ux-space-lg);
      color: var(--ux-text-tertiary);
      opacity: 0.5;
    }

    .ux-notification-panel__empty-title {
      font-size: var(--ux-font-size-lg);
      font-weight: 500;
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-notification-panel__empty-description {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       Panel Footer
       ========================================================================== */

    .ux-notification-panel__footer {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-md) var(--ux-space-lg);
      border-top: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-notification-panel__footer-link {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-primary);
      text-decoration: none;
      cursor: pointer;
    }

    .ux-notification-panel__footer-link:hover {
      text-decoration: underline;
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-notification-panel--glass {
      background: var(--ux-glass-bg-thick);
      backdrop-filter: blur(var(--ux-glass-blur-heavy));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy));
      border-left: 1px solid var(--ux-glass-border);
    }

    .ux-notification-panel--glass .ux-notification-panel__header,
    .ux-notification-panel--glass .ux-notification-panel__filters,
    .ux-notification-panel--glass .ux-notification-panel__footer {
      border-color: var(--ux-glass-border);
    }

    .ux-notification-panel--glass .ux-notification-item {
      border-color: var(--ux-glass-border);
    }

    /* ==========================================================================
       Dropdown Variant (instead of panel)
       ========================================================================== */

    .ux-notification-dropdown {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      width: 380px;
      max-height: 480px;
      z-index: var(--ux-z-dropdown);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-xl);
      box-shadow: var(--ux-shadow-xl);
      overflow: hidden;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all var(--ux-transition-fast) var(--ux-ease-out);
    }

    .ux-notification-dropdown--open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-notification-dropdown .ux-notification-panel__content {
      max-height: 360px;
    }

    /* ==========================================================================
       Mobile Adjustments
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-notification-panel {
        max-width: none;
      }

      .ux-notification-panel__header {
        padding-top: calc(var(--ux-safe-top) + var(--ux-space-md));
      }

      .ux-notification-panel__footer {
        padding-bottom: calc(var(--ux-safe-bottom) + var(--ux-space-md));
      }

      .ux-notification-dropdown {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        max-height: 70dvh;
        border-radius: var(--ux-radius-xl) var(--ux-radius-xl) 0 0;
        transform: translateY(100%);
      }

      .ux-notification-dropdown--open {
        transform: translateY(0);
      }

      .ux-notification-dropdown .ux-notification-panel__content {
        max-height: calc(70dvh - 120px);
      }
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      .ux-notification-panel__backdrop {
        background: rgba(0, 0, 0, 0.5);
      }
    }

    .ux-dark .ux-notification-panel__backdrop {
      background: rgba(0, 0, 0, 0.5);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-notification-panel,
      .ux-notification-panel__backdrop,
      .ux-notification-dropdown,
      .ux-notification-item {
        transition: none;
      }
    }
  `;

  // Icons
  const icons = {
    bell: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>`,
    close: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,
    check: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`,
    checkAll: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L7 17l-5-5"/><path d="M22 10l-9.5 9.5-2-2"/></svg>`,
    settings: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>`,
    trash: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`,
    info: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>`,
    success: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
    warning: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`,
    error: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`,
    empty: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/><line x1="1" y1="1" x2="23" y2="23"/></svg>`
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-notifications-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-notifications-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const notificationCenterData = (options = {}) => ({
    // Configuration
    notifications: options.notifications || [],
    filters: options.filters || ['all', 'unread'],
    filterLabels: options.filterLabels || {
      all: 'Todas',
      unread: 'No leidas',
      info: 'Info',
      success: 'Exito',
      warning: 'Avisos',
      error: 'Errores'
    },
    showFilters: options.showFilters ?? true,
    showFooter: options.showFooter ?? true,
    groupByDate: options.groupByDate ?? true,
    maxVisible: options.maxVisible ?? 50,
    variant: options.variant || 'panel', // 'panel' or 'dropdown'

    // State
    isOpen: false,
    activeFilter: 'all',

    // Icons
    icons: icons,

    // Lifecycle
    init() {
      // Close on escape
      this._escHandler = (e) => {
        if (e.key === 'Escape' && this.isOpen) {
          this.close();
        }
      };
      document.addEventListener('keydown', this._escHandler);
    },

    destroy() {
      if (this._escHandler) {
        document.removeEventListener('keydown', this._escHandler);
      }
    },

    // Open panel
    open() {
      this.isOpen = true;

      if (this.variant === 'panel' && window.UX && window.UX.lockScroll) {
        window.UX.lockScroll();
      }

      this.$dispatch('notifications:open');
    },

    // Close panel
    close() {
      this.isOpen = false;

      if (this.variant === 'panel' && window.UX && window.UX.unlockScroll) {
        window.UX.unlockScroll();
      }

      this.$dispatch('notifications:close');
    },

    // Toggle panel
    toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    },

    // Get filtered notifications
    get filteredNotifications() {
      let filtered = [...this.notifications];

      // Apply filter
      if (this.activeFilter !== 'all') {
        if (this.activeFilter === 'unread') {
          filtered = filtered.filter(n => !n.read);
        } else {
          filtered = filtered.filter(n => n.type === this.activeFilter);
        }
      }

      // Limit
      filtered = filtered.slice(0, this.maxVisible);

      // Group by date if enabled
      if (this.groupByDate) {
        return this.groupNotificationsByDate(filtered);
      }

      return [{ group: null, items: filtered }];
    },

    // Group notifications by date
    groupNotificationsByDate(notifications) {
      const groups = {};
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);

      notifications.forEach(notification => {
        const date = new Date(notification.timestamp);
        const notifDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());

        let groupKey;
        if (notifDate.getTime() === today.getTime()) {
          groupKey = 'Hoy';
        } else if (notifDate.getTime() === yesterday.getTime()) {
          groupKey = 'Ayer';
        } else {
          groupKey = date.toLocaleDateString('es-ES', { month: 'long', day: 'numeric' });
        }

        if (!groups[groupKey]) {
          groups[groupKey] = [];
        }
        groups[groupKey].push(notification);
      });

      return Object.entries(groups).map(([group, items]) => ({ group, items }));
    },

    // Count unread notifications
    get unreadCount() {
      return this.notifications.filter(n => !n.read).length;
    },

    // Count by filter
    getFilterCount(filter) {
      if (filter === 'all') return this.notifications.length;
      if (filter === 'unread') return this.unreadCount;
      return this.notifications.filter(n => n.type === filter).length;
    },

    // Mark notification as read
    markAsRead(notificationId) {
      const notification = this.notifications.find(n => n.id === notificationId);
      if (notification) {
        notification.read = true;
        this.$dispatch('notification:read', { notification });
      }
    },

    // Mark all as read
    markAllAsRead() {
      this.notifications.forEach(n => n.read = true);
      this.$dispatch('notifications:all-read');
    },

    // Delete notification
    deleteNotification(notificationId) {
      const index = this.notifications.findIndex(n => n.id === notificationId);
      if (index !== -1) {
        const notification = this.notifications[index];
        this.notifications.splice(index, 1);
        this.$dispatch('notification:delete', { notification });
      }
    },

    // Clear all notifications
    clearAll() {
      this.notifications = [];
      this.$dispatch('notifications:clear');
    },

    // Add new notification
    addNotification(notification) {
      const newNotif = {
        id: notification.id || Date.now().toString(),
        title: notification.title,
        message: notification.message,
        type: notification.type || 'info',
        timestamp: notification.timestamp || new Date().toISOString(),
        read: notification.read ?? false,
        actions: notification.actions || [],
        data: notification.data || {}
      };

      this.notifications.unshift(newNotif);
      this.$dispatch('notification:add', { notification: newNotif });

      return newNotif;
    },

    // Handle notification click
    handleClick(notification) {
      if (!notification.read) {
        this.markAsRead(notification.id);
      }
      this.$dispatch('notification:click', { notification });
    },

    // Handle action click
    handleAction(notification, action) {
      this.$dispatch('notification:action', { notification, action });
      if (action.callback && typeof action.callback === 'function') {
        action.callback(notification);
      }
    },

    // Format relative time
    formatTime(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diff = now - date;

      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);

      if (minutes < 1) return 'Ahora';
      if (minutes < 60) return `${minutes}m`;
      if (hours < 24) return `${hours}h`;
      if (days < 7) return `${days}d`;

      return date.toLocaleDateString('es-ES', { month: 'short', day: 'numeric' });
    },

    // Get icon by type
    getTypeIcon(type) {
      switch (type) {
        case 'success': return this.icons.success;
        case 'warning': return this.icons.warning;
        case 'error': return this.icons.error;
        default: return this.icons.info;
      }
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxNotificationCenter', notificationCenterData);
  }

  // Expose icons for external use
  window.UX = window.UX || {};
  window.UX.notificationIcons = icons;
})();

/**
 * UX Numpad Component
 * Numeric keypad for POS and calculator interfaces
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Numpad Container
    ======================================== */

    :root {
      --ux-numpad-key-size: 64px;
      --ux-numpad-key-size-sm: 52px;
      --ux-numpad-key-size-lg: 76px;
      --ux-numpad-gap: var(--ux-space-sm);
      --ux-numpad-border-radius: var(--ux-border-radius-lg);
      --ux-numpad-font-size: 1.5rem;
      --ux-numpad-font-size-sm: 1.25rem;
      --ux-numpad-font-size-lg: 1.75rem;
    }

    .ux-numpad {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
      background-color: var(--ux-surface);
      border-radius: var(--ux-numpad-border-radius);
      max-width: fit-content;
    }

    .ux-numpad--full-width {
      max-width: 100%;
    }

    .ux-numpad--compact {
      padding: var(--ux-space-sm);
      gap: var(--ux-space-sm);
    }

    /* ========================================
       Numpad Display
    ======================================== */

    .ux-numpad__display {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      min-height: 56px;
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      font-family: 'SF Mono', 'Menlo', 'Monaco', monospace;
      font-size: 2rem;
      font-weight: 600;
      color: var(--ux-text);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-numpad__display--lg {
      min-height: 72px;
      font-size: 2.5rem;
    }

    .ux-numpad__display--sm {
      min-height: 44px;
      font-size: 1.5rem;
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    .ux-numpad__display-label {
      font-size: var(--ux-font-size-sm);
      font-weight: 400;
      color: var(--ux-text-secondary);
      margin-right: auto;
      font-family: inherit;
    }

    .ux-numpad__display-value {
      font-variant-numeric: tabular-nums;
    }

    .ux-numpad__display-currency {
      font-size: 0.75em;
      color: var(--ux-text-secondary);
      margin-right: var(--ux-space-xs);
    }

    /* ========================================
       Numpad Grid
    ======================================== */

    .ux-numpad__grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--ux-numpad-gap);
    }

    .ux-numpad__grid--4cols {
      grid-template-columns: repeat(4, 1fr);
    }

    /* ========================================
       Numpad Keys
    ======================================== */

    .ux-numpad__key {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: var(--ux-numpad-key-size);
      min-height: var(--ux-numpad-key-size);
      padding: var(--ux-space-sm);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      font-size: var(--ux-numpad-font-size);
      font-weight: 500;
      color: var(--ux-text);
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform 100ms var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-numpad__key:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-numpad__key:active {
      transform: scale(0.95);
      background-color: var(--ux-surface-tertiary);
    }

    .ux-numpad__key:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    /* Key Sizes */
    .ux-numpad--sm .ux-numpad__key {
      min-width: var(--ux-numpad-key-size-sm);
      min-height: var(--ux-numpad-key-size-sm);
      font-size: var(--ux-numpad-font-size-sm);
    }

    .ux-numpad--lg .ux-numpad__key {
      min-width: var(--ux-numpad-key-size-lg);
      min-height: var(--ux-numpad-key-size-lg);
      font-size: var(--ux-numpad-font-size-lg);
    }

    /* Key spanning 2 columns (e.g., 0 key) */
    .ux-numpad__key--wide {
      grid-column: span 2;
    }

    /* Key spanning 2 rows */
    .ux-numpad__key--tall {
      grid-row: span 2;
    }

    /* Action keys (backspace, clear, etc.) */
    .ux-numpad__key--action {
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text-secondary);
    }

    .ux-numpad__key--action:hover {
      background-color: var(--ux-surface-tertiary);
    }

    /* Primary action key (enter, confirm) */
    .ux-numpad__key--primary {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-numpad__key--primary:hover {
      background-color: var(--ux-primary-shade);
    }

    .ux-numpad__key--primary:active {
      background-color: var(--ux-primary-shade);
    }

    /* Success key */
    .ux-numpad__key--success {
      background-color: var(--ux-success);
      border-color: var(--ux-success);
      color: white;
    }

    .ux-numpad__key--success:hover {
      background-color: var(--ux-success-shade, #34c759);
    }

    /* Danger key (clear all, delete) */
    .ux-numpad__key--danger {
      background-color: transparent;
      border-color: var(--ux-danger);
      color: var(--ux-danger);
    }

    .ux-numpad__key--danger:hover {
      background-color: rgba(var(--ux-danger-rgb, 255, 59, 48), 0.1);
    }

    /* Disabled key */
    .ux-numpad__key:disabled,
    .ux-numpad__key--disabled {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Key icons */
    .ux-numpad__key svg {
      width: 24px;
      height: 24px;
    }

    .ux-numpad--sm .ux-numpad__key svg {
      width: 20px;
      height: 20px;
    }

    .ux-numpad--lg .ux-numpad__key svg {
      width: 28px;
      height: 28px;
    }

    /* ========================================
       Quick Amount Buttons
    ======================================== */

    .ux-numpad__quick-amounts {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
    }

    .ux-numpad__quick-btn {
      flex: 1;
      min-width: 60px;
      padding: var(--ux-space-sm) var(--ux-space-md);
      background-color: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform 100ms var(--ux-ease);
    }

    .ux-numpad__quick-btn:hover {
      background-color: var(--ux-surface-tertiary);
    }

    .ux-numpad__quick-btn:active {
      transform: scale(0.97);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-numpad--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-numpad--glass .ux-numpad__display {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    .ux-numpad--glass .ux-numpad__key {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    .ux-numpad--glass .ux-numpad__key:hover {
      background: var(--ux-glass-bg);
    }

    .ux-numpad--glass .ux-numpad__key--action {
      background: var(--ux-glass-bg);
    }

    /* ========================================
       Calculator Layout
    ======================================== */

    .ux-numpad--calculator .ux-numpad__grid {
      grid-template-columns: repeat(4, 1fr);
    }

    .ux-numpad--calculator .ux-numpad__key--operator {
      background-color: var(--ux-warning);
      border-color: var(--ux-warning);
      color: white;
    }

    .ux-numpad--calculator .ux-numpad__key--operator:hover {
      background-color: var(--ux-warning-shade, #ff9500);
    }

    /* ========================================
       PIN Entry Layout
    ======================================== */

    .ux-numpad--pin {
      max-width: 280px;
    }

    .ux-numpad--pin .ux-numpad__display {
      letter-spacing: 1rem;
      text-align: center;
      justify-content: center;
    }

    .ux-numpad__pin-dots {
      display: flex;
      justify-content: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
    }

    .ux-numpad__pin-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background-color: var(--ux-border-color);
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-numpad__pin-dot--filled {
      background-color: var(--ux-primary);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-numpad {
        width: 100%;
        max-width: 100%;
      }

      .ux-numpad__key {
        min-width: 0;
        min-height: 56px;
      }

      .ux-numpad__display {
        font-size: 1.75rem;
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-numpad__key {
        border-color: var(--ux-border-color);
      }
    }

    .ux-dark .ux-numpad__key {
      border-color: var(--ux-border-color);
    }

    /* ========================================
       PIN Pad Component
    ======================================== */

    :root {
      --ux-pinpad-dot-size: 18px;
      --ux-pinpad-key-size: 68px;
      --ux-pinpad-key-size-sm: 56px;
      --ux-pinpad-key-size-lg: 80px;
    }

    .ux-pinpad {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-lg);
      padding: var(--ux-space-lg);
    }

    .ux-pinpad__label {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    /* PIN Dots */
    .ux-pinpad__dots {
      display: flex;
      gap: var(--ux-space-md);
    }

    .ux-pinpad__dot {
      width: var(--ux-pinpad-dot-size);
      height: var(--ux-pinpad-dot-size);
      border-radius: 50%;
      border: 2px solid var(--ux-border-color);
      background: transparent;
      transition: all 0.2s ease;
    }

    .ux-pinpad__dot--filled {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
      transform: scale(1.15);
      box-shadow: 0 0 12px var(--ux-primary);
    }

    .ux-pinpad__dot--error {
      background: var(--ux-danger);
      border-color: var(--ux-danger);
      box-shadow: 0 0 12px var(--ux-danger);
      animation: ux-pinpad-shake 0.5s ease;
    }

    .ux-pinpad__dot--success {
      background: var(--ux-success);
      border-color: var(--ux-success);
      box-shadow: 0 0 12px var(--ux-success);
    }

    @keyframes ux-pinpad-shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
    }

    /* PIN Pad Grid */
    .ux-pinpad__grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--ux-space-sm);
      max-width: 260px;
    }

    /* PIN Pad Keys */
    .ux-pinpad__key {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-pinpad-key-size);
      height: var(--ux-pinpad-key-size);
      font-size: 1.5rem;
      font-weight: 500;
      color: var(--ux-text);
      background: transparent;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform 100ms var(--ux-ease);
    }

    .ux-pinpad__key:hover {
      background: rgba(var(--ux-text-rgb, 0, 0, 0), 0.05);
    }

    .ux-pinpad__key:active {
      transform: scale(0.92);
      background: rgba(var(--ux-text-rgb, 0, 0, 0), 0.1);
    }

    .ux-pinpad__key:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    .ux-pinpad__key:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
    }

    .ux-pinpad__key--hidden {
      visibility: hidden;
      pointer-events: none;
    }

    .ux-pinpad__key svg {
      width: 24px;
      height: 24px;
    }

    /* Glass Variant */
    .ux-pinpad--glass .ux-pinpad__key {
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .ux-pinpad--glass .ux-pinpad__key:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .ux-pinpad--glass .ux-pinpad__key:active {
      background: rgba(255, 255, 255, 0.25);
    }

    /* Size Variants */
    .ux-pinpad--sm .ux-pinpad__key {
      width: var(--ux-pinpad-key-size-sm);
      height: var(--ux-pinpad-key-size-sm);
      font-size: 1.25rem;
    }

    .ux-pinpad--sm .ux-pinpad__dot {
      width: 14px;
      height: 14px;
    }

    .ux-pinpad--lg .ux-pinpad__key {
      width: var(--ux-pinpad-key-size-lg);
      height: var(--ux-pinpad-key-size-lg);
      font-size: 1.75rem;
    }

    .ux-pinpad--lg .ux-pinpad__dot {
      width: 22px;
      height: 22px;
    }

    /* Loading State */
    .ux-pinpad__loading {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* Hint */
    .ux-pinpad__hint {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      margin: 0;
    }

    /* Error Message */
    .ux-pinpad__error {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-danger);
      margin: 0;
    }

    /* Dark Mode Glass */
    @media (prefers-color-scheme: dark) {
      .ux-pinpad--glass .ux-pinpad__key {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.1);
      }

      .ux-pinpad--glass .ux-pinpad__key:hover {
        background: rgba(255, 255, 255, 0.1);
      }
    }

    .ux-dark .ux-pinpad--glass .ux-pinpad__key {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .ux-dark .ux-pinpad--glass .ux-pinpad__key:hover {
      background: rgba(255, 255, 255, 0.1);
    }
  `;

  // Icons
  const icons = {
    backspace: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 002-2V6a2 2 0 00-2-2z"/><line x1="18" y1="9" x2="12" y2="15"/><line x1="12" y1="9" x2="18" y2="15"/></svg>',
    clear: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></svg>',
    enter: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 10 4 15 9 20"/><path d="M20 4v7a4 4 0 01-4 4H4"/></svg>',
    check: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',
    plus: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>',
    minus: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg>',
    multiply: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',
    divide: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="6" r="1" fill="currentColor"/><line x1="5" y1="12" x2="19" y2="12"/><circle cx="12" cy="18" r="1" fill="currentColor"/></svg>',
    equals: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/></svg>',
    percent: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="5" x2="5" y2="19"/><circle cx="6.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="17.5" r="2.5"/></svg>'
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-numpad-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-numpad-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for numpad
  const numpadComponent = (config = {}) => ({
    // Value
    value: config.initialValue || '',
    displayValue: '',

    // Configuration
    maxLength: config.maxLength || 12,
    decimals: config.decimals ?? 2,
    allowNegative: config.allowNegative || false,
    allowDecimal: config.allowDecimal !== false,
    currency: config.currency || '',
    currencyPosition: config.currencyPosition || 'prefix',

    // PIN mode
    pinMode: config.pinMode || false,
    pinLength: config.pinLength || 4,
    pinMask: config.pinMask !== false,

    // Quick amounts
    quickAmounts: config.quickAmounts || [],

    // Layout
    layout: config.layout || 'standard', // standard, calculator, phone

    // Labels
    labels: {
      clear: config.labels?.clear || 'C',
      backspace: config.labels?.backspace || 'â«',
      enter: config.labels?.enter || 'Enter',
      decimal: config.labels?.decimal || '.',
      negative: config.labels?.negative || 'Â±',
      ...config.labels
    },

    // State
    hasDecimal: false,
    isNegative: false,

    // Initialize
    init() {
      this.updateDisplay();

      // Keyboard support
      this._keyHandler = (e) => {
        if (!this.$el.contains(document.activeElement) && document.activeElement !== document.body) return;

        if (e.key >= '0' && e.key <= '9') {
          this.appendDigit(e.key);
        } else if (e.key === '.' || e.key === ',') {
          this.appendDecimal();
        } else if (e.key === 'Backspace') {
          this.backspace();
        } else if (e.key === 'Delete' || e.key === 'Escape') {
          this.clear();
        } else if (e.key === 'Enter') {
          this.submit();
        } else if (e.key === '-' && this.allowNegative) {
          this.toggleNegative();
        }
      };

      document.addEventListener('keydown', this._keyHandler);
    },

    destroy() {
      if (this._keyHandler) {
        document.removeEventListener('keydown', this._keyHandler);
      }
    },

    // Append a digit
    appendDigit(digit) {
      // Check max length
      const cleanValue = this.value.replace(/[^0-9]/g, '');
      if (cleanValue.length >= this.maxLength) return;

      // PIN mode length check
      if (this.pinMode && this.value.length >= this.pinLength) return;

      // Prevent leading zeros (except for decimals)
      if (this.value === '0' && digit === '0' && !this.hasDecimal) return;
      if (this.value === '0' && digit !== '0' && !this.hasDecimal) {
        this.value = '';
      }

      this.value += digit;
      this.updateDisplay();
      this.emitChange();

      // Auto-submit for PIN mode
      if (this.pinMode && this.value.length === this.pinLength) {
        this.$nextTick(() => this.submit());
      }
    },

    // Append decimal point
    appendDecimal() {
      if (!this.allowDecimal || this.hasDecimal || this.pinMode) return;

      if (this.value === '') {
        this.value = '0';
      }

      this.value += '.';
      this.hasDecimal = true;
      this.updateDisplay();
      this.emitChange();
    },

    // Backspace (delete last character)
    backspace() {
      if (this.value.length === 0) return;

      const lastChar = this.value.slice(-1);
      if (lastChar === '.') {
        this.hasDecimal = false;
      }

      this.value = this.value.slice(0, -1);
      this.updateDisplay();
      this.emitChange();
    },

    // Clear all
    clear() {
      this.value = '';
      this.hasDecimal = false;
      this.isNegative = false;
      this.updateDisplay();
      this.emitChange();
    },

    // Toggle negative
    toggleNegative() {
      if (!this.allowNegative) return;

      this.isNegative = !this.isNegative;
      this.updateDisplay();
      this.emitChange();
    },

    // Set quick amount
    setQuickAmount(amount) {
      this.value = String(amount);
      this.hasDecimal = this.value.includes('.');
      this.updateDisplay();
      this.emitChange();
    },

    // Update display value
    updateDisplay() {
      if (this.pinMode && this.pinMask) {
        this.displayValue = 'â¢'.repeat(this.value.length);
      } else if (this.value === '') {
        this.displayValue = '0';
      } else {
        let display = this.value;

        // Format with thousand separators for display
        if (!this.pinMode && this.decimals >= 0) {
          const parts = display.split('.');
          parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
          display = parts.join('.');
        }

        if (this.isNegative && display !== '0' && display !== '') {
          display = '-' + display;
        }

        this.displayValue = display;
      }
    },

    // Get numeric value
    getNumericValue() {
      let num = parseFloat(this.value) || 0;
      if (this.isNegative) num = -num;
      return num;
    },

    // Submit value
    submit() {
      const numericValue = this.getNumericValue();
      this.$dispatch('numpad-submit', {
        value: this.value,
        numericValue: numericValue,
        displayValue: this.displayValue,
        isNegative: this.isNegative
      });
    },

    // Emit change event
    emitChange() {
      this.$dispatch('numpad-change', {
        value: this.value,
        numericValue: this.getNumericValue(),
        displayValue: this.displayValue
      });
    },

    // Get icon HTML
    getIcon(name) {
      return icons[name] || '';
    },

    // Get PIN dots
    getPinDots() {
      const dots = [];
      for (let i = 0; i < this.pinLength; i++) {
        dots.push(i < this.value.length);
      }
      return dots;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxNumpad', numpadComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxNumpad', numpadComponent);
    });
  }

  // Alpine component for PIN Pad
  const pinpadComponent = (config = {}) => ({
    // PIN value
    pin: '',

    // Configuration
    length: config.length || 4,
    label: config.label || 'Introduce tu PIN',
    hint: config.hint || '',
    loadingText: config.loadingText || 'Verificando...',

    // State
    loading: false,
    error: false,
    success: false,
    errorMessage: '',

    // Keys layout: 1-9, empty, 0, backspace
    keys: [1, 2, 3, 4, 5, 6, 7, 8, 9, '', 0, 'backspace'],

    // Initialize
    init() {
      // Keyboard support
      this._keyHandler = (e) => {
        if (this.loading) return;
        if (!this.$el.contains(document.activeElement) && document.activeElement !== document.body) return;

        if (e.key >= '0' && e.key <= '9') {
          e.preventDefault();
          this.handleKey(parseInt(e.key));
        } else if (e.key === 'Backspace') {
          e.preventDefault();
          this.handleKey('backspace');
        } else if (e.key === 'Delete' || e.key === 'Escape') {
          e.preventDefault();
          this.clear();
        }
      };

      document.addEventListener('keydown', this._keyHandler);
    },

    destroy() {
      if (this._keyHandler) {
        document.removeEventListener('keydown', this._keyHandler);
      }
    },

    // Handle key press
    handleKey(key) {
      if (this.loading) return;

      // Clear error state on new input
      if (this.error) {
        this.error = false;
        this.errorMessage = '';
      }

      if (key === 'backspace') {
        this.pin = this.pin.slice(0, -1);
        return;
      }

      if (key === '' || key === null || key === undefined) return;

      // Add digit if not at max length
      if (this.pin.length < this.length) {
        this.pin += String(key);

        // Auto-submit when PIN is complete
        if (this.pin.length === this.length) {
          this.$nextTick(() => this.submit());
        }
      }
    },

    // Clear PIN
    clear() {
      this.pin = '';
      this.error = false;
      this.success = false;
      this.errorMessage = '';
    },

    // Submit PIN
    submit() {
      this.$dispatch('pinpad-submit', {
        pin: this.pin
      });
    },

    // Set loading state (call from parent)
    setLoading(isLoading) {
      this.loading = isLoading;
    },

    // Set error state (call from parent)
    setError(message = 'PIN incorrecto') {
      this.error = true;
      this.errorMessage = message;
      this.pin = '';
      this.loading = false;

      // Auto-clear error after animation
      setTimeout(() => {
        this.error = false;
      }, 500);
    },

    // Set success state (call from parent)
    setSuccess() {
      this.success = true;
      this.loading = false;
    },

    // Check if dot should be filled
    isDotFilled(index) {
      return this.pin.length > index;
    },

    // Get dot class
    getDotClass(index) {
      if (this.error) return 'ux-pinpad__dot--error';
      if (this.success && this.isDotFilled(index)) return 'ux-pinpad__dot--success';
      if (this.isDotFilled(index)) return 'ux-pinpad__dot--filled';
      return '';
    },

    // Get backspace icon
    getBackspaceIcon() {
      return icons.backspace;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxPinpad', pinpadComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxPinpad', pinpadComponent);
    });
  }
})();

/**
 * UX Order Ticket Component
 * Kitchen display/POS order ticket for restaurant systems
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Order Ticket Variables
       ========================================================================== */

    :root {
      --ux-order-ticket-width: 320px;
      --ux-order-ticket-padding: var(--ux-space-md);
      --ux-order-ticket-border-radius: var(--ux-radius-lg, 12px);
      --ux-order-ticket-font-family: var(--ux-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);

      /* Status colors */
      --ux-order-ticket-pending: var(--ux-warning, #f59e0b);
      --ux-order-ticket-pending-bg: rgba(245, 158, 11, 0.1);
      --ux-order-ticket-preparing: var(--ux-primary, #3b82f6);
      --ux-order-ticket-preparing-bg: rgba(59, 130, 246, 0.1);
      --ux-order-ticket-ready: var(--ux-success, #22c55e);
      --ux-order-ticket-ready-bg: rgba(34, 197, 94, 0.1);
      --ux-order-ticket-completed: var(--ux-gray-500, #6b7280);
      --ux-order-ticket-completed-bg: rgba(107, 114, 128, 0.1);
      --ux-order-ticket-cancelled: var(--ux-danger, #ef4444);
      --ux-order-ticket-cancelled-bg: rgba(239, 68, 68, 0.1);
      --ux-order-ticket-urgent: var(--ux-danger, #ef4444);
      --ux-order-ticket-urgent-bg: rgba(239, 68, 68, 0.15);
    }

    /* ==========================================================================
       Order Ticket Container
       ========================================================================== */

    .ux-order-ticket {
      position: relative;
      display: flex;
      flex-direction: column;
      width: var(--ux-order-ticket-width);
      background-color: var(--ux-surface, #ffffff);
      border-radius: var(--ux-order-ticket-border-radius);
      box-shadow: var(--ux-shadow-md, 0 4px 6px -1px rgba(0, 0, 0, 0.1));
      overflow: hidden;
      font-family: var(--ux-order-ticket-font-family);
      transition: box-shadow var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-order-ticket:hover {
      box-shadow: var(--ux-shadow-lg, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
    }

    /* Status border indicator */
    .ux-order-ticket::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background-color: var(--ux-order-ticket-status-color, var(--ux-order-ticket-pending));
    }

    /* ==========================================================================
       Order Ticket Header
       ========================================================================== */

    .ux-order-ticket__header {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs, 4px);
      padding: var(--ux-order-ticket-padding);
      padding-top: calc(var(--ux-order-ticket-padding) + 4px);
      border-bottom: 1px solid var(--ux-border-color, #e5e7eb);
      background-color: var(--ux-surface-secondary, #f9fafb);
    }

    .ux-order-ticket__header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-sm, 8px);
    }

    .ux-order-ticket__order-number {
      font-size: var(--ux-font-size-xl, 1.25rem);
      font-weight: 700;
      color: var(--ux-text, #111827);
      margin: 0;
    }

    .ux-order-ticket__status {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs, 4px);
      padding: 4px 10px;
      border-radius: 9999px;
      font-size: var(--ux-font-size-xs, 0.75rem);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background-color: var(--ux-order-ticket-status-bg, var(--ux-order-ticket-pending-bg));
      color: var(--ux-order-ticket-status-color, var(--ux-order-ticket-pending));
    }

    .ux-order-ticket__status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: currentColor;
    }

    .ux-order-ticket__status--pulse .ux-order-ticket__status-dot {
      animation: ux-order-ticket-pulse 1.5s ease-in-out infinite;
    }

    @keyframes ux-order-ticket-pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .ux-order-ticket__header-meta {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md, 16px);
      font-size: var(--ux-font-size-sm, 0.875rem);
      color: var(--ux-text-secondary, #6b7280);
    }

    .ux-order-ticket__meta-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs, 4px);
    }

    .ux-order-ticket__meta-icon {
      width: 14px;
      height: 14px;
      opacity: 0.7;
    }

    .ux-order-ticket__meta-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-order-ticket__time {
      font-weight: 500;
    }

    .ux-order-ticket__table {
      font-weight: 600;
      color: var(--ux-text, #111827);
    }

    .ux-order-ticket__type {
      padding: 2px 6px;
      border-radius: 4px;
      font-size: var(--ux-font-size-xs, 0.75rem);
      font-weight: 500;
      background-color: var(--ux-surface-tertiary, #e5e7eb);
      color: var(--ux-text-secondary, #6b7280);
    }

    .ux-order-ticket__type--dine-in {
      background-color: rgba(59, 130, 246, 0.1);
      color: var(--ux-primary, #3b82f6);
    }

    .ux-order-ticket__type--takeout {
      background-color: rgba(245, 158, 11, 0.1);
      color: var(--ux-warning, #f59e0b);
    }

    .ux-order-ticket__type--delivery {
      background-color: rgba(139, 92, 246, 0.1);
      color: #8b5cf6;
    }

    /* ==========================================================================
       Order Ticket Items
       ========================================================================== */

    .ux-order-ticket__items {
      display: flex;
      flex-direction: column;
      padding: 0;
      margin: 0;
      list-style: none;
      max-height: 320px;
      overflow-y: auto;
    }

    .ux-order-ticket__item {
      display: flex;
      align-items: flex-start;
      gap: var(--ux-space-sm, 8px);
      padding: var(--ux-space-md, 16px) var(--ux-order-ticket-padding);
      border-bottom: 1px solid var(--ux-border-color, #e5e7eb);
      transition: background-color var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-order-ticket__item:last-child {
      border-bottom: none;
    }

    .ux-order-ticket__item:hover {
      background-color: var(--ux-surface-secondary, #f9fafb);
    }

    .ux-order-ticket__item--completed {
      opacity: 0.6;
      text-decoration: line-through;
      text-decoration-color: var(--ux-text-tertiary, #9ca3af);
    }

    .ux-order-ticket__item--urgent {
      background-color: var(--ux-order-ticket-urgent-bg);
    }

    .ux-order-ticket__item-qty {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 28px;
      height: 28px;
      border-radius: 6px;
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 700;
      background-color: var(--ux-surface-tertiary, #e5e7eb);
      color: var(--ux-text, #111827);
      flex-shrink: 0;
    }

    .ux-order-ticket__item--urgent .ux-order-ticket__item-qty {
      background-color: var(--ux-order-ticket-urgent);
      color: white;
    }

    .ux-order-ticket__item-content {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ux-order-ticket__item-name {
      font-size: var(--ux-font-size-md, 1rem);
      font-weight: 600;
      color: var(--ux-text, #111827);
      line-height: 1.3;
    }

    .ux-order-ticket__item-modifiers {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-top: 2px;
    }

    .ux-order-ticket__item-modifier {
      font-size: var(--ux-font-size-sm, 0.875rem);
      color: var(--ux-text-secondary, #6b7280);
      padding-left: var(--ux-space-sm, 8px);
    }

    .ux-order-ticket__item-modifier::before {
      content: '+ ';
      color: var(--ux-text-tertiary, #9ca3af);
    }

    .ux-order-ticket__item-modifier--remove {
      color: var(--ux-danger, #ef4444);
    }

    .ux-order-ticket__item-modifier--remove::before {
      content: '- ';
      color: var(--ux-danger, #ef4444);
    }

    .ux-order-ticket__item-notes {
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-style: italic;
      color: var(--ux-warning, #f59e0b);
      margin-top: 4px;
      padding: 4px 8px;
      background-color: rgba(245, 158, 11, 0.1);
      border-radius: 4px;
      border-left: 2px solid var(--ux-warning, #f59e0b);
    }

    .ux-order-ticket__item-price {
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 500;
      color: var(--ux-text-secondary, #6b7280);
      text-align: right;
      flex-shrink: 0;
    }

    /* ==========================================================================
       Order Ticket Footer
       ========================================================================== */

    .ux-order-ticket__footer {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm, 8px);
      padding: var(--ux-order-ticket-padding);
      border-top: 1px solid var(--ux-border-color, #e5e7eb);
      background-color: var(--ux-surface-secondary, #f9fafb);
    }

    .ux-order-ticket__totals {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs, 4px);
    }

    .ux-order-ticket__total-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: var(--ux-font-size-sm, 0.875rem);
      color: var(--ux-text-secondary, #6b7280);
    }

    .ux-order-ticket__total-row--grand {
      padding-top: var(--ux-space-sm, 8px);
      margin-top: var(--ux-space-xs, 4px);
      border-top: 1px dashed var(--ux-border-color, #e5e7eb);
      font-size: var(--ux-font-size-lg, 1.125rem);
      font-weight: 700;
      color: var(--ux-text, #111827);
    }

    .ux-order-ticket__total-label {
      flex: 1;
    }

    .ux-order-ticket__total-value {
      font-weight: 600;
      text-align: right;
    }

    /* ==========================================================================
       Order Ticket Actions
       ========================================================================== */

    .ux-order-ticket__actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm, 8px);
      padding: var(--ux-order-ticket-padding);
      padding-top: 0;
    }

    .ux-order-ticket__actions--full {
      padding-top: var(--ux-order-ticket-padding);
      border-top: 1px solid var(--ux-border-color, #e5e7eb);
    }

    .ux-order-ticket__action {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xs, 4px);
      padding: var(--ux-space-sm, 8px) var(--ux-space-md, 16px);
      border: none;
      border-radius: 8px;
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-order-ticket__action--primary {
      background-color: var(--ux-primary, #3b82f6);
      color: white;
    }

    .ux-order-ticket__action--primary:hover {
      background-color: var(--ux-primary-shade, #2563eb);
    }

    .ux-order-ticket__action--success {
      background-color: var(--ux-success, #22c55e);
      color: white;
    }

    .ux-order-ticket__action--success:hover {
      background-color: var(--ux-success-shade, #16a34a);
    }

    .ux-order-ticket__action--secondary {
      background-color: var(--ux-surface-tertiary, #e5e7eb);
      color: var(--ux-text, #111827);
    }

    .ux-order-ticket__action--secondary:hover {
      background-color: var(--ux-border-color, #d1d5db);
    }

    .ux-order-ticket__action:active {
      transform: scale(0.98);
    }

    .ux-order-ticket__action-icon {
      width: 16px;
      height: 16px;
    }

    .ux-order-ticket__action-icon svg {
      width: 100%;
      height: 100%;
    }

    /* ==========================================================================
       Order Ticket Timer
       ========================================================================== */

    .ux-order-ticket__timer {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs, 4px);
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }

    .ux-order-ticket__timer--warning {
      color: var(--ux-warning, #f59e0b);
    }

    .ux-order-ticket__timer--danger {
      color: var(--ux-danger, #ef4444);
      animation: ux-order-ticket-blink 1s ease-in-out infinite;
    }

    @keyframes ux-order-ticket-blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .ux-order-ticket__timer-icon {
      width: 14px;
      height: 14px;
    }

    .ux-order-ticket__timer-icon svg {
      width: 100%;
      height: 100%;
    }

    /* ==========================================================================
       Order Ticket Notes (Special Instructions)
       ========================================================================== */

    .ux-order-ticket__notes {
      padding: var(--ux-space-sm, 8px) var(--ux-order-ticket-padding);
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-style: italic;
      color: var(--ux-warning, #f59e0b);
      background-color: rgba(245, 158, 11, 0.08);
      border-top: 1px dashed var(--ux-warning, #f59e0b);
    }

    .ux-order-ticket__notes-label {
      font-weight: 600;
      font-style: normal;
      margin-right: var(--ux-space-xs, 4px);
    }

    /* ==========================================================================
       Status Variants
       ========================================================================== */

    .ux-order-ticket--pending {
      --ux-order-ticket-status-color: var(--ux-order-ticket-pending);
      --ux-order-ticket-status-bg: var(--ux-order-ticket-pending-bg);
    }

    .ux-order-ticket--preparing {
      --ux-order-ticket-status-color: var(--ux-order-ticket-preparing);
      --ux-order-ticket-status-bg: var(--ux-order-ticket-preparing-bg);
    }

    .ux-order-ticket--ready {
      --ux-order-ticket-status-color: var(--ux-order-ticket-ready);
      --ux-order-ticket-status-bg: var(--ux-order-ticket-ready-bg);
    }

    .ux-order-ticket--completed {
      --ux-order-ticket-status-color: var(--ux-order-ticket-completed);
      --ux-order-ticket-status-bg: var(--ux-order-ticket-completed-bg);
      opacity: 0.7;
    }

    .ux-order-ticket--cancelled {
      --ux-order-ticket-status-color: var(--ux-order-ticket-cancelled);
      --ux-order-ticket-status-bg: var(--ux-order-ticket-cancelled-bg);
      opacity: 0.5;
    }

    .ux-order-ticket--urgent {
      box-shadow: 0 0 0 2px var(--ux-order-ticket-urgent),
                  var(--ux-shadow-lg, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
      animation: ux-order-ticket-urgent-pulse 2s ease-in-out infinite;
    }

    @keyframes ux-order-ticket-urgent-pulse {
      0%, 100% { box-shadow: 0 0 0 2px var(--ux-order-ticket-urgent), var(--ux-shadow-lg); }
      50% { box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.4), var(--ux-shadow-lg); }
    }

    /* ==========================================================================
       Size Variants
       ========================================================================== */

    .ux-order-ticket--sm {
      --ux-order-ticket-width: 260px;
      --ux-order-ticket-padding: var(--ux-space-sm, 8px);
    }

    .ux-order-ticket--sm .ux-order-ticket__order-number {
      font-size: var(--ux-font-size-lg, 1.125rem);
    }

    .ux-order-ticket--sm .ux-order-ticket__item-name {
      font-size: var(--ux-font-size-sm, 0.875rem);
    }

    .ux-order-ticket--lg {
      --ux-order-ticket-width: 380px;
      --ux-order-ticket-padding: var(--ux-space-lg, 24px);
    }

    .ux-order-ticket--lg .ux-order-ticket__order-number {
      font-size: var(--ux-font-size-2xl, 1.5rem);
    }

    .ux-order-ticket--full {
      --ux-order-ticket-width: 100%;
    }

    /* ==========================================================================
       Glass Variant (iOS 26 Liquid Glass)
       ========================================================================== */

    .ux-order-ticket--glass {
      box-shadow: var(--ux-glass-shadow, 0 8px 32px rgba(0, 0, 0, 0.08)),
                  var(--ux-glass-highlight, inset 0 1px 0 rgba(255, 255, 255, 0.5));
      border: 0.5px solid var(--ux-glass-border, rgba(255, 255, 255, 0.18));
    }

    .ux-order-ticket--glass .ux-order-ticket__header,
    .ux-order-ticket--glass .ux-order-ticket__footer {
      background: var(--ux-glass-bg-thin, rgba(255, 255, 255, 0.5));
    }

    .ux-order-ticket--glass .ux-order-ticket__header {
      border-bottom-color: var(--ux-glass-border, rgba(255, 255, 255, 0.18));
    }

    .ux-order-ticket--glass .ux-order-ticket__footer {
      border-top-color: var(--ux-glass-border, rgba(255, 255, 255, 0.18));
    }

    .ux-order-ticket--glass .ux-order-ticket__item {
      border-bottom-color: var(--ux-glass-border, rgba(255, 255, 255, 0.18));
    }

    /* ==========================================================================
       Order Ticket Grid
       ========================================================================== */

    .ux-order-ticket-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(var(--ux-order-ticket-width), 1fr));
      gap: var(--ux-space-lg, 24px);
      padding: var(--ux-space-md, 16px);
    }

    .ux-order-ticket-grid .ux-order-ticket {
      width: 100%;
    }

    /* Kanban-style columns */
    .ux-order-ticket-column {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md, 16px);
      min-width: var(--ux-order-ticket-width);
      padding: var(--ux-space-md, 16px);
      background-color: var(--ux-surface-secondary, #f9fafb);
      border-radius: var(--ux-border-radius-lg, 12px);
    }

    .ux-order-ticket-column__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm, 8px);
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--ux-text-secondary, #6b7280);
    }

    .ux-order-ticket-column__count {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 24px;
      padding: 0 8px;
      border-radius: 12px;
      font-size: var(--ux-font-size-xs, 0.75rem);
      font-weight: 700;
      background-color: var(--ux-surface-tertiary, #e5e7eb);
      color: var(--ux-text, #111827);
    }

    /* ==========================================================================
       Print Styles
       ========================================================================== */

    @media print {
      .ux-order-ticket {
        width: 80mm;
        box-shadow: none;
        border: 1px solid #000;
        border-radius: 0;
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .ux-order-ticket::before {
        display: none;
      }

      .ux-order-ticket__header,
      .ux-order-ticket__footer {
        background-color: transparent;
      }

      .ux-order-ticket__status {
        border: 1px solid currentColor;
        background-color: transparent;
      }

      .ux-order-ticket__actions {
        display: none;
      }

      .ux-order-ticket__items {
        max-height: none;
        overflow: visible;
      }

      .ux-order-ticket__item:hover {
        background-color: transparent;
      }

      .ux-order-ticket--glass {
        background: white;
        border: 1px solid #000;
      }

      .ux-order-ticket-grid {
        display: block;
      }

      .ux-order-ticket-grid .ux-order-ticket {
        margin-bottom: 16px;
      }
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light):not(.ux-theme-light) {
        --ux-order-ticket-pending-bg: rgba(245, 158, 11, 0.15);
        --ux-order-ticket-preparing-bg: rgba(59, 130, 246, 0.15);
        --ux-order-ticket-ready-bg: rgba(34, 197, 94, 0.15);
        --ux-order-ticket-completed-bg: rgba(107, 114, 128, 0.15);
        --ux-order-ticket-cancelled-bg: rgba(239, 68, 68, 0.15);
        --ux-order-ticket-urgent-bg: rgba(239, 68, 68, 0.2);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-order-ticket__item-qty {
        background-color: var(--ux-gray-700, #374151);
        color: var(--ux-gray-100, #f3f4f6);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-order-ticket__type {
        background-color: var(--ux-gray-700, #374151);
        color: var(--ux-gray-300, #d1d5db);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-order-ticket__action--secondary {
        background-color: var(--ux-gray-700, #374151);
        color: var(--ux-gray-100, #f3f4f6);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-order-ticket__action--secondary:hover {
        background-color: var(--ux-gray-600, #4b5563);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-order-ticket-column {
        background-color: var(--ux-gray-800, #1f2937);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-order-ticket-column__count {
        background-color: var(--ux-gray-700, #374151);
        color: var(--ux-gray-100, #f3f4f6);
      }
    }

    .ux-dark .ux-order-ticket__item-qty,
    .ux-theme-dark .ux-order-ticket__item-qty {
      background-color: var(--ux-gray-700, #374151);
      color: var(--ux-gray-100, #f3f4f6);
    }

    .ux-dark .ux-order-ticket__type,
    .ux-theme-dark .ux-order-ticket__type {
      background-color: var(--ux-gray-700, #374151);
      color: var(--ux-gray-300, #d1d5db);
    }

    .ux-dark .ux-order-ticket__action--secondary,
    .ux-theme-dark .ux-order-ticket__action--secondary {
      background-color: var(--ux-gray-700, #374151);
      color: var(--ux-gray-100, #f3f4f6);
    }

    .ux-dark .ux-order-ticket__action--secondary:hover,
    .ux-theme-dark .ux-order-ticket__action--secondary:hover {
      background-color: var(--ux-gray-600, #4b5563);
    }

    .ux-dark .ux-order-ticket-column,
    .ux-theme-dark .ux-order-ticket-column {
      background-color: var(--ux-gray-800, #1f2937);
    }

    .ux-dark .ux-order-ticket-column__count,
    .ux-theme-dark .ux-order-ticket-column__count {
      background-color: var(--ux-gray-700, #374151);
      color: var(--ux-gray-100, #f3f4f6);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-order-ticket,
      .ux-order-ticket__item,
      .ux-order-ticket__action {
        transition: none;
      }

      .ux-order-ticket--urgent,
      .ux-order-ticket__status--pulse .ux-order-ticket__status-dot,
      .ux-order-ticket__timer--danger {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-order-ticket-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-order-ticket-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const orderTicketData = (options = {}) => ({
    // Order identification
    orderNumber: options.orderNumber || '',
    orderId: options.orderId || null,

    // Order metadata
    table: options.table || null,
    type: options.type || 'dine-in', // 'dine-in', 'takeout', 'delivery'
    createdAt: options.createdAt || new Date(),
    customer: options.customer || null,
    server: options.server || null,

    // Order status
    status: options.status || 'pending', // 'pending', 'preparing', 'ready', 'completed', 'cancelled'
    urgent: options.urgent || false,

    // Order items
    items: options.items || [],

    // Totals
    subtotal: options.subtotal || 0,
    tax: options.tax || 0,
    discount: options.discount || 0,
    total: options.total || 0,
    showTotals: options.showTotals ?? false,

    // Notes
    notes: options.notes || '',

    // Timer
    elapsedTime: 0,
    timerInterval: null,
    warningThreshold: options.warningThreshold || 10, // minutes
    dangerThreshold: options.dangerThreshold || 15, // minutes

    // Currency
    currency: options.currency || '$',
    currencyPosition: options.currencyPosition || 'before', // 'before' or 'after'

    // Lifecycle
    init() {
      this.startTimer();
    },

    destroy() {
      this.stopTimer();
    },

    // Timer methods
    startTimer() {
      if (this.timerInterval) return;

      const startTime = new Date(this.createdAt).getTime();

      this.timerInterval = setInterval(() => {
        const now = Date.now();
        this.elapsedTime = Math.floor((now - startTime) / 1000);
      }, 1000);

      // Initial calculation
      const now = Date.now();
      this.elapsedTime = Math.floor((now - startTime) / 1000);
    },

    stopTimer() {
      if (this.timerInterval) {
        clearInterval(this.timerInterval);
        this.timerInterval = null;
      }
    },

    get formattedTime() {
      const hours = Math.floor(this.elapsedTime / 3600);
      const minutes = Math.floor((this.elapsedTime % 3600) / 60);
      const seconds = this.elapsedTime % 60;

      if (hours > 0) {
        return `${hours}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }
      return `${minutes}:${String(seconds).padStart(2, '0')}`;
    },

    get elapsedMinutes() {
      return Math.floor(this.elapsedTime / 60);
    },

    get timerStatus() {
      if (this.elapsedMinutes >= this.dangerThreshold) return 'danger';
      if (this.elapsedMinutes >= this.warningThreshold) return 'warning';
      return 'normal';
    },

    // Format price
    formatPrice(amount) {
      const formatted = parseFloat(amount).toFixed(2);
      if (this.currencyPosition === 'before') {
        return `${this.currency}${formatted}`;
      }
      return `${formatted}${this.currency}`;
    },

    // Calculate totals
    calculateSubtotal() {
      return this.items.reduce((sum, item) => {
        const itemTotal = (item.price || 0) * (item.qty || 1);
        return sum + itemTotal;
      }, 0);
    },

    calculateTotal() {
      const subtotal = this.subtotal || this.calculateSubtotal();
      return subtotal + (this.tax || 0) - (this.discount || 0);
    },

    // Status methods
    setStatus(newStatus) {
      const validStatuses = ['pending', 'preparing', 'ready', 'completed', 'cancelled'];
      if (validStatuses.includes(newStatus)) {
        const oldStatus = this.status;
        this.status = newStatus;

        if (newStatus === 'completed' || newStatus === 'cancelled') {
          this.stopTimer();
        }

        this.$dispatch('order-ticket:status-change', {
          orderId: this.orderId,
          orderNumber: this.orderNumber,
          oldStatus,
          newStatus
        });
      }
    },

    startPreparing() {
      this.setStatus('preparing');
    },

    markReady() {
      this.setStatus('ready');
    },

    complete() {
      this.setStatus('completed');
    },

    cancel() {
      this.setStatus('cancelled');
    },

    // Item methods
    toggleItemCompleted(index) {
      if (this.items[index]) {
        this.items[index].completed = !this.items[index].completed;
        this.$dispatch('order-ticket:item-toggle', {
          orderId: this.orderId,
          itemIndex: index,
          completed: this.items[index].completed
        });
      }
    },

    get completedItemsCount() {
      return this.items.filter(item => item.completed).length;
    },

    get allItemsCompleted() {
      return this.items.length > 0 && this.items.every(item => item.completed);
    },

    // Print
    print() {
      window.print();
      this.$dispatch('order-ticket:print', {
        orderId: this.orderId,
        orderNumber: this.orderNumber
      });
    },

    // Get order data
    getData() {
      return {
        orderId: this.orderId,
        orderNumber: this.orderNumber,
        table: this.table,
        type: this.type,
        status: this.status,
        urgent: this.urgent,
        items: this.items,
        subtotal: this.subtotal,
        tax: this.tax,
        discount: this.discount,
        total: this.total,
        notes: this.notes,
        createdAt: this.createdAt,
        customer: this.customer,
        server: this.server,
        elapsedTime: this.elapsedTime
      };
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxOrderTicket', orderTicketData);
  }
})();

/**
 * UX Org Chart Component
 * Hierarchical organization chart with zoom, pan, and collapsible branches
 * @requires ux-core.js
 * @requires Alpine.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Org Chart - Container
       ========================================================================== */

    :root {
      --ux-org-chart-node-width: 180px;
      --ux-org-chart-node-min-height: 80px;
      --ux-org-chart-node-padding: var(--ux-space-md);
      --ux-org-chart-node-gap: var(--ux-space-xl);
      --ux-org-chart-level-gap: 60px;
      --ux-org-chart-connector-width: 2px;
      --ux-org-chart-connector-color: var(--ux-border-color);
      --ux-org-chart-node-radius: var(--ux-radius-lg);
      --ux-org-chart-transition: var(--ux-transition-normal);
    }

    .ux-org-chart {
      position: relative;
      width: 100%;
      height: 100%;
      min-height: 400px;
      overflow: hidden;
      font-family: var(--ux-font-family);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-lg);
      user-select: none;
    }

    .ux-org-chart__viewport {
      position: absolute;
      inset: 0;
      overflow: hidden;
      cursor: grab;
    }

    .ux-org-chart__viewport:active {
      cursor: grabbing;
    }

    .ux-org-chart__canvas {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: var(--ux-space-2xl);
      transform-origin: center center;
      transition: transform var(--ux-org-chart-transition) var(--ux-ease-out);
      min-width: 100%;
      min-height: 100%;
    }

    .ux-org-chart__canvas--dragging {
      transition: none;
    }

    /* ==========================================================================
       Org Chart - Controls
       ========================================================================== */

    .ux-org-chart__controls {
      position: absolute;
      bottom: var(--ux-space-lg);
      right: var(--ux-space-lg);
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
      z-index: 10;
    }

    .ux-org-chart__control {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border: none;
      border-radius: var(--ux-radius-md);
      background: var(--ux-surface);
      color: var(--ux-text);
      cursor: pointer;
      box-shadow: var(--ux-shadow-md);
      transition: all var(--ux-transition-fast) var(--ux-ease-out);
    }

    .ux-org-chart__control:hover {
      background: var(--ux-surface-secondary);
      transform: scale(1.05);
    }

    .ux-org-chart__control:active {
      transform: scale(0.95);
    }

    .ux-org-chart__control:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .ux-org-chart__control svg {
      width: 20px;
      height: 20px;
    }

    .ux-org-chart__zoom-level {
      font-size: var(--ux-font-size-xs);
      text-align: center;
      padding: var(--ux-space-xs);
      background: var(--ux-surface);
      border-radius: var(--ux-radius-sm);
      box-shadow: var(--ux-shadow-sm);
      min-width: 40px;
    }

    /* ==========================================================================
       Org Chart - Search
       ========================================================================== */

    .ux-org-chart__search {
      position: absolute;
      top: var(--ux-space-lg);
      left: var(--ux-space-lg);
      z-index: 10;
      width: 280px;
      max-width: calc(100% - var(--ux-space-xl) * 2);
    }

    .ux-org-chart__search-input {
      width: 100%;
      height: 40px;
      padding: 0 var(--ux-space-md) 0 40px;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      background: var(--ux-surface);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      box-shadow: var(--ux-shadow-md);
      outline: none;
      transition: border-color var(--ux-transition-fast), box-shadow var(--ux-transition-fast);
    }

    .ux-org-chart__search-input:focus {
      border-color: var(--ux-primary);
      box-shadow: var(--ux-shadow-md), 0 0 0 3px var(--ux-primary-tint);
    }

    .ux-org-chart__search-input::placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-org-chart__search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      color: var(--ux-text-tertiary);
      pointer-events: none;
    }

    /* ==========================================================================
       Org Chart - Tree Structure
       ========================================================================== */

    .ux-org-chart__tree {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .ux-org-chart__branch {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    .ux-org-chart__children {
      display: flex;
      gap: var(--ux-org-chart-node-gap);
      position: relative;
      padding-top: var(--ux-org-chart-level-gap);
    }

    .ux-org-chart__children--collapsed {
      display: none;
    }

    /* ==========================================================================
       Org Chart - Node
       ========================================================================== */

    .ux-org-chart__node {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: var(--ux-org-chart-node-width);
      min-height: var(--ux-org-chart-node-min-height);
      padding: var(--ux-org-chart-node-padding);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-org-chart-node-radius);
      box-shadow: var(--ux-shadow-sm);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease-out);
      text-align: center;
    }

    .ux-org-chart__node:hover {
      border-color: var(--ux-primary);
      box-shadow: var(--ux-shadow-md);
      transform: translateY(-2px);
    }

    .ux-org-chart__node:active {
      transform: translateY(0) scale(0.98);
    }

    .ux-org-chart__node--selected {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px var(--ux-primary-tint), var(--ux-shadow-md);
    }

    .ux-org-chart__node--highlighted {
      border-color: var(--ux-warning);
      box-shadow: 0 0 0 3px var(--ux-warning-tint), var(--ux-shadow-md);
      animation: ux-org-chart-pulse 1.5s ease-in-out infinite;
    }

    @keyframes ux-org-chart-pulse {
      0%, 100% { box-shadow: 0 0 0 3px var(--ux-warning-tint), var(--ux-shadow-md); }
      50% { box-shadow: 0 0 0 6px var(--ux-warning-tint), var(--ux-shadow-lg); }
    }

    .ux-org-chart__node--collapsed {
      opacity: 0.7;
    }

    /* Node Avatar */
    .ux-org-chart__avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      overflow: hidden;
      margin-bottom: var(--ux-space-sm);
      flex-shrink: 0;
      background: var(--ux-medium);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--ux-medium-contrast);
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      text-transform: uppercase;
    }

    .ux-org-chart__avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Node Info */
    .ux-org-chart__name {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
      line-height: 1.3;
      margin-bottom: var(--ux-space-xs);
      word-break: break-word;
    }

    .ux-org-chart__title {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      line-height: 1.3;
      word-break: break-word;
    }

    .ux-org-chart__department {
      font-size: 10px;
      color: var(--ux-text-tertiary);
      margin-top: var(--ux-space-xs);
      padding: 2px 8px;
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-sm);
    }

    /* Expand/Collapse Toggle */
    .ux-org-chart__toggle {
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      width: 24px;
      height: 24px;
      border: 2px solid var(--ux-border-color);
      border-radius: 50%;
      background: var(--ux-surface);
      color: var(--ux-text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--ux-transition-fast);
      z-index: 5;
    }

    .ux-org-chart__toggle:hover {
      border-color: var(--ux-primary);
      color: var(--ux-primary);
      transform: translateX(-50%) scale(1.1);
    }

    .ux-org-chart__toggle svg {
      width: 14px;
      height: 14px;
      transition: transform var(--ux-transition-fast);
    }

    .ux-org-chart__toggle--collapsed svg {
      transform: rotate(-90deg);
    }

    /* Child count badge */
    .ux-org-chart__count {
      position: absolute;
      bottom: -8px;
      right: -8px;
      min-width: 20px;
      height: 20px;
      padding: 0 6px;
      border-radius: 10px;
      background: var(--ux-primary);
      color: white;
      font-size: 11px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--ux-shadow-sm);
    }

    /* ==========================================================================
       Org Chart - Connectors (CSS-drawn lines)
       ========================================================================== */

    .ux-org-chart__connector {
      position: absolute;
      pointer-events: none;
    }

    /* Vertical line from parent to horizontal bar */
    .ux-org-chart__connector--vertical {
      left: 50%;
      top: 100%;
      width: var(--ux-org-chart-connector-width);
      height: calc(var(--ux-org-chart-level-gap) / 2);
      background: var(--ux-org-chart-connector-color);
      transform: translateX(-50%);
    }

    /* Horizontal bar connecting children */
    .ux-org-chart__connector--horizontal {
      position: absolute;
      top: calc(var(--ux-org-chart-level-gap) / 2);
      height: var(--ux-org-chart-connector-width);
      background: var(--ux-org-chart-connector-color);
      transform: translateY(-50%);
    }

    /* Vertical line from horizontal bar to child */
    .ux-org-chart__branch::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      width: var(--ux-org-chart-connector-width);
      height: calc(var(--ux-org-chart-level-gap) / 2);
      background: var(--ux-org-chart-connector-color);
      transform: translateX(-50%);
    }

    /* First branch - hide the line going up */
    .ux-org-chart__tree > .ux-org-chart__branch::before {
      display: none;
    }

    /* ==========================================================================
       Org Chart - Horizontal Layout
       ========================================================================== */

    .ux-org-chart--horizontal .ux-org-chart__tree {
      flex-direction: row;
    }

    .ux-org-chart--horizontal .ux-org-chart__branch {
      flex-direction: row;
    }

    .ux-org-chart--horizontal .ux-org-chart__children {
      flex-direction: column;
      padding-top: 0;
      padding-left: var(--ux-org-chart-level-gap);
    }

    .ux-org-chart--horizontal .ux-org-chart__connector--vertical {
      top: 50%;
      left: 100%;
      width: calc(var(--ux-org-chart-level-gap) / 2);
      height: var(--ux-org-chart-connector-width);
      transform: translateY(-50%);
    }

    .ux-org-chart--horizontal .ux-org-chart__connector--horizontal {
      left: calc(var(--ux-org-chart-level-gap) / 2);
      top: 0;
      width: var(--ux-org-chart-connector-width);
      transform: translateX(-50%);
    }

    .ux-org-chart--horizontal .ux-org-chart__branch::before {
      top: 50%;
      left: 0;
      width: calc(var(--ux-org-chart-level-gap) / 2);
      height: var(--ux-org-chart-connector-width);
      transform: translateY(-50%);
    }

    .ux-org-chart--horizontal .ux-org-chart__toggle {
      bottom: auto;
      left: auto;
      right: -12px;
      top: 50%;
      transform: translateY(-50%);
    }

    .ux-org-chart--horizontal .ux-org-chart__toggle:hover {
      transform: translateY(-50%) scale(1.1);
    }

    .ux-org-chart--horizontal .ux-org-chart__toggle svg {
      transform: rotate(90deg);
    }

    .ux-org-chart--horizontal .ux-org-chart__toggle--collapsed svg {
      transform: rotate(0deg);
    }

    /* ==========================================================================
       Org Chart - Glass Variant
       ========================================================================== */

    .ux-org-chart--glass {
      background: var(--ux-glass-bg-thin);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
    }

    .ux-org-chart--glass .ux-org-chart__node {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-org-chart--glass .ux-org-chart__node:hover {
      box-shadow: var(--ux-glass-shadow), 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .ux-org-chart--glass .ux-org-chart__control,
    .ux-org-chart--glass .ux-org-chart__search-input,
    .ux-org-chart--glass .ux-org-chart__zoom-level {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border: 1px solid var(--ux-glass-border);
    }

    .ux-org-chart--glass .ux-org-chart__toggle {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
    }

    /* ==========================================================================
       Org Chart - Compact Mode
       ========================================================================== */

    .ux-org-chart--compact {
      --ux-org-chart-node-width: 140px;
      --ux-org-chart-node-min-height: 60px;
      --ux-org-chart-node-padding: var(--ux-space-sm);
      --ux-org-chart-node-gap: var(--ux-space-md);
      --ux-org-chart-level-gap: 40px;
    }

    .ux-org-chart--compact .ux-org-chart__avatar {
      width: 36px;
      height: 36px;
      margin-bottom: var(--ux-space-xs);
    }

    .ux-org-chart--compact .ux-org-chart__name {
      font-size: var(--ux-font-size-xs);
    }

    .ux-org-chart--compact .ux-org-chart__title {
      font-size: 10px;
    }

    .ux-org-chart--compact .ux-org-chart__toggle {
      width: 20px;
      height: 20px;
      bottom: -10px;
    }

    .ux-org-chart--compact .ux-org-chart__toggle svg {
      width: 12px;
      height: 12px;
    }

    /* ==========================================================================
       Org Chart - Size Variants
       ========================================================================== */

    .ux-org-chart--sm {
      --ux-org-chart-node-width: 120px;
      --ux-org-chart-node-min-height: 50px;
      --ux-org-chart-node-gap: var(--ux-space-sm);
      --ux-org-chart-level-gap: 30px;
    }

    .ux-org-chart--lg {
      --ux-org-chart-node-width: 220px;
      --ux-org-chart-node-min-height: 100px;
      --ux-org-chart-node-gap: var(--ux-space-2xl);
      --ux-org-chart-level-gap: 80px;
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      .ux-org-chart {
        background: var(--ux-surface);
      }

      .ux-org-chart__node {
        background: var(--ux-surface-secondary);
        border-color: var(--ux-border-color);
      }

      .ux-org-chart--glass .ux-org-chart__node:hover {
        box-shadow: var(--ux-glass-shadow), 0 8px 32px rgba(0, 0, 0, 0.3);
      }
    }

    .ux-dark .ux-org-chart {
      background: var(--ux-surface);
    }

    .ux-dark .ux-org-chart__node {
      background: var(--ux-surface-secondary);
      border-color: var(--ux-border-color);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-org-chart__canvas {
        transition: none;
      }

      .ux-org-chart__node,
      .ux-org-chart__control,
      .ux-org-chart__toggle {
        transition: none;
      }

      .ux-org-chart__node--highlighted {
        animation: none;
      }
    }

    /* ==========================================================================
       Print Styles
       ========================================================================== */

    @media print {
      .ux-org-chart {
        overflow: visible;
        height: auto;
        min-height: auto;
      }

      .ux-org-chart__controls,
      .ux-org-chart__search {
        display: none;
      }

      .ux-org-chart__canvas {
        position: static;
        transform: none !important;
      }
    }
  `;

  // Icons
  const icons = {
    zoomIn: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>`,
    zoomOut: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></svg>`,
    reset: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>`,
    expand: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>`,
    collapse: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/><line x1="14" y1="10" x2="21" y2="3"/><line x1="3" y1="21" x2="10" y2="14"/></svg>`,
    chevron: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>`,
    search: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>`,
    user: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-org-chart-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-org-chart-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const orgChartData = (options = {}) => ({
    // Configuration
    data: options.data || null,
    horizontal: options.horizontal ?? false,
    compact: options.compact ?? false,
    showSearch: options.showSearch ?? true,
    showControls: options.showControls ?? true,
    minZoom: options.minZoom ?? 0.25,
    maxZoom: options.maxZoom ?? 2,
    zoomStep: options.zoomStep ?? 0.25,

    // State
    zoom: 1,
    panX: 0,
    panY: 0,
    isDragging: false,
    dragStartX: 0,
    dragStartY: 0,
    initialPanX: 0,
    initialPanY: 0,
    selectedNode: null,
    highlightedNodes: new Set(),
    collapsedNodes: new Set(options.collapsed || []),
    searchQuery: '',

    // Icons
    icons: icons,

    // Lifecycle
    init() {
      // Center the chart initially
      this.$nextTick(() => {
        this.centerChart();
      });

      // Keyboard navigation
      this._keyHandler = (e) => {
        if (e.key === 'Escape') {
          this.selectedNode = null;
          this.highlightedNodes.clear();
          this.searchQuery = '';
        }
        if (e.key === '+' || e.key === '=') {
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            this.zoomIn();
          }
        }
        if (e.key === '-') {
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            this.zoomOut();
          }
        }
        if (e.key === '0') {
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            this.resetZoom();
          }
        }
      };
      document.addEventListener('keydown', this._keyHandler);

      // Wheel zoom
      this.$el.addEventListener('wheel', this.handleWheel.bind(this), { passive: false });
    },

    destroy() {
      if (this._keyHandler) {
        document.removeEventListener('keydown', this._keyHandler);
      }
    },

    // Zoom methods
    zoomIn() {
      const newZoom = Math.min(this.zoom + this.zoomStep, this.maxZoom);
      this.setZoom(newZoom);
    },

    zoomOut() {
      const newZoom = Math.max(this.zoom - this.zoomStep, this.minZoom);
      this.setZoom(newZoom);
    },

    setZoom(level) {
      this.zoom = Math.round(level * 100) / 100;
      this.$dispatch('orgchart:zoom', { zoom: this.zoom });
    },

    resetZoom() {
      this.zoom = 1;
      this.panX = 0;
      this.panY = 0;
      this.centerChart();
      this.$dispatch('orgchart:reset');
    },

    centerChart() {
      const viewport = this.$el.querySelector('.ux-org-chart__viewport');
      const canvas = this.$el.querySelector('.ux-org-chart__canvas');
      if (!viewport || !canvas) return;

      const vRect = viewport.getBoundingClientRect();
      const cRect = canvas.getBoundingClientRect();

      // Center the canvas in the viewport
      this.panX = (vRect.width - cRect.width * this.zoom) / 2;
      this.panY = 40; // Some top padding
    },

    handleWheel(e) {
      if (e.ctrlKey || e.metaKey) {
        e.preventDefault();
        const delta = e.deltaY > 0 ? -this.zoomStep : this.zoomStep;
        const newZoom = Math.max(this.minZoom, Math.min(this.maxZoom, this.zoom + delta));
        this.setZoom(newZoom);
      }
    },

    // Pan methods
    startDrag(e) {
      if (e.target.closest('.ux-org-chart__node') ||
          e.target.closest('.ux-org-chart__control') ||
          e.target.closest('.ux-org-chart__search') ||
          e.target.closest('.ux-org-chart__toggle')) {
        return;
      }

      this.isDragging = true;
      this.dragStartX = e.clientX || e.touches?.[0]?.clientX || 0;
      this.dragStartY = e.clientY || e.touches?.[0]?.clientY || 0;
      this.initialPanX = this.panX;
      this.initialPanY = this.panY;
    },

    drag(e) {
      if (!this.isDragging) return;

      const clientX = e.clientX || e.touches?.[0]?.clientX || 0;
      const clientY = e.clientY || e.touches?.[0]?.clientY || 0;

      this.panX = this.initialPanX + (clientX - this.dragStartX);
      this.panY = this.initialPanY + (clientY - this.dragStartY);
    },

    endDrag() {
      this.isDragging = false;
    },

    getTransform() {
      return `translate(${this.panX}px, ${this.panY}px) scale(${this.zoom})`;
    },

    // Node methods
    toggleNode(nodeId) {
      if (this.collapsedNodes.has(nodeId)) {
        this.collapsedNodes.delete(nodeId);
        this.$dispatch('orgchart:expand', { nodeId });
      } else {
        this.collapsedNodes.add(nodeId);
        this.$dispatch('orgchart:collapse', { nodeId });
      }
      // Force reactivity
      this.collapsedNodes = new Set(this.collapsedNodes);
    },

    selectNode(nodeId, node) {
      this.selectedNode = this.selectedNode === nodeId ? null : nodeId;
      this.$dispatch('orgchart:select', { nodeId, node, selected: this.selectedNode === nodeId });
    },

    isCollapsed(nodeId) {
      return this.collapsedNodes.has(nodeId);
    },

    isSelected(nodeId) {
      return this.selectedNode === nodeId;
    },

    isHighlighted(nodeId) {
      return this.highlightedNodes.has(nodeId);
    },

    // Search methods
    search() {
      this.highlightedNodes.clear();

      if (!this.searchQuery.trim()) {
        return;
      }

      const query = this.searchQuery.toLowerCase();
      const matchingNodes = this.findMatchingNodes(this.data, query);

      matchingNodes.forEach(node => {
        this.highlightedNodes.add(node.id);
        // Expand parents to show highlighted nodes
        this.expandToNode(node.id);
      });

      // Force reactivity
      this.highlightedNodes = new Set(this.highlightedNodes);

      // Focus on first match
      if (matchingNodes.length > 0) {
        this.focusOnNode(matchingNodes[0].id);
      }

      this.$dispatch('orgchart:search', {
        query: this.searchQuery,
        results: matchingNodes
      });
    },

    findMatchingNodes(node, query, results = []) {
      if (!node) return results;

      const nameMatch = node.name?.toLowerCase().includes(query);
      const titleMatch = node.title?.toLowerCase().includes(query);
      const deptMatch = node.department?.toLowerCase().includes(query);

      if (nameMatch || titleMatch || deptMatch) {
        results.push(node);
      }

      if (node.children) {
        node.children.forEach(child => {
          this.findMatchingNodes(child, query, results);
        });
      }

      return results;
    },

    expandToNode(nodeId) {
      const path = this.getPathToNode(nodeId, this.data);
      if (path) {
        path.forEach(id => {
          this.collapsedNodes.delete(id);
        });
        this.collapsedNodes = new Set(this.collapsedNodes);
      }
    },

    getPathToNode(nodeId, node, path = []) {
      if (!node) return null;
      if (node.id === nodeId) return path;

      if (node.children) {
        for (const child of node.children) {
          const result = this.getPathToNode(nodeId, child, [...path, node.id]);
          if (result) return result;
        }
      }

      return null;
    },

    focusOnNode(nodeId) {
      this.$nextTick(() => {
        const nodeEl = this.$el.querySelector(`[data-node-id="${nodeId}"]`);
        if (nodeEl) {
          const viewport = this.$el.querySelector('.ux-org-chart__viewport');
          const vRect = viewport.getBoundingClientRect();
          const nRect = nodeEl.getBoundingClientRect();

          // Calculate position to center the node
          const centerX = vRect.width / 2 - (nRect.left - vRect.left + nRect.width / 2);
          const centerY = vRect.height / 2 - (nRect.top - vRect.top + nRect.height / 2);

          this.panX += centerX;
          this.panY += centerY;
        }
      });
    },

    clearSearch() {
      this.searchQuery = '';
      this.highlightedNodes.clear();
    },

    // Expand/Collapse all
    expandAll() {
      this.collapsedNodes.clear();
      this.$dispatch('orgchart:expand-all');
    },

    collapseAll() {
      const allIds = this.getAllNodeIds(this.data);
      this.collapsedNodes = new Set(allIds);
      this.$dispatch('orgchart:collapse-all');
    },

    getAllNodeIds(node, ids = []) {
      if (!node) return ids;

      if (node.children && node.children.length > 0) {
        ids.push(node.id);
        node.children.forEach(child => {
          this.getAllNodeIds(child, ids);
        });
      }

      return ids;
    },

    // Utility methods
    hasChildren(node) {
      return node && node.children && node.children.length > 0;
    },

    getInitials(name) {
      if (!name) return '';
      return name
        .split(' ')
        .map(word => word[0])
        .join('')
        .toUpperCase()
        .slice(0, 2);
    },

    getZoomPercentage() {
      return Math.round(this.zoom * 100) + '%';
    },

    // Export data
    getSelectedNode() {
      if (!this.selectedNode) return null;
      return this.findNodeById(this.selectedNode, this.data);
    },

    findNodeById(nodeId, node) {
      if (!node) return null;
      if (node.id === nodeId) return node;

      if (node.children) {
        for (const child of node.children) {
          const found = this.findNodeById(nodeId, child);
          if (found) return found;
        }
      }

      return null;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxOrgChart', orgChartData);
  }

  // Expose icons for external use
  window.UX = window.UX || {};
  window.UX.orgChartIcons = icons;
})();

/**
 * UX OTP Input Component
 * One-Time Password / Verification code input with individual digit fields
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX OTP Input - Base
    ======================================== */

    .ux-otp {
      display: inline-flex;
      gap: var(--ux-space-sm);
      font-family: var(--ux-font-family);
    }

    .ux-otp__field {
      width: 48px;
      height: 56px;
      padding: 0;
      font-size: 1.5rem;
      font-weight: 600;
      text-align: center;
      background: var(--ux-surface);
      border: 1.5px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      color: var(--ux-text);
      transition: all var(--ux-transition-fast) var(--ux-ease);
      -webkit-appearance: none;
      -moz-appearance: textfield;
      caret-color: var(--ux-primary);
    }

    .ux-otp__field::-webkit-outer-spin-button,
    .ux-otp__field::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .ux-otp__field::placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-otp__field:focus {
      outline: none;
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-otp__field:hover:not(:focus):not(:disabled) {
      border-color: var(--ux-gray-400);
    }

    /* Filled state */
    .ux-otp__field--filled {
      background: var(--ux-surface-secondary);
      border-color: var(--ux-primary);
    }

    /* ========================================
       Separator
    ======================================== */

    .ux-otp__separator {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      color: var(--ux-text-tertiary);
      font-size: 1.25rem;
      font-weight: 600;
    }

    /* ========================================
       Size Variants
    ======================================== */

    /* Small */
    .ux-otp--sm .ux-otp__field {
      width: 40px;
      height: 48px;
      font-size: 1.25rem;
    }

    .ux-otp--sm .ux-otp__separator {
      width: 12px;
      font-size: 1rem;
    }

    /* Large */
    .ux-otp--lg .ux-otp__field {
      width: 56px;
      height: 64px;
      font-size: 1.75rem;
    }

    .ux-otp--lg .ux-otp__separator {
      width: 20px;
      font-size: 1.5rem;
    }

    /* ========================================
       States
    ======================================== */

    /* Success */
    .ux-otp--success .ux-otp__field {
      border-color: var(--ux-success);
    }

    .ux-otp--success .ux-otp__field:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-success-rgb), 0.15);
    }

    /* Error */
    .ux-otp--error .ux-otp__field {
      border-color: var(--ux-danger);
      animation: ux-otp-shake 0.4s ease;
    }

    .ux-otp--error .ux-otp__field:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-danger-rgb), 0.15);
    }

    @keyframes ux-otp-shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-4px); }
      40%, 80% { transform: translateX(4px); }
    }

    /* Disabled */
    .ux-otp--disabled .ux-otp__field {
      background: var(--ux-surface-secondary);
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* Loading */
    .ux-otp--loading .ux-otp__field {
      pointer-events: none;
      opacity: 0.6;
    }

    /* ========================================
       Variants
    ======================================== */

    /* Underline */
    .ux-otp--underline .ux-otp__field {
      border: none;
      border-bottom: 2px solid var(--ux-border-color);
      border-radius: 0;
      background: transparent;
    }

    .ux-otp--underline .ux-otp__field:focus {
      border-bottom-color: var(--ux-primary);
      box-shadow: none;
    }

    .ux-otp--underline .ux-otp__field--filled {
      border-bottom-color: var(--ux-primary);
      background: transparent;
    }

    .ux-otp--underline.ux-otp--error .ux-otp__field {
      border-bottom-color: var(--ux-danger);
    }

    .ux-otp--underline.ux-otp--success .ux-otp__field {
      border-bottom-color: var(--ux-success);
    }

    /* Rounded */
    .ux-otp--rounded .ux-otp__field {
      border-radius: 50%;
      width: 56px;
      height: 56px;
    }

    .ux-otp--rounded.ux-otp--sm .ux-otp__field {
      width: 48px;
      height: 48px;
    }

    .ux-otp--rounded.ux-otp--lg .ux-otp__field {
      width: 64px;
      height: 64px;
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-otp--glass .ux-otp__field {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-otp--glass .ux-otp__field:focus {
      background: var(--ux-glass-bg-thick);
    }

    /* ========================================
       Password/Secure Mode
    ======================================== */

    .ux-otp--secure .ux-otp__field {
      -webkit-text-security: disc;
      font-family: text-security-disc, sans-serif;
    }

    /* ========================================
       Helper Text
    ======================================== */

    .ux-otp-wrapper {
      display: inline-flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-otp__helper {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      text-align: center;
    }

    .ux-otp__helper--error {
      color: var(--ux-danger);
    }

    .ux-otp__helper--success {
      color: var(--ux-success);
    }

    /* ========================================
       Resend Timer
    ======================================== */

    .ux-otp__resend {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-otp__resend-btn {
      background: none;
      border: none;
      padding: 0;
      font: inherit;
      color: var(--ux-primary);
      cursor: pointer;
      text-decoration: underline;
    }

    .ux-otp__resend-btn:hover {
      color: var(--ux-primary-shade);
    }

    .ux-otp__resend-btn:disabled {
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
      text-decoration: none;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-otp__field {
        background: var(--ux-surface);
        border-color: var(--ux-border-color);
      }

      .ux-otp__field--filled {
        background: var(--ux-surface-secondary);
      }
    }

    .ux-dark .ux-otp__field {
      background: var(--ux-surface);
      border-color: var(--ux-border-color);
    }

    .ux-dark .ux-otp__field--filled {
      background: var(--ux-surface-secondary);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-otp--error .ux-otp__field {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-otp-input-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-otp-input-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for OTP input
  const otpInputData = (options = {}) => ({
    // Configuration
    length: options.length || 6,
    type: options.type || 'text', // 'text', 'number', 'password'
    autoFocus: options.autoFocus ?? true,
    autoSubmit: options.autoSubmit ?? true,
    separator: options.separator || null, // Position or array of positions
    placeholder: options.placeholder || '',

    // State
    values: [],
    focused: -1,
    isComplete: false,
    state: options.state || null, // null, 'success', 'error', 'loading'
    disabled: options.disabled || false,

    // Resend functionality
    resendEnabled: options.resendEnabled ?? false,
    resendCooldown: options.resendCooldown || 60,
    resendTimer: 0,
    resendInterval: null,

    init() {
      // Initialize values array
      this.values = new Array(this.length).fill('');

      // Auto focus first field
      if (this.autoFocus && !this.disabled) {
        this.$nextTick(() => {
          const firstInput = this.$el.querySelector('.ux-otp__field');
          if (firstInput) firstInput.focus();
        });
      }

      // Start resend timer if enabled
      if (this.resendEnabled && this.resendCooldown > 0) {
        this.startResendTimer();
      }
    },

    destroy() {
      if (this.resendInterval) {
        clearInterval(this.resendInterval);
      }
    },

    // Get input type
    getInputType() {
      if (this.type === 'password') return 'password';
      if (this.type === 'number') return 'tel';
      return 'text';
    },

    // Get input mode
    getInputMode() {
      if (this.type === 'number') return 'numeric';
      return 'text';
    },

    // Handle input
    onInput(index, event) {
      const input = event.target;
      let value = input.value;

      // Handle paste
      if (value.length > 1) {
        this.handlePaste(value, index);
        return;
      }

      // Validate input based on type
      if (this.type === 'number') {
        value = value.replace(/[^0-9]/g, '');
      }

      // Update value
      this.values[index] = value.slice(-1);
      input.value = this.values[index];

      // Move to next field
      if (value && index < this.length - 1) {
        this.focusField(index + 1);
      }

      this.checkComplete();
      this.dispatchChange();
    },

    // Handle keydown
    onKeyDown(index, event) {
      const key = event.key;

      // Backspace
      if (key === 'Backspace') {
        if (!this.values[index] && index > 0) {
          this.focusField(index - 1);
          this.values[index - 1] = '';
        } else {
          this.values[index] = '';
        }
        this.checkComplete();
        this.dispatchChange();
      }

      // Delete
      if (key === 'Delete') {
        this.values[index] = '';
        this.checkComplete();
        this.dispatchChange();
      }

      // Arrow keys
      if (key === 'ArrowLeft' && index > 0) {
        event.preventDefault();
        this.focusField(index - 1);
      }

      if (key === 'ArrowRight' && index < this.length - 1) {
        event.preventDefault();
        this.focusField(index + 1);
      }

      // Home/End
      if (key === 'Home') {
        event.preventDefault();
        this.focusField(0);
      }

      if (key === 'End') {
        event.preventDefault();
        this.focusField(this.length - 1);
      }
    },

    // Handle paste
    handlePaste(value, startIndex = 0) {
      // Clean value based on type
      if (this.type === 'number') {
        value = value.replace(/[^0-9]/g, '');
      }

      const chars = value.split('');

      for (let i = 0; i < chars.length && startIndex + i < this.length; i++) {
        this.values[startIndex + i] = chars[i];
      }

      // Focus appropriate field
      const nextIndex = Math.min(startIndex + chars.length, this.length - 1);
      this.focusField(nextIndex);

      this.checkComplete();
      this.dispatchChange();
    },

    // Handle paste event
    onPaste(index, event) {
      event.preventDefault();
      const pastedData = event.clipboardData.getData('text');
      this.handlePaste(pastedData, index);
    },

    // Focus field
    focusField(index) {
      this.$nextTick(() => {
        const inputs = this.$el.querySelectorAll('.ux-otp__field');
        if (inputs[index]) {
          inputs[index].focus();
          inputs[index].select();
        }
      });
    },

    // Handle focus
    onFocus(index) {
      this.focused = index;
      // Select content on focus
      this.$nextTick(() => {
        const inputs = this.$el.querySelectorAll('.ux-otp__field');
        if (inputs[index]) inputs[index].select();
      });
    },

    // Handle blur
    onBlur() {
      this.focused = -1;
    },

    // Check if complete
    checkComplete() {
      const complete = this.values.every(v => v !== '');

      if (complete && !this.isComplete) {
        this.isComplete = true;

        // Auto submit
        if (this.autoSubmit) {
          this.$dispatch('otp:complete', {
            value: this.getValue(),
            values: [...this.values]
          });
        }
      } else if (!complete && this.isComplete) {
        this.isComplete = false;
      }
    },

    // Get combined value
    getValue() {
      return this.values.join('');
    },

    // Set value programmatically
    setValue(value) {
      const chars = String(value).split('');
      this.values = new Array(this.length).fill('');

      for (let i = 0; i < chars.length && i < this.length; i++) {
        this.values[i] = chars[i];
      }

      this.checkComplete();
      this.dispatchChange();
    },

    // Clear all values
    clear() {
      this.values = new Array(this.length).fill('');
      this.isComplete = false;
      this.state = null;
      this.focusField(0);
      this.dispatchChange();
    },

    // Set state
    setState(newState) {
      this.state = newState;
      this.$dispatch('otp:state', { state: newState });
    },

    // Check if should show separator
    hasSeparator(index) {
      if (!this.separator) return false;

      if (Array.isArray(this.separator)) {
        return this.separator.includes(index + 1);
      }

      return (index + 1) === this.separator;
    },

    // Dispatch change event
    dispatchChange() {
      this.$dispatch('otp:change', {
        value: this.getValue(),
        values: [...this.values],
        isComplete: this.isComplete
      });
    },

    // Resend functionality
    startResendTimer() {
      this.resendTimer = this.resendCooldown;

      this.resendInterval = setInterval(() => {
        this.resendTimer--;

        if (this.resendTimer <= 0) {
          clearInterval(this.resendInterval);
          this.resendInterval = null;
        }
      }, 1000);
    },

    canResend() {
      return this.resendTimer <= 0;
    },

    resend() {
      if (!this.canResend()) return;

      this.$dispatch('otp:resend');
      this.startResendTimer();
      this.clear();
    },

    // Format time for display
    formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return mins > 0 ? `${mins}:${secs.toString().padStart(2, '0')}` : `${secs}s`;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxOtpInput', otpInputData);
  }

})();

/**
 * UX Pagination Component
 * Pagination control with page navigation, per-page selector, and info display
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Pagination
    ======================================== */

    .ux-pagination {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
      background-color: var(--ux-surface);
      border-radius: var(--ux-border-radius-lg);
      flex-wrap: wrap;
    }

    /* ========================================
       Pagination Info (Showing X to Y of Z)
    ======================================== */

    .ux-pagination__info {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      white-space: nowrap;
    }

    .ux-pagination__info-highlight {
      font-weight: 600;
      color: var(--ux-text);
    }

    /* ========================================
       Pagination Controls (Page Buttons)
    ======================================== */

    .ux-pagination__controls {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    /* ========================================
       Pagination Button (Base)
    ======================================== */

    .ux-pagination__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      height: 36px;
      padding: 0 var(--ux-space-sm);
      background: none;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-pagination__btn:hover:not(:disabled):not(.ux-pagination__btn--active) {
      background-color: var(--ux-surface-secondary);
      border-color: var(--ux-primary);
    }

    .ux-pagination__btn:active:not(:disabled) {
      transform: scale(0.96);
    }

    .ux-pagination__btn:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    .ux-pagination__btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* Active Page Button */
    .ux-pagination__btn--active {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-pagination__btn--active:hover:not(:disabled) {
      background-color: var(--ux-primary-shade);
      border-color: var(--ux-primary-shade);
    }

    /* ========================================
       Previous/Next Arrow Buttons
    ======================================== */

    .ux-pagination__prev,
    .ux-pagination__next {
      min-width: 36px;
      padding: 0;
    }

    .ux-pagination__prev svg,
    .ux-pagination__next svg {
      width: 18px;
      height: 18px;
    }

    /* ========================================
       Ellipsis
    ======================================== */

    .ux-pagination__ellipsis {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      height: 36px;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
      user-select: none;
    }

    /* ========================================
       Per Page Selector
    ======================================== */

    .ux-pagination__per-page {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-pagination__per-page select {
      padding: var(--ux-space-xs) var(--ux-space-sm);
      padding-right: calc(var(--ux-space-sm) + 18px);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      background-color: var(--ux-surface);
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280' stroke-width='2'%3e%3cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right var(--ux-space-xs) center;
      background-size: 16px;
      color: var(--ux-text);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-sm);
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      transition: border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-pagination__per-page select:hover {
      border-color: var(--ux-primary);
    }

    .ux-pagination__per-page select:focus {
      outline: none;
      border-color: var(--ux-primary);
    }

    /* ========================================
       Size Variants
    ======================================== */

    /* Small */
    .ux-pagination--sm .ux-pagination__btn {
      min-width: 28px;
      height: 28px;
      font-size: var(--ux-font-size-xs);
      border-radius: var(--ux-border-radius-sm);
    }

    .ux-pagination--sm .ux-pagination__prev svg,
    .ux-pagination--sm .ux-pagination__next svg {
      width: 14px;
      height: 14px;
    }

    .ux-pagination--sm .ux-pagination__ellipsis {
      min-width: 28px;
      height: 28px;
      font-size: var(--ux-font-size-xs);
    }

    .ux-pagination--sm .ux-pagination__info {
      font-size: var(--ux-font-size-xs);
    }

    .ux-pagination--sm .ux-pagination__per-page {
      font-size: var(--ux-font-size-xs);
    }

    .ux-pagination--sm .ux-pagination__per-page select {
      font-size: var(--ux-font-size-xs);
      padding: 2px var(--ux-space-xs);
      padding-right: calc(var(--ux-space-xs) + 14px);
      background-size: 12px;
    }

    /* Large */
    .ux-pagination--lg .ux-pagination__btn {
      min-width: 44px;
      height: 44px;
      font-size: var(--ux-font-size-md);
      border-radius: var(--ux-border-radius-lg);
    }

    .ux-pagination--lg .ux-pagination__prev svg,
    .ux-pagination--lg .ux-pagination__next svg {
      width: 22px;
      height: 22px;
    }

    .ux-pagination--lg .ux-pagination__ellipsis {
      min-width: 44px;
      height: 44px;
      font-size: var(--ux-font-size-md);
    }

    .ux-pagination--lg .ux-pagination__info {
      font-size: var(--ux-font-size-md);
    }

    .ux-pagination--lg .ux-pagination__per-page {
      font-size: var(--ux-font-size-md);
    }

    .ux-pagination--lg .ux-pagination__per-page select {
      font-size: var(--ux-font-size-md);
      padding: var(--ux-space-sm) var(--ux-space-md);
      padding-right: calc(var(--ux-space-md) + 20px);
      background-size: 18px;
    }

    /* ========================================
       Simple Variant (Prev/Next only)
    ======================================== */

    .ux-pagination--simple {
      justify-content: center;
    }

    .ux-pagination--simple .ux-pagination__controls {
      gap: var(--ux-space-md);
    }

    .ux-pagination--simple .ux-pagination__current {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      font-weight: 500;
    }

    .ux-pagination--simple .ux-pagination__current-separator {
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-pagination--glass {
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-pagination--glass .ux-pagination__btn {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    .ux-pagination--glass .ux-pagination__btn:hover:not(:disabled):not(.ux-pagination__btn--active) {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
    }

    .ux-pagination--glass .ux-pagination__btn--active {
      background: var(--ux-glass-bg-thick);
      border-color: var(--ux-glass-border);
      color: var(--ux-text);
      box-shadow: var(--ux-glass-highlight);
    }

    .ux-pagination--glass .ux-pagination__per-page select {
      background-color: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    .ux-pagination--glass .ux-pagination__per-page select:hover,
    .ux-pagination--glass .ux-pagination__per-page select:focus {
      background-color: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Bordered Variant
    ======================================== */

    .ux-pagination--bordered {
      border: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Compact Layout (no info, centered)
    ======================================== */

    .ux-pagination--compact {
      justify-content: center;
      padding: var(--ux-space-sm);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-pagination {
        flex-direction: column;
        align-items: center;
        gap: var(--ux-space-sm);
      }

      .ux-pagination__info {
        order: 2;
      }

      .ux-pagination__controls {
        order: 1;
      }

      .ux-pagination__per-page {
        order: 3;
      }

      /* Hide page numbers on mobile, show simple nav */
      .ux-pagination:not(.ux-pagination--simple) .ux-pagination__btn:not(.ux-pagination__prev):not(.ux-pagination__next) {
        display: none;
      }

      .ux-pagination:not(.ux-pagination--simple) .ux-pagination__ellipsis {
        display: none;
      }

      /* Show current page indicator on mobile */
      .ux-pagination__mobile-current {
        display: flex;
        align-items: center;
        font-size: var(--ux-font-size-sm);
        color: var(--ux-text);
        font-weight: 500;
        gap: var(--ux-space-xs);
      }

      .ux-pagination__mobile-current-separator {
        color: var(--ux-text-tertiary);
      }
    }

    @media (min-width: 768px) {
      .ux-pagination__mobile-current {
        display: none;
      }
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-pagination--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-pagination__btn {
        transition: none;
      }

      .ux-pagination__btn:active:not(:disabled) {
        transform: none;
      }

      .ux-pagination__per-page select {
        transition: none;
      }
    }
  `;

  // Icons
  const icons = {
    chevronLeft: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>',
    chevronRight: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/></svg>',
    chevronsLeft: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 17l-5-5 5-5M18 17l-5-5 5-5"/></svg>',
    chevronsRight: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 7l5 5-5 5M6 7l5 5-5 5"/></svg>'
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-pagination-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-pagination-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for pagination
  // ARIA: role="navigation", aria-label for pagination
  const paginationComponent = (config = {}) => ({
    // State
    currentPage: config.currentPage || 1,
    totalPages: config.totalPages || 1,
    totalItems: config.totalItems || 0,
    perPage: config.perPage || 10,
    perPageOptions: config.perPageOptions || [10, 25, 50, 100],

    // Options
    showInfo: config.showInfo !== false,
    showPerPage: config.showPerPage !== false,
    showFirstLast: config.showFirstLast || false,
    siblingCount: config.siblingCount || 1,
    boundaryCount: config.boundaryCount || 1,
    disabled: config.disabled || false,

    // Labels (for i18n)
    labels: {
      showing: config.labels?.showing || 'Showing',
      to: config.labels?.to || 'to',
      of: config.labels?.of || 'of',
      items: config.labels?.items || 'items',
      perPage: config.labels?.perPage || 'per page',
      first: config.labels?.first || 'First',
      last: config.labels?.last || 'Last',
      previous: config.labels?.previous || 'Previous',
      next: config.labels?.next || 'Next',
      page: config.labels?.page || 'Page',
      ...config.labels
    },

    // Component ID
    paginationId: config.id || 'ux-pagination-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for navigation
    get ariaAttrs() {
      return {
        'role': 'navigation',
        'aria-label': config.ariaLabel || 'Pagination navigation'
      };
    },

    // Initialize
    init() {
      // Validate current page
      this.validateCurrentPage();

      // Watch for external changes
      this.$watch('totalPages', () => this.validateCurrentPage());
      this.$watch('totalItems', () => this.recalculateTotalPages());
    },

    // Validate and adjust current page
    validateCurrentPage() {
      if (this.currentPage < 1) {
        this.currentPage = 1;
      } else if (this.currentPage > this.totalPages && this.totalPages > 0) {
        this.currentPage = this.totalPages;
      }
    },

    // Recalculate total pages when totalItems changes
    recalculateTotalPages() {
      if (this.totalItems > 0) {
        this.totalPages = Math.ceil(this.totalItems / this.perPage);
        this.validateCurrentPage();
      }
    },

    // Computed: Visible pages with ellipsis
    get visiblePages() {
      const total = this.totalPages;
      const current = this.currentPage;
      const sibling = this.siblingCount;
      const boundary = this.boundaryCount;

      if (total <= 0) return [];

      // Calculate range
      const range = (start, end) => {
        const length = end - start + 1;
        return Array.from({ length }, (_, i) => start + i);
      };

      // Total page numbers to display (excluding ellipsis)
      const totalPageNumbers = boundary * 2 + sibling * 2 + 3;

      // If total pages is less than page numbers we want to show
      if (total <= totalPageNumbers) {
        return range(1, total);
      }

      const leftSiblingIndex = Math.max(current - sibling, boundary + 1);
      const rightSiblingIndex = Math.min(current + sibling, total - boundary);

      const showLeftEllipsis = leftSiblingIndex > boundary + 2;
      const showRightEllipsis = rightSiblingIndex < total - boundary - 1;

      const pages = [];

      // Add left boundary pages
      for (let i = 1; i <= boundary; i++) {
        pages.push(i);
      }

      // Add left ellipsis
      if (showLeftEllipsis) {
        pages.push('...');
      } else if (boundary + 1 < leftSiblingIndex) {
        // Add pages between boundary and sibling
        for (let i = boundary + 1; i < leftSiblingIndex; i++) {
          pages.push(i);
        }
      }

      // Add sibling pages
      for (let i = leftSiblingIndex; i <= rightSiblingIndex; i++) {
        if (i > boundary && i <= total - boundary) {
          pages.push(i);
        }
      }

      // Add right ellipsis
      if (showRightEllipsis) {
        pages.push('...');
      } else if (rightSiblingIndex < total - boundary) {
        // Add pages between sibling and boundary
        for (let i = rightSiblingIndex + 1; i <= total - boundary; i++) {
          pages.push(i);
        }
      }

      // Add right boundary pages
      for (let i = total - boundary + 1; i <= total; i++) {
        if (i > boundary) {
          pages.push(i);
        }
      }

      return pages;
    },

    // Computed: Showing info text
    get showingInfo() {
      if (this.totalItems <= 0) return '';

      const start = (this.currentPage - 1) * this.perPage + 1;
      const end = Math.min(this.currentPage * this.perPage, this.totalItems);

      return {
        start,
        end,
        total: this.totalItems,
        text: `${this.labels.showing} ${start} ${this.labels.to} ${end} ${this.labels.of} ${this.totalItems} ${this.labels.items}`
      };
    },

    // Computed: Can go previous
    get canGoPrevious() {
      return this.currentPage > 1 && !this.disabled;
    },

    // Computed: Can go next
    get canGoNext() {
      return this.currentPage < this.totalPages && !this.disabled;
    },

    // Computed: Can go first
    get canGoFirst() {
      return this.currentPage > 1 && !this.disabled;
    },

    // Computed: Can go last
    get canGoLast() {
      return this.currentPage < this.totalPages && !this.disabled;
    },

    // Navigate to page
    goToPage(page) {
      if (this.disabled) return;
      if (typeof page !== 'number') return;
      if (page < 1 || page > this.totalPages) return;
      if (page === this.currentPage) return;

      this.currentPage = page;
      this.$dispatch('page-change', {
        page: this.currentPage,
        perPage: this.perPage,
        totalPages: this.totalPages,
        totalItems: this.totalItems
      });
    },

    // Previous page
    prevPage() {
      if (this.canGoPrevious) {
        this.goToPage(this.currentPage - 1);
      }
    },

    // Next page
    nextPage() {
      if (this.canGoNext) {
        this.goToPage(this.currentPage + 1);
      }
    },

    // First page
    firstPage() {
      if (this.canGoFirst) {
        this.goToPage(1);
      }
    },

    // Last page
    lastPage() {
      if (this.canGoLast) {
        this.goToPage(this.totalPages);
      }
    },

    // Change per page
    changePerPage(value) {
      if (this.disabled) return;

      const newPerPage = parseInt(value);
      if (isNaN(newPerPage) || newPerPage < 1) return;

      this.perPage = newPerPage;

      // Recalculate total pages if we have totalItems
      if (this.totalItems > 0) {
        this.totalPages = Math.ceil(this.totalItems / this.perPage);
      }

      // Adjust current page if needed
      if (this.currentPage > this.totalPages) {
        this.currentPage = Math.max(1, this.totalPages);
      }

      this.$dispatch('per-page-change', {
        perPage: this.perPage,
        page: this.currentPage,
        totalPages: this.totalPages,
        totalItems: this.totalItems
      });
    },

    // Check if page is active
    isActive(page) {
      return this.currentPage === page;
    },

    // Get button aria label
    getPageAriaLabel(page) {
      if (page === '...') return null;
      if (this.isActive(page)) {
        return `${this.labels.page} ${page}, current page`;
      }
      return `Go to ${this.labels.page.toLowerCase()} ${page}`;
    },

    // Get icon
    getIcon(name) {
      return icons[name] || '';
    },

    // Update state externally
    setPage(page) {
      this.currentPage = page;
      this.validateCurrentPage();
    },

    setTotalPages(total) {
      this.totalPages = total;
      this.validateCurrentPage();
    },

    setTotalItems(total) {
      this.totalItems = total;
      this.recalculateTotalPages();
    },

    setPerPage(perPage) {
      this.changePerPage(perPage);
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxPagination', paginationComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxPagination', paginationComponent);
    });
  }
})();

/**
 * UX Panel Component
 * Collapsible panel with header and content
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Panel
    ======================================== */

    :root {
      --ux-panel-border-radius: var(--ux-radius-lg);
      --ux-panel-padding: var(--ux-space-md);
      --ux-panel-header-padding: var(--ux-space-md);
      --ux-panel-gap: var(--ux-space-md);
      --ux-panel-transition: var(--ux-transition-normal);
    }

    .ux-panel {
      display: flex;
      flex-direction: column;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-panel-border-radius);
      overflow: hidden;
      font-family: var(--ux-font-family);
    }

    /* ========================================
       Panel Header
    ======================================== */

    .ux-panel__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-sm);
      padding: var(--ux-panel-header-padding);
      background: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
      cursor: pointer;
      user-select: none;
      transition: background-color var(--ux-panel-transition);
    }

    .ux-panel__header:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-panel__header:focus {
      outline: none;
    }

    .ux-panel__header:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: -2px;
    }

    /* Header content */
    .ux-panel__header-content {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      flex: 1;
      min-width: 0;
    }

    .ux-panel__icon {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      color: var(--ux-text-secondary);
    }

    .ux-panel__title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-panel__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Header actions */
    .ux-panel__actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      flex-shrink: 0;
    }

    /* Toggle indicator */
    .ux-panel__toggle {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      color: var(--ux-text-tertiary);
      transition: transform var(--ux-panel-transition);
    }

    .ux-panel--open .ux-panel__toggle {
      transform: rotate(180deg);
    }

    /* ========================================
       Panel Content
    ======================================== */

    .ux-panel__body {
      display: grid;
      grid-template-rows: 0fr;
      transition: grid-template-rows var(--ux-panel-transition) var(--ux-ease-default);
    }

    .ux-panel--open .ux-panel__body {
      grid-template-rows: 1fr;
    }

    .ux-panel__content {
      overflow: hidden;
    }

    .ux-panel__content-inner {
      padding: var(--ux-panel-padding);
    }

    /* ========================================
       Panel Footer
    ======================================== */

    .ux-panel__footer {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-panel-padding);
      border-top: 1px solid var(--ux-border-color);
      background: var(--ux-surface-secondary);
    }

    .ux-panel--open .ux-panel__footer {
      display: flex;
    }

    .ux-panel:not(.ux-panel--open) .ux-panel__footer {
      display: none;
    }

    /* ========================================
       Variants
    ======================================== */

    /* No border on header when open */
    .ux-panel--flush .ux-panel__header {
      background: transparent;
      border-bottom-color: transparent;
    }

    .ux-panel--flush.ux-panel--open .ux-panel__header {
      border-bottom-color: var(--ux-border-color);
    }

    /* Outline variant */
    .ux-panel--outline {
      background: transparent;
    }

    .ux-panel--outline .ux-panel__header {
      background: transparent;
    }

    .ux-panel--outline .ux-panel__header:hover {
      background: var(--ux-surface-secondary);
    }

    /* Filled variant */
    .ux-panel--filled {
      border: none;
    }

    .ux-panel--filled .ux-panel__header {
      background: var(--ux-surface-tertiary);
    }

    .ux-panel--filled .ux-panel__header:hover {
      background: var(--ux-gray-200);
    }

    /* Borderless */
    .ux-panel--borderless {
      border: none;
      border-radius: 0;
    }

    .ux-panel--borderless .ux-panel__header {
      border-bottom: none;
      background: transparent;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-panel--sm {
      --ux-panel-border-radius: var(--ux-radius-md);
      --ux-panel-padding: var(--ux-space-sm);
      --ux-panel-header-padding: var(--ux-space-sm);
    }

    .ux-panel--sm .ux-panel__title {
      font-size: var(--ux-font-size-sm);
    }

    .ux-panel--sm .ux-panel__toggle,
    .ux-panel--sm .ux-panel__icon {
      width: 16px;
      height: 16px;
    }

    .ux-panel--lg {
      --ux-panel-border-radius: var(--ux-radius-xl);
      --ux-panel-padding: var(--ux-space-lg);
      --ux-panel-header-padding: var(--ux-space-lg);
    }

    .ux-panel--lg .ux-panel__title {
      font-size: var(--ux-font-size-lg);
    }

    .ux-panel--lg .ux-panel__toggle,
    .ux-panel--lg .ux-panel__icon {
      width: 24px;
      height: 24px;
    }

    /* ========================================
       States
    ======================================== */

    /* Disabled */
    .ux-panel--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    .ux-panel--disabled .ux-panel__header {
      cursor: not-allowed;
    }

    /* Loading */
    .ux-panel--loading .ux-panel__content-inner {
      position: relative;
      min-height: 100px;
    }

    .ux-panel--loading .ux-panel__content-inner::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 24px;
      height: 24px;
      margin: -12px 0 0 -12px;
      border: 2px solid var(--ux-border-color);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-panel-spin 0.8s linear infinite;
    }

    @keyframes ux-panel-spin {
      to { transform: rotate(360deg); }
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-panel--primary .ux-panel__header {
      background: rgba(var(--ux-primary-rgb), 0.1);
      border-bottom-color: rgba(var(--ux-primary-rgb), 0.2);
    }

    .ux-panel--primary .ux-panel__title {
      color: var(--ux-primary);
    }

    .ux-panel--success .ux-panel__header {
      background: rgba(var(--ux-success-rgb), 0.1);
      border-bottom-color: rgba(var(--ux-success-rgb), 0.2);
    }

    .ux-panel--success .ux-panel__title {
      color: var(--ux-success);
    }

    .ux-panel--warning .ux-panel__header {
      background: rgba(var(--ux-warning-rgb), 0.1);
      border-bottom-color: rgba(var(--ux-warning-rgb), 0.2);
    }

    .ux-panel--warning .ux-panel__title {
      color: var(--ux-warning-shade);
    }

    .ux-panel--danger .ux-panel__header {
      background: rgba(var(--ux-danger-rgb), 0.1);
      border-bottom-color: rgba(var(--ux-danger-rgb), 0.2);
    }

    .ux-panel--danger .ux-panel__title {
      color: var(--ux-danger);
    }

    /* ========================================
       Panel Group
    ======================================== */

    .ux-panel-group {
      display: flex;
      flex-direction: column;
      gap: var(--ux-panel-gap);
    }

    /* Accordion style (connected panels) */
    .ux-panel-group--accordion {
      gap: 0;
    }

    .ux-panel-group--accordion .ux-panel {
      border-radius: 0;
      margin-top: -1px;
    }

    .ux-panel-group--accordion .ux-panel:first-child {
      border-radius: var(--ux-panel-border-radius) var(--ux-panel-border-radius) 0 0;
      margin-top: 0;
    }

    .ux-panel-group--accordion .ux-panel:last-child {
      border-radius: 0 0 var(--ux-panel-border-radius) var(--ux-panel-border-radius);
    }

    .ux-panel-group--accordion .ux-panel:only-child {
      border-radius: var(--ux-panel-border-radius);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-panel--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-panel--glass .ux-panel__header {
      background: rgba(255, 255, 255, 0.3);
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-panel--glass .ux-panel__header:hover {
      background: rgba(255, 255, 255, 0.4);
    }

    .ux-panel--glass .ux-panel__footer {
      background: rgba(255, 255, 255, 0.2);
      border-top-color: var(--ux-glass-border);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-panel--glass .ux-panel__header {
        background: rgba(255, 255, 255, 0.05);
      }

      .ux-panel--glass .ux-panel__header:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .ux-panel--glass .ux-panel__footer {
        background: rgba(255, 255, 255, 0.03);
      }

      .ux-panel--filled .ux-panel__header:hover {
        background: var(--ux-gray-700);
      }
    }

    .ux-dark .ux-panel--glass .ux-panel__header {
      background: rgba(255, 255, 255, 0.05);
    }

    .ux-dark .ux-panel--glass .ux-panel__header:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .ux-dark .ux-panel--glass .ux-panel__footer {
      background: rgba(255, 255, 255, 0.03);
    }

    .ux-dark .ux-panel--filled .ux-panel__header:hover {
      background: var(--ux-gray-700);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-panel__body {
        transition: none;
      }

      .ux-panel__toggle {
        transition: none;
      }

      .ux-panel--loading .ux-panel__content-inner::after {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-panel-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-panel-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const panelData = (options = {}) => ({
    isOpen: options.open ?? false,
    disabled: options.disabled ?? false,

    init() {
      // Dispatch initial state
      if (this.isOpen) {
        this.$dispatch('panel:open');
      }
    },

    toggle() {
      if (this.disabled) return;
      this.isOpen = !this.isOpen;
      this.$dispatch(this.isOpen ? 'panel:open' : 'panel:close');
      this.$dispatch('panel:toggle', { open: this.isOpen });
    },

    open() {
      if (this.disabled || this.isOpen) return;
      this.isOpen = true;
      this.$dispatch('panel:open');
      this.$dispatch('panel:toggle', { open: true });
    },

    close() {
      if (this.disabled || !this.isOpen) return;
      this.isOpen = false;
      this.$dispatch('panel:close');
      this.$dispatch('panel:toggle', { open: false });
    }
  });

  // Alpine.js panel group component (accordion behavior)
  const panelGroupData = (options = {}) => ({
    accordion: options.accordion ?? false,
    openPanels: new Set(),

    init() {
      // Listen for child panel events
      this.$el.addEventListener('panel:toggle', (e) => {
        if (!this.accordion) return;

        const panel = e.target.closest('[x-data*="uxPanel"]');
        if (!panel) return;

        if (e.detail.open) {
          // Close other panels in accordion mode
          this.$el.querySelectorAll('[x-data*="uxPanel"]').forEach(p => {
            if (p !== panel && p.__x) {
              p.__x.$data.close();
            }
          });
        }
      });
    },

    openAll() {
      if (this.accordion) return;
      this.$el.querySelectorAll('[x-data*="uxPanel"]').forEach(p => {
        if (p.__x) p.__x.$data.open();
      });
    },

    closeAll() {
      this.$el.querySelectorAll('[x-data*="uxPanel"]').forEach(p => {
        if (p.__x) p.__x.$data.close();
      });
    }
  });

  // Alpine.js panel detail component (main + aside with mobile drawer)
  const panelDetailData = (options = {}) => ({
    isAsideOpen: false,
    breakpoint: options.breakpoint ?? 768,

    init() {
      // Check initial viewport
      this.checkViewport();
      window.addEventListener('resize', () => this.checkViewport());
    },

    checkViewport() {
      // Auto-close aside on desktop
      if (window.innerWidth >= this.breakpoint) {
        this.isAsideOpen = false;
      }
    },

    toggleAside() {
      this.isAsideOpen = !this.isAsideOpen;
      if (this.isAsideOpen) {
        window.UX?.lockScroll?.();
      } else {
        window.UX?.unlockScroll?.();
      }
    },

    openAside() {
      this.isAsideOpen = true;
      window.UX?.lockScroll?.();
    },

    closeAside() {
      this.isAsideOpen = false;
      window.UX?.unlockScroll?.();
    }
  });

  // Register components
  if (window.UX) {
    window.UX.registerComponent('uxPanel', panelData);
    window.UX.registerComponent('uxPanelGroup', panelGroupData);
    window.UX.registerComponent('uxPanelDetail', panelDetailData);
  }

})();

/**
 * UX Payment Selector Component
 * Payment method selection, split payments, and change calculator for POS
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Payment Method Selector
       ========================================================================== */

    :root {
      --ux-payment-method-gap: var(--ux-space-sm);
      --ux-payment-method-padding: var(--ux-space-md);
      --ux-payment-method-radius: var(--ux-radius-lg);
      --ux-payment-method-border: 2px solid var(--ux-border-color);
      --ux-payment-method-bg: var(--ux-surface);
      --ux-payment-method-selected-bg: var(--ux-primary-tint);
      --ux-payment-method-selected-border: var(--ux-primary);
      --ux-payment-icon-size: 32px;
      --ux-payment-quick-size: 56px;
    }

    .ux-payment {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-lg);
    }

    .ux-payment__section {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-payment__label {
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ==========================================================================
       Payment Methods Grid
       ========================================================================== */

    .ux-payment-methods {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--ux-payment-method-gap);
    }

    .ux-payment-methods--list {
      grid-template-columns: 1fr;
    }

    .ux-payment-methods--2col {
      grid-template-columns: repeat(2, 1fr);
    }

    .ux-payment-methods--3col {
      grid-template-columns: repeat(3, 1fr);
    }

    .ux-payment-method {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-payment-method-padding);
      background: var(--ux-payment-method-bg);
      border: var(--ux-payment-method-border);
      border-radius: var(--ux-payment-method-radius);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease-out);
      min-height: 80px;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-payment-method:active {
      transform: scale(0.97);
    }

    .ux-payment-method--selected {
      background: var(--ux-payment-method-selected-bg);
      border-color: var(--ux-payment-method-selected-border);
      box-shadow: 0 0 0 1px var(--ux-payment-method-selected-border);
    }

    .ux-payment-method--disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .ux-payment-method--horizontal {
      flex-direction: row;
      justify-content: flex-start;
      gap: var(--ux-space-md);
      min-height: auto;
      padding: var(--ux-space-md) var(--ux-space-lg);
    }

    .ux-payment-method__icon {
      width: var(--ux-payment-icon-size);
      height: var(--ux-payment-icon-size);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--ux-text-secondary);
      transition: color var(--ux-transition-fast);
    }

    .ux-payment-method__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-payment-method--selected .ux-payment-method__icon {
      color: var(--ux-primary);
    }

    .ux-payment-method__name {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ux-text);
      text-align: center;
    }

    .ux-payment-method--horizontal .ux-payment-method__name {
      text-align: left;
    }

    .ux-payment-method__desc {
      font-size: 0.75rem;
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       Quick Amounts
       ========================================================================== */

    .ux-payment-quick {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--ux-space-sm);
    }

    .ux-payment-quick--3col {
      grid-template-columns: repeat(3, 1fr);
    }

    .ux-payment-quick--5col {
      grid-template-columns: repeat(5, 1fr);
    }

    .ux-payment-quick__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      height: var(--ux-payment-quick-size);
      background: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      font-size: 1rem;
      font-weight: 600;
      color: var(--ux-text);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease-out);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-payment-quick__btn:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-payment-quick__btn:active {
      transform: scale(0.95);
      background: var(--ux-primary-tint);
    }

    .ux-payment-quick__btn--exact {
      background: var(--ux-success-tint);
      border-color: var(--ux-success);
      color: var(--ux-success-shade);
    }

    .ux-payment-quick__btn--exact:hover {
      background: var(--ux-success);
      color: white;
    }

    /* ==========================================================================
       Change Calculator
       ========================================================================== */

    .ux-payment-change {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md);
      padding: var(--ux-space-lg);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-lg);
    }

    .ux-payment-change__row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .ux-payment-change__label {
      font-size: 0.9375rem;
      color: var(--ux-text-secondary);
    }

    .ux-payment-change__value {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
    }

    .ux-payment-change__row--total {
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-payment-change__row--total .ux-payment-change__label {
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-payment-change__row--total .ux-payment-change__value {
      font-size: 1.5rem;
      color: var(--ux-primary);
    }

    .ux-payment-change__row--change .ux-payment-change__value {
      color: var(--ux-success);
    }

    .ux-payment-change__row--due .ux-payment-change__value {
      color: var(--ux-danger);
    }

    /* ==========================================================================
       Split Payment
       ========================================================================== */

    .ux-payment-split {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md);
    }

    .ux-payment-split__item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
    }

    .ux-payment-split__method {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      flex: 1;
    }

    .ux-payment-split__method-icon {
      width: 24px;
      height: 24px;
      color: var(--ux-text-secondary);
    }

    .ux-payment-split__method-name {
      font-size: 0.9375rem;
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-payment-split__amount {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
      min-width: 80px;
      text-align: right;
    }

    .ux-payment-split__remove {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: var(--ux-danger-tint);
      border: none;
      border-radius: 50%;
      color: var(--ux-danger);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-payment-split__remove:hover {
      background: var(--ux-danger);
      color: white;
    }

    .ux-payment-split__add {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md);
      background: transparent;
      border: 2px dashed var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      color: var(--ux-text-secondary);
      font-size: 0.9375rem;
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-payment-split__add:hover {
      border-color: var(--ux-primary);
      color: var(--ux-primary);
      background: var(--ux-primary-tint);
    }

    /* ==========================================================================
       Payment Summary
       ========================================================================== */

    .ux-payment-summary {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-lg);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
    }

    .ux-payment-summary__row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9375rem;
    }

    .ux-payment-summary__label {
      color: var(--ux-text-secondary);
    }

    .ux-payment-summary__value {
      font-weight: 500;
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
    }

    .ux-payment-summary__row--total {
      padding-top: var(--ux-space-md);
      margin-top: var(--ux-space-sm);
      border-top: 2px solid var(--ux-border-color);
    }

    .ux-payment-summary__row--total .ux-payment-summary__label {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-payment-summary__row--total .ux-payment-summary__value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--ux-primary);
    }

    /* ==========================================================================
       Payment Actions
       ========================================================================== */

    .ux-payment-actions {
      display: flex;
      gap: var(--ux-space-sm);
    }

    .ux-payment-actions--stacked {
      flex-direction: column;
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-payment--glass .ux-payment-method {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    .ux-payment--glass .ux-payment-method--selected {
      background: rgba(var(--ux-primary-rgb), 0.2);
    }

    .ux-payment--glass .ux-payment-change,
    .ux-payment--glass .ux-payment-summary {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    .ux-payment--glass .ux-payment-quick__btn {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    .ux-payment--glass .ux-payment-split__item {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    /* ==========================================================================
       Compact Variant
       ========================================================================== */

    .ux-payment--compact .ux-payment-method {
      min-height: 60px;
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    .ux-payment--compact .ux-payment-method__icon {
      width: 24px;
      height: 24px;
    }

    .ux-payment--compact .ux-payment-quick__btn {
      height: 44px;
      font-size: 0.875rem;
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root {
        --ux-payment-method-bg: var(--ux-gray-800);
        --ux-payment-method-selected-bg: rgba(var(--ux-primary-rgb), 0.2);
      }

      .ux-payment-quick__btn {
        background: var(--ux-gray-800);
        border-color: var(--ux-gray-700);
      }

      .ux-payment-quick__btn:hover {
        background: var(--ux-gray-700);
      }

      .ux-payment-quick__btn--exact {
        background: rgba(var(--ux-success-rgb), 0.2);
      }
    }

    .ux-dark {
      --ux-payment-method-bg: var(--ux-gray-800);
      --ux-payment-method-selected-bg: rgba(var(--ux-primary-rgb), 0.2);
    }

    .ux-dark .ux-payment-quick__btn {
      background: var(--ux-gray-800);
      border-color: var(--ux-gray-700);
    }

    .ux-dark .ux-payment-quick__btn:hover {
      background: var(--ux-gray-700);
    }

    .ux-dark .ux-payment-quick__btn--exact {
      background: rgba(var(--ux-success-rgb), 0.2);
    }

    /* ==========================================================================
       Responsive
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-payment-methods {
        grid-template-columns: repeat(2, 1fr);
      }

      .ux-payment-quick {
        grid-template-columns: repeat(3, 1fr);
      }

      .ux-payment-actions {
        flex-direction: column;
      }
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-payment-method,
      .ux-payment-quick__btn {
        transition: none;
      }
    }
  `;

  // Payment method icons
  const icons = {
    cash: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <rect x="2" y="6" width="20" height="12" rx="2"/>
      <circle cx="12" cy="12" r="3"/>
      <path d="M6 12h.01M18 12h.01"/>
    </svg>`,
    card: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <rect x="2" y="4" width="20" height="16" rx="2"/>
      <path d="M2 10h20"/>
      <path d="M6 14h4"/>
    </svg>`,
    contactless: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M6 12a6 6 0 0 1 6-6"/>
      <path d="M6 16a10 10 0 0 1 10-10"/>
      <path d="M6 20a14 14 0 0 1 14-14"/>
      <circle cx="6" cy="20" r="2" fill="currentColor"/>
    </svg>`,
    wallet: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <rect x="2" y="4" width="20" height="16" rx="2"/>
      <path d="M22 10H18a2 2 0 0 0-2 2v0a2 2 0 0 0 2 2h4"/>
      <circle cx="18" cy="12" r="1" fill="currentColor"/>
    </svg>`,
    transfer: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M17 3L21 7L17 11"/>
      <path d="M21 7H3"/>
      <path d="M7 21L3 17L7 13"/>
      <path d="M3 17h18"/>
    </svg>`,
    voucher: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M2 9a3 3 0 0 1 0 6v4a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-4a3 3 0 0 1 0-6V5a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v4Z"/>
      <path d="M9 4v16"/>
    </svg>`,
    crypto: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"/>
      <path d="M9.5 9.5c0-1.5 1-2.5 2.5-2.5s2.5 1 2.5 2.5c0 1-0.5 1.5-1.5 2l-1 0.5V14"/>
      <circle cx="12" cy="16.5" r="0.5" fill="currentColor"/>
    </svg>`,
    qr: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="3" width="7" height="7" rx="1"/>
      <rect x="14" y="3" width="7" height="7" rx="1"/>
      <rect x="3" y="14" width="7" height="7" rx="1"/>
      <rect x="14" y="14" width="3" height="3"/>
      <path d="M18 14v3h3"/>
      <path d="M14 18h3v3"/>
    </svg>`,
    check: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="5" width="18" height="14" rx="2"/>
      <path d="M7 15h6"/>
      <path d="M7 11h10"/>
    </svg>`,
    plus: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 5v14M5 12h14"/>
    </svg>`,
    close: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M18 6L6 18M6 6l12 12"/>
    </svg>`
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-payment-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-payment-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const paymentData = (options = {}) => ({
    // Configuration
    total: options.total || 0,
    currency: options.currency || 'â¬',
    currencyPosition: options.currencyPosition || 'after', // 'before' or 'after'
    quickAmounts: options.quickAmounts || [5, 10, 20, 50, 100],
    methods: options.methods || [
      { id: 'cash', name: 'Efectivo', icon: 'cash' },
      { id: 'card', name: 'Tarjeta', icon: 'card' },
      { id: 'contactless', name: 'Contactless', icon: 'contactless' }
    ],
    allowSplit: options.allowSplit ?? false,
    showChange: options.showChange ?? true,

    // State
    selectedMethod: options.defaultMethod || null,
    amountReceived: 0,
    splitPayments: [],
    icons: icons,

    // Computed
    get change() {
      if (this.allowSplit) {
        const totalPaid = this.splitPayments.reduce((sum, p) => sum + p.amount, 0);
        return Math.max(0, totalPaid - this.total);
      }
      return Math.max(0, this.amountReceived - this.total);
    },

    get amountDue() {
      if (this.allowSplit) {
        const totalPaid = this.splitPayments.reduce((sum, p) => sum + p.amount, 0);
        return Math.max(0, this.total - totalPaid);
      }
      return Math.max(0, this.total - this.amountReceived);
    },

    get isPaid() {
      if (this.allowSplit) {
        const totalPaid = this.splitPayments.reduce((sum, p) => sum + p.amount, 0);
        return totalPaid >= this.total;
      }
      return this.amountReceived >= this.total;
    },

    get totalPaid() {
      if (this.allowSplit) {
        return this.splitPayments.reduce((sum, p) => sum + p.amount, 0);
      }
      return this.amountReceived;
    },

    // Methods
    init() {
      if (this.methods.length > 0 && !this.selectedMethod) {
        this.selectedMethod = this.methods[0].id;
      }
    },

    formatCurrency(amount) {
      const formatted = amount.toFixed(2);
      return this.currencyPosition === 'before'
        ? `${this.currency}${formatted}`
        : `${formatted}${this.currency}`;
    },

    selectMethod(methodId) {
      this.selectedMethod = methodId;
      this.$dispatch('payment:method-selected', {
        method: methodId,
        methodData: this.methods.find(m => m.id === methodId)
      });
    },

    setAmount(amount) {
      this.amountReceived = amount;
      this.$dispatch('payment:amount-changed', {
        amount: amount,
        change: this.change,
        isPaid: this.isPaid
      });
    },

    addQuickAmount(amount) {
      this.amountReceived = amount;
      this.$dispatch('payment:amount-changed', {
        amount: amount,
        change: this.change,
        isPaid: this.isPaid
      });
    },

    setExactAmount() {
      this.amountReceived = this.total;
      this.$dispatch('payment:amount-changed', {
        amount: this.total,
        change: 0,
        isPaid: true
      });
    },

    // Split payment methods
    addSplitPayment(methodId, amount) {
      const method = this.methods.find(m => m.id === methodId);
      if (method) {
        this.splitPayments.push({
          id: Date.now(),
          methodId: methodId,
          method: method,
          amount: amount || this.amountDue
        });
        this.$dispatch('payment:split-added', {
          payments: this.splitPayments,
          totalPaid: this.totalPaid,
          amountDue: this.amountDue
        });
      }
    },

    removeSplitPayment(paymentId) {
      const index = this.splitPayments.findIndex(p => p.id === paymentId);
      if (index > -1) {
        this.splitPayments.splice(index, 1);
        this.$dispatch('payment:split-removed', {
          payments: this.splitPayments,
          totalPaid: this.totalPaid,
          amountDue: this.amountDue
        });
      }
    },

    updateSplitAmount(paymentId, amount) {
      const payment = this.splitPayments.find(p => p.id === paymentId);
      if (payment) {
        payment.amount = amount;
        this.$dispatch('payment:split-updated', {
          payments: this.splitPayments,
          totalPaid: this.totalPaid,
          amountDue: this.amountDue
        });
      }
    },

    clearSplitPayments() {
      this.splitPayments = [];
      this.$dispatch('payment:split-cleared');
    },

    // Process payment
    processPayment() {
      if (!this.isPaid) {
        this.$dispatch('payment:insufficient', {
          total: this.total,
          paid: this.totalPaid,
          due: this.amountDue
        });
        return false;
      }

      const paymentData = {
        total: this.total,
        method: this.selectedMethod,
        amountReceived: this.amountReceived,
        change: this.change,
        splitPayments: this.splitPayments.length > 0 ? [...this.splitPayments] : null
      };

      this.$dispatch('payment:processed', paymentData);
      return true;
    },

    reset() {
      this.amountReceived = 0;
      this.splitPayments = [];
      if (this.methods.length > 0) {
        this.selectedMethod = this.methods[0].id;
      }
      this.$dispatch('payment:reset');
    },

    getIcon(name) {
      return this.icons[name] || this.icons.cash;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxPayment', paymentData);
  }
})();

(function() {
  'use strict';

  const styles = `
    :root {
      --ux-pdf-viewer-bg: var(--ux-gray-100);
      --ux-pdf-viewer-toolbar-bg: var(--ux-surface);
      --ux-pdf-viewer-toolbar-height: 48px;
      --ux-pdf-viewer-page-bg: var(--ux-surface);
      --ux-pdf-viewer-page-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      --ux-pdf-viewer-border-radius: var(--ux-radius-lg);
    }

    .ux-pdf-viewer {
      display: flex;
      flex-direction: column;
      background: var(--ux-pdf-viewer-bg);
      border-radius: var(--ux-pdf-viewer-border-radius);
      overflow: hidden;
      height: 600px;
      position: relative;
    }

    .ux-pdf-viewer--fullscreen {
      position: fixed;
      inset: 0;
      z-index: var(--ux-z-modal);
      height: 100dvh;
      border-radius: 0;
    }

    /* Toolbar */
    .ux-pdf-viewer__toolbar {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: 0 var(--ux-space-md);
      height: var(--ux-pdf-viewer-toolbar-height);
      background: var(--ux-pdf-viewer-toolbar-bg);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-pdf-viewer__toolbar-group {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-pdf-viewer__toolbar-separator {
      width: 1px;
      height: 24px;
      background: var(--ux-border-color);
      margin: 0 var(--ux-space-xs);
    }

    .ux-pdf-viewer__toolbar-spacer {
      flex: 1;
    }

    /* Toolbar buttons */
    .ux-pdf-viewer__btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border: none;
      background: transparent;
      border-radius: var(--ux-radius-md);
      color: var(--ux-text);
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-pdf-viewer__btn:hover {
      background: var(--ux-gray-100);
    }

    .ux-pdf-viewer__btn:active {
      background: var(--ux-gray-200);
    }

    .ux-pdf-viewer__btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .ux-pdf-viewer__btn svg {
      width: 20px;
      height: 20px;
    }

    /* Page input */
    .ux-pdf-viewer__page-input {
      width: 48px;
      height: 32px;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-sm);
      text-align: center;
      font-size: var(--ux-font-size-sm);
      background: var(--ux-surface);
      color: var(--ux-text);
    }

    .ux-pdf-viewer__page-total {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* Zoom select */
    .ux-pdf-viewer__zoom-select {
      height: 32px;
      padding: 0 var(--ux-space-sm);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-sm);
      background: var(--ux-surface);
      color: var(--ux-text);
      font-size: var(--ux-font-size-sm);
      cursor: pointer;
    }

    /* Container */
    .ux-pdf-viewer__container {
      flex: 1;
      overflow: auto;
      padding: var(--ux-space-lg);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-md);
    }

    /* Page */
    .ux-pdf-viewer__page {
      background: var(--ux-pdf-viewer-page-bg);
      box-shadow: var(--ux-pdf-viewer-page-shadow);
      position: relative;
    }

    .ux-pdf-viewer__page canvas {
      display: block;
    }

    /* Loading */
    .ux-pdf-viewer__loading {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-md);
      background: var(--ux-pdf-viewer-bg);
    }

    .ux-pdf-viewer__loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--ux-border-color);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-pdf-spin 0.8s linear infinite;
    }

    @keyframes ux-pdf-spin {
      to { transform: rotate(360deg); }
    }

    .ux-pdf-viewer__loading-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* Error */
    .ux-pdf-viewer__error {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-md);
      background: var(--ux-pdf-viewer-bg);
      padding: var(--ux-space-xl);
      text-align: center;
    }

    .ux-pdf-viewer__error-icon {
      width: 48px;
      height: 48px;
      color: var(--ux-danger);
    }

    .ux-pdf-viewer__error-text {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
    }

    /* Thumbnail sidebar */
    .ux-pdf-viewer--with-thumbnails {
      flex-direction: row;
    }

    .ux-pdf-viewer--with-thumbnails .ux-pdf-viewer__main {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 0;
    }

    .ux-pdf-viewer__thumbnails {
      width: 160px;
      background: var(--ux-surface);
      border-right: 1px solid var(--ux-border-color);
      overflow-y: auto;
      padding: var(--ux-space-sm);
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
      flex-shrink: 0;
    }

    .ux-pdf-viewer__thumbnail {
      border: 2px solid transparent;
      border-radius: var(--ux-radius-sm);
      cursor: pointer;
      padding: var(--ux-space-xs);
      transition: border-color var(--ux-transition-fast);
    }

    .ux-pdf-viewer__thumbnail:hover {
      border-color: var(--ux-gray-300);
    }

    .ux-pdf-viewer__thumbnail--active {
      border-color: var(--ux-primary);
    }

    .ux-pdf-viewer__thumbnail canvas {
      width: 100%;
      height: auto;
      display: block;
    }

    .ux-pdf-viewer__thumbnail-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      text-align: center;
      margin-top: var(--ux-space-xs);
    }

    /* Search bar */
    .ux-pdf-viewer__search {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-pdf-viewer__search-input {
      width: 160px;
      height: 32px;
      padding: 0 var(--ux-space-sm);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-sm);
      font-size: var(--ux-font-size-sm);
      background: var(--ux-surface);
      color: var(--ux-text);
    }

    .ux-pdf-viewer__search-count {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      min-width: 60px;
    }

    /* Annotations */
    .ux-pdf-viewer__annotation {
      position: absolute;
      background: rgba(255, 235, 59, 0.3);
      border: 1px solid rgba(255, 235, 59, 0.6);
      cursor: pointer;
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
      :root {
        --ux-pdf-viewer-bg: var(--ux-gray-900);
        --ux-pdf-viewer-toolbar-bg: var(--ux-gray-800);
        --ux-pdf-viewer-page-bg: var(--ux-gray-800);
        --ux-pdf-viewer-page-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
    }

    .ux-dark {
      --ux-pdf-viewer-bg: var(--ux-gray-900);
      --ux-pdf-viewer-toolbar-bg: var(--ux-gray-800);
      --ux-pdf-viewer-page-bg: var(--ux-gray-800);
      --ux-pdf-viewer-page-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    /* Glass variant */
    .ux-pdf-viewer--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
    }

    .ux-pdf-viewer--glass .ux-pdf-viewer__toolbar {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    /* Responsive */
    @media (max-width: 767px) {
      .ux-pdf-viewer__thumbnails {
        display: none;
      }

      .ux-pdf-viewer__toolbar {
        flex-wrap: wrap;
        height: auto;
        padding: var(--ux-space-sm);
        gap: var(--ux-space-xs);
      }

      .ux-pdf-viewer__search {
        width: 100%;
        order: 10;
        margin-top: var(--ux-space-xs);
      }

      .ux-pdf-viewer__search-input {
        flex: 1;
      }
    }

    /* Print */
    @media print {
      .ux-pdf-viewer__toolbar,
      .ux-pdf-viewer__thumbnails {
        display: none !important;
      }

      .ux-pdf-viewer {
        height: auto !important;
        background: none !important;
      }

      .ux-pdf-viewer__page {
        box-shadow: none !important;
        page-break-after: always;
      }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .ux-pdf-viewer__loading-spinner {
        animation: none;
      }
    }
  `;

  if (window.UX) {
    window.UX.injectStyles('ux-pdf-viewer-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-pdf-viewer-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  const componentData = (options = {}) => ({
    // State
    src: options.src || '',
    currentPage: 1,
    totalPages: 0,
    scale: options.scale || 1,
    isLoading: true,
    error: null,
    isFullscreen: false,
    showThumbnails: options.showThumbnails ?? false,
    searchQuery: '',
    searchResults: [],
    currentSearchIndex: 0,

    // PDF.js references
    pdfDoc: null,
    pageRendering: false,
    pageNumPending: null,

    // Zoom presets
    zoomOptions: [
      { value: 0.5, label: '50%' },
      { value: 0.75, label: '75%' },
      { value: 1, label: '100%' },
      { value: 1.25, label: '125%' },
      { value: 1.5, label: '150%' },
      { value: 2, label: '200%' },
      { value: 'fit-width', label: 'Fit Width' },
      { value: 'fit-page', label: 'Fit Page' }
    ],

    init() {
      if (this.src) {
        this.loadPDF(this.src);
      }

      // Keyboard shortcuts
      this._keyHandler = (e) => {
        if (!this.$el.contains(document.activeElement) && document.activeElement !== document.body) return;

        if (e.key === 'ArrowLeft' || e.key === 'PageUp') {
          e.preventDefault();
          this.prevPage();
        } else if (e.key === 'ArrowRight' || e.key === 'PageDown') {
          e.preventDefault();
          this.nextPage();
        } else if (e.key === 'Home') {
          e.preventDefault();
          this.goToPage(1);
        } else if (e.key === 'End') {
          e.preventDefault();
          this.goToPage(this.totalPages);
        } else if (e.key === '+' || e.key === '=') {
          e.preventDefault();
          this.zoomIn();
        } else if (e.key === '-') {
          e.preventDefault();
          this.zoomOut();
        } else if (e.key === 'f' && e.ctrlKey) {
          e.preventDefault();
          this.$refs.searchInput?.focus();
        }
      };
      document.addEventListener('keydown', this._keyHandler);
    },

    destroy() {
      if (this._keyHandler) {
        document.removeEventListener('keydown', this._keyHandler);
      }
      if (this.pdfDoc) {
        this.pdfDoc.destroy();
      }
    },

    async loadPDF(url) {
      this.isLoading = true;
      this.error = null;

      // Check if PDF.js is loaded
      if (typeof pdfjsLib === 'undefined') {
        this.error = 'PDF.js library not loaded. Please include pdf.js.';
        this.isLoading = false;
        return;
      }

      try {
        const loadingTask = pdfjsLib.getDocument(url);
        this.pdfDoc = await loadingTask.promise;
        this.totalPages = this.pdfDoc.numPages;
        this.currentPage = 1;

        await this.renderPage(1);

        if (this.showThumbnails) {
          this.renderThumbnails();
        }

        this.isLoading = false;
        this.$dispatch('pdf:loaded', { totalPages: this.totalPages });
      } catch (err) {
        this.error = err.message || 'Failed to load PDF';
        this.isLoading = false;
        this.$dispatch('pdf:error', { error: this.error });
      }
    },

    async renderPage(num) {
      if (!this.pdfDoc) return;

      this.pageRendering = true;

      try {
        const page = await this.pdfDoc.getPage(num);
        const canvas = this.$refs.canvas;
        const ctx = canvas.getContext('2d');

        let scale = this.scale;

        // Handle fit modes
        if (scale === 'fit-width') {
          const container = this.$refs.container;
          const viewport = page.getViewport({ scale: 1 });
          scale = (container.clientWidth - 48) / viewport.width;
        } else if (scale === 'fit-page') {
          const container = this.$refs.container;
          const viewport = page.getViewport({ scale: 1 });
          const scaleX = (container.clientWidth - 48) / viewport.width;
          const scaleY = (container.clientHeight - 48) / viewport.height;
          scale = Math.min(scaleX, scaleY);
        }

        const viewport = page.getViewport({ scale });

        canvas.height = viewport.height;
        canvas.width = viewport.width;

        const renderContext = {
          canvasContext: ctx,
          viewport: viewport
        };

        await page.render(renderContext).promise;

        this.pageRendering = false;

        if (this.pageNumPending !== null) {
          const pending = this.pageNumPending;
          this.pageNumPending = null;
          this.renderPage(pending);
        }

        this.$dispatch('pdf:pagerendered', { page: num });
      } catch (err) {
        this.pageRendering = false;
        console.error('Error rendering page:', err);
      }
    },

    async renderThumbnails() {
      if (!this.pdfDoc) return;

      const container = this.$refs.thumbnails;
      if (!container) return;

      container.innerHTML = '';

      for (let i = 1; i <= this.totalPages; i++) {
        const page = await this.pdfDoc.getPage(i);
        const viewport = page.getViewport({ scale: 0.2 });

        const thumbDiv = document.createElement('div');
        thumbDiv.className = 'ux-pdf-viewer__thumbnail' + (i === this.currentPage ? ' ux-pdf-viewer__thumbnail--active' : '');
        thumbDiv.dataset.page = i;
        thumbDiv.onclick = () => this.goToPage(i);

        const canvas = document.createElement('canvas');
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        const ctx = canvas.getContext('2d');
        await page.render({ canvasContext: ctx, viewport }).promise;

        const label = document.createElement('div');
        label.className = 'ux-pdf-viewer__thumbnail-label';
        label.textContent = i;

        thumbDiv.appendChild(canvas);
        thumbDiv.appendChild(label);
        container.appendChild(thumbDiv);
      }
    },

    goToPage(num) {
      if (num < 1 || num > this.totalPages) return;

      this.currentPage = num;

      if (this.pageRendering) {
        this.pageNumPending = num;
      } else {
        this.renderPage(num);
      }

      // Update thumbnail selection
      if (this.showThumbnails && this.$refs.thumbnails) {
        const thumbs = this.$refs.thumbnails.querySelectorAll('.ux-pdf-viewer__thumbnail');
        thumbs.forEach((thumb, i) => {
          thumb.classList.toggle('ux-pdf-viewer__thumbnail--active', i + 1 === num);
        });
      }

      this.$dispatch('pdf:pagechange', { page: num });
    },

    prevPage() {
      if (this.currentPage > 1) {
        this.goToPage(this.currentPage - 1);
      }
    },

    nextPage() {
      if (this.currentPage < this.totalPages) {
        this.goToPage(this.currentPage + 1);
      }
    },

    zoomIn() {
      if (typeof this.scale === 'number' && this.scale < 3) {
        this.scale = Math.min(3, this.scale + 0.25);
        this.renderPage(this.currentPage);
      }
    },

    zoomOut() {
      if (typeof this.scale === 'number' && this.scale > 0.25) {
        this.scale = Math.max(0.25, this.scale - 0.25);
        this.renderPage(this.currentPage);
      }
    },

    setZoom(value) {
      this.scale = value === 'fit-width' || value === 'fit-page' ? value : parseFloat(value);
      this.renderPage(this.currentPage);
    },

    toggleFullscreen() {
      this.isFullscreen = !this.isFullscreen;

      if (this.isFullscreen) {
        window.UX?.lockScroll();
      } else {
        window.UX?.unlockScroll();
      }

      // Re-render if using fit modes
      if (this.scale === 'fit-width' || this.scale === 'fit-page') {
        this.$nextTick(() => this.renderPage(this.currentPage));
      }
    },

    async search() {
      if (!this.searchQuery || !this.pdfDoc) return;

      this.searchResults = [];
      this.currentSearchIndex = 0;

      for (let i = 1; i <= this.totalPages; i++) {
        const page = await this.pdfDoc.getPage(i);
        const textContent = await page.getTextContent();
        const text = textContent.items.map(item => item.str).join(' ');

        if (text.toLowerCase().includes(this.searchQuery.toLowerCase())) {
          this.searchResults.push(i);
        }
      }

      if (this.searchResults.length > 0) {
        this.goToPage(this.searchResults[0]);
      }

      this.$dispatch('pdf:search', { results: this.searchResults.length });
    },

    nextSearchResult() {
      if (this.searchResults.length === 0) return;
      this.currentSearchIndex = (this.currentSearchIndex + 1) % this.searchResults.length;
      this.goToPage(this.searchResults[this.currentSearchIndex]);
    },

    prevSearchResult() {
      if (this.searchResults.length === 0) return;
      this.currentSearchIndex = (this.currentSearchIndex - 1 + this.searchResults.length) % this.searchResults.length;
      this.goToPage(this.searchResults[this.currentSearchIndex]);
    },

    print() {
      window.print();
    },

    async download() {
      if (!this.src) return;

      const link = document.createElement('a');
      link.href = this.src;
      link.download = this.src.split('/').pop() || 'document.pdf';
      link.click();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxPdfViewer', componentData);
  }
})();

/**
 * UX Performance Meter Component
 * HR module component for displaying employee performance metrics
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       UX Performance Meter - HR Performance Visualization
       iOS 26 Style - Liquid Glass Design
       ========================================================================== */

    :root {
      /* Performance Meter Tokens */
      --ux-perf-meter-padding: var(--ux-space-lg);
      --ux-perf-meter-border-radius: var(--ux-border-radius-lg);
      --ux-perf-meter-gap: var(--ux-space-md);
      --ux-perf-meter-score-size: 120px;
      --ux-perf-meter-bar-height: 8px;
      --ux-perf-meter-bar-radius: 4px;
    }

    /* ==========================================================================
       Main Container
       ========================================================================== */

    .ux-performance-meter {
      display: flex;
      flex-direction: column;
      gap: var(--ux-perf-meter-gap);
      padding: var(--ux-perf-meter-padding);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-perf-meter-border-radius);
      font-family: var(--ux-font-family);
    }

    /* ==========================================================================
       Employee Header
       ========================================================================== */

    .ux-performance-meter__header {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding-bottom: var(--ux-space-md);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-performance-meter__avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--ux-medium);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--ux-font-size-xl);
      font-weight: 600;
      color: var(--ux-medium-contrast);
      overflow: hidden;
      flex-shrink: 0;
    }

    .ux-performance-meter__avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .ux-performance-meter__employee-info {
      flex: 1;
      min-width: 0;
    }

    .ux-performance-meter__employee-name {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      line-height: 1.3;
    }

    .ux-performance-meter__employee-role {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    .ux-performance-meter__employee-department {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      margin: 0;
    }

    .ux-performance-meter__period-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 6px 12px;
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius-pill);
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      color: var(--ux-text-secondary);
      flex-shrink: 0;
    }

    /* ==========================================================================
       Score Display (Gauge Style)
       ========================================================================== */

    .ux-performance-meter__score-section {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xl);
      padding: var(--ux-space-md) 0;
    }

    .ux-performance-meter__score-gauge {
      position: relative;
      width: var(--ux-perf-meter-score-size);
      height: var(--ux-perf-meter-score-size);
    }

    .ux-performance-meter__score-svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .ux-performance-meter__score-track {
      fill: none;
      stroke: var(--ux-surface-secondary);
      stroke-width: 10;
    }

    .ux-performance-meter__score-fill {
      fill: none;
      stroke: var(--ux-primary);
      stroke-width: 10;
      stroke-linecap: round;
      transition: stroke-dashoffset 1s var(--ux-ease-ios);
    }

    /* Score colors based on performance */
    .ux-performance-meter__score-fill--excellent {
      stroke: var(--ux-success);
    }

    .ux-performance-meter__score-fill--good {
      stroke: var(--ux-primary);
    }

    .ux-performance-meter__score-fill--average {
      stroke: var(--ux-warning);
    }

    .ux-performance-meter__score-fill--poor {
      stroke: var(--ux-danger);
    }

    .ux-performance-meter__score-value {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .ux-performance-meter__score-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--ux-text);
      line-height: 1;
      font-variant-numeric: tabular-nums;
    }

    .ux-performance-meter__score-max {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-tertiary);
    }

    .ux-performance-meter__score-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      margin-top: 4px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Score summary beside gauge */
    .ux-performance-meter__score-summary {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-performance-meter__score-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: var(--ux-border-radius-pill);
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
    }

    .ux-performance-meter__score-status--excellent {
      background: rgba(var(--ux-success-rgb), 0.1);
      color: var(--ux-success);
    }

    .ux-performance-meter__score-status--good {
      background: rgba(var(--ux-primary-rgb), 0.1);
      color: var(--ux-primary);
    }

    .ux-performance-meter__score-status--average {
      background: rgba(var(--ux-warning-rgb), 0.1);
      color: var(--ux-warning);
    }

    .ux-performance-meter__score-status--poor {
      background: rgba(var(--ux-danger-rgb), 0.1);
      color: var(--ux-danger);
    }

    .ux-performance-meter__trend {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
    }

    .ux-performance-meter__trend--up {
      color: var(--ux-success);
    }

    .ux-performance-meter__trend--down {
      color: var(--ux-danger);
    }

    .ux-performance-meter__trend--neutral {
      color: var(--ux-text-secondary);
    }

    .ux-performance-meter__trend svg {
      width: 16px;
      height: 16px;
    }

    /* ==========================================================================
       Goal vs Actual
       ========================================================================== */

    .ux-performance-meter__goal-section {
      display: flex;
      align-items: center;
      gap: var(--ux-space-lg);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
    }

    .ux-performance-meter__goal-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }

    .ux-performance-meter__goal-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .ux-performance-meter__goal-value {
      font-size: var(--ux-font-size-xl);
      font-weight: 700;
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
    }

    .ux-performance-meter__goal-divider {
      width: 1px;
      height: 40px;
      background: var(--ux-border-color);
    }

    .ux-performance-meter__goal-diff {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
    }

    .ux-performance-meter__goal-diff--positive {
      color: var(--ux-success);
    }

    .ux-performance-meter__goal-diff--negative {
      color: var(--ux-danger);
    }

    /* ==========================================================================
       Category Breakdown
       ========================================================================== */

    .ux-performance-meter__categories {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md);
    }

    .ux-performance-meter__categories-title {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      padding-bottom: var(--ux-space-xs);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-performance-meter__category {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .ux-performance-meter__category-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .ux-performance-meter__category-name {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .ux-performance-meter__category-icon {
      width: 18px;
      height: 18px;
      color: var(--ux-text-secondary);
    }

    .ux-performance-meter__category-score {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ux-performance-meter__category-value {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
      min-width: 36px;
      text-align: right;
    }

    .ux-performance-meter__category-trend {
      display: flex;
      align-items: center;
      gap: 2px;
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
    }

    .ux-performance-meter__category-trend--up {
      color: var(--ux-success);
    }

    .ux-performance-meter__category-trend--down {
      color: var(--ux-danger);
    }

    .ux-performance-meter__category-trend--neutral {
      color: var(--ux-text-tertiary);
    }

    .ux-performance-meter__category-trend svg {
      width: 12px;
      height: 12px;
    }

    .ux-performance-meter__category-bar {
      height: var(--ux-perf-meter-bar-height);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-perf-meter-bar-radius);
      overflow: hidden;
    }

    .ux-performance-meter__category-fill {
      height: 100%;
      border-radius: var(--ux-perf-meter-bar-radius);
      transition: width 0.8s var(--ux-ease-ios);
    }

    .ux-performance-meter__category-fill--excellent {
      background: var(--ux-success);
    }

    .ux-performance-meter__category-fill--good {
      background: var(--ux-primary);
    }

    .ux-performance-meter__category-fill--average {
      background: var(--ux-warning);
    }

    .ux-performance-meter__category-fill--poor {
      background: var(--ux-danger);
    }

    /* ==========================================================================
       Period Selector
       ========================================================================== */

    .ux-performance-meter__period-selector {
      display: flex;
      gap: 4px;
      padding: 4px;
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
    }

    .ux-performance-meter__period-btn {
      flex: 1;
      padding: 8px 12px;
      background: transparent;
      border: none;
      border-radius: var(--ux-border-radius-sm);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease-ios);
    }

    .ux-performance-meter__period-btn:hover {
      color: var(--ux-text);
      background: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-performance-meter__period-btn--active {
      background: var(--ux-surface);
      color: var(--ux-text);
      box-shadow: var(--ux-shadow-sm);
    }

    /* ==========================================================================
       Size Variants
       ========================================================================== */

    /* Compact */
    .ux-performance-meter--compact {
      --ux-perf-meter-padding: var(--ux-space-md);
      --ux-perf-meter-gap: var(--ux-space-sm);
      --ux-perf-meter-score-size: 80px;
    }

    .ux-performance-meter--compact .ux-performance-meter__score-number {
      font-size: 1.5rem;
    }

    .ux-performance-meter--compact .ux-performance-meter__avatar {
      width: 40px;
      height: 40px;
      font-size: var(--ux-font-size-md);
    }

    .ux-performance-meter--compact .ux-performance-meter__score-svg .ux-performance-meter__score-track,
    .ux-performance-meter--compact .ux-performance-meter__score-svg .ux-performance-meter__score-fill {
      stroke-width: 8;
    }

    /* Large */
    .ux-performance-meter--lg {
      --ux-perf-meter-padding: var(--ux-space-xl);
      --ux-perf-meter-gap: var(--ux-space-lg);
      --ux-perf-meter-score-size: 160px;
    }

    .ux-performance-meter--lg .ux-performance-meter__score-number {
      font-size: 2.5rem;
    }

    .ux-performance-meter--lg .ux-performance-meter__avatar {
      width: 72px;
      height: 72px;
      font-size: var(--ux-font-size-2xl);
    }

    /* ==========================================================================
       Score Only Variant (No header, no categories)
       ========================================================================== */

    .ux-performance-meter--score-only {
      padding: var(--ux-space-md);
    }

    .ux-performance-meter--score-only .ux-performance-meter__score-section {
      padding: 0;
    }

    /* ==========================================================================
       Inline Variant (Horizontal Layout)
       ========================================================================== */

    .ux-performance-meter--inline {
      flex-direction: row;
      align-items: center;
      flex-wrap: wrap;
    }

    .ux-performance-meter--inline .ux-performance-meter__header {
      flex: 1;
      min-width: 200px;
      border-bottom: none;
      padding-bottom: 0;
      padding-right: var(--ux-space-md);
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-performance-meter--inline .ux-performance-meter__score-section {
      padding: 0 var(--ux-space-md);
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-performance-meter--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-performance-meter--glass .ux-performance-meter__score-track {
      stroke: var(--ux-glass-bg-thick);
    }

    .ux-performance-meter--glass .ux-performance-meter__goal-section,
    .ux-performance-meter--glass .ux-performance-meter__period-selector {
      background: rgba(255, 255, 255, 0.1);
    }

    .ux-performance-meter--glass .ux-performance-meter__category-bar {
      background: rgba(255, 255, 255, 0.15);
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light) .ux-performance-meter--glass .ux-performance-meter__goal-section,
      :root:not(.ux-light) .ux-performance-meter--glass .ux-performance-meter__period-selector {
        background: rgba(255, 255, 255, 0.05);
      }

      :root:not(.ux-light) .ux-performance-meter--glass .ux-performance-meter__category-bar {
        background: rgba(255, 255, 255, 0.08);
      }
    }

    .ux-dark .ux-performance-meter--glass .ux-performance-meter__goal-section,
    .ux-dark .ux-performance-meter--glass .ux-performance-meter__period-selector {
      background: rgba(255, 255, 255, 0.05);
    }

    .ux-dark .ux-performance-meter--glass .ux-performance-meter__category-bar {
      background: rgba(255, 255, 255, 0.08);
    }

    /* ==========================================================================
       Responsive
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-performance-meter__score-section {
        flex-direction: column;
        gap: var(--ux-space-md);
      }

      .ux-performance-meter__score-summary {
        align-items: center;
        text-align: center;
      }

      .ux-performance-meter--inline {
        flex-direction: column;
      }

      .ux-performance-meter--inline .ux-performance-meter__header {
        border-right: none;
        border-bottom: 1px solid var(--ux-border-color);
        padding-right: 0;
        padding-bottom: var(--ux-space-md);
        width: 100%;
      }

      .ux-performance-meter__goal-section {
        flex-wrap: wrap;
      }

      .ux-performance-meter__goal-divider {
        display: none;
      }

      .ux-performance-meter__goal-item {
        min-width: 80px;
      }
    }

    /* ==========================================================================
       Animation
       ========================================================================== */

    .ux-performance-meter--animated .ux-performance-meter__score-fill {
      animation: ux-perf-meter-fill 1.2s var(--ux-ease-ios) forwards;
    }

    .ux-performance-meter--animated .ux-performance-meter__category-fill {
      animation: ux-perf-meter-bar-fill 0.8s var(--ux-ease-ios) forwards;
    }

    @keyframes ux-perf-meter-fill {
      from {
        stroke-dashoffset: var(--ux-perf-circumference);
      }
    }

    @keyframes ux-perf-meter-bar-fill {
      from {
        width: 0;
      }
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-performance-meter__score-fill,
      .ux-performance-meter__category-fill {
        transition: none;
      }

      .ux-performance-meter--animated .ux-performance-meter__score-fill,
      .ux-performance-meter--animated .ux-performance-meter__category-fill {
        animation: none;
      }
    }

    /* ==========================================================================
       Print Styles
       ========================================================================== */

    @media print {
      .ux-performance-meter {
        border: 1px solid #ccc;
        break-inside: avoid;
      }

      .ux-performance-meter--glass {
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        background: #f9f9f9;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-performance-meter-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-performance-meter-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const performanceMeterComponent = (config = {}) => ({
    // Employee data
    employee: config.employee || {
      name: 'Employee Name',
      role: 'Role',
      department: 'Department',
      avatar: null,
      initials: null
    },

    // Score configuration
    score: config.score ?? 0,
    maxScore: config.maxScore ?? 100,
    scoreType: config.scoreType || 'percentage', // 'percentage' | 'points' | 'rating'
    ratingMax: config.ratingMax ?? 5, // For rating type (1-5 scale)

    // Goal vs Actual
    goal: config.goal ?? null,
    actual: config.actual ?? null,

    // Categories breakdown
    categories: config.categories || [],
    // Example: [
    //   { name: 'Productivity', score: 85, icon: null, trend: 5 },
    //   { name: 'Quality', score: 92, icon: null, trend: 3 },
    //   { name: 'Teamwork', score: 78, icon: null, trend: -2 },
    //   { name: 'Communication', score: 88, icon: null, trend: 0 }
    // ]

    // Trend
    trend: config.trend ?? null, // positive number = up, negative = down, 0 = neutral
    trendLabel: config.trendLabel || 'vs last period',

    // Period
    period: config.period || 'quarterly',
    periods: config.periods || ['monthly', 'quarterly', 'yearly'],

    // Animation
    animated: config.animated !== false,
    animationTriggered: false,

    // Thresholds for color coding
    thresholds: config.thresholds || {
      excellent: 90,
      good: 70,
      average: 50
      // Below 50 = poor
    },

    // Computed properties
    get normalizedScore() {
      if (this.scoreType === 'rating') {
        return (this.score / this.ratingMax) * 100;
      }
      return Math.min(Math.max((this.score / this.maxScore) * 100, 0), 100);
    },

    get displayScore() {
      if (this.scoreType === 'rating') {
        return this.score.toFixed(1);
      }
      return Math.round(this.score);
    },

    get displayMaxScore() {
      if (this.scoreType === 'rating') {
        return this.ratingMax;
      }
      if (this.scoreType === 'percentage') {
        return '%';
      }
      return '/ ' + this.maxScore;
    },

    get scoreLevel() {
      const normalized = this.normalizedScore;
      if (normalized >= this.thresholds.excellent) return 'excellent';
      if (normalized >= this.thresholds.good) return 'good';
      if (normalized >= this.thresholds.average) return 'average';
      return 'poor';
    },

    get scoreLevelLabel() {
      const labels = {
        excellent: 'Excellent',
        good: 'Good',
        average: 'Average',
        poor: 'Needs Improvement'
      };
      return labels[this.scoreLevel];
    },

    get trendDirection() {
      if (this.trend === null || this.trend === 0) return 'neutral';
      return this.trend > 0 ? 'up' : 'down';
    },

    get trendValue() {
      if (this.trend === null) return '';
      const sign = this.trend > 0 ? '+' : '';
      return sign + this.trend + '%';
    },

    get goalDifference() {
      if (this.goal === null || this.actual === null) return null;
      return this.actual - this.goal;
    },

    get goalDifferenceLabel() {
      const diff = this.goalDifference;
      if (diff === null) return '';
      const sign = diff > 0 ? '+' : '';
      return sign + diff;
    },

    // SVG calculations for circular gauge
    get gaugeRadius() {
      return 45; // Based on viewBox of 100
    },

    get gaugeCircumference() {
      return 2 * Math.PI * this.gaugeRadius;
    },

    get gaugeDashOffset() {
      return this.gaugeCircumference * (1 - this.normalizedScore / 100);
    },

    // Methods
    getCategoryLevel(score) {
      if (score >= this.thresholds.excellent) return 'excellent';
      if (score >= this.thresholds.good) return 'good';
      if (score >= this.thresholds.average) return 'average';
      return 'poor';
    },

    getCategoryTrendDirection(trend) {
      if (trend === null || trend === undefined || trend === 0) return 'neutral';
      return trend > 0 ? 'up' : 'down';
    },

    getCategoryTrendValue(trend) {
      if (trend === null || trend === undefined) return '';
      const sign = trend > 0 ? '+' : '';
      return sign + trend;
    },

    setPeriod(newPeriod) {
      this.period = newPeriod;
      this.$dispatch('performance-meter:period-change', { period: newPeriod });
    },

    // Update score with animation
    updateScore(newScore) {
      this.score = newScore;
      this.$dispatch('performance-meter:score-change', {
        score: newScore,
        level: this.scoreLevel
      });
    },

    // Get initials from employee name
    getInitials() {
      if (this.employee.initials) return this.employee.initials;
      if (!this.employee.name) return '?';
      return this.employee.name
        .split(' ')
        .map(word => word[0])
        .join('')
        .toUpperCase()
        .slice(0, 2);
    },

    // Lifecycle
    init() {
      // Trigger animation when component is visible
      if (this.animated) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting && !this.animationTriggered) {
              this.animationTriggered = true;
              this.$el.classList.add('ux-performance-meter--animated');
              observer.disconnect();
            }
          });
        }, { threshold: 0.3 });

        observer.observe(this.$el);
      }
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxPerformanceMeter', performanceMeterComponent);
  }

})();

/**
 * UX Phone Input Component
 * International phone number input with country code selector
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Phone Input - Base
    ======================================== */

    .ux-phone {
      position: relative;
      display: flex;
      font-family: var(--ux-font-family);
    }

    /* ========================================
       Country Selector
    ======================================== */

    .ux-phone__country {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0 0.75rem;
      background: var(--ux-surface-secondary);
      border: var(--ux-input-border-width) solid var(--ux-border-color);
      border-right: none;
      border-radius: var(--ux-input-border-radius) 0 0 var(--ux-input-border-radius);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
      flex-shrink: 0;
    }

    .ux-phone__country:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-phone__flag {
      font-size: 1.25rem;
      line-height: 1;
    }

    .ux-phone__code {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ux-text);
      min-width: 2.5rem;
    }

    .ux-phone__arrow {
      width: 16px;
      height: 16px;
      color: var(--ux-text-secondary);
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-phone--open .ux-phone__arrow {
      transform: rotate(180deg);
    }

    /* ========================================
       Input (uses .ux-input base styles)
    ======================================== */

    .ux-phone .ux-input {
      flex: 1;
      border-radius: 0 var(--ux-input-border-radius) var(--ux-input-border-radius) 0;
    }

    .ux-phone:focus-within .ux-phone__country {
      border-color: var(--ux-primary);
    }

    /* ========================================
       Dropdown
    ======================================== */

    .ux-phone__dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: 4px;
      max-height: 300px;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      box-shadow: var(--ux-shadow-lg);
      overflow: hidden;
      z-index: var(--ux-z-dropdown);
    }

    .ux-phone__search {
      padding: 0.75rem;
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-phone__search-input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      font-family: inherit;
      color: var(--ux-text);
      background: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
    }

    .ux-phone__search-input:focus {
      outline: none;
      border-color: var(--ux-primary);
    }

    .ux-phone__list {
      max-height: 240px;
      overflow-y: auto;
      padding: 0.5rem 0;
    }

    .ux-phone__option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.625rem 1rem;
      cursor: pointer;
      transition: background var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-phone__option:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-phone__option--selected {
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-phone__option-flag {
      font-size: 1.25rem;
    }

    .ux-phone__option-name {
      flex: 1;
      font-size: 0.875rem;
      color: var(--ux-text);
    }

    .ux-phone__option-code {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ux-text-secondary);
    }

    /* ========================================
       Size Variants
    ======================================== */

    /* Small */
    .ux-phone--sm .ux-phone__country {
      padding: 0 0.5rem;
    }

    .ux-phone--sm .ux-phone__flag {
      font-size: 1rem;
    }

    .ux-phone--sm .ux-phone__code {
      font-size: 0.75rem;
    }

    .ux-phone--sm .ux-input {
      height: var(--ux-input-height-sm);
      font-size: var(--ux-font-size-sm);
    }

    /* Large */
    .ux-phone--lg .ux-phone__country {
      padding: 0 1rem;
    }

    .ux-phone--lg .ux-phone__flag {
      font-size: 1.5rem;
    }

    .ux-phone--lg .ux-phone__code {
      font-size: 1rem;
    }

    .ux-phone--lg .ux-input {
      height: var(--ux-input-height-lg);
      font-size: var(--ux-font-size-lg);
    }

    /* ========================================
       States
    ======================================== */

    /* Error */
    .ux-phone--error .ux-phone__country,
    .ux-phone--error .ux-input {
      border-color: var(--ux-danger);
    }

    .ux-phone--error .ux-input:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-danger-rgb), 0.15);
    }

    /* Success */
    .ux-phone--success .ux-phone__country,
    .ux-phone--success .ux-input {
      border-color: var(--ux-success);
    }

    .ux-phone--success .ux-input:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-success-rgb), 0.15);
    }

    /* Disabled */
    .ux-phone--disabled .ux-phone__country {
      opacity: 0.6;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-phone--glass .ux-phone__country,
    .ux-phone--glass .ux-input {
      background: var(--ux-glass-bg-thin);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-phone--glass .ux-input:hover {
      background: var(--ux-glass-bg);
    }

    .ux-phone--glass .ux-input:focus {
      background: var(--ux-glass-bg);
      box-shadow: var(--ux-glass-highlight);
    }

    .ux-phone--glass .ux-phone__dropdown {
      background: var(--ux-glass-bg-thick);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Field Wrapper
    ======================================== */

    .ux-phone-field {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
    }

    .ux-phone-field__label {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-phone-field__helper {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
    }

    .ux-phone-field__helper--error {
      color: var(--ux-danger);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-phone__country {
        background: var(--ux-surface-secondary);
      }

      .ux-phone__dropdown {
        background: var(--ux-surface);
      }
    }

    .ux-dark .ux-phone__country {
      background: var(--ux-surface-secondary);
    }

    .ux-dark .ux-phone__dropdown {
      background: var(--ux-surface);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-phone__country,
      .ux-phone__arrow,
      .ux-phone__option {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-phone-input-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-phone-input-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Country data with dial codes and flags
  const countries = [
    { code: 'ES', name: 'EspaÃ±a', dial: '+34', flag: 'ðªð¸' },
    { code: 'US', name: 'Estados Unidos', dial: '+1', flag: 'ðºð¸' },
    { code: 'MX', name: 'MÃ©xico', dial: '+52', flag: 'ð²ð½' },
    { code: 'AR', name: 'Argentina', dial: '+54', flag: 'ð¦ð·' },
    { code: 'CO', name: 'Colombia', dial: '+57', flag: 'ð¨ð´' },
    { code: 'CL', name: 'Chile', dial: '+56', flag: 'ð¨ð±' },
    { code: 'PE', name: 'PerÃº', dial: '+51', flag: 'ðµðª' },
    { code: 'VE', name: 'Venezuela', dial: '+58', flag: 'ð»ðª' },
    { code: 'EC', name: 'Ecuador', dial: '+593', flag: 'ðªð¨' },
    { code: 'BO', name: 'Bolivia', dial: '+591', flag: 'ð§ð´' },
    { code: 'UY', name: 'Uruguay', dial: '+598', flag: 'ðºð¾' },
    { code: 'PY', name: 'Paraguay', dial: '+595', flag: 'ðµð¾' },
    { code: 'BR', name: 'Brasil', dial: '+55', flag: 'ð§ð·' },
    { code: 'PT', name: 'Portugal', dial: '+351', flag: 'ðµð¹' },
    { code: 'FR', name: 'Francia', dial: '+33', flag: 'ð«ð·' },
    { code: 'DE', name: 'Alemania', dial: '+49', flag: 'ð©ðª' },
    { code: 'IT', name: 'Italia', dial: '+39', flag: 'ð®ð¹' },
    { code: 'GB', name: 'Reino Unido', dial: '+44', flag: 'ð¬ð§' },
    { code: 'NL', name: 'PaÃ­ses Bajos', dial: '+31', flag: 'ð³ð±' },
    { code: 'BE', name: 'BÃ©lgica', dial: '+32', flag: 'ð§ðª' },
    { code: 'CH', name: 'Suiza', dial: '+41', flag: 'ð¨ð­' },
    { code: 'AT', name: 'Austria', dial: '+43', flag: 'ð¦ð¹' },
    { code: 'PL', name: 'Polonia', dial: '+48', flag: 'ðµð±' },
    { code: 'SE', name: 'Suecia', dial: '+46', flag: 'ð¸ðª' },
    { code: 'NO', name: 'Noruega', dial: '+47', flag: 'ð³ð´' },
    { code: 'DK', name: 'Dinamarca', dial: '+45', flag: 'ð©ð°' },
    { code: 'FI', name: 'Finlandia', dial: '+358', flag: 'ð«ð®' },
    { code: 'IE', name: 'Irlanda', dial: '+353', flag: 'ð®ðª' },
    { code: 'GR', name: 'Grecia', dial: '+30', flag: 'ð¬ð·' },
    { code: 'RU', name: 'Rusia', dial: '+7', flag: 'ð·ðº' },
    { code: 'CN', name: 'China', dial: '+86', flag: 'ð¨ð³' },
    { code: 'JP', name: 'JapÃ³n', dial: '+81', flag: 'ð¯ðµ' },
    { code: 'KR', name: 'Corea del Sur', dial: '+82', flag: 'ð°ð·' },
    { code: 'IN', name: 'India', dial: '+91', flag: 'ð®ð³' },
    { code: 'AU', name: 'Australia', dial: '+61', flag: 'ð¦ðº' },
    { code: 'NZ', name: 'Nueva Zelanda', dial: '+64', flag: 'ð³ð¿' },
    { code: 'CA', name: 'CanadÃ¡', dial: '+1', flag: 'ð¨ð¦' },
    { code: 'ZA', name: 'SudÃ¡frica', dial: '+27', flag: 'ð¿ð¦' },
    { code: 'AE', name: 'Emiratos Ãrabes', dial: '+971', flag: 'ð¦ðª' },
    { code: 'SA', name: 'Arabia Saudita', dial: '+966', flag: 'ð¸ð¦' },
    { code: 'IL', name: 'Israel', dial: '+972', flag: 'ð®ð±' },
    { code: 'TR', name: 'TurquÃ­a', dial: '+90', flag: 'ð¹ð·' },
    { code: 'EG', name: 'Egipto', dial: '+20', flag: 'ðªð¬' },
    { code: 'MA', name: 'Marruecos', dial: '+212', flag: 'ð²ð¦' },
    { code: 'NG', name: 'Nigeria', dial: '+234', flag: 'ð³ð¬' },
    { code: 'KE', name: 'Kenia', dial: '+254', flag: 'ð°ðª' },
    { code: 'TH', name: 'Tailandia', dial: '+66', flag: 'ð¹ð­' },
    { code: 'SG', name: 'Singapur', dial: '+65', flag: 'ð¸ð¬' },
    { code: 'MY', name: 'Malasia', dial: '+60', flag: 'ð²ð¾' },
    { code: 'ID', name: 'Indonesia', dial: '+62', flag: 'ð®ð©' },
    { code: 'PH', name: 'Filipinas', dial: '+63', flag: 'ðµð­' },
    { code: 'VN', name: 'Vietnam', dial: '+84', flag: 'ð»ð³' }
  ];

  // Arrow icon
  const arrowIcon = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>';

  // Alpine.js component for phone input
  const phoneInputData = (options = {}) => ({
    // Configuration
    defaultCountry: options.defaultCountry || 'ES',
    preferredCountries: options.preferredCountries || ['ES', 'US', 'MX', 'AR', 'CO'],
    placeholder: options.placeholder || '600 000 000',
    searchable: options.searchable ?? true,
    showFlags: options.showFlags ?? true,
    showDialCode: options.showDialCode ?? true,

    // State
    isOpen: false,
    searchQuery: '',
    selectedCountry: null,
    phoneNumber: options.value || '',
    disabled: options.disabled || false,
    arrowIcon,

    // Data
    countries,

    init() {
      // Set default country
      this.selectedCountry = this.countries.find(c => c.code === this.defaultCountry) || this.countries[0];

      // Parse initial value if includes dial code
      if (options.value && options.value.startsWith('+')) {
        this.parseFullNumber(options.value);
      }
    },

    // Get sorted countries (preferred first)
    get sortedCountries() {
      const preferred = this.preferredCountries
        .map(code => this.countries.find(c => c.code === code))
        .filter(Boolean);

      const rest = this.countries.filter(c => !this.preferredCountries.includes(c.code));

      return [...preferred, ...rest];
    },

    // Get filtered countries
    get filteredCountries() {
      if (!this.searchQuery) return this.sortedCountries;

      const query = this.searchQuery.toLowerCase();
      return this.sortedCountries.filter(country =>
        country.name.toLowerCase().includes(query) ||
        country.code.toLowerCase().includes(query) ||
        country.dial.includes(query)
      );
    },

    // Toggle dropdown
    toggle() {
      if (this.disabled) return;
      this.isOpen = !this.isOpen;

      if (this.isOpen) {
        this.searchQuery = '';
        this.$nextTick(() => {
          const searchInput = this.$refs.searchInput;
          if (searchInput) searchInput.focus();
        });
      }
    },

    // Open dropdown
    open() {
      if (this.disabled) return;
      this.isOpen = true;
      this.searchQuery = '';
    },

    // Close dropdown
    close() {
      this.isOpen = false;
      this.searchQuery = '';
    },

    // Select country
    selectCountry(country) {
      this.selectedCountry = country;
      this.isOpen = false;
      this.searchQuery = '';

      this.$dispatch('phone:countrychange', { country });
      this.dispatchChange();

      // Focus input after selection
      this.$nextTick(() => {
        this.$refs.phoneInput?.focus();
      });
    },

    // Handle phone input
    onPhoneInput(event) {
      let value = event.target.value;

      // Remove non-numeric characters except spaces and dashes
      value = value.replace(/[^\d\s\-]/g, '');

      this.phoneNumber = value;
      this.dispatchChange();
    },

    // Handle keydown for dropdown navigation
    onKeyDown(event) {
      if (event.key === 'Escape') {
        this.close();
      }
    },

    // Parse full number with dial code
    parseFullNumber(fullNumber) {
      // Find matching country by dial code
      const sorted = [...this.countries].sort((a, b) => b.dial.length - a.dial.length);

      for (const country of sorted) {
        if (fullNumber.startsWith(country.dial)) {
          this.selectedCountry = country;
          this.phoneNumber = fullNumber.slice(country.dial.length).trim();
          return;
        }
      }
    },

    // Get full phone number
    getFullNumber() {
      const number = this.phoneNumber.replace(/[\s\-]/g, '');
      if (!number) return '';
      return `${this.selectedCountry.dial}${number}`;
    },

    // Get formatted display
    getFormattedNumber() {
      return `${this.selectedCountry.dial} ${this.phoneNumber}`;
    },

    // Validate basic format
    isValid() {
      const number = this.phoneNumber.replace(/[\s\-]/g, '');
      return number.length >= 6 && number.length <= 15;
    },

    // Clear
    clear() {
      this.phoneNumber = '';
      this.dispatchChange();
    },

    // Set value
    setValue(value, countryCode) {
      if (countryCode) {
        const country = this.countries.find(c => c.code === countryCode);
        if (country) this.selectedCountry = country;
      }

      if (value.startsWith('+')) {
        this.parseFullNumber(value);
      } else {
        this.phoneNumber = value;
      }

      this.dispatchChange();
    },

    // Dispatch change event
    dispatchChange() {
      this.$dispatch('phone:change', {
        number: this.phoneNumber,
        fullNumber: this.getFullNumber(),
        country: this.selectedCountry,
        isValid: this.isValid()
      });
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxPhoneInput', phoneInputData);
  }

  // Also expose countries list
  if (window.UX) {
    window.UX.phoneCountries = countries;
  }

})();

/**
 * UX Picker Component
 * iOS-style column picker (wheel selector)
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Picker Backdrop
    ======================================== */

    .ux-picker-backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: var(--ux-z-modal-backdrop);
      opacity: 0;
      visibility: hidden;
      transition:
        opacity 300ms cubic-bezier(0.32, 0.72, 0, 1),
        visibility 300ms cubic-bezier(0.32, 0.72, 0, 1);
    }

    .ux-picker-backdrop--open {
      opacity: 1;
      visibility: visible;
    }

    /* ========================================
       UX Picker Container
    ======================================== */

    .ux-picker {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--ux-surface);
      border-radius: var(--ux-border-radius-xl) var(--ux-border-radius-xl) 0 0;
      z-index: var(--ux-z-modal);
      transform: translateY(100%);
      transition: transform 400ms cubic-bezier(0.32, 0.72, 0, 1);
      padding-bottom: env(safe-area-inset-bottom);
      will-change: transform;
    }

    .ux-picker-backdrop--open .ux-picker {
      transform: translateY(0);
    }

    /* ========================================
       Picker Header
    ======================================== */

    .ux-picker__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 44px;
      padding: 0 var(--ux-space-sm);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-picker__button {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 60px;
      min-height: 44px;
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: none;
      border: none;
      color: var(--ux-primary);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-md);
      font-weight: 400;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-picker__button:active {
      opacity: 0.5;
    }

    .ux-picker__button--cancel {
      font-weight: 400;
    }

    .ux-picker__button--confirm {
      font-weight: 600;
    }

    .ux-picker__title {
      flex: 1;
      text-align: center;
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    /* ========================================
       Picker Columns Container
    ======================================== */

    .ux-picker__columns {
      display: flex;
      height: 216px;
      overflow: hidden;
      position: relative;
    }

    /* Selection highlight */
    .ux-picker__columns::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 36px;
      transform: translateY(-50%);
      background-color: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
      border-bottom: 1px solid var(--ux-border-color);
      pointer-events: none;
      z-index: 0;
    }

    /* Gradient masks */
    .ux-picker__columns::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to bottom,
        var(--ux-surface) 0%,
        transparent 20%,
        transparent 80%,
        var(--ux-surface) 100%
      );
      pointer-events: none;
      z-index: 1;
    }

    /* ========================================
       Picker Column
    ======================================== */

    .ux-picker__column {
      flex: 1;
      height: 100%;
      overflow: hidden;
      position: relative;
    }

    .ux-picker__column-wrapper {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      transform: translateY(-50%);
      transition: transform 300ms cubic-bezier(0.32, 0.72, 0, 1);
      will-change: transform;
    }

    .ux-picker__column--dragging .ux-picker__column-wrapper {
      transition: none;
    }

    /* ========================================
       Picker Item
    ======================================== */

    .ux-picker__item {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 36px;
      padding: 0 var(--ux-space-md);
      color: var(--ux-text-secondary);
      font-size: var(--ux-font-size-lg);
      font-weight: 400;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
      transition:
        color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-picker__item--selected {
      color: var(--ux-text);
      font-weight: 500;
    }

    .ux-picker__item--disabled {
      color: var(--ux-text-tertiary);
      pointer-events: none;
    }

    /* 3D wheel effect */
    .ux-picker--3d .ux-picker__item {
      transform-style: preserve-3d;
      backface-visibility: hidden;
    }

    /* ========================================
       Picker Sizes
    ======================================== */

    .ux-picker--sm .ux-picker__columns {
      height: 180px;
    }

    .ux-picker--sm .ux-picker__item {
      height: 30px;
      font-size: var(--ux-font-size-md);
    }

    .ux-picker--sm .ux-picker__columns::before {
      height: 30px;
    }

    .ux-picker--lg .ux-picker__columns {
      height: 252px;
    }

    .ux-picker--lg .ux-picker__item {
      height: 42px;
      font-size: var(--ux-font-size-xl);
    }

    .ux-picker--lg .ux-picker__columns::before {
      height: 42px;
    }

    /* ========================================
       Inline Picker (not in modal)
    ======================================== */

    .ux-picker--inline {
      position: static;
      transform: none;
      border-radius: var(--ux-border-radius-lg);
      border: 1px solid var(--ux-border-color);
    }

    .ux-picker--inline .ux-picker__header {
      border-bottom: none;
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius-lg) var(--ux-border-radius-lg) 0 0;
    }

    /* ========================================
       Multi-column Dividers
    ======================================== */

    .ux-picker__divider {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 var(--ux-space-xs);
      color: var(--ux-text);
      font-size: var(--ux-font-size-lg);
      font-weight: 500;
    }

    /* ========================================
       Column Labels
    ======================================== */

    .ux-picker__column-label {
      position: absolute;
      top: var(--ux-space-xs);
      left: 0;
      right: 0;
      text-align: center;
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      z-index: 2;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-picker--glass {
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-picker--glass .ux-picker__header {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-picker--glass .ux-picker__highlight {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-picker-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-picker-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for picker
  // ARIA: role="listbox" for columns, role="option" for items
  const pickerComponent = (config = {}) => ({
    isOpen: false,
    columns: config.columns || [],
    selectedIndexes: [],
    title: config.title || '',
    cancelText: config.cancelText || 'Cancel',
    confirmText: config.confirmText || 'Done',
    showHeader: config.showHeader !== false,
    itemHeight: config.itemHeight || 36,
    visibleItems: config.visibleItems || 5,
    pickerId: config.id || 'ux-picker-' + Math.random().toString(36).substr(2, 9),
    _columnStates: [],
    _startY: 0,
    _currentY: 0,
    _activeColumn: null,

    // ARIA attributes
    get ariaAttrs() {
      return {
        'role': 'dialog',
        'aria-modal': 'true',
        'aria-labelledby': this.pickerId + '-title'
      };
    },

    get titleId() {
      return this.pickerId + '-title';
    },

    // ARIA for column
    getColumnAriaAttrs(columnIndex) {
      return {
        'role': 'listbox',
        'aria-label': this.columns[columnIndex]?.label || `Column ${columnIndex + 1}`,
        'tabindex': '0'
      };
    },

    // ARIA for item
    getItemAriaAttrs(columnIndex, itemIndex) {
      const isSelected = this.selectedIndexes[columnIndex] === itemIndex;
      return {
        'role': 'option',
        'aria-selected': isSelected ? 'true' : 'false',
        'id': `${this.pickerId}-col${columnIndex}-item${itemIndex}`
      };
    },

    init() {
      // Initialize selected indexes
      this.selectedIndexes = this.columns.map((col, i) => {
        return col.selectedIndex || 0;
      });

      // Initialize column states for drag
      this._columnStates = this.columns.map((col, i) => ({
        offset: -this.selectedIndexes[i] * this.itemHeight,
        isDragging: false
      }));
    },

    open(options = {}) {
      if (options.columns) {
        this.columns = options.columns;
        this.init();
      }
      if (options.title) this.title = options.title;

      this.isOpen = true;
      document.body.style.overflow = 'hidden';

      this.$nextTick(() => {
        // Update column positions
        this.columns.forEach((_, i) => {
          this.scrollToIndex(i, this.selectedIndexes[i], false);
        });
      });
    },

    close() {
      this.isOpen = false;
      document.body.style.overflow = '';
    },

    cancel() {
      this.$dispatch('picker-cancel');
      this.close();
    },

    confirm() {
      const values = this.columns.map((col, i) => {
        const idx = this.selectedIndexes[i];
        return col.options[idx];
      });

      this.$dispatch('picker-confirm', {
        values,
        indexes: [...this.selectedIndexes]
      });

      this.close();
    },

    // Get transform for column
    getColumnTransform(columnIndex) {
      const state = this._columnStates[columnIndex];
      if (!state) return 'translateY(0)';
      return `translateY(${state.offset}px)`;
    },

    // Scroll column to index
    scrollToIndex(columnIndex, itemIndex, animate = true) {
      const column = this.columns[columnIndex];
      if (!column) return;

      // Clamp index
      const maxIndex = column.options.length - 1;
      itemIndex = Math.max(0, Math.min(maxIndex, itemIndex));

      this.selectedIndexes[columnIndex] = itemIndex;
      this._columnStates[columnIndex].offset = -itemIndex * this.itemHeight;

      // Dispatch change event
      this.$dispatch('picker-change', {
        columnIndex,
        itemIndex,
        value: column.options[itemIndex]
      });
    },

    // Select item by click
    selectItem(columnIndex, itemIndex) {
      this.scrollToIndex(columnIndex, itemIndex);
    },

    // Check if item is selected
    isSelected(columnIndex, itemIndex) {
      return this.selectedIndexes[columnIndex] === itemIndex;
    },

    // Touch/drag handlers
    onTouchStart(event, columnIndex) {
      const state = this._columnStates[columnIndex];
      state.isDragging = true;
      this._activeColumn = columnIndex;
      this._startY = event.touches ? event.touches[0].clientY : event.clientY;
      this._startOffset = state.offset;
    },

    onTouchMove(event, columnIndex) {
      const state = this._columnStates[columnIndex];
      if (!state.isDragging) return;

      const clientY = event.touches ? event.touches[0].clientY : event.clientY;
      const deltaY = clientY - this._startY;

      // Apply resistance at boundaries
      const column = this.columns[columnIndex];
      const maxOffset = 0;
      const minOffset = -(column.options.length - 1) * this.itemHeight;

      let newOffset = this._startOffset + deltaY;

      // Rubber band effect
      if (newOffset > maxOffset) {
        newOffset = maxOffset + (newOffset - maxOffset) * 0.3;
      } else if (newOffset < minOffset) {
        newOffset = minOffset + (newOffset - minOffset) * 0.3;
      }

      state.offset = newOffset;

      event.preventDefault();
    },

    onTouchEnd(event, columnIndex) {
      const state = this._columnStates[columnIndex];
      if (!state.isDragging) return;

      state.isDragging = false;

      // Snap to nearest item
      const column = this.columns[columnIndex];
      const nearestIndex = Math.round(-state.offset / this.itemHeight);
      const clampedIndex = Math.max(0, Math.min(column.options.length - 1, nearestIndex));

      this.scrollToIndex(columnIndex, clampedIndex);
    },

    // Keyboard navigation
    handleKeydown(event, columnIndex) {
      const column = this.columns[columnIndex];
      const currentIndex = this.selectedIndexes[columnIndex];

      switch (event.key) {
        case 'ArrowUp':
          event.preventDefault();
          if (currentIndex > 0) {
            this.scrollToIndex(columnIndex, currentIndex - 1);
          }
          break;
        case 'ArrowDown':
          event.preventDefault();
          if (currentIndex < column.options.length - 1) {
            this.scrollToIndex(columnIndex, currentIndex + 1);
          }
          break;
        case 'Home':
          event.preventDefault();
          this.scrollToIndex(columnIndex, 0);
          break;
        case 'End':
          event.preventDefault();
          this.scrollToIndex(columnIndex, column.options.length - 1);
          break;
        case 'Enter':
          event.preventDefault();
          this.confirm();
          break;
        case 'Escape':
          event.preventDefault();
          this.cancel();
          break;
      }
    },

    // Get selected values
    getValues() {
      return this.columns.map((col, i) => {
        const idx = this.selectedIndexes[i];
        return col.options[idx];
      });
    },

    // Set values programmatically
    setValues(values) {
      values.forEach((value, i) => {
        const column = this.columns[i];
        if (!column) return;

        const index = column.options.findIndex(opt => {
          if (typeof opt === 'object') {
            return opt.value === value || opt.text === value;
          }
          return opt === value;
        });

        if (index !== -1) {
          this.scrollToIndex(i, index, false);
        }
      });
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxPicker', pickerComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxPicker', pickerComponent);
    });
  }

  // Helper to format picker option display
  window.UX = window.UX || {};
  window.UX.getPickerOptionText = function(option) {
    if (typeof option === 'object') {
      return option.text || option.label || option.value;
    }
    return option;
  };
})();

/**
 * UX Popover Component
 * Popovers y tooltips
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Popover
    ======================================== */

    .ux-popover {
      position: absolute;
      z-index: var(--ux-z-popover);
      min-width: 150px;
      max-width: 300px;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      box-shadow: var(--ux-shadow-xl);
      opacity: 0;
      visibility: hidden;
      transform: scale(0.95);
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        visibility var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease-spring);
    }

    .ux-popover--open {
      opacity: 1;
      visibility: visible;
      transform: scale(1);
    }

    /* ========================================
       Popover Arrow
    ======================================== */

    .ux-popover__arrow {
      position: absolute;
      width: 12px;
      height: 12px;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      transform: rotate(45deg);
    }

    .ux-popover--top .ux-popover__arrow {
      bottom: -7px;
      left: 50%;
      margin-left: -6px;
      border-top: none;
      border-left: none;
    }

    .ux-popover--bottom .ux-popover__arrow {
      top: -7px;
      left: 50%;
      margin-left: -6px;
      border-bottom: none;
      border-right: none;
    }

    .ux-popover--left .ux-popover__arrow {
      right: -7px;
      top: 50%;
      margin-top: -6px;
      border-bottom: none;
      border-left: none;
    }

    .ux-popover--right .ux-popover__arrow {
      left: -7px;
      top: 50%;
      margin-top: -6px;
      border-top: none;
      border-right: none;
    }

    /* Hide arrow */
    .ux-popover--no-arrow .ux-popover__arrow {
      display: none;
    }

    /* ========================================
       Popover Content
    ======================================== */

    .ux-popover__content {
      padding: var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
      line-height: 1.5;
    }

    .ux-popover__content--no-padding {
      padding: 0;
    }

    /* ========================================
       Popover Header
    ======================================== */

    .ux-popover__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm) var(--ux-space-md);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-popover__title {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-popover__close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      padding: 0;
      background: none;
      border: none;
      color: var(--ux-text-tertiary);
      cursor: pointer;
    }

    .ux-popover__close:hover {
      color: var(--ux-text);
    }

    .ux-popover__close svg {
      width: 14px;
      height: 14px;
    }

    /* ========================================
       Popover Sizes
    ======================================== */

    .ux-popover--sm {
      min-width: 100px;
      max-width: 200px;
    }

    .ux-popover--lg {
      min-width: 250px;
      max-width: 400px;
    }

    .ux-popover--auto {
      min-width: auto;
      max-width: none;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-popover--glass {
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-popover--glass .ux-popover__arrow {
      background-color: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
    }

    .ux-popover--glass .ux-popover__header {
      border-bottom-color: var(--ux-glass-border);
    }

    /* ========================================
       Tooltip (Simple Popover)
    ======================================== */

    .ux-tooltip {
      position: absolute;
      z-index: var(--ux-z-tooltip);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background-color: var(--ux-dark);
      color: var(--ux-dark-contrast);
      font-size: var(--ux-font-size-xs);
      border-radius: var(--ux-border-radius-sm);
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transform: translateY(4px);
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        visibility var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-tooltip--visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    /* Tooltip positions */
    .ux-tooltip--top {
      transform: translateY(-4px);
    }

    .ux-tooltip--top.ux-tooltip--visible {
      transform: translateY(0);
    }

    /* Tooltip Arrow */
    .ux-tooltip__arrow {
      position: absolute;
      width: 6px;
      height: 6px;
      background-color: var(--ux-dark);
      transform: rotate(45deg);
    }

    .ux-tooltip--bottom .ux-tooltip__arrow {
      top: -3px;
      left: 50%;
      margin-left: -3px;
    }

    .ux-tooltip--top .ux-tooltip__arrow {
      bottom: -3px;
      left: 50%;
      margin-left: -3px;
    }

    .ux-tooltip--left .ux-tooltip__arrow {
      right: -3px;
      top: 50%;
      margin-top: -3px;
    }

    .ux-tooltip--right .ux-tooltip__arrow {
      left: -3px;
      top: 50%;
      margin-top: -3px;
    }

    /* Tooltip colors */
    .ux-tooltip--light {
      background-color: var(--ux-surface);
      color: var(--ux-text);
      border: 1px solid var(--ux-border-color);
      box-shadow: var(--ux-shadow-md);
    }

    .ux-tooltip--light .ux-tooltip__arrow {
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
    }

    .ux-tooltip--primary {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-tooltip--primary .ux-tooltip__arrow {
      background-color: var(--ux-primary);
    }

    /* ========================================
       Popover Backdrop (for dismissible)
    ======================================== */

    .ux-popover-backdrop {
      position: fixed;
      inset: 0;
      z-index: var(--ux-z-modal-backdrop);
      background: transparent;
    }

    /* ========================================
       Popover Trigger
    ======================================== */

    .ux-popover-trigger {
      display: inline-block;
      position: relative;
    }

    /* ========================================
       Rich Tooltip (with more content)
    ======================================== */

    .ux-rich-tooltip {
      max-width: 280px;
      white-space: normal;
      padding: var(--ux-space-md);
    }

    .ux-rich-tooltip__title {
      font-weight: 600;
      margin-bottom: var(--ux-space-xs);
    }

    .ux-rich-tooltip__content {
      font-size: var(--ux-font-size-xs);
      opacity: 0.9;
      line-height: 1.4;
    }

    /* ========================================
       Dropdown Popover (with list)
    ======================================== */

    .ux-popover--dropdown {
      padding: var(--ux-space-xs) 0;
    }

    .ux-popover--dropdown .ux-popover__content {
      padding: 0;
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-popover {
        transition: opacity 0.1s ease, visibility 0.1s ease;
        transform: none;
      }

      .ux-popover--open {
        transform: none;
      }

      .ux-tooltip {
        transition: opacity 0.1s ease, visibility 0.1s ease;
        transform: none;
      }

      .ux-tooltip--visible {
        transform: none;
      }

      .ux-tooltip--top {
        transform: none;
      }

      .ux-tooltip--top.ux-tooltip--visible {
        transform: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-popover-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-popover-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for popover
  // ARIA: aria-expanded, aria-haspopup on trigger; described-by on popover
  const popoverComponent = (config = {}) => ({
    isOpen: false,
    position: config.position || 'bottom',
    trigger: config.trigger || 'click', // click, hover, focus
    dismissOnClickOutside: config.dismissOnClickOutside !== false,
    offset: config.offset || 8,
    popoverStyle: {},
    popoverId: config.id || 'ux-popover-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for the trigger element
    get triggerAriaAttrs() {
      return {
        'aria-haspopup': 'dialog',
        'aria-expanded': this.isOpen ? 'true' : 'false',
        'aria-controls': this.popoverId
      };
    },

    // ARIA attributes for the popover
    get popoverAriaAttrs() {
      return {
        'role': 'dialog',
        'id': this.popoverId,
        'aria-modal': 'false'
      };
    },

    open() {
      this.isOpen = true;
      this.$nextTick(() => {
        this.updatePosition();
      });
    },

    close() {
      this.isOpen = false;
    },

    toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    },

    actualPosition: 'bottom', // Tracks the actual position after collision detection

    updatePosition() {
      const trigger = this.$refs.trigger;
      const popover = this.$refs.popover;
      if (!trigger || !popover) return;

      const triggerRect = trigger.getBoundingClientRect();
      const popoverRect = popover.getBoundingClientRect();
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      const margin = 8;

      // Collision detection - check if preferred position fits
      let position = this.position;

      // Vertical collision detection
      if (position === 'bottom' && triggerRect.bottom + popoverRect.height + this.offset > viewportHeight - margin) {
        // Doesn't fit below, try top
        if (triggerRect.top - popoverRect.height - this.offset >= margin) {
          position = 'top';
        }
      } else if (position === 'top' && triggerRect.top - popoverRect.height - this.offset < margin) {
        // Doesn't fit above, try bottom
        if (triggerRect.bottom + popoverRect.height + this.offset <= viewportHeight - margin) {
          position = 'bottom';
        }
      }

      // Horizontal collision detection
      if (position === 'right' && triggerRect.right + popoverRect.width + this.offset > viewportWidth - margin) {
        // Doesn't fit right, try left
        if (triggerRect.left - popoverRect.width - this.offset >= margin) {
          position = 'left';
        }
      } else if (position === 'left' && triggerRect.left - popoverRect.width - this.offset < margin) {
        // Doesn't fit left, try right
        if (triggerRect.right + popoverRect.width + this.offset <= viewportWidth - margin) {
          position = 'right';
        }
      }

      this.actualPosition = position;

      let top, left;

      switch (position) {
        case 'top':
          top = triggerRect.top - popoverRect.height - this.offset;
          left = triggerRect.left + (triggerRect.width - popoverRect.width) / 2;
          break;
        case 'bottom':
          top = triggerRect.bottom + this.offset;
          left = triggerRect.left + (triggerRect.width - popoverRect.width) / 2;
          break;
        case 'left':
          top = triggerRect.top + (triggerRect.height - popoverRect.height) / 2;
          left = triggerRect.left - popoverRect.width - this.offset;
          break;
        case 'right':
          top = triggerRect.top + (triggerRect.height - popoverRect.height) / 2;
          left = triggerRect.right + this.offset;
          break;
      }

      // Final boundary clamping
      if (left < margin) left = margin;
      if (left + popoverRect.width > viewportWidth - margin) {
        left = viewportWidth - popoverRect.width - margin;
      }
      if (top < margin) top = margin;
      if (top + popoverRect.height > viewportHeight - margin) {
        top = viewportHeight - popoverRect.height - margin;
      }

      this.popoverStyle = {
        position: 'fixed',
        top: top + 'px',
        left: left + 'px'
      };
    },

    handleClickOutside(event) {
      if (this.dismissOnClickOutside && this.isOpen) {
        const popover = this.$refs.popover;
        const trigger = this.$refs.trigger;
        if (popover && !popover.contains(event.target) &&
            trigger && !trigger.contains(event.target)) {
          this.close();
        }
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxPopover', popoverComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxPopover', popoverComponent);
    });
  }

  // Alpine component for tooltip
  // ARIA: role="tooltip", aria-describedby on trigger
  const tooltipComponent = (config = {}) => ({
    isVisible: false,
    text: config.text || '',
    position: config.position || 'top',
    delay: config.delay || 200,
    tooltipStyle: {},
    _showTimer: null,
    tooltipId: config.id || 'ux-tooltip-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for the trigger element
    get triggerAriaAttrs() {
      return {
        'aria-describedby': this.isVisible ? this.tooltipId : null
      };
    },

    // ARIA attributes for the tooltip
    get tooltipAriaAttrs() {
      return {
        'role': 'tooltip',
        'id': this.tooltipId
      };
    },

    show() {
      this._showTimer = setTimeout(() => {
        this.isVisible = true;
        this.$nextTick(() => {
          this.updatePosition();
        });
      }, this.delay);
    },

    hide() {
      if (this._showTimer) {
        clearTimeout(this._showTimer);
        this._showTimer = null;
      }
      this.isVisible = false;
    },

    updatePosition() {
      const trigger = this.$refs.trigger;
      const tooltip = this.$refs.tooltip;
      if (!trigger || !tooltip) return;

      const triggerRect = trigger.getBoundingClientRect();
      const tooltipRect = tooltip.getBoundingClientRect();
      const offset = 8;

      let top, left;

      switch (this.position) {
        case 'top':
          top = triggerRect.top - tooltipRect.height - offset;
          left = triggerRect.left + (triggerRect.width - tooltipRect.width) / 2;
          break;
        case 'bottom':
          top = triggerRect.bottom + offset;
          left = triggerRect.left + (triggerRect.width - tooltipRect.width) / 2;
          break;
        case 'left':
          top = triggerRect.top + (triggerRect.height - tooltipRect.height) / 2;
          left = triggerRect.left - tooltipRect.width - offset;
          break;
        case 'right':
          top = triggerRect.top + (triggerRect.height - tooltipRect.height) / 2;
          left = triggerRect.right + offset;
          break;
      }

      this.tooltipStyle = {
        position: 'fixed',
        top: top + 'px',
        left: left + 'px'
      };
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxTooltip', tooltipComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxTooltip', tooltipComponent);
    });
  }
})();

/**
 * UX Product Card Component
 * Product cards for POS and e-commerce grids
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Product Card
    ======================================== */

    :root {
      --ux-product-card-radius: var(--ux-border-radius-lg);
      --ux-product-card-padding: var(--ux-space-sm);
      --ux-product-card-image-ratio: 1;
      --ux-product-card-gap: var(--ux-space-xs);
    }

    .ux-product-card {
      display: flex;
      flex-direction: column;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-product-card-radius);
      overflow: hidden;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition:
        transform 150ms var(--ux-ease),
        box-shadow 150ms var(--ux-ease),
        border-color 150ms var(--ux-ease);
    }

    .ux-product-card:hover {
      border-color: var(--ux-primary);
      box-shadow: var(--ux-shadow-md);
    }

    .ux-product-card:active {
      transform: scale(0.97);
    }

    /* Disabled/Unavailable state */
    .ux-product-card--unavailable {
      opacity: 0.5;
      pointer-events: none;
    }

    .ux-product-card--out-of-stock {
      position: relative;
    }

    .ux-product-card--out-of-stock::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(var(--ux-gray-900-rgb, 17, 24, 39), 0.4);
      border-radius: var(--ux-product-card-radius);
    }

    /* Selected state */
    .ux-product-card--selected {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 2px rgba(var(--ux-primary-rgb), 0.3);
    }

    /* ========================================
       Product Image
    ======================================== */

    .ux-product-card__image-wrapper {
      position: relative;
      aspect-ratio: var(--ux-product-card-image-ratio);
      background-color: var(--ux-surface-secondary);
      overflow: hidden;
    }

    .ux-product-card__image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 300ms var(--ux-ease);
    }

    .ux-product-card:hover .ux-product-card__image {
      transform: scale(1.05);
    }

    /* Placeholder when no image */
    .ux-product-card__placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--ux-surface-secondary) 0%, var(--ux-surface-tertiary) 100%);
      color: var(--ux-text-tertiary);
    }

    .ux-product-card__placeholder svg {
      width: 48px;
      height: 48px;
      opacity: 0.5;
    }

    /* ========================================
       Product Badges
    ======================================== */

    .ux-product-card__badges {
      position: absolute;
      top: var(--ux-space-xs);
      left: var(--ux-space-xs);
      right: var(--ux-space-xs);
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
      z-index: 2;
    }

    .ux-product-card__badge {
      display: inline-flex;
      align-items: center;
      padding: 2px var(--ux-space-xs);
      background-color: var(--ux-primary);
      border-radius: var(--ux-border-radius-sm);
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-primary-contrast);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-product-card__badge--sale {
      background-color: var(--ux-danger);
      color: white;
    }

    .ux-product-card__badge--new {
      background-color: var(--ux-success);
      color: white;
    }

    .ux-product-card__badge--low-stock {
      background-color: var(--ux-warning);
      color: var(--ux-gray-900);
    }

    .ux-product-card__badge--out {
      background-color: var(--ux-gray-600);
      color: white;
    }

    /* ========================================
       Product Content
    ======================================== */

    .ux-product-card__content {
      display: flex;
      flex-direction: column;
      gap: var(--ux-product-card-gap);
      padding: var(--ux-product-card-padding);
      flex: 1;
    }

    .ux-product-card__name {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      margin: 0;
    }

    .ux-product-card__category {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-product-card__sku {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      font-family: monospace;
    }

    /* ========================================
       Product Price
    ======================================== */

    .ux-product-card__price-wrapper {
      display: flex;
      align-items: baseline;
      gap: var(--ux-space-xs);
      flex-wrap: wrap;
    }

    .ux-product-card__price {
      font-size: var(--ux-font-size-lg);
      font-weight: 700;
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
    }

    .ux-product-card__price--sale {
      color: var(--ux-danger);
    }

    .ux-product-card__price-original {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
      text-decoration: line-through;
    }

    .ux-product-card__discount {
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-danger);
      background-color: rgba(var(--ux-danger-rgb, 255, 59, 48), 0.1);
      padding: 1px var(--ux-space-xs);
      border-radius: var(--ux-border-radius-sm);
    }

    /* ========================================
       Product Stock
    ======================================== */

    .ux-product-card__stock {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
    }

    .ux-product-card__stock--low {
      color: var(--ux-warning);
    }

    .ux-product-card__stock--out {
      color: var(--ux-danger);
    }

    .ux-product-card__stock--available {
      color: var(--ux-success);
    }

    /* ========================================
       Quick Add Button
    ======================================== */

    .ux-product-card__quick-add {
      position: absolute;
      bottom: var(--ux-space-sm);
      right: var(--ux-space-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background-color: var(--ux-primary);
      border: none;
      border-radius: 50%;
      color: var(--ux-primary-contrast);
      cursor: pointer;
      opacity: 0;
      transform: scale(0.8);
      transition:
        opacity 150ms var(--ux-ease),
        transform 150ms var(--ux-ease),
        background-color 150ms var(--ux-ease);
      z-index: 3;
    }

    .ux-product-card:hover .ux-product-card__quick-add {
      opacity: 1;
      transform: scale(1);
    }

    .ux-product-card__quick-add:hover {
      background-color: var(--ux-primary-shade);
    }

    .ux-product-card__quick-add:active {
      transform: scale(0.9);
    }

    .ux-product-card__quick-add svg {
      width: 20px;
      height: 20px;
    }

    /* Always show quick add on touch devices */
    @media (hover: none) {
      .ux-product-card__quick-add {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* ========================================
       Product Grid
    ======================================== */

    .ux-product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: var(--ux-space-md);
    }

    .ux-product-grid--2 {
      grid-template-columns: repeat(2, 1fr);
    }

    .ux-product-grid--3 {
      grid-template-columns: repeat(3, 1fr);
    }

    .ux-product-grid--4 {
      grid-template-columns: repeat(4, 1fr);
    }

    .ux-product-grid--5 {
      grid-template-columns: repeat(5, 1fr);
    }

    .ux-product-grid--6 {
      grid-template-columns: repeat(6, 1fr);
    }

    .ux-product-grid--compact {
      gap: var(--ux-space-sm);
    }

    /* Responsive grid */
    @media (max-width: 991px) {
      .ux-product-grid--4,
      .ux-product-grid--5,
      .ux-product-grid--6 {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 767px) {
      .ux-product-grid--3,
      .ux-product-grid--4,
      .ux-product-grid--5,
      .ux-product-grid--6 {
        grid-template-columns: repeat(2, 1fr);
      }

      .ux-product-grid {
        gap: var(--ux-space-sm);
      }
    }

    /* ========================================
       Card Sizes
    ======================================== */

    .ux-product-card--sm {
      --ux-product-card-padding: var(--ux-space-xs);
    }

    .ux-product-card--sm .ux-product-card__name {
      font-size: var(--ux-font-size-xs);
      -webkit-line-clamp: 1;
    }

    .ux-product-card--sm .ux-product-card__price {
      font-size: var(--ux-font-size-md);
    }

    .ux-product-card--lg {
      --ux-product-card-padding: var(--ux-space-md);
    }

    .ux-product-card--lg .ux-product-card__name {
      font-size: var(--ux-font-size-md);
    }

    .ux-product-card--lg .ux-product-card__price {
      font-size: var(--ux-font-size-xl);
    }

    /* ========================================
       Horizontal Layout
    ======================================== */

    .ux-product-card--horizontal {
      flex-direction: row;
    }

    .ux-product-card--horizontal .ux-product-card__image-wrapper {
      width: 100px;
      min-height: 100px;
      aspect-ratio: 1;
      flex-shrink: 0;
    }

    .ux-product-card--horizontal .ux-product-card__content {
      justify-content: center;
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-product-card--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-product-card--glass .ux-product-card__placeholder {
      background: var(--ux-glass-bg-thin);
    }

    /* ========================================
       Add to Cart Animation
    ======================================== */

    @keyframes ux-product-add-pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(var(--ux-primary-rgb), 0.4);
      }
      70% {
        box-shadow: 0 0 0 15px rgba(var(--ux-primary-rgb), 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(var(--ux-primary-rgb), 0);
      }
    }

    .ux-product-card--adding {
      animation: ux-product-add-pulse 0.5s ease-out;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-product-card {
        border-color: var(--ux-border-color);
      }
    }

    .ux-dark .ux-product-card {
      border-color: var(--ux-border-color);
    }
  `;

  // Icons
  const icons = {
    placeholder: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>',
    plus: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>',
    cart: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"/></svg>',
    check: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>'
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-product-card-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-product-card-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for product card
  const productCardComponent = (config = {}) => ({
    // Product data
    product: config.product || {},

    // State
    isAdding: false,
    isSelected: false,

    // Configuration
    showQuickAdd: config.showQuickAdd !== false,
    currency: config.currency || '$',
    locale: config.locale || 'en-US',
    lowStockThreshold: config.lowStockThreshold || 5,

    // Labels
    labels: {
      addToCart: config.labels?.addToCart || 'Add to cart',
      outOfStock: config.labels?.outOfStock || 'Out of stock',
      lowStock: config.labels?.lowStock || 'Low stock',
      inStock: config.labels?.inStock || 'In stock',
      sale: config.labels?.sale || 'Sale',
      new: config.labels?.new || 'New',
      ...config.labels
    },

    // Initialize
    init() {
      // Set initial selected state
      if (config.selected) {
        this.isSelected = true;
      }
    },

    // Format price
    formatPrice(price) {
      if (price === null || price === undefined) return '';
      return new Intl.NumberFormat(this.locale, {
        style: 'currency',
        currency: this.getCurrencyCode()
      }).format(price);
    },

    // Get currency code from symbol
    getCurrencyCode() {
      const currencyMap = {
        '$': 'USD',
        'â¬': 'EUR',
        'Â£': 'GBP',
        'Â¥': 'JPY',
        'â¹': 'INR'
      };
      return currencyMap[this.currency] || 'USD';
    },

    // Calculate discount percentage
    getDiscountPercent() {
      if (!this.product.originalPrice || !this.product.price) return 0;
      const discount = ((this.product.originalPrice - this.product.price) / this.product.originalPrice) * 100;
      return Math.round(discount);
    },

    // Get stock status
    getStockStatus() {
      const stock = this.product.stock;
      if (stock === undefined || stock === null) return 'available';
      if (stock <= 0) return 'out';
      if (stock <= this.lowStockThreshold) return 'low';
      return 'available';
    },

    // Get stock text
    getStockText() {
      const status = this.getStockStatus();
      const stock = this.product.stock;

      switch (status) {
        case 'out':
          return this.labels.outOfStock;
        case 'low':
          return `${this.labels.lowStock}: ${stock}`;
        default:
          return stock !== undefined ? `${this.labels.inStock}: ${stock}` : '';
      }
    },

    // Check if product is available
    isAvailable() {
      return this.getStockStatus() !== 'out';
    },

    // Add to cart with animation
    addToCart(event) {
      if (event) event.stopPropagation();
      if (!this.isAvailable()) return;

      this.isAdding = true;

      this.$dispatch('product-add', {
        product: this.product,
        quantity: 1
      });

      // Reset animation after delay
      setTimeout(() => {
        this.isAdding = false;
      }, 500);
    },

    // Select product
    select() {
      this.$dispatch('product-select', {
        product: this.product,
        selected: !this.isSelected
      });
    },

    // Get icon
    getIcon(name) {
      return icons[name] || '';
    }
  });

  // Alpine component for product grid
  const productGridComponent = (config = {}) => ({
    products: config.products || [],
    selectedProducts: [],
    multiSelect: config.multiSelect || false,

    // Filter and sort
    searchQuery: '',
    sortBy: config.sortBy || 'name',
    sortDirection: 'asc',
    categoryFilter: '',

    // Get filtered products
    get filteredProducts() {
      let result = this.products;

      // Search filter
      if (this.searchQuery) {
        const query = this.searchQuery.toLowerCase();
        result = result.filter(p =>
          p.name?.toLowerCase().includes(query) ||
          p.sku?.toLowerCase().includes(query) ||
          p.category?.toLowerCase().includes(query)
        );
      }

      // Category filter
      if (this.categoryFilter) {
        result = result.filter(p => p.category === this.categoryFilter);
      }

      // Sort
      result = [...result].sort((a, b) => {
        let valA = a[this.sortBy];
        let valB = b[this.sortBy];

        if (typeof valA === 'string') {
          valA = valA.toLowerCase();
          valB = valB?.toLowerCase() || '';
        }

        if (valA < valB) return this.sortDirection === 'asc' ? -1 : 1;
        if (valA > valB) return this.sortDirection === 'asc' ? 1 : -1;
        return 0;
      });

      return result;
    },

    // Get unique categories
    get categories() {
      const cats = new Set();
      this.products.forEach(p => {
        if (p.category) cats.add(p.category);
      });
      return Array.from(cats).sort();
    },

    // Toggle product selection
    toggleSelect(product) {
      const index = this.selectedProducts.findIndex(p => p.id === product.id);
      if (index > -1) {
        this.selectedProducts.splice(index, 1);
      } else {
        if (!this.multiSelect) {
          this.selectedProducts = [];
        }
        this.selectedProducts.push(product);
      }
      this.$dispatch('selection-change', { selected: this.selectedProducts });
    },

    // Check if product is selected
    isSelected(product) {
      return this.selectedProducts.some(p => p.id === product.id);
    },

    // Clear selection
    clearSelection() {
      this.selectedProducts = [];
      this.$dispatch('selection-change', { selected: [] });
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxProductCard', productCardComponent);
    window.UX.registerComponent('uxProductGrid', productGridComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxProductCard', productCardComponent);
      Alpine.data('uxProductGrid', productGridComponent);
    });
  }
})();

/**
 * UX Production Line Status Component
 * Visual production line representation with stations, metrics, and real-time status
 * @requires ux-core.js
 * @requires Alpine.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Production Line - Base
    ======================================== */

    :root {
      --ux-production-line-gap: var(--ux-space-md);
      --ux-production-line-station-size: 64px;
      --ux-production-line-station-size-sm: 48px;
      --ux-production-line-station-size-lg: 80px;
      --ux-production-line-connector-height: 4px;
      --ux-production-line-flow-duration: 2s;
    }

    .ux-production-line {
      font-family: var(--ux-font-family);
      background: var(--ux-surface);
      border-radius: var(--ux-radius-lg);
      padding: var(--ux-space-lg);
      border: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Header
    ======================================== */

    .ux-production-line__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--ux-space-lg);
      flex-wrap: wrap;
      gap: var(--ux-space-md);
    }

    .ux-production-line__title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-production-line__status-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: 0.25rem 0.75rem;
      border-radius: var(--ux-radius-full);
      font-size: 0.75rem;
      font-weight: 500;
    }

    .ux-production-line__status-badge--running {
      background: rgba(var(--ux-success-rgb), 0.15);
      color: var(--ux-success);
    }

    .ux-production-line__status-badge--stopped {
      background: rgba(var(--ux-gray-500-rgb, 107, 114, 128), 0.15);
      color: var(--ux-gray-500);
    }

    .ux-production-line__status-badge--maintenance {
      background: rgba(var(--ux-warning-rgb), 0.15);
      color: var(--ux-warning-shade);
    }

    .ux-production-line__status-badge--error {
      background: rgba(var(--ux-danger-rgb), 0.15);
      color: var(--ux-danger);
    }

    .ux-production-line__status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
    }

    .ux-production-line__status-badge--running .ux-production-line__status-dot {
      animation: ux-production-pulse 1.5s ease-in-out infinite;
    }

    @keyframes ux-production-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* ========================================
       Metrics Bar
    ======================================== */

    .ux-production-line__metrics {
      display: flex;
      gap: var(--ux-space-lg);
      flex-wrap: wrap;
      margin-bottom: var(--ux-space-lg);
      padding: var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
    }

    .ux-production-line__metric {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 100px;
    }

    .ux-production-line__metric-label {
      font-size: 0.75rem;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .ux-production-line__metric-value {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
      display: flex;
      align-items: baseline;
      gap: var(--ux-space-xs);
    }

    .ux-production-line__metric-unit {
      font-size: 0.875rem;
      font-weight: 400;
      color: var(--ux-text-secondary);
    }

    .ux-production-line__metric-trend {
      font-size: 0.75rem;
      font-weight: 500;
    }

    .ux-production-line__metric-trend--up {
      color: var(--ux-success);
    }

    .ux-production-line__metric-trend--down {
      color: var(--ux-danger);
    }

    /* ========================================
       Progress Bar (Target vs Actual)
    ======================================== */

    .ux-production-line__progress {
      margin-bottom: var(--ux-space-lg);
    }

    .ux-production-line__progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--ux-space-xs);
      font-size: 0.875rem;
    }

    .ux-production-line__progress-label {
      color: var(--ux-text-secondary);
    }

    .ux-production-line__progress-values {
      font-weight: 500;
      font-variant-numeric: tabular-nums;
    }

    .ux-production-line__progress-actual {
      color: var(--ux-text);
    }

    .ux-production-line__progress-target {
      color: var(--ux-text-tertiary);
    }

    .ux-production-line__progress-bar {
      height: 8px;
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-full);
      overflow: hidden;
      position: relative;
    }

    .ux-production-line__progress-fill {
      height: 100%;
      background: var(--ux-primary);
      border-radius: var(--ux-radius-full);
      transition: width var(--ux-transition-slow);
    }

    .ux-production-line__progress-fill--success {
      background: var(--ux-success);
    }

    .ux-production-line__progress-fill--warning {
      background: var(--ux-warning);
    }

    .ux-production-line__progress-fill--danger {
      background: var(--ux-danger);
    }

    .ux-production-line__progress-target-marker {
      position: absolute;
      top: -2px;
      bottom: -2px;
      width: 2px;
      background: var(--ux-text);
      border-radius: 1px;
    }

    /* ========================================
       Stations Container
    ======================================== */

    .ux-production-line__stations {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      position: relative;
      padding: var(--ux-space-lg) 0;
      overflow-x: auto;
    }

    .ux-production-line__stations-wrapper {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      min-width: 100%;
      gap: var(--ux-space-sm);
    }

    /* ========================================
       Station
    ======================================== */

    .ux-production-line__station {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      min-width: 80px;
      max-width: 150px;
      position: relative;
    }

    .ux-production-line__station-icon {
      width: var(--ux-production-line-station-size);
      height: var(--ux-production-line-station-size);
      border-radius: var(--ux-radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--ux-surface-secondary);
      border: 2px solid var(--ux-border-color);
      color: var(--ux-text-secondary);
      position: relative;
      z-index: 2;
      transition: all var(--ux-transition-fast);
    }

    .ux-production-line__station-icon svg {
      width: 24px;
      height: 24px;
    }

    /* Station Status Colors */
    .ux-production-line__station--running .ux-production-line__station-icon {
      background: rgba(var(--ux-success-rgb), 0.15);
      border-color: var(--ux-success);
      color: var(--ux-success);
    }

    .ux-production-line__station--stopped .ux-production-line__station-icon {
      background: var(--ux-surface-secondary);
      border-color: var(--ux-gray-400);
      color: var(--ux-gray-500);
    }

    .ux-production-line__station--maintenance .ux-production-line__station-icon {
      background: rgba(var(--ux-warning-rgb), 0.15);
      border-color: var(--ux-warning);
      color: var(--ux-warning-shade);
    }

    .ux-production-line__station--error .ux-production-line__station-icon {
      background: rgba(var(--ux-danger-rgb), 0.15);
      border-color: var(--ux-danger);
      color: var(--ux-danger);
      animation: ux-station-error-pulse 1s ease-in-out infinite;
    }

    @keyframes ux-station-error-pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(var(--ux-danger-rgb), 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(var(--ux-danger-rgb), 0); }
    }

    /* Station Alert Badge */
    .ux-production-line__station-alert {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--ux-danger);
      color: white;
      font-size: 0.625rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 3;
      animation: ux-alert-bounce 0.5s ease;
    }

    @keyframes ux-alert-bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    /* Station Label */
    .ux-production-line__station-label {
      margin-top: var(--ux-space-sm);
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--ux-text);
      text-align: center;
      white-space: nowrap;
    }

    .ux-production-line__station-sublabel {
      font-size: 0.625rem;
      color: var(--ux-text-tertiary);
      margin-top: 2px;
      text-align: center;
    }

    /* ========================================
       Connector Lines
    ======================================== */

    .ux-production-line__connector {
      flex: 1;
      height: var(--ux-production-line-connector-height);
      background: var(--ux-border-color);
      margin-top: calc(var(--ux-production-line-station-size) / 2 - var(--ux-production-line-connector-height) / 2);
      position: relative;
      min-width: 20px;
      border-radius: var(--ux-radius-full);
      overflow: hidden;
    }

    /* Animated Flow */
    .ux-production-line__connector--active {
      background: var(--ux-surface-secondary);
    }

    .ux-production-line__connector-flow {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background: linear-gradient(
        90deg,
        transparent 0%,
        var(--ux-success) 20%,
        var(--ux-success) 40%,
        transparent 60%
      );
      background-size: 200% 100%;
      animation: ux-flow-animation var(--ux-production-line-flow-duration) linear infinite;
    }

    @keyframes ux-flow-animation {
      0% { background-position: 100% 0; }
      100% { background-position: -100% 0; }
    }

    .ux-production-line__connector--inactive .ux-production-line__connector-flow {
      display: none;
    }

    /* ========================================
       Station Tooltip
    ======================================== */

    .ux-production-line__station-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-bottom: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-gray-900);
      color: white;
      border-radius: var(--ux-radius-md);
      font-size: 0.75rem;
      white-space: nowrap;
      z-index: 10;
      opacity: 0;
      visibility: hidden;
      transition: all var(--ux-transition-fast);
      pointer-events: none;
    }

    .ux-production-line__station-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: var(--ux-gray-900);
    }

    .ux-production-line__station:hover .ux-production-line__station-tooltip,
    .ux-production-line__station:focus-within .ux-production-line__station-tooltip {
      opacity: 1;
      visibility: visible;
    }

    .ux-production-line__tooltip-row {
      display: flex;
      justify-content: space-between;
      gap: var(--ux-space-md);
    }

    .ux-production-line__tooltip-row + .ux-production-line__tooltip-row {
      margin-top: 4px;
      padding-top: 4px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .ux-production-line__tooltip-label {
      color: rgba(255, 255, 255, 0.7);
    }

    .ux-production-line__tooltip-value {
      font-weight: 600;
    }

    /* ========================================
       Speed Indicator
    ======================================== */

    .ux-production-line__speed {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
      font-size: 0.875rem;
    }

    .ux-production-line__speed-label {
      color: var(--ux-text-secondary);
    }

    .ux-production-line__speed-value {
      font-weight: 600;
      font-variant-numeric: tabular-nums;
      color: var(--ux-text);
    }

    .ux-production-line__speed-bar {
      width: 60px;
      height: 4px;
      background: var(--ux-border-color);
      border-radius: var(--ux-radius-full);
      overflow: hidden;
    }

    .ux-production-line__speed-fill {
      height: 100%;
      background: var(--ux-primary);
      border-radius: var(--ux-radius-full);
      transition: width var(--ux-transition-normal);
    }

    /* ========================================
       Downtime Display
    ======================================== */

    .ux-production-line__downtime {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: rgba(var(--ux-danger-rgb), 0.1);
      border-radius: var(--ux-radius-md);
      color: var(--ux-danger);
      font-size: 0.875rem;
    }

    .ux-production-line__downtime-icon {
      width: 16px;
      height: 16px;
    }

    .ux-production-line__downtime-value {
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }

    /* ========================================
       Footer / Actions
    ======================================== */

    .ux-production-line__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: var(--ux-space-lg);
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
      flex-wrap: wrap;
      gap: var(--ux-space-md);
    }

    .ux-production-line__footer-info {
      display: flex;
      gap: var(--ux-space-lg);
      flex-wrap: wrap;
    }

    .ux-production-line__last-update {
      font-size: 0.75rem;
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-production-line--sm .ux-production-line__station-icon {
      width: var(--ux-production-line-station-size-sm);
      height: var(--ux-production-line-station-size-sm);
    }

    .ux-production-line--sm .ux-production-line__station-icon svg {
      width: 18px;
      height: 18px;
    }

    .ux-production-line--sm .ux-production-line__connector {
      margin-top: calc(var(--ux-production-line-station-size-sm) / 2 - var(--ux-production-line-connector-height) / 2);
    }

    .ux-production-line--lg .ux-production-line__station-icon {
      width: var(--ux-production-line-station-size-lg);
      height: var(--ux-production-line-station-size-lg);
    }

    .ux-production-line--lg .ux-production-line__station-icon svg {
      width: 32px;
      height: 32px;
    }

    .ux-production-line--lg .ux-production-line__connector {
      margin-top: calc(var(--ux-production-line-station-size-lg) / 2 - var(--ux-production-line-connector-height) / 2);
    }

    /* ========================================
       Compact Mode (No metrics)
    ======================================== */

    .ux-production-line--compact .ux-production-line__metrics {
      display: none;
    }

    .ux-production-line--compact .ux-production-line__progress {
      display: none;
    }

    .ux-production-line--compact {
      padding: var(--ux-space-md);
    }

    /* ========================================
       Vertical Layout
    ======================================== */

    .ux-production-line--vertical .ux-production-line__stations-wrapper {
      flex-direction: column;
      align-items: center;
      gap: 0;
    }

    .ux-production-line--vertical .ux-production-line__station {
      flex-direction: row;
      max-width: none;
      width: 100%;
      justify-content: flex-start;
      gap: var(--ux-space-md);
    }

    .ux-production-line--vertical .ux-production-line__station-label {
      margin-top: 0;
      text-align: left;
    }

    .ux-production-line--vertical .ux-production-line__connector {
      width: var(--ux-production-line-connector-height);
      height: 30px;
      margin: 0;
      margin-left: calc(var(--ux-production-line-station-size) / 2 - var(--ux-production-line-connector-height) / 2);
      flex: none;
    }

    .ux-production-line--vertical .ux-production-line__connector-flow {
      background: linear-gradient(
        180deg,
        transparent 0%,
        var(--ux-success) 20%,
        var(--ux-success) 40%,
        transparent 60%
      );
      background-size: 100% 200%;
      animation: ux-flow-vertical var(--ux-production-line-flow-duration) linear infinite;
    }

    @keyframes ux-flow-vertical {
      0% { background-position: 0 100%; }
      100% { background-position: 0 -100%; }
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-production-line--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-production-line--glass .ux-production-line__metrics {
      background: rgba(var(--ux-surface-rgb, 255, 255, 255), 0.5);
    }

    .ux-production-line--glass .ux-production-line__station-icon {
      background: rgba(var(--ux-surface-rgb, 255, 255, 255), 0.5);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-production-line__station-tooltip {
        background: var(--ux-gray-800);
      }

      .ux-production-line__station-tooltip::after {
        border-top-color: var(--ux-gray-800);
      }

      .ux-production-line--glass .ux-production-line__metrics {
        background: rgba(var(--ux-surface-rgb, 30, 30, 30), 0.5);
      }

      .ux-production-line--glass .ux-production-line__station-icon {
        background: rgba(var(--ux-surface-rgb, 30, 30, 30), 0.5);
      }
    }

    .ux-dark .ux-production-line__station-tooltip {
      background: var(--ux-gray-800);
    }

    .ux-dark .ux-production-line__station-tooltip::after {
      border-top-color: var(--ux-gray-800);
    }

    .ux-dark .ux-production-line--glass .ux-production-line__metrics,
    .ux-dark .ux-production-line--glass .ux-production-line__station-icon {
      background: rgba(var(--ux-surface-rgb, 30, 30, 30), 0.5);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-production-line__header {
        flex-direction: column;
        align-items: flex-start;
      }

      .ux-production-line__metrics {
        flex-direction: column;
        gap: var(--ux-space-md);
      }

      .ux-production-line__metric {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        min-width: 100%;
      }

      .ux-production-line__stations {
        padding: var(--ux-space-md) 0;
      }

      .ux-production-line__footer {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-production-line__connector-flow,
      .ux-production-line__status-badge--running .ux-production-line__status-dot,
      .ux-production-line__station--error .ux-production-line__station-icon {
        animation: none;
      }

      .ux-production-line__progress-fill,
      .ux-production-line__speed-fill {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-production-line-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-production-line-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const productionLineData = (options = {}) => ({
    // Configuration
    name: options.name || 'Production Line',
    status: options.status || 'running', // running, stopped, maintenance, error
    stations: options.stations || [],
    target: options.target || 1000,
    actual: options.actual || 0,
    efficiency: options.efficiency || 0,
    speed: options.speed || 0, // 0-100
    maxSpeed: options.maxSpeed || 100,
    downtime: options.downtime || 0, // in minutes
    lastUpdate: options.lastUpdate || null,
    showFlow: options.showFlow ?? true,
    updateInterval: options.updateInterval || null, // for auto-refresh

    // Internal state
    _updateTimer: null,

    // Computed
    get progressPercent() {
      if (this.target <= 0) return 0;
      return Math.min(100, (this.actual / this.target) * 100);
    },

    get progressStatus() {
      const percent = this.progressPercent;
      if (percent >= 100) return 'success';
      if (percent >= 75) return 'primary';
      if (percent >= 50) return 'warning';
      return 'danger';
    },

    get speedPercent() {
      if (this.maxSpeed <= 0) return 0;
      return Math.min(100, (this.speed / this.maxSpeed) * 100);
    },

    get efficiencyDisplay() {
      return this.efficiency.toFixed(1);
    },

    get downtimeDisplay() {
      if (this.downtime < 60) {
        return `${this.downtime}m`;
      }
      const hours = Math.floor(this.downtime / 60);
      const mins = this.downtime % 60;
      return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;
    },

    get isRunning() {
      return this.status === 'running';
    },

    get runningStationsCount() {
      return this.stations.filter(s => s.status === 'running').length;
    },

    get errorStationsCount() {
      return this.stations.filter(s => s.status === 'error').length;
    },

    // Lifecycle
    init() {
      // Set last update if not provided
      if (!this.lastUpdate) {
        this.lastUpdate = new Date();
      }

      // Start auto-refresh if configured
      if (this.updateInterval && this.updateInterval > 0) {
        this._updateTimer = setInterval(() => {
          this.$dispatch('productionline:refresh');
        }, this.updateInterval);
      }
    },

    destroy() {
      if (this._updateTimer) {
        clearInterval(this._updateTimer);
        this._updateTimer = null;
      }
    },

    // Methods
    setStatus(newStatus) {
      this.status = newStatus;
      this.$dispatch('productionline:statuschange', { status: newStatus });
    },

    updateActual(value) {
      this.actual = value;
      this.$dispatch('productionline:update', {
        actual: value,
        progress: this.progressPercent
      });
    },

    updateStation(index, data) {
      if (this.stations[index]) {
        this.stations[index] = { ...this.stations[index], ...data };
        this.$dispatch('productionline:stationupdate', {
          index,
          station: this.stations[index]
        });
      }
    },

    setStationStatus(index, status) {
      if (this.stations[index]) {
        this.stations[index].status = status;
        this.$dispatch('productionline:stationstatus', {
          index,
          status
        });
      }
    },

    addAlert(stationIndex, count = 1) {
      if (this.stations[stationIndex]) {
        this.stations[stationIndex].alerts = (this.stations[stationIndex].alerts || 0) + count;
      }
    },

    clearAlerts(stationIndex) {
      if (this.stations[stationIndex]) {
        this.stations[stationIndex].alerts = 0;
      }
    },

    updateMetrics(data) {
      if (data.actual !== undefined) this.actual = data.actual;
      if (data.efficiency !== undefined) this.efficiency = data.efficiency;
      if (data.speed !== undefined) this.speed = data.speed;
      if (data.downtime !== undefined) this.downtime = data.downtime;
      this.lastUpdate = new Date();
      this.$dispatch('productionline:metricsupdate', data);
    },

    // Check if connector between stations should show flow
    isConnectorActive(index) {
      if (!this.showFlow || !this.isRunning) return false;
      // Active if both connected stations are running
      const current = this.stations[index];
      const next = this.stations[index + 1];
      return current?.status === 'running' && next?.status === 'running';
    },

    // Format last update time
    formatLastUpdate() {
      if (!this.lastUpdate) return '';
      const date = this.lastUpdate instanceof Date ? this.lastUpdate : new Date(this.lastUpdate);
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    },

    // Get station status class
    getStationClass(station) {
      return `ux-production-line__station--${station.status || 'stopped'}`;
    },

    // Get station status label
    getStatusLabel(status) {
      const labels = {
        running: 'Running',
        stopped: 'Stopped',
        maintenance: 'Maintenance',
        error: 'Error'
      };
      return labels[status] || status;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxProductionLine', productionLineData);
  }

})();

/**
 * UX Progress Circle Component
 * Circular progress indicator with percentage and animated fill
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Progress Circle Container
       ========================================================================== */

    :root {
      --ux-progress-circle-size: 120px;
      --ux-progress-circle-stroke: 8px;
      --ux-progress-circle-bg: var(--ux-gray-200);
      --ux-progress-circle-color: var(--ux-primary);
      --ux-progress-circle-duration: 1s;
    }

    .ux-progress-circle {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-progress-circle-size);
      height: var(--ux-progress-circle-size);
    }

    .ux-progress-circle__svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .ux-progress-circle__bg {
      fill: none;
      stroke: var(--ux-progress-circle-bg);
      stroke-width: var(--ux-progress-circle-stroke);
    }

    .ux-progress-circle__fill {
      fill: none;
      stroke: var(--ux-progress-circle-color);
      stroke-width: var(--ux-progress-circle-stroke);
      stroke-linecap: round;
      transition: stroke-dashoffset var(--ux-progress-circle-duration) var(--ux-ease-out);
    }

    .ux-progress-circle--animated .ux-progress-circle__fill {
      animation: ux-progress-circle-fill var(--ux-progress-circle-duration) var(--ux-ease-out) forwards;
    }

    @keyframes ux-progress-circle-fill {
      from {
        stroke-dashoffset: var(--circumference);
      }
    }

    /* ==========================================================================
       Center Content
       ========================================================================== */

    .ux-progress-circle__content {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .ux-progress-circle__value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--ux-text);
      line-height: 1;
      font-variant-numeric: tabular-nums;
    }

    .ux-progress-circle__label {
      font-size: 0.75rem;
      color: var(--ux-text-secondary);
      margin-top: 2px;
    }

    .ux-progress-circle__icon {
      width: 32px;
      height: 32px;
      color: var(--ux-progress-circle-color);
    }

    /* ==========================================================================
       Size Variants
       ========================================================================== */

    .ux-progress-circle--xs {
      --ux-progress-circle-size: 48px;
      --ux-progress-circle-stroke: 4px;
    }

    .ux-progress-circle--xs .ux-progress-circle__value {
      font-size: 0.875rem;
    }

    .ux-progress-circle--xs .ux-progress-circle__label {
      display: none;
    }

    .ux-progress-circle--sm {
      --ux-progress-circle-size: 80px;
      --ux-progress-circle-stroke: 6px;
    }

    .ux-progress-circle--sm .ux-progress-circle__value {
      font-size: 1.25rem;
    }

    .ux-progress-circle--sm .ux-progress-circle__label {
      font-size: 0.6875rem;
    }

    .ux-progress-circle--lg {
      --ux-progress-circle-size: 160px;
      --ux-progress-circle-stroke: 10px;
    }

    .ux-progress-circle--lg .ux-progress-circle__value {
      font-size: 2.5rem;
    }

    .ux-progress-circle--lg .ux-progress-circle__label {
      font-size: 0.875rem;
    }

    .ux-progress-circle--xl {
      --ux-progress-circle-size: 200px;
      --ux-progress-circle-stroke: 12px;
    }

    .ux-progress-circle--xl .ux-progress-circle__value {
      font-size: 3rem;
    }

    .ux-progress-circle--xl .ux-progress-circle__label {
      font-size: 1rem;
    }

    /* ==========================================================================
       Stroke Variants
       ========================================================================== */

    .ux-progress-circle--thin {
      --ux-progress-circle-stroke: 4px;
    }

    .ux-progress-circle--thick {
      --ux-progress-circle-stroke: 12px;
    }

    /* ==========================================================================
       Color Variants
       ========================================================================== */

    .ux-progress-circle--primary {
      --ux-progress-circle-color: var(--ux-primary);
    }

    .ux-progress-circle--success {
      --ux-progress-circle-color: var(--ux-success);
    }

    .ux-progress-circle--warning {
      --ux-progress-circle-color: var(--ux-warning);
    }

    .ux-progress-circle--danger {
      --ux-progress-circle-color: var(--ux-danger);
    }

    .ux-progress-circle--gradient .ux-progress-circle__fill {
      stroke: url(#progress-gradient);
    }

    /* ==========================================================================
       Indeterminate (Spinner)
       ========================================================================== */

    .ux-progress-circle--indeterminate .ux-progress-circle__svg {
      animation: ux-progress-circle-rotate 1.5s linear infinite;
    }

    .ux-progress-circle--indeterminate .ux-progress-circle__fill {
      stroke-dasharray: 80, 200;
      stroke-dashoffset: 0;
      animation: ux-progress-circle-dash 1.5s ease-in-out infinite;
    }

    @keyframes ux-progress-circle-rotate {
      100% {
        transform: rotate(270deg);
      }
    }

    @keyframes ux-progress-circle-dash {
      0% {
        stroke-dasharray: 1, 200;
        stroke-dashoffset: 0;
      }
      50% {
        stroke-dasharray: 89, 200;
        stroke-dashoffset: -35;
      }
      100% {
        stroke-dasharray: 89, 200;
        stroke-dashoffset: -124;
      }
    }

    /* ==========================================================================
       Semi Circle
       ========================================================================== */

    .ux-progress-circle--semi .ux-progress-circle__svg {
      transform: rotate(-90deg);
    }

    .ux-progress-circle--semi {
      height: calc(var(--ux-progress-circle-size) / 2 + var(--ux-progress-circle-stroke));
      overflow: hidden;
    }

    .ux-progress-circle--semi .ux-progress-circle__content {
      top: auto;
      bottom: var(--ux-progress-circle-stroke);
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-progress-circle--glass .ux-progress-circle__bg {
      stroke: rgba(255, 255, 255, 0.2);
    }

    .ux-progress-circle--glass .ux-progress-circle__value,
    .ux-progress-circle--glass .ux-progress-circle__label {
      color: white;
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root {
        --ux-progress-circle-bg: var(--ux-gray-700);
      }
    }

    .ux-dark {
      --ux-progress-circle-bg: var(--ux-gray-700);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-progress-circle__fill {
        transition: none;
      }

      .ux-progress-circle--animated .ux-progress-circle__fill {
        animation: none;
      }

      .ux-progress-circle--indeterminate .ux-progress-circle__svg,
      .ux-progress-circle--indeterminate .ux-progress-circle__fill {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-progress-circle-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-progress-circle-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const progressCircleData = (options = {}) => ({
    // Configuration
    value: options.value ?? 0,
    max: options.max ?? 100,
    size: options.size || 120,
    strokeWidth: options.strokeWidth || 8,
    showValue: options.showValue ?? true,
    showLabel: options.showLabel ?? false,
    label: options.label || '',
    format: options.format || 'percent', // 'percent', 'value', 'custom'
    customFormat: options.customFormat || null,
    animated: options.animated ?? true,
    animateOnVisible: options.animateOnVisible ?? true,
    thresholds: options.thresholds || null, // { warning: 50, danger: 80 }

    // State
    isVisible: false,
    hasAnimated: false,

    // Computed
    get percentage() {
      return Math.min(100, Math.max(0, (this.value / this.max) * 100));
    },

    get radius() {
      return (this.size - this.strokeWidth) / 2;
    },

    get circumference() {
      return 2 * Math.PI * this.radius;
    },

    get dashOffset() {
      return this.circumference - (this.percentage / 100) * this.circumference;
    },

    get displayValue() {
      if (this.customFormat) {
        return this.customFormat(this.value, this.max, this.percentage);
      }

      switch (this.format) {
        case 'percent':
          return Math.round(this.percentage) + '%';
        case 'value':
          return this.value;
        case 'fraction':
          return `${this.value}/${this.max}`;
        default:
          return Math.round(this.percentage) + '%';
      }
    },

    get colorClass() {
      if (!this.thresholds) return '';

      if (this.thresholds.danger && this.percentage >= this.thresholds.danger) {
        return 'ux-progress-circle--danger';
      }
      if (this.thresholds.warning && this.percentage >= this.thresholds.warning) {
        return 'ux-progress-circle--warning';
      }
      if (this.thresholds.success && this.percentage >= this.thresholds.success) {
        return 'ux-progress-circle--success';
      }
      return '';
    },

    // Lifecycle
    init() {
      if (this.animateOnVisible) {
        this.setupIntersectionObserver();
      } else {
        this.isVisible = true;
        this.hasAnimated = true;
      }
    },

    setupIntersectionObserver() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && !this.hasAnimated) {
            this.isVisible = true;
            this.hasAnimated = true;
            observer.disconnect();
          }
        });
      }, { threshold: 0.5 });

      observer.observe(this.$el);
    },

    // Methods
    setValue(newValue) {
      this.value = Math.min(this.max, Math.max(0, newValue));
      this.$dispatch('progress-circle:change', {
        value: this.value,
        percentage: this.percentage
      });
    },

    increment(amount = 1) {
      this.setValue(this.value + amount);
    },

    decrement(amount = 1) {
      this.setValue(this.value - amount);
    },

    reset() {
      this.value = 0;
      this.$dispatch('progress-circle:reset');
    },

    complete() {
      this.setValue(this.max);
      this.$dispatch('progress-circle:complete');
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxProgressCircle', progressCircleData);
  }
})();

/**
 * UX Progress Steps Component
 * Step indicator for multi-step processes
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Progress Steps
    ======================================== */

    :root {
      --ux-progress-steps-gap: var(--ux-space-md);
      --ux-progress-steps-indicator-size: 32px;
      --ux-progress-steps-line-height: 2px;
    }

    .ux-progress-steps {
      display: flex;
      font-family: var(--ux-font-family);
    }

    /* ========================================
       Horizontal Layout (Default)
    ======================================== */

    .ux-progress-steps--horizontal {
      flex-direction: row;
      align-items: flex-start;
    }

    .ux-progress-steps--horizontal .ux-progress-steps__step {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    .ux-progress-steps--horizontal .ux-progress-steps__step:not(:last-child)::after {
      content: '';
      position: absolute;
      top: calc(var(--ux-progress-steps-indicator-size) / 2);
      left: calc(50% + var(--ux-progress-steps-indicator-size) / 2 + var(--ux-space-xs));
      right: calc(-50% + var(--ux-progress-steps-indicator-size) / 2 + var(--ux-space-xs));
      height: var(--ux-progress-steps-line-height);
      background: var(--ux-border-color);
      transform: translateY(-50%);
    }

    .ux-progress-steps--horizontal .ux-progress-steps__step--completed::after {
      background: var(--ux-primary);
    }

    /* ========================================
       Vertical Layout
    ======================================== */

    .ux-progress-steps--vertical {
      flex-direction: column;
    }

    .ux-progress-steps--vertical .ux-progress-steps__step {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      position: relative;
      padding-bottom: var(--ux-space-lg);
    }

    .ux-progress-steps--vertical .ux-progress-steps__step:last-child {
      padding-bottom: 0;
    }

    .ux-progress-steps--vertical .ux-progress-steps__step:not(:last-child)::after {
      content: '';
      position: absolute;
      top: calc(var(--ux-progress-steps-indicator-size) + var(--ux-space-xs));
      left: calc(var(--ux-progress-steps-indicator-size) / 2);
      bottom: var(--ux-space-xs);
      width: var(--ux-progress-steps-line-height);
      background: var(--ux-border-color);
      transform: translateX(-50%);
    }

    .ux-progress-steps--vertical .ux-progress-steps__step--completed::after {
      background: var(--ux-primary);
    }

    .ux-progress-steps--vertical .ux-progress-steps__content {
      margin-left: var(--ux-space-md);
      text-align: left;
      padding-top: 4px;
    }

    /* ========================================
       Step Indicator
    ======================================== */

    .ux-progress-steps__indicator {
      width: var(--ux-progress-steps-indicator-size);
      height: var(--ux-progress-steps-indicator-size);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      background: var(--ux-surface);
      border: 2px solid var(--ux-border-color);
      color: var(--ux-text-secondary);
      flex-shrink: 0;
      position: relative;
      z-index: 1;
      transition: all var(--ux-transition-fast);
    }

    .ux-progress-steps__indicator svg {
      width: 16px;
      height: 16px;
    }

    /* Active state */
    .ux-progress-steps__step--active .ux-progress-steps__indicator {
      border-color: var(--ux-primary);
      background: var(--ux-primary);
      color: white;
    }

    /* Completed state */
    .ux-progress-steps__step--completed .ux-progress-steps__indicator {
      border-color: var(--ux-primary);
      background: var(--ux-primary);
      color: white;
    }

    /* Error state */
    .ux-progress-steps__step--error .ux-progress-steps__indicator {
      border-color: var(--ux-danger);
      background: var(--ux-danger);
      color: white;
    }

    /* ========================================
       Step Content
    ======================================== */

    .ux-progress-steps__content {
      margin-top: var(--ux-space-sm);
      text-align: center;
    }

    .ux-progress-steps__title {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
      margin: 0;
      transition: color var(--ux-transition-fast);
    }

    .ux-progress-steps__step--active .ux-progress-steps__title,
    .ux-progress-steps__step--completed .ux-progress-steps__title {
      color: var(--ux-text);
    }

    .ux-progress-steps__description {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      margin: 2px 0 0;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-progress-steps--sm {
      --ux-progress-steps-indicator-size: 24px;
      --ux-progress-steps-line-height: 2px;
    }

    .ux-progress-steps--sm .ux-progress-steps__indicator {
      font-size: var(--ux-font-size-xs);
    }

    .ux-progress-steps--sm .ux-progress-steps__indicator svg {
      width: 12px;
      height: 12px;
    }

    .ux-progress-steps--lg {
      --ux-progress-steps-indicator-size: 40px;
      --ux-progress-steps-line-height: 3px;
    }

    .ux-progress-steps--lg .ux-progress-steps__indicator {
      font-size: var(--ux-font-size-md);
    }

    .ux-progress-steps--lg .ux-progress-steps__indicator svg {
      width: 20px;
      height: 20px;
    }

    .ux-progress-steps--lg .ux-progress-steps__title {
      font-size: var(--ux-font-size-md);
    }

    /* ========================================
       Variants
    ======================================== */

    /* Dots only (no numbers) */
    .ux-progress-steps--dots .ux-progress-steps__indicator {
      width: 12px;
      height: 12px;
    }

    .ux-progress-steps--dots .ux-progress-steps__indicator span {
      display: none;
    }

    .ux-progress-steps--dots.ux-progress-steps--horizontal .ux-progress-steps__step:not(:last-child)::after {
      top: 6px;
      left: calc(50% + 6px + var(--ux-space-xs));
      right: calc(-50% + 6px + var(--ux-space-xs));
    }

    /* Outline variant */
    .ux-progress-steps--outline .ux-progress-steps__step--active .ux-progress-steps__indicator {
      background: transparent;
      color: var(--ux-primary);
    }

    .ux-progress-steps--outline .ux-progress-steps__step--completed .ux-progress-steps__indicator {
      background: transparent;
      color: var(--ux-primary);
    }

    /* ========================================
       Clickable Steps
    ======================================== */

    .ux-progress-steps--clickable .ux-progress-steps__step {
      cursor: pointer;
    }

    .ux-progress-steps--clickable .ux-progress-steps__indicator:hover {
      transform: scale(1.1);
    }

    .ux-progress-steps--clickable .ux-progress-steps__step--disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .ux-progress-steps--clickable .ux-progress-steps__step--disabled .ux-progress-steps__indicator:hover {
      transform: none;
    }

    /* ========================================
       Progress Bar Variant
    ======================================== */

    .ux-progress-steps--bar {
      position: relative;
      padding: 0;
    }

    .ux-progress-steps--bar::before {
      content: '';
      position: absolute;
      top: calc(var(--ux-progress-steps-indicator-size) / 2);
      left: calc(var(--ux-progress-steps-indicator-size) / 2);
      right: calc(var(--ux-progress-steps-indicator-size) / 2);
      height: var(--ux-progress-steps-line-height);
      background: var(--ux-border-color);
      transform: translateY(-50%);
      z-index: 0;
    }

    .ux-progress-steps--bar .ux-progress-steps__progress {
      position: absolute;
      top: calc(var(--ux-progress-steps-indicator-size) / 2);
      left: calc(var(--ux-progress-steps-indicator-size) / 2);
      height: var(--ux-progress-steps-line-height);
      background: var(--ux-primary);
      transform: translateY(-50%);
      z-index: 0;
      transition: width var(--ux-transition-normal);
    }

    .ux-progress-steps--bar .ux-progress-steps__step:not(:last-child)::after {
      display: none;
    }

    /* ========================================
       Navigation Variant
    ======================================== */

    .ux-progress-steps--nav {
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-lg);
      padding: var(--ux-space-xs);
    }

    .ux-progress-steps--nav .ux-progress-steps__step {
      flex: 1;
      padding: var(--ux-space-sm) var(--ux-space-md);
      border-radius: var(--ux-radius-md);
      transition: background var(--ux-transition-fast);
    }

    .ux-progress-steps--nav .ux-progress-steps__step:not(:last-child)::after {
      display: none;
    }

    .ux-progress-steps--nav .ux-progress-steps__step--active {
      background: var(--ux-surface);
      box-shadow: var(--ux-shadow-sm);
    }

    .ux-progress-steps--nav .ux-progress-steps__indicator {
      display: none;
    }

    .ux-progress-steps--nav .ux-progress-steps__content {
      margin-top: 0;
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-progress-steps--responsive {
        flex-direction: column;
      }

      .ux-progress-steps--responsive.ux-progress-steps--horizontal .ux-progress-steps__step {
        flex-direction: row;
        align-items: flex-start;
        padding-bottom: var(--ux-space-md);
      }

      .ux-progress-steps--responsive.ux-progress-steps--horizontal .ux-progress-steps__step:not(:last-child)::after {
        top: calc(var(--ux-progress-steps-indicator-size) + var(--ux-space-xs));
        left: calc(var(--ux-progress-steps-indicator-size) / 2);
        right: auto;
        bottom: 0;
        width: var(--ux-progress-steps-line-height);
        height: auto;
        transform: translateX(-50%);
      }

      .ux-progress-steps--responsive .ux-progress-steps__content {
        margin-top: 0;
        margin-left: var(--ux-space-md);
        text-align: left;
        padding-top: 4px;
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-progress-steps--nav {
        background: var(--ux-surface-secondary);
      }

      .ux-progress-steps--nav .ux-progress-steps__step--active {
        background: var(--ux-surface-tertiary);
      }
    }

    .ux-dark .ux-progress-steps--nav {
      background: var(--ux-surface-secondary);
    }

    .ux-dark .ux-progress-steps--nav .ux-progress-steps__step--active {
      background: var(--ux-surface-tertiary);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-progress-steps__indicator,
      .ux-progress-steps--bar .ux-progress-steps__progress {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-progress-steps-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-progress-steps-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const progressStepsData = (options = {}) => ({
    currentStep: options.currentStep ?? 0,
    totalSteps: options.totalSteps ?? 0,
    clickable: options.clickable ?? false,
    allowSkip: options.allowSkip ?? false,

    get progress() {
      if (this.totalSteps <= 1) return 0;
      return (this.currentStep / (this.totalSteps - 1)) * 100;
    },

    init() {
      // Auto-detect steps if not provided
      if (this.totalSteps === 0) {
        const steps = this.$el.querySelectorAll('.ux-progress-steps__step');
        this.totalSteps = steps.length;
      }
    },

    isActive(index) {
      return index === this.currentStep;
    },

    isCompleted(index) {
      return index < this.currentStep;
    },

    isDisabled(index) {
      if (this.allowSkip) return false;
      return index > this.currentStep;
    },

    goToStep(index) {
      if (!this.clickable) return;
      if (!this.allowSkip && index > this.currentStep) return;

      this.currentStep = index;
      this.$dispatch('progresssteps:change', { step: index });
    },

    next() {
      if (this.currentStep < this.totalSteps - 1) {
        this.currentStep++;
        this.$dispatch('progresssteps:change', { step: this.currentStep });
        this.$dispatch('progresssteps:next', { step: this.currentStep });
      }
    },

    prev() {
      if (this.currentStep > 0) {
        this.currentStep--;
        this.$dispatch('progresssteps:change', { step: this.currentStep });
        this.$dispatch('progresssteps:prev', { step: this.currentStep });
      }
    },

    reset() {
      this.currentStep = 0;
      this.$dispatch('progresssteps:reset');
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxProgressSteps', progressStepsData);
  }

})();

/**
 * UX Progress Component
 * Barras de progreso y indicadores
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Progress Bar
    ======================================== */

    .ux-progress {
      width: 100%;
      height: var(--ux-progress-height);
      background-color: var(--ux-light);
      border-radius: var(--ux-progress-border-radius);
      overflow: hidden;
    }

    .ux-progress__bar {
      height: 100%;
      /* Uses composition system: combine with .ux-color-* classes */
      background-color: var(--ux-variant-bg, var(--ux-primary));
      border-radius: var(--ux-progress-border-radius);
      transition: width var(--ux-transition-base) var(--ux-ease);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-progress--sm {
      height: 2px;
    }

    .ux-progress--md {
      height: 8px;
      border-radius: 4px;
    }

    .ux-progress--md .ux-progress__bar {
      border-radius: 4px;
    }

    .ux-progress--lg {
      height: 12px;
      border-radius: 6px;
    }

    .ux-progress--lg .ux-progress__bar {
      border-radius: 6px;
    }

    /* ========================================
       Indeterminate Animation
    ======================================== */

    .ux-progress--indeterminate .ux-progress__bar {
      width: 30% !important;
      animation: ux-progress-indeterminate 1.5s ease-in-out infinite;
    }

    @keyframes ux-progress-indeterminate {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(400%);
      }
    }

    /* ========================================
       Striped Animation
    ======================================== */

    .ux-progress--striped .ux-progress__bar {
      background-image: linear-gradient(
        45deg,
        rgba(255, 255, 255, 0.15) 25%,
        transparent 25%,
        transparent 50%,
        rgba(255, 255, 255, 0.15) 50%,
        rgba(255, 255, 255, 0.15) 75%,
        transparent 75%,
        transparent
      );
      background-size: 1rem 1rem;
    }

    .ux-progress--animated .ux-progress__bar {
      animation: ux-progress-striped 1s linear infinite;
    }

    @keyframes ux-progress-striped {
      0% {
        background-position: 1rem 0;
      }
      100% {
        background-position: 0 0;
      }
    }

    /* ========================================
       With Label
    ======================================== */

    .ux-progress-container {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
    }

    .ux-progress-container__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .ux-progress-container__label {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-progress-container__value {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* ========================================
       Buffer (for video players)
    ======================================== */

    .ux-progress--buffer {
      position: relative;
    }

    .ux-progress--buffer .ux-progress__buffer {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background-color: rgba(var(--ux-primary-rgb), 0.3);
      border-radius: 2px;
    }

    .ux-progress--buffer .ux-progress__bar {
      position: relative;
      z-index: 1;
    }

    /* ========================================
       Circular Progress
    ======================================== */

    .ux-progress-circular {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .ux-progress-circular svg {
      transform: rotate(-90deg);
    }

    .ux-progress-circular__track {
      fill: none;
      stroke: var(--ux-light);
    }

    .ux-progress-circular__bar {
      fill: none;
      /* Uses composition system: combine with .ux-color-* classes */
      stroke: var(--ux-variant-bg, var(--ux-primary));
      stroke-linecap: round;
      transition: stroke-dashoffset var(--ux-transition-slow) var(--ux-ease);
    }

    .ux-progress-circular__value {
      position: absolute;
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
    }

    /* Circular Sizes */
    .ux-progress-circular--sm {
      width: 32px;
      height: 32px;
    }

    .ux-progress-circular--sm .ux-progress-circular__value {
      font-size: var(--ux-font-size-xs);
    }

    .ux-progress-circular--md {
      width: 48px;
      height: 48px;
    }

    .ux-progress-circular--lg {
      width: 64px;
      height: 64px;
    }

    .ux-progress-circular--lg .ux-progress-circular__value {
      font-size: var(--ux-font-size-md);
    }

    .ux-progress-circular--xl {
      width: 96px;
      height: 96px;
    }

    .ux-progress-circular--xl .ux-progress-circular__value {
      font-size: var(--ux-font-size-xl);
    }

    /* Circular Indeterminate */
    .ux-progress-circular--indeterminate svg {
      animation: ux-progress-circular-rotate 2s linear infinite;
    }

    .ux-progress-circular--indeterminate .ux-progress-circular__bar {
      animation: ux-progress-circular-dash 1.5s ease-in-out infinite;
      stroke-dasharray: 90, 150;
      stroke-dashoffset: 0;
    }

    @keyframes ux-progress-circular-rotate {
      100% {
        transform: rotate(270deg);
      }
    }

    @keyframes ux-progress-circular-dash {
      0% {
        stroke-dasharray: 1, 200;
        stroke-dashoffset: 0;
      }
      50% {
        stroke-dasharray: 90, 150;
        stroke-dashoffset: -40;
      }
      100% {
        stroke-dasharray: 90, 150;
        stroke-dashoffset: -120;
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .ux-progress--indeterminate .ux-progress__bar {
        animation: none;
        width: 100% !important;
        opacity: 0.5;
      }

      .ux-progress--animated .ux-progress__bar {
        animation: none;
      }

      .ux-progress-circular--indeterminate svg {
        animation: none;
      }

      .ux-progress-circular--indeterminate .ux-progress-circular__bar {
        animation: none;
        stroke-dasharray: 90, 150;
      }
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-progress--glass .ux-progress__track {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-progress-circular--glass .ux-progress-circular__track {
      stroke: var(--ux-glass-border);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-progress-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-progress-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for progress
  // ARIA: role="progressbar", aria-valuenow, aria-valuemin, aria-valuemax
  const progressComponent = (config = {}) => ({
    value: config.value || 0,
    max: config.max || 100,
    min: config.min || 0,
    buffer: config.buffer || 0,
    indeterminate: config.indeterminate || false,
    ariaLabel: config.ariaLabel || 'Progress',

    // ARIA attributes for the progress bar
    get ariaAttrs() {
      const attrs = {
        'role': 'progressbar',
        'aria-label': this.ariaLabel,
        'aria-valuemin': this.min,
        'aria-valuemax': this.max
      };

      // Only set aria-valuenow for determinate progress
      if (!this.indeterminate) {
        attrs['aria-valuenow'] = this.value;
        attrs['aria-valuetext'] = `${Math.round(this.percent)}%`;
      }

      return attrs;
    },

    get percent() {
      return Math.min(100, Math.max(0, (this.value / this.max) * 100));
    },

    get bufferPercent() {
      return Math.min(100, Math.max(0, (this.buffer / this.max) * 100));
    },

    set(value) {
      this.value = Math.min(this.max, Math.max(this.min, value));
    },

    increment(amount = 1) {
      this.set(this.value + amount);
    },

    decrement(amount = 1) {
      this.set(this.value - amount);
    },

    reset() {
      this.value = this.min;
    },

    complete() {
      this.value = this.max;
      // Announce completion to screen readers
      if (window.UX && window.UX.announce) {
        window.UX.announce('Progress complete', 'polite');
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxProgress', progressComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxProgress', progressComponent);
    });
  }
})();

/**
 * UX PWA - Progressive Web App Support
 * Service Worker registration, offline detection, and install prompts
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX PWA Styles
    ======================================== */

    /* Online/Offline Indicator */
    .ux-pwa-status {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: var(--ux-z-toast);
      padding: var(--ux-space-sm) var(--ux-space-md);
      text-align: center;
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      transform: translateY(-100%);
      transition: transform 0.3s ease;
    }

    .ux-pwa-status--visible {
      transform: translateY(0);
    }

    .ux-pwa-status--offline {
      background-color: var(--ux-danger);
      color: white;
    }

    .ux-pwa-status--online {
      background-color: var(--ux-success);
      color: white;
    }

    /* Install Banner */
    .ux-pwa-install {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: var(--ux-z-modal);
      background: var(--ux-surface);
      border-top: 1px solid var(--ux-border-color);
      padding: var(--ux-space-lg);
      padding-bottom: calc(var(--ux-space-lg) + env(safe-area-inset-bottom));
      box-shadow: var(--ux-shadow-lg);
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }

    .ux-pwa-install--visible {
      transform: translateY(0);
    }

    .ux-pwa-install__content {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      max-width: 600px;
      margin: 0 auto;
    }

    .ux-pwa-install__icon {
      width: 48px;
      height: 48px;
      border-radius: var(--ux-border-radius);
      flex-shrink: 0;
      object-fit: contain;
    }

    .ux-pwa-install__text {
      flex: 1;
      min-width: 0;
    }

    .ux-pwa-install__title {
      font-weight: 600;
      font-size: var(--ux-font-size-base);
      color: var(--ux-text);
      margin-bottom: 2px;
    }

    .ux-pwa-install__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-pwa-install__actions {
      display: flex;
      gap: var(--ux-space-sm);
      flex-shrink: 0;
    }

    /* Update Available Banner */
    .ux-pwa-update {
      position: fixed;
      bottom: var(--ux-space-lg);
      left: var(--ux-space-lg);
      right: var(--ux-space-lg);
      z-index: var(--ux-z-modal);
      background: var(--ux-primary);
      color: white;
      border-radius: var(--ux-border-radius-lg);
      padding: var(--ux-space-md) var(--ux-space-lg);
      box-shadow: var(--ux-shadow-lg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      transform: translateY(calc(100% + var(--ux-space-xl)));
      transition: transform 0.3s ease;
    }

    .ux-pwa-update--visible {
      transform: translateY(0);
    }

    .ux-pwa-update__text {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
    }

    .ux-pwa-update__btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: var(--ux-space-xs) var(--ux-space-md);
      border-radius: var(--ux-border-radius);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .ux-pwa-update__btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Offline Overlay */
    .ux-pwa-offline-overlay {
      position: fixed;
      inset: 0;
      z-index: var(--ux-z-modal);
      background: var(--ux-surface);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-xl);
      text-align: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .ux-pwa-offline-overlay--visible {
      opacity: 1;
      visibility: visible;
    }

    .ux-pwa-offline-overlay__icon {
      width: 80px;
      height: 80px;
      margin-bottom: var(--ux-space-lg);
      color: var(--ux-text-secondary);
    }

    .ux-pwa-offline-overlay__title {
      font-size: var(--ux-font-size-xl);
      font-weight: 600;
      color: var(--ux-text);
      margin-bottom: var(--ux-space-sm);
    }

    .ux-pwa-offline-overlay__subtitle {
      font-size: var(--ux-font-size-base);
      color: var(--ux-text-secondary);
      max-width: 300px;
    }

    /* Cached indicator badge */
    .ux-pwa-cached {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: var(--ux-success-soft);
      color: var(--ux-success);
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
      border-radius: var(--ux-border-radius);
    }

    .ux-pwa-cached__icon {
      width: 14px;
      height: 14px;
    }

    /* iOS Safari specific styles */
    @supports (-webkit-touch-callout: none) {
      .ux-pwa-install__subtitle--ios::after {
        content: ' Tap Share then "Add to Home Screen"';
      }
    }

    /* Safe area support */
    @supports (padding: env(safe-area-inset-bottom)) {
      .ux-pwa-status {
        padding-top: calc(var(--ux-space-sm) + env(safe-area-inset-top));
      }
    }

    /* Dark mode adjustments */
    .ux-dark .ux-pwa-install {
      background: var(--ux-surface);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles(styles, 'ux-pwa');
  } else {
    const styleEl = document.createElement('style');
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // PWA Manager Alpine component
  const pwaComponent = (config = {}) => ({
    // State
    isOnline: navigator.onLine,
    isInstallable: false,
    isStandalone: false,
    hasUpdate: false,
    showInstallBanner: false,
    showOfflineStatus: false,
    showOnlineStatus: false,
    showUpdateBanner: false,
    showOfflineOverlay: false,

    // Config
    serviceWorkerPath: config.serviceWorkerPath || '/sw.js',
    appName: config.appName || document.title,
    appIcon: config.appIcon || '/icon-192.png',
    offlineStatusDuration: config.offlineStatusDuration ?? 3000,
    onlineStatusDuration: config.onlineStatusDuration ?? 2000,
    autoShowInstall: config.autoShowInstall ?? true,
    installDelay: config.installDelay ?? 30000, // 30 seconds

    // Internal
    deferredPrompt: null,
    registration: null,
    statusTimeout: null,

    init() {
      // Check if running as installed PWA
      this.isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
                          window.navigator.standalone === true;

      // Online/Offline events
      window.addEventListener('online', () => this.handleOnline());
      window.addEventListener('offline', () => this.handleOffline());

      // Install prompt event
      window.addEventListener('beforeinstallprompt', (e) => this.handleInstallPrompt(e));

      // App installed event
      window.addEventListener('appinstalled', () => this.handleAppInstalled());

      // Register service worker
      if (config.registerServiceWorker !== false) {
        this.registerServiceWorker();
      }

      // Auto-show install banner after delay
      if (this.autoShowInstall && !this.isStandalone) {
        setTimeout(() => {
          if (this.isInstallable && !this.isStandalone) {
            this.showInstallBanner = true;
          }
        }, this.installDelay);
      }
    },

    async registerServiceWorker() {
      if ('serviceWorker' in navigator) {
        try {
          this.registration = await navigator.serviceWorker.register(this.serviceWorkerPath);

          // Check for updates
          this.registration.addEventListener('updatefound', () => {
            const newWorker = this.registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                this.hasUpdate = true;
                this.showUpdateBanner = true;
              }
            });
          });

          // Listen for controller change (after update)
          navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (config.reloadOnUpdate !== false) {
              window.location.reload();
            }
          });

          console.log('Service Worker registered:', this.registration.scope);
        } catch (error) {
          console.error('Service Worker registration failed:', error);
        }
      }
    },

    handleOnline() {
      this.isOnline = true;
      this.showOfflineOverlay = false;
      this.showOnlineStatus = true;

      clearTimeout(this.statusTimeout);
      this.statusTimeout = setTimeout(() => {
        this.showOnlineStatus = false;
      }, this.onlineStatusDuration);

      this.$dispatch('ux-pwa-online');
    },

    handleOffline() {
      this.isOnline = false;
      this.showOfflineStatus = true;

      clearTimeout(this.statusTimeout);
      this.statusTimeout = setTimeout(() => {
        this.showOfflineStatus = false;
      }, this.offlineStatusDuration);

      this.$dispatch('ux-pwa-offline');
    },

    handleInstallPrompt(e) {
      e.preventDefault();
      this.deferredPrompt = e;
      this.isInstallable = true;
      this.$dispatch('ux-pwa-installable');
    },

    handleAppInstalled() {
      this.isInstallable = false;
      this.isStandalone = true;
      this.showInstallBanner = false;
      this.deferredPrompt = null;
      this.$dispatch('ux-pwa-installed');
    },

    async promptInstall() {
      if (!this.deferredPrompt) return false;

      this.deferredPrompt.prompt();
      const { outcome } = await this.deferredPrompt.userChoice;

      if (outcome === 'accepted') {
        this.isInstallable = false;
        this.showInstallBanner = false;
      }

      this.deferredPrompt = null;
      return outcome === 'accepted';
    },

    dismissInstall() {
      this.showInstallBanner = false;
      this.$dispatch('ux-pwa-install-dismissed');
    },

    async applyUpdate() {
      if (this.registration && this.registration.waiting) {
        this.registration.waiting.postMessage({ type: 'SKIP_WAITING' });
      }
      this.showUpdateBanner = false;
    },

    dismissUpdate() {
      this.showUpdateBanner = false;
    },

    // Check if a specific resource is cached
    async isCached(url) {
      if ('caches' in window) {
        const cache = await caches.open('v1');
        const response = await cache.match(url);
        return !!response;
      }
      return false;
    },

    // Clear all caches
    async clearCache() {
      if ('caches' in window) {
        const names = await caches.keys();
        await Promise.all(names.map(name => caches.delete(name)));
        return true;
      }
      return false;
    },

    // Get cache storage estimate
    async getCacheSize() {
      if ('storage' in navigator && 'estimate' in navigator.storage) {
        const estimate = await navigator.storage.estimate();
        return {
          usage: estimate.usage,
          quota: estimate.quota,
          usageFormatted: this.formatBytes(estimate.usage),
          quotaFormatted: this.formatBytes(estimate.quota),
          percentUsed: Math.round((estimate.usage / estimate.quota) * 100)
        };
      }
      return null;
    },

    formatBytes(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    },

    // Check if iOS
    get isIOS() {
      return /iPad|iPhone|iPod/.test(navigator.userAgent);
    },

    // Check if can install (not iOS Safari in standalone)
    get canInstall() {
      return this.isInstallable && !this.isStandalone;
    }
  });

  // Register Alpine component
  if (window.UX) {
    window.UX.registerComponent('uxPWA', pwaComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxPWA', pwaComponent);
    });
  }

  // Simple offline detection helper (no Alpine required)
  window.UXOffline = {
    isOnline: navigator.onLine,
    callbacks: { online: [], offline: [] },

    init() {
      window.addEventListener('online', () => {
        this.isOnline = true;
        this.callbacks.online.forEach(cb => cb());
      });
      window.addEventListener('offline', () => {
        this.isOnline = false;
        this.callbacks.offline.forEach(cb => cb());
      });
    },

    onOnline(callback) {
      this.callbacks.online.push(callback);
    },

    onOffline(callback) {
      this.callbacks.offline.push(callback);
    }
  };

  // Auto-init
  window.UXOffline.init();

})();

/**
 * UX QR Code Component
 * QR code generator using canvas with customizable options
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX QR Code - Base
    ======================================== */

    .ux-qr {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-sm);
      font-family: var(--ux-font-family);
    }

    .ux-qr__canvas {
      display: block;
      border-radius: var(--ux-radius-md);
    }

    .ux-qr__wrapper {
      position: relative;
      display: inline-block;
    }

    /* ========================================
       With Logo
    ======================================== */

    .ux-qr__logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 4px;
      border-radius: var(--ux-radius-sm);
    }

    .ux-qr__logo img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* ========================================
       With Label
    ======================================== */

    .ux-qr__label {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      text-align: center;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ========================================
       With Border
    ======================================== */

    .ux-qr--bordered .ux-qr__wrapper {
      padding: 1rem;
      background: white;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-qr--sm .ux-qr__canvas {
      width: 100px;
      height: 100px;
    }

    .ux-qr--lg .ux-qr__canvas {
      width: 250px;
      height: 250px;
    }

    .ux-qr--xl .ux-qr__canvas {
      width: 350px;
      height: 350px;
    }

    /* ========================================
       Actions
    ======================================== */

    .ux-qr__actions {
      display: flex;
      gap: var(--ux-space-sm);
      margin-top: var(--ux-space-xs);
    }

    .ux-qr__action {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.5rem 0.75rem;
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-primary);
      background: transparent;
      border: 1px solid var(--ux-primary);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-qr__action:hover {
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-qr__action svg {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Loading
    ======================================== */

    .ux-qr__loading {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--ux-gray-100);
      border-radius: var(--ux-radius-md);
    }

    .ux-qr__spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--ux-gray-200);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-qr-spin 0.8s linear infinite;
    }

    @keyframes ux-qr-spin {
      to { transform: rotate(360deg); }
    }

    /* ========================================
       Error
    ======================================== */

    .ux-qr__error {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      background: rgba(var(--ux-danger-rgb), 0.1);
      border-radius: var(--ux-radius-md);
      text-align: center;
    }

    .ux-qr__error-icon {
      width: 24px;
      height: 24px;
      color: var(--ux-danger);
      margin-bottom: 0.5rem;
    }

    .ux-qr__error-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-danger);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-qr--bordered .ux-qr__wrapper {
        background: var(--ux-gray-800);
        border-color: var(--ux-border-color);
      }

      .ux-qr__loading {
        background: var(--ux-gray-800);
      }
    }

    .ux-dark .ux-qr--bordered .ux-qr__wrapper {
      background: var(--ux-gray-800);
      border-color: var(--ux-border-color);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-qr__spinner {
        animation: none;
      }

      .ux-qr__action {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-qr-code-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-qr-code-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // QR Code Generator (simplified Reed-Solomon implementation)
  // Based on standard QR code specification

  // Error correction levels
  const ECL = {
    L: 1, // 7% recovery
    M: 0, // 15% recovery
    Q: 3, // 25% recovery
    H: 2  // 30% recovery
  };

  // Alphanumeric character set
  const ALPHANUMERIC = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:';

  // Get the best mode for the data
  function getMode(data) {
    if (/^\d+$/.test(data)) return 'numeric';
    if (/^[0-9A-Z $%*+\-./:]+$/.test(data.toUpperCase())) return 'alphanumeric';
    return 'byte';
  }

  // QR Code matrix generation
  function generateQRMatrix(data, errorCorrectionLevel = 'M') {
    const ecl = ECL[errorCorrectionLevel] || ECL.M;

    // Simplified QR generation - use a basic encoding
    // For production, use a full QR library
    const size = Math.max(21, Math.ceil(Math.sqrt(data.length * 8)) + 10);
    const matrix = Array(size).fill(null).map(() => Array(size).fill(null));

    // Add finder patterns
    addFinderPattern(matrix, 0, 0);
    addFinderPattern(matrix, size - 7, 0);
    addFinderPattern(matrix, 0, size - 7);

    // Add timing patterns
    for (let i = 8; i < size - 8; i++) {
      matrix[6][i] = i % 2 === 0;
      matrix[i][6] = i % 2 === 0;
    }

    // Add alignment pattern for larger QR codes
    if (size >= 25) {
      const pos = size - 9;
      addAlignmentPattern(matrix, pos, pos);
    }

    // Encode data
    const bits = encodeData(data);
    let bitIndex = 0;

    // Fill data
    let direction = -1;
    let x = size - 1;

    while (x > 0) {
      if (x === 6) x--;

      for (let y = direction === -1 ? size - 1 : 0;
           direction === -1 ? y >= 0 : y < size;
           y += direction) {
        for (let dx = 0; dx <= 1; dx++) {
          const cx = x - dx;
          if (matrix[y][cx] === null) {
            const bit = bitIndex < bits.length ? bits[bitIndex] === '1' : false;
            matrix[y][cx] = bit;
            bitIndex++;
          }
        }
      }
      direction = -direction;
      x -= 2;
    }

    return matrix;
  }

  function addFinderPattern(matrix, row, col) {
    for (let r = 0; r < 7; r++) {
      for (let c = 0; c < 7; c++) {
        if (row + r < matrix.length && col + c < matrix.length) {
          const isOuter = r === 0 || r === 6 || c === 0 || c === 6;
          const isInner = r >= 2 && r <= 4 && c >= 2 && c <= 4;
          matrix[row + r][col + c] = isOuter || isInner;
        }
      }
    }

    // Separator
    for (let i = 0; i < 8; i++) {
      if (row + 7 < matrix.length && col + i < matrix.length) matrix[row + 7][col + i] = false;
      if (row + i < matrix.length && col + 7 < matrix.length) matrix[row + i][col + 7] = false;
    }
  }

  function addAlignmentPattern(matrix, row, col) {
    for (let r = -2; r <= 2; r++) {
      for (let c = -2; c <= 2; c++) {
        const isOuter = Math.abs(r) === 2 || Math.abs(c) === 2;
        const isCenter = r === 0 && c === 0;
        matrix[row + r][col + c] = isOuter || isCenter;
      }
    }
  }

  function encodeData(data) {
    let bits = '';

    // Mode indicator (byte mode = 0100)
    bits += '0100';

    // Character count (8 bits for byte mode)
    bits += data.length.toString(2).padStart(8, '0');

    // Data
    for (let i = 0; i < data.length; i++) {
      bits += data.charCodeAt(i).toString(2).padStart(8, '0');
    }

    // Terminator
    bits += '0000';

    // Pad to multiple of 8
    while (bits.length % 8 !== 0) {
      bits += '0';
    }

    return bits;
  }

  // Icons
  const icons = {
    download: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',
    copy: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>',
    error: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>'
  };

  // Alpine.js component
  const qrCodeData = (options = {}) => ({
    // Data
    value: options.value || '',

    // Configuration
    size: options.size || 200,
    errorCorrection: options.errorCorrection || 'M', // L, M, Q, H
    foreground: options.foreground || '#000000',
    background: options.background || '#FFFFFF',
    margin: options.margin ?? 4,
    logo: options.logo || null,
    logoSize: options.logoSize || 0.2, // 20% of QR size
    label: options.label || null,

    // State
    loading: true,
    error: null,
    canvas: null,
    icons,

    init() {
      this.$nextTick(() => {
        this.canvas = this.$refs.canvas;
        this.generate();
      });
    },

    // Generate QR code
    generate() {
      if (!this.value) {
        this.loading = false;
        this.error = 'No data provided';
        return;
      }

      this.loading = true;
      this.error = null;

      try {
        const matrix = generateQRMatrix(this.value, this.errorCorrection);
        this.render(matrix);
        this.loading = false;
      } catch (e) {
        this.error = 'Failed to generate QR code';
        this.loading = false;
        console.error('QR Code error:', e);
      }
    },

    // Render QR code to canvas
    render(matrix) {
      if (!this.canvas) return;

      const ctx = this.canvas.getContext('2d');
      const moduleCount = matrix.length;
      const moduleSize = (this.size - this.margin * 2) / moduleCount;

      this.canvas.width = this.size;
      this.canvas.height = this.size;

      // Background
      ctx.fillStyle = this.background;
      ctx.fillRect(0, 0, this.size, this.size);

      // Modules
      ctx.fillStyle = this.foreground;

      for (let row = 0; row < moduleCount; row++) {
        for (let col = 0; col < moduleCount; col++) {
          if (matrix[row][col]) {
            const x = this.margin + col * moduleSize;
            const y = this.margin + row * moduleSize;
            ctx.fillRect(x, y, moduleSize, moduleSize);
          }
        }
      }

      // Add logo if provided
      if (this.logo) {
        this.addLogo();
      }

      this.$dispatch('qr:generated', { value: this.value });
    },

    // Add logo to center
    addLogo() {
      const img = new Image();
      img.crossOrigin = 'anonymous';

      img.onload = () => {
        const ctx = this.canvas.getContext('2d');
        const logoSizePx = this.size * this.logoSize;
        const x = (this.size - logoSizePx) / 2;
        const y = (this.size - logoSizePx) / 2;

        // White background for logo
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(x - 4, y - 4, logoSizePx + 8, logoSizePx + 8);

        // Draw logo
        ctx.drawImage(img, x, y, logoSizePx, logoSizePx);
      };

      img.src = this.logo;
    },

    // Set value and regenerate
    setValue(value) {
      this.value = value;
      this.generate();
    },

    // Download QR code
    download(filename = 'qrcode') {
      if (!this.canvas) return;

      const link = document.createElement('a');
      link.download = `${filename}.png`;
      link.href = this.canvas.toDataURL('image/png');
      link.click();

      this.$dispatch('qr:download', { filename });
    },

    // Copy to clipboard
    async copyToClipboard() {
      if (!this.canvas) return;

      try {
        const blob = await new Promise(resolve => {
          this.canvas.toBlob(resolve, 'image/png');
        });

        await navigator.clipboard.write([
          new ClipboardItem({ 'image/png': blob })
        ]);

        this.$dispatch('qr:copied');
        return true;
      } catch (e) {
        console.error('Failed to copy:', e);
        return false;
      }
    },

    // Get data URL
    getDataURL(type = 'image/png', quality = 1) {
      if (!this.canvas) return null;
      return this.canvas.toDataURL(type, quality);
    },

    // Get blob
    async getBlob(type = 'image/png', quality = 1) {
      if (!this.canvas) return null;

      return new Promise(resolve => {
        this.canvas.toBlob(resolve, type, quality);
      });
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxQRCode', qrCodeData);
  }

})();

/**
 * UX Quality Check Component
 * Quality check form for manufacturing with checklist items, measurements, photos, and signatures
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Quality Check - Base
    ======================================== */

    .ux-quality-check {
      display: flex;
      flex-direction: column;
      font-family: var(--ux-font-family);
      background: var(--ux-surface);
      border-radius: var(--ux-radius-lg);
      overflow: hidden;
    }

    /* ========================================
       Header
    ======================================== */

    .ux-quality-check__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-lg);
      border-bottom: 1px solid var(--ux-border-color);
      background: var(--ux-surface);
    }

    .ux-quality-check__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-quality-check__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    .ux-quality-check__status {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      border-radius: var(--ux-radius-full);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
    }

    .ux-quality-check__status--pending {
      background: rgba(var(--ux-warning-rgb), 0.15);
      color: var(--ux-warning-shade);
    }

    .ux-quality-check__status--pass {
      background: rgba(var(--ux-success-rgb), 0.15);
      color: var(--ux-success-shade);
    }

    .ux-quality-check__status--fail {
      background: rgba(var(--ux-danger-rgb), 0.15);
      color: var(--ux-danger-shade);
    }

    .ux-quality-check__status-icon {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Meta Info (Order, Timestamp, etc.)
    ======================================== */

    .ux-quality-check__meta {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-md) var(--ux-space-xl);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background: var(--ux-surface-secondary);
      font-size: var(--ux-font-size-sm);
    }

    .ux-quality-check__meta-item {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ux-quality-check__meta-label {
      color: var(--ux-text-tertiary);
      font-size: var(--ux-font-size-xs);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-quality-check__meta-value {
      color: var(--ux-text);
      font-weight: 500;
    }

    /* ========================================
       Body / Content
    ======================================== */

    .ux-quality-check__body {
      padding: var(--ux-space-lg);
    }

    .ux-quality-check__section {
      margin-bottom: var(--ux-space-xl);
    }

    .ux-quality-check__section:last-child {
      margin-bottom: 0;
    }

    .ux-quality-check__section-title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-md) 0;
      padding-bottom: var(--ux-space-sm);
      border-bottom: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Checklist Item
    ======================================== */

    .ux-quality-check__item {
      display: flex;
      flex-direction: column;
      padding: var(--ux-space-md);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      margin-bottom: var(--ux-space-sm);
      transition: border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-quality-check__item:last-child {
      margin-bottom: 0;
    }

    .ux-quality-check__item:hover {
      border-color: var(--ux-text-tertiary);
    }

    .ux-quality-check__item--pass {
      border-color: var(--ux-success);
      background: rgba(var(--ux-success-rgb), 0.02);
    }

    .ux-quality-check__item--fail {
      border-color: var(--ux-danger);
      background: rgba(var(--ux-danger-rgb), 0.02);
    }

    .ux-quality-check__item--na {
      border-color: var(--ux-border-color);
      background: var(--ux-surface-secondary);
      opacity: 0.7;
    }

    .ux-quality-check__item-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--ux-space-md);
    }

    .ux-quality-check__item-info {
      flex: 1;
      min-width: 0;
    }

    .ux-quality-check__item-name {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-quality-check__item-description {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    .ux-quality-check__item-required {
      color: var(--ux-danger);
      margin-left: 2px;
    }

    /* ========================================
       Pass/Fail/NA Selector
    ======================================== */

    .ux-quality-check__selector {
      display: flex;
      gap: var(--ux-space-xs);
      flex-shrink: 0;
    }

    .ux-quality-check__selector-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      background: var(--ux-surface);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-quality-check__selector-btn:hover {
      border-color: var(--ux-text-tertiary);
      color: var(--ux-text);
    }

    .ux-quality-check__selector-btn:active {
      transform: scale(0.95);
    }

    .ux-quality-check__selector-btn--pass.ux-quality-check__selector-btn--active {
      background: var(--ux-success);
      border-color: var(--ux-success);
      color: white;
    }

    .ux-quality-check__selector-btn--fail.ux-quality-check__selector-btn--active {
      background: var(--ux-danger);
      border-color: var(--ux-danger);
      color: white;
    }

    .ux-quality-check__selector-btn--na.ux-quality-check__selector-btn--active {
      background: var(--ux-medium);
      border-color: var(--ux-medium);
      color: white;
    }

    .ux-quality-check__selector-btn svg {
      width: 20px;
      height: 20px;
    }

    /* ========================================
       Measurement Input
    ======================================== */

    .ux-quality-check__measurement {
      margin-top: var(--ux-space-md);
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-quality-check__measurement-label {
      display: block;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-quality-check__measurement-row {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-quality-check__measurement-input {
      flex: 1;
      height: 40px;
      padding: 0 var(--ux-space-md);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      background: var(--ux-surface);
      font-size: var(--ux-font-size-md);
      font-family: var(--ux-font-mono, monospace);
      color: var(--ux-text);
      transition: border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-quality-check__measurement-input:focus {
      outline: none;
      border-color: var(--ux-primary);
    }

    .ux-quality-check__measurement-input--error {
      border-color: var(--ux-danger);
      background: rgba(var(--ux-danger-rgb), 0.02);
    }

    .ux-quality-check__measurement-input--success {
      border-color: var(--ux-success);
      background: rgba(var(--ux-success-rgb), 0.02);
    }

    .ux-quality-check__measurement-unit {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      min-width: 40px;
    }

    .ux-quality-check__tolerance {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-quality-check__tolerance-range {
      font-family: var(--ux-font-mono, monospace);
    }

    .ux-quality-check__tolerance--in-range {
      color: var(--ux-success);
    }

    .ux-quality-check__tolerance--out-of-range {
      color: var(--ux-danger);
    }

    /* ========================================
       Photo Attachment
    ======================================== */

    .ux-quality-check__photos {
      margin-top: var(--ux-space-md);
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-quality-check__photos-label {
      display: block;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-sm);
    }

    .ux-quality-check__photos-grid {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-sm);
    }

    .ux-quality-check__photo {
      position: relative;
      width: 72px;
      height: 72px;
      border-radius: var(--ux-radius-md);
      overflow: hidden;
      background: var(--ux-surface-secondary);
    }

    .ux-quality-check__photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .ux-quality-check__photo-remove {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      opacity: 0;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-quality-check__photo:hover .ux-quality-check__photo-remove {
      opacity: 1;
    }

    .ux-quality-check__photo-remove svg {
      width: 12px;
      height: 12px;
    }

    .ux-quality-check__photo-add {
      width: 72px;
      height: 72px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      border: 2px dashed var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      background: transparent;
      color: var(--ux-text-tertiary);
      cursor: pointer;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-quality-check__photo-add:hover {
      border-color: var(--ux-primary);
      color: var(--ux-primary);
    }

    .ux-quality-check__photo-add svg {
      width: 24px;
      height: 24px;
    }

    .ux-quality-check__photo-add span {
      font-size: var(--ux-font-size-xs);
    }

    .ux-quality-check__photo-input {
      display: none;
    }

    /* ========================================
       Notes / Comments
    ======================================== */

    .ux-quality-check__notes {
      margin-top: var(--ux-space-md);
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-quality-check__notes-label {
      display: block;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-quality-check__notes-input {
      width: 100%;
      min-height: 60px;
      padding: var(--ux-space-sm) var(--ux-space-md);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      background: var(--ux-surface);
      font-size: var(--ux-font-size-sm);
      font-family: var(--ux-font-family);
      color: var(--ux-text);
      resize: vertical;
      transition: border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-quality-check__notes-input:focus {
      outline: none;
      border-color: var(--ux-primary);
    }

    .ux-quality-check__notes-input::placeholder {
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Defect Category
    ======================================== */

    .ux-quality-check__defect {
      margin-top: var(--ux-space-md);
      padding-top: var(--ux-space-md);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-quality-check__defect-label {
      display: block;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-sm);
    }

    .ux-quality-check__defect-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
    }

    .ux-quality-check__defect-tag {
      display: inline-flex;
      align-items: center;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-full);
      background: var(--ux-surface);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-quality-check__defect-tag:hover {
      border-color: var(--ux-danger);
      color: var(--ux-danger);
    }

    .ux-quality-check__defect-tag--active {
      background: rgba(var(--ux-danger-rgb), 0.1);
      border-color: var(--ux-danger);
      color: var(--ux-danger);
    }

    /* ========================================
       Summary Section
    ======================================== */

    .ux-quality-check__summary {
      padding: var(--ux-space-lg);
      background: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-quality-check__summary-title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-md) 0;
    }

    .ux-quality-check__summary-stats {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-lg);
      margin-bottom: var(--ux-space-lg);
    }

    .ux-quality-check__summary-stat {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-quality-check__summary-stat-icon {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--ux-radius-md);
    }

    .ux-quality-check__summary-stat-icon--pass {
      background: rgba(var(--ux-success-rgb), 0.15);
      color: var(--ux-success);
    }

    .ux-quality-check__summary-stat-icon--fail {
      background: rgba(var(--ux-danger-rgb), 0.15);
      color: var(--ux-danger);
    }

    .ux-quality-check__summary-stat-icon--na {
      background: rgba(var(--ux-medium-rgb), 0.15);
      color: var(--ux-medium);
    }

    .ux-quality-check__summary-stat-icon--pending {
      background: rgba(var(--ux-warning-rgb), 0.15);
      color: var(--ux-warning);
    }

    .ux-quality-check__summary-stat-icon svg {
      width: 18px;
      height: 18px;
    }

    .ux-quality-check__summary-stat-value {
      font-size: var(--ux-font-size-xl);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-quality-check__summary-stat-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
    }

    .ux-quality-check__progress {
      height: 8px;
      background: var(--ux-border-color);
      border-radius: var(--ux-radius-full);
      overflow: hidden;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-quality-check__progress-bar {
      height: 100%;
      display: flex;
      transition: width var(--ux-transition-normal) var(--ux-ease);
    }

    .ux-quality-check__progress-pass {
      background: var(--ux-success);
    }

    .ux-quality-check__progress-fail {
      background: var(--ux-danger);
    }

    .ux-quality-check__progress-na {
      background: var(--ux-medium);
    }

    .ux-quality-check__progress-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      text-align: center;
    }

    /* ========================================
       Signature Section
    ======================================== */

    .ux-quality-check__signature {
      padding: var(--ux-space-lg);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-quality-check__signature-title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-md) 0;
    }

    .ux-quality-check__signature-row {
      display: flex;
      gap: var(--ux-space-lg);
    }

    @media (max-width: 767px) {
      .ux-quality-check__signature-row {
        flex-direction: column;
      }
    }

    .ux-quality-check__signature-field {
      flex: 1;
    }

    .ux-quality-check__signature-label {
      display: block;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-quality-check__signature-pad {
      height: 120px;
      border: 2px dashed var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      background: var(--ux-surface);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: crosshair;
      transition: border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-quality-check__signature-pad:hover {
      border-color: var(--ux-primary);
    }

    .ux-quality-check__signature-pad--signed {
      border-style: solid;
      border-color: var(--ux-success);
    }

    .ux-quality-check__signature-placeholder {
      color: var(--ux-text-tertiary);
      font-size: var(--ux-font-size-sm);
    }

    .ux-quality-check__timestamp {
      margin-top: var(--ux-space-md);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-quality-check__timestamp-label {
      color: var(--ux-text-tertiary);
      margin-right: var(--ux-space-sm);
    }

    /* ========================================
       Footer / Actions
    ======================================== */

    .ux-quality-check__footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      padding: var(--ux-space-lg);
      border-top: 1px solid var(--ux-border-color);
      background: var(--ux-surface);
    }

    @media (max-width: 767px) {
      .ux-quality-check__footer {
        flex-direction: column;
      }
    }

    .ux-quality-check__actions {
      display: flex;
      gap: var(--ux-space-sm);
    }

    @media (max-width: 767px) {
      .ux-quality-check__actions {
        width: 100%;
        flex-direction: column;
      }

      .ux-quality-check__actions .ux-button {
        width: 100%;
      }
    }

    /* ========================================
       Print Styles
    ======================================== */

    @media print {
      .ux-quality-check {
        background: white;
        border: none;
        box-shadow: none;
      }

      .ux-quality-check__header {
        background: white;
        border-bottom: 2px solid #000;
      }

      .ux-quality-check__meta {
        background: #f5f5f5;
      }

      .ux-quality-check__item {
        break-inside: avoid;
        border: 1px solid #ccc;
      }

      .ux-quality-check__photo-add,
      .ux-quality-check__photo-remove,
      .ux-quality-check__footer .ux-button--outline {
        display: none;
      }

      .ux-quality-check__selector-btn {
        border: 2px solid #000;
      }

      .ux-quality-check__selector-btn--pass.ux-quality-check__selector-btn--active {
        background: #e8f5e9;
        color: #2e7d32;
      }

      .ux-quality-check__selector-btn--fail.ux-quality-check__selector-btn--active {
        background: #ffebee;
        color: #c62828;
      }

      .ux-quality-check__summary {
        background: #f5f5f5;
        page-break-before: auto;
      }

      .ux-quality-check__signature {
        page-break-inside: avoid;
      }
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-quality-check--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-quality-check--glass .ux-quality-check__header,
    .ux-quality-check--glass .ux-quality-check__footer {
      background: transparent;
      border-color: var(--ux-glass-border);
    }

    .ux-quality-check--glass .ux-quality-check__meta,
    .ux-quality-check--glass .ux-quality-check__summary {
      background: var(--ux-glass-bg-thin);
    }

    .ux-quality-check--glass .ux-quality-check__item {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    .ux-quality-check--glass .ux-quality-check__measurement-input,
    .ux-quality-check--glass .ux-quality-check__notes-input {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-quality-check {
        background: var(--ux-surface);
      }

      .ux-quality-check__measurement-input,
      .ux-quality-check__notes-input {
        background: var(--ux-surface-secondary);
      }
    }

    .ux-dark .ux-quality-check {
      background: var(--ux-surface);
    }

    .ux-dark .ux-quality-check__measurement-input,
    .ux-dark .ux-quality-check__notes-input {
      background: var(--ux-surface-secondary);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-quality-check__item,
      .ux-quality-check__selector-btn,
      .ux-quality-check__measurement-input,
      .ux-quality-check__notes-input,
      .ux-quality-check__defect-tag,
      .ux-quality-check__progress-bar {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-quality-check-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-quality-check-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Icons
  const icons = {
    check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>',
    x: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',
    minus: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/></svg>',
    camera: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>',
    plus: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>',
    clock: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
    warning: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',
    print: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>',
    save: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>'
  };

  // Defect categories
  const defaultDefectCategories = [
    'Scratches',
    'Dents',
    'Discoloration',
    'Missing Parts',
    'Misalignment',
    'Surface Defect',
    'Dimensional',
    'Functional',
    'Contamination',
    'Other'
  ];

  // Alpine.js component
  const qualityCheckData = (options = {}) => ({
    // Configuration
    title: options.title || 'Quality Check',
    subtitle: options.subtitle || '',
    orderNumber: options.orderNumber || '',
    productName: options.productName || '',
    batchNumber: options.batchNumber || '',
    inspector: options.inspector || '',
    defectCategories: options.defectCategories || defaultDefectCategories,

    // State
    items: options.items || [],
    startedAt: options.startedAt || null,
    completedAt: options.completedAt || null,
    inspectorSignature: options.inspectorSignature || null,
    supervisorSignature: options.supervisorSignature || null,

    // Icons
    icons,

    init() {
      // Initialize items if provided
      if (this.items.length === 0 && options.checklistItems) {
        this.items = options.checklistItems.map((item, index) => ({
          id: item.id || `item-${index}`,
          name: item.name,
          description: item.description || '',
          required: item.required !== false,
          status: item.status || null, // null, 'pass', 'fail', 'na'
          measurement: item.hasMeasurement ? {
            value: item.measurementValue || '',
            unit: item.measurementUnit || '',
            min: item.measurementMin,
            max: item.measurementMax,
            target: item.measurementTarget
          } : null,
          photos: item.photos || [],
          notes: item.notes || '',
          defects: item.defects || []
        }));
      }

      // Set start time if not set
      if (!this.startedAt) {
        this.startedAt = new Date().toISOString();
      }
    },

    // Set item status
    setStatus(itemId, status) {
      const item = this.items.find(i => i.id === itemId);
      if (item) {
        item.status = item.status === status ? null : status;
        this.$dispatch('qualitycheck:statuschange', { itemId, status: item.status });
      }
    },

    // Update measurement
    updateMeasurement(itemId, value) {
      const item = this.items.find(i => i.id === itemId);
      if (item && item.measurement) {
        item.measurement.value = value;

        // Auto-set status based on tolerance
        const numValue = parseFloat(value);
        if (!isNaN(numValue) && item.measurement.min !== undefined && item.measurement.max !== undefined) {
          if (numValue >= item.measurement.min && numValue <= item.measurement.max) {
            item.status = 'pass';
          } else {
            item.status = 'fail';
          }
        }

        this.$dispatch('qualitycheck:measurementchange', { itemId, value, status: item.status });
      }
    },

    // Check if measurement is in range
    isInRange(item) {
      if (!item.measurement || item.measurement.value === '') return null;
      const value = parseFloat(item.measurement.value);
      if (isNaN(value)) return null;
      return value >= item.measurement.min && value <= item.measurement.max;
    },

    // Add photo
    addPhoto(itemId, file) {
      const item = this.items.find(i => i.id === itemId);
      if (item && file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          item.photos.push({
            id: `photo-${Date.now()}`,
            data: e.target.result,
            name: file.name,
            timestamp: new Date().toISOString()
          });
          this.$dispatch('qualitycheck:photochange', { itemId, photos: item.photos });
        };
        reader.readAsDataURL(file);
      }
    },

    // Remove photo
    removePhoto(itemId, photoId) {
      const item = this.items.find(i => i.id === itemId);
      if (item) {
        item.photos = item.photos.filter(p => p.id !== photoId);
        this.$dispatch('qualitycheck:photochange', { itemId, photos: item.photos });
      }
    },

    // Update notes
    updateNotes(itemId, notes) {
      const item = this.items.find(i => i.id === itemId);
      if (item) {
        item.notes = notes;
      }
    },

    // Toggle defect category
    toggleDefect(itemId, defect) {
      const item = this.items.find(i => i.id === itemId);
      if (item) {
        const index = item.defects.indexOf(defect);
        if (index === -1) {
          item.defects.push(defect);
        } else {
          item.defects.splice(index, 1);
        }
        this.$dispatch('qualitycheck:defectchange', { itemId, defects: item.defects });
      }
    },

    // Summary getters
    get passCount() {
      return this.items.filter(i => i.status === 'pass').length;
    },

    get failCount() {
      return this.items.filter(i => i.status === 'fail').length;
    },

    get naCount() {
      return this.items.filter(i => i.status === 'na').length;
    },

    get pendingCount() {
      return this.items.filter(i => i.status === null).length;
    },

    get totalCount() {
      return this.items.length;
    },

    get completionPercent() {
      if (this.totalCount === 0) return 0;
      return Math.round(((this.totalCount - this.pendingCount) / this.totalCount) * 100);
    },

    get passPercent() {
      const completed = this.totalCount - this.pendingCount - this.naCount;
      if (completed === 0) return 0;
      return Math.round((this.passCount / completed) * 100);
    },

    get overallStatus() {
      if (this.pendingCount > 0) return 'pending';
      if (this.failCount > 0) return 'fail';
      return 'pass';
    },

    get isComplete() {
      const requiredItems = this.items.filter(i => i.required);
      return requiredItems.every(i => i.status !== null);
    },

    // Format timestamp
    formatTimestamp(isoString) {
      if (!isoString) return '';
      const date = new Date(isoString);
      return date.toLocaleString();
    },

    // Complete inspection
    complete() {
      if (!this.isComplete) {
        this.$dispatch('qualitycheck:incomplete', { pendingItems: this.items.filter(i => i.required && i.status === null) });
        return false;
      }

      this.completedAt = new Date().toISOString();
      this.$dispatch('qualitycheck:complete', {
        status: this.overallStatus,
        passCount: this.passCount,
        failCount: this.failCount,
        naCount: this.naCount,
        completedAt: this.completedAt
      });
      return true;
    },

    // Print form
    print() {
      window.print();
    },

    // Export data
    getData() {
      return {
        title: this.title,
        orderNumber: this.orderNumber,
        productName: this.productName,
        batchNumber: this.batchNumber,
        inspector: this.inspector,
        items: this.items,
        summary: {
          passCount: this.passCount,
          failCount: this.failCount,
          naCount: this.naCount,
          pendingCount: this.pendingCount,
          overallStatus: this.overallStatus
        },
        startedAt: this.startedAt,
        completedAt: this.completedAt,
        inspectorSignature: this.inspectorSignature,
        supervisorSignature: this.supervisorSignature
      };
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxQualityCheck', qualityCheckData);
  }

})();

(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Quantity Badge
       Badges for counters, notifications, cart items
    ======================================== */

    .ux-quantity-badge {
      position: relative;
      display: inline-flex;
    }

    .ux-quantity-badge__count {
      position: absolute;
      top: -6px;
      right: -6px;
      min-width: 18px;
      height: 18px;
      padding: 0 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--ux-danger);
      color: white;
      font-size: 11px;
      font-weight: 600;
      line-height: 1;
      border-radius: var(--ux-radius-full);
      border: 2px solid var(--ux-surface);
      transform: scale(1);
      transition: transform var(--ux-transition-fast) var(--ux-ease-bounce);
    }

    /* Animated entrance */
    .ux-quantity-badge__count--animate {
      animation: ux-badge-pop 0.3s var(--ux-ease-bounce);
    }

    @keyframes ux-badge-pop {
      0% {
        transform: scale(0);
      }
      50% {
        transform: scale(1.2);
      }
      100% {
        transform: scale(1);
      }
    }

    /* Hidden when zero */
    .ux-quantity-badge__count--hidden {
      transform: scale(0);
    }

    /* Dot variant (no number) */
    .ux-quantity-badge__count--dot {
      min-width: 10px;
      width: 10px;
      height: 10px;
      padding: 0;
      top: -2px;
      right: -2px;
    }

    /* Size variants */
    .ux-quantity-badge--sm .ux-quantity-badge__count {
      min-width: 14px;
      height: 14px;
      padding: 0 3px;
      font-size: 9px;
      top: -4px;
      right: -4px;
    }

    .ux-quantity-badge--lg .ux-quantity-badge__count {
      min-width: 22px;
      height: 22px;
      padding: 0 6px;
      font-size: 13px;
      top: -8px;
      right: -8px;
    }

    /* Position variants */
    .ux-quantity-badge--top-left .ux-quantity-badge__count {
      top: -6px;
      right: auto;
      left: -6px;
    }

    .ux-quantity-badge--bottom-right .ux-quantity-badge__count {
      top: auto;
      bottom: -6px;
      right: -6px;
    }

    .ux-quantity-badge--bottom-left .ux-quantity-badge__count {
      top: auto;
      bottom: -6px;
      right: auto;
      left: -6px;
    }

    /* Inline variant */
    .ux-quantity-badge--inline {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-quantity-badge--inline .ux-quantity-badge__count {
      position: static;
      border: none;
    }

    /* Color variants */
    .ux-quantity-badge--primary .ux-quantity-badge__count {
      background: var(--ux-primary);
    }

    .ux-quantity-badge--secondary .ux-quantity-badge__count {
      background: var(--ux-secondary);
    }

    .ux-quantity-badge--success .ux-quantity-badge__count {
      background: var(--ux-success);
    }

    .ux-quantity-badge--warning .ux-quantity-badge__count {
      background: var(--ux-warning);
      color: var(--ux-gray-900);
    }

    .ux-quantity-badge--danger .ux-quantity-badge__count {
      background: var(--ux-danger);
    }

    .ux-quantity-badge--dark .ux-quantity-badge__count {
      background: var(--ux-gray-800);
    }

    .ux-quantity-badge--light .ux-quantity-badge__count {
      background: var(--ux-gray-200);
      color: var(--ux-gray-800);
    }

    /* Soft color variants */
    .ux-quantity-badge--primary-soft .ux-quantity-badge__count {
      background: var(--ux-primary-tint);
      color: var(--ux-primary);
      border-color: var(--ux-primary-tint);
    }

    .ux-quantity-badge--success-soft .ux-quantity-badge__count {
      background: var(--ux-success-tint);
      color: var(--ux-success);
      border-color: var(--ux-success-tint);
    }

    .ux-quantity-badge--danger-soft .ux-quantity-badge__count {
      background: var(--ux-danger-tint);
      color: var(--ux-danger);
      border-color: var(--ux-danger-tint);
    }

    /* Outline variants */
    .ux-quantity-badge--outline .ux-quantity-badge__count {
      background: var(--ux-surface);
      color: var(--ux-danger);
      border-color: var(--ux-danger);
    }

    .ux-quantity-badge--outline.ux-quantity-badge--primary .ux-quantity-badge__count {
      color: var(--ux-primary);
      border-color: var(--ux-primary);
    }

    .ux-quantity-badge--outline.ux-quantity-badge--success .ux-quantity-badge__count {
      color: var(--ux-success);
      border-color: var(--ux-success);
    }

    /* Pulse animation for new items */
    .ux-quantity-badge__count--pulse {
      animation: ux-badge-pulse 1.5s ease-in-out infinite;
    }

    @keyframes ux-badge-pulse {
      0%, 100% {
        box-shadow: 0 0 0 0 rgba(var(--ux-danger-rgb, 239, 68, 68), 0.5);
      }
      50% {
        box-shadow: 0 0 0 6px rgba(var(--ux-danger-rgb, 239, 68, 68), 0);
      }
    }

    /* Cart specific styles */
    .ux-quantity-badge--cart {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-full);
    }

    .ux-quantity-badge--cart .ux-quantity-badge__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border: none;
      background: var(--ux-gray-100);
      border-radius: 50%;
      color: var(--ux-text);
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-quantity-badge--cart .ux-quantity-badge__btn:hover {
      background: var(--ux-gray-200);
    }

    .ux-quantity-badge--cart .ux-quantity-badge__btn:active {
      transform: scale(0.95);
    }

    .ux-quantity-badge--cart .ux-quantity-badge__btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .ux-quantity-badge--cart .ux-quantity-badge__value {
      min-width: 24px;
      text-align: center;
      font-weight: 600;
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
    }

    /* Stepper variant */
    .ux-quantity-badge--stepper {
      display: inline-flex;
      align-items: center;
      background: var(--ux-gray-100);
      border-radius: var(--ux-radius-md);
      overflow: hidden;
    }

    .ux-quantity-badge--stepper .ux-quantity-badge__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border: none;
      background: transparent;
      color: var(--ux-text);
      font-size: 18px;
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-quantity-badge--stepper .ux-quantity-badge__btn:hover {
      background: var(--ux-gray-200);
    }

    .ux-quantity-badge--stepper .ux-quantity-badge__btn:active {
      background: var(--ux-gray-300);
    }

    .ux-quantity-badge--stepper .ux-quantity-badge__btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .ux-quantity-badge--stepper .ux-quantity-badge__value {
      min-width: 40px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      border-left: 1px solid var(--ux-border-color);
      border-right: 1px solid var(--ux-border-color);
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
      .ux-quantity-badge__count {
        border-color: var(--ux-gray-900);
      }

      .ux-quantity-badge--light .ux-quantity-badge__count {
        background: var(--ux-gray-700);
        color: var(--ux-gray-200);
      }

      .ux-quantity-badge--cart {
        background: var(--ux-gray-800);
        border-color: var(--ux-gray-700);
      }

      .ux-quantity-badge--cart .ux-quantity-badge__btn {
        background: var(--ux-gray-700);
      }

      .ux-quantity-badge--cart .ux-quantity-badge__btn:hover {
        background: var(--ux-gray-600);
      }

      .ux-quantity-badge--stepper {
        background: var(--ux-gray-800);
      }

      .ux-quantity-badge--stepper .ux-quantity-badge__btn:hover {
        background: var(--ux-gray-700);
      }

      .ux-quantity-badge--stepper .ux-quantity-badge__value {
        border-color: var(--ux-gray-700);
      }
    }

    .ux-dark .ux-quantity-badge__count {
      border-color: var(--ux-gray-900);
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .ux-quantity-badge__count {
        transition: none;
      }

      .ux-quantity-badge__count--animate {
        animation: none;
      }

      .ux-quantity-badge__count--pulse {
        animation: none;
      }
    }
  `;

  if (window.UX) {
    window.UX.injectStyles('ux-quantity-badge-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-quantity-badge-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for interactive quantity badges
  const componentData = (options = {}) => ({
    value: options.value ?? 0,
    min: options.min ?? 0,
    max: options.max ?? 999,
    step: options.step ?? 1,
    animate: options.animate ?? true,
    showAnimation: false,

    init() {
      this.$watch('value', (newVal, oldVal) => {
        if (this.animate && newVal !== oldVal) {
          this.showAnimation = true;
          setTimeout(() => {
            this.showAnimation = false;
          }, 300);
        }
        this.$dispatch('quantity:change', { value: newVal, oldValue: oldVal });
      });
    },

    increment() {
      if (this.value < this.max) {
        this.value = Math.min(this.max, this.value + this.step);
      }
    },

    decrement() {
      if (this.value > this.min) {
        this.value = Math.max(this.min, this.value - this.step);
      }
    },

    setValue(val) {
      this.value = Math.max(this.min, Math.min(this.max, val));
    },

    get displayValue() {
      if (this.value > 99) return '99+';
      return this.value.toString();
    },

    get isAtMin() {
      return this.value <= this.min;
    },

    get isAtMax() {
      return this.value >= this.max;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxQuantityBadge', componentData);
  }
})();

/**
 * UX Quantity Stepper Component
 * Quantity selector with +/- buttons for cart quantity adjustment
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Quantity Stepper
    ======================================== */

    :root {
      --ux-quantity-stepper-height: 44px;
      --ux-quantity-stepper-height-sm: 36px;
      --ux-quantity-stepper-height-lg: 52px;
      --ux-quantity-stepper-btn-width: 44px;
      --ux-quantity-stepper-btn-width-sm: 36px;
      --ux-quantity-stepper-btn-width-lg: 52px;
      --ux-quantity-stepper-input-width: 56px;
      --ux-quantity-stepper-input-width-sm: 44px;
      --ux-quantity-stepper-input-width-lg: 68px;
      --ux-quantity-stepper-border-radius: var(--ux-border-radius);
      --ux-quantity-stepper-font-size: var(--ux-font-size-md);
      --ux-quantity-stepper-font-size-sm: var(--ux-font-size-sm);
      --ux-quantity-stepper-font-size-lg: var(--ux-font-size-lg);
      --ux-quantity-stepper-icon-size: 20px;
      --ux-quantity-stepper-icon-size-sm: 16px;
      --ux-quantity-stepper-icon-size-lg: 24px;
    }

    .ux-quantity-stepper {
      display: inline-flex;
      align-items: center;
      height: var(--ux-quantity-stepper-height);
      background-color: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-quantity-stepper-border-radius);
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
    }

    /* ========================================
       Buttons (+/-)
    ======================================== */

    .ux-quantity-stepper__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-quantity-stepper-btn-width);
      height: 100%;
      padding: 0;
      background-color: transparent;
      border: none;
      color: var(--ux-primary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .ux-quantity-stepper__btn:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-quantity-stepper__btn:active {
      background-color: rgba(var(--ux-primary-rgb), 0.15);
      transform: scale(0.95);
    }

    .ux-quantity-stepper__btn:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: -2px;
    }

    .ux-quantity-stepper__btn svg {
      width: var(--ux-quantity-stepper-icon-size);
      height: var(--ux-quantity-stepper-icon-size);
    }

    /* Disabled button state */
    .ux-quantity-stepper__btn--disabled,
    .ux-quantity-stepper__btn:disabled {
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
      pointer-events: none;
    }

    .ux-quantity-stepper__btn--disabled:hover,
    .ux-quantity-stepper__btn:disabled:hover {
      background-color: transparent;
    }

    /* ========================================
       Input (center number display)
    ======================================== */

    .ux-quantity-stepper__input {
      width: var(--ux-quantity-stepper-input-width);
      height: 100%;
      padding: 0;
      background-color: transparent;
      border: none;
      border-left: 1px solid var(--ux-border-color);
      border-right: 1px solid var(--ux-border-color);
      font-family: var(--ux-font-family);
      font-size: var(--ux-quantity-stepper-font-size);
      font-weight: 600;
      text-align: center;
      color: var(--ux-text);
      -moz-appearance: textfield;
      appearance: textfield;
    }

    .ux-quantity-stepper__input::-webkit-outer-spin-button,
    .ux-quantity-stepper__input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .ux-quantity-stepper__input:focus {
      outline: none;
      background-color: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-quantity-stepper__input:disabled {
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
    }

    /* ========================================
       Size Variants
    ======================================== */

    /* Small */
    .ux-quantity-stepper--sm {
      height: var(--ux-quantity-stepper-height-sm);
    }

    .ux-quantity-stepper--sm .ux-quantity-stepper__btn {
      width: var(--ux-quantity-stepper-btn-width-sm);
    }

    .ux-quantity-stepper--sm .ux-quantity-stepper__btn svg {
      width: var(--ux-quantity-stepper-icon-size-sm);
      height: var(--ux-quantity-stepper-icon-size-sm);
    }

    .ux-quantity-stepper--sm .ux-quantity-stepper__input {
      width: var(--ux-quantity-stepper-input-width-sm);
      font-size: var(--ux-quantity-stepper-font-size-sm);
    }

    /* Large */
    .ux-quantity-stepper--lg {
      height: var(--ux-quantity-stepper-height-lg);
    }

    .ux-quantity-stepper--lg .ux-quantity-stepper__btn {
      width: var(--ux-quantity-stepper-btn-width-lg);
    }

    .ux-quantity-stepper--lg .ux-quantity-stepper__btn svg {
      width: var(--ux-quantity-stepper-icon-size-lg);
      height: var(--ux-quantity-stepper-icon-size-lg);
    }

    .ux-quantity-stepper--lg .ux-quantity-stepper__input {
      width: var(--ux-quantity-stepper-input-width-lg);
      font-size: var(--ux-quantity-stepper-font-size-lg);
    }

    /* ========================================
       Vertical Variant (Stacked)
    ======================================== */

    .ux-quantity-stepper--vertical {
      flex-direction: column;
      width: var(--ux-quantity-stepper-btn-width);
      height: auto;
    }

    .ux-quantity-stepper--vertical .ux-quantity-stepper__btn {
      width: 100%;
      height: var(--ux-quantity-stepper-btn-width);
    }

    .ux-quantity-stepper--vertical .ux-quantity-stepper__btn--minus {
      order: 3;
    }

    .ux-quantity-stepper--vertical .ux-quantity-stepper__btn--plus {
      order: 1;
    }

    .ux-quantity-stepper--vertical .ux-quantity-stepper__input {
      order: 2;
      width: 100%;
      height: var(--ux-quantity-stepper-btn-width);
      border-left: none;
      border-right: none;
      border-top: 1px solid var(--ux-border-color);
      border-bottom: 1px solid var(--ux-border-color);
    }

    /* Vertical Small */
    .ux-quantity-stepper--vertical.ux-quantity-stepper--sm {
      width: var(--ux-quantity-stepper-btn-width-sm);
    }

    .ux-quantity-stepper--vertical.ux-quantity-stepper--sm .ux-quantity-stepper__btn {
      height: var(--ux-quantity-stepper-btn-width-sm);
    }

    .ux-quantity-stepper--vertical.ux-quantity-stepper--sm .ux-quantity-stepper__input {
      height: var(--ux-quantity-stepper-btn-width-sm);
    }

    /* Vertical Large */
    .ux-quantity-stepper--vertical.ux-quantity-stepper--lg {
      width: var(--ux-quantity-stepper-btn-width-lg);
    }

    .ux-quantity-stepper--vertical.ux-quantity-stepper--lg .ux-quantity-stepper__btn {
      height: var(--ux-quantity-stepper-btn-width-lg);
    }

    .ux-quantity-stepper--vertical.ux-quantity-stepper--lg .ux-quantity-stepper__input {
      height: var(--ux-quantity-stepper-btn-width-lg);
    }

    /* ========================================
       Rounded Variant
    ======================================== */

    .ux-quantity-stepper--round {
      border-radius: 9999px;
    }

    /* ========================================
       Compact Variant (no visible input)
    ======================================== */

    .ux-quantity-stepper--compact .ux-quantity-stepper__input {
      width: 36px;
      border-left: none;
      border-right: none;
    }

    .ux-quantity-stepper--compact.ux-quantity-stepper--sm .ux-quantity-stepper__input {
      width: 28px;
    }

    .ux-quantity-stepper--compact.ux-quantity-stepper--lg .ux-quantity-stepper__input {
      width: 44px;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter comes from universal selector [class*="--glass"] in ux-core.js */
    .ux-quantity-stepper--glass {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }

    .ux-quantity-stepper--glass .ux-quantity-stepper__input {
      border-color: var(--ux-glass-border);
    }

    .ux-quantity-stepper--glass .ux-quantity-stepper__btn:hover {
      background-color: var(--ux-glass-bg);
    }

    .ux-quantity-stepper--glass .ux-quantity-stepper__btn:active {
      background-color: var(--ux-glass-bg-thick);
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-quantity-stepper--disabled,
    .ux-quantity-stepper:disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* ========================================
       Color Variants (using composition system)
    ======================================== */

    .ux-quantity-stepper.ux-color-primary .ux-quantity-stepper__btn {
      color: var(--ux-primary);
    }

    .ux-quantity-stepper.ux-color-primary .ux-quantity-stepper__btn:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-quantity-stepper.ux-color-success .ux-quantity-stepper__btn {
      color: var(--ux-success);
    }

    .ux-quantity-stepper.ux-color-success .ux-quantity-stepper__btn:hover {
      background-color: rgba(var(--ux-success-rgb), 0.1);
    }

    .ux-quantity-stepper.ux-color-danger .ux-quantity-stepper__btn {
      color: var(--ux-danger);
    }

    .ux-quantity-stepper.ux-color-danger .ux-quantity-stepper__btn:hover {
      background-color: rgba(var(--ux-danger-rgb), 0.1);
    }

    /* ========================================
       Long Press Indicator
    ======================================== */

    .ux-quantity-stepper__btn--pressing {
      background-color: rgba(var(--ux-primary-rgb), 0.2) !important;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-quantity-stepper {
        background-color: var(--ux-surface-secondary);
        border-color: var(--ux-border-color);
      }

      .ux-quantity-stepper--glass {
        background: var(--ux-glass-bg-thin);
        border-color: var(--ux-glass-border);
      }
    }

    .ux-dark .ux-quantity-stepper {
      background-color: var(--ux-surface-secondary);
      border-color: var(--ux-border-color);
    }

    .ux-dark .ux-quantity-stepper--glass {
      background: var(--ux-glass-bg-thin);
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-quantity-stepper__btn {
        transition: none;
      }

      .ux-quantity-stepper__btn:active {
        transform: none;
      }

      .ux-quantity-stepper__input {
        transition: none;
      }
    }
  `;

  // SVG icons for +/- buttons
  const minusIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>`;
  const plusIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-quantity-stepper-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-quantity-stepper-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for quantity stepper
  // ARIA: role="spinbutton", aria-valuenow, aria-valuemin, aria-valuemax
  const quantityStepperComponent = (config = {}) => ({
    value: config.value ?? 1,
    min: config.min ?? 0,
    max: config.max ?? 999,
    step: config.step ?? 1,
    disabled: config.disabled ?? false,
    readonly: config.readonly ?? false,

    // Long press state
    _longPressTimer: null,
    _longPressInterval: null,
    _isLongPressing: false,
    _longPressDelay: config.longPressDelay ?? 400,
    _longPressSpeed: config.longPressSpeed ?? 100,

    // Icons
    minusIcon,
    plusIcon,

    init() {
      // Clamp initial value
      this.value = this._clamp(this.value);
    },

    destroy() {
      this._stopLongPress();
    },

    // ARIA attributes for the component
    get ariaAttrs() {
      return {
        'role': 'spinbutton',
        'aria-valuenow': this.value,
        'aria-valuemin': this.min,
        'aria-valuemax': this.max,
        'aria-label': `Quantity: ${this.value}`
      };
    },

    // Check if at min/max
    get isAtMin() {
      return this.value <= this.min;
    },

    get isAtMax() {
      return this.value >= this.max;
    },

    // Clamp value to min/max
    _clamp(val) {
      return Math.min(Math.max(val, this.min), this.max);
    },

    // Set value with clamping and event dispatch
    setValue(newValue) {
      if (this.disabled || this.readonly) return;

      const oldValue = this.value;
      const clampedValue = this._clamp(Number(newValue) || 0);

      if (clampedValue !== oldValue) {
        this.value = clampedValue;
        this.$dispatch('quantity-change', {
          value: this.value,
          oldValue: oldValue
        });
      } else {
        // Reset input to valid value
        this.value = clampedValue;
      }
    },

    // Increment value
    increment() {
      if (this.disabled || this.readonly || this.isAtMax) return;
      this.setValue(this.value + this.step);
    },

    // Decrement value
    decrement() {
      if (this.disabled || this.readonly || this.isAtMin) return;
      this.setValue(this.value - this.step);
    },

    // Handle input change
    onInput(event) {
      const inputValue = event.target.value;

      // Allow empty input while typing
      if (inputValue === '') return;

      const numValue = parseInt(inputValue, 10);
      if (!isNaN(numValue)) {
        this.setValue(numValue);
      }
    },

    // Handle input blur - ensure valid value
    onBlur(event) {
      const inputValue = event.target.value;
      if (inputValue === '' || isNaN(parseInt(inputValue, 10))) {
        this.value = this.min;
      } else {
        this.setValue(parseInt(inputValue, 10));
      }
    },

    // Handle keyboard navigation
    onKeydown(event) {
      if (this.disabled || this.readonly) return;

      switch (event.key) {
        case 'ArrowUp':
          event.preventDefault();
          this.increment();
          break;
        case 'ArrowDown':
          event.preventDefault();
          this.decrement();
          break;
        case 'Home':
          event.preventDefault();
          this.setValue(this.min);
          break;
        case 'End':
          event.preventDefault();
          this.setValue(this.max);
          break;
        case 'PageUp':
          event.preventDefault();
          this.setValue(this.value + (this.step * 10));
          break;
        case 'PageDown':
          event.preventDefault();
          this.setValue(this.value - (this.step * 10));
          break;
      }
    },

    // Long press handlers for rapid changes
    _startLongPress(action) {
      if (this.disabled || this.readonly) return;

      this._isLongPressing = true;

      // Initial action
      action();

      // Start long press timer
      this._longPressTimer = setTimeout(() => {
        // Start rapid interval
        this._longPressInterval = setInterval(() => {
          action();
        }, this._longPressSpeed);
      }, this._longPressDelay);
    },

    _stopLongPress() {
      this._isLongPressing = false;

      if (this._longPressTimer) {
        clearTimeout(this._longPressTimer);
        this._longPressTimer = null;
      }

      if (this._longPressInterval) {
        clearInterval(this._longPressInterval);
        this._longPressInterval = null;
      }
    },

    // Mouse/touch handlers for increment
    onIncrementStart(event) {
      event.preventDefault();
      this._startLongPress(() => this.increment());
    },

    // Mouse/touch handlers for decrement
    onDecrementStart(event) {
      event.preventDefault();
      this._startLongPress(() => this.decrement());
    },

    // Stop long press on mouse/touch end
    onPressEnd() {
      this._stopLongPress();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxQuantityStepper', quantityStepperComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxQuantityStepper', quantityStepperComponent);
    });
  }
})();

/**
 * UX Radio Component
 * Radio buttons estilo Ionic
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Radio
    ======================================== */

    .ux-radio {
      display: inline-flex;
      align-items: flex-start;
      gap: var(--ux-space-md);
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-sm) 0;
    }

    .ux-radio__input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .ux-radio__circle {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-radio-size);
      height: var(--ux-radio-size);
      background-color: transparent;
      border: 2px solid var(--ux-medium);
      border-radius: 50%;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease-spring);
      flex-shrink: 0;
    }

    /* Expanded touch target for accessibility (44px minimum) */
    .ux-radio__circle::before {
      content: '';
      position: absolute;
      inset: -10px;
      border-radius: 50%;
      z-index: 1;
    }

    .ux-radio__dot {
      width: 12px;
      height: 12px;
      background-color: var(--ux-primary);
      border-radius: 50%;
      transform: scale(0);
      transition: transform var(--ux-transition-fast) var(--ux-ease-spring);
    }

    /* Checked State */
    .ux-radio__input:checked + .ux-radio__circle {
      border-color: var(--ux-primary);
    }

    .ux-radio__input:checked + .ux-radio__circle .ux-radio__dot {
      transform: scale(1);
    }

    /* Hover State */
    .ux-radio:hover .ux-radio__circle {
      border-color: var(--ux-primary);
    }

    /* Active State */
    .ux-radio:active .ux-radio__circle {
      transform: scale(0.9);
    }

    /* Focus State */
    .ux-radio__input:focus-visible + .ux-radio__circle {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    /* Disabled State */
    .ux-radio--disabled,
    .ux-radio__input:disabled + .ux-radio__circle {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-radio.ux-color-success .ux-radio__dot { background-color: var(--ux-success); }
    .ux-radio.ux-color-success .ux-radio__input:checked + .ux-radio__circle { border-color: var(--ux-success); }
    .ux-radio.ux-color-success:hover .ux-radio__circle { border-color: var(--ux-success); }

    .ux-radio.ux-color-warning .ux-radio__dot { background-color: var(--ux-warning); }
    .ux-radio.ux-color-warning .ux-radio__input:checked + .ux-radio__circle { border-color: var(--ux-warning); }
    .ux-radio.ux-color-warning:hover .ux-radio__circle { border-color: var(--ux-warning); }

    .ux-radio.ux-color-danger .ux-radio__dot { background-color: var(--ux-danger); }
    .ux-radio.ux-color-danger .ux-radio__input:checked + .ux-radio__circle { border-color: var(--ux-danger); }
    .ux-radio.ux-color-danger:hover .ux-radio__circle { border-color: var(--ux-danger); }

    .ux-radio.ux-color-dark .ux-radio__dot { background-color: var(--ux-dark); }
    .ux-radio.ux-color-dark .ux-radio__input:checked + .ux-radio__circle { border-color: var(--ux-dark); }
    .ux-radio.ux-color-dark:hover .ux-radio__circle { border-color: var(--ux-dark); }

    .ux-radio.ux-color-medium .ux-radio__dot { background-color: var(--ux-medium); }
    .ux-radio.ux-color-medium .ux-radio__input:checked + .ux-radio__circle { border-color: var(--ux-medium); }
    .ux-radio.ux-color-medium:hover .ux-radio__circle { border-color: var(--ux-medium); }

    /* ========================================
       Sizes
    ======================================== */

    .ux-radio--sm .ux-radio__circle {
      width: var(--ux-radio-size-sm);
      height: var(--ux-radio-size-sm);
    }

    .ux-radio--sm .ux-radio__dot {
      width: calc(var(--ux-radio-size-sm) * 0.5);
      height: calc(var(--ux-radio-size-sm) * 0.5);
    }

    .ux-radio--lg .ux-radio__circle {
      width: var(--ux-radio-size-lg);
      height: var(--ux-radio-size-lg);
    }

    .ux-radio--lg .ux-radio__dot {
      width: calc(var(--ux-radio-size-lg) * 0.6);
      height: calc(var(--ux-radio-size-lg) * 0.6);
    }

    /* ========================================
       Label
    ======================================== */

    .ux-radio__label {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      line-height: 1.4;
      padding-top: 2px;
    }

    .ux-radio__description {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    /* ========================================
       Radio Group
    ======================================== */

    .ux-radio-group {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-radio-group--horizontal {
      flex-direction: row;
      flex-wrap: wrap;
      gap: var(--ux-space-lg);
    }

    .ux-radio-group__label {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-sm);
    }

    .ux-radio-group__error {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-danger);
      margin-top: var(--ux-space-xs);
    }

    /* ========================================
       Radio List Item
    ======================================== */

    .ux-radio-item {
      display: flex;
      align-items: center;
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      cursor: pointer;
    }

    .ux-radio-item:last-child {
      border-bottom: none;
    }

    .ux-radio-item:active {
      background-color: var(--ux-surface-secondary);
    }

    .ux-radio-item--selected {
      background-color: rgba(var(--ux-primary-rgb), 0.08);
    }

    .ux-radio-item__content {
      flex: 1;
      margin-left: var(--ux-space-md);
    }

    .ux-radio-item__title {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
    }

    .ux-radio-item__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    /* ========================================
       Radio Card (selectable cards)
    ======================================== */

    .ux-radio-card {
      position: relative;
      padding: var(--ux-space-lg);
      background-color: var(--ux-surface);
      border: 2px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      cursor: pointer;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        background-color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-radio-card:hover {
      border-color: var(--ux-primary);
    }

    .ux-radio-card:active {
      transform: scale(0.98);
    }

    .ux-radio-card--selected {
      border-color: var(--ux-primary);
      background-color: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-radio-card__check {
      position: absolute;
      top: var(--ux-space-md);
      right: var(--ux-space-md);
      width: 24px;
      height: 24px;
      background-color: var(--ux-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      opacity: 0;
      transform: scale(0);
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease-spring);
    }

    .ux-radio-card--selected .ux-radio-card__check {
      opacity: 1;
      transform: scale(1);
    }

    .ux-radio-card__check svg {
      width: 14px;
      height: 14px;
    }

    .ux-radio-card__title {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-radio-card__description {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* Radio Card Grid */
    .ux-radio-card-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--ux-space-md);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-radio--glass .ux-radio__circle {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-radio--glass .ux-radio__input:checked + .ux-radio__circle {
      border-color: var(--ux-primary);
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .ux-radio__circle {
        transition: none;
      }

      .ux-radio__dot {
        transition: none;
      }

      .ux-radio-card {
        transition: none;
      }

      .ux-radio-card__check {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-radio-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-radio-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for radio group
  const radioGroupComponent = (config = {}) => ({
    value: config.value || null,
    disabled: config.disabled || false,
    error: '',

    select(newValue) {
      if (!this.disabled) {
        this.value = newValue;
        this.error = '';
      }
    },

    isSelected(checkValue) {
      return this.value === checkValue;
    },

    validate(required = false, message = 'Please select an option') {
      if (required && !this.value) {
        this.error = message;
        return false;
      }
      this.error = '';
      return true;
    },

    reset() {
      this.value = null;
      this.error = '';
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxRadioGroup', radioGroupComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxRadioGroup', radioGroupComponent);
    });
  }
})();

/**
 * UX Range Component
 * Sliders estilo iOS/Ionic
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Range
    ======================================== */

    .ux-range {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
      padding: var(--ux-space-sm) 0;
    }

    .ux-range__wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      min-height: var(--ux-touch-target);
    }

    .ux-range__track-container {
      position: relative;
      flex: 1;
      height: 44px;
      display: flex;
      align-items: center;
    }

    .ux-range__track {
      position: absolute;
      width: 100%;
      height: 4px;
      background-color: var(--ux-medium);
      border-radius: 2px;
      overflow: hidden;
    }

    .ux-range__fill {
      position: absolute;
      height: 100%;
      /* Uses composition system: combine with .ux-color-* classes */
      background-color: var(--ux-variant-bg, var(--ux-primary));
      border-radius: 2px;
      transition: width 0.05s ease-out;
    }

    .ux-range__input {
      position: absolute;
      width: 100%;
      height: 44px;
      margin: 0;
      opacity: 0;
      cursor: pointer;
      z-index: 2;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-range__thumb {
      position: absolute;
      width: 28px;
      height: 28px;
      background-color: white;
      border-radius: 50%;
      box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(0, 0, 0, 0.1);
      pointer-events: none;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease-spring),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
      transform: translateX(-50%);
      z-index: 1;
    }

    /* Active State */
    .ux-range__input:active ~ .ux-range__thumb {
      transform: translateX(-50%) scale(1.1);
      box-shadow:
        0 4px 8px rgba(0, 0, 0, 0.15),
        0 8px 16px rgba(0, 0, 0, 0.1);
    }

    /* Focus State */
    .ux-range__input:focus-visible ~ .ux-range__thumb {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    /* Disabled State */
    .ux-range--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    .ux-range--disabled .ux-range__input {
      cursor: not-allowed;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-range--sm .ux-range__track {
      height: 2px;
    }

    .ux-range--sm .ux-range__thumb {
      width: 20px;
      height: 20px;
    }

    .ux-range--lg .ux-range__track {
      height: 6px;
      border-radius: 3px;
    }

    .ux-range--lg .ux-range__fill {
      border-radius: 3px;
    }

    .ux-range--lg .ux-range__thumb {
      width: 34px;
      height: 34px;
    }

    /* ========================================
       With Ticks
    ======================================== */

    .ux-range__ticks {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      transform: translateY(-50%);
      pointer-events: none;
    }

    .ux-range__tick {
      width: 2px;
      height: 8px;
      background-color: var(--ux-medium);
      border-radius: 1px;
    }

    .ux-range__tick--active {
      background-color: var(--ux-primary);
    }

    /* ========================================
       Labels
    ======================================== */

    .ux-range__label {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-range__value {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
      min-width: 36px;
      text-align: center;
    }

    .ux-range__value--start {
      text-align: left;
    }

    .ux-range__value--end {
      text-align: right;
    }

    .ux-range__min-max {
      display: flex;
      justify-content: space-between;
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Pin (tooltip on drag)
    ======================================== */

    .ux-range--pin .ux-range__pin {
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%) scale(0);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background-color: var(--ux-dark);
      color: white;
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      border-radius: var(--ux-border-radius-sm);
      white-space: nowrap;
      opacity: 0;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease-spring),
        opacity var(--ux-transition-fast) var(--ux-ease);
      pointer-events: none;
    }

    .ux-range--pin .ux-range__pin::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: var(--ux-dark);
    }

    .ux-range--pin .ux-range__input:active ~ .ux-range__thumb .ux-range__pin,
    .ux-range--pin .ux-range__input:focus ~ .ux-range__thumb .ux-range__pin {
      opacity: 1;
      transform: translateX(-50%) scale(1);
    }

    /* ========================================
       Dual Range (two thumbs)
    ======================================== */

    .ux-range--dual .ux-range__fill {
      left: 0;
      right: 0;
    }

    .ux-range--dual .ux-range__input--min,
    .ux-range--dual .ux-range__input--max {
      pointer-events: none;
    }

    .ux-range--dual .ux-range__input--min::-webkit-slider-thumb,
    .ux-range--dual .ux-range__input--max::-webkit-slider-thumb {
      pointer-events: auto;
    }

    /* ========================================
       Icons
    ======================================== */

    .ux-range__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      color: var(--ux-text-secondary);
      flex-shrink: 0;
    }

    .ux-range__icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Snapping
    ======================================== */

    .ux-range--snapping .ux-range__thumb {
      transition:
        transform var(--ux-transition-fast) var(--ux-ease-spring),
        left var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-range--snapping .ux-range__fill {
      transition: width var(--ux-transition-fast) var(--ux-ease);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-range--glass .ux-range__track {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-range--glass .ux-range__thumb {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-range-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-range-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for range
  const rangeComponent = (config = {}) => ({
    value: config.value ?? 50,
    min: config.min ?? 0,
    max: config.max ?? 100,
    step: config.step ?? 1,
    disabled: config.disabled || false,

    get percent() {
      return ((this.value - this.min) / (this.max - this.min)) * 100;
    },

    get thumbPosition() {
      return `calc(${this.percent}% - ${14 * (this.percent / 100)}px + ${14 * ((100 - this.percent) / 100)}px)`;
    },

    updateValue(newValue) {
      const num = parseFloat(newValue);
      this.value = Math.min(this.max, Math.max(this.min, num));
    },

    increment(amount) {
      const step = amount || this.step;
      this.updateValue(this.value + step);
    },

    decrement(amount) {
      const step = amount || this.step;
      this.updateValue(this.value - step);
    },

    setMin() {
      this.value = this.min;
    },

    setMax() {
      this.value = this.max;
    },

    reset() {
      this.value = config.value ?? 50;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxRange', rangeComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxRange', rangeComponent);
    });
  }

  // Alpine component for dual range
  const dualRangeComponent = (config = {}) => ({
    minValue: config.minValue ?? 20,
    maxValue: config.maxValue ?? 80,
    min: config.min ?? 0,
    max: config.max ?? 100,
    step: config.step ?? 1,
    minGap: config.minGap ?? 10,
    disabled: config.disabled || false,

    get minPercent() {
      return ((this.minValue - this.min) / (this.max - this.min)) * 100;
    },

    get maxPercent() {
      return ((this.maxValue - this.min) / (this.max - this.min)) * 100;
    },

    get fillStyle() {
      return {
        left: this.minPercent + '%',
        width: (this.maxPercent - this.minPercent) + '%'
      };
    },

    updateMin(value) {
      const num = parseFloat(value);
      const maxAllowed = this.maxValue - this.minGap;
      this.minValue = Math.min(maxAllowed, Math.max(this.min, num));
    },

    updateMax(value) {
      const num = parseFloat(value);
      const minAllowed = this.minValue + this.minGap;
      this.maxValue = Math.max(minAllowed, Math.min(this.max, num));
    },

    get range() {
      return [this.minValue, this.maxValue];
    },

    reset() {
      this.minValue = config.minValue ?? 20;
      this.maxValue = config.maxValue ?? 80;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxDualRange', dualRangeComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxDualRange', dualRangeComponent);
    });
  }
})();

/**
 * UX Rating Component
 * Star rating component with 1-5 scale
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Rating
    ======================================== */

    .ux-rating {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-rating__stars {
      display: inline-flex;
      align-items: center;
      gap: 2px;
    }

    .ux-rating__star {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      padding: 0;
      background: none;
      border: none;
      color: var(--ux-light-shade);
      cursor: pointer;
      transition:
        color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-rating__star svg {
      width: 100%;
      height: 100%;
    }

    .ux-rating__star:hover {
      transform: scale(1.15);
    }

    .ux-rating__star:active {
      transform: scale(0.95);
    }

    .ux-rating__star--filled {
      color: var(--ux-warning);
    }

    .ux-rating__star--half {
      position: relative;
      color: var(--ux-light-shade);
    }

    .ux-rating__star--half::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 50%;
      height: 100%;
      overflow: hidden;
    }

    /* Readonly state */
    .ux-rating--readonly .ux-rating__star {
      cursor: default;
      pointer-events: none;
    }

    .ux-rating--readonly .ux-rating__star:hover {
      transform: none;
    }

    /* Disabled state */
    .ux-rating--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-rating--sm .ux-rating__star {
      width: 18px;
      height: 18px;
    }

    .ux-rating--lg .ux-rating__star {
      width: 32px;
      height: 32px;
    }

    .ux-rating--xl .ux-rating__star {
      width: 40px;
      height: 40px;
    }

    /* ========================================
       Colors
    ======================================== */

    .ux-rating--primary .ux-rating__star--filled {
      color: var(--ux-primary);
    }

    .ux-rating--danger .ux-rating__star--filled {
      color: var(--ux-danger);
    }

    .ux-rating--success .ux-rating__star--filled {
      color: var(--ux-success);
    }

    /* ========================================
       Rating Value Display
    ======================================== */

    .ux-rating__value {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin-left: var(--ux-space-xs);
    }

    .ux-rating--sm .ux-rating__value {
      font-size: var(--ux-font-size-sm);
    }

    .ux-rating--lg .ux-rating__value {
      font-size: var(--ux-font-size-lg);
    }

    .ux-rating__count {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-left: var(--ux-space-xs);
    }

    /* ========================================
       Hover Preview
    ======================================== */

    .ux-rating:not(.ux-rating--readonly):not(.ux-rating--disabled) .ux-rating__star--preview {
      color: var(--ux-warning);
      opacity: 0.7;
    }

    /* ========================================
       Compact Rating (inline display)
    ======================================== */

    .ux-rating--compact {
      gap: var(--ux-space-xs);
    }

    .ux-rating--compact .ux-rating__stars {
      gap: 0;
    }

    .ux-rating--compact .ux-rating__star {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Rating with Labels
    ======================================== */

    .ux-rating__label {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-rating__label--start {
      margin-right: var(--ux-space-sm);
    }

    .ux-rating__label--end {
      margin-left: var(--ux-space-sm);
    }

    /* ========================================
       Animation
    ======================================== */

    @keyframes ux-rating-pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    .ux-rating__star--animate {
      animation: ux-rating-pop 0.3s var(--ux-ease);
    }
  `;

  // Star SVG paths
  const starFilled = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`;
  const starEmpty = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`;
  const starHalf = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><linearGradient id="half"><stop offset="50%" stop-color="currentColor"/><stop offset="50%" stop-color="transparent"/></linearGradient></defs><path fill="url(#half)" stroke="currentColor" stroke-width="2" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-rating-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-rating-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for rating
  // ARIA: role="radiogroup" for interactive, aria-label for each star
  const ratingComponent = (config = {}) => ({
    value: config.value || 0,
    max: config.max || 5,
    readonly: config.readonly || false,
    disabled: config.disabled || false,
    allowHalf: config.allowHalf || false,
    showValue: config.showValue || false,
    hoverValue: 0,
    isHovering: false,
    ratingId: config.id || 'ux-rating-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for the rating group
    get ariaAttrs() {
      return {
        'role': this.readonly ? 'img' : 'radiogroup',
        'aria-label': `Rating: ${this.value} out of ${this.max} stars`,
        'aria-valuenow': this.value,
        'aria-valuemin': 0,
        'aria-valuemax': this.max
      };
    },

    // ARIA attributes for each star
    getStarAriaAttrs(index) {
      const starValue = index + 1;
      return {
        'role': this.readonly ? 'presentation' : 'radio',
        'aria-checked': this.value >= starValue ? 'true' : 'false',
        'aria-label': `${starValue} star${starValue > 1 ? 's' : ''}`,
        'tabindex': this.readonly || this.disabled ? '-1' : (this.value === starValue ? '0' : '-1')
      };
    },

    // Get star SVG based on value
    getStarSvg(index) {
      const starValue = index + 1;
      const displayValue = this.isHovering && !this.readonly ? this.hoverValue : this.value;

      if (displayValue >= starValue) {
        return starFilled;
      } else if (this.allowHalf && displayValue >= starValue - 0.5) {
        return starHalf;
      }
      return starEmpty;
    },

    // Check if star is filled
    isStarFilled(index) {
      const starValue = index + 1;
      const displayValue = this.isHovering && !this.readonly ? this.hoverValue : this.value;
      return displayValue >= starValue;
    },

    // Check if star is half filled
    isStarHalf(index) {
      const starValue = index + 1;
      const displayValue = this.isHovering && !this.readonly ? this.hoverValue : this.value;
      return this.allowHalf && displayValue >= starValue - 0.5 && displayValue < starValue;
    },

    // Handle star click
    setRating(index, event) {
      if (this.readonly || this.disabled) return;

      let newValue = index + 1;

      // Support half stars on click
      if (this.allowHalf && event) {
        const rect = event.currentTarget.getBoundingClientRect();
        const x = event.clientX - rect.left;
        if (x < rect.width / 2) {
          newValue = index + 0.5;
        }
      }

      // Toggle off if clicking same value
      if (this.value === newValue) {
        this.value = 0;
      } else {
        this.value = newValue;
      }

      // Dispatch change event
      this.$dispatch('rating-change', { value: this.value });
    },

    // Handle hover
    onStarHover(index, event) {
      if (this.readonly || this.disabled) return;
      this.isHovering = true;

      let hoverVal = index + 1;

      if (this.allowHalf && event) {
        const rect = event.currentTarget.getBoundingClientRect();
        const x = event.clientX - rect.left;
        if (x < rect.width / 2) {
          hoverVal = index + 0.5;
        }
      }

      this.hoverValue = hoverVal;
    },

    // Handle mouse leave
    onMouseLeave() {
      this.isHovering = false;
      this.hoverValue = 0;
    },

    // Handle keyboard navigation
    handleKeydown(event, index) {
      if (this.readonly || this.disabled) return;

      let newValue = this.value;

      switch (event.key) {
        case 'ArrowRight':
        case 'ArrowUp':
          event.preventDefault();
          newValue = Math.min(this.max, this.value + (this.allowHalf ? 0.5 : 1));
          break;
        case 'ArrowLeft':
        case 'ArrowDown':
          event.preventDefault();
          newValue = Math.max(0, this.value - (this.allowHalf ? 0.5 : 1));
          break;
        case 'Home':
          event.preventDefault();
          newValue = 0;
          break;
        case 'End':
          event.preventDefault();
          newValue = this.max;
          break;
        case 'Enter':
        case ' ':
          event.preventDefault();
          this.setRating(index, null);
          return;
      }

      if (newValue !== this.value) {
        this.value = newValue;
        this.$dispatch('rating-change', { value: this.value });
      }
    },

    // Get array of star indices
    get stars() {
      return Array.from({ length: this.max }, (_, i) => i);
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxRating', ratingComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxRating', ratingComponent);
    });
  }
})();

/**
 * UX Receipt Preview Component
 * Thermal receipt format for POS systems
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Receipt Container
       ========================================================================== */

    .ux-receipt {
      font-family: 'Courier New', Courier, monospace;
      font-size: 12px;
      line-height: 1.4;
      color: #000;
      background: #fff;
      width: 280px;
      padding: 16px 12px;
      margin: 0 auto;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    /* Print-ready: no shadows */
    @media print {
      .ux-receipt {
        box-shadow: none;
        margin: 0;
        padding: 8px;
      }
    }

    /* ==========================================================================
       Receipt Header
       ========================================================================== */

    .ux-receipt__header {
      text-align: center;
      padding-bottom: 12px;
      border-bottom: 1px dashed #ccc;
      margin-bottom: 12px;
    }

    .ux-receipt__logo {
      max-width: 120px;
      max-height: 60px;
      margin: 0 auto 8px;
    }

    .ux-receipt__logo img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .ux-receipt__company {
      font-size: 16px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }

    .ux-receipt__address,
    .ux-receipt__phone,
    .ux-receipt__tax-id {
      font-size: 11px;
      color: #333;
      margin: 2px 0;
    }

    /* ==========================================================================
       Receipt Info
       ========================================================================== */

    .ux-receipt__info {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 4px 16px;
      padding-bottom: 12px;
      border-bottom: 1px dashed #ccc;
      margin-bottom: 12px;
      font-size: 11px;
    }

    .ux-receipt__info-item {
      display: flex;
      gap: 4px;
    }

    .ux-receipt__info-label {
      color: #666;
    }

    .ux-receipt__info-value {
      font-weight: 600;
    }

    /* ==========================================================================
       Receipt Items
       ========================================================================== */

    .ux-receipt__items {
      padding-bottom: 12px;
      border-bottom: 1px dashed #ccc;
      margin-bottom: 12px;
    }

    .ux-receipt__items-header {
      display: flex;
      justify-content: space-between;
      padding-bottom: 4px;
      margin-bottom: 8px;
      border-bottom: 1px solid #eee;
      font-size: 10px;
      font-weight: bold;
      text-transform: uppercase;
      color: #666;
    }

    .ux-receipt__item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
      padding: 4px 0;
    }

    .ux-receipt__item-name {
      flex: 1;
      min-width: 0;
      word-wrap: break-word;
    }

    .ux-receipt__item-qty {
      flex-shrink: 0;
      width: 30px;
      text-align: center;
      color: #666;
    }

    .ux-receipt__item-price {
      flex-shrink: 0;
      width: 60px;
      text-align: right;
    }

    .ux-receipt__item-total {
      flex-shrink: 0;
      width: 70px;
      text-align: right;
      font-weight: 600;
    }

    .ux-receipt__item--discount {
      color: #c00;
      font-size: 11px;
    }

    .ux-receipt__item--discount .ux-receipt__item-name {
      padding-left: 8px;
    }

    /* ==========================================================================
       Receipt Totals
       ========================================================================== */

    .ux-receipt__totals {
      padding-bottom: 12px;
      border-bottom: 1px dashed #ccc;
      margin-bottom: 12px;
    }

    .ux-receipt__total-row {
      display: flex;
      justify-content: space-between;
      padding: 2px 0;
    }

    .ux-receipt__total-label {
      color: #666;
    }

    .ux-receipt__total-value {
      font-weight: 500;
      text-align: right;
    }

    .ux-receipt__total-row--subtotal {
      padding-top: 4px;
    }

    .ux-receipt__total-row--grand {
      font-size: 16px;
      font-weight: bold;
      padding-top: 8px;
      margin-top: 8px;
      border-top: 2px solid #000;
    }

    .ux-receipt__total-row--grand .ux-receipt__total-value {
      font-size: 18px;
    }

    /* ==========================================================================
       Receipt Payment
       ========================================================================== */

    .ux-receipt__payment {
      padding-bottom: 12px;
      border-bottom: 1px dashed #ccc;
      margin-bottom: 12px;
    }

    .ux-receipt__payment-title {
      font-size: 10px;
      font-weight: bold;
      text-transform: uppercase;
      color: #666;
      margin-bottom: 4px;
    }

    .ux-receipt__payment-row {
      display: flex;
      justify-content: space-between;
      padding: 2px 0;
    }

    .ux-receipt__payment-method {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .ux-receipt__payment-icon {
      width: 14px;
      height: 14px;
    }

    .ux-receipt__change {
      font-size: 14px;
      font-weight: bold;
      padding-top: 4px;
      margin-top: 4px;
      border-top: 1px solid #eee;
    }

    /* ==========================================================================
       Receipt Footer
       ========================================================================== */

    .ux-receipt__footer {
      text-align: center;
      font-size: 11px;
      color: #666;
    }

    .ux-receipt__thanks {
      font-size: 14px;
      font-weight: bold;
      color: #000;
      margin-bottom: 8px;
    }

    .ux-receipt__message {
      margin: 8px 0;
      font-style: italic;
    }

    .ux-receipt__social {
      margin-top: 8px;
    }

    /* ==========================================================================
       Receipt QR Code
       ========================================================================== */

    .ux-receipt__qr {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 0;
      border-top: 1px dashed #ccc;
      margin-top: 12px;
    }

    .ux-receipt__qr-code {
      width: 80px;
      height: 80px;
      margin-bottom: 4px;
    }

    .ux-receipt__qr-code img,
    .ux-receipt__qr-code svg {
      width: 100%;
      height: 100%;
    }

    .ux-receipt__qr-label {
      font-size: 10px;
      color: #666;
    }

    /* ==========================================================================
       Receipt Barcode
       ========================================================================== */

    .ux-receipt__barcode {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 0;
      border-top: 1px dashed #ccc;
      margin-top: 12px;
    }

    .ux-receipt__barcode-image {
      max-width: 200px;
      height: 40px;
      margin-bottom: 4px;
    }

    .ux-receipt__barcode-image img,
    .ux-receipt__barcode-image svg {
      width: 100%;
      height: 100%;
    }

    .ux-receipt__barcode-number {
      font-size: 10px;
      letter-spacing: 2px;
    }

    /* ==========================================================================
       Receipt Divider
       ========================================================================== */

    .ux-receipt__divider {
      border: none;
      border-top: 1px dashed #ccc;
      margin: 12px 0;
    }

    .ux-receipt__divider--double {
      border-top-width: 2px;
      border-top-style: double;
      border-color: #000;
    }

    /* ==========================================================================
       Receipt Copy Indicator
       ========================================================================== */

    .ux-receipt__copy {
      text-align: center;
      font-size: 10px;
      font-weight: bold;
      text-transform: uppercase;
      color: #999;
      padding: 8px 0;
      border: 1px dashed #ccc;
      margin-top: 12px;
    }

    /* ==========================================================================
       Receipt Sizes
       ========================================================================== */

    .ux-receipt--58mm {
      width: 200px;
      font-size: 10px;
    }

    .ux-receipt--58mm .ux-receipt__company {
      font-size: 14px;
    }

    .ux-receipt--58mm .ux-receipt__total-row--grand {
      font-size: 14px;
    }

    .ux-receipt--58mm .ux-receipt__total-row--grand .ux-receipt__total-value {
      font-size: 16px;
    }

    .ux-receipt--80mm {
      width: 280px;
    }

    .ux-receipt--a4 {
      width: 100%;
      max-width: 500px;
      font-size: 14px;
      padding: 24px;
    }

    .ux-receipt--a4 .ux-receipt__company {
      font-size: 20px;
    }

    .ux-receipt--a4 .ux-receipt__total-row--grand {
      font-size: 18px;
    }

    /* ==========================================================================
       Receipt Preview Wrapper
       ========================================================================== */

    .ux-receipt-preview {
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-lg);
      padding: var(--ux-space-lg);
      overflow: auto;
    }

    .ux-receipt-preview__toolbar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
      margin-bottom: var(--ux-space-lg);
    }

    /* ==========================================================================
       Print Styles
       ========================================================================== */

    @media print {
      .ux-receipt-preview {
        background: none;
        padding: 0;
      }

      .ux-receipt-preview__toolbar {
        display: none;
      }

      .ux-receipt {
        width: auto;
        max-width: none;
      }

      body * {
        visibility: hidden;
      }

      .ux-receipt,
      .ux-receipt * {
        visibility: visible;
      }

      .ux-receipt {
        position: absolute;
        left: 0;
        top: 0;
      }
    }

    /* ==========================================================================
       Dark Mode (preview only, receipt always white)
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      .ux-receipt-preview {
        background: var(--ux-surface-secondary);
      }
    }

    .ux-dark .ux-receipt-preview {
      background: var(--ux-surface-secondary);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-receipt-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-receipt-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const receiptData = (options = {}) => ({
    // Company info
    company: {
      name: options.companyName || 'Mi Empresa',
      address: options.companyAddress || '',
      phone: options.companyPhone || '',
      taxId: options.companyTaxId || '',
      logo: options.companyLogo || null,
      ...options.company
    },

    // Receipt info
    receipt: {
      number: options.receiptNumber || '',
      date: options.receiptDate || new Date().toLocaleDateString('es-ES'),
      time: options.receiptTime || new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }),
      cashier: options.cashier || '',
      terminal: options.terminal || '',
      ...options.receipt
    },

    // Items
    items: options.items || [],

    // Totals
    subtotal: options.subtotal || 0,
    discount: options.discount || 0,
    discountLabel: options.discountLabel || 'Descuento',
    tax: options.tax || 0,
    taxLabel: options.taxLabel || 'IVA',
    taxRate: options.taxRate || null,
    total: options.total || 0,

    // Payment
    payments: options.payments || [],
    change: options.change || 0,

    // Footer
    footer: {
      thanks: options.thanksMessage || 'Gracias por su compra',
      message: options.footerMessage || '',
      social: options.socialMedia || '',
      ...options.footer
    },

    // QR/Barcode
    qrCode: options.qrCode || null,
    qrLabel: options.qrLabel || 'Escanea para ver factura',
    barcode: options.barcode || null,
    barcodeNumber: options.barcodeNumber || '',

    // Options
    size: options.size || '80mm', // '58mm', '80mm', 'a4'
    showHeader: options.showHeader ?? true,
    showItemsHeader: options.showItemsHeader ?? true,
    showTax: options.showTax ?? true,
    showPayment: options.showPayment ?? true,
    showFooter: options.showFooter ?? true,
    showQR: options.showQR ?? false,
    showBarcode: options.showBarcode ?? false,
    copyType: options.copyType || null, // 'customer', 'merchant', null

    // Currency
    currency: options.currency || 'â¬',
    currencyPosition: options.currencyPosition || 'after', // 'before' or 'after'

    // Format price
    formatPrice(amount) {
      const formatted = parseFloat(amount).toFixed(2);
      if (this.currencyPosition === 'before') {
        return `${this.currency}${formatted}`;
      }
      return `${formatted}${this.currency}`;
    },

    // Calculate totals
    calculateSubtotal() {
      return this.items.reduce((sum, item) => {
        const itemTotal = (item.price || 0) * (item.qty || 1);
        const itemDiscount = item.discount || 0;
        return sum + itemTotal - itemDiscount;
      }, 0);
    },

    calculateTotal() {
      const subtotal = this.subtotal || this.calculateSubtotal();
      const afterDiscount = subtotal - (this.discount || 0);
      const afterTax = afterDiscount + (this.tax || 0);
      return afterTax;
    },

    // Print receipt
    print() {
      window.print();
      this.$dispatch('receipt:print');
    },

    // Download as image (requires html2canvas)
    async downloadImage() {
      if (typeof html2canvas === 'undefined') {
        console.error('html2canvas is required for image download');
        return;
      }

      const receiptEl = this.$el.querySelector('.ux-receipt');
      if (!receiptEl) return;

      try {
        const canvas = await html2canvas(receiptEl, {
          scale: 2,
          backgroundColor: '#ffffff'
        });

        const link = document.createElement('a');
        link.download = `receipt-${this.receipt.number || Date.now()}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();

        this.$dispatch('receipt:download', { format: 'image' });
      } catch (error) {
        console.error('Error generating image:', error);
      }
    },

    // Get receipt data as JSON
    getData() {
      return {
        company: this.company,
        receipt: this.receipt,
        items: this.items,
        subtotal: this.subtotal,
        discount: this.discount,
        tax: this.tax,
        total: this.total,
        payments: this.payments,
        change: this.change
      };
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxReceipt', receiptData);
  }
})();

/**
 * UX Refresher Component
 * Pull-to-refresh estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Refresher
    ======================================== */

    .ux-refresher {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 60px;
      transform: translateY(-100%);
      transition: transform var(--ux-transition-base) var(--ux-ease);
      z-index: 10;
      pointer-events: none;
    }

    .ux-refresher--pulling {
      transform: translateY(0);
    }

    .ux-refresher--refreshing {
      transform: translateY(0);
    }

    /* ========================================
       Refresher Content
    ======================================== */

    .ux-refresher__content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    /* ========================================
       Refresher Icon (Arrow)
    ======================================== */

    .ux-refresher__icon {
      width: 24px;
      height: 24px;
      color: var(--ux-text-secondary);
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-refresher__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-refresher--pulling .ux-refresher__icon {
      transform: rotate(0deg);
    }

    .ux-refresher--ready .ux-refresher__icon {
      transform: rotate(180deg);
    }

    /* ========================================
       Refresher Spinner
    ======================================== */

    .ux-refresher__spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--ux-light);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-refresher-spin 0.8s linear infinite;
    }

    @keyframes ux-refresher-spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* iOS-style spinner */
    .ux-refresher__spinner--ios {
      position: relative;
      width: 24px;
      height: 24px;
      border: none;
      animation: none;
    }

    .ux-refresher__spinner--ios::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      width: 2px;
      height: 6px;
      background-color: var(--ux-text-secondary);
      border-radius: 1px;
      transform-origin: center 12px;
      animation: ux-refresher-ios-spin 1s steps(8) infinite;
    }

    @keyframes ux-refresher-ios-spin {
      from {
        transform: translateX(-50%) rotate(0deg);
      }
      to {
        transform: translateX(-50%) rotate(360deg);
      }
    }

    /* ========================================
       Refresher Text
    ======================================== */

    .ux-refresher__text {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Refresher Progress Circle
    ======================================== */

    .ux-refresher__progress {
      width: 28px;
      height: 28px;
    }

    .ux-refresher__progress-circle {
      fill: none;
      stroke: var(--ux-primary);
      stroke-width: 2;
      stroke-linecap: round;
      transform: rotate(-90deg);
      transform-origin: center;
    }

    /* ========================================
       Pull Content Container
    ======================================== */

    .ux-refresher-content {
      position: relative;
      transform: translateY(0);
      transition: transform var(--ux-transition-base) var(--ux-ease);
      will-change: transform;
    }

    .ux-refresher-content--pulling {
      transition: none;
    }

    .ux-refresher-content--refreshing {
      transform: translateY(60px);
    }

    /* ========================================
       Backdrop (optional visual feedback)
    ======================================== */

    .ux-refresher__backdrop {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      background: linear-gradient(
        to bottom,
        rgba(var(--ux-primary-rgb), 0.05) 0%,
        transparent 100%
      );
      opacity: 0;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
      pointer-events: none;
    }

    .ux-refresher--pulling .ux-refresher__backdrop {
      opacity: 1;
    }

    /* ========================================
       Success/Complete State
    ======================================== */

    .ux-refresher--complete .ux-refresher__content {
      color: var(--ux-success);
    }

    .ux-refresher__check {
      width: 24px;
      height: 24px;
      color: var(--ux-success);
      animation: ux-refresher-check 0.3s var(--ux-ease-spring);
    }

    .ux-refresher__check svg {
      width: 100%;
      height: 100%;
    }

    @keyframes ux-refresher-check {
      0% {
        transform: scale(0);
      }
      50% {
        transform: scale(1.2);
      }
      100% {
        transform: scale(1);
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-refresher-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-refresher-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for refresher
  const refresherComponent = (config = {}) => ({
    state: 'idle', // idle, pulling, ready, refreshing, complete
    pullDistance: 0,
    startY: 0,
    threshold: config.threshold || 80,
    maxPull: config.maxPull || 120,
    disabled: config.disabled || false,
    snapback: config.snapback !== false,

    get progress() {
      return Math.min(1, this.pullDistance / this.threshold);
    },

    get progressDegrees() {
      return this.progress * 360;
    },

    get isPulling() {
      return this.state === 'pulling';
    },

    get isReady() {
      return this.state === 'ready';
    },

    get isRefreshing() {
      return this.state === 'refreshing';
    },

    get isComplete() {
      return this.state === 'complete';
    },

    get contentStyle() {
      if (this.state === 'pulling' || this.state === 'ready') {
        return { transform: `translateY(${this.pullDistance}px)` };
      }
      if (this.state === 'refreshing') {
        return { transform: `translateY(60px)` };
      }
      return {};
    },

    handleTouchStart(event) {
      if (this.disabled || this.state === 'refreshing') return;

      const scrollTop = this.$refs.content?.scrollTop || 0;
      if (scrollTop > 0) return;

      this.startY = event.touches[0].clientY;
    },

    handleTouchMove(event) {
      if (this.disabled || this.state === 'refreshing' || this.startY === 0) return;

      const scrollTop = this.$refs.content?.scrollTop || 0;
      if (scrollTop > 0) {
        this.startY = 0;
        return;
      }

      const currentY = event.touches[0].clientY;
      const diff = currentY - this.startY;

      if (diff > 0) {
        event.preventDefault();

        // Apply resistance
        this.pullDistance = Math.min(this.maxPull, diff * 0.5);

        if (this.pullDistance >= this.threshold) {
          this.state = 'ready';
        } else {
          this.state = 'pulling';
        }
      }
    },

    handleTouchEnd() {
      if (this.disabled || this.startY === 0) return;

      this.startY = 0;

      if (this.state === 'ready') {
        this.state = 'refreshing';
        this.pullDistance = 0;
        // Trigger refresh event - parent should handle actual refresh
      } else {
        this.reset();
      }
    },

    async doRefresh() {
      // This should be called by the parent after handling the refresh
      this.state = 'complete';
      await new Promise(resolve => setTimeout(resolve, 500));
      this.reset();
    },

    complete() {
      this.state = 'complete';
      setTimeout(() => {
        this.reset();
      }, 500);
    },

    cancel() {
      this.reset();
    },

    reset() {
      this.state = 'idle';
      this.pullDistance = 0;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxRefresher', refresherComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxRefresher', refresherComponent);
    });
  }
})();

/**
 * UX Reorder Component
 * Drag-to-reorder para listas
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Reorder Group
    ======================================== */

    .ux-reorder-group {
      position: relative;
      user-select: none;
      -webkit-user-select: none;
    }

    .ux-reorder-group--disabled {
      pointer-events: none;
    }

    /* ========================================
       Reorder Item
    ======================================== */

    .ux-reorder-item {
      position: relative;
      display: flex;
      align-items: center;
      background-color: var(--ux-surface);
      transition:
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease),
        opacity var(--ux-transition-fast) var(--ux-ease);
      will-change: transform;
    }

    .ux-reorder-item--dragging {
      z-index: 100;
      box-shadow: var(--ux-shadow-xl);
      transform: scale(1.02);
      opacity: 0.9;
    }

    .ux-reorder-item--ghost {
      opacity: 0.3;
    }

    /* ========================================
       Reorder Handle
    ======================================== */

    .ux-reorder-handle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-touch-target);
      height: var(--ux-touch-target);
      padding: var(--ux-space-md);
      color: var(--ux-text-tertiary);
      cursor: grab;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-reorder-handle:active {
      cursor: grabbing;
    }

    .ux-reorder-item--disabled .ux-reorder-handle {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .ux-reorder-handle__icon {
      width: 20px;
      height: 20px;
    }

    .ux-reorder-handle__icon svg {
      width: 100%;
      height: 100%;
    }

    /* Handle lines pattern */
    .ux-reorder-handle--lines {
      flex-direction: column;
      gap: 3px;
    }

    .ux-reorder-handle__line {
      width: 16px;
      height: 2px;
      background-color: var(--ux-text-tertiary);
      border-radius: 1px;
    }

    /* ========================================
       Drop Indicator
    ======================================== */

    .ux-reorder-indicator {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--ux-primary);
      transform: scaleX(0);
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-reorder-indicator--top {
      top: -1px;
    }

    .ux-reorder-indicator--bottom {
      bottom: -1px;
    }

    .ux-reorder-indicator--active {
      transform: scaleX(1);
    }

    /* ========================================
       Reorder Item Content
    ======================================== */

    .ux-reorder-item__content {
      flex: 1;
      min-width: 0;
    }

    /* ========================================
       Reorder Animations
    ======================================== */

    .ux-reorder-item--moving-up {
      animation: ux-reorder-move-up var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-reorder-item--moving-down {
      animation: ux-reorder-move-down var(--ux-transition-fast) var(--ux-ease);
    }

    @keyframes ux-reorder-move-up {
      from {
        transform: translateY(100%);
      }
      to {
        transform: translateY(0);
      }
    }

    @keyframes ux-reorder-move-down {
      from {
        transform: translateY(-100%);
      }
      to {
        transform: translateY(0);
      }
    }

    /* ========================================
       Reorder Group Variants
    ======================================== */

    /* Inset */
    .ux-reorder-group--inset {
      margin: var(--ux-space-lg);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
      background-color: var(--ux-surface);
    }

    .ux-reorder-group--inset .ux-reorder-item {
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-reorder-group--inset .ux-reorder-item:last-child {
      border-bottom: none;
    }

    /* Cards */
    .ux-reorder-group--cards .ux-reorder-item {
      margin-bottom: var(--ux-space-sm);
      border-radius: var(--ux-border-radius);
      box-shadow: var(--ux-shadow-sm);
    }

    .ux-reorder-group--cards .ux-reorder-item--dragging {
      box-shadow: var(--ux-shadow-xl);
    }

    /* ========================================
       Edit Mode Styles
    ======================================== */

    .ux-reorder-group--editing .ux-reorder-item {
      padding-left: 0;
    }

    .ux-reorder-group:not(.ux-reorder-group--editing) .ux-reorder-handle {
      display: none;
    }

    /* Show handles with animation */
    .ux-reorder-group--editing .ux-reorder-handle {
      animation: ux-reorder-handle-appear 0.3s var(--ux-ease);
    }

    @keyframes ux-reorder-handle-appear {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* ========================================
       Horizontal Reorder
    ======================================== */

    .ux-reorder-group--horizontal {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-sm);
    }

    .ux-reorder-group--horizontal .ux-reorder-item {
      flex: 0 0 auto;
    }

    .ux-reorder-group--horizontal .ux-reorder-indicator {
      width: 2px;
      height: auto;
      top: 0;
      bottom: 0;
    }

    .ux-reorder-group--horizontal .ux-reorder-indicator--left {
      left: -1px;
      right: auto;
    }

    .ux-reorder-group--horizontal .ux-reorder-indicator--right {
      right: -1px;
      left: auto;
    }

    /* ========================================
       Delete Button (iOS style)
    ======================================== */

    .ux-reorder-delete {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 0;
      height: 100%;
      background-color: var(--ux-danger);
      color: white;
      border: none;
      cursor: pointer;
      overflow: hidden;
      transition: width var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-reorder-group--editing .ux-reorder-delete {
      width: var(--ux-touch-target);
    }

    .ux-reorder-delete__icon {
      width: 20px;
      height: 20px;
    }

    .ux-reorder-delete__icon svg {
      width: 100%;
      height: 100%;
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-reorder-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-reorder-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for reorder group
  const reorderComponent = (config = {}) => ({
    items: config.items || [],
    editing: config.editing || false,
    disabled: config.disabled || false,
    draggingIndex: null,
    dragOverIndex: null,
    startY: 0,
    currentY: 0,

    get isEditing() {
      return this.editing;
    },

    toggleEdit() {
      this.editing = !this.editing;
    },

    startEdit() {
      this.editing = true;
    },

    endEdit() {
      this.editing = false;
    },

    handleDragStart(event, index) {
      if (this.disabled || !this.editing) return;

      this.draggingIndex = index;
      this.startY = event.type === 'touchstart'
        ? event.touches[0].clientY
        : event.clientY;

      // Set drag data for HTML5 drag
      if (event.dataTransfer) {
        event.dataTransfer.effectAllowed = 'move';
        event.dataTransfer.setData('text/plain', index);
      }
    },

    handleDragOver(event, index) {
      if (this.draggingIndex === null || this.draggingIndex === index) return;

      event.preventDefault();
      if (event.dataTransfer) {
        event.dataTransfer.dropEffect = 'move';
      }

      this.dragOverIndex = index;
    },

    handleDragEnd() {
      if (this.draggingIndex !== null && this.dragOverIndex !== null) {
        this.moveItem(this.draggingIndex, this.dragOverIndex);
      }

      this.draggingIndex = null;
      this.dragOverIndex = null;
    },

    handleTouchStart(event, index) {
      if (this.disabled || !this.editing) return;

      this.draggingIndex = index;
      this.startY = event.touches[0].clientY;
    },

    handleTouchMove(event, index) {
      if (this.draggingIndex === null) return;

      event.preventDefault();
      this.currentY = event.touches[0].clientY;

      // Find which item we're over
      const items = this.$refs.items?.children || [];
      for (let i = 0; i < items.length; i++) {
        const rect = items[i].getBoundingClientRect();
        if (this.currentY >= rect.top && this.currentY <= rect.bottom) {
          this.dragOverIndex = i;
          break;
        }
      }
    },

    handleTouchEnd() {
      this.handleDragEnd();
    },

    moveItem(fromIndex, toIndex) {
      if (fromIndex === toIndex) return;

      const item = this.items[fromIndex];
      this.items.splice(fromIndex, 1);
      this.items.splice(toIndex, 0, item);
    },

    removeItem(index) {
      this.items.splice(index, 1);
    },

    isDragging(index) {
      return this.draggingIndex === index;
    },

    isDragOver(index) {
      return this.dragOverIndex === index && this.draggingIndex !== index;
    },

    getItemStyle(index) {
      if (this.isDragging(index)) {
        const offset = this.currentY - this.startY;
        return {
          transform: `translateY(${offset}px)`,
          zIndex: 100
        };
      }
      return {};
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxReorder', reorderComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxReorder', reorderComponent);
    });
  }
})();

/**
 * UX Rich Text Editor Component
 * WYSIWYG editor with formatting toolbar
 * @requires ux-core.js
 * @requires Alpine.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       CSS Variables
    ======================================== */

    :root {
      --ux-rich-text-min-height: 200px;
      --ux-rich-text-max-height: none;
      --ux-rich-text-border-radius: var(--ux-border-radius);
      --ux-rich-text-toolbar-bg: var(--ux-surface-secondary);
      --ux-rich-text-toolbar-btn-size: 44px;
      --ux-rich-text-toolbar-btn-size-sm: 36px;
      --ux-rich-text-content-padding: var(--ux-space-lg);
      --ux-rich-text-font-size: 16px;
    }

    /* ========================================
       Container
    ======================================== */

    .ux-rich-text {
      display: flex;
      flex-direction: column;
      width: 100%;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-rich-text-border-radius);
      overflow: hidden;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-rich-text:focus-within {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    /* ========================================
       Toolbar
    ======================================== */

    .ux-rich-text__toolbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background-color: var(--ux-rich-text-toolbar-bg);
      border-bottom: 1px solid var(--ux-border-color);
      min-height: 52px;
    }

    .ux-rich-text__toolbar-group {
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .ux-rich-text__toolbar-divider {
      width: 1px;
      height: 24px;
      background-color: var(--ux-border-color);
      margin: 0 var(--ux-space-sm);
      flex-shrink: 0;
    }

    /* ========================================
       Toolbar Buttons
    ======================================== */

    .ux-rich-text__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: var(--ux-rich-text-toolbar-btn-size);
      min-height: var(--ux-rich-text-toolbar-btn-size);
      padding: var(--ux-space-xs);
      background: transparent;
      border: none;
      border-radius: var(--ux-border-radius-sm);
      color: var(--ux-text-secondary);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-rich-text__btn:hover {
      background-color: var(--ux-light);
      color: var(--ux-text);
    }

    .ux-rich-text__btn:active {
      background-color: var(--ux-light-shade);
    }

    .ux-rich-text__btn--active {
      background-color: rgba(var(--ux-primary-rgb), 0.15);
      color: var(--ux-primary);
    }

    .ux-rich-text__btn--active:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.2);
      color: var(--ux-primary);
    }

    .ux-rich-text__btn:disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    .ux-rich-text__btn svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Dropdown button */
    .ux-rich-text__btn--dropdown {
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
    }

    .ux-rich-text__btn--dropdown svg:last-child {
      width: 12px;
      height: 12px;
    }

    /* ========================================
       Dropdown Menu
    ======================================== */

    .ux-rich-text__dropdown {
      position: relative;
    }

    .ux-rich-text__dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      z-index: var(--ux-z-dropdown);
      min-width: 150px;
      margin-top: var(--ux-space-xs);
      padding: var(--ux-space-xs);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      box-shadow: var(--ux-shadow-lg);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        visibility var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-rich-text__dropdown-menu--open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-rich-text__dropdown-item {
      display: block;
      width: 100%;
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: none;
      border: none;
      border-radius: var(--ux-border-radius-sm);
      text-align: left;
      color: var(--ux-text);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-rich-text__dropdown-item:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-rich-text__dropdown-item--h1 {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .ux-rich-text__dropdown-item--h2 {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .ux-rich-text__dropdown-item--h3 {
      font-size: 1.1rem;
      font-weight: 600;
    }

    /* ========================================
       Editor Content Area
    ======================================== */

    .ux-rich-text__editor {
      flex: 1;
      min-height: var(--ux-rich-text-min-height);
      max-height: var(--ux-rich-text-max-height);
      padding: var(--ux-rich-text-content-padding);
      font-family: var(--ux-font-family);
      font-size: var(--ux-rich-text-font-size);
      line-height: 1.6;
      color: var(--ux-text);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      outline: none;
    }

    .ux-rich-text__editor:empty::before {
      content: attr(data-placeholder);
      color: var(--ux-text-tertiary);
      pointer-events: none;
    }

    /* Editor content styles */
    .ux-rich-text__editor h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin: 0 0 var(--ux-space-md);
      line-height: 1.3;
    }

    .ux-rich-text__editor h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0 0 var(--ux-space-md);
      line-height: 1.3;
    }

    .ux-rich-text__editor h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0 0 var(--ux-space-md);
      line-height: 1.3;
    }

    .ux-rich-text__editor p {
      margin: 0 0 var(--ux-space-md);
    }

    .ux-rich-text__editor p:last-child {
      margin-bottom: 0;
    }

    .ux-rich-text__editor ul,
    .ux-rich-text__editor ol {
      margin: 0 0 var(--ux-space-md);
      padding-left: var(--ux-space-xl);
    }

    .ux-rich-text__editor li {
      margin-bottom: var(--ux-space-xs);
    }

    .ux-rich-text__editor a {
      color: var(--ux-primary);
      text-decoration: underline;
    }

    .ux-rich-text__editor img {
      max-width: 100%;
      height: auto;
      border-radius: var(--ux-border-radius);
      margin: var(--ux-space-md) 0;
    }

    .ux-rich-text__editor blockquote {
      margin: 0 0 var(--ux-space-md);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface-secondary);
      border-left: 4px solid var(--ux-primary);
      border-radius: 0 var(--ux-border-radius) var(--ux-border-radius) 0;
    }

    .ux-rich-text__editor code {
      padding: 2px 6px;
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius-sm);
      font-family: var(--ux-font-family-mono, monospace);
      font-size: 0.9em;
    }

    .ux-rich-text__editor pre {
      margin: 0 0 var(--ux-space-md);
      padding: var(--ux-space-md);
      background-color: var(--ux-gray-900);
      border-radius: var(--ux-border-radius);
      overflow-x: auto;
    }

    .ux-rich-text__editor pre code {
      padding: 0;
      background: none;
      color: var(--ux-gray-100);
    }

    .ux-rich-text__editor hr {
      margin: var(--ux-space-lg) 0;
      border: none;
      border-top: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Source View (HTML)
    ======================================== */

    .ux-rich-text__source {
      display: none;
      flex: 1;
      min-height: var(--ux-rich-text-min-height);
      max-height: var(--ux-rich-text-max-height);
      padding: var(--ux-rich-text-content-padding);
      font-family: var(--ux-font-family-mono, monospace);
      font-size: 14px;
      line-height: 1.5;
      color: var(--ux-text);
      background-color: var(--ux-surface);
      border: none;
      resize: none;
      outline: none;
      overflow-y: auto;
    }

    .ux-rich-text--source-view .ux-rich-text__editor {
      display: none;
    }

    .ux-rich-text--source-view .ux-rich-text__source {
      display: block;
    }

    /* ========================================
       Footer (Counter)
    ======================================== */

    .ux-rich-text__footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--ux-space-sm) var(--ux-space-md);
      background-color: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    .ux-rich-text__counter {
      display: flex;
      gap: var(--ux-space-md);
    }

    .ux-rich-text__counter span {
      white-space: nowrap;
    }

    /* ========================================
       States
    ======================================== */

    /* Error */
    .ux-rich-text--error {
      border-color: var(--ux-danger);
    }

    .ux-rich-text--error:focus-within {
      box-shadow: 0 0 0 3px rgba(var(--ux-danger-rgb), 0.15);
    }

    /* Disabled */
    .ux-rich-text--disabled {
      opacity: 0.6;
      pointer-events: none;
    }

    .ux-rich-text--disabled .ux-rich-text__editor {
      background-color: var(--ux-light);
    }

    /* Read-only */
    .ux-rich-text--readonly .ux-rich-text__toolbar {
      display: none;
    }

    .ux-rich-text--readonly .ux-rich-text__editor {
      background-color: var(--ux-light);
    }

    .ux-rich-text--readonly .ux-rich-text__footer {
      display: none;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-rich-text--sm {
      --ux-rich-text-min-height: 120px;
      --ux-rich-text-toolbar-btn-size: 36px;
      --ux-rich-text-content-padding: var(--ux-space-md);
      --ux-rich-text-font-size: 14px;
    }

    .ux-rich-text--sm .ux-rich-text__btn svg {
      width: 18px;
      height: 18px;
    }

    .ux-rich-text--lg {
      --ux-rich-text-min-height: 300px;
      --ux-rich-text-content-padding: var(--ux-space-xl);
      --ux-rich-text-font-size: 18px;
    }

    /* ========================================
       Compact Toolbar (mobile)
    ======================================== */

    @media (max-width: 767px) {
      .ux-rich-text__toolbar {
        overflow-x: auto;
        flex-wrap: nowrap;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }

      .ux-rich-text__toolbar::-webkit-scrollbar {
        display: none;
      }

      .ux-rich-text__toolbar-group {
        flex-shrink: 0;
      }
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    .ux-rich-text--glass {
      background: var(--ux-glass-bg);
      border: 0.5px solid var(--ux-glass-border);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
    }

    .ux-rich-text--glass:focus-within {
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }

    .ux-rich-text--glass .ux-rich-text__toolbar {
      background: var(--ux-glass-bg-thin);
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-rich-text--glass .ux-rich-text__editor {
      background: transparent;
    }

    .ux-rich-text--glass .ux-rich-text__source {
      background: transparent;
    }

    .ux-rich-text--glass .ux-rich-text__footer {
      background: var(--ux-glass-bg-thin);
      border-top-color: var(--ux-glass-border);
    }

    .ux-rich-text--glass .ux-rich-text__btn:hover {
      background-color: var(--ux-glass-bg);
    }

    .ux-rich-text--glass .ux-rich-text__dropdown-menu {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-rich-text__toolbar {
        background-color: var(--ux-surface-secondary);
      }

      .ux-rich-text__footer {
        background-color: var(--ux-surface-secondary);
      }
    }

    .ux-dark .ux-rich-text__toolbar {
      background-color: var(--ux-surface-secondary);
    }

    .ux-dark .ux-rich-text__footer {
      background-color: var(--ux-surface-secondary);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-rich-text,
      .ux-rich-text__btn,
      .ux-rich-text__dropdown-menu {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-rich-text-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-rich-text-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // SVG Icons
  const icons = {
    bold: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"/></svg>',
    italic: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 4h-9m4 16H5M15 4L9 20"/></svg>',
    underline: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8v8a5 5 0 0010 0V8M5 21h14"/></svg>',
    strikethrough: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 4H9a4 4 0 00-1 7.874M4 12h16M8 20h7a4 4 0 001-7.874"/></svg>',
    listUl: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h.01M4 12h.01M4 18h.01M8 6h12M8 12h12M8 18h12"/></svg>',
    listOl: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h.01M4 12h.01M4 18h.01M8 6h12M8 12h12M8 18h12"/><text x="2" y="8" font-size="6" fill="currentColor">1</text><text x="2" y="14" font-size="6" fill="currentColor">2</text><text x="2" y="20" font-size="6" fill="currentColor">3</text></svg>',
    link: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>',
    image: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>',
    alignLeft: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h10M4 18h14"/></svg>',
    alignCenter: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M7 12h10M5 18h14"/></svg>',
    alignRight: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M10 12h10M6 18h14"/></svg>',
    alignJustify: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>',
    undo: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/></svg>',
    redo: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"/></svg>',
    code: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>',
    quote: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>',
    heading: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8M4 18h16"/></svg>',
    chevronDown: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>',
    unlink: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 7h3a2 2 0 012 2v6a2 2 0 01-2 2h-3M7 7H4a2 2 0 00-2 2v6a2 2 0 002 2h3M1 1l22 22"/></svg>',
    hr: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"/></svg>'
  };

  // Alpine component
  const richTextComponent = (config = {}) => ({
    // State
    content: config.content || '',
    sourceView: false,
    headingDropdownOpen: false,
    alignDropdownOpen: false,
    placeholder: config.placeholder || 'Start typing...',
    readonly: config.readonly || false,
    disabled: config.disabled || false,
    maxLength: config.maxLength || null,

    // Formatting state (updated on selection change)
    isBold: false,
    isItalic: false,
    isUnderline: false,
    isStrikethrough: false,
    isList: false,
    isOrderedList: false,
    currentHeading: 'p',
    currentAlign: 'left',

    // Counters
    charCount: 0,
    wordCount: 0,

    // Icons reference
    icons,

    init() {
      // Initialize content
      if (this.content && this.$refs.editor) {
        this.$refs.editor.innerHTML = this.content;
      }

      // Update counters
      this.updateCounters();

      // Listen for selection changes
      document.addEventListener('selectionchange', () => {
        if (this.$refs.editor && this.$refs.editor.contains(document.activeElement)) {
          this.updateFormattingState();
        }
      });

      // Close dropdowns on outside click
      document.addEventListener('click', (e) => {
        if (!this.$el.contains(e.target)) {
          this.headingDropdownOpen = false;
          this.alignDropdownOpen = false;
        }
      });
    },

    // Execute command
    exec(command, value = null) {
      if (this.readonly || this.disabled) return;

      // Focus editor if not focused
      if (document.activeElement !== this.$refs.editor) {
        this.$refs.editor.focus();
      }

      document.execCommand(command, false, value);
      this.updateFormattingState();
      this.updateCounters();
      this.syncContent();
    },

    // Format commands
    toggleBold() {
      this.exec('bold');
    },

    toggleItalic() {
      this.exec('italic');
    },

    toggleUnderline() {
      this.exec('underline');
    },

    toggleStrikethrough() {
      this.exec('strikethrough');
    },

    toggleUnorderedList() {
      this.exec('insertUnorderedList');
    },

    toggleOrderedList() {
      this.exec('insertOrderedList');
    },

    toggleBlockquote() {
      this.exec('formatBlock', 'blockquote');
    },

    insertHorizontalRule() {
      this.exec('insertHorizontalRule');
    },

    // Headings
    setHeading(tag) {
      this.exec('formatBlock', tag);
      this.headingDropdownOpen = false;
      this.currentHeading = tag;
    },

    // Alignment
    setAlign(align) {
      const commands = {
        left: 'justifyLeft',
        center: 'justifyCenter',
        right: 'justifyRight',
        justify: 'justifyFull'
      };
      this.exec(commands[align]);
      this.alignDropdownOpen = false;
      this.currentAlign = align;
    },

    // Links
    insertLink() {
      const url = prompt('Enter URL:', 'https://');
      if (url) {
        this.exec('createLink', url);
      }
    },

    removeLink() {
      this.exec('unlink');
    },

    // Images
    insertImage() {
      const url = prompt('Enter image URL:', 'https://');
      if (url) {
        this.exec('insertImage', url);
      }
    },

    // Undo/Redo
    undo() {
      this.exec('undo');
    },

    redo() {
      this.exec('redo');
    },

    // Source view toggle
    toggleSourceView() {
      if (this.sourceView) {
        // Switching from source to WYSIWYG
        this.$refs.editor.innerHTML = this.$refs.source.value;
      } else {
        // Switching from WYSIWYG to source
        this.$refs.source.value = this.$refs.editor.innerHTML;
      }
      this.sourceView = !this.sourceView;
      this.syncContent();
    },

    // Update formatting state based on selection
    updateFormattingState() {
      this.isBold = document.queryCommandState('bold');
      this.isItalic = document.queryCommandState('italic');
      this.isUnderline = document.queryCommandState('underline');
      this.isStrikethrough = document.queryCommandState('strikethrough');
      this.isList = document.queryCommandState('insertUnorderedList');
      this.isOrderedList = document.queryCommandState('insertOrderedList');

      // Check alignment
      if (document.queryCommandState('justifyCenter')) {
        this.currentAlign = 'center';
      } else if (document.queryCommandState('justifyRight')) {
        this.currentAlign = 'right';
      } else if (document.queryCommandState('justifyFull')) {
        this.currentAlign = 'justify';
      } else {
        this.currentAlign = 'left';
      }

      // Check heading
      const block = document.queryCommandValue('formatBlock');
      if (block) {
        this.currentHeading = block.toLowerCase();
      }
    },

    // Update character and word counts
    updateCounters() {
      const text = this.$refs.editor ? this.$refs.editor.innerText || '' : '';
      this.charCount = text.length;
      this.wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
    },

    // Sync content to model
    syncContent() {
      if (this.sourceView) {
        this.content = this.$refs.source.value;
      } else {
        this.content = this.$refs.editor.innerHTML;
      }
      this.$dispatch('rich-text:change', { content: this.content });
    },

    // Handle input in editor
    handleInput() {
      this.updateCounters();
      this.syncContent();
    },

    // Handle paste - strip formatting if needed
    handlePaste(e) {
      if (config.plainTextPaste) {
        e.preventDefault();
        const text = e.clipboardData.getData('text/plain');
        document.execCommand('insertText', false, text);
      }
      this.updateCounters();
      this.syncContent();
    },

    // Handle keydown for keyboard shortcuts
    handleKeydown(e) {
      // Ctrl/Cmd + B = Bold
      if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        this.toggleBold();
      }
      // Ctrl/Cmd + I = Italic
      if ((e.ctrlKey || e.metaKey) && e.key === 'i') {
        e.preventDefault();
        this.toggleItalic();
      }
      // Ctrl/Cmd + U = Underline
      if ((e.ctrlKey || e.metaKey) && e.key === 'u') {
        e.preventDefault();
        this.toggleUnderline();
      }
      // Ctrl/Cmd + Z = Undo
      if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
        e.preventDefault();
        this.undo();
      }
      // Ctrl/Cmd + Shift + Z or Ctrl/Cmd + Y = Redo
      if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {
        e.preventDefault();
        this.redo();
      }
    },

    // Get HTML content
    getHTML() {
      return this.content;
    },

    // Set HTML content
    setHTML(html) {
      this.content = html;
      if (this.$refs.editor) {
        this.$refs.editor.innerHTML = html;
      }
      if (this.$refs.source) {
        this.$refs.source.value = html;
      }
      this.updateCounters();
    },

    // Clear content
    clear() {
      this.content = '';
      if (this.$refs.editor) {
        this.$refs.editor.innerHTML = '';
      }
      if (this.$refs.source) {
        this.$refs.source.value = '';
      }
      this.updateCounters();
    },

    // Focus editor
    focus() {
      if (this.$refs.editor) {
        this.$refs.editor.focus();
      }
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxRichText', richTextComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxRichText', richTextComponent);
    });
  }
})();

/**
 * UX Scheduler Component
 * Booking and appointment scheduler with day/week/month views and resource columns
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Scheduler - Variables
    ======================================== */

    :root {
      --ux-scheduler-hour-height: 60px;
      --ux-scheduler-time-width: 60px;
      --ux-scheduler-header-height: 80px;
      --ux-scheduler-resource-width: 200px;
      --ux-scheduler-slot-min-height: 15px;
    }

    /* ========================================
       UX Scheduler - Base
    ======================================== */

    .ux-scheduler {
      font-family: var(--ux-font-family);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* ========================================
       Header
    ======================================== */

    .ux-scheduler__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .ux-scheduler__nav {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .ux-scheduler__nav-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: var(--ux-surface-secondary);
      border: none;
      border-radius: var(--ux-radius-md);
      color: var(--ux-text);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-scheduler__nav-btn:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-scheduler__nav-btn:active {
      transform: scale(0.95);
    }

    .ux-scheduler__nav-btn svg {
      width: 18px;
      height: 18px;
    }

    .ux-scheduler__title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-scheduler__today-btn {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ux-primary);
      background: transparent;
      border: 1px solid var(--ux-primary);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-scheduler__today-btn:hover {
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-scheduler__view-toggle {
      display: flex;
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-radius-md);
      padding: 0.25rem;
    }

    .ux-scheduler__view-btn {
      padding: 0.5rem 1rem;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--ux-text-secondary);
      background: transparent;
      border: none;
      border-radius: var(--ux-radius-sm);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-scheduler__view-btn:hover {
      color: var(--ux-text);
    }

    .ux-scheduler__view-btn--active {
      background: var(--ux-surface);
      color: var(--ux-text);
      box-shadow: var(--ux-shadow-sm);
    }

    /* ========================================
       Resource Headers (for week view with resources)
    ======================================== */

    .ux-scheduler__resources-header {
      display: flex;
      border-bottom: 1px solid var(--ux-border-color);
      position: sticky;
      top: 0;
      background: var(--ux-surface);
      z-index: 15;
    }

    .ux-scheduler__resources-corner {
      width: var(--ux-scheduler-time-width);
      min-width: var(--ux-scheduler-time-width);
      border-right: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-scheduler__resource-header {
      flex: 1;
      min-width: var(--ux-scheduler-resource-width);
      padding: 0.75rem;
      text-align: center;
      border-right: 1px solid var(--ux-border-color);
      background: var(--ux-surface-secondary);
    }

    .ux-scheduler__resource-header:last-child {
      border-right: none;
    }

    .ux-scheduler__resource-name {
      font-weight: 600;
      color: var(--ux-text);
      font-size: 0.875rem;
    }

    .ux-scheduler__resource-info {
      font-size: 0.75rem;
      color: var(--ux-text-secondary);
      margin-top: 0.25rem;
    }

    .ux-scheduler__resource-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      margin: 0 auto 0.5rem;
      background: var(--ux-surface-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: var(--ux-text-secondary);
      font-size: 0.75rem;
    }

    .ux-scheduler__resource-avatar img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    /* ========================================
       Day Headers
    ======================================== */

    .ux-scheduler__day-headers {
      display: flex;
      border-bottom: 1px solid var(--ux-border-color);
      position: sticky;
      top: 0;
      background: var(--ux-surface);
      z-index: 10;
    }

    .ux-scheduler__corner {
      width: var(--ux-scheduler-time-width);
      min-width: var(--ux-scheduler-time-width);
      border-right: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }

    .ux-scheduler__day-header {
      flex: 1;
      min-width: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 0.5rem;
      text-align: center;
      border-right: 1px solid var(--ux-border-color);
      cursor: pointer;
      transition: background var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-scheduler__day-header:last-child {
      border-right: none;
    }

    .ux-scheduler__day-header:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-scheduler__day-name {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      margin-bottom: 0.25rem;
    }

    .ux-scheduler__day-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      font-size: 1rem;
      font-weight: 600;
      color: var(--ux-text);
      border-radius: var(--ux-radius-full);
    }

    .ux-scheduler__day-header--today .ux-scheduler__day-number {
      background: var(--ux-primary);
      color: white;
    }

    .ux-scheduler__day-header--selected {
      background: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-scheduler__day-header--weekend {
      background: var(--ux-surface-secondary);
    }

    /* ========================================
       Grid Container
    ======================================== */

    .ux-scheduler__body {
      flex: 1;
      overflow: auto;
      position: relative;
    }

    .ux-scheduler__grid {
      display: flex;
      position: relative;
      min-height: calc(var(--ux-scheduler-hour-height) * 24);
    }

    /* ========================================
       Time Column
    ======================================== */

    .ux-scheduler__times {
      width: var(--ux-scheduler-time-width);
      min-width: var(--ux-scheduler-time-width);
      border-right: 1px solid var(--ux-border-color);
      flex-shrink: 0;
      position: sticky;
      left: 0;
      background: var(--ux-surface);
      z-index: 5;
    }

    .ux-scheduler__time {
      height: var(--ux-scheduler-hour-height);
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;
      padding: 0 0.5rem;
      font-size: 0.75rem;
      color: var(--ux-text-tertiary);
      transform: translateY(-0.5em);
    }

    /* ========================================
       Day Columns
    ======================================== */

    .ux-scheduler__columns {
      display: flex;
      flex: 1;
    }

    .ux-scheduler__day-column {
      flex: 1;
      min-width: 100px;
      position: relative;
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-scheduler__day-column:last-child {
      border-right: none;
    }

    .ux-scheduler__day-column--weekend {
      background: var(--ux-surface-secondary);
    }

    /* ========================================
       Hour Slots
    ======================================== */

    .ux-scheduler__hour-slot {
      height: var(--ux-scheduler-hour-height);
      border-bottom: 1px solid var(--ux-border-color);
      position: relative;
      cursor: pointer;
      transition: background var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-scheduler__hour-slot:hover {
      background: rgba(var(--ux-primary-rgb), 0.03);
    }

    .ux-scheduler__hour-slot:last-child {
      border-bottom: none;
    }

    /* Half hour line */
    .ux-scheduler__hour-slot::after {
      content: '';
      display: block;
      height: 50%;
      border-bottom: 1px dashed var(--ux-gray-100);
    }

    /* Quarter hour lines for 15min intervals */
    .ux-scheduler--interval-15 .ux-scheduler__hour-slot::before {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      top: 25%;
      border-bottom: 1px dotted var(--ux-gray-100);
    }

    .ux-scheduler--interval-15 .ux-scheduler__hour-slot::after {
      position: absolute;
      left: 0;
      right: 0;
      top: 75%;
      height: auto;
      border-bottom: 1px dotted var(--ux-gray-100);
    }

    /* Business hours */
    .ux-scheduler__hour-slot--business {
      background: var(--ux-surface);
    }

    .ux-scheduler__hour-slot--non-business {
      background: var(--ux-surface-secondary);
    }

    /* ========================================
       Current Time Indicator
    ======================================== */

    .ux-scheduler__now-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--ux-danger);
      z-index: 8;
      pointer-events: none;
    }

    .ux-scheduler__now-line::before {
      content: '';
      position: absolute;
      left: -5px;
      top: -4px;
      width: 10px;
      height: 10px;
      background: var(--ux-danger);
      border-radius: 50%;
    }

    /* ========================================
       Bookings / Events
    ======================================== */

    .ux-scheduler__booking {
      position: absolute;
      left: 2px;
      right: 2px;
      padding: 0.25rem 0.5rem;
      border-radius: var(--ux-radius-sm);
      font-size: 0.75rem;
      overflow: hidden;
      cursor: pointer;
      z-index: 2;
      transition: all var(--ux-transition-fast) var(--ux-ease);
      border-left: 3px solid;
      min-height: 20px;
    }

    .ux-scheduler__booking:hover {
      z-index: 3;
      box-shadow: var(--ux-shadow-md);
      transform: scale(1.02);
    }

    .ux-scheduler__booking:active {
      transform: scale(0.98);
    }

    .ux-scheduler__booking-title {
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.3;
    }

    .ux-scheduler__booking-time {
      font-size: 0.6875rem;
      opacity: 0.85;
      margin-top: 1px;
    }

    .ux-scheduler__booking-resource {
      font-size: 0.6875rem;
      opacity: 0.7;
      margin-top: 2px;
    }

    /* Booking Status Colors */
    .ux-scheduler__booking--confirmed {
      background: rgba(var(--ux-success-rgb), 0.9);
      color: white;
      border-left-color: var(--ux-green-600);
    }

    .ux-scheduler__booking--pending {
      background: rgba(var(--ux-warning-rgb), 0.9);
      color: var(--ux-gray-900);
      border-left-color: var(--ux-yellow-600);
    }

    .ux-scheduler__booking--cancelled {
      background: rgba(var(--ux-gray-400-rgb, 156, 163, 175), 0.5);
      color: var(--ux-text-secondary);
      border-left-color: var(--ux-gray-500);
      text-decoration: line-through;
      opacity: 0.7;
    }

    .ux-scheduler__booking--blocked {
      background: var(--ux-gray-200);
      color: var(--ux-text-secondary);
      border-left-color: var(--ux-gray-400);
      cursor: not-allowed;
    }

    .ux-scheduler__booking--primary {
      background: rgba(var(--ux-primary-rgb), 0.9);
      color: white;
      border-left-color: var(--ux-primary-shade);
    }

    .ux-scheduler__booking--danger {
      background: rgba(var(--ux-danger-rgb), 0.9);
      color: white;
      border-left-color: var(--ux-red-600);
    }

    /* Conflict indicator */
    .ux-scheduler__booking--conflict {
      box-shadow: 0 0 0 2px var(--ux-danger), inset 0 0 0 1px rgba(255,255,255,0.3);
    }

    .ux-scheduler__booking--conflict::after {
      content: '!';
      position: absolute;
      top: 2px;
      right: 4px;
      width: 14px;
      height: 14px;
      background: var(--ux-danger);
      color: white;
      border-radius: 50%;
      font-size: 10px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ========================================
       Drag to Create
    ======================================== */

    .ux-scheduler__drag-preview {
      position: absolute;
      left: 4px;
      right: 4px;
      background: rgba(var(--ux-primary-rgb), 0.3);
      border: 2px dashed var(--ux-primary);
      border-radius: var(--ux-radius-sm);
      z-index: 6;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--ux-primary);
    }

    /* ========================================
       Month View
    ======================================== */

    .ux-scheduler__month-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-scheduler__month-header {
      padding: 0.75rem;
      text-align: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      background: var(--ux-surface-secondary);
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-scheduler__month-header:last-child {
      border-right: none;
    }

    .ux-scheduler__month-day {
      min-height: 100px;
      padding: 0.5rem;
      border-right: 1px solid var(--ux-border-color);
      border-bottom: 1px solid var(--ux-border-color);
      cursor: pointer;
      transition: background var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-scheduler__month-day:nth-child(7n) {
      border-right: none;
    }

    .ux-scheduler__month-day:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-scheduler__month-day--other {
      background: var(--ux-surface-secondary);
      opacity: 0.5;
    }

    .ux-scheduler__month-day--today {
      background: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-scheduler__month-day--weekend {
      background: var(--ux-surface-secondary);
    }

    .ux-scheduler__month-day-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ux-text);
      border-radius: 50%;
      margin-bottom: 0.5rem;
    }

    .ux-scheduler__month-day--today .ux-scheduler__month-day-number {
      background: var(--ux-primary);
      color: white;
    }

    .ux-scheduler__month-booking {
      padding: 2px 6px;
      margin-bottom: 2px;
      border-radius: var(--ux-radius-sm);
      font-size: 0.6875rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
    }

    .ux-scheduler__month-booking--confirmed {
      background: rgba(var(--ux-success-rgb), 0.2);
      color: var(--ux-green-700);
    }

    .ux-scheduler__month-booking--pending {
      background: rgba(var(--ux-warning-rgb), 0.2);
      color: var(--ux-amber-700);
    }

    .ux-scheduler__month-more {
      font-size: 0.6875rem;
      color: var(--ux-primary);
      cursor: pointer;
      padding: 2px 6px;
    }

    .ux-scheduler__month-more:hover {
      text-decoration: underline;
    }

    /* ========================================
       Empty State
    ======================================== */

    .ux-scheduler__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      text-align: center;
      color: var(--ux-text-secondary);
    }

    .ux-scheduler__empty-icon {
      width: 48px;
      height: 48px;
      margin-bottom: 1rem;
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-scheduler--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-scheduler--glass .ux-scheduler__header {
      background: var(--ux-glass-bg-thin);
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-scheduler--glass .ux-scheduler__day-headers {
      background: var(--ux-glass-bg-thin);
    }

    .ux-scheduler--glass .ux-scheduler__times {
      background: var(--ux-glass-bg-thin);
    }

    .ux-scheduler--glass .ux-scheduler__resource-header {
      background: var(--ux-glass-bg-thin);
    }

    .ux-scheduler--glass .ux-scheduler__booking {
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .ux-scheduler--glass .ux-scheduler__nav-btn {
      background: var(--ux-glass-bg-thin);
    }

    .ux-scheduler--glass .ux-scheduler__view-toggle {
      background: var(--ux-glass-bg-thin);
    }

    .ux-scheduler--glass .ux-scheduler__view-btn--active {
      background: var(--ux-glass-bg-thick);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-scheduler {
        background: var(--ux-surface);
        border-color: var(--ux-border-color);
      }

      .ux-scheduler__hour-slot::after,
      .ux-scheduler--interval-15 .ux-scheduler__hour-slot::before {
        border-color: var(--ux-gray-800);
      }

      .ux-scheduler__booking--pending {
        color: var(--ux-gray-900);
      }
    }

    .ux-dark .ux-scheduler {
      background: var(--ux-surface);
      border-color: var(--ux-border-color);
    }

    .ux-dark .ux-scheduler__hour-slot::after,
    .ux-dark .ux-scheduler--interval-15 .ux-scheduler__hour-slot::before {
      border-color: var(--ux-gray-800);
    }

    .ux-dark .ux-scheduler__booking--pending {
      color: var(--ux-gray-900);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-scheduler {
        --ux-scheduler-time-width: 45px;
        --ux-scheduler-hour-height: 50px;
        --ux-scheduler-resource-width: 120px;
      }

      .ux-scheduler__header {
        flex-wrap: wrap;
        gap: 0.5rem;
        padding: 0.75rem;
      }

      .ux-scheduler__view-toggle {
        order: -1;
        width: 100%;
        justify-content: center;
      }

      .ux-scheduler__day-header {
        min-width: 60px;
      }

      .ux-scheduler__day-name {
        font-size: 0.625rem;
      }

      .ux-scheduler__day-number {
        width: 28px;
        height: 28px;
        font-size: 0.875rem;
      }

      .ux-scheduler__booking {
        font-size: 0.6875rem;
        padding: 0.125rem 0.25rem;
      }

      .ux-scheduler__booking-time {
        display: none;
      }

      .ux-scheduler__month-day {
        min-height: 60px;
        padding: 0.25rem;
      }

      .ux-scheduler__month-day-number {
        width: 24px;
        height: 24px;
        font-size: 0.75rem;
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-scheduler__nav-btn,
      .ux-scheduler__today-btn,
      .ux-scheduler__view-btn,
      .ux-scheduler__booking,
      .ux-scheduler__hour-slot,
      .ux-scheduler__day-header {
        transition: none;
      }

      .ux-scheduler__booking:hover {
        transform: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-scheduler-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-scheduler-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Icons
  const icons = {
    chevronLeft: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>',
    chevronRight: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>',
    calendar: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>',
    clock: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
    plus: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>'
  };

  // Day and month names
  const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  const dayNamesLong = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  const monthNames = [
    'January', 'February', 'March', 'April', 'May', 'June',
    'July', 'August', 'September', 'October', 'November', 'December'
  ];

  // Alpine.js component
  const schedulerData = (options = {}) => ({
    // Configuration
    view: options.view || 'week', // 'day', 'week', 'month'
    interval: options.interval || 30, // 15, 30, 60 minutes
    startHour: options.startHour ?? 0,
    endHour: options.endHour ?? 24,
    businessStartHour: options.businessStartHour ?? 9,
    businessEndHour: options.businessEndHour ?? 17,
    showBusinessHours: options.showBusinessHours ?? true,
    resources: options.resources || [], // [{id, name, avatar, info}]
    bookings: options.bookings || [],
    hourHeight: options.hourHeight || 60,
    weekStartsOn: options.weekStartsOn ?? 0, // 0 = Sunday

    // State
    currentDate: options.initialDate ? new Date(options.initialDate) : new Date(),
    selectedDate: null,
    nowLineTop: 0,
    isDragging: false,
    dragStart: null,
    dragEnd: null,
    dragColumn: null,
    dragResourceId: null,

    // References
    icons,
    dayNames,
    dayNamesLong,
    monthNames,

    init() {
      this.selectedDate = new Date(this.currentDate);
      this.updateNowLine();

      // Update now line every minute
      this._nowInterval = setInterval(() => {
        this.updateNowLine();
      }, 60000);
    },

    destroy() {
      if (this._nowInterval) {
        clearInterval(this._nowInterval);
      }
    },

    // Title based on current view
    get title() {
      if (this.view === 'day') {
        return `${this.dayNamesLong[this.currentDate.getDay()]}, ${this.monthNames[this.currentDate.getMonth()]} ${this.currentDate.getDate()}, ${this.currentDate.getFullYear()}`;
      }

      if (this.view === 'month') {
        return `${this.monthNames[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`;
      }

      // Week view
      const weekStart = this.getWeekStart(this.currentDate);
      const weekEnd = new Date(weekStart);
      weekEnd.setDate(weekEnd.getDate() + 6);

      if (weekStart.getMonth() === weekEnd.getMonth()) {
        return `${this.monthNames[weekStart.getMonth()]} ${weekStart.getDate()} - ${weekEnd.getDate()}, ${weekStart.getFullYear()}`;
      }

      return `${this.monthNames[weekStart.getMonth()].substring(0, 3)} ${weekStart.getDate()} - ${this.monthNames[weekEnd.getMonth()].substring(0, 3)} ${weekEnd.getDate()}, ${weekEnd.getFullYear()}`;
    },

    // Get week start
    getWeekStart(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = (day - this.weekStartsOn + 7) % 7;
      d.setDate(d.getDate() - diff);
      return d;
    },

    // Get days for week view
    get weekDays() {
      const days = [];
      const weekStart = this.getWeekStart(this.currentDate);

      for (let i = 0; i < 7; i++) {
        const d = new Date(weekStart);
        d.setDate(d.getDate() + i);
        days.push({
          date: d,
          name: this.dayNames[d.getDay()],
          number: d.getDate(),
          isToday: this.isToday(d),
          isWeekend: d.getDay() === 0 || d.getDay() === 6,
          isSelected: this.isSameDay(d, this.selectedDate)
        });
      }

      return days;
    },

    // Get hours array
    get hours() {
      const hours = [];
      for (let i = this.startHour; i < this.endHour; i++) {
        hours.push({
          value: i,
          label: this.formatHour(i),
          isBusiness: i >= this.businessStartHour && i < this.businessEndHour
        });
      }
      return hours;
    },

    // Get month days
    get monthDays() {
      const days = [];
      const firstDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1);
      const lastDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0);

      // Days from previous month
      const startDay = firstDay.getDay();
      const diff = (startDay - this.weekStartsOn + 7) % 7;
      const prevMonth = new Date(firstDay);
      prevMonth.setDate(prevMonth.getDate() - diff);

      for (let i = 0; i < diff; i++) {
        const d = new Date(prevMonth);
        d.setDate(d.getDate() + i);
        days.push({
          date: d,
          number: d.getDate(),
          isOtherMonth: true,
          isToday: this.isToday(d),
          isWeekend: d.getDay() === 0 || d.getDay() === 6
        });
      }

      // Days in current month
      for (let i = 1; i <= lastDay.getDate(); i++) {
        const d = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), i);
        days.push({
          date: d,
          number: i,
          isOtherMonth: false,
          isToday: this.isToday(d),
          isWeekend: d.getDay() === 0 || d.getDay() === 6
        });
      }

      // Days from next month to fill grid
      const remaining = 42 - days.length;
      for (let i = 1; i <= remaining; i++) {
        const d = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, i);
        days.push({
          date: d,
          number: i,
          isOtherMonth: true,
          isToday: this.isToday(d),
          isWeekend: d.getDay() === 0 || d.getDay() === 6
        });
      }

      return days;
    },

    // Check if date is today
    isToday(date) {
      const today = new Date();
      return this.isSameDay(date, today);
    },

    // Check if two dates are same day
    isSameDay(d1, d2) {
      if (!d1 || !d2) return false;
      return d1.getFullYear() === d2.getFullYear() &&
             d1.getMonth() === d2.getMonth() &&
             d1.getDate() === d2.getDate();
    },

    // Format hour
    formatHour(hour) {
      if (hour === 0) return '12 AM';
      if (hour === 12) return '12 PM';
      if (hour < 12) return `${hour} AM`;
      return `${hour - 12} PM`;
    },

    // Format time
    formatTime(date) {
      const d = new Date(date);
      const hours = d.getHours();
      const minutes = d.getMinutes();
      const period = hours >= 12 ? 'PM' : 'AM';
      const h = hours % 12 || 12;
      return `${h}:${minutes.toString().padStart(2, '0')} ${period}`;
    },

    // Navigation
    prev() {
      if (this.view === 'day') {
        this.currentDate.setDate(this.currentDate.getDate() - 1);
      } else if (this.view === 'week') {
        this.currentDate.setDate(this.currentDate.getDate() - 7);
      } else {
        this.currentDate.setMonth(this.currentDate.getMonth() - 1);
      }
      this.currentDate = new Date(this.currentDate);
      this.$dispatch('scheduler:navigate', { date: this.currentDate, view: this.view });
    },

    next() {
      if (this.view === 'day') {
        this.currentDate.setDate(this.currentDate.getDate() + 1);
      } else if (this.view === 'week') {
        this.currentDate.setDate(this.currentDate.getDate() + 7);
      } else {
        this.currentDate.setMonth(this.currentDate.getMonth() + 1);
      }
      this.currentDate = new Date(this.currentDate);
      this.$dispatch('scheduler:navigate', { date: this.currentDate, view: this.view });
    },

    goToToday() {
      this.currentDate = new Date();
      this.selectedDate = new Date();
      this.$dispatch('scheduler:navigate', { date: this.currentDate, view: this.view });
    },

    setView(view) {
      this.view = view;
      this.$dispatch('scheduler:viewchange', { view });
    },

    selectDay(date) {
      this.selectedDate = new Date(date);
      this.currentDate = new Date(date);
      if (this.view === 'month') {
        this.view = 'day';
      }
      this.$dispatch('scheduler:dayselect', { date });
    },

    // Update now line position
    updateNowLine() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const totalMinutes = hours * 60 + minutes;
      const startMinutes = this.startHour * 60;

      this.nowLineTop = ((totalMinutes - startMinutes) / 60) * this.hourHeight;
    },

    // Get bookings for a specific day
    getBookingsForDay(date, resourceId = null) {
      return this.bookings.filter(booking => {
        const bookingDate = new Date(booking.start);
        const sameDay = this.isSameDay(bookingDate, date);
        if (resourceId !== null) {
          return sameDay && booking.resourceId === resourceId;
        }
        return sameDay;
      });
    },

    // Get bookings for month day (limited)
    getBookingsForMonthDay(date, limit = 3) {
      const bookings = this.getBookingsForDay(date);
      return {
        visible: bookings.slice(0, limit),
        more: bookings.length > limit ? bookings.length - limit : 0
      };
    },

    // Get booking position and height
    getBookingStyle(booking) {
      const start = new Date(booking.start);
      const end = new Date(booking.end);

      const startHour = start.getHours();
      const startMinutes = start.getMinutes();
      const endHour = end.getHours();
      const endMinutes = end.getMinutes();

      const top = ((startHour - this.startHour) * 60 + startMinutes) / 60 * this.hourHeight;
      const duration = ((endHour - startHour) * 60 + (endMinutes - startMinutes)) / 60 * this.hourHeight;

      return {
        top: `${top}px`,
        height: `${Math.max(duration, 20)}px`
      };
    },

    // Check if now line should show
    shouldShowNowLine(date) {
      return this.isToday(date);
    },

    // Booking click handler
    onBookingClick(booking, event) {
      event.stopPropagation();
      this.$dispatch('scheduler:bookingclick', { booking });
    },

    // Slot click handler (for creating new bookings)
    onSlotClick(date, hour, resourceId = null, event) {
      const slotDate = new Date(date);
      slotDate.setHours(hour, 0, 0, 0);

      // Calculate minutes based on click position within the hour slot
      const rect = event.currentTarget.getBoundingClientRect();
      const clickY = event.clientY - rect.top;
      const minuteOffset = Math.floor((clickY / this.hourHeight) * 60);
      const roundedMinutes = Math.floor(minuteOffset / this.interval) * this.interval;
      slotDate.setMinutes(roundedMinutes);

      this.$dispatch('scheduler:slotclick', {
        date: slotDate,
        resourceId,
        hour,
        minutes: roundedMinutes
      });
    },

    // Drag to create booking
    onDragStart(date, hour, resourceId, event) {
      this.isDragging = true;
      const rect = event.currentTarget.getBoundingClientRect();
      const clickY = event.clientY - rect.top;
      const minuteOffset = Math.floor((clickY / this.hourHeight) * 60);
      const roundedMinutes = Math.floor(minuteOffset / this.interval) * this.interval;

      const startDate = new Date(date);
      startDate.setHours(hour, roundedMinutes, 0, 0);

      this.dragStart = startDate;
      this.dragEnd = new Date(startDate.getTime() + this.interval * 60000);
      this.dragColumn = date;
      this.dragResourceId = resourceId;
    },

    onDragMove(date, hour, event) {
      if (!this.isDragging || !this.isSameDay(date, this.dragColumn)) return;

      const rect = event.currentTarget.getBoundingClientRect();
      const clickY = event.clientY - rect.top;
      const minuteOffset = Math.floor((clickY / this.hourHeight) * 60);
      const roundedMinutes = Math.ceil(minuteOffset / this.interval) * this.interval;

      const endDate = new Date(date);
      endDate.setHours(hour, roundedMinutes, 0, 0);

      if (endDate > this.dragStart) {
        this.dragEnd = endDate;
      }
    },

    onDragEnd() {
      if (!this.isDragging) return;

      this.isDragging = false;

      // Only dispatch if drag duration is meaningful
      const duration = (this.dragEnd - this.dragStart) / 60000;
      if (duration >= this.interval) {
        this.$dispatch('scheduler:createbooking', {
          start: this.dragStart,
          end: this.dragEnd,
          resourceId: this.dragResourceId
        });
      }

      this.dragStart = null;
      this.dragEnd = null;
      this.dragColumn = null;
      this.dragResourceId = null;
    },

    // Get drag preview style
    getDragPreviewStyle() {
      if (!this.dragStart || !this.dragEnd) return { display: 'none' };

      const startHour = this.dragStart.getHours();
      const startMinutes = this.dragStart.getMinutes();
      const endHour = this.dragEnd.getHours();
      const endMinutes = this.dragEnd.getMinutes();

      const top = ((startHour - this.startHour) * 60 + startMinutes) / 60 * this.hourHeight;
      const height = ((endHour - startHour) * 60 + (endMinutes - startMinutes)) / 60 * this.hourHeight;

      return {
        top: `${top}px`,
        height: `${Math.max(height, 20)}px`
      };
    },

    // Format drag preview time
    getDragPreviewText() {
      if (!this.dragStart || !this.dragEnd) return '';
      return `${this.formatTime(this.dragStart)} - ${this.formatTime(this.dragEnd)}`;
    },

    // Check for conflicts
    hasConflict(booking) {
      const bookingStart = new Date(booking.start).getTime();
      const bookingEnd = new Date(booking.end).getTime();

      return this.bookings.some(other => {
        if (other.id === booking.id) return false;
        if (booking.resourceId && other.resourceId !== booking.resourceId) return false;

        const otherStart = new Date(other.start).getTime();
        const otherEnd = new Date(other.end).getTime();

        return (bookingStart < otherEnd && bookingEnd > otherStart);
      });
    },

    // Add booking
    addBooking(bookingData) {
      const booking = {
        id: bookingData.id || 'booking-' + Date.now(),
        ...bookingData
      };
      this.bookings.push(booking);
      this.$dispatch('scheduler:bookingadd', { booking });
      return booking;
    },

    // Update booking
    updateBooking(bookingId, updates) {
      const index = this.bookings.findIndex(b => b.id === bookingId);
      if (index !== -1) {
        this.bookings[index] = { ...this.bookings[index], ...updates };
        this.$dispatch('scheduler:bookingupdate', { booking: this.bookings[index], updates });
      }
    },

    // Remove booking
    removeBooking(bookingId) {
      const index = this.bookings.findIndex(b => b.id === bookingId);
      if (index !== -1) {
        const booking = this.bookings.splice(index, 1)[0];
        this.$dispatch('scheduler:bookingremove', { booking });
      }
    },

    // Set bookings
    setBookings(bookings) {
      this.bookings = bookings;
    },

    // Get all resources
    getResources() {
      return this.resources;
    },

    // Set resources
    setResources(resources) {
      this.resources = resources;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxScheduler', schedulerData);
  }

})();

/**
 * UX Scroll Component
 * Alpine.js components for scroll behavior
 * CSS is in ux-content.js to avoid duplication
 * @requires ux-core.js
 * @requires ux-content.js (for CSS)
 */
(function() {
  'use strict';

  // No CSS here - all layout/scroll CSS is in ux-content.js
  const styles = ``;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-scroll-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-scroll-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for scroll with scroll events and methods
  // ARIA: Main content landmark
  const scrollComponent = (config = {}) => ({
    scrollTop: 0,
    scrollLeft: 0,
    scrollHeight: 0,
    scrollWidth: 0,
    clientHeight: 0,
    clientWidth: 0,
    isScrolling: false,
    scrollEvents: config.scrollEvents || false,
    _scrollTimeout: null,
    _lastScrollTop: 0,
    _scrollDirection: 'down',
    scrollId: config.id || 'ux-scroll-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes
    get ariaAttrs() {
      return {
        'role': 'main',
        'id': this.scrollId
      };
    },

    init() {
      this.$nextTick(() => {
        this.updateScrollInfo();
      });
    },

    // Get scroll element
    getScrollElement() {
      return this.$refs.scroll || this.$refs.content || this.$el;
    },

    // Update scroll information
    updateScrollInfo() {
      const el = this.getScrollElement();
      if (!el) return;

      this.scrollTop = el.scrollTop;
      this.scrollLeft = el.scrollLeft;
      this.scrollHeight = el.scrollHeight;
      this.scrollWidth = el.scrollWidth;
      this.clientHeight = el.clientHeight;
      this.clientWidth = el.clientWidth;
    },

    // Handle scroll event
    handleScroll(event) {
      const el = event.target;

      // Determine scroll direction
      this._scrollDirection = el.scrollTop > this._lastScrollTop ? 'down' : 'up';
      this._lastScrollTop = el.scrollTop;

      // Update scroll info
      this.scrollTop = el.scrollTop;
      this.scrollLeft = el.scrollLeft;

      // Dispatch scroll start
      if (!this.isScrolling) {
        this.isScrolling = true;
        this.$dispatch('ux-scroll-start', {
          scrollTop: this.scrollTop,
          scrollLeft: this.scrollLeft,
          direction: this._scrollDirection
        });
      }

      // Dispatch scroll event (throttled if scrollEvents is false)
      if (this.scrollEvents) {
        this.$dispatch('ux-scroll', {
          scrollTop: this.scrollTop,
          scrollLeft: this.scrollLeft,
          scrollHeight: el.scrollHeight,
          clientHeight: el.clientHeight,
          direction: this._scrollDirection,
          detail: {
            currentY: this.scrollTop,
            currentX: this.scrollLeft,
            deltaY: el.scrollTop - this._lastScrollTop,
            velocityY: 0 // Would need RAF for accurate velocity
          }
        });
      }

      // Dispatch scroll end (debounced)
      clearTimeout(this._scrollTimeout);
      this._scrollTimeout = setTimeout(() => {
        this.isScrolling = false;
        this.$dispatch('ux-scroll-end', {
          scrollTop: this.scrollTop,
          scrollLeft: this.scrollLeft,
          direction: this._scrollDirection
        });
      }, 150);
    },

    // Scroll to top
    scrollToTop(duration = 300) {
      return this.scrollToPoint(0, 0, duration);
    },

    // Scroll to bottom
    scrollToBottom(duration = 300) {
      const el = this.getScrollElement();
      if (!el) return Promise.resolve();

      return this.scrollToPoint(0, el.scrollHeight - el.clientHeight, duration);
    },

    // Scroll to specific point
    scrollToPoint(x, y, duration = 300) {
      const el = this.getScrollElement();
      if (!el) return Promise.resolve();

      return new Promise((resolve) => {
        if (duration === 0) {
          el.scrollTop = y;
          el.scrollLeft = x;
          this.updateScrollInfo();
          resolve();
          return;
        }

        el.scrollTo({
          top: y,
          left: x,
          behavior: 'smooth'
        });

        // Resolve after animation
        setTimeout(() => {
          this.updateScrollInfo();
          resolve();
        }, duration);
      });
    },

    // Scroll by amount
    scrollByPoint(x, y, duration = 300) {
      const el = this.getScrollElement();
      if (!el) return Promise.resolve();

      return this.scrollToPoint(
        el.scrollLeft + x,
        el.scrollTop + y,
        duration
      );
    },

    // Scroll to element
    scrollToElement(selector, duration = 300) {
      const el = this.getScrollElement();
      const target = el?.querySelector(selector);
      if (!target) return Promise.resolve();

      const targetRect = target.getBoundingClientRect();
      const scrollRect = el.getBoundingClientRect();

      return this.scrollToPoint(
        el.scrollLeft,
        el.scrollTop + (targetRect.top - scrollRect.top),
        duration
      );
    },

    // Check if scrolled to top
    get isAtTop() {
      return this.scrollTop <= 0;
    },

    // Check if scrolled to bottom
    get isAtBottom() {
      const el = this.getScrollElement();
      if (!el) return false;
      return this.scrollTop >= el.scrollHeight - el.clientHeight - 1;
    },

    // Get scroll progress (0 to 1)
    get scrollProgress() {
      const el = this.getScrollElement();
      if (!el || el.scrollHeight <= el.clientHeight) return 0;
      return this.scrollTop / (el.scrollHeight - el.clientHeight);
    }
  });

  // Register with both new and old names
  if (window.UX) {
    window.UX.registerComponent('uxScroll', scrollComponent);
    window.UX.registerComponent('uxContent', scrollComponent); // Backward compatibility
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxScroll', scrollComponent);
      Alpine.data('uxContent', scrollComponent); // Backward compatibility
    });
  }

  // Alpine component for page
  // Handles page-level concerns like visibility, lifecycle
  const pageComponent = (config = {}) => ({
    isActive: config.isActive !== false,
    pageId: config.id || 'ux-page-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes
    get ariaAttrs() {
      return {
        'role': 'document',
        'id': this.pageId,
        'aria-hidden': !this.isActive ? 'true' : 'false'
      };
    },

    // Lifecycle methods
    onEnter() {
      this.isActive = true;
      this.$dispatch('ux-page-enter', { pageId: this.pageId });
    },

    onLeave() {
      this.isActive = false;
      this.$dispatch('ux-page-leave', { pageId: this.pageId });
    },

    // For use with routers
    activate() {
      this.onEnter();
    },

    deactivate() {
      this.onLeave();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxPage', pageComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxPage', pageComponent);
    });
  }

  // Alpine component for scroll-to-top
  const scrollTopComponent = (config = {}) => ({
    visible: false,
    threshold: config.threshold || 300,

    init() {
      this.checkScroll = this.checkScroll.bind(this);
    },

    checkScroll(scrollTop) {
      this.visible = scrollTop > this.threshold;
    },

    scrollToTop() {
      const scroll = document.querySelector('.ux-scroll') || document.querySelector('.ux-content');
      if (scroll) {
        scroll.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      } else {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxScrollTop', scrollTopComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxScrollTop', scrollTopComponent);
    });
  }

  // Alpine component for collapsible header
  const collapsibleHeaderComponent = (config = {}) => ({
    collapsed: false,
    lastScrollTop: 0,
    threshold: config.threshold || 50,

    handleScroll(scrollTop) {
      if (scrollTop > this.lastScrollTop && scrollTop > this.threshold) {
        this.collapsed = true;
      } else {
        this.collapsed = false;
      }
      this.lastScrollTop = scrollTop;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxCollapsibleHeader', collapsibleHeaderComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxCollapsibleHeader', collapsibleHeaderComponent);
    });
  }
})();

/**
 * UX Searchbar Component
 * Barra de bÃºsqueda estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Searchbar
    ======================================== */

    .ux-searchbar {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
      padding: var(--ux-space-sm);
    }

    .ux-searchbar__container {
      position: relative;
      display: flex;
      align-items: center;
      flex: 1;
      min-height: var(--ux-searchbar-height);
      padding: 0 var(--ux-searchbar-padding-x);
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-searchbar-border-radius);
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-searchbar--focused .ux-searchbar__container {
      background-color: var(--ux-surface);
      box-shadow: 0 0 0 2px var(--ux-primary);
    }

    .ux-searchbar__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      color: var(--ux-text-tertiary);
      flex-shrink: 0;
    }

    .ux-searchbar__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-searchbar__input {
      flex: 1;
      width: 100%;
      height: var(--ux-searchbar-height);
      padding: 0 var(--ux-space-sm);
      font-family: var(--ux-font-family);
      font-size: var(--ux-input-font-size); /* Prevent zoom on iOS */
      color: var(--ux-text);
      background: transparent;
      border: none;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }

    .ux-searchbar__input::placeholder {
      color: var(--ux-text-tertiary);
    }

    /* Hide default search cancel button */
    .ux-searchbar__input::-webkit-search-cancel-button,
    .ux-searchbar__input::-webkit-search-decoration {
      -webkit-appearance: none;
      appearance: none;
    }

    .ux-searchbar__clear {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      padding: 0;
      border: none;
      background: var(--ux-medium);
      border-radius: 50%;
      color: white;
      cursor: pointer;
      opacity: 0;
      transform: scale(0.8);
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
      flex-shrink: 0;
    }

    .ux-searchbar__clear svg {
      width: 12px;
      height: 12px;
    }

    .ux-searchbar--has-value .ux-searchbar__clear {
      opacity: 1;
      transform: scale(1);
    }

    .ux-searchbar__clear:hover {
      background: var(--ux-medium-shade);
    }

    .ux-searchbar__clear:active {
      transform: scale(0.9);
    }

    /* ========================================
       Cancel Button (iOS style)
    ======================================== */

    .ux-searchbar__cancel {
      padding: 0 var(--ux-space-md);
      font-size: var(--ux-font-size-md);
      color: var(--ux-primary);
      background: none;
      border: none;
      cursor: pointer;
      white-space: nowrap;
      opacity: 0;
      max-width: 0;
      overflow: hidden;
      transition:
        opacity var(--ux-transition-base) var(--ux-ease),
        max-width var(--ux-transition-base) var(--ux-ease),
        padding var(--ux-transition-base) var(--ux-ease);
    }

    .ux-searchbar--focused .ux-searchbar__cancel,
    .ux-searchbar--show-cancel .ux-searchbar__cancel {
      opacity: 1;
      max-width: 100px;
    }

    .ux-searchbar__cancel:hover {
      color: var(--ux-primary-shade);
    }

    .ux-searchbar__cancel:active {
      opacity: 0.7;
    }

    /* ========================================
       Variants
    ======================================== */

    /* Rounded */
    .ux-searchbar--rounded .ux-searchbar__container {
      border-radius: 18px;
    }

    /* Outline */
    .ux-searchbar--outline .ux-searchbar__container {
      background-color: transparent;
      border: 1px solid var(--ux-border-color);
    }

    .ux-searchbar--outline.ux-searchbar--focused .ux-searchbar__container {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 2px rgba(var(--ux-primary-rgb), 0.15);
    }

    /* Filled */
    .ux-searchbar--filled .ux-searchbar__container {
      background-color: var(--ux-light);
    }

    /* Glass (iOS 26 Liquid Glass) */
    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-searchbar--glass .ux-searchbar__container {
      background: var(--ux-glass-bg-thin);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-searchbar--glass.ux-searchbar--focused .ux-searchbar__container {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-searchbar--sm .ux-searchbar__container {
      min-height: 32px;
    }

    .ux-searchbar--sm .ux-searchbar__input {
      height: 32px;
      font-size: var(--ux-font-size-sm);
    }

    .ux-searchbar--lg .ux-searchbar__container {
      min-height: 48px;
      padding: 0 var(--ux-space-lg);
    }

    .ux-searchbar--lg .ux-searchbar__input {
      height: 48px;
      font-size: var(--ux-font-size-lg);
    }

    .ux-searchbar--lg .ux-searchbar__icon {
      width: 24px;
      height: 24px;
    }

    /* ========================================
       With Results Dropdown
    ======================================== */

    .ux-searchbar__results {
      position: absolute;
      top: calc(100% + 4px);
      left: var(--ux-space-sm);
      right: var(--ux-space-sm);
      max-height: 300px;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      box-shadow: var(--ux-shadow-lg);
      overflow-y: auto;
      z-index: 100;
      -webkit-overflow-scrolling: touch;
    }

    .ux-searchbar__result {
      display: flex;
      align-items: center;
      padding: var(--ux-space-md) var(--ux-space-lg);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-searchbar__result:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-searchbar__result:active {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-searchbar__result-icon {
      width: 20px;
      height: 20px;
      margin-right: var(--ux-space-md);
      color: var(--ux-text-secondary);
    }

    .ux-searchbar__result-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-searchbar__result-content {
      flex: 1;
      min-width: 0;
    }

    .ux-searchbar__result-title {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-searchbar__result-subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Highlight matching text */
    .ux-searchbar__highlight {
      background-color: rgba(var(--ux-warning-rgb), 0.3);
      border-radius: 2px;
    }

    /* No results */
    .ux-searchbar__no-results {
      padding: var(--ux-space-lg);
      text-align: center;
      color: var(--ux-text-tertiary);
      font-size: var(--ux-font-size-sm);
    }

    /* Loading */
    .ux-searchbar__loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-lg);
    }

    /* ========================================
       Recent Searches
    ======================================== */

    .ux-searchbar__recent {
      padding: var(--ux-space-sm) 0;
    }

    .ux-searchbar__recent-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm) var(--ux-space-lg);
    }

    .ux-searchbar__recent-title {
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-searchbar__recent-clear {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-primary);
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
    }

    .ux-searchbar__recent-item {
      display: flex;
      align-items: center;
      padding: var(--ux-space-sm) var(--ux-space-lg);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-searchbar__recent-item:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-searchbar__recent-item-icon {
      width: 16px;
      height: 16px;
      margin-right: var(--ux-space-md);
      color: var(--ux-text-tertiary);
    }

    .ux-searchbar__recent-item-text {
      flex: 1;
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
    }

    .ux-searchbar__recent-item-remove {
      width: 20px;
      height: 20px;
      padding: 0;
      border: none;
      background: none;
      color: var(--ux-text-tertiary);
      cursor: pointer;
      opacity: 0;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-searchbar__recent-item:hover .ux-searchbar__recent-item-remove {
      opacity: 1;
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-searchbar--disabled .ux-searchbar__container {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-searchbar--disabled .ux-searchbar__input {
      cursor: not-allowed;
    }

    /* ========================================
       In Toolbar
    ======================================== */

    .ux-toolbar .ux-searchbar {
      padding: 0;
    }

    .ux-toolbar .ux-searchbar__container {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-toolbar .ux-searchbar--focused .ux-searchbar__container {
      background-color: var(--ux-surface);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-searchbar-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-searchbar-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for searchbar
  // ARIA: role="searchbox", aria-label, aria-autocomplete for autocomplete behavior
  const searchbarComponent = (config = {}) => ({
    query: config.query || '',
    isFocused: false,
    isLoading: false,
    showResults: false,
    results: [],
    recentSearches: config.recentSearches || [],
    maxRecent: config.maxRecent || 5,
    debounceTime: config.debounceTime || 300,
    minChars: config.minChars || 1,
    _debounceTimer: null,
    searchbarId: config.id || 'ux-searchbar-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for the search input
    get inputAriaAttrs() {
      return {
        'role': 'searchbox',
        'aria-label': config.ariaLabel || 'Search',
        'aria-autocomplete': 'list',
        'aria-controls': this.searchbarId + '-results',
        'aria-expanded': this.shouldShowDropdown ? 'true' : 'false'
      };
    },

    // ARIA attributes for the results container
    get resultsAriaAttrs() {
      return {
        'role': 'listbox',
        'id': this.searchbarId + '-results',
        'aria-label': 'Search results'
      };
    },

    // ARIA attributes for each result option
    getResultAriaAttrs(index) {
      return {
        'role': 'option',
        'id': this.searchbarId + '-result-' + index
      };
    },

    get hasValue() {
      return this.query.length > 0;
    },

    get shouldShowDropdown() {
      return this.isFocused && (this.showResults || this.recentSearches.length > 0);
    },

    focus() {
      this.isFocused = true;
    },

    blur() {
      // Delay to allow click on results
      setTimeout(() => {
        this.isFocused = false;
        this.showResults = false;
      }, 200);
    },

    clear() {
      this.query = '';
      this.results = [];
      this.showResults = false;
    },

    cancel() {
      this.clear();
      this.isFocused = false;
    },

    onInput() {
      clearTimeout(this._debounceTimer);

      if (this.query.length < this.minChars) {
        this.results = [];
        this.showResults = false;
        return;
      }

      this._debounceTimer = setTimeout(() => {
        this.search();
      }, this.debounceTime);
    },

    async search() {
      // Override this method or use @search event
      this.showResults = true;
    },

    selectResult(result) {
      this.query = result.title || result.label || result;
      this.addToRecent(this.query);
      this.showResults = false;
    },

    addToRecent(term) {
      if (!term) return;

      // Remove if already exists
      const index = this.recentSearches.indexOf(term);
      if (index !== -1) {
        this.recentSearches.splice(index, 1);
      }

      // Add to beginning
      this.recentSearches.unshift(term);

      // Keep max items
      if (this.recentSearches.length > this.maxRecent) {
        this.recentSearches = this.recentSearches.slice(0, this.maxRecent);
      }
    },

    selectRecent(term) {
      this.query = term;
      this.search();
    },

    removeRecent(term) {
      const index = this.recentSearches.indexOf(term);
      if (index !== -1) {
        this.recentSearches.splice(index, 1);
      }
    },

    clearRecent() {
      this.recentSearches = [];
    },

    submit() {
      if (this.query) {
        this.addToRecent(this.query);
      }
    },

    handleKeydown(event) {
      if (event.key === 'Escape') {
        this.cancel();
      } else if (event.key === 'Enter') {
        this.submit();
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSearchbar', searchbarComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSearchbar', searchbarComponent);
    });
  }

  // Helper to highlight matching text (XSS-safe)
  window.UX = window.UX || {};
  window.UX.highlightMatch = function(text, query) {
    if (!query || !text) return text || '';

    // First, escape HTML in the text to prevent XSS
    const escapeHtml = (str) => {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    };

    const escapedText = escapeHtml(String(text));
    const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const regex = new RegExp(`(${escapedQuery})`, 'gi');

    return escapedText.replace(regex, '<span class="ux-searchbar__highlight">$1</span>');
  };
})();

/**
 * UX Section Component
 * Content sections with header, description, actions, and collapsible functionality
 * iOS 26 Liquid Glass design
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Section
       Content sections for organizing page content
    ======================================== */

    :root {
      /* Section Tokens */
      --ux-section-padding: var(--ux-space-lg);
      --ux-section-padding-compact: var(--ux-space-md);
      --ux-section-gap: var(--ux-space-md);
      --ux-section-border-radius: var(--ux-border-radius-lg);
      --ux-section-header-gap: var(--ux-space-sm);
      --ux-section-margin-y: var(--ux-space-lg);
      --ux-section-inset-margin-x: var(--ux-space-lg);
    }

    .ux-section {
      display: flex;
      flex-direction: column;
      width: 100%;
      margin: var(--ux-section-margin-y) 0;
    }

    .ux-section:first-child {
      margin-top: 0;
    }

    .ux-section:last-child {
      margin-bottom: 0;
    }

    /* ========================================
       Section Header
    ======================================== */

    .ux-section__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--ux-space-md);
      padding: var(--ux-section-padding);
      padding-bottom: var(--ux-space-sm);
    }

    .ux-section__header-content {
      display: flex;
      flex-direction: column;
      gap: var(--ux-section-header-gap);
      flex: 1;
      min-width: 0;
    }

    .ux-section__title {
      margin: 0;
      font-size: var(--ux-font-size-lg);
      font-weight: var(--ux-font-weight-semibold);
      color: var(--ux-text);
      line-height: 1.3;
    }

    .ux-section__description {
      margin: 0;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      line-height: 1.5;
    }

    .ux-section__actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      flex-shrink: 0;
    }

    /* ========================================
       Section Content
    ======================================== */

    .ux-section__content {
      padding: var(--ux-section-padding);
      padding-top: 0;
    }

    /* When no header, add top padding */
    .ux-section__content:first-child {
      padding-top: var(--ux-section-padding);
    }

    /* ========================================
       Bordered Variant
    ======================================== */

    .ux-section--bordered {
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-section-border-radius);
      background-color: var(--ux-surface);
    }

    .ux-section--bordered .ux-section__header {
      border-bottom: 1px solid var(--ux-border-color);
      padding-bottom: var(--ux-section-padding);
    }

    .ux-section--bordered .ux-section__content {
      padding-top: var(--ux-section-padding);
    }

    /* ========================================
       Card Variant
    ======================================== */

    .ux-section--card {
      background-color: var(--ux-surface);
      border-radius: var(--ux-section-border-radius);
      box-shadow: var(--ux-shadow-sm);
    }

    .ux-section--card .ux-section__header {
      border-bottom: 1px solid var(--ux-border-color);
      padding-bottom: var(--ux-section-padding);
    }

    .ux-section--card .ux-section__content {
      padding-top: var(--ux-section-padding);
    }

    /* ========================================
       Inset Variant (iOS grouped style)
    ======================================== */

    .ux-section--inset {
      margin-left: var(--ux-section-inset-margin-x);
      margin-right: var(--ux-section-inset-margin-x);
    }

    /* ========================================
       Compact Variant
    ======================================== */

    .ux-section--compact {
      --ux-section-padding: var(--ux-section-padding-compact);
      --ux-section-gap: var(--ux-space-sm);
      --ux-section-margin-y: var(--ux-space-md);
    }

    .ux-section--compact .ux-section__title {
      font-size: var(--ux-font-size-md);
    }

    .ux-section--compact .ux-section__description {
      font-size: var(--ux-font-size-xs);
    }

    /* ========================================
       Collapsible Variant
    ======================================== */

    .ux-section--collapsible .ux-section__header {
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-section--collapsible .ux-section__header:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-section--collapsible .ux-section__header:active {
      background-color: var(--ux-light);
    }

    .ux-section__chevron {
      width: 20px;
      height: 20px;
      color: var(--ux-text-tertiary);
      flex-shrink: 0;
      transition: transform var(--ux-transition-base) var(--ux-ease);
      margin-left: auto;
    }

    .ux-section__chevron svg {
      width: 100%;
      height: 100%;
    }

    .ux-section--expanded .ux-section__chevron {
      transform: rotate(180deg);
    }

    /* Collapsible content animation */
    .ux-section--collapsible .ux-section__body {
      display: grid;
      grid-template-rows: 0fr;
      transition: grid-template-rows var(--ux-transition-base) var(--ux-ease);
    }

    .ux-section--collapsible.ux-section--expanded .ux-section__body {
      grid-template-rows: 1fr;
    }

    .ux-section__body-inner {
      overflow: hidden;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-section--glass {
      border: 0.5px solid var(--ux-glass-border);
      border-radius: var(--ux-glass-radius-lg);
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      overflow: hidden;
    }

    .ux-section--glass .ux-section__header {
      border-bottom: 0.5px solid var(--ux-glass-border);
      padding-bottom: var(--ux-section-padding);
    }

    .ux-section--glass .ux-section__content {
      padding-top: var(--ux-section-padding);
    }

    .ux-section--glass.ux-section--collapsible .ux-section__header:hover {
      background-color: var(--ux-glass-bg-thin);
    }

    .ux-section--glass.ux-section--collapsible .ux-section__header:active {
      background-color: var(--ux-glass-bg);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-section--sm .ux-section__header,
    .ux-section--sm .ux-section__content {
      padding: var(--ux-space-md);
    }

    .ux-section--sm .ux-section__header {
      padding-bottom: var(--ux-space-xs);
    }

    .ux-section--sm .ux-section__title {
      font-size: var(--ux-font-size-md);
    }

    .ux-section--sm .ux-section__description {
      font-size: var(--ux-font-size-xs);
    }

    .ux-section--lg .ux-section__header,
    .ux-section--lg .ux-section__content {
      padding: var(--ux-space-xl);
    }

    .ux-section--lg .ux-section__header {
      padding-bottom: var(--ux-space-md);
    }

    .ux-section--lg .ux-section__title {
      font-size: var(--ux-font-size-xl);
    }

    /* ========================================
       Divider Between Sections
    ======================================== */

    .ux-section--divider {
      border-bottom: 1px solid var(--ux-border-color);
      padding-bottom: var(--ux-section-margin-y);
    }

    .ux-section--divider:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    /* ========================================
       Header-only Section (for list headers)
    ======================================== */

    .ux-section--header-only .ux-section__header {
      padding-bottom: var(--ux-space-sm);
    }

    .ux-section--header-only .ux-section__title {
      font-size: var(--ux-font-size-sm);
      font-weight: var(--ux-font-weight-medium);
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-section--disabled {
      opacity: var(--ux-disabled-opacity);
      pointer-events: none;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light) .ux-section--bordered {
        border-color: var(--ux-border-color);
        background-color: var(--ux-surface);
      }

      :root:not(.ux-light) .ux-section--bordered .ux-section__header {
        border-bottom-color: var(--ux-border-color);
      }

      :root:not(.ux-light) .ux-section--card {
        background-color: var(--ux-surface);
        box-shadow: var(--ux-shadow-md);
      }

      :root:not(.ux-light) .ux-section--collapsible .ux-section__header:hover {
        background-color: var(--ux-surface-secondary);
      }

      :root:not(.ux-light) .ux-section--collapsible .ux-section__header:active {
        background-color: var(--ux-surface-tertiary);
      }
    }

    .ux-dark .ux-section--bordered,
    .ux-theme-dark .ux-section--bordered {
      border-color: var(--ux-border-color);
      background-color: var(--ux-surface);
    }

    .ux-dark .ux-section--bordered .ux-section__header,
    .ux-theme-dark .ux-section--bordered .ux-section__header {
      border-bottom-color: var(--ux-border-color);
    }

    .ux-dark .ux-section--card,
    .ux-theme-dark .ux-section--card {
      background-color: var(--ux-surface);
      box-shadow: var(--ux-shadow-md);
    }

    .ux-dark .ux-section--collapsible .ux-section__header:hover,
    .ux-theme-dark .ux-section--collapsible .ux-section__header:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-dark .ux-section--collapsible .ux-section__header:active,
    .ux-theme-dark .ux-section--collapsible .ux-section__header:active {
      background-color: var(--ux-surface-tertiary);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-section__chevron {
        transition: none;
      }

      .ux-section--collapsible .ux-section__body {
        transition: none;
      }

      .ux-section--collapsible .ux-section__header {
        transition: none;
      }
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-section--inset {
        margin-left: var(--ux-space-md);
        margin-right: var(--ux-space-md);
      }

      .ux-section__header {
        flex-wrap: wrap;
      }

      .ux-section__actions {
        width: 100%;
        justify-content: flex-end;
        margin-top: var(--ux-space-sm);
      }

      /* Keep actions inline on small screens if few items */
      .ux-section__header:has(.ux-section__actions:only-child),
      .ux-section__header:has(.ux-section__actions > :only-child) {
        flex-wrap: nowrap;
      }

      .ux-section__header:has(.ux-section__actions > :only-child) .ux-section__actions {
        width: auto;
        margin-top: 0;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-section-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-section-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for collapsible section
  // ARIA: aria-expanded on header, aria-controls, region role on content
  // Keyboard: Enter/Space to toggle
  const sectionComponent = (config = {}) => ({
    isExpanded: config.expanded !== false, // Default to expanded
    disabled: config.disabled || false,
    sectionId: config.id || 'ux-section-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for header
    get headerAriaAttrs() {
      return {
        'aria-expanded': this.isExpanded ? 'true' : 'false',
        'aria-controls': this.sectionId + '-content',
        'id': this.sectionId + '-header',
        'role': 'button',
        'tabindex': '0'
      };
    },

    // ARIA attributes for content
    get contentAriaAttrs() {
      return {
        'role': 'region',
        'aria-labelledby': this.sectionId + '-header',
        'id': this.sectionId + '-content'
      };
    },

    init() {
      // Add expanded class based on initial state
      if (this.isExpanded) {
        this.$el.classList.add('ux-section--expanded');
      }
    },

    toggle() {
      if (this.disabled) return;
      this.isExpanded = !this.isExpanded;
      this.$el.classList.toggle('ux-section--expanded', this.isExpanded);
      this.$dispatch('section:toggle', { expanded: this.isExpanded });
    },

    expand() {
      if (this.disabled || this.isExpanded) return;
      this.isExpanded = true;
      this.$el.classList.add('ux-section--expanded');
      this.$dispatch('section:expand');
    },

    collapse() {
      if (!this.isExpanded) return;
      this.isExpanded = false;
      this.$el.classList.remove('ux-section--expanded');
      this.$dispatch('section:collapse');
    },

    // Keyboard handler for Enter/Space
    handleKeydown(event) {
      if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        this.toggle();
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSection', sectionComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSection', sectionComponent);
    });
  }
})();

/**
 * UX Segment Component
 * Control segmentado estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Segment
    ======================================== */

    .ux-segment {
      display: inline-flex;
      align-items: stretch;
      background-color: var(--ux-segment-bg, rgba(118, 118, 128, 0.12));
      border-radius: var(--ux-segment-border-radius);
      padding: var(--ux-segment-padding);
      position: relative;
    }

    .ux-segment--block {
      display: flex;
      width: 100%;
    }

    /* ========================================
       Segment Button
    ======================================== */

    .ux-segment-button {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
      min-width: var(--ux-segment-min-width);
      min-height: var(--ux-segment-min-height);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: transparent;
      border: none;
      color: var(--ux-text-secondary);
      font-family: var(--ux-font-family);
      font-size: var(--ux-segment-font-size);
      font-weight: 500;
      white-space: nowrap;
      cursor: pointer;
      border-radius: calc(var(--ux-segment-border-radius) - var(--ux-segment-padding));
      -webkit-tap-highlight-color: transparent;
      z-index: 1;
    }

    .ux-segment-button:hover:not(.ux-segment-button--selected) {
      color: var(--ux-text);
    }

    .ux-segment-button--selected {
      color: var(--ux-text);
    }

    .ux-segment-button--disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    /* ========================================
       Segment Indicator (sliding background)
       Ionic-style animation with squish effect
    ======================================== */

    .ux-segment__indicator {
      position: absolute;
      top: var(--ux-segment-padding);
      bottom: var(--ux-segment-padding);
      background-color: var(--ux-surface);
      border-radius: calc(var(--ux-segment-border-radius) - var(--ux-segment-padding));
      box-shadow: var(--ux-shadow-sm);
      transition:
        left 300ms cubic-bezier(0.4, 0.0, 0.2, 1),
        width 300ms cubic-bezier(0.4, 0.0, 0.2, 1),
        transform 300ms cubic-bezier(0.4, 0.0, 0.2, 1);
      z-index: 0;
      will-change: left, width, transform;
    }

    /* Squish animation during transition */
    .ux-segment__indicator--animating {
      animation: ux-segment-squish 300ms cubic-bezier(0.4, 0.0, 0.2, 1);
    }

    @keyframes ux-segment-squish {
      0% {
        transform: scaleX(1) scaleY(1);
      }
      30% {
        transform: scaleX(1.08) scaleY(0.92);
      }
      60% {
        transform: scaleX(0.96) scaleY(1.02);
      }
      100% {
        transform: scaleX(1) scaleY(1);
      }
    }

    /* Subtle press effect on buttons */
    .ux-segment-button:active:not(.ux-segment-button--selected) {
      transform: scale(0.96);
    }

    .ux-segment-button {
      transition:
        color var(--ux-transition-fast) var(--ux-ease),
        transform 150ms var(--ux-ease);
    }

    /* ========================================
       Segment Button Content
    ======================================== */

    .ux-segment-button__icon {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .ux-segment-button__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-segment-button__label {
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-segment-button__icon + .ux-segment-button__label {
      margin-left: var(--ux-space-xs);
    }

    /* Icon only */
    .ux-segment-button--icon-only {
      padding: var(--ux-space-sm);
    }

    .ux-segment-button--icon-only .ux-segment-button__icon {
      width: 20px;
      height: 20px;
    }

    /* ========================================
       Segment Variants
    ======================================== */

    /* Primary */
    .ux-segment--primary {
      background-color: rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-segment--primary .ux-segment__indicator {
      background-color: var(--ux-primary);
    }

    .ux-segment--primary .ux-segment-button--selected {
      color: white;
    }

    /* Outline */
    .ux-segment--outline {
      background-color: transparent;
      border: 1px solid var(--ux-border-color);
      padding: 0;
    }

    .ux-segment--outline .ux-segment-button {
      border-radius: 0;
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-segment--outline .ux-segment-button:first-child {
      border-radius: calc(var(--ux-border-radius) - 1px) 0 0 calc(var(--ux-border-radius) - 1px);
    }

    .ux-segment--outline .ux-segment-button:last-child {
      border-radius: 0 calc(var(--ux-border-radius) - 1px) calc(var(--ux-border-radius) - 1px) 0;
      border-right: none;
    }

    .ux-segment--outline .ux-segment__indicator {
      top: 0;
      bottom: 0;
      border-radius: calc(var(--ux-border-radius) - 1px);
      box-shadow: none;
      background-color: var(--ux-primary);
    }

    .ux-segment--outline .ux-segment-button--selected {
      color: white;
    }

    /* Rounded Pill */
    .ux-segment--rounded {
      border-radius: 100px;
      padding: 3px;
    }

    .ux-segment--rounded .ux-segment-button {
      border-radius: 100px;
    }

    .ux-segment--rounded .ux-segment__indicator {
      border-radius: 100px;
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-segment--secondary .ux-segment__indicator {
      background-color: var(--ux-secondary);
    }

    .ux-segment--secondary .ux-segment-button--selected {
      color: var(--ux-secondary-contrast);
    }

    .ux-segment--success .ux-segment__indicator {
      background-color: var(--ux-success);
    }

    .ux-segment--success .ux-segment-button--selected {
      color: var(--ux-success-contrast);
    }

    .ux-segment--danger .ux-segment__indicator {
      background-color: var(--ux-danger);
    }

    .ux-segment--danger .ux-segment-button--selected {
      color: var(--ux-danger-contrast);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-segment--sm {
      padding: 2px;
    }

    .ux-segment--sm .ux-segment-button {
      min-height: 28px;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      font-size: var(--ux-font-size-xs);
    }

    .ux-segment--sm .ux-segment-button__icon {
      width: 14px;
      height: 14px;
    }

    .ux-segment--lg {
      padding: 3px;
    }

    .ux-segment--lg .ux-segment-button {
      min-height: 44px;
      padding: var(--ux-space-md) var(--ux-space-lg);
      font-size: var(--ux-font-size-md);
    }

    .ux-segment--lg .ux-segment-button__icon {
      width: 22px;
      height: 22px;
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-segment--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* ========================================
       In Toolbar
    ======================================== */

    .ux-toolbar .ux-segment {
      flex: 1;
      max-width: 400px;
    }

    .ux-navbar .ux-segment {
      flex: 0 1 auto;
    }

    /* ========================================
       Scrollable Segment
    ======================================== */

    .ux-segment--scrollable {
      display: flex;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .ux-segment--scrollable::-webkit-scrollbar {
      display: none;
    }

    .ux-segment--scrollable .ux-segment-button {
      flex: 0 0 auto;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-segment--glass {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-segment--glass .ux-segment__indicator {
      background: var(--ux-glass-bg-thick);
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
    }

    .ux-segment--glass .ux-segment-button--selected {
      color: var(--ux-text);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-segment-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-segment-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for segment
  const segmentComponent = (config = {}) => ({
    value: config.value || null,
    options: config.options || [],
    disabled: config.disabled || false,
    indicatorStyle: {},
    isAnimating: false,

    init() {
      // Set first option as default if no value
      if (this.value === null && this.options.length > 0) {
        this.value = this.options[0].value;
      }
      this.$nextTick(() => {
        this.updateIndicator(false);
      });
    },

    select(optionValue) {
      if (this.disabled) return;
      const option = this.options.find(o => o.value === optionValue);
      if (option?.disabled) return;
      if (this.value === optionValue) return;

      this.value = optionValue;
      this.updateIndicator(true);
    },

    isSelected(optionValue) {
      return this.value === optionValue;
    },

    updateIndicator(animate = true) {
      const container = this.$refs.segment;
      if (!container) return;

      const buttons = container.querySelectorAll('.ux-segment-button');
      const selectedIndex = this.options.findIndex(o => o.value === this.value);
      const selectedButton = buttons[selectedIndex];

      if (selectedButton) {
        // Trigger squish animation
        if (animate) {
          this.isAnimating = true;
          setTimeout(() => {
            this.isAnimating = false;
          }, 300);
        }

        this.indicatorStyle = {
          left: selectedButton.offsetLeft + 'px',
          width: selectedButton.offsetWidth + 'px'
        };
      }
    },

    get selectedOption() {
      return this.options.find(o => o.value === this.value);
    },

    get selectedIndex() {
      return this.options.findIndex(o => o.value === this.value);
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSegment', segmentComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSegment', segmentComponent);
    });
  }
})();

/**
 * UX Select Component
 * Selectores estilo Ionic con mÃºltiples interfaces
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       Native Select Wrapper
    ======================================== */

    .ux-native-select {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .ux-native-select__field {
      width: 100%;
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-md) var(--ux-space-lg);
      padding-right: calc(var(--ux-space-lg) + 24px);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-native-select__field:hover {
      border-color: var(--ux-medium);
    }

    .ux-native-select__field:focus {
      outline: none;
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-native-select__field:disabled {
      background-color: var(--ux-light);
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
      opacity: 0.6;
    }

    .ux-native-select__icon {
      position: absolute;
      right: var(--ux-space-md);
      bottom: var(--ux-space-md);
      pointer-events: none;
      color: var(--ux-text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ux-native-select__icon svg {
      width: 20px;
      height: 20px;
    }

    /* When there's a label, position icon relative to the select field */
    .ux-native-select .ux-select__label + .ux-native-select__field ~ .ux-native-select__icon,
    .ux-native-select .ux-select__label ~ .ux-native-select__field ~ .ux-native-select__icon {
      bottom: auto;
      top: calc(var(--ux-space-xs) + var(--ux-font-size-sm) * 1.5 + var(--ux-touch-target) / 2);
      transform: translateY(-50%);
    }

    /* Helper text for native select */
    .ux-native-select .ux-select__helper {
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* ========================================
       UX Select Container
    ======================================== */

    .ux-select {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    /* ========================================
       Label Placements
    ======================================== */

    /* Default/Stacked - label above */
    .ux-select__label {
      display: block;
      margin-bottom: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-select__label--required::after {
      content: ' *';
      color: var(--ux-danger);
    }

    /* Fixed - label inline with fixed width */
    .ux-select--label-fixed {
      flex-direction: row;
      align-items: center;
    }

    .ux-select--label-fixed .ux-select__label {
      width: 100px;
      flex-shrink: 0;
      margin-bottom: 0;
      margin-right: var(--ux-space-md);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-select--label-fixed .ux-select__wrapper {
      flex: 1;
    }

    /* Start - label inline at start */
    .ux-select--label-start {
      flex-direction: row;
      align-items: center;
    }

    .ux-select--label-start .ux-select__label {
      margin-bottom: 0;
      margin-right: var(--ux-space-md);
      flex-shrink: 0;
    }

    .ux-select--label-start .ux-select__wrapper {
      flex: 1;
    }

    /* End - label inline at end */
    .ux-select--label-end {
      flex-direction: row-reverse;
      align-items: center;
    }

    .ux-select--label-end .ux-select__label {
      margin-bottom: 0;
      margin-left: var(--ux-space-md);
      flex-shrink: 0;
    }

    .ux-select--label-end .ux-select__wrapper {
      flex: 1;
    }

    /* Floating - label floats above on focus/value */
    .ux-select--label-floating {
      position: relative;
    }

    .ux-select--label-floating .ux-select__label {
      position: absolute;
      left: var(--ux-space-lg);
      top: 50%;
      transform: translateY(-50%);
      margin: 0;
      padding: 0 var(--ux-space-xs);
      background-color: var(--ux-surface);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text-tertiary);
      pointer-events: none;
      z-index: 1;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-select--label-floating.ux-select--has-value .ux-select__label,
    .ux-select--label-floating.ux-select--open .ux-select__label {
      top: 0;
      font-size: var(--ux-font-size-xs);
      color: var(--ux-primary);
    }

    .ux-select--label-floating .ux-select__trigger {
      padding-top: var(--ux-space-lg);
    }

    /* ========================================
       Select Trigger
    ======================================== */

    .ux-select__wrapper {
      position: relative;
      width: 100%;
    }

    .ux-select__trigger {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-md) var(--ux-space-lg);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      cursor: pointer;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-select__trigger:hover {
      border-color: var(--ux-medium);
    }

    .ux-select--open .ux-select__trigger {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    /* Fill variants */
    .ux-select--fill-solid .ux-select__trigger {
      background-color: var(--ux-surface-secondary);
      border-color: transparent;
    }

    .ux-select--fill-outline .ux-select__trigger {
      background-color: transparent;
    }

    /* Shape */
    .ux-select--round .ux-select__trigger {
      border-radius: 9999px;
    }

    /* ========================================
       Value & Placeholder
    ======================================== */

    .ux-select__value {
      flex: 1;
      text-align: left;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-select__placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-select__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      margin-left: var(--ux-space-sm);
      color: var(--ux-text-secondary);
      flex-shrink: 0;
    }

    .ux-select__icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Alert Interface (iOS Modal)
    ======================================== */

    .ux-select-alert {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: var(--ux-z-modal);
      padding: var(--ux-space-xl);
    }

    .ux-select-alert__backdrop {
      position: absolute;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.4);
      opacity: 0;
      transition: opacity var(--ux-transition-base) var(--ux-ease);
    }

    .ux-select-alert--open .ux-select-alert__backdrop {
      opacity: 1;
    }

    .ux-select-alert__content {
      position: relative;
      width: 100%;
      max-width: 320px;
      max-height: 80dvh;
      background-color: var(--ux-surface);
      border-radius: var(--ux-border-radius-xl);
      box-shadow: var(--ux-shadow-xl);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transform: scale(0.9);
      opacity: 0;
      transition: all var(--ux-transition-base) var(--ux-ease-spring);
    }

    .ux-select-alert--open .ux-select-alert__content {
      transform: scale(1);
      opacity: 1;
    }

    .ux-select-alert__header {
      padding: var(--ux-space-lg) var(--ux-space-lg) var(--ux-space-md);
      text-align: center;
    }

    .ux-select-alert__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-select-alert__message {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    .ux-select-alert__options {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 0 var(--ux-space-sm);
    }

    .ux-select-alert__option {
      display: flex;
      align-items: center;
      padding: var(--ux-space-md) var(--ux-space-md);
      cursor: pointer;
      border-radius: var(--ux-border-radius);
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-select-alert__option:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-select-alert__option-radio {
      width: 22px;
      height: 22px;
      border: 2px solid var(--ux-border-color);
      border-radius: 50%;
      margin-right: var(--ux-space-md);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-select-alert__option--selected .ux-select-alert__option-radio {
      border-color: var(--ux-primary);
    }

    .ux-select-alert__option-radio::after {
      content: '';
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: var(--ux-primary);
      transform: scale(0);
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-select-alert__option--selected .ux-select-alert__option-radio::after {
      transform: scale(1);
    }

    /* Checkbox for multiple - Ionic style (circular) */
    .ux-select-alert__option-checkbox {
      width: 26px;
      height: 26px;
      border: 2px solid var(--ux-medium);
      border-radius: 50%;
      margin-right: var(--ux-space-md);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all var(--ux-transition-fast) var(--ux-ease);
      background-color: transparent;
    }

    .ux-select-alert__option--selected .ux-select-alert__option-checkbox {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
    }

    .ux-select-alert__option-checkbox svg {
      width: 14px;
      height: 14px;
      color: white;
      opacity: 0;
      transform: scale(0.5);
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-select-alert__option--selected .ux-select-alert__option-checkbox svg {
      opacity: 1;
      transform: scale(1);
    }

    .ux-select-alert__option-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      margin-right: var(--ux-space-sm);
      flex-shrink: 0;
    }

    .ux-select-alert__option-label {
      flex: 1;
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
    }

    .ux-select-alert__footer {
      display: flex;
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-select-alert__button {
      flex: 1;
      padding: var(--ux-space-md) var(--ux-space-lg);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-primary);
      background: none;
      border: none;
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-select-alert__button:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-select-alert__button:active {
      background-color: var(--ux-light);
    }

    .ux-select-alert__button--cancel {
      color: var(--ux-text-secondary);
    }

    .ux-select-alert__button + .ux-select-alert__button {
      border-left: 1px solid var(--ux-border-color);
    }

    .ux-select-alert__button--ok {
      font-weight: 600;
    }

    /* ========================================
       Action Sheet Interface
    ======================================== */

    .ux-select-action-sheet {
      position: fixed;
      inset: 0;
      z-index: var(--ux-z-modal);
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }

    .ux-select-action-sheet__backdrop {
      position: absolute;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.4);
      opacity: 0;
      transition: opacity var(--ux-transition-base) var(--ux-ease);
    }

    .ux-select-action-sheet--open .ux-select-action-sheet__backdrop {
      opacity: 1;
    }

    .ux-select-action-sheet__content {
      position: relative;
      background-color: var(--ux-surface);
      border-radius: var(--ux-border-radius-xl) var(--ux-border-radius-xl) 0 0;
      max-height: 60dvh;
      display: flex;
      flex-direction: column;
      padding-bottom: env(safe-area-inset-bottom);
      transform: translateY(100%);
      transition: transform 350ms cubic-bezier(0.32, 0.72, 0, 1);
    }

    .ux-select-action-sheet--open .ux-select-action-sheet__content {
      transform: translateY(0);
    }

    .ux-select-action-sheet__handle {
      display: flex;
      justify-content: center;
      padding: var(--ux-space-sm) 0;
    }

    .ux-select-action-sheet__handle-bar {
      width: 36px;
      height: 4px;
      background-color: var(--ux-light-shade);
      border-radius: 2px;
    }

    .ux-select-action-sheet__header {
      padding: var(--ux-space-sm) var(--ux-space-lg);
      text-align: center;
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-select-action-sheet__title {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text-secondary);
      margin: 0;
    }

    .ux-select-action-sheet__options {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .ux-select-action-sheet__option {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-md) var(--ux-space-lg);
      font-size: var(--ux-font-size-lg);
      color: var(--ux-primary);
      cursor: pointer;
      border-bottom: 1px solid var(--ux-border-color);
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-select-action-sheet__option:last-child {
      border-bottom: none;
    }

    .ux-select-action-sheet__option:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-select-action-sheet__option--selected {
      font-weight: 600;
    }

    .ux-select-action-sheet__option-check {
      width: 20px;
      height: 20px;
      margin-left: var(--ux-space-sm);
      color: var(--ux-primary);
    }

    .ux-select-action-sheet__option-check svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Popover Interface (Dropdown)
    ======================================== */

    .ux-select__dropdown {
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      right: 0;
      max-height: 300px;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      box-shadow: var(--ux-shadow-lg);
      overflow-y: auto;
      z-index: var(--ux-z-dropdown);
      -webkit-overflow-scrolling: touch;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-select--open .ux-select__dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-select__dropdown--top {
      top: auto;
      bottom: calc(100% + 4px);
      transform: translateY(8px);
    }

    .ux-select--open .ux-select__dropdown--top {
      transform: translateY(0);
    }

    .ux-select__option {
      display: flex;
      align-items: center;
      padding: var(--ux-space-md) var(--ux-space-lg);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-select__option:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-select__option--selected {
      color: var(--ux-primary);
      font-weight: 500;
    }

    .ux-select__option--disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-select__option--focused {
      background-color: var(--ux-surface-secondary);
      outline: 2px solid var(--ux-primary);
      outline-offset: -2px;
    }

    .ux-select__option-check {
      width: 20px;
      height: 20px;
      margin-left: auto;
      color: var(--ux-primary);
      opacity: 0;
    }

    .ux-select__option--selected .ux-select__option-check {
      opacity: 1;
    }

    .ux-select__option-check svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Multi-select chips
    ======================================== */

    .ux-select--multi .ux-select__value {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
    }

    .ux-select__chip {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: 2px 8px;
      background-color: rgba(var(--ux-primary-rgb), 0.15);
      color: var(--ux-primary);
      border-radius: var(--ux-border-radius-sm);
      font-size: var(--ux-font-size-sm);
    }

    .ux-select__chip-remove {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      padding: 0;
      border: none;
      background: none;
      color: var(--ux-primary);
      cursor: pointer;
      opacity: 0.7;
    }

    .ux-select__chip-remove:hover {
      opacity: 1;
    }

    .ux-select__chip-remove svg {
      width: 10px;
      height: 10px;
    }

    /* ========================================
       Helper & Error
    ======================================== */

    .ux-select__helper {
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-select__error {
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-danger);
    }

    .ux-select--error .ux-select__trigger {
      border-color: var(--ux-danger);
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-select--disabled .ux-select__trigger {
      background-color: var(--ux-light);
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-select--sm .ux-select__trigger {
      min-height: var(--ux-touch-target-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
    }

    .ux-select--lg .ux-select__trigger {
      min-height: 52px;
      padding: var(--ux-space-lg) var(--ux-space-xl);
      font-size: var(--ux-font-size-lg);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-select--glass .ux-select__trigger {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-select--glass .ux-select__trigger:hover {
      background: var(--ux-glass-bg);
    }

    .ux-select--glass.ux-select--open .ux-select__trigger {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }

    .ux-select--glass .ux-select__dropdown {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-select--glass .ux-select__option:hover {
      background-color: var(--ux-glass-bg-thick);
    }

    /* Native select glass */
    .ux-native-select--glass .ux-native-select__field {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-native-select--glass .ux-native-select__field:hover {
      background: var(--ux-glass-bg);
    }

    .ux-native-select--glass .ux-native-select__field:focus {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }

    /* ========================================
       Item Integration (like ion-item)
    ======================================== */

    .ux-item .ux-select {
      flex: 1;
    }

    .ux-item .ux-select__trigger {
      border: none;
      border-radius: 0;
      background: transparent;
      padding-left: 0;
      min-height: auto;
    }

    .ux-item .ux-select--open .ux-select__trigger {
      box-shadow: none;
    }

    /* ========================================
       Search Select (Autocomplete)
    ======================================== */

    .ux-search-select {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .ux-search-select__label {
      display: block;
      margin-bottom: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
    }

    .ux-search-select__label--required::after {
      content: ' *';
      color: var(--ux-danger);
    }

    .ux-search-select__wrapper {
      position: relative;
      width: 100%;
    }

    .ux-search-select__input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    .ux-search-select__icon {
      position: absolute;
      left: var(--ux-space-md);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      color: var(--ux-text-tertiary);
      pointer-events: none;
      z-index: 1;
    }

    .ux-search-select__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-search-select__input {
      width: 100%;
      min-height: var(--ux-touch-target);
      padding: var(--ux-space-md) var(--ux-space-lg);
      padding-left: calc(var(--ux-space-md) + 20px + var(--ux-space-sm));
      padding-right: calc(var(--ux-space-md) + 20px + var(--ux-space-sm));
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-search-select__input::placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-search-select__input:hover {
      border-color: var(--ux-medium);
    }

    .ux-search-select__input:focus {
      outline: none;
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-search-select__clear {
      position: absolute;
      right: var(--ux-space-md);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      padding: 0;
      border: none;
      background: var(--ux-light);
      border-radius: 50%;
      color: var(--ux-text-secondary);
      cursor: pointer;
      opacity: 0;
      visibility: hidden;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-search-select--has-value .ux-search-select__clear {
      opacity: 1;
      visibility: visible;
    }

    .ux-search-select__clear:hover {
      background: var(--ux-medium);
      color: var(--ux-text);
    }

    .ux-search-select__clear svg {
      width: 12px;
      height: 12px;
    }

    .ux-search-select__dropdown {
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      right: 0;
      max-height: 300px;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      box-shadow: var(--ux-shadow-lg);
      overflow-y: auto;
      z-index: var(--ux-z-dropdown);
      -webkit-overflow-scrolling: touch;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-search-select--open .ux-search-select__dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-search-select__option {
      display: flex;
      align-items: center;
      padding: var(--ux-space-md) var(--ux-space-lg);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-search-select__option:hover,
    .ux-search-select__option--focused {
      background-color: var(--ux-surface-secondary);
    }

    .ux-search-select__option--selected {
      color: var(--ux-primary);
      font-weight: 500;
      background-color: rgba(var(--ux-primary-rgb), 0.08);
    }

    .ux-search-select__option--disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-search-select__option-content {
      flex: 1;
      min-width: 0;
    }

    .ux-search-select__option-label {
      display: block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-search-select__option-description {
      display: block;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ux-search-select__option-check {
      width: 20px;
      height: 20px;
      margin-left: auto;
      color: var(--ux-primary);
      flex-shrink: 0;
    }

    .ux-search-select__option-check svg {
      width: 100%;
      height: 100%;
    }

    .ux-search-select__empty {
      padding: var(--ux-space-lg);
      text-align: center;
      color: var(--ux-text-secondary);
      font-size: var(--ux-font-size-sm);
    }

    .ux-search-select__loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-lg);
      gap: var(--ux-space-sm);
      color: var(--ux-text-secondary);
      font-size: var(--ux-font-size-sm);
    }

    .ux-search-select__group {
      padding: var(--ux-space-sm) var(--ux-space-lg);
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background-color: var(--ux-surface-secondary);
      position: sticky;
      top: 0;
    }

    .ux-search-select__helper {
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-search-select__error {
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-danger);
    }

    .ux-search-select--error .ux-search-select__input {
      border-color: var(--ux-danger);
    }

    .ux-search-select--disabled .ux-search-select__input {
      background-color: var(--ux-light);
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* Highlight matched text */
    .ux-search-select__highlight {
      background-color: rgba(var(--ux-warning-rgb), 0.3);
      border-radius: 2px;
    }

    /* Glass variant */
    .ux-search-select--glass .ux-search-select__input {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-search-select--glass .ux-search-select__input:hover {
      background: var(--ux-glass-bg);
    }

    .ux-search-select--glass .ux-search-select__input:focus {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }

    .ux-search-select--glass .ux-search-select__dropdown {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-search-select--glass .ux-search-select__option:hover,
    .ux-search-select--glass .ux-search-select__option--focused {
      background-color: var(--ux-glass-bg-thick);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-select-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-select-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for select with multiple interfaces
  const selectComponent = (config = {}) => ({
    isOpen: false,
    value: config.value || null,
    tempValue: null, // For alert interface confirmation
    options: config.options || [],
    placeholder: config.placeholder || 'Select...',
    disabled: config.disabled || false,
    interface: config.interface || 'popover', // 'alert', 'action-sheet', 'popover'
    label: config.label || '',
    labelPlacement: config.labelPlacement || 'stacked', // 'start', 'end', 'fixed', 'floating', 'stacked'
    cancelText: config.cancelText || 'Cancel',
    okText: config.okText || 'OK',
    error: '',
    selectId: config.id || 'ux-select-' + Math.random().toString(36).substr(2, 9),

    get selectedOption() {
      return this.options.find(opt => opt.value === this.value);
    },

    get displayValue() {
      return this.selectedOption ? this.selectedOption.label : '';
    },

    get hasValue() {
      return this.value !== null && this.value !== undefined && this.value !== '';
    },

    get filteredOptions() {
      return this.options;
    },

    select(option) {
      this.selectOption(option);
    },

    open() {
      if (this.disabled) return;
      this.isOpen = true;
      this.tempValue = this.value;
      // Reset focused index to selected item or first item
      const selectedIdx = this.options.findIndex(opt => opt.value === this.value);
      this.focusedIndex = selectedIdx >= 0 ? selectedIdx : 0;
      document.body.style.overflow = 'hidden';
    },

    close() {
      this.isOpen = false;
      document.body.style.overflow = '';
    },

    toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    },

    selectOption(option) {
      if (option.disabled) return;

      if (this.interface === 'alert') {
        this.tempValue = option.value;
      } else {
        this.value = option.value;
        this.error = '';
        this.close();
      }
    },

    confirm() {
      this.value = this.tempValue;
      this.error = '';
      this.close();
    },

    cancel() {
      this.tempValue = this.value;
      this.close();
    },

    isSelected(option) {
      if (this.interface === 'alert') {
        return this.tempValue === option.value;
      }
      return this.value === option.value;
    },

    validate(required = false, message = 'Please select an option') {
      if (required && !this.value) {
        this.error = message;
        return false;
      }
      this.error = '';
      return true;
    },

    reset() {
      this.value = null;
      this.tempValue = null;
      this.error = '';
      this.close();
    },

    focusedIndex: -1,

    handleKeydown(event) {
      const enabledOptions = this.options.filter(opt => !opt.disabled);

      switch (event.key) {
        case 'Escape':
          this.close();
          break;
        case 'Enter':
        case ' ':
          event.preventDefault();
          if (!this.isOpen) {
            this.open();
          } else if (this.focusedIndex >= 0 && this.focusedIndex < enabledOptions.length) {
            this.selectOption(enabledOptions[this.focusedIndex]);
          }
          break;
        case 'ArrowDown':
          event.preventDefault();
          if (!this.isOpen) {
            this.open();
          } else {
            this.focusedIndex = Math.min(this.focusedIndex + 1, enabledOptions.length - 1);
            this.scrollToFocused();
          }
          break;
        case 'ArrowUp':
          event.preventDefault();
          if (!this.isOpen) {
            this.open();
          } else {
            this.focusedIndex = Math.max(this.focusedIndex - 1, 0);
            this.scrollToFocused();
          }
          break;
        case 'Home':
          if (this.isOpen) {
            event.preventDefault();
            this.focusedIndex = 0;
            this.scrollToFocused();
          }
          break;
        case 'End':
          if (this.isOpen) {
            event.preventDefault();
            this.focusedIndex = enabledOptions.length - 1;
            this.scrollToFocused();
          }
          break;
      }
    },

    scrollToFocused() {
      this.$nextTick(() => {
        const dropdown = this.$refs.dropdown;
        const focused = dropdown?.querySelector('.ux-select__option--focused');
        if (focused && dropdown) {
          focused.scrollIntoView({ block: 'nearest' });
        }
      });
    },

    isFocused(index) {
      return this.focusedIndex === index;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSelect', selectComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSelect', selectComponent);
    });
  }

  // Alpine component for multi-select
  const multiSelectComponent = (config = {}) => ({
    isOpen: false,
    values: config.values || [],
    tempValues: [], // For alert interface confirmation
    options: config.options || [],
    placeholder: config.placeholder || 'Select...',
    disabled: config.disabled || false,
    interface: config.interface || 'alert', // Multi-select typically uses alert
    label: config.label || '',
    labelPlacement: config.labelPlacement || 'stacked',
    cancelText: config.cancelText || 'Cancel',
    okText: config.okText || 'OK',
    error: '',
    maxSelections: config.maxSelections || null,
    multiSelectId: config.id || 'ux-multi-select-' + Math.random().toString(36).substr(2, 9),

    get selectedOptions() {
      return this.options.filter(opt => this.values.includes(opt.value));
    },

    get displayValue() {
      if (this.selectedOptions.length === 0) return '';
      if (this.selectedOptions.length === 1) return this.selectedOptions[0].label;
      return `${this.selectedOptions.length} selected`;
    },

    get hasValue() {
      return this.values.length > 0;
    },

    get canSelectMore() {
      return !this.maxSelections || this.tempValues.length < this.maxSelections;
    },

    get filteredOptions() {
      return this.options;
    },

    open() {
      if (this.disabled) return;
      this.isOpen = true;
      this.tempValues = [...this.values];
      document.body.style.overflow = 'hidden';
    },

    close() {
      this.isOpen = false;
      document.body.style.overflow = '';
    },

    toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    },

    toggleOption(option) {
      if (option.disabled) return;

      const index = this.tempValues.indexOf(option.value);
      if (index === -1) {
        if (this.canSelectMore) {
          this.tempValues.push(option.value);
        }
      } else {
        this.tempValues.splice(index, 1);
      }
    },

    isSelected(option) {
      return this.tempValues.includes(option.value);
    },

    confirm() {
      this.values = [...this.tempValues];
      this.error = '';
      this.close();
    },

    cancel() {
      this.tempValues = [...this.values];
      this.close();
    },

    removeValue(value) {
      const index = this.values.indexOf(value);
      if (index !== -1) {
        this.values.splice(index, 1);
      }
    },

    validate(required = false, message = 'Please select at least one option') {
      if (required && this.values.length === 0) {
        this.error = message;
        return false;
      }
      this.error = '';
      return true;
    },

    reset() {
      this.values = [];
      this.tempValues = [];
      this.error = '';
      this.close();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxMultiSelect', multiSelectComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxMultiSelect', multiSelectComponent);
    });
  }

  // Alpine component for search select (autocomplete)
  // Opens dropdown after minChars (default 2) characters typed
  const searchSelectComponent = (config = {}) => ({
    isOpen: false,
    query: '',
    value: config.value || null,
    options: config.options || [],
    placeholder: config.placeholder || 'Search...',
    disabled: config.disabled || false,
    minChars: config.minChars ?? 2,
    maxResults: config.maxResults || 50,
    emptyText: config.emptyText || 'No results found',
    loadingText: config.loadingText || 'Searching...',
    loading: false,
    error: '',
    focusedIndex: -1,
    searchSelectId: config.id || 'ux-search-select-' + Math.random().toString(36).substr(2, 9),

    // Display field for selected value
    get displayValue() {
      const selected = this.options.find(opt => opt.value === this.value);
      return selected ? selected.label : '';
    },

    get hasValue() {
      return this.value !== null && this.value !== undefined && this.value !== '';
    },

    // Filter options based on query
    get filteredOptions() {
      if (!this.query || this.query.length < this.minChars) {
        return [];
      }

      const q = this.query.toLowerCase().trim();
      const filtered = this.options.filter(opt => {
        if (opt.disabled) return false;
        const label = (opt.label || '').toLowerCase();
        const description = (opt.description || '').toLowerCase();
        const searchText = (opt.searchText || '').toLowerCase();
        return label.includes(q) || description.includes(q) || searchText.includes(q);
      });

      return filtered.slice(0, this.maxResults);
    },

    get shouldShowDropdown() {
      return this.isOpen && this.query.length >= this.minChars;
    },

    init() {
      // If value is set, populate query with display value
      if (this.value) {
        this.query = this.displayValue;
      }
    },

    handleInput() {
      this.error = '';

      if (this.query.length >= this.minChars) {
        this.isOpen = true;
        this.focusedIndex = 0;
      } else {
        this.isOpen = false;
        this.focusedIndex = -1;
      }

      // Clear value if query changed from selected value
      if (this.value && this.query !== this.displayValue) {
        this.value = null;
      }
    },

    handleFocus() {
      if (this.query.length >= this.minChars) {
        this.isOpen = true;
      }
    },

    handleBlur() {
      // Delay close to allow click on option
      setTimeout(() => {
        this.isOpen = false;
        // Reset query to selected value if exists
        if (this.value) {
          this.query = this.displayValue;
        }
      }, 200);
    },

    selectOption(option) {
      if (option.disabled) return;

      this.value = option.value;
      this.query = option.label;
      this.error = '';
      this.isOpen = false;
      this.focusedIndex = -1;

      this.$dispatch('ux-search-select:change', {
        value: option.value,
        option: option
      });
    },

    clear() {
      this.value = null;
      this.query = '';
      this.error = '';
      this.isOpen = false;
      this.focusedIndex = -1;
      this.$refs.input?.focus();

      this.$dispatch('ux-search-select:clear');
    },

    isSelected(option) {
      return this.value === option.value;
    },

    handleKeydown(event) {
      const options = this.filteredOptions;

      switch (event.key) {
        case 'Escape':
          this.isOpen = false;
          this.focusedIndex = -1;
          break;

        case 'Enter':
          event.preventDefault();
          if (this.isOpen && this.focusedIndex >= 0 && this.focusedIndex < options.length) {
            this.selectOption(options[this.focusedIndex]);
          }
          break;

        case 'ArrowDown':
          event.preventDefault();
          if (!this.isOpen && this.query.length >= this.minChars) {
            this.isOpen = true;
          }
          if (this.isOpen && options.length > 0) {
            this.focusedIndex = Math.min(this.focusedIndex + 1, options.length - 1);
            this.scrollToFocused();
          }
          break;

        case 'ArrowUp':
          event.preventDefault();
          if (this.isOpen && options.length > 0) {
            this.focusedIndex = Math.max(this.focusedIndex - 1, 0);
            this.scrollToFocused();
          }
          break;

        case 'Tab':
          // Select focused option on tab if dropdown is open
          if (this.isOpen && this.focusedIndex >= 0 && this.focusedIndex < options.length) {
            this.selectOption(options[this.focusedIndex]);
          }
          break;
      }
    },

    scrollToFocused() {
      this.$nextTick(() => {
        const dropdown = this.$refs.dropdown;
        const focused = dropdown?.querySelector('.ux-search-select__option--focused');
        if (focused && dropdown) {
          focused.scrollIntoView({ block: 'nearest' });
        }
      });
    },

    isFocused(index) {
      return this.focusedIndex === index;
    },

    // Highlight matching text in label
    highlightMatch(text) {
      if (!this.query || this.query.length < this.minChars) return text;

      const q = this.query.trim();
      const regex = new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      return text.replace(regex, '<span class="ux-search-select__highlight">$1</span>');
    },

    validate(required = false, message = 'Please select an option') {
      if (required && !this.value) {
        this.error = message;
        return false;
      }
      this.error = '';
      return true;
    },

    reset() {
      this.value = null;
      this.query = '';
      this.error = '';
      this.isOpen = false;
      this.focusedIndex = -1;
    },

    // For async loading (can be called externally)
    setOptions(options) {
      this.options = options;
      this.loading = false;
    },

    setLoading(loading) {
      this.loading = loading;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSearchSelect', searchSelectComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSearchSelect', searchSelectComponent);
    });
  }
})();

/**
 * UX Sheet Component
 * Bottom sheets y side sheets estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Sheet Backdrop
    ======================================== */

    .ux-sheet-backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: var(--ux-z-modal-backdrop);
      opacity: 0;
      visibility: hidden;
      transition:
        opacity 350ms var(--ux-ease-ios),
        visibility 350ms var(--ux-ease-ios);
    }

    .ux-sheet-backdrop--open {
      opacity: 1;
      visibility: visible;
      transition:
        opacity 300ms var(--ux-ease-ios),
        visibility 300ms var(--ux-ease-ios);
    }

    /* ========================================
       UX Bottom Sheet
    ======================================== */

    .ux-sheet {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      max-height: var(--ux-modal-max-height);
      /* Glass by default (iOS style) */
      background-color: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border-radius: var(--ux-sheet-border-radius) var(--ux-sheet-border-radius) 0 0;
      border-top: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      display: flex;
      flex-direction: column;
      z-index: var(--ux-z-modal);
      transform: translateY(100%);
      /* iOS-style smooth transition for closing */
      transition: transform 350ms var(--ux-ease-ios);
      padding-bottom: env(safe-area-inset-bottom);
      will-change: transform;
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-sheet {
        background-color: var(--ux-surface);
      }
    }

    .ux-sheet-backdrop--open .ux-sheet {
      transform: translateY(0);
      /* Slightly slower for opening - feels more natural */
      transition: transform 400ms var(--ux-ease-ios);
    }

    /* ========================================
       Sheet Handle
    ======================================== */

    .ux-sheet__handle {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-sm) 0;
      cursor: grab;
      flex-shrink: 0;
    }

    .ux-sheet__handle:active {
      cursor: grabbing;
    }

    .ux-sheet__handle-bar {
      width: var(--ux-sheet-handle-width);
      height: var(--ux-sheet-handle-height);
      background-color: var(--ux-light-shade);
      border-radius: calc(var(--ux-sheet-handle-height) / 2);
    }

    /* ========================================
       Sheet Header
    ======================================== */

    .ux-sheet__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm) var(--ux-space-lg);
      border-bottom: 0.5px solid var(--ux-glass-border);
      flex-shrink: 0;
    }

    .ux-sheet__header--no-border {
      border-bottom: none;
    }

    .ux-sheet__title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-sheet__close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
      background-color: var(--ux-surface-secondary);
      border: none;
      border-radius: 50%;
      color: var(--ux-text-secondary);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-sheet__close:hover {
      background-color: var(--ux-light);
    }

    .ux-sheet__close:active {
      background-color: var(--ux-light-shade);
    }

    .ux-sheet__close-icon {
      width: 18px;
      height: 18px;
    }

    .ux-sheet__close-icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Sheet Content
    ======================================== */

    .ux-sheet__content {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: var(--ux-space-lg);
    }

    .ux-sheet__content--no-padding {
      padding: 0;
    }

    /* ========================================
       Sheet Footer
    ======================================== */

    .ux-sheet__footer {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md) var(--ux-space-lg);
      border-top: 0.5px solid var(--ux-glass-border);
      flex-shrink: 0;
    }

    .ux-sheet__footer--row {
      flex-direction: row;
      justify-content: flex-end;
    }

    .ux-sheet__footer .ux-button {
      width: 100%;
    }

    .ux-sheet__footer--row .ux-button {
      width: auto;
      flex: 1;
    }

    /* ========================================
       Sheet Sizes
    ======================================== */

    .ux-sheet--sm {
      height: 40dvh;
      max-height: 40dvh;
    }

    .ux-sheet--md {
      height: 60dvh;
      max-height: 60dvh;
    }

    .ux-sheet--lg {
      height: 80dvh;
      max-height: 80dvh;
    }

    .ux-sheet--full {
      height: 100dvh;
      max-height: 100dvh;
      border-radius: 0;
    }

    /* Auto height based on content */
    .ux-sheet--auto {
      height: auto;
      max-height: 90dvh;
    }

    /* ========================================
       Sheet Detents (snap points)
    ======================================== */

    .ux-sheet--detent-small {
      max-height: 25dvh;
    }

    .ux-sheet--detent-medium {
      max-height: 50dvh;
    }

    .ux-sheet--detent-large {
      max-height: 90dvh;
    }

    /* ========================================
       Glass Sheet (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    /* Sheet uses heavier blur for prominence */
    .ux-sheet--glass {
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border-top: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
    }

    .ux-sheet--glass .ux-sheet__header {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-sheet--glass .ux-sheet__footer {
      border-top-color: var(--ux-glass-border);
    }

    .ux-sheet--glass .ux-sheet__handle-bar {
      background-color: rgba(0, 0, 0, 0.2);
    }

    /* Dark mode glass sheet */
    @media (prefers-color-scheme: dark) {
      .ux-sheet--glass .ux-sheet__handle-bar {
        background-color: rgba(255, 255, 255, 0.3);
      }
    }

    .ux-dark .ux-sheet--glass .ux-sheet__handle-bar {
      background-color: rgba(255, 255, 255, 0.3);
    }

    /* ========================================
       Side Sheet
    ======================================== */

    .ux-side-sheet {
      position: fixed;
      top: 0;
      bottom: 0;
      width: 320px;
      max-width: 85dvw;
      /* Glass by default (iOS style) */
      background-color: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
      display: flex;
      flex-direction: column;
      z-index: var(--ux-z-modal);
      /* iOS-style smooth transition for closing */
      transition: transform 350ms var(--ux-ease-ios);
      will-change: transform;
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-side-sheet {
        background-color: var(--ux-surface);
      }
    }

    .ux-side-sheet--left {
      left: 0;
      border-radius: 0 var(--ux-border-radius-xl) var(--ux-border-radius-xl) 0;
      transform: translateX(-100%);
    }

    .ux-side-sheet--right {
      right: 0;
      border-radius: var(--ux-border-radius-xl) 0 0 var(--ux-border-radius-xl);
      transform: translateX(100%);
    }

    .ux-sheet-backdrop--open .ux-side-sheet--left,
    .ux-sheet-backdrop--open .ux-side-sheet--right {
      transform: translateX(0);
      /* Slightly slower for opening */
      transition: transform 400ms var(--ux-ease-ios);
    }

    /* ========================================
       Side Sheet with Bootstrap Grid
       Use Bootstrap columns for responsive width:
       col-10 col-md-6 col-lg-4 etc.
    ======================================== */

    .ux-side-sheet-container {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: var(--ux-z-modal);
      pointer-events: none;
      overflow: hidden;
    }

    .ux-side-sheet-container > .row {
      height: 100%;
      margin: 0;
    }

    .ux-side-sheet-container [class*="col"] {
      padding: 0;
      height: 100%;
      pointer-events: auto;
    }

    /* Left side sheet (default) */
    .ux-side-sheet-container--left [class*="col"] {
      transform: translateX(-100%);
      transition: transform 350ms var(--ux-ease-ios);
    }

    /* Right side sheet */
    .ux-side-sheet-container--right > .row {
      justify-content: flex-end;
    }

    .ux-side-sheet-container--right [class*="col"] {
      transform: translateX(100%);
      transition: transform 350ms var(--ux-ease-ios);
    }

    /* Open state */
    .ux-sheet-backdrop--open .ux-side-sheet-container [class*="col"] {
      transform: translateX(0);
      transition: transform 400ms var(--ux-ease-ios);
    }

    /* Side sheet inside grid column */
    .ux-side-sheet--grid {
      position: relative;
      width: 100%;
      height: 100%;
      max-width: none;
      border-radius: 0;
      transform: none;
    }

    /* Border radius for grid side sheets */
    .ux-side-sheet-container--left .ux-side-sheet--grid {
      border-radius: 0 var(--ux-border-radius-xl) var(--ux-border-radius-xl) 0;
    }

    .ux-side-sheet-container--right .ux-side-sheet--grid {
      border-radius: var(--ux-border-radius-xl) 0 0 var(--ux-border-radius-xl);
    }

    /* Side Sheet Header */
    .ux-side-sheet__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 56px;
      padding: var(--ux-space-md) var(--ux-space-lg);
      padding-top: calc(var(--ux-space-md) + env(safe-area-inset-top));
      border-bottom: 0.5px solid var(--ux-glass-border);
      flex-shrink: 0;
    }

    .ux-side-sheet__content {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .ux-side-sheet__footer {
      padding: var(--ux-space-md) var(--ux-space-lg);
      padding-bottom: calc(var(--ux-space-md) + env(safe-area-inset-bottom));
      border-top: 0.5px solid var(--ux-glass-border);
      flex-shrink: 0;
    }

    /* ========================================
       Action Sheet
    ======================================== */

    .ux-action-sheet {
      position: fixed;
      left: var(--ux-space-sm);
      right: var(--ux-space-sm);
      bottom: var(--ux-space-sm);
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
      z-index: var(--ux-z-modal);
      transform: translateY(calc(100% + var(--ux-space-lg)));
      /* iOS-style smooth transition for closing */
      transition: transform 350ms var(--ux-ease-ios);
      padding-bottom: env(safe-area-inset-bottom);
      will-change: transform;
    }

    .ux-sheet-backdrop--open .ux-action-sheet {
      transform: translateY(0);
      /* Slightly slower for opening */
      transition: transform 400ms var(--ux-ease-ios);
    }

    .ux-action-sheet__group {
      /* Glass by default (iOS style) */
      background-color: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-action-sheet__group {
        background-color: var(--ux-surface);
      }
    }

    .ux-action-sheet__header {
      padding: var(--ux-space-md) var(--ux-space-lg);
      text-align: center;
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    .ux-action-sheet__title {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text-secondary);
      margin: 0;
    }

    .ux-action-sheet__message {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-tertiary);
      margin: var(--ux-space-xs) 0 0;
    }

    .ux-action-sheet__button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      min-height: 56px;
      padding: var(--ux-space-md) var(--ux-space-lg);
      background: none;
      border: none;
      color: var(--ux-primary);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-lg);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-action-sheet__button:not(:last-child) {
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    .ux-action-sheet__button:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-action-sheet__button:active {
      background-color: var(--ux-light);
    }

    .ux-action-sheet__button--destructive {
      color: var(--ux-danger);
    }

    .ux-action-sheet__button--cancel {
      font-weight: 600;
    }

    .ux-action-sheet__button-icon {
      width: 24px;
      height: 24px;
      margin-right: var(--ux-space-md);
    }

    .ux-action-sheet__button-icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Glass Action Sheet (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    /* Action sheet uses heavier blur for prominence */
    .ux-action-sheet--glass .ux-action-sheet__group {
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-action-sheet--glass .ux-action-sheet__header {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-action-sheet--glass .ux-action-sheet__button:not(:last-child) {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-action-sheet--glass .ux-action-sheet__button:hover {
      background-color: rgba(0, 0, 0, 0.04);
    }

    /* Dark mode glass action sheet */
    @media (prefers-color-scheme: dark) {
      .ux-action-sheet--glass .ux-action-sheet__button:hover {
        background-color: rgba(255, 255, 255, 0.08);
      }
    }

    .ux-dark .ux-action-sheet--glass .ux-action-sheet__button:hover {
      background-color: rgba(255, 255, 255, 0.08);
    }

    /* ========================================
       Sheet with Scroll Lock Indicator
    ======================================== */

    .ux-sheet--scroll-lock .ux-sheet__content {
      overscroll-behavior-y: contain;
    }

    /* Sheet dragging state */
    .ux-sheet--dragging {
      transition: none !important;
    }

    /* ========================================
       Bootstrap Grid Support
       Use with: .ux-sheet-backdrop--grid .container .row .col-*
       Higher specificity selectors to override base fixed positioning
    ======================================== */

    .ux-sheet-backdrop.ux-sheet-backdrop--grid {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      overflow-x: hidden;
      overflow-y: scroll;
      -webkit-overflow-scrolling: touch;
    }

    .ux-sheet-backdrop.ux-sheet-backdrop--grid > .container,
    .ux-sheet-backdrop.ux-sheet-backdrop--grid > .container-fluid {
      width: 100%;
      max-width: 100%;
      padding-bottom: calc(var(--ux-space-lg) + env(safe-area-inset-bottom));
    }

    .ux-sheet-backdrop.ux-sheet-backdrop--grid .row {
      margin-left: 0;
      margin-right: 0;
    }

    /* Bottom sheet with grid - override fixed positioning */
    .ux-sheet-backdrop.ux-sheet-backdrop--grid .ux-sheet {
      position: static;
      left: auto;
      right: auto;
      bottom: auto;
      transform: translateY(100%);
      margin: 0;
      width: 100%;
    }

    .ux-sheet-backdrop.ux-sheet-backdrop--grid.ux-sheet-backdrop--open .ux-sheet {
      transform: translateY(0);
    }

    /* Action sheet with grid - override fixed positioning */
    .ux-sheet-backdrop.ux-sheet-backdrop--grid .ux-action-sheet {
      position: static;
      left: auto;
      right: auto;
      bottom: auto;
      transform: translateY(calc(100% + var(--ux-space-lg)));
      margin: 0;
      width: 100%;
      will-change: transform;
    }

    .ux-sheet-backdrop.ux-sheet-backdrop--grid.ux-sheet-backdrop--open .ux-action-sheet {
      transform: translateY(0);
      will-change: auto;
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .ux-sheet-backdrop {
        transition: opacity 0.1s ease, visibility 0.1s ease;
      }

      .ux-sheet,
      .ux-side-sheet,
      .ux-action-sheet {
        transition: transform 0.1s ease;
      }

      .ux-sheet-backdrop--open .ux-sheet,
      .ux-sheet-backdrop--open .ux-side-sheet--left,
      .ux-sheet-backdrop--open .ux-side-sheet--right,
      .ux-sheet-backdrop--open .ux-action-sheet {
        transition: transform 0.1s ease;
      }
    }

  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-sheet-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-sheet-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for bottom sheet
  // ARIA: role="dialog", aria-modal="true", aria-labelledby
  // Features: snap points (detents), velocity-based gestures, focus trap
  const sheetComponent = (config = {}) => ({
    isOpen: config.isOpen || false,
    detent: config.detent || 'medium', // small, medium, large
    detents: config.detents || ['medium', 'large'], // Available snap points
    closeOnBackdrop: config.closeOnBackdrop !== false,
    closeOnEscape: config.closeOnEscape !== false,
    draggable: config.draggable !== false,
    startY: 0,
    currentY: 0,
    isDragging: false,
    sheetId: config.id || 'ux-sheet-' + Math.random().toString(36).substr(2, 9),
    _touchStartTime: 0,
    _previousActiveElement: null,
    _focusTrapCleanup: null,

    // Detent heights as percentages of viewport
    _detentHeights: {
      small: 25,
      medium: 50,
      large: 90
    },

    // ARIA attributes for the sheet
    get ariaAttrs() {
      return {
        'role': 'dialog',
        'aria-modal': 'true',
        'aria-labelledby': this.sheetId + '-title'
      };
    },

    get titleId() {
      return this.sheetId + '-title';
    },

    open(detent) {
      if (detent) this.detent = detent;
      this._previousActiveElement = document.activeElement;
      this.isOpen = true;

      // Use global scroll lock if available
      if (window.UX && window.UX.lockScroll) {
        window.UX.lockScroll();
      } else {
        document.body.style.overflow = 'hidden';
      }

      // Setup focus trap
      this.$nextTick(() => {
        const sheet = this.$refs.sheet || this.$el.querySelector('.ux-sheet, .ux-side-sheet');
        if (sheet && window.UX && window.UX.trapFocus) {
          this._focusTrapCleanup = window.UX.trapFocus(sheet);
        } else if (sheet) {
          // Fallback: focus first focusable element
          const focusable = sheet.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
          if (focusable) focusable.focus();
        }

        // Announce to screen readers
        if (window.UX && window.UX.announce) {
          const title = this.$el.querySelector('[id$="-title"]');
          if (title) {
            window.UX.announce(title.textContent + ' sheet opened', 'assertive');
          }
        }
      });
    },

    close() {
      this.isOpen = false;

      // Cleanup focus trap
      if (this._focusTrapCleanup) {
        this._focusTrapCleanup();
        this._focusTrapCleanup = null;
      }

      // Use global scroll unlock if available
      if (window.UX && window.UX.unlockScroll) {
        window.UX.unlockScroll();
      } else {
        document.body.style.overflow = '';
      }

      // Restore focus
      if (this._previousActiveElement && this._previousActiveElement.focus) {
        this._previousActiveElement.focus();
      }
    },

    toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    },

    setDetent(detent) {
      this.detent = detent;
    },

    handleBackdropClick(event) {
      if (this.closeOnBackdrop && event.target === event.currentTarget) {
        this.close();
      }
    },

    handleKeydown(event) {
      if (this.closeOnEscape && event.key === 'Escape') {
        this.close();
      }
    },

    handleTouchStart(event) {
      if (!this.draggable) return;
      this.isDragging = true;
      this.startY = event.touches[0].clientY;
      this._touchStartTime = Date.now();

      // Add dragging class for no-transition state
      const sheet = this.$refs.sheet || this.$el.querySelector('.ux-sheet');
      if (sheet) sheet.classList.add('ux-sheet--dragging');
    },

    handleTouchMove(event) {
      if (!this.isDragging) return;
      this.currentY = event.touches[0].clientY - this.startY;

      // Only allow dragging down
      if (this.currentY < 0) {
        this.currentY = 0;
      }
    },

    handleTouchEnd() {
      if (!this.isDragging) return;
      this.isDragging = false;

      // Remove dragging class
      const sheet = this.$refs.sheet || this.$el.querySelector('.ux-sheet');
      if (sheet) sheet.classList.remove('ux-sheet--dragging');

      // Calculate velocity (pixels per millisecond)
      const touchDuration = Date.now() - this._touchStartTime;
      const velocity = this.currentY / touchDuration;

      // Fast swipe (velocity > 0.5 px/ms) - close immediately
      if (velocity > 0.5) {
        this.currentY = 0;
        this.close();
        return;
      }

      // Snap to detent based on drag distance
      const threshold = velocity > 0.2 ? 50 : 100; // Lower threshold for faster swipes

      if (this.currentY > threshold) {
        // Check if we should snap to a smaller detent or close
        const currentDetentIndex = this.detents.indexOf(this.detent);
        if (currentDetentIndex > 0) {
          // Snap to smaller detent
          this.detent = this.detents[currentDetentIndex - 1];
        } else {
          // Close the sheet
          this.close();
        }
      }

      this.currentY = 0;
    },

    getSheetStyle() {
      if (this.currentY > 0) {
        return {
          transform: `translateY(${this.currentY}px)`
        };
      }
      return {};
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSheet', sheetComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSheet', sheetComponent);
    });
  }

  // Alpine component for action sheet
  // ARIA: role="dialog", aria-modal="true", aria-labelledby
  const actionSheetComponent = (config = {}) => ({
    isOpen: false,
    title: config.title || '',
    message: config.message || '',
    buttons: config.buttons || [],
    cancelText: config.cancelText || 'Cancel',
    closeOnEscape: config.closeOnEscape !== false,
    actionSheetId: config.id || 'ux-action-sheet-' + Math.random().toString(36).substr(2, 9),
    _previousActiveElement: null,
    _focusTrapCleanup: null,

    // ARIA attributes
    get ariaAttrs() {
      return {
        'role': 'dialog',
        'aria-modal': 'true',
        'aria-labelledby': this.actionSheetId + '-title'
      };
    },

    get titleId() {
      return this.actionSheetId + '-title';
    },

    open(options = {}) {
      if (options.title) this.title = options.title;
      if (options.message) this.message = options.message;
      if (options.buttons) this.buttons = options.buttons;
      if (options.cancelText) this.cancelText = options.cancelText;

      this._previousActiveElement = document.activeElement;
      this.isOpen = true;

      // Use global scroll lock if available
      if (window.UX && window.UX.lockScroll) {
        window.UX.lockScroll();
      } else {
        document.body.style.overflow = 'hidden';
      }

      // Setup focus trap
      this.$nextTick(() => {
        const actionSheet = this.$el.querySelector('.ux-action-sheet');
        if (actionSheet && window.UX && window.UX.trapFocus) {
          this._focusTrapCleanup = window.UX.trapFocus(actionSheet);
        }
      });
    },

    close() {
      this.isOpen = false;

      // Cleanup focus trap
      if (this._focusTrapCleanup) {
        this._focusTrapCleanup();
        this._focusTrapCleanup = null;
      }

      // Use global scroll unlock if available
      if (window.UX && window.UX.unlockScroll) {
        window.UX.unlockScroll();
      } else {
        document.body.style.overflow = '';
      }

      // Restore focus
      if (this._previousActiveElement && this._previousActiveElement.focus) {
        this._previousActiveElement.focus();
      }
    },

    handleKeydown(event) {
      if (this.closeOnEscape && event.key === 'Escape') {
        this.close();
      }
    },

    handleButtonClick(button) {
      if (button.handler && typeof button.handler === 'function') {
        button.handler();
      }
      this.close();
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxActionSheet', actionSheetComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxActionSheet', actionSheetComponent);
    });
  }
})();

/**
 * UX Shell - Application Shell Layouts
 * Provides navbar, sidebar, toolbar, and bottom navigation
 * @version 1.0.0
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Shell - Application Layout System
    ======================================== */

    .ux-shell {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      min-height: 100dvh;
      background: var(--ux-background);
    }

    /* Navbar */
    .ux-shell__navbar {
      position: sticky;
      top: 0;
      z-index: var(--ux-z-sticky);
      display: flex;
      align-items: center;
      height: var(--ux-toolbar-height);
      padding: 0 var(--ux-space-lg);
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      gap: var(--ux-space-md);
    }

    .ux-shell__navbar-toggle {
      display: none;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      padding: 0;
      border: none;
      background: transparent;
      color: var(--ux-text);
      cursor: pointer;
      border-radius: var(--ux-border-radius);
      transition: background var(--ux-transition-fast);
    }

    .ux-shell__navbar-toggle:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-shell__navbar-toggle svg {
      width: 20px;
      height: 20px;
    }

    .ux-shell__navbar-brand {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-shell__navbar-content {
      flex: 1;
    }

    .ux-shell__navbar-actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    /* Sidebar */
    .ux-shell--sidebar {
      --ux-shell-sidebar-width: 260px;
      --ux-shell-sidebar-collapsed-width: 60px;
    }

    .ux-shell--sidebar .ux-shell__navbar-toggle {
      display: flex;
    }

    .ux-shell__sidebar {
      position: fixed;
      top: var(--ux-toolbar-height);
      left: 0;
      bottom: 0;
      width: var(--ux-shell-sidebar-width);
      background: var(--ux-surface);
      border-right: 1px solid var(--ux-border-color);
      z-index: var(--ux-z-fixed);
      overflow-y: auto;
      overflow-x: hidden;
      transition: width var(--ux-transition-normal) var(--ux-ease-ios),
                  transform var(--ux-transition-normal) var(--ux-ease-ios);
    }

    .ux-shell--sidebar-collapsed .ux-shell__sidebar {
      width: var(--ux-shell-sidebar-collapsed-width);
    }

    .ux-shell__sidebar-nav {
      padding: var(--ux-space-sm) 0;
    }

    .ux-shell__sidebar-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md) var(--ux-space-lg);
      color: var(--ux-text-secondary);
      text-decoration: none;
      transition: background var(--ux-transition-fast), color var(--ux-transition-fast);
      white-space: nowrap;
      overflow: hidden;
    }

    .ux-shell__sidebar-item:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-shell__sidebar-item--active {
      color: var(--ux-primary);
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-shell__sidebar-item-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .ux-shell__sidebar-item-icon svg {
      width: 20px;
      height: 20px;
    }

    .ux-shell__sidebar-item-text {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-shell--sidebar-collapsed .ux-shell__sidebar-item-text {
      opacity: 0;
      visibility: hidden;
    }

    /* Sidebar Backdrop (mobile) */
    .ux-shell__sidebar-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: var(--ux-backdrop-color);
      z-index: calc(var(--ux-z-fixed) - 1);
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--ux-transition-normal), visibility var(--ux-transition-normal);
    }

    /* Main Content */
    .ux-shell__main {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .ux-shell--sidebar .ux-shell__main {
      margin-left: var(--ux-shell-sidebar-width);
      transition: margin-left var(--ux-transition-normal) var(--ux-ease-ios);
    }

    .ux-shell--sidebar-collapsed .ux-shell__main {
      margin-left: var(--ux-shell-sidebar-collapsed-width);
    }

    /* Toolbar */
    .ux-shell__toolbar {
      display: flex;
      align-items: center;
      height: var(--ux-toolbar-height);
      padding: 0 var(--ux-space-lg);
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      gap: var(--ux-space-md);
    }

    .ux-shell--toolbar .ux-shell__main {
      padding-top: 0;
    }

    /* Bottom Navigation */
    .ux-shell__bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: calc(50px + var(--ux-safe-bottom));
      padding-bottom: var(--ux-safe-bottom);
      background: var(--ux-surface);
      border-top: 1px solid var(--ux-border-color);
      z-index: var(--ux-z-sticky);
    }

    .ux-shell__bottom-nav-items {
      display: flex;
      align-items: center;
      justify-content: space-around;
      height: 50px;
    }

    .ux-shell__bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      padding: var(--ux-space-xs);
      color: var(--ux-text-secondary);
      text-decoration: none;
      font-size: 10px;
      min-width: 64px;
    }

    .ux-shell__bottom-nav-item--active {
      color: var(--ux-primary);
    }

    .ux-shell__bottom-nav-item svg {
      width: 24px;
      height: 24px;
    }

    /* Mobile Responsive */
    @media (max-width: 767px) {
      .ux-shell--sidebar .ux-shell__sidebar {
        transform: translateX(-100%);
        width: var(--ux-shell-sidebar-width);
      }

      .ux-shell--sidebar-open .ux-shell__sidebar {
        transform: translateX(0);
      }

      .ux-shell--sidebar .ux-shell__sidebar-backdrop {
        display: block;
      }

      .ux-shell--sidebar-open .ux-shell__sidebar-backdrop {
        opacity: 1;
        visibility: visible;
      }

      .ux-shell--sidebar .ux-shell__main,
      .ux-shell--sidebar-collapsed .ux-shell__main {
        margin-left: 0;
      }

      .ux-shell__bottom-nav {
        display: block;
      }

      .ux-shell--bottom-nav .ux-shell__main {
        padding-bottom: calc(50px + var(--ux-safe-bottom));
      }
    }

    /* Glass Variant */
    .ux-shell--glass .ux-shell__navbar,
    .ux-shell--glass .ux-shell__sidebar,
    .ux-shell--glass .ux-shell__toolbar,
    .ux-shell--glass .ux-shell__bottom-nav {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    /* Dark Mode */
    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light) .ux-shell--glass .ux-shell__navbar,
      :root:not(.ux-light) .ux-shell--glass .ux-shell__sidebar,
      :root:not(.ux-light) .ux-shell--glass .ux-shell__toolbar,
      :root:not(.ux-light) .ux-shell--glass .ux-shell__bottom-nav {
        background: var(--ux-glass-bg);
      }
    }

    .ux-dark .ux-shell--glass .ux-shell__navbar,
    .ux-dark .ux-shell--glass .ux-shell__sidebar,
    .ux-dark .ux-shell--glass .ux-shell__toolbar,
    .ux-dark .ux-shell--glass .ux-shell__bottom-nav {
      background: var(--ux-glass-bg);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-shell-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-shell-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js Shell component
  const shellData = (options = {}) => ({
    sidebarOpen: false,
    sidebarCollapsed: options.collapsed ?? false,
    breakpoint: options.breakpoint ?? 768,

    init() {
      this.checkViewport();
      window.addEventListener('resize', () => this.checkViewport());
    },

    get shellClasses() {
      return {
        'ux-shell--sidebar-open': this.sidebarOpen,
        'ux-shell--sidebar-collapsed': this.sidebarCollapsed && window.innerWidth >= this.breakpoint
      };
    },

    checkViewport() {
      if (window.innerWidth >= this.breakpoint) {
        this.sidebarOpen = false;
        window.UX?.unlockScroll?.();
      }
    },

    toggleSidebar() {
      if (window.innerWidth < this.breakpoint) {
        this.sidebarOpen = !this.sidebarOpen;
        if (this.sidebarOpen) {
          window.UX?.lockScroll?.();
        } else {
          window.UX?.unlockScroll?.();
        }
      } else {
        this.sidebarCollapsed = !this.sidebarCollapsed;
      }
    },

    openSidebar() {
      if (window.innerWidth < this.breakpoint) {
        this.sidebarOpen = true;
        window.UX?.lockScroll?.();
      }
    },

    closeSidebar() {
      this.sidebarOpen = false;
      window.UX?.unlockScroll?.();
    },

    collapseSidebar() {
      this.sidebarCollapsed = true;
    },

    expandSidebar() {
      this.sidebarCollapsed = false;
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxShell', shellData);
  }

})();

/**
 * UX Shift Calendar Component
 * Week view shift scheduling calendar with drag-to-create and employee filtering
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Shift Calendar Container
       ========================================================================== */

    :root {
      --ux-shift-calendar-time-width: 60px;
      --ux-shift-calendar-day-min-width: 120px;
      --ux-shift-calendar-row-height: 48px;
      --ux-shift-calendar-radius: var(--ux-radius-xl);
      --ux-shift-calendar-header-height: 60px;
      --ux-shift-calendar-shift-radius: var(--ux-radius-md);
    }

    .ux-shift-calendar {
      display: flex;
      flex-direction: column;
      width: 100%;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-shift-calendar-radius);
      overflow: hidden;
      user-select: none;
      font-family: var(--ux-font-family);
    }

    /* ==========================================================================
       Header (Navigation & Filters)
       ========================================================================== */

    .ux-shift-calendar__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md) var(--ux-space-lg);
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      flex-shrink: 0;
      min-height: var(--ux-shift-calendar-header-height);
    }

    .ux-shift-calendar__header-start {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-shift-calendar__header-center {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
    }

    .ux-shift-calendar__header-end {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
    }

    .ux-shift-calendar__title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--ux-text);
      white-space: nowrap;
    }

    .ux-shift-calendar__subtitle {
      font-size: 0.875rem;
      color: var(--ux-text-secondary);
    }

    .ux-shift-calendar__nav {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-shift-calendar__nav-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: var(--ux-surface-secondary);
      border: none;
      border-radius: var(--ux-radius-md);
      color: var(--ux-text);
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-shift-calendar__nav-btn:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-shift-calendar__nav-btn:active {
      transform: scale(0.95);
    }

    .ux-shift-calendar__nav-btn svg {
      width: 18px;
      height: 18px;
    }

    .ux-shift-calendar__today-btn {
      padding: var(--ux-space-xs) var(--ux-space-md);
      background: transparent;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      color: var(--ux-text);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-shift-calendar__today-btn:hover {
      background: var(--ux-surface-secondary);
      border-color: var(--ux-primary);
      color: var(--ux-primary);
    }

    /* Employee Filter */
    .ux-shift-calendar__filter {
      position: relative;
    }

    .ux-shift-calendar__filter-btn {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      color: var(--ux-text);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-shift-calendar__filter-btn:hover {
      border-color: var(--ux-primary);
    }

    .ux-shift-calendar__filter-btn svg {
      width: 16px;
      height: 16px;
      color: var(--ux-text-tertiary);
    }

    .ux-shift-calendar__filter-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 18px;
      height: 18px;
      padding: 0 4px;
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-radius: 9px;
      font-size: 0.6875rem;
      font-weight: 600;
    }

    /* ==========================================================================
       Grid Container
       ========================================================================== */

    .ux-shift-calendar__grid-wrapper {
      flex: 1;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }

    .ux-shift-calendar__grid {
      display: grid;
      grid-template-columns: var(--ux-shift-calendar-time-width) repeat(7, minmax(var(--ux-shift-calendar-day-min-width), 1fr));
      min-width: fit-content;
    }

    /* ==========================================================================
       Day Headers
       ========================================================================== */

    .ux-shift-calendar__days-header {
      display: contents;
    }

    .ux-shift-calendar__corner {
      position: sticky;
      top: 0;
      left: 0;
      z-index: 3;
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      border-right: 1px solid var(--ux-border-color);
    }

    .ux-shift-calendar__day-header {
      position: sticky;
      top: 0;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-sm);
      background: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      border-right: 1px solid var(--ux-border-color);
      min-height: 56px;
    }

    .ux-shift-calendar__day-header:last-child {
      border-right: none;
    }

    .ux-shift-calendar__day-name {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }

    .ux-shift-calendar__day-number {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--ux-text);
      line-height: 1.2;
    }

    .ux-shift-calendar__day-header--today .ux-shift-calendar__day-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-radius: 50%;
    }

    .ux-shift-calendar__day-header--weekend {
      background: var(--ux-surface-secondary);
    }

    .ux-shift-calendar__day-header--weekend .ux-shift-calendar__day-name {
      color: var(--ux-danger);
    }

    /* ==========================================================================
       Time Column
       ========================================================================== */

    .ux-shift-calendar__time-slot {
      position: sticky;
      left: 0;
      z-index: 1;
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: var(--ux-surface);
      border-right: 1px solid var(--ux-border-color);
      border-bottom: 1px solid var(--ux-border-color);
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--ux-text-tertiary);
      height: var(--ux-shift-calendar-row-height);
    }

    .ux-shift-calendar__time-slot--half {
      border-bottom-style: dashed;
    }

    /* ==========================================================================
       Grid Cells
       ========================================================================== */

    .ux-shift-calendar__cell {
      position: relative;
      min-height: var(--ux-shift-calendar-row-height);
      border-right: 1px solid var(--ux-border-color);
      border-bottom: 1px solid var(--ux-border-color);
      transition: background var(--ux-transition-fast);
    }

    .ux-shift-calendar__cell:last-child {
      border-right: none;
    }

    .ux-shift-calendar__cell--half {
      border-bottom-style: dashed;
    }

    .ux-shift-calendar__cell--weekend {
      background: var(--ux-surface-secondary);
    }

    .ux-shift-calendar__cell:hover {
      background: rgba(var(--ux-primary-rgb), 0.03);
    }

    .ux-shift-calendar__cell--drag-over {
      background: rgba(var(--ux-primary-rgb), 0.08);
    }

    .ux-shift-calendar__cell--selecting {
      background: rgba(var(--ux-primary-rgb), 0.12);
    }

    /* ==========================================================================
       Shift Blocks
       ========================================================================== */

    .ux-shift-calendar__shift {
      position: absolute;
      left: 2px;
      right: 2px;
      min-height: 24px;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-radius: var(--ux-shift-calendar-shift-radius);
      cursor: pointer;
      overflow: hidden;
      z-index: 1;
      transition: transform var(--ux-transition-fast), box-shadow var(--ux-transition-fast);
    }

    .ux-shift-calendar__shift:hover {
      transform: scale(1.01);
      box-shadow: var(--ux-shadow-md);
      z-index: 2;
    }

    .ux-shift-calendar__shift:active {
      transform: scale(0.99);
    }

    .ux-shift-calendar__shift--dragging {
      opacity: 0.7;
      box-shadow: var(--ux-shadow-lg);
      z-index: 10;
    }

    /* Shift Content */
    .ux-shift-calendar__shift-name {
      font-size: 0.8125rem;
      font-weight: 600;
      color: inherit;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.3;
    }

    .ux-shift-calendar__shift-time {
      font-size: 0.6875rem;
      opacity: 0.85;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-shift-calendar__shift-department {
      font-size: 0.625rem;
      opacity: 0.7;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-top: 2px;
    }

    /* Shift Types (Colors) */
    .ux-shift-calendar__shift--morning {
      background: linear-gradient(135deg, var(--ux-amber-400), var(--ux-amber-500));
      color: var(--ux-amber-950);
    }

    .ux-shift-calendar__shift--afternoon {
      background: linear-gradient(135deg, var(--ux-blue-400), var(--ux-blue-500));
      color: white;
    }

    .ux-shift-calendar__shift--night {
      background: linear-gradient(135deg, var(--ux-indigo-500), var(--ux-indigo-600));
      color: white;
    }

    .ux-shift-calendar__shift--full-day {
      background: linear-gradient(135deg, var(--ux-green-400), var(--ux-green-500));
      color: white;
    }

    .ux-shift-calendar__shift--overtime {
      background: linear-gradient(135deg, var(--ux-orange-400), var(--ux-orange-500));
      color: white;
    }

    .ux-shift-calendar__shift--off {
      background: linear-gradient(135deg, var(--ux-gray-300), var(--ux-gray-400));
      color: var(--ux-gray-700);
    }

    /* Custom colors via CSS vars */
    .ux-shift-calendar__shift--custom {
      background: var(--shift-bg, var(--ux-primary));
      color: var(--shift-color, white);
    }

    /* ==========================================================================
       Selection Overlay (drag to create)
       ========================================================================== */

    .ux-shift-calendar__selection {
      position: absolute;
      background: rgba(var(--ux-primary-rgb), 0.2);
      border: 2px dashed var(--ux-primary);
      border-radius: var(--ux-shift-calendar-shift-radius);
      pointer-events: none;
      z-index: 5;
    }

    /* ==========================================================================
       Empty State
       ========================================================================== */

    .ux-shift-calendar__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-2xl);
      color: var(--ux-text-tertiary);
      text-align: center;
    }

    .ux-shift-calendar__empty-icon {
      width: 48px;
      height: 48px;
      margin-bottom: var(--ux-space-md);
      opacity: 0.5;
    }

    .ux-shift-calendar__empty-text {
      font-size: 0.9375rem;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-shift-calendar__empty-hint {
      font-size: 0.8125rem;
      opacity: 0.7;
    }

    /* ==========================================================================
       Legend
       ========================================================================== */

    .ux-shift-calendar__legend {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-sm) var(--ux-space-lg);
      background: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
      flex-shrink: 0;
      flex-wrap: wrap;
    }

    .ux-shift-calendar__legend-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      font-size: 0.75rem;
      color: var(--ux-text-secondary);
    }

    .ux-shift-calendar__legend-color {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }

    .ux-shift-calendar__legend-color--morning {
      background: linear-gradient(135deg, var(--ux-amber-400), var(--ux-amber-500));
    }

    .ux-shift-calendar__legend-color--afternoon {
      background: linear-gradient(135deg, var(--ux-blue-400), var(--ux-blue-500));
    }

    .ux-shift-calendar__legend-color--night {
      background: linear-gradient(135deg, var(--ux-indigo-500), var(--ux-indigo-600));
    }

    /* ==========================================================================
       Responsive
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-shift-calendar__header {
        flex-wrap: wrap;
        gap: var(--ux-space-sm);
      }

      .ux-shift-calendar__header-center {
        order: -1;
        width: 100%;
        justify-content: center;
      }

      .ux-shift-calendar__title {
        font-size: 1rem;
      }

      .ux-shift-calendar__grid {
        grid-template-columns: var(--ux-shift-calendar-time-width) repeat(7, 100px);
      }

      .ux-shift-calendar__shift-name {
        font-size: 0.75rem;
      }

      .ux-shift-calendar__shift-time,
      .ux-shift-calendar__shift-department {
        display: none;
      }

      .ux-shift-calendar__legend {
        justify-content: center;
      }
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-shift-calendar--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    .ux-shift-calendar--glass .ux-shift-calendar__header,
    .ux-shift-calendar--glass .ux-shift-calendar__corner,
    .ux-shift-calendar--glass .ux-shift-calendar__day-header,
    .ux-shift-calendar--glass .ux-shift-calendar__time-slot,
    .ux-shift-calendar--glass .ux-shift-calendar__legend {
      background: transparent;
    }

    .ux-shift-calendar--glass .ux-shift-calendar__cell--weekend,
    .ux-shift-calendar--glass .ux-shift-calendar__day-header--weekend {
      background: rgba(var(--ux-surface-rgb), 0.05);
    }

    .ux-shift-calendar--glass .ux-shift-calendar__nav-btn,
    .ux-shift-calendar--glass .ux-shift-calendar__today-btn,
    .ux-shift-calendar--glass .ux-shift-calendar__filter-btn {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--ux-glass-border);
    }

    .ux-shift-calendar--glass .ux-shift-calendar__nav-btn:hover,
    .ux-shift-calendar--glass .ux-shift-calendar__today-btn:hover,
    .ux-shift-calendar--glass .ux-shift-calendar__filter-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      .ux-shift-calendar__shift--morning {
        background: linear-gradient(135deg, var(--ux-amber-500), var(--ux-amber-600));
        color: white;
      }

      .ux-shift-calendar__shift--off {
        background: linear-gradient(135deg, var(--ux-gray-600), var(--ux-gray-700));
        color: var(--ux-gray-200);
      }

      .ux-shift-calendar--glass .ux-shift-calendar__nav-btn,
      .ux-shift-calendar--glass .ux-shift-calendar__today-btn,
      .ux-shift-calendar--glass .ux-shift-calendar__filter-btn {
        background: rgba(255, 255, 255, 0.08);
      }

      .ux-shift-calendar--glass .ux-shift-calendar__nav-btn:hover,
      .ux-shift-calendar--glass .ux-shift-calendar__today-btn:hover,
      .ux-shift-calendar--glass .ux-shift-calendar__filter-btn:hover {
        background: rgba(255, 255, 255, 0.15);
      }
    }

    .ux-dark .ux-shift-calendar__shift--morning {
      background: linear-gradient(135deg, var(--ux-amber-500), var(--ux-amber-600));
      color: white;
    }

    .ux-dark .ux-shift-calendar__shift--off {
      background: linear-gradient(135deg, var(--ux-gray-600), var(--ux-gray-700));
      color: var(--ux-gray-200);
    }

    .ux-dark .ux-shift-calendar--glass .ux-shift-calendar__nav-btn,
    .ux-dark .ux-shift-calendar--glass .ux-shift-calendar__today-btn,
    .ux-dark .ux-shift-calendar--glass .ux-shift-calendar__filter-btn {
      background: rgba(255, 255, 255, 0.08);
    }

    .ux-dark .ux-shift-calendar--glass .ux-shift-calendar__nav-btn:hover,
    .ux-dark .ux-shift-calendar--glass .ux-shift-calendar__today-btn:hover,
    .ux-dark .ux-shift-calendar--glass .ux-shift-calendar__filter-btn:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-shift-calendar__shift,
      .ux-shift-calendar__nav-btn,
      .ux-shift-calendar__cell {
        transition: none;
      }
    }

    /* ==========================================================================
       Compact Variant
       ========================================================================== */

    .ux-shift-calendar--compact {
      --ux-shift-calendar-row-height: 36px;
      --ux-shift-calendar-time-width: 50px;
    }

    .ux-shift-calendar--compact .ux-shift-calendar__shift-department {
      display: none;
    }
  `;

  // Navigation icons
  const icons = {
    prev: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M15 18l-6-6 6-6"/>
    </svg>`,
    next: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M9 18l6-6-6-6"/>
    </svg>`,
    filter: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
    </svg>`,
    plus: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
    </svg>`,
    calendar: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
    </svg>`
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-shift-calendar-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-shift-calendar-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const shiftCalendarData = (options = {}) => ({
    // Configuration
    startHour: options.startHour ?? 6,
    endHour: options.endHour ?? 22,
    hourStep: options.hourStep ?? 1,
    firstDayOfWeek: options.firstDayOfWeek ?? 1, // 0 = Sunday, 1 = Monday
    locale: options.locale || 'es',
    showLegend: options.showLegend ?? true,
    readOnly: options.readOnly ?? false,

    // State
    currentDate: new Date(),
    shifts: options.shifts || [],
    employees: options.employees || [],
    filteredEmployeeIds: [],
    selectedShift: null,
    isSelecting: false,
    selectionStart: null,
    selectionEnd: null,
    icons: icons,

    // Day names
    get dayNames() {
      const days = ['Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab'];
      return days;
    },

    get fullDayNames() {
      const days = ['Domingo', 'Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sabado'];
      return days;
    },

    // Get week dates based on current date
    get weekDates() {
      const dates = [];
      const current = new Date(this.currentDate);
      const day = current.getDay();
      const diff = (day < this.firstDayOfWeek ? 7 : 0) + day - this.firstDayOfWeek;
      current.setDate(current.getDate() - diff);

      for (let i = 0; i < 7; i++) {
        const date = new Date(current);
        date.setDate(current.getDate() + i);
        dates.push(date);
      }
      return dates;
    },

    // Get week range string for title
    get weekRangeTitle() {
      const start = this.weekDates[0];
      const end = this.weekDates[6];
      const startMonth = start.toLocaleDateString(this.locale, { month: 'short' });
      const endMonth = end.toLocaleDateString(this.locale, { month: 'short' });

      if (start.getMonth() === end.getMonth()) {
        return `${start.getDate()} - ${end.getDate()} ${endMonth} ${end.getFullYear()}`;
      }
      return `${start.getDate()} ${startMonth} - ${end.getDate()} ${endMonth} ${end.getFullYear()}`;
    },

    // Generate time slots
    get timeSlots() {
      const slots = [];
      for (let hour = this.startHour; hour < this.endHour; hour++) {
        slots.push({
          hour,
          label: `${hour.toString().padStart(2, '0')}:00`
        });
      }
      return slots;
    },

    // Check if a date is today
    isToday(date) {
      const today = new Date();
      return date.toDateString() === today.toDateString();
    },

    // Check if a date is weekend
    isWeekend(date) {
      const day = date.getDay();
      return day === 0 || day === 6;
    },

    // Format date as YYYY-MM-DD
    formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    },

    // Format time as HH:MM
    formatTime(hours, minutes = 0) {
      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    },

    // Navigation
    navigateWeek(direction) {
      const newDate = new Date(this.currentDate);
      newDate.setDate(newDate.getDate() + (direction * 7));
      this.currentDate = newDate;
      this.$dispatch('shift-calendar:navigate', {
        direction,
        weekStart: this.weekDates[0],
        weekEnd: this.weekDates[6]
      });
    },

    goToToday() {
      this.currentDate = new Date();
      this.$dispatch('shift-calendar:today');
    },

    goToDate(date) {
      this.currentDate = new Date(date);
    },

    // Get shifts for a specific day
    getShiftsForDay(date) {
      const dateStr = this.formatDate(date);
      let dayShifts = this.shifts.filter(shift => shift.date === dateStr);

      // Apply employee filter
      if (this.filteredEmployeeIds.length > 0) {
        dayShifts = dayShifts.filter(shift =>
          this.filteredEmployeeIds.includes(shift.employeeId)
        );
      }

      return dayShifts;
    },

    // Calculate shift position and height in grid
    getShiftStyle(shift) {
      const startHour = this.parseTime(shift.startTime);
      const endHour = this.parseTime(shift.endTime);

      const top = (startHour - this.startHour) * 48; // 48px per hour
      const height = (endHour - startHour) * 48;

      return {
        top: `${top}px`,
        height: `${Math.max(height, 24)}px`
      };
    },

    // Parse time string to decimal hours
    parseTime(timeStr) {
      const [hours, minutes] = timeStr.split(':').map(Number);
      return hours + (minutes || 0) / 60;
    },

    // Determine shift type based on time
    getShiftType(shift) {
      if (shift.type) return shift.type;

      const startHour = this.parseTime(shift.startTime);
      const endHour = this.parseTime(shift.endTime);
      const duration = endHour - startHour;

      if (duration >= 10) return 'full-day';
      if (startHour < 12) return 'morning';
      if (startHour < 18) return 'afternoon';
      return 'night';
    },

    // Shift CRUD operations
    addShift(shiftData) {
      const shift = {
        id: shiftData.id || `shift-${Date.now()}`,
        ...shiftData
      };
      this.shifts.push(shift);
      this.$dispatch('shift-calendar:add', { shift });
      return shift;
    },

    editShift(shiftId, updates) {
      const index = this.shifts.findIndex(s => s.id === shiftId);
      if (index !== -1) {
        this.shifts[index] = { ...this.shifts[index], ...updates };
        this.$dispatch('shift-calendar:edit', { shift: this.shifts[index] });
        return this.shifts[index];
      }
      return null;
    },

    deleteShift(shiftId) {
      const index = this.shifts.findIndex(s => s.id === shiftId);
      if (index !== -1) {
        const deleted = this.shifts.splice(index, 1)[0];
        this.$dispatch('shift-calendar:delete', { shift: deleted });
        return deleted;
      }
      return null;
    },

    // Click on shift
    onShiftClick(shift, event) {
      event.stopPropagation();
      this.selectedShift = shift;
      this.$dispatch('shift-calendar:select', { shift });
    },

    // Drag to create shift
    onCellMouseDown(date, hour, event) {
      if (this.readOnly) return;

      this.isSelecting = true;
      this.selectionStart = { date: this.formatDate(date), hour };
      this.selectionEnd = { date: this.formatDate(date), hour: hour + 1 };
    },

    onCellMouseMove(date, hour, event) {
      if (!this.isSelecting) return;

      this.selectionEnd = { date: this.formatDate(date), hour: hour + 1 };
    },

    onCellMouseUp(event) {
      if (!this.isSelecting) return;

      if (this.selectionStart && this.selectionEnd) {
        const startHour = Math.min(this.selectionStart.hour, this.selectionEnd.hour);
        const endHour = Math.max(this.selectionStart.hour, this.selectionEnd.hour);

        if (endHour > startHour) {
          this.$dispatch('shift-calendar:create', {
            date: this.selectionStart.date,
            startTime: this.formatTime(startHour),
            endTime: this.formatTime(endHour)
          });
        }
      }

      this.isSelecting = false;
      this.selectionStart = null;
      this.selectionEnd = null;
    },

    // Employee filtering
    filterByEmployee(employeeId) {
      const index = this.filteredEmployeeIds.indexOf(employeeId);
      if (index === -1) {
        this.filteredEmployeeIds.push(employeeId);
      } else {
        this.filteredEmployeeIds.splice(index, 1);
      }
      this.$dispatch('shift-calendar:filter', {
        filteredEmployeeIds: [...this.filteredEmployeeIds]
      });
    },

    clearFilters() {
      this.filteredEmployeeIds = [];
      this.$dispatch('shift-calendar:filter', { filteredEmployeeIds: [] });
    },

    isEmployeeFiltered(employeeId) {
      return this.filteredEmployeeIds.includes(employeeId);
    },

    // Get employee by ID
    getEmployee(employeeId) {
      return this.employees.find(e => e.id === employeeId) || { name: 'Unknown' };
    },

    // Initialize
    init() {
      // Handle mouse up anywhere on document
      this._mouseUpHandler = (e) => this.onCellMouseUp(e);
      document.addEventListener('mouseup', this._mouseUpHandler);

      // Set initial shifts if provided
      if (options.shifts) {
        this.shifts = [...options.shifts];
      }
    },

    destroy() {
      if (this._mouseUpHandler) {
        document.removeEventListener('mouseup', this._mouseUpHandler);
      }
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxShiftCalendar', shiftCalendarData);
  }
})();

/**
 * UX Signature Pad Component
 * Canvas-based signature capture with touch support
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Signature Pad - Base
    ======================================== */

    .ux-signature-pad {
      display: flex;
      flex-direction: column;
      font-family: var(--ux-font-family);
    }

    .ux-signature-pad__container {
      position: relative;
      border: 2px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      background: var(--ux-surface);
      overflow: hidden;
    }

    .ux-signature-pad__canvas {
      display: block;
      width: 100%;
      height: 200px;
      touch-action: none;
      cursor: crosshair;
    }

    /* ========================================
       Guide Line
    ======================================== */

    .ux-signature-pad__guide {
      position: absolute;
      left: 10%;
      right: 10%;
      bottom: 30%;
      height: 1px;
      background: var(--ux-border-color);
      pointer-events: none;
    }

    .ux-signature-pad__guide::before {
      content: 'x';
      position: absolute;
      left: -10px;
      bottom: -2px;
      font-size: 0.75rem;
      color: var(--ux-text-tertiary);
    }

    /* ========================================
       Placeholder
    ======================================== */

    .ux-signature-pad__placeholder {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      color: var(--ux-text-tertiary);
      font-size: 0.875rem;
      pointer-events: none;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-signature-pad__placeholder svg {
      width: 32px;
      height: 32px;
      opacity: 0.5;
    }

    .ux-signature-pad--has-signature .ux-signature-pad__placeholder {
      opacity: 0;
    }

    /* ========================================
       Actions
    ======================================== */

    .ux-signature-pad__actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: var(--ux-space-sm);
    }

    .ux-signature-pad__btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      padding: 0.5rem 1rem;
      background: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      color: var(--ux-text);
      font-size: 0.875rem;
      font-family: inherit;
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-signature-pad__btn:hover {
      background: var(--ux-surface-tertiary);
    }

    .ux-signature-pad__btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-signature-pad__btn svg {
      width: 16px;
      height: 16px;
    }

    .ux-signature-pad__btn--primary {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
      color: white;
    }

    .ux-signature-pad__btn--primary:hover {
      background: var(--ux-primary-shade);
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-signature-pad--sm .ux-signature-pad__canvas {
      height: 150px;
    }

    .ux-signature-pad--lg .ux-signature-pad__canvas {
      height: 300px;
    }

    /* ========================================
       States
    ======================================== */

    /* Disabled */
    .ux-signature-pad--disabled .ux-signature-pad__container {
      background: var(--ux-surface-secondary);
      opacity: 0.6;
    }

    .ux-signature-pad--disabled .ux-signature-pad__canvas {
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Error */
    .ux-signature-pad--error .ux-signature-pad__container {
      border-color: var(--ux-danger);
    }

    /* Readonly (show signature but no interaction) */
    .ux-signature-pad--readonly .ux-signature-pad__canvas {
      cursor: default;
      pointer-events: none;
    }

    .ux-signature-pad--readonly .ux-signature-pad__guide,
    .ux-signature-pad--readonly .ux-signature-pad__placeholder {
      display: none;
    }

    /* ========================================
       Label & Helper
    ======================================== */

    .ux-signature-pad__label {
      display: block;
      margin-bottom: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-signature-pad__helper {
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
    }

    .ux-signature-pad__helper--error {
      color: var(--ux-danger);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-signature-pad--glass .ux-signature-pad__container {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-signature-pad__container {
        background: var(--ux-surface);
      }
    }

    .ux-dark .ux-signature-pad__container {
      background: var(--ux-surface);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-signature-pad__placeholder,
      .ux-signature-pad__btn {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-signature-pad-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-signature-pad-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Icons
  const icons = {
    pen: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>',
    clear: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>',
    download: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',
    undo: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/></svg>'
  };

  // Alpine.js component for signature pad
  const signaturePadData = (options = {}) => ({
    // Configuration
    width: options.width || null, // Auto if null
    height: options.height || 200,
    lineWidth: options.lineWidth || 2,
    lineColor: options.lineColor || '#000000',
    backgroundColor: options.backgroundColor || 'transparent',
    showGuide: options.showGuide ?? true,
    showPlaceholder: options.showPlaceholder ?? true,
    placeholderText: options.placeholderText || 'Firme aquÃ­',
    exportFormat: options.exportFormat || 'png', // 'png', 'jpeg', 'svg'
    exportQuality: options.exportQuality || 0.92,

    // State
    hasSignature: false,
    isDrawing: false,
    disabled: options.disabled || false,
    readonly: options.readonly || false,
    history: [],
    maxHistory: options.maxHistory || 20,

    // Canvas context
    ctx: null,
    lastX: 0,
    lastY: 0,
    icons,

    init() {
      this.$nextTick(() => {
        this.setupCanvas();
        this.setupEventListeners();

        // Load initial signature if provided
        if (options.initialSignature) {
          this.loadSignature(options.initialSignature);
        }
      });
    },

    setupCanvas() {
      const canvas = this.$refs.canvas;
      if (!canvas) return;

      // Set canvas size
      const container = canvas.parentElement;
      const rect = container.getBoundingClientRect();

      // Use device pixel ratio for sharp rendering
      const dpr = window.devicePixelRatio || 1;
      canvas.width = (this.width || rect.width) * dpr;
      canvas.height = this.height * dpr;

      // Scale context for retina displays
      this.ctx = canvas.getContext('2d');
      this.ctx.scale(dpr, dpr);

      // Set drawing style
      this.ctx.strokeStyle = this.lineColor;
      this.ctx.lineWidth = this.lineWidth;
      this.ctx.lineCap = 'round';
      this.ctx.lineJoin = 'round';

      // Set background if not transparent
      if (this.backgroundColor !== 'transparent') {
        this.ctx.fillStyle = this.backgroundColor;
        this.ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
    },

    setupEventListeners() {
      const canvas = this.$refs.canvas;
      if (!canvas) return;

      // Mouse events
      canvas.addEventListener('mousedown', (e) => this.startDrawing(e));
      canvas.addEventListener('mousemove', (e) => this.draw(e));
      canvas.addEventListener('mouseup', () => this.stopDrawing());
      canvas.addEventListener('mouseleave', () => this.stopDrawing());

      // Touch events
      canvas.addEventListener('touchstart', (e) => this.startDrawing(e), { passive: false });
      canvas.addEventListener('touchmove', (e) => this.draw(e), { passive: false });
      canvas.addEventListener('touchend', () => this.stopDrawing());
      canvas.addEventListener('touchcancel', () => this.stopDrawing());

      // Resize observer
      if (typeof ResizeObserver !== 'undefined') {
        this._resizeObserver = new ResizeObserver(() => {
          this.handleResize();
        });
        this._resizeObserver.observe(canvas.parentElement);
      }
    },

    destroy() {
      if (this._resizeObserver) {
        this._resizeObserver.disconnect();
      }
    },

    // Get coordinates from event
    getCoordinates(e) {
      const canvas = this.$refs.canvas;
      const rect = canvas.getBoundingClientRect();

      let clientX, clientY;

      if (e.touches && e.touches.length > 0) {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }

      return {
        x: clientX - rect.left,
        y: clientY - rect.top
      };
    },

    // Start drawing
    startDrawing(e) {
      if (this.disabled || this.readonly) return;

      e.preventDefault();
      this.isDrawing = true;

      const coords = this.getCoordinates(e);
      this.lastX = coords.x;
      this.lastY = coords.y;

      // Save state for undo
      this.saveState();

      // Start new path
      this.ctx.beginPath();
      this.ctx.moveTo(coords.x, coords.y);
    },

    // Draw
    draw(e) {
      if (!this.isDrawing || this.disabled || this.readonly) return;

      e.preventDefault();

      const coords = this.getCoordinates(e);

      this.ctx.lineTo(coords.x, coords.y);
      this.ctx.stroke();

      this.lastX = coords.x;
      this.lastY = coords.y;

      this.hasSignature = true;
    },

    // Stop drawing
    stopDrawing() {
      if (this.isDrawing) {
        this.isDrawing = false;
        this.ctx.closePath();

        if (this.hasSignature) {
          this.$dispatch('signature:change', { hasSignature: true });
        }
      }
    },

    // Save state for undo
    saveState() {
      const canvas = this.$refs.canvas;
      if (!canvas) return;

      const imageData = canvas.toDataURL();

      this.history.push(imageData);

      // Limit history size
      if (this.history.length > this.maxHistory) {
        this.history.shift();
      }
    },

    // Undo last stroke
    undo() {
      if (this.history.length === 0) return;

      this.history.pop(); // Remove current state

      if (this.history.length > 0) {
        const lastState = this.history[this.history.length - 1];
        this.loadSignature(lastState);
      } else {
        this.clear();
      }
    },

    // Clear canvas
    clear() {
      const canvas = this.$refs.canvas;
      if (!canvas) return;

      // Clear canvas
      this.ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Restore background
      if (this.backgroundColor !== 'transparent') {
        this.ctx.fillStyle = this.backgroundColor;
        this.ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      this.hasSignature = false;
      this.history = [];

      this.$dispatch('signature:clear');
      this.$dispatch('signature:change', { hasSignature: false });
    },

    // Load signature from data URL
    loadSignature(dataUrl) {
      const canvas = this.$refs.canvas;
      if (!canvas || !dataUrl) return;

      const img = new Image();
      img.onload = () => {
        // Clear first
        this.ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Restore background
        if (this.backgroundColor !== 'transparent') {
          this.ctx.fillStyle = this.backgroundColor;
          this.ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // Draw image
        this.ctx.drawImage(img, 0, 0);
        this.hasSignature = true;
      };
      img.src = dataUrl;
    },

    // Get signature as data URL
    getSignature(format, quality) {
      const canvas = this.$refs.canvas;
      if (!canvas || !this.hasSignature) return null;

      format = format || this.exportFormat;
      quality = quality || this.exportQuality;

      const mimeType = format === 'jpeg' ? 'image/jpeg' : 'image/png';
      return canvas.toDataURL(mimeType, quality);
    },

    // Get signature as blob
    async getSignatureBlob(format, quality) {
      const canvas = this.$refs.canvas;
      if (!canvas || !this.hasSignature) return null;

      format = format || this.exportFormat;
      quality = quality || this.exportQuality;

      const mimeType = format === 'jpeg' ? 'image/jpeg' : 'image/png';

      return new Promise((resolve) => {
        canvas.toBlob(resolve, mimeType, quality);
      });
    },

    // Download signature
    async download(filename) {
      const dataUrl = this.getSignature();
      if (!dataUrl) return;

      filename = filename || `signature-${Date.now()}.${this.exportFormat}`;

      const link = document.createElement('a');
      link.href = dataUrl;
      link.download = filename;
      link.click();

      this.$dispatch('signature:download', { filename });
    },

    // Handle resize
    handleResize() {
      // Save current signature
      const currentSignature = this.hasSignature ? this.getSignature() : null;

      // Resize canvas
      this.setupCanvas();

      // Restore signature
      if (currentSignature) {
        this.loadSignature(currentSignature);
      }
    },

    // Check if empty
    isEmpty() {
      return !this.hasSignature;
    },

    // Set line color
    setLineColor(color) {
      this.lineColor = color;
      if (this.ctx) {
        this.ctx.strokeStyle = color;
      }
    },

    // Set line width
    setLineWidth(width) {
      this.lineWidth = width;
      if (this.ctx) {
        this.ctx.lineWidth = width;
      }
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxSignaturePad', signaturePadData);
  }

})();

/**
 * UX Skeleton Component
 * Placeholders de carga estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Skeleton Variables
    ======================================== */

    :root {
      --ux-skeleton-bg: rgba(0, 0, 0, 0.08);
      --ux-skeleton-shimmer: rgba(255, 255, 255, 0.4);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --ux-skeleton-bg: rgba(255, 255, 255, 0.1);
        --ux-skeleton-shimmer: rgba(255, 255, 255, 0.15);
      }
    }

    .ux-dark {
      --ux-skeleton-bg: rgba(255, 255, 255, 0.1);
      --ux-skeleton-shimmer: rgba(255, 255, 255, 0.15);
    }

    /* ========================================
       UX Skeleton Base
    ======================================== */

    .ux-skeleton {
      position: relative;
      display: block;
      background-color: var(--ux-skeleton-bg);
      border-radius: var(--ux-border-radius-sm);
      overflow: hidden;
    }

    /* Shimmer animation */
    .ux-skeleton::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        90deg,
        transparent 0%,
        var(--ux-skeleton-shimmer) 50%,
        transparent 100%
      );
      transform: translateX(-100%);
      animation: ux-skeleton-shimmer 1.5s infinite;
    }

    @keyframes ux-skeleton-shimmer {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100%);
      }
    }

    /* Disable animation */
    .ux-skeleton--no-animation::after {
      display: none;
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .ux-skeleton::after {
        animation: none;
      }

      .ux-skeleton--pulse {
        animation: none;
      }
    }

    /* Pulse animation alternative */
    .ux-skeleton--pulse {
      animation: ux-skeleton-pulse 1.5s ease-in-out infinite;
    }

    .ux-skeleton--pulse::after {
      display: none;
    }

    @keyframes ux-skeleton-pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    /* ========================================
       Skeleton Shapes
    ======================================== */

    .ux-skeleton--text {
      height: 16px;
      border-radius: 4px;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-skeleton--text:last-child {
      width: 70%;
    }

    .ux-skeleton--title {
      height: 24px;
      border-radius: 4px;
      margin-bottom: var(--ux-space-md);
    }

    .ux-skeleton--circle {
      border-radius: 50%;
    }

    .ux-skeleton--rect {
      border-radius: var(--ux-border-radius);
    }

    .ux-skeleton--rounded {
      border-radius: var(--ux-border-radius-lg);
    }

    /* ========================================
       Skeleton Sizes
    ======================================== */

    .ux-skeleton--xs {
      height: 8px;
    }

    .ux-skeleton--sm {
      height: 12px;
    }

    .ux-skeleton--md {
      height: 16px;
    }

    .ux-skeleton--lg {
      height: 24px;
    }

    .ux-skeleton--xl {
      height: 32px;
    }

    /* Avatar sizes */
    .ux-skeleton--avatar-xs {
      width: 24px;
      height: 24px;
    }

    .ux-skeleton--avatar-sm {
      width: 32px;
      height: 32px;
    }

    .ux-skeleton--avatar {
      width: 40px;
      height: 40px;
    }

    .ux-skeleton--avatar-md {
      width: 48px;
      height: 48px;
    }

    .ux-skeleton--avatar-lg {
      width: 64px;
      height: 64px;
    }

    .ux-skeleton--avatar-xl {
      width: 96px;
      height: 96px;
    }

    /* ========================================
       Pre-made Skeleton Patterns
    ======================================== */

    /* List Item Skeleton */
    .ux-skeleton-item {
      display: flex;
      align-items: center;
      padding: var(--ux-space-md) var(--ux-space-lg);
      gap: var(--ux-space-md);
    }

    .ux-skeleton-item__avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--ux-skeleton-bg);
      flex-shrink: 0;
    }

    .ux-skeleton-item__content {
      flex: 1;
      min-width: 0;
    }

    .ux-skeleton-item__line {
      height: 14px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-skeleton-item__line:last-child {
      width: 60%;
      margin-bottom: 0;
    }

    /* Card Skeleton */
    .ux-skeleton-card {
      background-color: var(--ux-surface);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
    }

    .ux-skeleton-card__image {
      width: 100%;
      height: 200px;
      background-color: var(--ux-skeleton-bg);
    }

    .ux-skeleton-card__content {
      padding: var(--ux-space-lg);
    }

    .ux-skeleton-card__title {
      height: 20px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
      margin-bottom: var(--ux-space-md);
    }

    .ux-skeleton-card__text {
      height: 14px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-skeleton-card__text:last-child {
      width: 70%;
    }

    /* Profile Skeleton */
    .ux-skeleton-profile {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: var(--ux-space-xl);
      gap: var(--ux-space-md);
    }

    .ux-skeleton-profile__avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: var(--ux-skeleton-bg);
    }

    .ux-skeleton-profile__name {
      width: 120px;
      height: 20px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
    }

    .ux-skeleton-profile__bio {
      width: 180px;
      height: 14px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
    }

    /* Post Skeleton (Social Media style) */
    .ux-skeleton-post {
      padding: var(--ux-space-lg);
    }

    .ux-skeleton-post__header {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      margin-bottom: var(--ux-space-lg);
    }

    .ux-skeleton-post__avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--ux-skeleton-bg);
    }

    .ux-skeleton-post__meta {
      flex: 1;
    }

    .ux-skeleton-post__name {
      width: 100px;
      height: 14px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
      margin-bottom: var(--ux-space-xs);
    }

    .ux-skeleton-post__date {
      width: 60px;
      height: 12px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
    }

    .ux-skeleton-post__image {
      width: 100%;
      height: 300px;
      background-color: var(--ux-skeleton-bg);
      border-radius: var(--ux-border-radius);
      margin-bottom: var(--ux-space-md);
    }

    .ux-skeleton-post__text {
      height: 14px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
      margin-bottom: var(--ux-space-sm);
    }

    /* Table Skeleton */
    .ux-skeleton-table {
      width: 100%;
    }

    .ux-skeleton-table__row {
      display: flex;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md) var(--ux-space-lg);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-skeleton-table__cell {
      flex: 1;
      height: 16px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
    }

    /* Form Skeleton */
    .ux-skeleton-form {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-lg);
    }

    .ux-skeleton-form__field {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs);
    }

    .ux-skeleton-form__label {
      width: 80px;
      height: 12px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
    }

    .ux-skeleton-form__input {
      height: 44px;
      background-color: var(--ux-skeleton-bg);
      border-radius: var(--ux-border-radius);
    }

    .ux-skeleton-form__button {
      height: 44px;
      background-color: var(--ux-skeleton-bg);
      border-radius: var(--ux-border-radius);
      margin-top: var(--ux-space-md);
    }

    /* Chat Skeleton */
    .ux-skeleton-chat {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md);
      padding: var(--ux-space-md);
    }

    .ux-skeleton-chat__message {
      display: flex;
      gap: var(--ux-space-sm);
      max-width: 80%;
    }

    .ux-skeleton-chat__message--sent {
      margin-left: auto;
      flex-direction: row-reverse;
    }

    .ux-skeleton-chat__avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: var(--ux-skeleton-bg);
      flex-shrink: 0;
    }

    .ux-skeleton-chat__bubble {
      padding: var(--ux-space-md);
      background-color: var(--ux-skeleton-bg);
      border-radius: var(--ux-border-radius-lg);
      min-width: 100px;
    }

    .ux-skeleton-chat__text {
      height: 14px;
      background-color: var(--ux-skeleton-bg);
      border-radius: 4px;
      margin-bottom: var(--ux-space-xs);
    }

    .ux-skeleton-chat__text:last-child {
      width: 70%;
      margin-bottom: 0;
    }

    /* ========================================
       Grid Skeleton
    ======================================== */

    .ux-skeleton-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: var(--ux-space-md);
    }

    .ux-skeleton-grid__item {
      aspect-ratio: 1;
      background-color: var(--ux-skeleton-bg);
      border-radius: var(--ux-border-radius);
    }

    /* ========================================
       Skeleton Container
    ======================================== */

    .ux-skeleton-container {
      position: relative;
    }

    /* Fade out when content loads */
    .ux-skeleton-container--loaded .ux-skeleton,
    .ux-skeleton-container--loaded .ux-skeleton-item,
    .ux-skeleton-container--loaded .ux-skeleton-card,
    .ux-skeleton-container--loaded [class^="ux-skeleton-"] {
      opacity: 0;
      transition: opacity var(--ux-transition-base) var(--ux-ease);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-skeleton--glass,
    .ux-skeleton-item--glass {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-skeleton--glass::after,
    .ux-skeleton-item--glass::after {
      background: linear-gradient(
        90deg,
        transparent,
        var(--ux-glass-bg),
        transparent
      );
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-skeleton-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-skeleton-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for skeleton loading state
  // ARIA: aria-busy indicates loading state, role="status" for live region
  const skeletonComponent = (config = {}) => ({
    loading: config.loading !== false,
    ariaLabel: config.ariaLabel || 'Loading content',

    // ARIA attributes for the skeleton container
    get ariaAttrs() {
      return {
        'aria-busy': this.loading ? 'true' : 'false',
        'aria-live': 'polite',
        'aria-label': this.ariaLabel
      };
    },

    setLoading(state) {
      this.loading = state;
      // Announce state change to screen readers
      if (!state && window.UX && window.UX.announce) {
        window.UX.announce('Content loaded', 'polite');
      }
    },

    loaded() {
      this.setLoading(false);
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSkeleton', skeletonComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSkeleton', skeletonComponent);
    });
  }
})();

/**
 * UX Snackbar Component
 * Notificaciones con acciÃ³n en la parte inferior
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Snackbar Container
    ======================================== */

    .ux-snackbar-container {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: var(--ux-z-toast);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-md);
      padding-bottom: calc(var(--ux-space-md) + env(safe-area-inset-bottom));
      pointer-events: none;
    }

    .ux-snackbar-container--left {
      align-items: flex-start;
    }

    .ux-snackbar-container--right {
      align-items: flex-end;
    }

    /* ========================================
       UX Snackbar
    ======================================== */

    .ux-snackbar {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      min-height: 48px;
      min-width: 288px;
      max-width: 568px;
      padding: var(--ux-space-sm) var(--ux-space-md);
      background-color: var(--ux-gray-800);
      color: white;
      border-radius: var(--ux-border-radius);
      box-shadow: var(--ux-shadow-lg);
      pointer-events: auto;
      opacity: 0;
      transform: translateY(100%);
      will-change: transform, opacity;
      transition:
        opacity 200ms var(--ux-ease),
        transform 250ms var(--ux-ease-ios);
    }

    .ux-snackbar--visible {
      opacity: 1;
      transform: translateY(0);
    }

    .ux-snackbar--exiting {
      opacity: 0;
      transform: translateY(100%);
      transition:
        opacity 150ms var(--ux-ease),
        transform 200ms var(--ux-ease);
    }

    /* ========================================
       Snackbar Content
    ======================================== */

    .ux-snackbar__content {
      flex: 1;
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-size: var(--ux-font-size-md);
      line-height: 1.4;
    }

    .ux-snackbar__icon {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      opacity: 0.9;
    }

    .ux-snackbar__message {
      flex: 1;
    }

    /* ========================================
       Snackbar Action
    ======================================== */

    .ux-snackbar__action {
      flex-shrink: 0;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--ux-primary-tint);
      background: transparent;
      border: none;
      border-radius: var(--ux-border-radius-sm);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-snackbar__action:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .ux-snackbar__action:active {
      background-color: rgba(255, 255, 255, 0.15);
    }

    /* Action colors */
    .ux-snackbar__action--success {
      color: var(--ux-success-tint);
    }

    .ux-snackbar__action--warning {
      color: var(--ux-warning);
    }

    .ux-snackbar__action--danger {
      color: var(--ux-danger-tint);
    }

    /* ========================================
       Snackbar Close
    ======================================== */

    .ux-snackbar__close {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      padding: 0;
      background: transparent;
      border: none;
      border-radius: 50%;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-snackbar__close:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .ux-snackbar__close-icon {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-snackbar--success {
      background-color: var(--ux-success);
    }

    .ux-snackbar--success .ux-snackbar__action {
      color: white;
    }

    .ux-snackbar--warning {
      background-color: var(--ux-warning);
      color: var(--ux-gray-900);
    }

    .ux-snackbar--warning .ux-snackbar__action {
      color: var(--ux-gray-900);
    }

    .ux-snackbar--warning .ux-snackbar__close {
      color: rgba(0, 0, 0, 0.6);
    }

    .ux-snackbar--warning .ux-snackbar__close:hover {
      background-color: rgba(0, 0, 0, 0.1);
      color: var(--ux-gray-900);
    }

    .ux-snackbar--danger,
    .ux-snackbar--error {
      background-color: var(--ux-danger);
    }

    .ux-snackbar--danger .ux-snackbar__action,
    .ux-snackbar--error .ux-snackbar__action {
      color: white;
    }

    .ux-snackbar--info {
      background-color: var(--ux-primary);
    }

    .ux-snackbar--info .ux-snackbar__action {
      color: white;
    }

    /* ========================================
       Stacked Layout (two lines)
    ======================================== */

    .ux-snackbar--stacked {
      flex-direction: column;
      align-items: stretch;
      padding: var(--ux-space-md);
    }

    .ux-snackbar--stacked .ux-snackbar__content {
      margin-bottom: var(--ux-space-sm);
    }

    .ux-snackbar--stacked .ux-snackbar__actions {
      display: flex;
      justify-content: flex-end;
      gap: var(--ux-space-sm);
    }

    /* ========================================
       Full Width (mobile)
    ======================================== */

    @media (max-width: 599px) {
      .ux-snackbar {
        min-width: calc(100vw - 2 * var(--ux-space-md));
        max-width: calc(100vw - 2 * var(--ux-space-md));
        border-radius: var(--ux-border-radius);
      }
    }

    /* ========================================
       Progress Bar (auto-dismiss indicator)
    ======================================== */

    .ux-snackbar--progress {
      position: relative;
      overflow: hidden;
    }

    .ux-snackbar__progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background-color: rgba(255, 255, 255, 0.4);
      transform-origin: left;
      animation: ux-snackbar-progress linear forwards;
    }

    .ux-snackbar--warning .ux-snackbar__progress {
      background-color: rgba(0, 0, 0, 0.2);
    }

    @keyframes ux-snackbar-progress {
      from { transform: scaleX(1); }
      to { transform: scaleX(0); }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-snackbar {
        background-color: var(--ux-gray-700);
      }
    }

    .ux-dark .ux-snackbar {
      background-color: var(--ux-gray-700);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-snackbar {
        transition: opacity 150ms;
        transform: translateY(0);
      }

      .ux-snackbar--exiting {
        transform: translateY(0);
      }

      .ux-snackbar__progress {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-snackbar-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-snackbar-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Snackbar queue and manager
  const snackbarQueue = [];
  let currentSnackbar = null;
  let container = null;

  function getContainer(position = 'center') {
    if (!container) {
      container = document.createElement('div');
      container.className = `ux-snackbar-container ux-snackbar-container--${position}`;
      document.body.appendChild(container);
    }
    return container;
  }

  function showSnackbar(options) {
    const config = {
      message: '',
      action: null,
      actionLabel: 'Action',
      actionColor: null,
      duration: 4000,
      closable: false,
      type: null, // success, warning, danger, info
      showProgress: false,
      position: 'center',
      onAction: null,
      onClose: null,
      ...options
    };

    // Queue if another is showing
    if (currentSnackbar) {
      snackbarQueue.push(config);
      return;
    }

    const cont = getContainer(config.position);
    const snackbar = document.createElement('div');
    snackbar.className = 'ux-snackbar';

    if (config.type) {
      snackbar.classList.add(`ux-snackbar--${config.type}`);
    }

    if (config.showProgress && config.duration > 0) {
      snackbar.classList.add('ux-snackbar--progress');
    }

    let html = `<div class="ux-snackbar__content"><span class="ux-snackbar__message">${config.message}</span></div>`;

    if (config.action || config.onAction) {
      let actionClass = 'ux-snackbar__action';
      if (config.actionColor) {
        actionClass += ` ux-snackbar__action--${config.actionColor}`;
      }
      html += `<button class="${actionClass}">${config.actionLabel}</button>`;
    }

    if (config.closable) {
      html += `<button class="ux-snackbar__close" aria-label="Close">
        <svg class="ux-snackbar__close-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>`;
    }

    if (config.showProgress && config.duration > 0) {
      html += `<div class="ux-snackbar__progress" style="animation-duration: ${config.duration}ms"></div>`;
    }

    snackbar.innerHTML = html;
    cont.appendChild(snackbar);
    currentSnackbar = snackbar;

    // Trigger animation
    requestAnimationFrame(() => {
      snackbar.classList.add('ux-snackbar--visible');
    });

    // Event handlers
    const actionBtn = snackbar.querySelector('.ux-snackbar__action');
    if (actionBtn) {
      actionBtn.addEventListener('click', () => {
        if (config.onAction) config.onAction();
        dismissSnackbar(snackbar, config.onClose);
      });
    }

    const closeBtn = snackbar.querySelector('.ux-snackbar__close');
    if (closeBtn) {
      closeBtn.addEventListener('click', () => {
        dismissSnackbar(snackbar, config.onClose);
      });
    }

    // Auto dismiss
    if (config.duration > 0) {
      setTimeout(() => {
        dismissSnackbar(snackbar, config.onClose);
      }, config.duration);
    }

    return snackbar;
  }

  function dismissSnackbar(snackbar, onClose) {
    if (!snackbar || snackbar !== currentSnackbar) return;

    snackbar.classList.remove('ux-snackbar--visible');
    snackbar.classList.add('ux-snackbar--exiting');

    setTimeout(() => {
      snackbar.remove();
      currentSnackbar = null;
      if (onClose) onClose();

      // Process queue
      if (snackbarQueue.length > 0) {
        const next = snackbarQueue.shift();
        setTimeout(() => showSnackbar(next), 150);
      }
    }, 200);
  }

  // Alpine.js component
  const snackbarData = (options = {}) => ({
    isVisible: false,
    message: options.message ?? '',
    actionLabel: options.actionLabel ?? 'Action',
    duration: options.duration ?? 4000,
    type: options.type ?? null,
    _timeout: null,

    show(msg, opts = {}) {
      this.message = msg || this.message;
      this.type = opts.type || this.type;
      this.actionLabel = opts.actionLabel || this.actionLabel;
      this.duration = opts.duration ?? this.duration;

      this.isVisible = true;
      this.$dispatch('snackbar:show');

      if (this.duration > 0) {
        clearTimeout(this._timeout);
        this._timeout = setTimeout(() => this.hide(), this.duration);
      }
    },

    hide() {
      this.isVisible = false;
      clearTimeout(this._timeout);
      this.$dispatch('snackbar:hide');
    },

    action() {
      this.$dispatch('snackbar:action');
      this.hide();
    },

    get snackbarClasses() {
      return {
        'ux-snackbar--visible': this.isVisible,
        [`ux-snackbar--${this.type}`]: this.type
      };
    }
  });

  // Global API
  window.UXSnackbar = {
    show: showSnackbar,
    dismiss: () => dismissSnackbar(currentSnackbar)
  };

  if (window.UX) {
    window.UX.registerComponent('uxSnackbar', snackbarData);
    window.UX.snackbar = window.UXSnackbar;
  }

})();

/**
 * UX Spacer Component
 * Espaciadores flexibles y fijos para layouts
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Spacer
    ======================================== */

    .ux-spacer {
      display: block;
      flex-shrink: 0;
    }

    /* ========================================
       Flex Spacer (expande para llenar)
    ======================================== */

    .ux-spacer--flex {
      flex: 1 1 auto;
      min-width: 0;
      min-height: 0;
    }

    /* ========================================
       Fixed Sizes - Vertical (height)
    ======================================== */

    .ux-spacer--xs {
      height: var(--ux-space-xs);
    }

    .ux-spacer--sm {
      height: var(--ux-space-sm);
    }

    .ux-spacer--md {
      height: var(--ux-space-md);
    }

    .ux-spacer--lg {
      height: var(--ux-space-lg);
    }

    .ux-spacer--xl {
      height: var(--ux-space-xl);
    }

    .ux-spacer--2xl {
      height: var(--ux-space-2xl);
    }

    .ux-spacer--3xl {
      height: var(--ux-space-3xl);
    }

    /* ========================================
       Fixed Sizes - Horizontal (width)
       Use in flex row containers
    ======================================== */

    .ux-spacer--h-xs {
      width: var(--ux-space-xs);
      height: auto;
    }

    .ux-spacer--h-sm {
      width: var(--ux-space-sm);
      height: auto;
    }

    .ux-spacer--h-md {
      width: var(--ux-space-md);
      height: auto;
    }

    .ux-spacer--h-lg {
      width: var(--ux-space-lg);
      height: auto;
    }

    .ux-spacer--h-xl {
      width: var(--ux-space-xl);
      height: auto;
    }

    .ux-spacer--h-2xl {
      width: var(--ux-space-2xl);
      height: auto;
    }

    .ux-spacer--h-3xl {
      width: var(--ux-space-3xl);
      height: auto;
    }

    /* ========================================
       Responsive - Hide on breakpoints
    ======================================== */

    @media (max-width: 767px) {
      .ux-spacer--hide-mobile {
        display: none;
      }

      .ux-spacer--sm-mobile {
        height: var(--ux-space-sm);
      }

      .ux-spacer--h-sm-mobile {
        width: var(--ux-space-sm);
      }
    }

    @media (min-width: 768px) {
      .ux-spacer--hide-desktop {
        display: none;
      }
    }

    /* ========================================
       Safe Area Spacers (for notch/home bar)
    ======================================== */

    .ux-spacer--safe-top {
      height: env(safe-area-inset-top, 0);
    }

    .ux-spacer--safe-bottom {
      height: env(safe-area-inset-bottom, 0);
    }

    .ux-spacer--safe-left {
      width: env(safe-area-inset-left, 0);
      height: auto;
    }

    .ux-spacer--safe-right {
      width: env(safe-area-inset-right, 0);
      height: auto;
    }

    /* ========================================
       Toolbar/Navbar Height Spacers
    ======================================== */

    .ux-spacer--navbar {
      height: var(--ux-navbar-height, 56px);
    }

    .ux-spacer--toolbar {
      height: var(--ux-toolbar-height, 44px);
    }

    .ux-spacer--tabbar {
      height: var(--ux-tabbar-height, 50px);
    }

    /* Combined with safe area */
    .ux-spacer--navbar-safe {
      height: calc(var(--ux-navbar-height, 56px) + env(safe-area-inset-top, 0));
    }

    .ux-spacer--tabbar-safe {
      height: calc(var(--ux-tabbar-height, 50px) + env(safe-area-inset-bottom, 0));
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-spacer-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-spacer-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

})();

/**
 * UX Sparkline Component
 * Lightweight inline charts for displaying trends
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Sparkline - Base
    ======================================== */

    .ux-sparkline {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-family: var(--ux-font-family);
    }

    .ux-sparkline__svg {
      display: block;
      overflow: visible;
    }

    /* ========================================
       Line Chart
    ======================================== */

    .ux-sparkline__line {
      fill: none;
      stroke: var(--ux-primary);
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .ux-sparkline__area {
      fill: url(#sparklineGradient);
      opacity: 0.2;
    }

    .ux-sparkline__dot {
      fill: var(--ux-primary);
    }

    .ux-sparkline__dot--last {
      fill: var(--ux-primary);
      stroke: var(--ux-surface);
      stroke-width: 2;
    }

    /* ========================================
       Bar Chart
    ======================================== */

    .ux-sparkline__bar {
      fill: var(--ux-primary);
      rx: 2;
    }

    .ux-sparkline__bar--negative {
      fill: var(--ux-danger);
    }

    /* ========================================
       Reference Line
    ======================================== */

    .ux-sparkline__reference {
      stroke: var(--ux-text-tertiary);
      stroke-width: 1;
      stroke-dasharray: 4 2;
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-sparkline--success .ux-sparkline__line,
    .ux-sparkline--success .ux-sparkline__dot,
    .ux-sparkline--success .ux-sparkline__bar {
      stroke: var(--ux-success);
      fill: var(--ux-success);
    }

    .ux-sparkline--success .ux-sparkline__line {
      fill: none;
    }

    .ux-sparkline--danger .ux-sparkline__line,
    .ux-sparkline--danger .ux-sparkline__dot,
    .ux-sparkline--danger .ux-sparkline__bar {
      stroke: var(--ux-danger);
      fill: var(--ux-danger);
    }

    .ux-sparkline--danger .ux-sparkline__line {
      fill: none;
    }

    .ux-sparkline--warning .ux-sparkline__line,
    .ux-sparkline--warning .ux-sparkline__dot,
    .ux-sparkline--warning .ux-sparkline__bar {
      stroke: var(--ux-warning);
      fill: var(--ux-warning);
    }

    .ux-sparkline--warning .ux-sparkline__line {
      fill: none;
    }

    /* ========================================
       Value Display
    ======================================== */

    .ux-sparkline__value {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text);
      font-variant-numeric: tabular-nums;
    }

    .ux-sparkline__change {
      display: inline-flex;
      align-items: center;
      gap: 0.125rem;
      font-size: var(--ux-font-size-xs);
      font-weight: 500;
    }

    .ux-sparkline__change--positive {
      color: var(--ux-success);
    }

    .ux-sparkline__change--negative {
      color: var(--ux-danger);
    }

    .ux-sparkline__change--neutral {
      color: var(--ux-text-secondary);
    }

    .ux-sparkline__change svg {
      width: 12px;
      height: 12px;
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-sparkline--sm .ux-sparkline__line {
      stroke-width: 1.5;
    }

    .ux-sparkline--lg .ux-sparkline__line {
      stroke-width: 2.5;
    }

    /* ========================================
       Interactive
    ======================================== */

    .ux-sparkline--interactive {
      cursor: pointer;
    }

    .ux-sparkline--interactive:hover .ux-sparkline__line {
      stroke-width: 2.5;
    }

    .ux-sparkline__tooltip {
      position: absolute;
      padding: 0.375rem 0.625rem;
      background: var(--ux-gray-900);
      border-radius: var(--ux-radius-sm);
      font-size: 0.75rem;
      color: white;
      white-space: nowrap;
      pointer-events: none;
      transform: translate(-50%, -100%);
      margin-top: -8px;
      z-index: var(--ux-z-tooltip);
    }

    .ux-sparkline__tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 4px solid transparent;
      border-top-color: var(--ux-gray-900);
    }

    /* ========================================
       Animated
    ======================================== */

    .ux-sparkline--animated .ux-sparkline__line {
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      animation: ux-sparkline-draw 1s ease-out forwards;
    }

    @keyframes ux-sparkline-draw {
      to {
        stroke-dashoffset: 0;
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-sparkline--animated .ux-sparkline__line {
        animation: none;
        stroke-dasharray: none;
        stroke-dashoffset: 0;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-sparkline-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-sparkline-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Icons
  const icons = {
    up: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5H7z"/></svg>',
    down: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5H7z"/></svg>',
    neutral: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="11" width="16" height="2" rx="1"/></svg>'
  };

  // Alpine.js component for sparkline
  const sparklineData = (options = {}) => ({
    // Data
    data: options.data || [],

    // Configuration
    width: options.width || 100,
    height: options.height || 30,
    type: options.type || 'line', // 'line', 'bar', 'area'
    showDots: options.showDots ?? false,
    showLastDot: options.showLastDot ?? true,
    showArea: options.showArea ?? false,
    showReference: options.showReference ?? false,
    referenceValue: options.referenceValue || null, // null = average
    smooth: options.smooth ?? true,
    animated: options.animated ?? false,
    barGap: options.barGap || 2,
    padding: options.padding || 4,

    // Value display
    showValue: options.showValue ?? false,
    showChange: options.showChange ?? false,
    valueFormat: options.valueFormat || null, // Function to format value
    changeFormat: options.changeFormat || null,

    // State
    icons,

    // Get normalized data
    get normalizedData() {
      if (!this.data || this.data.length === 0) return [];

      const values = this.data.map(d => typeof d === 'object' ? d.value : d);
      const min = Math.min(...values);
      const max = Math.max(...values);
      const range = max - min || 1;

      return values.map(v => (v - min) / range);
    },

    // Get min/max values
    get minValue() {
      if (!this.data || this.data.length === 0) return 0;
      const values = this.data.map(d => typeof d === 'object' ? d.value : d);
      return Math.min(...values);
    },

    get maxValue() {
      if (!this.data || this.data.length === 0) return 0;
      const values = this.data.map(d => typeof d === 'object' ? d.value : d);
      return Math.max(...values);
    },

    // Get current (last) value
    get currentValue() {
      if (!this.data || this.data.length === 0) return 0;
      const last = this.data[this.data.length - 1];
      return typeof last === 'object' ? last.value : last;
    },

    // Get first value
    get firstValue() {
      if (!this.data || this.data.length === 0) return 0;
      const first = this.data[0];
      return typeof first === 'object' ? first.value : first;
    },

    // Calculate change
    get change() {
      if (this.firstValue === 0) return 0;
      return ((this.currentValue - this.firstValue) / Math.abs(this.firstValue)) * 100;
    },

    get changeType() {
      if (this.change > 0) return 'positive';
      if (this.change < 0) return 'negative';
      return 'neutral';
    },

    // Get average
    get average() {
      if (!this.data || this.data.length === 0) return 0;
      const values = this.data.map(d => typeof d === 'object' ? d.value : d);
      return values.reduce((a, b) => a + b, 0) / values.length;
    },

    // Calculate points for line/area
    get points() {
      const data = this.normalizedData;
      if (data.length === 0) return [];

      const innerWidth = this.width - (this.padding * 2);
      const innerHeight = this.height - (this.padding * 2);
      const step = innerWidth / Math.max(data.length - 1, 1);

      return data.map((value, index) => ({
        x: this.padding + (index * step),
        y: this.padding + (innerHeight - (value * innerHeight)),
        value: typeof this.data[index] === 'object' ? this.data[index].value : this.data[index]
      }));
    },

    // Get SVG path for line
    get linePath() {
      if (this.points.length === 0) return '';

      if (this.smooth && this.points.length > 2) {
        return this.getSmoothPath(this.points);
      }

      return this.points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ');
    },

    // Get SVG path for area
    get areaPath() {
      if (this.points.length === 0) return '';

      const linePath = this.linePath;
      const firstPoint = this.points[0];
      const lastPoint = this.points[this.points.length - 1];
      const bottom = this.height - this.padding;

      return `${linePath} L ${lastPoint.x} ${bottom} L ${firstPoint.x} ${bottom} Z`;
    },

    // Smooth curve using bezier
    getSmoothPath(points) {
      if (points.length < 2) return '';

      let path = `M ${points[0].x} ${points[0].y}`;

      for (let i = 0; i < points.length - 1; i++) {
        const p0 = points[i === 0 ? i : i - 1];
        const p1 = points[i];
        const p2 = points[i + 1];
        const p3 = points[i + 2 >= points.length ? i + 1 : i + 2];

        const cp1x = p1.x + (p2.x - p0.x) / 6;
        const cp1y = p1.y + (p2.y - p0.y) / 6;
        const cp2x = p2.x - (p3.x - p1.x) / 6;
        const cp2y = p2.y - (p3.y - p1.y) / 6;

        path += ` C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${p2.x} ${p2.y}`;
      }

      return path;
    },

    // Get bars data
    get bars() {
      const data = this.normalizedData;
      if (data.length === 0) return [];

      const innerWidth = this.width - (this.padding * 2);
      const innerHeight = this.height - (this.padding * 2);
      const barWidth = (innerWidth - (this.barGap * (data.length - 1))) / data.length;

      return data.map((value, index) => {
        const rawValue = typeof this.data[index] === 'object' ? this.data[index].value : this.data[index];
        const isNegative = rawValue < 0;

        return {
          x: this.padding + (index * (barWidth + this.barGap)),
          y: this.padding + (innerHeight - (value * innerHeight)),
          width: Math.max(barWidth, 1),
          height: value * innerHeight,
          value: rawValue,
          isNegative
        };
      });
    },

    // Get reference line Y position
    get referenceY() {
      const refValue = this.referenceValue !== null ? this.referenceValue : this.average;
      const range = this.maxValue - this.minValue || 1;
      const normalized = (refValue - this.minValue) / range;
      const innerHeight = this.height - (this.padding * 2);

      return this.padding + (innerHeight - (normalized * innerHeight));
    },

    // Format value for display
    formatValue(value) {
      if (this.valueFormat && typeof this.valueFormat === 'function') {
        return this.valueFormat(value);
      }
      if (Math.abs(value) >= 1000000) {
        return (value / 1000000).toFixed(1) + 'M';
      }
      if (Math.abs(value) >= 1000) {
        return (value / 1000).toFixed(1) + 'K';
      }
      return value.toFixed(value % 1 === 0 ? 0 : 1);
    },

    // Format change for display
    formatChange(value) {
      if (this.changeFormat && typeof this.changeFormat === 'function') {
        return this.changeFormat(value);
      }
      const sign = value > 0 ? '+' : '';
      return `${sign}${value.toFixed(1)}%`;
    },

    // Set data
    setData(newData) {
      this.data = newData;
    },

    // Add data point
    addPoint(value) {
      this.data.push(value);
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxSparkline', sparklineData);
  }

})();

/**
 * UX Spinner Component
 * Indicadores de carga animados
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Spinner
    ======================================== */

    .ux-spinner {
      /* Internal color variable - set by .ux-color-* or direct */
      --_spinner-color: var(--ux-variant-bg, var(--ux-primary));
      --_spinner-color-rgb: var(--ux-variant-bg-rgb, var(--ux-primary-rgb));

      display: inline-block;
      width: var(--ux-spinner-size);
      height: var(--ux-spinner-size);
      border: 3px solid rgba(var(--_spinner-color-rgb), 0.2);
      border-top-color: var(--_spinner-color);
      border-radius: 50%;
      animation: ux-spinner-rotate 0.8s linear infinite;
    }

    @keyframes ux-spinner-rotate {
      to {
        transform: rotate(360deg);
      }
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-spinner--xs {
      width: calc(var(--ux-spinner-size-sm) * 0.8);
      height: calc(var(--ux-spinner-size-sm) * 0.8);
      border-width: 2px;
    }

    .ux-spinner--sm {
      width: var(--ux-spinner-size-sm);
      height: var(--ux-spinner-size-sm);
      border-width: 2px;
    }

    .ux-spinner--lg {
      width: var(--ux-spinner-size-lg);
      height: var(--ux-spinner-size-lg);
      border-width: 4px;
    }

    .ux-spinner--xl {
      width: calc(var(--ux-spinner-size-lg) * 1.4);
      height: calc(var(--ux-spinner-size-lg) * 1.4);
      border-width: 5px;
    }

    /* ========================================
       Special Color Variants (light backgrounds)
    ======================================== */

    .ux-spinner--light,
    .ux-spinner--white {
      --_spinner-color: #ffffff;
      --_spinner-color-rgb: 255, 255, 255;
    }

    /* ========================================
       Dots Spinner
    ======================================== */

    .ux-spinner--dots {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      width: auto;
      height: auto;
      border: none;
      animation: none;
    }

    .ux-spinner--dots span {
      width: 8px;
      height: 8px;
      background-color: var(--_spinner-color);
      border-radius: 50%;
      animation: ux-spinner-dots 1.4s ease-in-out infinite both;
    }

    .ux-spinner--dots span:nth-child(1) {
      animation-delay: -0.32s;
    }

    .ux-spinner--dots span:nth-child(2) {
      animation-delay: -0.16s;
    }

    @keyframes ux-spinner-dots {
      0%, 80%, 100% {
        transform: scale(0);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .ux-spinner--dots.ux-spinner--sm span {
      width: 6px;
      height: 6px;
    }

    .ux-spinner--dots.ux-spinner--lg span {
      width: 12px;
      height: 12px;
    }

    /* ========================================
       Bars Spinner
    ======================================== */

    .ux-spinner--bars {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      width: auto;
      height: 28px;
      border: none;
      animation: none;
    }

    .ux-spinner--bars span {
      width: 4px;
      height: 100%;
      background-color: var(--_spinner-color);
      border-radius: 2px;
      animation: ux-spinner-bars 1.2s ease-in-out infinite;
    }

    .ux-spinner--bars span:nth-child(1) { animation-delay: -1.2s; }
    .ux-spinner--bars span:nth-child(2) { animation-delay: -1.1s; }
    .ux-spinner--bars span:nth-child(3) { animation-delay: -1.0s; }
    .ux-spinner--bars span:nth-child(4) { animation-delay: -0.9s; }

    @keyframes ux-spinner-bars {
      0%, 40%, 100% {
        transform: scaleY(0.4);
      }
      20% {
        transform: scaleY(1);
      }
    }

    /* ========================================
       iOS Native Style Spinner (12 lines)
    ======================================== */

    .ux-spinner--ios {
      position: relative;
      width: var(--ux-spinner-ios-size, 20px);
      height: var(--ux-spinner-ios-size, 20px);
      border: none;
      animation: ux-spinner-ios 1s steps(12) infinite;
    }

    .ux-spinner--ios::before,
    .ux-spinner--ios::after,
    .ux-spinner--ios span {
      content: '';
      position: absolute;
      top: 0;
      left: calc(50% - var(--ux-spinner-ios-line-width, 1.5px));
      width: var(--ux-spinner-ios-line-width, 1.5px);
      height: var(--ux-spinner-ios-line-height, 25%);
      background-color: var(--_spinner-color);
      border-radius: var(--ux-spinner-ios-line-radius, 1px);
      transform-origin: center calc(var(--ux-spinner-ios-size, 20px) / 2);
    }

    .ux-spinner--ios::before { opacity: 1; transform: rotate(0deg); }
    .ux-spinner--ios::after { opacity: 0.916; transform: rotate(30deg); }
    .ux-spinner--ios span:nth-child(1) { opacity: 0.833; transform: rotate(60deg); }
    .ux-spinner--ios span:nth-child(2) { opacity: 0.75; transform: rotate(90deg); }
    .ux-spinner--ios span:nth-child(3) { opacity: 0.666; transform: rotate(120deg); }
    .ux-spinner--ios span:nth-child(4) { opacity: 0.583; transform: rotate(150deg); }
    .ux-spinner--ios span:nth-child(5) { opacity: 0.5; transform: rotate(180deg); }
    .ux-spinner--ios span:nth-child(6) { opacity: 0.416; transform: rotate(210deg); }
    .ux-spinner--ios span:nth-child(7) { opacity: 0.333; transform: rotate(240deg); }
    .ux-spinner--ios span:nth-child(8) { opacity: 0.25; transform: rotate(270deg); }
    .ux-spinner--ios span:nth-child(9) { opacity: 0.166; transform: rotate(300deg); }
    .ux-spinner--ios span:nth-child(10) { opacity: 0.083; transform: rotate(330deg); }

    @keyframes ux-spinner-ios {
      to {
        transform: rotate(360deg);
      }
    }

    .ux-spinner--ios.ux-spinner--sm {
      --ux-spinner-ios-size: 16px;
      --ux-spinner-ios-line-width: 1.2px;
    }

    .ux-spinner--ios.ux-spinner--lg {
      --ux-spinner-ios-size: 28px;
      --ux-spinner-ios-line-width: 2px;
    }

    /* ========================================
       Spinner Container
    ======================================== */

    .ux-spinner-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-md);
      padding: var(--ux-space-xl);
    }

    .ux-spinner-container__text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* ========================================
       Full Page Spinner
    ======================================== */

    .ux-spinner-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(var(--ux-background-rgb), 0.8);
      z-index: var(--ux-z-modal);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
    }

    /* ========================================
       Inline Spinner (for buttons, inputs)
    ======================================== */

    .ux-spinner--inline {
      vertical-align: middle;
      margin-right: var(--ux-space-sm);
    }

    /* ========================================
       Paused State
    ======================================== */

    .ux-spinner--paused,
    .ux-spinner--paused span {
      animation-play-state: paused;
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .ux-spinner {
        animation: none;
        border-top-color: var(--_spinner-color);
        opacity: 0.8;
      }

      .ux-spinner--dots span {
        animation: none;
        opacity: 0.7;
      }

      .ux-spinner--bars span {
        animation: none;
        transform: scaleY(0.7);
      }

      .ux-spinner--ios {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-spinner-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-spinner-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for spinner with loading state
  // ARIA: role="status", aria-label for screen readers
  const spinnerComponent = (config = {}) => ({
    visible: config.visible !== undefined ? config.visible : true,
    text: config.text || '',
    ariaLabel: config.ariaLabel || 'Loading',

    // ARIA attributes for the spinner
    get ariaAttrs() {
      return {
        'role': 'status',
        'aria-live': 'polite',
        'aria-label': this.text || this.ariaLabel
      };
    },

    show(text = '') {
      this.text = text;
      this.visible = true;
      // Announce to screen readers
      if (window.UX && window.UX.announce) {
        window.UX.announce(text || this.ariaLabel, 'polite');
      }
    },

    hide() {
      this.visible = false;
    },

    toggle() {
      this.visible = !this.visible;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSpinner', spinnerComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSpinner', spinnerComponent);
    });
  }
})();

/**
 * UX Split Button Component
 * BotÃ³n dividido con acciÃ³n principal y dropdown
 * @requires ux-core.js
 * @requires ux-button.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Split Button
    ======================================== */

    .ux-split-button {
      display: inline-flex;
      position: relative;
      vertical-align: middle;
    }

    .ux-split-button__main {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      border-right: none;
    }

    .ux-split-button__toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-split-button-toggle-width, 36px);
      height: var(--ux-button-height);
      padding: 0;
      background-color: var(--ux-variant-bg, var(--ux-primary));
      color: var(--ux-variant-color, var(--ux-primary-contrast));
      border: 2px solid var(--ux-variant-border, transparent);
      border-left: 1px solid rgba(255, 255, 255, 0.2);
      border-top-right-radius: var(--ux-button-border-radius);
      border-bottom-right-radius: var(--ux-button-border-radius);
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      cursor: pointer;
      transition: var(--ux-transition-colors);
    }

    .ux-split-button__toggle:hover {
      background-color: var(--ux-variant-bg-hover, var(--ux-primary-shade));
    }

    .ux-split-button__toggle:active {
      transform: scale(0.97);
    }

    .ux-split-button__toggle:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
      z-index: 1;
    }

    .ux-split-button__toggle-icon {
      width: 16px;
      height: 16px;
      transition: transform var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-split-button--open .ux-split-button__toggle-icon {
      transform: rotate(180deg);
    }

    /* ========================================
       Dropdown Menu
    ======================================== */

    .ux-split-button__dropdown {
      position: absolute;
      top: calc(100% + 4px);
      right: 0;
      min-width: 160px;
      padding: var(--ux-space-xs) 0;
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      box-shadow: var(--ux-shadow-lg);
      z-index: var(--ux-z-dropdown);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease),
        visibility var(--ux-transition-fast);
    }

    .ux-split-button--open .ux-split-button__dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    /* Dropdown position variants */
    .ux-split-button--dropdown-left .ux-split-button__dropdown {
      right: auto;
      left: 0;
    }

    .ux-split-button--dropdown-up .ux-split-button__dropdown {
      top: auto;
      bottom: calc(100% + 4px);
      transform: translateY(8px);
    }

    .ux-split-button--dropdown-up.ux-split-button--open .ux-split-button__dropdown {
      transform: translateY(0);
    }

    /* ========================================
       Dropdown Items
    ======================================== */

    .ux-split-button__item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      width: 100%;
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-md);
      text-align: left;
      color: var(--ux-text);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-split-button__item:hover {
      background-color: var(--ux-surface-secondary);
    }

    .ux-split-button__item:active {
      background-color: var(--ux-surface-tertiary);
    }

    .ux-split-button__item:focus-visible {
      background-color: var(--ux-surface-secondary);
      outline: none;
    }

    .ux-split-button__item-icon {
      width: 18px;
      height: 18px;
      opacity: 0.7;
    }

    .ux-split-button__item--danger {
      color: var(--ux-danger);
    }

    .ux-split-button__item--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    .ux-split-button__divider {
      height: 1px;
      margin: var(--ux-space-xs) 0;
      background-color: var(--ux-border-color);
    }

    /* ========================================
       Outline Variant
    ======================================== */

    .ux-split-button--outline .ux-split-button__main {
      background-color: transparent;
      color: var(--ux-variant-color, var(--ux-primary));
      border: 2px solid var(--ux-variant-border, var(--ux-primary));
      border-right: none;
    }

    .ux-split-button--outline .ux-split-button__toggle {
      background-color: transparent;
      color: var(--ux-variant-color, var(--ux-primary));
      border: 2px solid var(--ux-variant-border, var(--ux-primary));
      border-left: 1px solid var(--ux-variant-border, var(--ux-primary));
    }

    .ux-split-button--outline .ux-split-button__toggle:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-split-button--sm .ux-split-button__main {
      height: var(--ux-button-height-sm);
      padding: 0 var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
    }

    .ux-split-button--sm .ux-split-button__toggle {
      width: 30px;
      height: var(--ux-button-height-sm);
    }

    .ux-split-button--sm .ux-split-button__toggle-icon {
      width: 14px;
      height: 14px;
    }

    .ux-split-button--lg .ux-split-button__main {
      height: var(--ux-button-height-lg);
      padding: 0 var(--ux-space-lg);
      font-size: var(--ux-font-size-lg);
    }

    .ux-split-button--lg .ux-split-button__toggle {
      width: 44px;
      height: var(--ux-button-height-lg);
    }

    .ux-split-button--lg .ux-split-button__toggle-icon {
      width: 20px;
      height: 20px;
    }

    /* ========================================
       Block (full width)
    ======================================== */

    .ux-split-button--block {
      display: flex;
      width: 100%;
    }

    .ux-split-button--block .ux-split-button__main {
      flex: 1;
    }

    .ux-split-button--block .ux-split-button__dropdown {
      width: 100%;
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-split-button--disabled .ux-split-button__main,
    .ux-split-button--disabled .ux-split-button__toggle {
      opacity: 0.5;
      pointer-events: none;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-split-button__dropdown {
        background-color: var(--ux-surface);
        border-color: var(--ux-border-color);
      }

      .ux-split-button__toggle {
        border-left-color: rgba(255, 255, 255, 0.15);
      }
    }

    .ux-dark .ux-split-button__dropdown {
      background-color: var(--ux-surface);
      border-color: var(--ux-border-color);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-split-button__dropdown {
        transition: opacity var(--ux-transition-fast);
        transform: none;
      }

      .ux-split-button__toggle-icon {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-split-button-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-split-button-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const splitButtonData = (options = {}) => ({
    isOpen: false,
    closeOnSelect: options.closeOnSelect ?? true,

    init() {
      // Close on click outside
      this._clickOutsideHandler = (e) => {
        if (!this.$el.contains(e.target) && this.isOpen) {
          this.close();
        }
      };
      document.addEventListener('click', this._clickOutsideHandler);

      // Close on escape
      this._escapeHandler = (e) => {
        if (e.key === 'Escape' && this.isOpen) {
          this.close();
          this.$el.querySelector('.ux-split-button__toggle')?.focus();
        }
      };
      document.addEventListener('keydown', this._escapeHandler);
    },

    destroy() {
      document.removeEventListener('click', this._clickOutsideHandler);
      document.removeEventListener('keydown', this._escapeHandler);
    },

    toggle() {
      this.isOpen = !this.isOpen;
      this.$dispatch('splitbutton:toggle', { isOpen: this.isOpen });
    },

    open() {
      this.isOpen = true;
      this.$dispatch('splitbutton:open');
    },

    close() {
      this.isOpen = false;
      this.$dispatch('splitbutton:close');
    },

    selectItem(value) {
      this.$dispatch('splitbutton:select', { value });
      if (this.closeOnSelect) {
        this.close();
      }
    },

    get containerClasses() {
      return {
        'ux-split-button--open': this.isOpen
      };
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSplitButton', splitButtonData);
  }

})();

(function() {
  'use strict';

  const styles = `
    /* ========================================
       Split Pane Right
       Panel lateral derecho con toggle
       - Desktop: visible, puede ocultarse
       - Mobile: overlay desde la derecha
    ======================================== */

    .ux-split-pane-right {
      display: flex;
      flex-direction: row;
      height: 100%;
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    /* Main content area */
    .ux-split-pane-right__main {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }

    /* Side panel (right) */
    .ux-split-pane-right__side {
      width: var(--ux-split-pane-right-width, 320px);
      max-width: 85vw;
      flex-shrink: 0;
      height: 100%;
      background: var(--ux-surface);
      border-left: 1px solid var(--ux-border-color);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: transform var(--ux-transition-normal) var(--ux-ease-ios),
                  width var(--ux-transition-normal) var(--ux-ease-ios),
                  opacity var(--ux-transition-normal) var(--ux-ease-ios);
    }

    /* Backdrop for mobile */
    .ux-split-pane-right__backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: var(--ux-backdrop-color, rgba(0, 0, 0, 0.4));
      z-index: var(--ux-z-modal-backdrop);
      opacity: 0;
      transition: opacity var(--ux-transition-normal) var(--ux-ease-ios);
      -webkit-tap-highlight-color: transparent;
    }

    /* ========================================
       Desktop behavior (>= 992px)
    ======================================== */

    @media (min-width: 992px) {
      /* Panel visible por defecto */
      .ux-split-pane-right__side {
        position: relative;
        transform: translateX(0);
      }

      /* Panel oculto en desktop */
      .ux-split-pane-right--collapsed .ux-split-pane-right__side {
        width: 0;
        border-left: none;
        opacity: 0;
        overflow: hidden;
      }

      /* Ocultar backdrop en desktop */
      .ux-split-pane-right__backdrop {
        display: none !important;
      }
    }

    /* ========================================
       Mobile behavior (< 992px)
    ======================================== */

    @media (max-width: 991px) {
      /* Panel como overlay */
      .ux-split-pane-right__side {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        z-index: var(--ux-z-modal);
        transform: translateX(100%);
        box-shadow: var(--ux-shadow-xl);
      }

      /* Panel visible en mobile */
      .ux-split-pane-right--open .ux-split-pane-right__side {
        transform: translateX(0);
      }

      /* Backdrop visible en mobile */
      .ux-split-pane-right__backdrop {
        display: block;
        pointer-events: none;
        opacity: 0;
      }

      .ux-split-pane-right--open .ux-split-pane-right__backdrop {
        pointer-events: auto;
        opacity: 1;
      }
    }

    /* ========================================
       Toggle button
    ======================================== */

    .ux-split-pane-right__toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      padding: 0;
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-split-pane-right__toggle svg {
      width: 24px;
      height: 24px;
    }

    /* Hide toggle in desktop when panel is visible */
    @media (min-width: 992px) {
      .ux-split-pane-right:not(.ux-split-pane-right--collapsed) .ux-split-pane-right__toggle--mobile-only {
        display: none;
      }
    }

    /* ========================================
       Glass variant
    ======================================== */

    .ux-split-pane-right__side--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-left-color: var(--ux-glass-border);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-split-pane-right-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-split-pane-right-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const splitPaneRightComponent = (config = {}) => ({
    isOpen: false,
    isCollapsed: config.collapsed ?? false,
    _isLargeScreen: false,

    init() {
      // Check screen size
      this._checkScreenSize();
      this._resizeHandler = () => this._checkScreenSize();
      window.addEventListener('resize', this._resizeHandler);

      // Close on escape
      this._escapeHandler = (e) => {
        if (e.key === 'Escape' && this.isOpen && !this._isLargeScreen) {
          this.close();
        }
      };
      document.addEventListener('keydown', this._escapeHandler);
    },

    destroy() {
      if (this._resizeHandler) {
        window.removeEventListener('resize', this._resizeHandler);
      }
      if (this._escapeHandler) {
        document.removeEventListener('keydown', this._escapeHandler);
      }
    },

    _checkScreenSize() {
      const wasLarge = this._isLargeScreen;
      this._isLargeScreen = window.innerWidth >= 992;

      // Close overlay when switching to desktop
      if (this._isLargeScreen && !wasLarge && this.isOpen) {
        this.isOpen = false;
        window.UX?.unlockScroll();
      }
    },

    open() {
      this.isOpen = true;
      if (!this._isLargeScreen) {
        window.UX?.lockScroll();
      }
      this.$dispatch('splitpaneright:open');
    },

    close() {
      this.isOpen = false;
      window.UX?.unlockScroll();
      this.$dispatch('splitpaneright:close');
    },

    toggle() {
      if (this._isLargeScreen) {
        // In desktop, toggle collapsed state
        this.isCollapsed = !this.isCollapsed;
        this.$dispatch('splitpaneright:toggle', { collapsed: this.isCollapsed });
      } else {
        // In mobile, toggle overlay
        this.isOpen ? this.close() : this.open();
      }
    },

    // Show panel (for desktop)
    show() {
      this.isCollapsed = false;
      this.$dispatch('splitpaneright:show');
    },

    // Hide panel (for desktop)
    hide() {
      this.isCollapsed = true;
      this.$dispatch('splitpaneright:hide');
    },

    get containerClasses() {
      return {
        'ux-split-pane-right--open': this.isOpen,
        'ux-split-pane-right--collapsed': this.isCollapsed
      };
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxSplitPaneRight', splitPaneRightComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSplitPaneRight', splitPaneRightComponent);
    });
  }
})();

(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       UX State - Empty, Error, Success, Loading States
       iOS 26 Style - Liquid Glass Design
       ========================================================================== */

    :root {
      /* State Tokens */
      --ux-state-padding: var(--ux-space-2xl);
      --ux-state-icon-size: 64px;
      --ux-state-icon-size-sm: 48px;
      --ux-state-icon-size-lg: 80px;
      --ux-state-icon-color: var(--ux-text-tertiary);
      --ux-state-title-size: var(--ux-font-size-lg);
      --ux-state-description-size: var(--ux-font-size-md);
      --ux-state-gap: var(--ux-space-md);
    }

    /* ==========================================================================
       Base State Container
       ========================================================================== */

    .ux-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: var(--ux-state-padding);
      min-height: 200px;
      gap: var(--ux-state-gap);
    }

    /* Size variants */
    .ux-state--sm {
      --ux-state-padding: var(--ux-space-lg);
      --ux-state-icon-size: var(--ux-state-icon-size-sm);
      --ux-state-title-size: var(--ux-font-size-md);
      --ux-state-description-size: var(--ux-font-size-sm);
      min-height: 150px;
    }

    .ux-state--lg {
      --ux-state-padding: var(--ux-space-3xl);
      --ux-state-icon-size: var(--ux-state-icon-size-lg);
      --ux-state-title-size: var(--ux-font-size-xl);
      min-height: 300px;
    }

    /* Full height variant */
    .ux-state--full {
      min-height: 100%;
      flex: 1;
    }

    /* ==========================================================================
       State Icon
       ========================================================================== */

    .ux-state__icon {
      width: var(--ux-state-icon-size);
      height: var(--ux-state-icon-size);
      color: var(--ux-state-icon-color);
      opacity: 0.6;
      margin-bottom: var(--ux-space-sm);
      transition: transform var(--ux-transition-normal) var(--ux-ease-ios);
    }

    .ux-state__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-state__icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Animated icon */
    .ux-state__icon--animated {
      animation: ux-state-float 3s ease-in-out infinite;
    }

    @keyframes ux-state-float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    /* Icon with background circle */
    .ux-state__icon--circle {
      padding: var(--ux-space-lg);
      background: var(--ux-surface-secondary);
      border-radius: 50%;
      width: auto;
      height: auto;
    }

    .ux-state__icon--circle svg {
      width: var(--ux-state-icon-size);
      height: var(--ux-state-icon-size);
    }

    /* ==========================================================================
       State Content
       ========================================================================== */

    .ux-state__content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-xs);
      max-width: 320px;
    }

    .ux-state__title {
      font-size: var(--ux-state-title-size);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      line-height: 1.3;
    }

    .ux-state__description {
      font-size: var(--ux-state-description-size);
      color: var(--ux-text-secondary);
      margin: 0;
      line-height: 1.5;
    }

    /* ==========================================================================
       State Actions
       ========================================================================== */

    .ux-state__actions {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--ux-space-sm);
      margin-top: var(--ux-space-md);
    }

    .ux-state__actions--row {
      flex-direction: row;
    }

    /* ==========================================================================
       Empty State
       ========================================================================== */

    .ux-empty-state {
      --ux-state-icon-color: var(--ux-text-tertiary);
    }

    .ux-empty-state .ux-state__icon {
      opacity: 0.5;
    }

    /* ==========================================================================
       Error State
       ========================================================================== */

    .ux-error-state {
      --ux-state-icon-color: var(--ux-danger);
    }

    .ux-error-state .ux-state__icon {
      opacity: 0.8;
    }

    .ux-error-state .ux-state__title {
      color: var(--ux-danger);
    }

    /* ==========================================================================
       Success State
       ========================================================================== */

    .ux-success-state {
      --ux-state-icon-color: var(--ux-success);
    }

    .ux-success-state .ux-state__icon {
      opacity: 0.8;
    }

    .ux-success-state .ux-state__title {
      color: var(--ux-success);
    }

    /* Checkmark animation */
    .ux-success-state .ux-state__icon--animated svg {
      animation: ux-state-checkmark 0.5s ease-out forwards;
    }

    @keyframes ux-state-checkmark {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }

    /* ==========================================================================
       Warning State
       ========================================================================== */

    .ux-warning-state {
      --ux-state-icon-color: var(--ux-warning);
    }

    .ux-warning-state .ux-state__icon {
      opacity: 0.8;
    }

    .ux-warning-state .ux-state__title {
      color: var(--ux-warning);
    }

    /* ==========================================================================
       Info State
       ========================================================================== */

    .ux-info-state {
      --ux-state-icon-color: var(--ux-primary);
    }

    .ux-info-state .ux-state__icon {
      opacity: 0.8;
    }

    /* ==========================================================================
       Offline State
       ========================================================================== */

    .ux-offline-state {
      --ux-state-icon-color: var(--ux-text-tertiary);
    }

    .ux-offline-state .ux-state__icon svg {
      stroke-dasharray: 100;
      animation: ux-state-offline-pulse 2s ease-in-out infinite;
    }

    @keyframes ux-state-offline-pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    /* ==========================================================================
       Loading State (Alternative to spinner)
       ========================================================================== */

    .ux-loading-state {
      --ux-state-icon-color: var(--ux-primary);
    }

    .ux-loading-state .ux-state__icon svg {
      animation: ux-state-spin 1s linear infinite;
    }

    @keyframes ux-state-spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* ==========================================================================
       Search Empty State
       ========================================================================== */

    .ux-search-empty-state {
      --ux-state-icon-color: var(--ux-text-tertiary);
    }

    .ux-search-empty-state .ux-state__highlight {
      background: rgba(var(--ux-primary-rgb), 0.1);
      color: var(--ux-primary);
      padding: 2px 8px;
      border-radius: var(--ux-border-radius-sm);
      font-weight: 500;
    }

    /* ==========================================================================
       No Permission State
       ========================================================================== */

    .ux-no-permission-state {
      --ux-state-icon-color: var(--ux-danger);
    }

    /* ==========================================================================
       Inline State (Compact for lists/cards)
       ========================================================================== */

    .ux-state--inline {
      flex-direction: row;
      text-align: left;
      padding: var(--ux-space-md);
      min-height: auto;
      gap: var(--ux-space-md);
    }

    .ux-state--inline .ux-state__icon {
      width: 40px;
      height: 40px;
      margin-bottom: 0;
      flex-shrink: 0;
    }

    .ux-state--inline .ux-state__content {
      align-items: flex-start;
      max-width: none;
    }

    .ux-state--inline .ux-state__actions {
      margin-top: var(--ux-space-sm);
      align-items: flex-start;
    }

    /* ==========================================================================
       Card State (With border)
       ========================================================================== */

    .ux-state--card {
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
    }

    .ux-state--card.ux-error-state {
      border-color: rgba(var(--ux-danger-rgb), 0.3);
      background: rgba(var(--ux-danger-rgb), 0.03);
    }

    .ux-state--card.ux-success-state {
      border-color: rgba(var(--ux-success-rgb), 0.3);
      background: rgba(var(--ux-success-rgb), 0.03);
    }

    .ux-state--card.ux-warning-state {
      border-color: rgba(var(--ux-warning-rgb), 0.3);
      background: rgba(var(--ux-warning-rgb), 0.03);
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-state--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border: 1px solid var(--ux-glass-border);
      border-radius: var(--ux-border-radius-lg);
    }

    .ux-state--glass .ux-state__icon--circle {
      background: rgba(255, 255, 255, 0.2);
    }

    /* ==========================================================================
       Connection Status Banner
       ========================================================================== */

    .ux-connection-status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      transition: all var(--ux-transition-normal) var(--ux-ease-ios);
    }

    .ux-connection-status__dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: ux-status-pulse 2s ease-in-out infinite;
    }

    @keyframes ux-status-pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.9); }
    }

    /* Online */
    .ux-connection-status--online {
      background: rgba(var(--ux-success-rgb), 0.1);
      color: var(--ux-success);
    }

    .ux-connection-status--online .ux-connection-status__dot {
      background: var(--ux-success);
    }

    /* Offline */
    .ux-connection-status--offline {
      background: rgba(var(--ux-danger-rgb), 0.1);
      color: var(--ux-danger);
    }

    .ux-connection-status--offline .ux-connection-status__dot {
      background: var(--ux-danger);
    }

    /* Reconnecting */
    .ux-connection-status--reconnecting {
      background: rgba(var(--ux-warning-rgb), 0.1);
      color: var(--ux-warning);
    }

    .ux-connection-status--reconnecting .ux-connection-status__dot {
      background: var(--ux-warning);
      animation: ux-status-blink 0.5s ease-in-out infinite;
    }

    @keyframes ux-status-blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* ==========================================================================
       Page-Level States (Full viewport)
       ========================================================================== */

    .ux-page-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100dvh;
      padding: var(--ux-space-xl);
    }

    .ux-page-state .ux-state {
      max-width: 400px;
    }

    /* ==========================================================================
       List Empty State
       ========================================================================== */

    .ux-list-empty {
      padding: var(--ux-space-xl) var(--ux-space-lg);
    }

    /* ==========================================================================
       Table Empty State
       ========================================================================== */

    .ux-table-empty {
      padding: var(--ux-space-2xl);
    }

    .ux-table-empty td {
      text-align: center;
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light) .ux-state__icon--circle {
        background: var(--ux-surface-tertiary);
      }

      :root:not(.ux-light) .ux-state--card {
        background: var(--ux-surface-secondary);
      }

      :root:not(.ux-light) .ux-state--glass .ux-state__icon--circle {
        background: rgba(255, 255, 255, 0.1);
      }
    }

    .ux-dark .ux-state__icon--circle {
      background: var(--ux-surface-tertiary);
    }

    .ux-dark .ux-state--card {
      background: var(--ux-surface-secondary);
    }

    .ux-dark .ux-state--glass .ux-state__icon--circle {
      background: rgba(255, 255, 255, 0.1);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-state__icon--animated,
      .ux-loading-state .ux-state__icon svg,
      .ux-offline-state .ux-state__icon svg,
      .ux-connection-status__dot,
      .ux-success-state .ux-state__icon--animated svg {
        animation: none;
      }
    }

    /* ==========================================================================
       Responsive
       ========================================================================== */

    @media (max-width: 767px) {
      .ux-state {
        --ux-state-padding: var(--ux-space-xl);
        --ux-state-icon-size: 56px;
      }

      .ux-state--lg {
        --ux-state-icon-size: 64px;
      }

      .ux-state__content {
        max-width: 280px;
      }

      .ux-state__actions--row {
        flex-direction: column;
        width: 100%;
      }

      .ux-state__actions--row .ux-button {
        width: 100%;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-state-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-state-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // SVG Icons for states
  const stateIcons = {
    empty: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M20 7.5v9a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-9"/>
      <path d="M16.5 2H7.5a2 2 0 0 0-2 2v1.5h13V4a2 2 0 0 0-2-2z"/>
      <path d="M12 11v4"/>
      <path d="M12 18.5v.5"/>
    </svg>`,

    emptyFolder: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
      <line x1="12" y1="11" x2="12" y2="17"/>
      <line x1="9" y1="14" x2="15" y2="14"/>
    </svg>`,

    error: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"/>
      <line x1="15" y1="9" x2="9" y2="15"/>
      <line x1="9" y1="9" x2="15" y2="15"/>
    </svg>`,

    success: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"/>
      <polyline points="16 10 11 15 8 12"/>
    </svg>`,

    warning: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
      <line x1="12" y1="9" x2="12" y2="13"/>
      <line x1="12" y1="17" x2="12.01" y2="17"/>
    </svg>`,

    info: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"/>
      <line x1="12" y1="16" x2="12" y2="12"/>
      <line x1="12" y1="8" x2="12.01" y2="8"/>
    </svg>`,

    offline: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <line x1="1" y1="1" x2="23" y2="23"/>
      <path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/>
      <path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/>
      <path d="M10.71 5.05A16 16 0 0 1 22.58 9"/>
      <path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/>
      <path d="M8.53 16.11a6 6 0 0 1 6.95 0"/>
      <line x1="12" y1="20" x2="12.01" y2="20"/>
    </svg>`,

    search: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="11" cy="11" r="8"/>
      <line x1="21" y1="21" x2="16.65" y2="16.65"/>
      <line x1="8" y1="11" x2="14" y2="11"/>
    </svg>`,

    lock: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
      <circle cx="12" cy="16" r="1"/>
    </svg>`,

    cart: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="9" cy="21" r="1"/>
      <circle cx="20" cy="21" r="1"/>
      <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
      <line x1="12" y1="9" x2="12" y2="13"/>
      <line x1="10" y1="11" x2="14" y2="11"/>
    </svg>`,

    file: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
      <polyline points="14 2 14 8 20 8"/>
      <line x1="12" y1="12" x2="12" y2="18"/>
      <line x1="9" y1="15" x2="15" y2="15"/>
    </svg>`,

    users: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
      <circle cx="9" cy="7" r="4"/>
      <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
      <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
    </svg>`,

    calendar: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
      <line x1="16" y1="2" x2="16" y2="6"/>
      <line x1="8" y1="2" x2="8" y2="6"/>
      <line x1="3" y1="10" x2="21" y2="10"/>
      <line x1="10" y1="14" x2="14" y2="14"/>
    </svg>`,

    inbox: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/>
      <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/>
    </svg>`
  };

  // Export icons for use
  if (window.UX) {
    window.UX.stateIcons = stateIcons;
  }

  window.UXStateIcons = stateIcons;

})();

(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       UX Stats - KPI & Stats Cards
       iOS 26 Style - Liquid Glass Design
       ========================================================================== */

    :root {
      /* Stats Card Tokens */
      --ux-stats-padding: var(--ux-space-lg);
      --ux-stats-border-radius: var(--ux-border-radius-lg);
      --ux-stats-gap: var(--ux-space-sm);
      --ux-stats-value-size: 2rem;
      --ux-stats-value-weight: 700;
      --ux-stats-label-size: var(--ux-font-size-sm);
      --ux-stats-label-color: var(--ux-text-secondary);
      --ux-stats-icon-size: 48px;
      --ux-stats-icon-bg: var(--ux-surface-secondary);
      --ux-stats-trend-size: var(--ux-font-size-sm);
    }

    /* ==========================================================================
       Stats Card
       ========================================================================== */

    .ux-stats-card {
      display: flex;
      flex-direction: column;
      gap: var(--ux-stats-gap);
      padding: var(--ux-stats-padding);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-stats-border-radius);
      transition: transform var(--ux-transition-fast) var(--ux-ease-ios),
                  box-shadow var(--ux-transition-fast) var(--ux-ease-ios);
    }

    .ux-stats-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--ux-shadow-md);
    }

    /* Clickable card */
    a.ux-stats-card,
    button.ux-stats-card {
      cursor: pointer;
      text-decoration: none;
      text-align: left;
    }

    a.ux-stats-card:active,
    button.ux-stats-card:active {
      transform: scale(0.98);
    }

    /* ==========================================================================
       Stats Header (Label + Icon)
       ========================================================================== */

    .ux-stats-card__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--ux-space-md);
    }

    .ux-stats-card__label {
      font-size: var(--ux-stats-label-size);
      font-weight: 500;
      color: var(--ux-stats-label-color);
      line-height: 1.4;
      margin: 0;
    }

    .ux-stats-card__icon {
      width: var(--ux-stats-icon-size);
      height: var(--ux-stats-icon-size);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--ux-stats-icon-bg);
      border-radius: var(--ux-border-radius);
      color: var(--ux-primary);
      flex-shrink: 0;
    }

    .ux-stats-card__icon svg {
      width: 24px;
      height: 24px;
    }

    .ux-stats-card__icon img {
      width: 24px;
      height: 24px;
      object-fit: contain;
    }

    /* Icon sizes */
    .ux-stats-card__icon--sm {
      --ux-stats-icon-size: 36px;
    }

    .ux-stats-card__icon--sm svg,
    .ux-stats-card__icon--sm img {
      width: 18px;
      height: 18px;
    }

    .ux-stats-card__icon--lg {
      --ux-stats-icon-size: 56px;
    }

    .ux-stats-card__icon--lg svg,
    .ux-stats-card__icon--lg img {
      width: 28px;
      height: 28px;
    }

    /* Icon colors */
    .ux-stats-card__icon--primary { background: rgba(var(--ux-primary-rgb), 0.1); color: var(--ux-primary); }
    .ux-stats-card__icon--success { background: rgba(var(--ux-success-rgb), 0.1); color: var(--ux-success); }
    .ux-stats-card__icon--warning { background: rgba(var(--ux-warning-rgb), 0.1); color: var(--ux-warning); }
    .ux-stats-card__icon--danger { background: rgba(var(--ux-danger-rgb), 0.1); color: var(--ux-danger); }
    .ux-stats-card__icon--info { background: rgba(var(--ux-info-rgb, var(--ux-primary-rgb)), 0.1); color: var(--ux-info, var(--ux-primary)); }

    /* ==========================================================================
       Stats Value
       ========================================================================== */

    .ux-stats-card__value {
      font-size: var(--ux-stats-value-size);
      font-weight: var(--ux-stats-value-weight);
      color: var(--ux-text);
      line-height: 1.2;
      margin: 0;
      font-variant-numeric: tabular-nums;
    }

    /* Value sizes */
    .ux-stats-card__value--sm {
      --ux-stats-value-size: 1.5rem;
    }

    .ux-stats-card__value--lg {
      --ux-stats-value-size: 2.5rem;
    }

    .ux-stats-card__value--xl {
      --ux-stats-value-size: 3rem;
    }

    /* Value with prefix/suffix */
    .ux-stats-card__value-wrapper {
      display: flex;
      align-items: baseline;
      gap: var(--ux-space-xs);
    }

    .ux-stats-card__value-prefix,
    .ux-stats-card__value-suffix {
      font-size: calc(var(--ux-stats-value-size) * 0.6);
      font-weight: 500;
      color: var(--ux-text-secondary);
    }

    /* ==========================================================================
       Stats Footer (Trend + Description)
       ========================================================================== */

    .ux-stats-card__footer {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      margin-top: var(--ux-space-xs);
    }

    .ux-stats-card__trend {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: var(--ux-stats-trend-size);
      font-weight: 600;
      padding: 2px 8px;
      border-radius: var(--ux-border-radius-pill);
    }

    .ux-stats-card__trend svg {
      width: 14px;
      height: 14px;
    }

    /* Trend up */
    .ux-stats-card__trend--up {
      color: var(--ux-success);
      background: rgba(var(--ux-success-rgb), 0.1);
    }

    /* Trend down */
    .ux-stats-card__trend--down {
      color: var(--ux-danger);
      background: rgba(var(--ux-danger-rgb), 0.1);
    }

    /* Trend neutral */
    .ux-stats-card__trend--neutral {
      color: var(--ux-text-secondary);
      background: var(--ux-surface-secondary);
    }

    .ux-stats-card__description {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       Stats Progress
       ========================================================================== */

    .ux-stats-card__progress {
      margin-top: var(--ux-space-sm);
    }

    .ux-stats-card__progress-bar {
      height: 6px;
      background: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius-pill);
      overflow: hidden;
    }

    .ux-stats-card__progress-fill {
      height: 100%;
      background: var(--ux-primary);
      border-radius: var(--ux-border-radius-pill);
      transition: width var(--ux-transition-slow) var(--ux-ease-ios);
    }

    .ux-stats-card__progress-fill--success { background: var(--ux-success); }
    .ux-stats-card__progress-fill--warning { background: var(--ux-warning); }
    .ux-stats-card__progress-fill--danger { background: var(--ux-danger); }

    .ux-stats-card__progress-label {
      display: flex;
      justify-content: space-between;
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      margin-top: var(--ux-space-xs);
    }

    /* ==========================================================================
       Stats Sparkline (Mini chart)
       ========================================================================== */

    .ux-stats-card__sparkline {
      height: 40px;
      margin-top: var(--ux-space-sm);
    }

    .ux-stats-card__sparkline svg {
      width: 100%;
      height: 100%;
    }

    .ux-stats-card__sparkline path {
      fill: none;
      stroke: var(--ux-primary);
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .ux-stats-card__sparkline-fill {
      fill: rgba(var(--ux-primary-rgb), 0.1);
      stroke: none;
    }

    /* ==========================================================================
       Size Variants
       ========================================================================== */

    /* Small */
    .ux-stats-card--sm {
      --ux-stats-padding: var(--ux-space-md);
      --ux-stats-value-size: 1.5rem;
      --ux-stats-icon-size: 36px;
    }

    /* Large */
    .ux-stats-card--lg {
      --ux-stats-padding: var(--ux-space-xl);
      --ux-stats-value-size: 2.5rem;
      --ux-stats-icon-size: 56px;
    }

    /* ==========================================================================
       Layout Variants
       ========================================================================== */

    /* Horizontal layout */
    .ux-stats-card--horizontal {
      flex-direction: row;
      align-items: center;
    }

    .ux-stats-card--horizontal .ux-stats-card__icon {
      order: -1;
    }

    .ux-stats-card--horizontal .ux-stats-card__body {
      flex: 1;
    }

    /* Centered layout */
    .ux-stats-card--centered {
      text-align: center;
      align-items: center;
    }

    .ux-stats-card--centered .ux-stats-card__header {
      flex-direction: column;
      align-items: center;
    }

    .ux-stats-card--centered .ux-stats-card__footer {
      justify-content: center;
    }

    /* ==========================================================================
       Color Variants
       ========================================================================== */

    .ux-stats-card--primary {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
      color: white;
    }

    .ux-stats-card--primary .ux-stats-card__label,
    .ux-stats-card--primary .ux-stats-card__description {
      color: rgba(255, 255, 255, 0.8);
    }

    .ux-stats-card--primary .ux-stats-card__value {
      color: white;
    }

    .ux-stats-card--primary .ux-stats-card__icon {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .ux-stats-card--primary .ux-stats-card__progress-bar {
      background: rgba(255, 255, 255, 0.2);
    }

    .ux-stats-card--primary .ux-stats-card__progress-fill {
      background: white;
    }

    /* Gradient variant */
    .ux-stats-card--gradient {
      background: linear-gradient(135deg, var(--ux-primary) 0%, var(--ux-secondary) 100%);
      border: none;
      color: white;
    }

    .ux-stats-card--gradient .ux-stats-card__label,
    .ux-stats-card--gradient .ux-stats-card__description {
      color: rgba(255, 255, 255, 0.85);
    }

    .ux-stats-card--gradient .ux-stats-card__value {
      color: white;
    }

    .ux-stats-card--gradient .ux-stats-card__icon {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-stats-card--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-stats-card--glass .ux-stats-card__icon {
      background: rgba(255, 255, 255, 0.15);
    }

    /* ==========================================================================
       Stats Grid
       ========================================================================== */

    .ux-stats-grid {
      display: grid;
      gap: var(--ux-space-md);
    }

    /* Auto-fit columns */
    .ux-stats-grid--auto {
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    /* Fixed columns */
    .ux-stats-grid--2 { grid-template-columns: repeat(2, 1fr); }
    .ux-stats-grid--3 { grid-template-columns: repeat(3, 1fr); }
    .ux-stats-grid--4 { grid-template-columns: repeat(4, 1fr); }

    /* Responsive grid */
    @media (max-width: 991px) {
      .ux-stats-grid--4 { grid-template-columns: repeat(2, 1fr); }
      .ux-stats-grid--3 { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 767px) {
      .ux-stats-grid--4,
      .ux-stats-grid--3,
      .ux-stats-grid--2 {
        grid-template-columns: 1fr;
      }
    }

    /* ==========================================================================
       Stats Row (Horizontal scrolling)
       ========================================================================== */

    .ux-stats-row {
      display: flex;
      gap: var(--ux-space-md);
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding-bottom: var(--ux-space-sm);
    }

    .ux-stats-row::-webkit-scrollbar {
      display: none;
    }

    .ux-stats-row .ux-stats-card {
      flex-shrink: 0;
      min-width: 200px;
      scroll-snap-align: start;
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light) .ux-stats-card--glass .ux-stats-card__icon {
        background: rgba(255, 255, 255, 0.1);
      }
    }

    .ux-dark .ux-stats-card--glass .ux-stats-card__icon {
      background: rgba(255, 255, 255, 0.1);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-stats-card {
        transition: none;
      }

      .ux-stats-card:hover {
        transform: none;
      }

      .ux-stats-card__progress-fill {
        transition: none;
      }
    }

    /* ==========================================================================
       Animation - Counter
       ========================================================================== */

    .ux-stats-card__value--animated {
      animation: ux-stats-count-up 0.8s var(--ux-ease-ios) forwards;
    }

    @keyframes ux-stats-count-up {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-stats-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-stats-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for animated counter
  const statsCardComponent = (config = {}) => ({
    value: config.value || 0,
    targetValue: config.targetValue || config.value || 0,
    displayValue: 0,
    animated: config.animated !== false,
    duration: config.duration || 1000,
    decimals: config.decimals || 0,
    prefix: config.prefix || '',
    suffix: config.suffix || '',

    init() {
      if (this.animated) {
        // Use Intersection Observer to animate when visible
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              this.animateValue();
              observer.disconnect();
            }
          });
        }, { threshold: 0.3 });

        observer.observe(this.$el);
      } else {
        this.displayValue = this.targetValue;
      }
    },

    animateValue() {
      const startTime = performance.now();
      const startValue = 0;
      const endValue = this.targetValue;

      const animate = (currentTime) => {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / this.duration, 1);

        // Easing function (ease-out)
        const easeOut = 1 - Math.pow(1 - progress, 3);

        this.displayValue = startValue + (endValue - startValue) * easeOut;

        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          this.displayValue = endValue;
        }
      };

      requestAnimationFrame(animate);
    },

    get formattedValue() {
      const num = this.displayValue.toFixed(this.decimals);
      // Add thousands separator
      const parts = num.split('.');
      parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      return this.prefix + parts.join('.') + this.suffix;
    },

    // Update value externally
    updateValue(newValue) {
      this.targetValue = newValue;
      if (this.animated) {
        this.animateValue();
      } else {
        this.displayValue = newValue;
      }
    }
  });

  // Simple sparkline generator
  const generateSparklinePath = (data, width = 100, height = 40) => {
    if (!data || data.length < 2) return '';

    const min = Math.min(...data);
    const max = Math.max(...data);
    const range = max - min || 1;

    const points = data.map((value, index) => {
      const x = (index / (data.length - 1)) * width;
      const y = height - ((value - min) / range) * height;
      return `${x},${y}`;
    });

    return `M${points.join(' L')}`;
  };

  // Generate sparkline with fill
  const generateSparklineFill = (data, width = 100, height = 40) => {
    const linePath = generateSparklinePath(data, width, height);
    if (!linePath) return '';

    return `${linePath} L${width},${height} L0,${height} Z`;
  };

  // Register component and utilities
  if (window.UX) {
    window.UX.registerComponent('uxStatsCard', statsCardComponent);
    window.UX.generateSparklinePath = generateSparklinePath;
    window.UX.generateSparklineFill = generateSparklineFill;
  }

  window.UXSparkline = {
    path: generateSparklinePath,
    fill: generateSparklineFill
  };

})();

/**
 * UX Status Indicator Component
 * Indicador de estado con dot + label
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Status Indicator
    ======================================== */

    .ux-status-indicator {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
    }

    /* ========================================
       Status Dot
    ======================================== */

    .ux-status-indicator__dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: var(--ux-status-color, var(--ux-gray-400));
      flex-shrink: 0;
    }

    /* ========================================
       Status Colors
    ======================================== */

    .ux-status-indicator--success {
      --ux-status-color: var(--ux-success);
    }

    .ux-status-indicator--warning {
      --ux-status-color: var(--ux-warning);
    }

    .ux-status-indicator--danger,
    .ux-status-indicator--error {
      --ux-status-color: var(--ux-danger);
    }

    .ux-status-indicator--info {
      --ux-status-color: var(--ux-primary);
    }

    .ux-status-indicator--neutral {
      --ux-status-color: var(--ux-gray-400);
    }

    .ux-status-indicator--offline {
      --ux-status-color: var(--ux-gray-400);
    }

    .ux-status-indicator--online {
      --ux-status-color: var(--ux-success);
    }

    .ux-status-indicator--busy {
      --ux-status-color: var(--ux-danger);
    }

    .ux-status-indicator--away {
      --ux-status-color: var(--ux-warning);
    }

    .ux-status-indicator--pending {
      --ux-status-color: var(--ux-warning);
    }

    .ux-status-indicator--active {
      --ux-status-color: var(--ux-success);
    }

    .ux-status-indicator--inactive {
      --ux-status-color: var(--ux-gray-400);
    }

    /* ========================================
       Pulse Animation
    ======================================== */

    .ux-status-indicator--pulse .ux-status-indicator__dot {
      position: relative;
    }

    .ux-status-indicator--pulse .ux-status-indicator__dot::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: inherit;
      animation: ux-status-pulse 2s ease-in-out infinite;
    }

    @keyframes ux-status-pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(2);
        opacity: 0;
      }
      100% {
        transform: scale(1);
        opacity: 0;
      }
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-status-indicator--sm {
      font-size: var(--ux-font-size-xs);
    }

    .ux-status-indicator--sm .ux-status-indicator__dot {
      width: 6px;
      height: 6px;
    }

    .ux-status-indicator--lg {
      font-size: var(--ux-font-size-md);
    }

    .ux-status-indicator--lg .ux-status-indicator__dot {
      width: 10px;
      height: 10px;
    }

    /* ========================================
       Dot Only (no label)
    ======================================== */

    .ux-status-indicator--dot-only .ux-status-indicator__label {
      display: none;
    }

    /* ========================================
       Variants
    ======================================== */

    /* Filled background style */
    .ux-status-indicator--filled {
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background-color: rgba(var(--ux-status-color-rgb, 107, 114, 128), 0.1);
      border-radius: var(--ux-border-radius-full);
    }

    .ux-status-indicator--filled.ux-status-indicator--success {
      background-color: rgba(var(--ux-success-rgb), 0.1);
      color: var(--ux-success);
    }

    .ux-status-indicator--filled.ux-status-indicator--warning {
      background-color: rgba(var(--ux-warning-rgb), 0.1);
      color: var(--ux-warning-shade);
    }

    .ux-status-indicator--filled.ux-status-indicator--danger,
    .ux-status-indicator--filled.ux-status-indicator--error {
      background-color: rgba(var(--ux-danger-rgb), 0.1);
      color: var(--ux-danger);
    }

    .ux-status-indicator--filled.ux-status-indicator--info {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
      color: var(--ux-primary);
    }

    /* Outline style */
    .ux-status-indicator--outline {
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border: 1px solid var(--ux-status-color, var(--ux-border-color));
      border-radius: var(--ux-border-radius-full);
    }

    .ux-status-indicator--outline.ux-status-indicator--success {
      border-color: var(--ux-success);
      color: var(--ux-success);
    }

    .ux-status-indicator--outline.ux-status-indicator--warning {
      border-color: var(--ux-warning);
      color: var(--ux-warning-shade);
    }

    .ux-status-indicator--outline.ux-status-indicator--danger,
    .ux-status-indicator--outline.ux-status-indicator--error {
      border-color: var(--ux-danger);
      color: var(--ux-danger);
    }

    .ux-status-indicator--outline.ux-status-indicator--info {
      border-color: var(--ux-primary);
      color: var(--ux-primary);
    }

    /* ========================================
       With Ring (for avatars)
    ======================================== */

    .ux-status-indicator--ring .ux-status-indicator__dot {
      box-shadow: 0 0 0 2px var(--ux-surface);
    }

    /* ========================================
       Responsive Text
    ======================================== */

    @media (max-width: 767px) {
      .ux-status-indicator--hide-label-mobile .ux-status-indicator__label {
        display: none;
      }
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-status-indicator--ring .ux-status-indicator__dot {
        box-shadow: 0 0 0 2px var(--ux-surface);
      }

      .ux-status-indicator--filled.ux-status-indicator--warning {
        color: var(--ux-warning);
      }

      .ux-status-indicator--outline.ux-status-indicator--warning {
        color: var(--ux-warning);
      }
    }

    .ux-dark .ux-status-indicator--ring .ux-status-indicator__dot {
      box-shadow: 0 0 0 2px var(--ux-surface);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-status-indicator--pulse .ux-status-indicator__dot::before {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-status-indicator-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-status-indicator-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

})();

/**
 * UX Stepper Component
 * Stepper/Wizard para formularios multi-paso
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Stepper
    ======================================== */

    .ux-stepper {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    /* ========================================
       Stepper Header (Steps Indicator)
    ======================================== */

    .ux-stepper__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: var(--ux-space-xl);
      position: relative;
    }

    /* Progress line behind steps */
    .ux-stepper__header::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 40px;
      right: 40px;
      height: 2px;
      background-color: var(--ux-border-color);
      z-index: 0;
    }

    /* ========================================
       Step Item
    ======================================== */

    .ux-stepper__step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
      flex: 1;
      cursor: pointer;
    }

    .ux-stepper__step--disabled {
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Step Circle */
    .ux-stepper__circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--ux-surface);
      border: 2px solid var(--ux-border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text-secondary);
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease-spring);
    }

    .ux-stepper__step:hover .ux-stepper__circle {
      border-color: var(--ux-primary);
      transform: scale(1.05);
    }

    /* Step Label */
    .ux-stepper__label {
      margin-top: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
      text-align: center;
      max-width: 100px;
      transition: color var(--ux-transition-fast) var(--ux-ease);
    }

    /* Step Description */
    .ux-stepper__description {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-align: center;
      max-width: 120px;
      margin-top: var(--ux-space-xs);
    }

    /* ========================================
       Step States
    ======================================== */

    /* Active Step */
    .ux-stepper__step--active .ux-stepper__circle {
      background-color: var(--ux-primary);
      border-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-stepper__step--active .ux-stepper__label {
      color: var(--ux-primary);
    }

    /* Completed Step */
    .ux-stepper__step--completed .ux-stepper__circle {
      background-color: var(--ux-success);
      border-color: var(--ux-success);
      color: white;
    }

    .ux-stepper__step--completed .ux-stepper__label {
      color: var(--ux-success);
    }

    /* Checkmark icon for completed */
    .ux-stepper__check {
      width: 20px;
      height: 20px;
    }

    /* Error Step */
    .ux-stepper__step--error .ux-stepper__circle {
      background-color: var(--ux-danger);
      border-color: var(--ux-danger);
      color: white;
    }

    .ux-stepper__step--error .ux-stepper__label {
      color: var(--ux-danger);
    }

    /* Disabled Step */
    .ux-stepper__step--disabled .ux-stepper__circle {
      opacity: 0.5;
    }

    .ux-stepper__step--disabled .ux-stepper__label {
      opacity: 0.5;
    }

    /* ========================================
       Progress Line (Completed Portion)
    ======================================== */

    .ux-stepper__progress {
      position: absolute;
      top: 20px;
      left: 40px;
      height: 2px;
      background-color: var(--ux-success);
      z-index: 0;
      transition: width var(--ux-transition-base) var(--ux-ease);
    }

    /* ========================================
       Stepper Content
    ======================================== */

    .ux-stepper__content {
      flex: 1;
      min-height: 200px;
    }

    .ux-stepper__panel {
      display: none;
      animation: uxStepperFadeIn var(--ux-transition-base) var(--ux-ease);
    }

    .ux-stepper__panel--active {
      display: block;
    }

    @keyframes uxStepperFadeIn {
      from {
        opacity: 0;
        transform: translateX(10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* ========================================
       Stepper Actions
    ======================================== */

    .ux-stepper__actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: var(--ux-space-xl);
      padding-top: var(--ux-space-lg);
      border-top: 1px solid var(--ux-border-color);
      gap: var(--ux-space-md);
    }

    .ux-stepper__actions-start {
      display: flex;
      gap: var(--ux-space-sm);
    }

    .ux-stepper__actions-end {
      display: flex;
      gap: var(--ux-space-sm);
    }

    /* ========================================
       Vertical Stepper
    ======================================== */

    .ux-stepper--vertical {
      flex-direction: row;
    }

    .ux-stepper--vertical .ux-stepper__header {
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 0;
      margin-right: var(--ux-space-xl);
      min-width: 200px;
    }

    .ux-stepper--vertical .ux-stepper__header::before {
      top: 40px;
      bottom: 40px;
      left: 19px;
      right: auto;
      width: 2px;
      height: auto;
    }

    .ux-stepper--vertical .ux-stepper__progress {
      top: 40px;
      left: 19px;
      width: 2px !important;
      height: 0;
    }

    .ux-stepper--vertical .ux-stepper__step {
      flex-direction: row;
      align-items: center;
      margin-bottom: var(--ux-space-xl);
    }

    .ux-stepper--vertical .ux-stepper__step:last-child {
      margin-bottom: 0;
    }

    .ux-stepper--vertical .ux-stepper__label {
      margin-top: 0;
      margin-left: var(--ux-space-md);
      text-align: left;
      max-width: none;
    }

    .ux-stepper--vertical .ux-stepper__description {
      text-align: left;
      margin-left: var(--ux-space-md);
      margin-top: var(--ux-space-xs);
      max-width: none;
    }

    .ux-stepper--vertical .ux-stepper__content {
      flex: 1;
      border-left: 1px solid var(--ux-border-color);
      padding-left: var(--ux-space-xl);
    }

    /* ========================================
       Compact Stepper
    ======================================== */

    .ux-stepper--compact .ux-stepper__circle {
      width: 32px;
      height: 32px;
      font-size: var(--ux-font-size-sm);
    }

    .ux-stepper--compact .ux-stepper__header::before {
      top: 16px;
    }

    .ux-stepper--compact .ux-stepper__progress {
      top: 16px;
    }

    .ux-stepper--compact .ux-stepper__label {
      font-size: var(--ux-font-size-xs);
    }

    .ux-stepper--compact .ux-stepper__check {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Dot Stepper (Minimal)
    ======================================== */

    .ux-stepper--dots .ux-stepper__circle {
      width: 12px;
      height: 12px;
      padding: 0;
    }

    .ux-stepper--dots .ux-stepper__circle span,
    .ux-stepper--dots .ux-stepper__check {
      display: none;
    }

    .ux-stepper--dots .ux-stepper__header::before {
      top: 6px;
    }

    .ux-stepper--dots .ux-stepper__progress {
      top: 6px;
    }

    /* ========================================
       Numbered Progress Bar
    ======================================== */

    .ux-stepper--progress-bar .ux-stepper__header {
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-stepper--progress-bar .ux-stepper__header::before {
      display: none;
    }

    .ux-stepper--progress-bar .ux-stepper__progress-track {
      width: 100%;
      height: 4px;
      background-color: var(--ux-border-color);
      border-radius: 2px;
      overflow: hidden;
    }

    .ux-stepper--progress-bar .ux-stepper__progress-fill {
      height: 100%;
      background-color: var(--ux-primary);
      border-radius: 2px;
      transition: width var(--ux-transition-base) var(--ux-ease);
    }

    .ux-stepper--progress-bar .ux-stepper__steps-row {
      display: flex;
      justify-content: space-between;
    }

    .ux-stepper--progress-bar .ux-stepper__step {
      flex: none;
    }

    .ux-stepper--progress-bar .ux-stepper__circle {
      display: none;
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-stepper.ux-color-success .ux-stepper__step--active .ux-stepper__circle {
      background-color: var(--ux-success);
      border-color: var(--ux-success);
    }

    .ux-stepper.ux-color-success .ux-stepper__step--active .ux-stepper__label {
      color: var(--ux-success);
    }

    .ux-stepper.ux-color-warning .ux-stepper__step--active .ux-stepper__circle {
      background-color: var(--ux-warning);
      border-color: var(--ux-warning);
    }

    .ux-stepper.ux-color-warning .ux-stepper__step--active .ux-stepper__label {
      color: var(--ux-warning);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-stepper__header {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: var(--ux-space-sm);
      }

      .ux-stepper__label {
        display: none;
      }

      .ux-stepper__step--active .ux-stepper__label {
        display: block;
      }

      .ux-stepper--vertical {
        flex-direction: column;
      }

      .ux-stepper--vertical .ux-stepper__header {
        flex-direction: row;
        margin-right: 0;
        margin-bottom: var(--ux-space-xl);
        min-width: auto;
      }

      .ux-stepper--vertical .ux-stepper__content {
        border-left: none;
        padding-left: 0;
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-stepper__circle,
      .ux-stepper__progress,
      .ux-stepper__panel {
        transition: none;
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-stepper-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-stepper-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for stepper
  const stepperComponent = (config = {}) => ({
    currentStep: config.initialStep || 0,
    totalSteps: config.totalSteps || 3,
    completedSteps: config.completedSteps || [],
    errorSteps: config.errorSteps || [],
    linear: config.linear !== false, // Default: can only go to next step
    allowSkip: config.allowSkip || false,

    init() {
      // Mark previous steps as completed if starting from a later step
      if (this.currentStep > 0 && this.completedSteps.length === 0) {
        for (let i = 0; i < this.currentStep; i++) {
          this.completedSteps.push(i);
        }
      }
    },

    // Navigation
    goTo(step) {
      if (step < 0 || step >= this.totalSteps) return false;

      if (this.linear && !this.allowSkip) {
        // In linear mode, can only go to completed steps or next step
        if (step > this.currentStep + 1) return false;
        if (step > this.currentStep && !this.completedSteps.includes(this.currentStep)) return false;
      }

      this.currentStep = step;
      return true;
    },

    next() {
      if (this.currentStep < this.totalSteps - 1) {
        // Mark current step as completed
        if (!this.completedSteps.includes(this.currentStep)) {
          this.completedSteps.push(this.currentStep);
        }
        // Remove from errors if was there
        this.errorSteps = this.errorSteps.filter(s => s !== this.currentStep);

        this.currentStep++;
        return true;
      }
      return false;
    },

    prev() {
      if (this.currentStep > 0) {
        this.currentStep--;
        return true;
      }
      return false;
    },

    // Step states
    isActive(step) {
      return this.currentStep === step;
    },

    isCompleted(step) {
      return this.completedSteps.includes(step);
    },

    isError(step) {
      return this.errorSteps.includes(step);
    },

    canGoTo(step) {
      if (!this.linear) return true;
      return step <= this.currentStep || this.completedSteps.includes(step - 1);
    },

    // Mark step states
    complete(step = null) {
      const targetStep = step !== null ? step : this.currentStep;
      if (!this.completedSteps.includes(targetStep)) {
        this.completedSteps.push(targetStep);
      }
      this.errorSteps = this.errorSteps.filter(s => s !== targetStep);
    },

    setError(step = null) {
      const targetStep = step !== null ? step : this.currentStep;
      if (!this.errorSteps.includes(targetStep)) {
        this.errorSteps.push(targetStep);
      }
      this.completedSteps = this.completedSteps.filter(s => s !== targetStep);
    },

    clearError(step = null) {
      const targetStep = step !== null ? step : this.currentStep;
      this.errorSteps = this.errorSteps.filter(s => s !== targetStep);
    },

    // Progress
    get progress() {
      return (this.completedSteps.length / this.totalSteps) * 100;
    },

    get progressWidth() {
      if (this.totalSteps <= 1) return '0%';
      const stepWidth = 100 / (this.totalSteps - 1);
      return `${Math.min(this.completedSteps.length * stepWidth, 100)}%`;
    },

    // Utility
    get isFirst() {
      return this.currentStep === 0;
    },

    get isLast() {
      return this.currentStep === this.totalSteps - 1;
    },

    get allCompleted() {
      return this.completedSteps.length === this.totalSteps;
    },

    reset() {
      this.currentStep = 0;
      this.completedSteps = [];
      this.errorSteps = [];
    },

    // Get step classes
    getStepClasses(step) {
      return {
        'ux-stepper__step--active': this.isActive(step),
        'ux-stepper__step--completed': this.isCompleted(step),
        'ux-stepper__step--error': this.isError(step),
        'ux-stepper__step--disabled': !this.canGoTo(step)
      };
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxStepper', stepperComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxStepper', stepperComponent);
    });
  }
})();

/**
 * UX Stock Indicator Component
 * Inventory/POS stock status display
 */
(function() {
  'use strict';

  const styles = `
    /* Stock Indicator Variables */
    :root {
      --ux-stock-indicator-height: 24px;
      --ux-stock-indicator-padding: 0 var(--ux-space-sm);
      --ux-stock-indicator-gap: var(--ux-space-xs);
      --ux-stock-indicator-font-size: 0.8125rem;
      --ux-stock-indicator-border-radius: var(--ux-radius-sm);

      /* Dot */
      --ux-stock-indicator-dot-size: 8px;

      /* State Colors */
      --ux-stock-in-stock: var(--ux-green-500);
      --ux-stock-in-stock-bg: var(--ux-green-50);
      --ux-stock-low-stock: var(--ux-yellow-500);
      --ux-stock-low-stock-bg: var(--ux-yellow-50);
      --ux-stock-out-of-stock: var(--ux-red-500);
      --ux-stock-out-of-stock-bg: var(--ux-red-50);
      --ux-stock-backorder: var(--ux-blue-500);
      --ux-stock-backorder-bg: var(--ux-blue-50);
    }

    /* Base Stock Indicator */
    .ux-stock-indicator {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-stock-indicator-gap);
      height: var(--ux-stock-indicator-height);
      padding: var(--ux-stock-indicator-padding);
      font-size: var(--ux-stock-indicator-font-size);
      font-weight: 500;
      line-height: 1;
      white-space: nowrap;
      border-radius: var(--ux-stock-indicator-border-radius);
      background: transparent;
      transition: opacity var(--ux-transition-fast) var(--ux-ease-default);
    }

    /* Dot Element */
    .ux-stock-indicator__dot {
      width: var(--ux-stock-indicator-dot-size);
      height: var(--ux-stock-indicator-dot-size);
      border-radius: 50%;
      flex-shrink: 0;
      background: currentColor;
    }

    /* Pulse animation for low stock */
    .ux-stock-indicator--low-stock .ux-stock-indicator__dot {
      animation: ux-stock-pulse 2s ease-in-out infinite;
    }

    @keyframes ux-stock-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Label Element */
    .ux-stock-indicator__label {
      color: var(--ux-text-secondary);
    }

    /* Count Element */
    .ux-stock-indicator__count {
      font-weight: 600;
      font-variant-numeric: tabular-nums;
      color: var(--ux-text);
    }

    /* =====================
       STATE MODIFIERS
       ===================== */

    /* In Stock */
    .ux-stock-indicator--in-stock {
      color: var(--ux-stock-in-stock);
    }
    .ux-stock-indicator--in-stock .ux-stock-indicator__label {
      color: var(--ux-stock-in-stock);
    }

    /* Low Stock */
    .ux-stock-indicator--low-stock {
      color: var(--ux-stock-low-stock);
    }
    .ux-stock-indicator--low-stock .ux-stock-indicator__label {
      color: var(--ux-stock-low-stock);
    }

    /* Out of Stock */
    .ux-stock-indicator--out-of-stock {
      color: var(--ux-stock-out-of-stock);
    }
    .ux-stock-indicator--out-of-stock .ux-stock-indicator__label {
      color: var(--ux-stock-out-of-stock);
    }

    /* Backorder */
    .ux-stock-indicator--backorder {
      color: var(--ux-stock-backorder);
    }
    .ux-stock-indicator--backorder .ux-stock-indicator__label {
      color: var(--ux-stock-backorder);
    }

    /* =====================
       VARIANT MODIFIERS
       ===================== */

    /* Compact - Dot only */
    .ux-stock-indicator--compact {
      padding: 0;
      height: auto;
      gap: 0;
    }
    .ux-stock-indicator--compact .ux-stock-indicator__label,
    .ux-stock-indicator--compact .ux-stock-indicator__count {
      display: none;
    }

    /* Badge - Pill shape with background */
    .ux-stock-indicator--badge {
      border-radius: 9999px;
      padding: 0 var(--ux-space-sm);
    }

    .ux-stock-indicator--badge.ux-stock-indicator--in-stock {
      background: var(--ux-stock-in-stock-bg);
    }
    .ux-stock-indicator--badge.ux-stock-indicator--low-stock {
      background: var(--ux-stock-low-stock-bg);
    }
    .ux-stock-indicator--badge.ux-stock-indicator--out-of-stock {
      background: var(--ux-stock-out-of-stock-bg);
    }
    .ux-stock-indicator--badge.ux-stock-indicator--backorder {
      background: var(--ux-stock-backorder-bg);
    }

    /* =====================
       DARK MODE
       ===================== */
    @media (prefers-color-scheme: dark) {
      :root {
        --ux-stock-in-stock-bg: rgba(34, 197, 94, 0.15);
        --ux-stock-low-stock-bg: rgba(234, 179, 8, 0.15);
        --ux-stock-out-of-stock-bg: rgba(239, 68, 68, 0.15);
        --ux-stock-backorder-bg: rgba(59, 130, 246, 0.15);
      }
    }

    .ux-dark {
      --ux-stock-in-stock-bg: rgba(34, 197, 94, 0.15);
      --ux-stock-low-stock-bg: rgba(234, 179, 8, 0.15);
      --ux-stock-out-of-stock-bg: rgba(239, 68, 68, 0.15);
      --ux-stock-backorder-bg: rgba(59, 130, 246, 0.15);
    }

    /* =====================
       REDUCED MOTION
       ===================== */
    @media (prefers-reduced-motion: reduce) {
      .ux-stock-indicator--low-stock .ux-stock-indicator__dot {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-stock-indicator-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-stock-indicator-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const componentData = (options = {}) => ({
    // State
    quantity: options.quantity ?? 0,
    lowThreshold: options.lowThreshold ?? 10,
    backorder: options.backorder ?? false,

    // Computed: determine stock status
    get stockStatus() {
      if (this.backorder) return 'backorder';
      if (this.quantity <= 0) return 'out-of-stock';
      if (this.quantity <= this.lowThreshold) return 'low-stock';
      return 'in-stock';
    },

    // Get status label text
    get statusLabel() {
      switch (this.stockStatus) {
        case 'in-stock': return 'In Stock';
        case 'low-stock': return 'Low Stock';
        case 'out-of-stock': return 'Out of Stock';
        case 'backorder': return 'Backorder';
        default: return '';
      }
    },

    // Get CSS modifier class
    get statusClass() {
      return `ux-stock-indicator--${this.stockStatus}`;
    },

    // Update quantity
    setQuantity(qty) {
      this.quantity = Math.max(0, parseInt(qty, 10) || 0);
      this.$dispatch('stock:change', {
        quantity: this.quantity,
        status: this.stockStatus
      });
    },

    // Update threshold
    setThreshold(threshold) {
      this.lowThreshold = Math.max(1, parseInt(threshold, 10) || 10);
    },

    // Toggle backorder status
    toggleBackorder() {
      this.backorder = !this.backorder;
      this.$dispatch('stock:change', {
        quantity: this.quantity,
        status: this.stockStatus,
        backorder: this.backorder
      });
    },

    // Init
    init() {
      // Watch for external quantity changes via x-model or :quantity
      if (this.$el.hasAttribute('x-model')) {
        this.$watch('quantity', () => {
          this.$dispatch('stock:change', {
            quantity: this.quantity,
            status: this.stockStatus
          });
        });
      }
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxStockIndicator', componentData);
  }
})();

/**
 * UX Swipe Directives
 * Directivas Alpine para gestos tÃ¡ctiles
 * @requires Alpine.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       Swipe Action Container
    ======================================== */

    .ux-swipe-container {
      position: relative;
      overflow: hidden;
      touch-action: pan-y;
    }

    .ux-swipe-content {
      position: relative;
      transition: transform var(--ux-transition-base) var(--ux-ease);
      will-change: transform;
      background-color: var(--ux-surface);
    }

    .ux-swipe-content--swiping {
      transition: none;
    }

    /* ========================================
       Swipe Actions
    ======================================== */

    .ux-swipe-actions {
      position: absolute;
      top: 0;
      bottom: 0;
      display: flex;
      align-items: stretch;
    }

    .ux-swipe-actions--start {
      left: 0;
      transform: translateX(-100%);
    }

    .ux-swipe-actions--end {
      right: 0;
      transform: translateX(100%);
    }

    .ux-swipe-action {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 80px;
      padding: 0 var(--ux-space-lg);
      color: white;
      font-weight: 500;
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-swipe-action--delete {
      background-color: var(--ux-danger);
    }

    .ux-swipe-action--archive {
      background-color: var(--ux-warning);
    }

    .ux-swipe-action--pin {
      background-color: var(--ux-primary);
    }

    .ux-swipe-action--more {
      background-color: var(--ux-medium);
    }

    .ux-swipe-action__icon {
      width: 24px;
      height: 24px;
    }

    .ux-swipe-action__icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Drag Handle
    ======================================== */

    .ux-drag-handle {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-md);
      color: var(--ux-text-tertiary);
      cursor: grab;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-drag-handle:active {
      cursor: grabbing;
    }

    .ux-drag-handle__icon {
      width: 20px;
      height: 20px;
    }

    /* ========================================
       Draggable Item
    ======================================== */

    .ux-draggable {
      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
    }

    .ux-draggable--dragging {
      z-index: 100;
      opacity: 0.8;
      box-shadow: var(--ux-shadow-xl);
    }

    .ux-draggable--over {
      background-color: var(--ux-primary-tint);
    }

    /* ========================================
       Drop Zone
    ======================================== */

    .ux-drop-zone {
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        border-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-drop-zone--active {
      background-color: var(--ux-primary-tint);
      border-color: var(--ux-primary);
    }

    /* ========================================
       Pull to Refresh Indicator
    ======================================== */

    .ux-pull-indicator {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 60px;
      transform: translateY(-100%);
      pointer-events: none;
      z-index: 10;
    }

    .ux-pull-indicator__spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--ux-light);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
    }

    .ux-pull-indicator--refreshing .ux-pull-indicator__spinner {
      animation: ux-spin 0.8s linear infinite;
    }

    @keyframes ux-spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* ========================================
       Long Press Indicator
    ======================================== */

    .ux-long-press-indicator {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(var(--ux-primary-rgb), 0.2);
      transform: scale(0);
      pointer-events: none;
    }

    .ux-long-press-indicator--active {
      animation: ux-long-press-pulse 0.5s ease-out;
    }

    @keyframes ux-long-press-pulse {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(2);
        opacity: 0;
      }
    }

    /* ========================================
       Gesture Feedback
    ======================================== */

    .ux-gesture-feedback {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: var(--ux-space-lg) var(--ux-space-xl);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      border-radius: var(--ux-border-radius-lg);
      font-size: var(--ux-font-size-lg);
      font-weight: 500;
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
      z-index: 10000;
    }

    .ux-gesture-feedback--visible {
      opacity: 1;
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-swipe-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-swipe-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Helper functions
  const getPointerPosition = (event) => {
    if (event.touches && event.touches.length > 0) {
      return { x: event.touches[0].clientX, y: event.touches[0].clientY };
    }
    return { x: event.clientX, y: event.clientY };
  };

  const getDistance = (start, end) => {
    const dx = end.x - start.x;
    const dy = end.y - start.y;
    return Math.sqrt(dx * dx + dy * dy);
  };

  const getAngle = (start, end) => {
    return Math.atan2(end.y - start.y, end.x - start.x) * 180 / Math.PI;
  };

  const getDirection = (angle) => {
    if (angle >= -45 && angle < 45) return 'right';
    if (angle >= 45 && angle < 135) return 'down';
    if (angle >= -135 && angle < -45) return 'up';
    return 'left';
  };

  // Register Alpine directives when Alpine is available
  const registerDirectives = () => {
    if (typeof Alpine === 'undefined') {
      document.addEventListener('alpine:init', registerDirectives);
      return;
    }

    // ========================================
    // x-swipe directive
    // Usage: x-swipe.left="handler" x-swipe.right="handler"
    // ========================================
    Alpine.directive('swipe', (el, { modifiers, expression }, { evaluate, cleanup }) => {
      const threshold = 50;
      const velocityThreshold = 0.3;
      let startPos = null;
      let startTime = null;
      let isSwiping = false;

      const handleStart = (event) => {
        startPos = getPointerPosition(event);
        startTime = Date.now();
        isSwiping = true;
      };

      const handleMove = (event) => {
        if (!isSwiping || !startPos) return;

        const currentPos = getPointerPosition(event);
        const dx = Math.abs(currentPos.x - startPos.x);
        const dy = Math.abs(currentPos.y - startPos.y);

        // If horizontal movement is greater, prevent vertical scrolling
        if (dx > dy && dx > 10) {
          event.preventDefault();
        }
      };

      const handleEnd = (event) => {
        if (!isSwiping || !startPos) return;

        const endPos = getPointerPosition(event.changedTouches ? event.changedTouches[0] : event);
        const distance = getDistance(startPos, endPos);
        const angle = getAngle(startPos, endPos);
        const direction = getDirection(angle);
        const duration = Date.now() - startTime;
        const velocity = distance / duration;

        if (distance >= threshold || velocity >= velocityThreshold) {
          const directionModifiers = ['left', 'right', 'up', 'down'];
          const targetDirection = modifiers.find(m => directionModifiers.includes(m));

          if (!targetDirection || targetDirection === direction) {
            const handler = evaluate(expression);
            if (typeof handler === 'function') {
              handler({
                direction,
                distance,
                velocity,
                angle,
                startPos,
                endPos
              });
            }
          }
        }

        startPos = null;
        startTime = null;
        isSwiping = false;
      };

      el.addEventListener('touchstart', handleStart, { passive: true });
      el.addEventListener('touchmove', handleMove, { passive: false });
      el.addEventListener('touchend', handleEnd, { passive: true });
      el.addEventListener('mousedown', handleStart);
      el.addEventListener('mousemove', handleMove);
      el.addEventListener('mouseup', handleEnd);

      cleanup(() => {
        el.removeEventListener('touchstart', handleStart);
        el.removeEventListener('touchmove', handleMove);
        el.removeEventListener('touchend', handleEnd);
        el.removeEventListener('mousedown', handleStart);
        el.removeEventListener('mousemove', handleMove);
        el.removeEventListener('mouseup', handleEnd);
      });
    });

    // ========================================
    // x-drag directive
    // Usage: x-drag="handleDrag" x-drag.handle=".handle-selector"
    // ========================================
    Alpine.directive('drag', (el, { modifiers, expression }, { evaluate, cleanup }) => {
      let isDragging = false;
      let startPos = null;
      let currentPos = null;
      let offset = { x: 0, y: 0 };
      let dragElement = el;

      // Check for handle modifier
      const handleSelector = modifiers.find(m => m.startsWith('handle:'))?.slice(7);
      const handle = handleSelector ? el.querySelector(handleSelector) : el;

      if (!handle) return;

      const handleStart = (event) => {
        // Check if started on handle
        if (handleSelector && !event.target.closest(handleSelector)) return;

        event.preventDefault();
        isDragging = true;
        startPos = getPointerPosition(event);
        currentPos = { ...startPos };

        const rect = dragElement.getBoundingClientRect();
        offset = {
          x: startPos.x - rect.left,
          y: startPos.y - rect.top
        };

        dragElement.classList.add('ux-draggable--dragging');

        const handler = evaluate(expression);
        if (typeof handler === 'function') {
          handler({ type: 'start', startPos, offset, element: dragElement });
        }
      };

      const handleMove = (event) => {
        if (!isDragging) return;

        event.preventDefault();
        currentPos = getPointerPosition(event);

        const dx = currentPos.x - startPos.x;
        const dy = currentPos.y - startPos.y;

        const handler = evaluate(expression);
        if (typeof handler === 'function') {
          handler({
            type: 'move',
            startPos,
            currentPos,
            delta: { x: dx, y: dy },
            offset,
            element: dragElement
          });
        }
      };

      const handleEnd = (event) => {
        if (!isDragging) return;

        isDragging = false;
        dragElement.classList.remove('ux-draggable--dragging');

        const endPos = getPointerPosition(event.changedTouches ? event.changedTouches[0] : event);

        const handler = evaluate(expression);
        if (typeof handler === 'function') {
          handler({
            type: 'end',
            startPos,
            endPos,
            delta: { x: endPos.x - startPos.x, y: endPos.y - startPos.y },
            element: dragElement
          });
        }

        startPos = null;
        currentPos = null;
      };

      handle.addEventListener('touchstart', handleStart, { passive: false });
      document.addEventListener('touchmove', handleMove, { passive: false });
      document.addEventListener('touchend', handleEnd, { passive: true });
      handle.addEventListener('mousedown', handleStart);
      document.addEventListener('mousemove', handleMove);
      document.addEventListener('mouseup', handleEnd);

      cleanup(() => {
        handle.removeEventListener('touchstart', handleStart);
        document.removeEventListener('touchmove', handleMove);
        document.removeEventListener('touchend', handleEnd);
        handle.removeEventListener('mousedown', handleStart);
        document.removeEventListener('mousemove', handleMove);
        document.removeEventListener('mouseup', handleEnd);
      });
    });

    // ========================================
    // x-pull-refresh directive
    // Usage: x-pull-refresh="handleRefresh"
    // ========================================
    Alpine.directive('pull-refresh', (el, { expression }, { evaluate, cleanup }) => {
      const threshold = 80;
      const maxPull = 120;
      const resistance = 0.5;

      let startY = 0;
      let pullDistance = 0;
      let isPulling = false;
      let isRefreshing = false;

      // Create indicator element
      const indicator = document.createElement('div');
      indicator.className = 'ux-pull-indicator';
      indicator.innerHTML = '<div class="ux-pull-indicator__spinner"></div>';
      el.style.position = 'relative';
      el.insertBefore(indicator, el.firstChild);

      // Content wrapper
      let content = el.querySelector('.ux-pull-content');
      if (!content) {
        content = document.createElement('div');
        content.className = 'ux-pull-content';
        while (el.children.length > 1) {
          content.appendChild(el.children[1]);
        }
        el.appendChild(content);
      }

      const handleStart = (event) => {
        if (isRefreshing) return;
        if (el.scrollTop > 0) return;

        startY = event.touches[0].clientY;
        isPulling = true;
      };

      const handleMove = (event) => {
        if (!isPulling || isRefreshing) return;

        const currentY = event.touches[0].clientY;
        const diff = currentY - startY;

        if (diff > 0 && el.scrollTop <= 0) {
          event.preventDefault();
          pullDistance = Math.min(maxPull, diff * resistance);

          content.style.transform = `translateY(${pullDistance}px)`;
          indicator.style.transform = `translateY(${pullDistance - 60}px)`;

          // Update spinner based on progress
          const progress = Math.min(1, pullDistance / threshold);
          indicator.querySelector('.ux-pull-indicator__spinner').style.transform = `rotate(${progress * 360}deg)`;
        }
      };

      const handleEnd = async () => {
        if (!isPulling) return;

        isPulling = false;

        if (pullDistance >= threshold) {
          isRefreshing = true;
          indicator.classList.add('ux-pull-indicator--refreshing');

          content.style.transition = 'transform 0.3s ease';
          content.style.transform = 'translateY(60px)';
          indicator.style.transition = 'transform 0.3s ease';
          indicator.style.transform = 'translateY(0)';

          try {
            const handler = evaluate(expression);
            if (typeof handler === 'function') {
              await handler();
            }
          } finally {
            // Reset
            isRefreshing = false;
            indicator.classList.remove('ux-pull-indicator--refreshing');
            content.style.transform = 'translateY(0)';
            indicator.style.transform = 'translateY(-100%)';

            setTimeout(() => {
              content.style.transition = '';
              indicator.style.transition = '';
            }, 300);
          }
        } else {
          content.style.transition = 'transform 0.3s ease';
          content.style.transform = 'translateY(0)';
          indicator.style.transition = 'transform 0.3s ease';
          indicator.style.transform = 'translateY(-100%)';

          setTimeout(() => {
            content.style.transition = '';
            indicator.style.transition = '';
          }, 300);
        }

        pullDistance = 0;
        startY = 0;
      };

      el.addEventListener('touchstart', handleStart, { passive: true });
      el.addEventListener('touchmove', handleMove, { passive: false });
      el.addEventListener('touchend', handleEnd, { passive: true });

      cleanup(() => {
        el.removeEventListener('touchstart', handleStart);
        el.removeEventListener('touchmove', handleMove);
        el.removeEventListener('touchend', handleEnd);
        indicator.remove();
      });
    });

    // ========================================
    // x-long-press directive
    // Usage: x-long-press="handler" x-long-press.500ms="handler"
    // ========================================
    Alpine.directive('long-press', (el, { modifiers, expression }, { evaluate, cleanup }) => {
      const durationMatch = modifiers.find(m => m.match(/^\d+ms$/));
      const duration = durationMatch ? parseInt(durationMatch) : 500;

      let pressTimer = null;
      let startPos = null;
      const moveThreshold = 10;

      const handleStart = (event) => {
        startPos = getPointerPosition(event);

        pressTimer = setTimeout(() => {
          const handler = evaluate(expression);
          if (typeof handler === 'function') {
            handler({ position: startPos, element: el });
          }

          // Visual feedback
          el.classList.add('ux-long-pressed');
          setTimeout(() => el.classList.remove('ux-long-pressed'), 200);
        }, duration);
      };

      const handleMove = (event) => {
        if (!startPos) return;

        const currentPos = getPointerPosition(event);
        const distance = getDistance(startPos, currentPos);

        if (distance > moveThreshold) {
          clearTimeout(pressTimer);
          pressTimer = null;
        }
      };

      const handleEnd = () => {
        if (pressTimer) {
          clearTimeout(pressTimer);
          pressTimer = null;
        }
        startPos = null;
      };

      el.addEventListener('touchstart', handleStart, { passive: true });
      el.addEventListener('touchmove', handleMove, { passive: true });
      el.addEventListener('touchend', handleEnd, { passive: true });
      el.addEventListener('touchcancel', handleEnd, { passive: true });
      el.addEventListener('mousedown', handleStart);
      el.addEventListener('mousemove', handleMove);
      el.addEventListener('mouseup', handleEnd);
      el.addEventListener('mouseleave', handleEnd);

      cleanup(() => {
        el.removeEventListener('touchstart', handleStart);
        el.removeEventListener('touchmove', handleMove);
        el.removeEventListener('touchend', handleEnd);
        el.removeEventListener('touchcancel', handleEnd);
        el.removeEventListener('mousedown', handleStart);
        el.removeEventListener('mousemove', handleMove);
        el.removeEventListener('mouseup', handleEnd);
        el.removeEventListener('mouseleave', handleEnd);
        if (pressTimer) clearTimeout(pressTimer);
      });
    });

    // ========================================
    // x-pinch directive
    // Usage: x-pinch="handlePinch"
    // ========================================
    Alpine.directive('pinch', (el, { expression }, { evaluate, cleanup }) => {
      let initialDistance = null;
      let initialScale = 1;

      const getTouchDistance = (event) => {
        if (event.touches.length < 2) return null;
        const [t1, t2] = event.touches;
        return Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
      };

      const handleStart = (event) => {
        if (event.touches.length === 2) {
          event.preventDefault();
          initialDistance = getTouchDistance(event);
        }
      };

      const handleMove = (event) => {
        if (event.touches.length !== 2 || !initialDistance) return;

        event.preventDefault();
        const currentDistance = getTouchDistance(event);
        const scale = currentDistance / initialDistance;

        const handler = evaluate(expression);
        if (typeof handler === 'function') {
          handler({
            type: 'pinch',
            scale: initialScale * scale,
            delta: scale,
            center: {
              x: (event.touches[0].clientX + event.touches[1].clientX) / 2,
              y: (event.touches[0].clientY + event.touches[1].clientY) / 2
            }
          });
        }
      };

      const handleEnd = () => {
        initialDistance = null;
      };

      el.addEventListener('touchstart', handleStart, { passive: false });
      el.addEventListener('touchmove', handleMove, { passive: false });
      el.addEventListener('touchend', handleEnd, { passive: true });

      cleanup(() => {
        el.removeEventListener('touchstart', handleStart);
        el.removeEventListener('touchmove', handleMove);
        el.removeEventListener('touchend', handleEnd);
      });
    });

    // ========================================
    // x-tap directive (single/double tap)
    // Usage: x-tap="handler" x-tap.double="handler"
    // ========================================
    Alpine.directive('tap', (el, { modifiers, expression }, { evaluate, cleanup }) => {
      const isDouble = modifiers.includes('double');
      const tapThreshold = 10;
      const doubleTapDelay = 300;

      let startPos = null;
      let startTime = null;
      let lastTapTime = 0;

      const handleStart = (event) => {
        startPos = getPointerPosition(event);
        startTime = Date.now();
      };

      const handleEnd = (event) => {
        if (!startPos) return;

        const endPos = getPointerPosition(event.changedTouches ? event.changedTouches[0] : event);
        const distance = getDistance(startPos, endPos);
        const duration = Date.now() - startTime;

        // Check if it's a tap (short distance, short duration)
        if (distance <= tapThreshold && duration <= 300) {
          const now = Date.now();

          if (isDouble) {
            if (now - lastTapTime <= doubleTapDelay) {
              const handler = evaluate(expression);
              if (typeof handler === 'function') {
                handler({ position: endPos, element: el });
              }
              lastTapTime = 0;
            } else {
              lastTapTime = now;
            }
          } else {
            const handler = evaluate(expression);
            if (typeof handler === 'function') {
              handler({ position: endPos, element: el });
            }
          }
        }

        startPos = null;
        startTime = null;
      };

      el.addEventListener('touchstart', handleStart, { passive: true });
      el.addEventListener('touchend', handleEnd, { passive: true });
      el.addEventListener('mousedown', handleStart);
      el.addEventListener('mouseup', handleEnd);

      cleanup(() => {
        el.removeEventListener('touchstart', handleStart);
        el.removeEventListener('touchend', handleEnd);
        el.removeEventListener('mousedown', handleStart);
        el.removeEventListener('mouseup', handleEnd);
      });
    });
  };

  // Initialize
  registerDirectives();

  // Alpine component for swipeable item
  const swipeItemComponent = (config = {}) => ({
    offset: 0,
    isSwiping: false,
    openSide: null, // 'start' | 'end' | null
    startActionsWidth: config.startActionsWidth || 160,
    endActionsWidth: config.endActionsWidth || 80,
    threshold: config.threshold || 40,

    get contentStyle() {
      return { transform: `translateX(${this.offset}px)` };
    },

    handleSwipeStart() {
      this.isSwiping = true;
    },

    handleSwipeMove(delta) {
      if (!this.isSwiping) return;

      let newOffset = delta;

      // Apply resistance at boundaries
      if (newOffset > 0) {
        newOffset = Math.min(newOffset, this.startActionsWidth * 1.2);
      } else {
        newOffset = Math.max(newOffset, -this.endActionsWidth * 1.2);
      }

      this.offset = newOffset;
    },

    handleSwipeEnd() {
      this.isSwiping = false;

      // Snap to open or closed
      if (this.offset > this.threshold) {
        this.offset = this.startActionsWidth;
        this.openSide = 'start';
      } else if (this.offset < -this.threshold) {
        this.offset = -this.endActionsWidth;
        this.openSide = 'end';
      } else {
        this.close();
      }
    },

    openStart() {
      this.offset = this.startActionsWidth;
      this.openSide = 'start';
    },

    openEnd() {
      this.offset = -this.endActionsWidth;
      this.openSide = 'end';
    },

    close() {
      this.offset = 0;
      this.openSide = null;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxSwipeItem', swipeItemComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxSwipeItem', swipeItemComponent);
    });
  }
})();

/**
 * UX Tabs Component
 * Sistema de tabs estilo iOS/Ionic
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Tabs
    ======================================== */

    .ux-tabs {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    /* ========================================
       Tab Bar
    ======================================== */

    .ux-tab-bar {
      display: flex;
      align-items: stretch;
      background-color: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .ux-tab-bar::-webkit-scrollbar {
      display: none;
    }

    /* Tab Bar Variants */
    .ux-tab-bar--translucent {
      background-color: rgba(var(--ux-surface-rgb, 255, 255, 255), 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    /* Glass (iOS 26 Liquid Glass) */
    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-tab-bar--glass {
      box-shadow: var(--ux-glass-highlight);
      border-top: 0.5px solid var(--ux-glass-border);
    }

    .ux-tab-bar--primary {
      background-color: var(--ux-primary);
      border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    .ux-tab-bar--dark {
      background-color: var(--ux-dark);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    /* ========================================
       Tab Button
    ======================================== */

    .ux-tab-button {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
      min-width: var(--ux-tab-min-width);
      min-height: var(--ux-tabs-height);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: none;
      border: none;
      color: var(--ux-text-secondary);
      font-size: var(--ux-tab-font-size);
      font-weight: 500;
      white-space: nowrap;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        color var(--ux-transition-fast) var(--ux-ease),
        background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-tab-button:hover {
      color: var(--ux-text);
      background-color: var(--ux-surface-secondary);
    }

    .ux-tab-button:active {
      background-color: var(--ux-light);
    }

    .ux-tab-button--selected {
      color: var(--ux-primary);
    }

    .ux-tab-button--disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    /* Tab Button Layout */
    .ux-tab-button--layout-icon-top {
      flex-direction: column;
      gap: 2px;
    }

    .ux-tab-button--layout-icon-start {
      flex-direction: row;
      gap: var(--ux-space-xs);
    }

    .ux-tab-button--layout-icon-end {
      flex-direction: row-reverse;
      gap: var(--ux-space-xs);
    }

    .ux-tab-button--layout-icon-only .ux-tab-button__label {
      display: none;
    }

    .ux-tab-button--layout-label-only .ux-tab-button__icon {
      display: none;
    }

    /* Tab Button Icon */
    .ux-tab-button__icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .ux-tab-button__icon svg {
      width: 100%;
      height: 100%;
    }

    /* Tab Button Label */
    .ux-tab-button__label {
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Tab Button Badge */
    .ux-tab-button__badge {
      position: absolute;
      top: 4px;
      right: calc(50% - 20px);
      min-width: 18px;
      height: 18px;
      padding: 0 5px;
      background-color: var(--ux-danger);
      color: white;
      font-size: 10px;
      font-weight: 600;
      border-radius: 9px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ux-tab-button__badge--dot {
      min-width: 8px;
      width: 8px;
      height: 8px;
      padding: 0;
      right: calc(50% - 16px);
    }

    /* Colored Tab Bar Button Colors */
    .ux-tab-bar--primary .ux-tab-button {
      color: rgba(255, 255, 255, 0.7);
    }

    .ux-tab-bar--primary .ux-tab-button:hover {
      color: white;
      background-color: rgba(255, 255, 255, 0.1);
    }

    .ux-tab-bar--primary .ux-tab-button--selected {
      color: white;
    }

    .ux-tab-bar--dark .ux-tab-button {
      color: rgba(255, 255, 255, 0.6);
    }

    .ux-tab-bar--dark .ux-tab-button:hover {
      color: white;
      background-color: rgba(255, 255, 255, 0.1);
    }

    .ux-tab-bar--dark .ux-tab-button--selected {
      color: white;
    }

    /* ========================================
       Tab Indicator
    ======================================== */

    .ux-tab-bar--indicator {
      position: relative;
    }

    .ux-tab-bar__indicator {
      position: absolute;
      bottom: 0;
      height: var(--ux-tab-indicator-height, 3px);
      background-color: var(--ux-primary);
      border-radius: var(--ux-tab-indicator-radius, 1.5px) var(--ux-tab-indicator-radius, 1.5px) 0 0;
      transition:
        left var(--ux-transition-base) var(--ux-ease),
        width var(--ux-transition-base) var(--ux-ease);
    }

    .ux-tab-bar--primary .ux-tab-bar__indicator {
      background-color: white;
    }

    /* ========================================
       Tab Content
    ======================================== */

    .ux-tab-content {
      flex: 1;
      overflow: hidden;
    }

    .ux-tab-panel {
      display: none;
      height: 100%;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .ux-tab-panel--active {
      display: block;
    }

    /* Animated tab panels */
    .ux-tab-content--animated {
      position: relative;
    }

    .ux-tab-content--animated .ux-tab-panel {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0;
      transform: translateX(20px);
      transition:
        opacity var(--ux-transition-base) var(--ux-ease),
        transform var(--ux-transition-base) var(--ux-ease);
    }

    .ux-tab-content--animated .ux-tab-panel--active {
      position: relative;
      opacity: 1;
      transform: translateX(0);
    }

    /* ========================================
       Bottom Tab Bar (iOS style)
       Glass effect by default
    ======================================== */

    .ux-tab-bar--bottom {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      min-height: 49px;
      border-bottom: none;
      /* Glass by default */
      background-color: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-top: 0.5px solid var(--ux-glass-border);
      padding-bottom: env(safe-area-inset-bottom);
      z-index: 100;
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-tab-bar--bottom {
        background-color: var(--ux-surface);
      }
    }

    .ux-tab-bar--bottom .ux-tab-button {
      min-height: 49px;
      padding: var(--ux-space-xs) var(--ux-space-sm);
    }

    .ux-tab-bar--bottom .ux-tab-button__icon {
      width: 28px;
      height: 28px;
    }

    .ux-tab-bar--bottom .ux-tab-button__label {
      font-size: 10px;
    }

    /* ========================================
       Scrollable Tab Bar
    ======================================== */

    .ux-tab-bar--scrollable .ux-tab-button {
      flex: 0 0 auto;
      min-width: auto;
      padding: var(--ux-space-sm) var(--ux-space-lg);
    }

    /* ========================================
       Pill Style Tab Bar
    ======================================== */

    .ux-tab-bar--pills {
      gap: var(--ux-space-xs);
      padding: var(--ux-space-sm);
      background-color: var(--ux-surface-secondary);
      border-bottom: none;
      border-radius: var(--ux-border-radius-lg);
      margin: var(--ux-space-sm);
    }

    .ux-tab-bar--pills .ux-tab-button {
      border-radius: var(--ux-border-radius);
      min-height: 36px;
    }

    .ux-tab-bar--pills .ux-tab-button--selected {
      background-color: var(--ux-surface);
      box-shadow: var(--ux-shadow-sm);
      color: var(--ux-text);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-tab-bar--sm .ux-tab-button {
      min-height: 40px;
      padding: var(--ux-space-xs) var(--ux-space-md);
      font-size: var(--ux-font-size-xs);
    }

    .ux-tab-bar--sm .ux-tab-button__icon {
      width: 20px;
      height: 20px;
    }

    .ux-tab-bar--lg .ux-tab-button {
      min-height: 56px;
      padding: var(--ux-space-md) var(--ux-space-lg);
      font-size: var(--ux-font-size-md);
    }

    .ux-tab-bar--lg .ux-tab-button__icon {
      width: 28px;
      height: 28px;
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-tabs-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-tabs-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for tabs
  // ARIA: role="tablist" on bar, role="tab" on buttons, role="tabpanel" on panels
  const tabsComponent = (config = {}) => ({
    activeTab: config.activeTab || 0,
    tabs: config.tabs || [],
    animated: config.animated || false,
    indicatorStyle: {},
    tabsId: config.id || 'ux-tabs-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes for the tab bar (tablist)
    get tablistAriaAttrs() {
      return {
        'role': 'tablist',
        'aria-label': config.ariaLabel || 'Tabs'
      };
    },

    // ARIA attributes for each tab button
    getTabAriaAttrs(index) {
      return {
        'role': 'tab',
        'aria-selected': this.activeTab === index ? 'true' : 'false',
        'aria-controls': this.tabsId + '-panel-' + index,
        'id': this.tabsId + '-tab-' + index,
        'tabindex': this.activeTab === index ? '0' : '-1'
      };
    },

    // ARIA attributes for each tab panel
    getPanelAriaAttrs(index) {
      return {
        'role': 'tabpanel',
        'aria-labelledby': this.tabsId + '-tab-' + index,
        'id': this.tabsId + '-panel-' + index,
        'tabindex': '0'
      };
    },

    init() {
      this.$nextTick(() => {
        this.updateIndicator();
      });
    },

    select(index) {
      if (index === this.activeTab) return;
      if (this.tabs[index]?.disabled) return;

      this.activeTab = index;
      this.updateIndicator();
    },

    selectByValue(value) {
      const index = this.tabs.findIndex(tab => tab.value === value);
      if (index !== -1) {
        this.select(index);
      }
    },

    next() {
      const nextIndex = (this.activeTab + 1) % this.tabs.length;
      this.select(nextIndex);
    },

    prev() {
      const prevIndex = (this.activeTab - 1 + this.tabs.length) % this.tabs.length;
      this.select(prevIndex);
    },

    isActive(index) {
      return this.activeTab === index;
    },

    updateIndicator() {
      const tabBar = this.$refs.tabBar;
      if (!tabBar) return;

      const buttons = tabBar.querySelectorAll('.ux-tab-button');
      const activeButton = buttons[this.activeTab];

      if (activeButton) {
        this.indicatorStyle = {
          left: activeButton.offsetLeft + 'px',
          width: activeButton.offsetWidth + 'px'
        };
      }
    },

    get activeTabData() {
      return this.tabs[this.activeTab];
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxTabs', tabsComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxTabs', tabsComponent);
    });
  }
})();

/**
 * UX Tag Input Component
 * Multi-select input with chips/tags
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Tag Input Container
       ========================================================================== */

    :root {
      --ux-tag-input-min-height: 44px;
      --ux-tag-input-padding: var(--ux-space-xs);
      --ux-tag-input-gap: var(--ux-space-xs);
      --ux-tag-input-radius: var(--ux-radius-lg);
      --ux-tag-height: 28px;
      --ux-tag-font-size: 0.8125rem;
    }

    .ux-tag-input {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: var(--ux-tag-input-gap);
      min-height: var(--ux-tag-input-min-height);
      padding: var(--ux-tag-input-padding);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-tag-input-radius);
      cursor: text;
      transition: border-color var(--ux-transition-fast), box-shadow var(--ux-transition-fast);
    }

    .ux-tag-input:focus-within {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    .ux-tag-input--disabled {
      opacity: 0.6;
      cursor: not-allowed;
      background: var(--ux-surface-secondary);
    }

    .ux-tag-input--error {
      border-color: var(--ux-danger);
    }

    .ux-tag-input--error:focus-within {
      box-shadow: 0 0 0 3px rgba(var(--ux-danger-rgb), 0.15);
    }

    /* ==========================================================================
       Tags
       ========================================================================== */

    .ux-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      height: var(--ux-tag-height);
      padding: 0 8px;
      font-size: var(--ux-tag-font-size);
      font-weight: 500;
      background: var(--ux-primary-tint);
      color: var(--ux-primary);
      border-radius: var(--ux-radius-full);
      white-space: nowrap;
      user-select: none;
      animation: ux-tag-appear 0.2s var(--ux-ease-out);
    }

    @keyframes ux-tag-appear {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .ux-tag--removing {
      animation: ux-tag-remove 0.15s var(--ux-ease-in) forwards;
    }

    @keyframes ux-tag-remove {
      to {
        opacity: 0;
        transform: scale(0.8);
      }
    }

    .ux-tag__text {
      max-width: 150px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-tag__remove {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      margin-left: 2px;
      margin-right: -4px;
      background: transparent;
      border: none;
      border-radius: 50%;
      color: inherit;
      cursor: pointer;
      opacity: 0.7;
      transition: all var(--ux-transition-fast);
    }

    .ux-tag__remove:hover {
      opacity: 1;
      background: rgba(0, 0, 0, 0.1);
    }

    .ux-tag__remove svg {
      width: 12px;
      height: 12px;
    }

    /* Tag Colors */
    .ux-tag--secondary {
      background: var(--ux-surface-tertiary);
      color: var(--ux-text);
    }

    .ux-tag--success {
      background: var(--ux-success-tint);
      color: var(--ux-success-shade);
    }

    .ux-tag--warning {
      background: var(--ux-warning-tint);
      color: var(--ux-warning-shade);
    }

    .ux-tag--danger {
      background: var(--ux-danger-tint);
      color: var(--ux-danger-shade);
    }

    /* ==========================================================================
       Input Field
       ========================================================================== */

    .ux-tag-input__field {
      flex: 1;
      min-width: 80px;
      height: var(--ux-tag-height);
      padding: 0 var(--ux-space-xs);
      font-size: 0.9375rem;
      color: var(--ux-text);
      background: transparent;
      border: none;
      outline: none;
    }

    .ux-tag-input__field::placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-tag-input--disabled .ux-tag-input__field {
      cursor: not-allowed;
    }

    /* ==========================================================================
       Suggestions Dropdown
       ========================================================================== */

    .ux-tag-input-wrapper {
      position: relative;
      width: 100%;
    }

    .ux-tag-input__suggestions {
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      right: 0;
      z-index: var(--ux-z-dropdown);
      max-height: 200px;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      box-shadow: var(--ux-shadow-lg);
      overflow-y: auto;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all var(--ux-transition-fast) var(--ux-ease-out);
    }

    .ux-tag-input__suggestions--open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-tag-input__suggestion {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: 0.9375rem;
      color: var(--ux-text);
      cursor: pointer;
      transition: background var(--ux-transition-fast);
    }

    .ux-tag-input__suggestion:hover,
    .ux-tag-input__suggestion--active {
      background: var(--ux-surface-secondary);
    }

    .ux-tag-input__suggestion--disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .ux-tag-input__suggestion-create {
      color: var(--ux-primary);
      font-weight: 500;
    }

    .ux-tag-input__no-results {
      padding: var(--ux-space-md);
      text-align: center;
      color: var(--ux-text-tertiary);
      font-size: 0.875rem;
    }

    /* ==========================================================================
       Counter & Limit
       ========================================================================== */

    .ux-tag-input__counter {
      margin-left: auto;
      padding: 0 var(--ux-space-xs);
      font-size: 0.75rem;
      color: var(--ux-text-tertiary);
    }

    .ux-tag-input__counter--limit {
      color: var(--ux-danger);
    }

    /* ==========================================================================
       Size Variants
       ========================================================================== */

    .ux-tag-input--sm {
      min-height: 36px;
      --ux-tag-height: 24px;
      --ux-tag-font-size: 0.75rem;
    }

    .ux-tag-input--sm .ux-tag-input__field {
      font-size: 0.875rem;
    }

    .ux-tag-input--lg {
      min-height: 52px;
      --ux-tag-height: 32px;
      --ux-tag-font-size: 0.875rem;
    }

    .ux-tag-input--lg .ux-tag-input__field {
      font-size: 1rem;
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-tag-input--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    .ux-tag-input--glass .ux-tag {
      background: rgba(var(--ux-primary-rgb), 0.2);
    }

    .ux-tag-input-wrapper--glass .ux-tag-input__suggestions {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      .ux-tag__remove:hover {
        background: rgba(255, 255, 255, 0.15);
      }
    }

    .ux-dark .ux-tag__remove:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-tag {
        animation: none;
      }

      .ux-tag--removing {
        animation: none;
        opacity: 0;
      }

      .ux-tag-input__suggestions {
        transition: opacity var(--ux-transition-fast);
        transform: none;
      }
    }
  `;

  // Close icon
  const closeIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M18 6L6 18M6 6l12 12"/>
  </svg>`;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-tag-input-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-tag-input-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const tagInputData = (options = {}) => ({
    // Configuration
    placeholder: options.placeholder || 'Add tag...',
    suggestions: options.suggestions || [],
    maxTags: options.maxTags || Infinity,
    maxLength: options.maxLength || 50,
    allowCreate: options.allowCreate ?? true,
    allowDuplicates: options.allowDuplicates ?? false,
    delimiter: options.delimiter || ',',
    validateTag: options.validateTag || null,
    transformTag: options.transformTag || null,
    disabled: options.disabled ?? false,
    showCounter: options.showCounter ?? false,

    // State
    tags: options.value || [],
    inputValue: '',
    isOpen: false,
    activeIndex: -1,
    filteredSuggestions: [],
    closeIcon: closeIcon,

    // Lifecycle
    init() {
      this.$watch('inputValue', () => {
        this.filterSuggestions();
      });
    },

    // Computed
    get canAddMore() {
      return this.tags.length < this.maxTags;
    },

    get isAtLimit() {
      return this.tags.length >= this.maxTags;
    },

    // Filter suggestions based on input
    filterSuggestions() {
      if (!this.inputValue.trim()) {
        this.filteredSuggestions = [];
        this.isOpen = false;
        return;
      }

      const query = this.inputValue.toLowerCase().trim();

      this.filteredSuggestions = this.suggestions.filter(suggestion => {
        const text = typeof suggestion === 'string' ? suggestion : suggestion.label || suggestion.value;
        const isMatch = text.toLowerCase().includes(query);
        const isAlreadySelected = this.tags.some(tag =>
          (typeof tag === 'string' ? tag : tag.value) === (typeof suggestion === 'string' ? suggestion : suggestion.value)
        );
        return isMatch && (this.allowDuplicates || !isAlreadySelected);
      }).slice(0, 10);

      this.isOpen = this.filteredSuggestions.length > 0 || (this.allowCreate && this.inputValue.trim());
      this.activeIndex = -1;
    },

    // Get display text for tag/suggestion
    getLabel(item) {
      if (typeof item === 'string') return item;
      return item.label || item.value || item.name || '';
    },

    getValue(item) {
      if (typeof item === 'string') return item;
      return item.value || item.label || item.name || '';
    },

    // Add tag
    addTag(value) {
      if (this.disabled || !this.canAddMore) return false;

      let tag = typeof value === 'string' ? value.trim() : value;

      if (!tag || (typeof tag === 'string' && !tag.length)) return false;

      // Transform tag if function provided
      if (this.transformTag && typeof tag === 'string') {
        tag = this.transformTag(tag);
      }

      // Validate tag if function provided
      if (this.validateTag) {
        const validation = this.validateTag(tag, this.tags);
        if (validation !== true) {
          this.$dispatch('tag-input:invalid', { tag, reason: validation });
          return false;
        }
      }

      // Check for duplicates
      const tagValue = this.getValue(tag);
      if (!this.allowDuplicates && this.tags.some(t => this.getValue(t) === tagValue)) {
        this.$dispatch('tag-input:duplicate', { tag });
        return false;
      }

      // Check max length
      if (typeof tag === 'string' && tag.length > this.maxLength) {
        tag = tag.substring(0, this.maxLength);
      }

      this.tags.push(tag);
      this.inputValue = '';
      this.isOpen = false;
      this.activeIndex = -1;

      this.$dispatch('tag-input:add', { tag, tags: [...this.tags] });
      this.$dispatch('tag-input:change', { tags: [...this.tags] });

      return true;
    },

    // Remove tag by index
    removeTag(index) {
      if (this.disabled || index < 0 || index >= this.tags.length) return;

      const removed = this.tags.splice(index, 1)[0];

      this.$dispatch('tag-input:remove', { tag: removed, tags: [...this.tags] });
      this.$dispatch('tag-input:change', { tags: [...this.tags] });
    },

    // Remove last tag
    removeLastTag() {
      if (this.tags.length > 0) {
        this.removeTag(this.tags.length - 1);
      }
    },

    // Clear all tags
    clearAll() {
      if (this.disabled) return;

      this.tags = [];
      this.inputValue = '';
      this.$dispatch('tag-input:clear');
      this.$dispatch('tag-input:change', { tags: [] });
    },

    // Select suggestion
    selectSuggestion(suggestion) {
      this.addTag(suggestion);
      this.$refs.input?.focus();
    },

    // Handle input
    onInput(event) {
      // Check for delimiter
      if (this.delimiter && this.inputValue.includes(this.delimiter)) {
        const parts = this.inputValue.split(this.delimiter);
        parts.forEach((part, i) => {
          if (i < parts.length - 1 && part.trim()) {
            this.addTag(part.trim());
          }
        });
        this.inputValue = parts[parts.length - 1];
      }
    },

    // Handle keyboard navigation
    onKeydown(event) {
      switch (event.key) {
        case 'Enter':
          event.preventDefault();
          if (this.activeIndex >= 0 && this.filteredSuggestions[this.activeIndex]) {
            this.selectSuggestion(this.filteredSuggestions[this.activeIndex]);
          } else if (this.inputValue.trim() && this.allowCreate) {
            this.addTag(this.inputValue);
          }
          break;

        case 'Backspace':
          if (!this.inputValue && this.tags.length > 0) {
            this.removeLastTag();
          }
          break;

        case 'ArrowDown':
          event.preventDefault();
          if (!this.isOpen && this.inputValue) {
            this.filterSuggestions();
          } else {
            const maxIndex = this.allowCreate && this.inputValue.trim()
              ? this.filteredSuggestions.length
              : this.filteredSuggestions.length - 1;
            this.activeIndex = Math.min(this.activeIndex + 1, maxIndex);
          }
          break;

        case 'ArrowUp':
          event.preventDefault();
          this.activeIndex = Math.max(this.activeIndex - 1, -1);
          break;

        case 'Escape':
          this.isOpen = false;
          this.activeIndex = -1;
          break;

        case 'Tab':
          this.isOpen = false;
          break;
      }
    },

    onFocus() {
      if (this.inputValue) {
        this.filterSuggestions();
      }
      this.$dispatch('tag-input:focus');
    },

    onBlur() {
      // Delay to allow click on suggestions
      setTimeout(() => {
        this.isOpen = false;
        this.activeIndex = -1;
      }, 150);
      this.$dispatch('tag-input:blur');
    },

    // Focus the input
    focus() {
      this.$refs.input?.focus();
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxTagInput', tagInputData);
  }
})();

/**
 * UX Tag Component
 * Chips removibles (tags) para filtros y selecciones
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Tag
    ======================================== */

    .ux-tag {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      height: var(--ux-tag-height, 28px);
      padding: 0 var(--ux-space-sm);
      padding-right: var(--ux-space-xs);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      line-height: 1;
      white-space: nowrap;
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-full);
      cursor: default;
      user-select: none;
      -webkit-user-select: none;
      transition: var(--ux-transition-colors);
    }

    /* ========================================
       Tag Text/Label
    ======================================== */

    .ux-tag__text {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }

    /* ========================================
       Remove Button
    ======================================== */

    .ux-tag__remove {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      padding: 0;
      margin-left: 2px;
      background-color: transparent;
      border: none;
      border-radius: 50%;
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition: background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
      flex-shrink: 0;
    }

    .ux-tag__remove:hover {
      background-color: rgba(0, 0, 0, 0.1);
      color: var(--ux-text);
    }

    .ux-tag__remove:active {
      background-color: rgba(0, 0, 0, 0.15);
    }

    .ux-tag__remove-icon {
      width: 12px;
      height: 12px;
    }

    /* ========================================
       Color Variants
    ======================================== */

    .ux-tag--primary {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
      border-color: rgba(var(--ux-primary-rgb), 0.2);
      color: var(--ux-primary);
    }

    .ux-tag--primary .ux-tag__remove:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.2);
      color: var(--ux-primary);
    }

    .ux-tag--success {
      background-color: rgba(var(--ux-success-rgb), 0.1);
      border-color: rgba(var(--ux-success-rgb), 0.2);
      color: var(--ux-success);
    }

    .ux-tag--success .ux-tag__remove:hover {
      background-color: rgba(var(--ux-success-rgb), 0.2);
    }

    .ux-tag--warning {
      background-color: rgba(var(--ux-warning-rgb), 0.1);
      border-color: rgba(var(--ux-warning-rgb), 0.2);
      color: var(--ux-warning-shade);
    }

    .ux-tag--warning .ux-tag__remove:hover {
      background-color: rgba(var(--ux-warning-rgb), 0.2);
    }

    .ux-tag--danger {
      background-color: rgba(var(--ux-danger-rgb), 0.1);
      border-color: rgba(var(--ux-danger-rgb), 0.2);
      color: var(--ux-danger);
    }

    .ux-tag--danger .ux-tag__remove:hover {
      background-color: rgba(var(--ux-danger-rgb), 0.2);
    }

    .ux-tag--info {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
      border-color: rgba(var(--ux-primary-rgb), 0.2);
      color: var(--ux-primary);
    }

    /* ========================================
       Filled Variant
    ======================================== */

    .ux-tag--filled {
      background-color: var(--ux-gray-200);
      border-color: transparent;
      color: var(--ux-gray-700);
    }

    .ux-tag--filled .ux-tag__remove:hover {
      background-color: rgba(0, 0, 0, 0.15);
    }

    .ux-tag--filled.ux-tag--primary {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-tag--filled.ux-tag--primary .ux-tag__remove {
      color: rgba(255, 255, 255, 0.7);
    }

    .ux-tag--filled.ux-tag--primary .ux-tag__remove:hover {
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .ux-tag--filled.ux-tag--success {
      background-color: var(--ux-success);
      color: white;
    }

    .ux-tag--filled.ux-tag--success .ux-tag__remove {
      color: rgba(255, 255, 255, 0.7);
    }

    .ux-tag--filled.ux-tag--success .ux-tag__remove:hover {
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .ux-tag--filled.ux-tag--danger {
      background-color: var(--ux-danger);
      color: white;
    }

    .ux-tag--filled.ux-tag--danger .ux-tag__remove {
      color: rgba(255, 255, 255, 0.7);
    }

    .ux-tag--filled.ux-tag--danger .ux-tag__remove:hover {
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-tag--sm {
      --ux-tag-height: 22px;
      font-size: var(--ux-font-size-xs);
      padding: 0 var(--ux-space-xs);
    }

    .ux-tag--sm .ux-tag__remove {
      width: 14px;
      height: 14px;
    }

    .ux-tag--sm .ux-tag__remove-icon {
      width: 10px;
      height: 10px;
    }

    .ux-tag--lg {
      --ux-tag-height: 34px;
      font-size: var(--ux-font-size-md);
      padding: 0 var(--ux-space-md);
      padding-right: var(--ux-space-sm);
    }

    .ux-tag--lg .ux-tag__remove {
      width: 22px;
      height: 22px;
    }

    .ux-tag--lg .ux-tag__remove-icon {
      width: 14px;
      height: 14px;
    }

    /* ========================================
       Square Shape
    ======================================== */

    .ux-tag--square {
      border-radius: var(--ux-border-radius);
    }

    /* ========================================
       With Icon/Avatar
    ======================================== */

    .ux-tag__icon {
      width: 16px;
      height: 16px;
      margin-left: calc(var(--ux-space-xs) * -1);
      flex-shrink: 0;
    }

    .ux-tag__avatar {
      width: 20px;
      height: 20px;
      margin-left: calc(var(--ux-space-sm) * -1 + 2px);
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
    }

    .ux-tag--sm .ux-tag__icon {
      width: 12px;
      height: 12px;
    }

    .ux-tag--sm .ux-tag__avatar {
      width: 16px;
      height: 16px;
    }

    .ux-tag--lg .ux-tag__icon {
      width: 18px;
      height: 18px;
    }

    .ux-tag--lg .ux-tag__avatar {
      width: 24px;
      height: 24px;
    }

    /* ========================================
       Interactive (clickable)
    ======================================== */

    .ux-tag--interactive {
      cursor: pointer;
    }

    .ux-tag--interactive:hover {
      background-color: var(--ux-surface-tertiary);
    }

    .ux-tag--interactive:active {
      transform: scale(0.97);
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-tag--disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* ========================================
       Animating Out
    ======================================== */

    .ux-tag--removing {
      animation: ux-tag-remove 200ms var(--ux-ease) forwards;
    }

    @keyframes ux-tag-remove {
      0% {
        opacity: 1;
        transform: scale(1);
      }
      100% {
        opacity: 0;
        transform: scale(0.8);
      }
    }

    /* ========================================
       Tag Group
    ======================================== */

    .ux-tag-group {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-xs);
    }

    .ux-tag-group--sm {
      gap: 4px;
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-tag {
        background-color: var(--ux-surface-secondary);
        border-color: var(--ux-border-color);
      }

      .ux-tag__remove:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .ux-tag--filled {
        background-color: var(--ux-gray-700);
        color: var(--ux-gray-200);
      }
    }

    .ux-dark .ux-tag {
      background-color: var(--ux-surface-secondary);
      border-color: var(--ux-border-color);
    }

    .ux-dark .ux-tag__remove:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-tag {
        transition: none;
      }

      .ux-tag--removing {
        animation: none;
        opacity: 0;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-tag-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-tag-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for tag groups
  const tagGroupData = (options = {}) => ({
    tags: options.tags ?? [],
    maxTags: options.maxTags ?? null,

    init() {
      // Initialize from existing elements if needed
    },

    addTag(value) {
      if (this.maxTags && this.tags.length >= this.maxTags) return false;
      if (this.tags.includes(value)) return false;

      this.tags.push(value);
      this.$dispatch('tags:add', { value, tags: [...this.tags] });
      return true;
    },

    removeTag(value) {
      const index = this.tags.indexOf(value);
      if (index === -1) return false;

      this.tags.splice(index, 1);
      this.$dispatch('tags:remove', { value, tags: [...this.tags] });
      return true;
    },

    removeTagWithAnimation(value, element) {
      element.classList.add('ux-tag--removing');
      setTimeout(() => {
        this.removeTag(value);
      }, 200);
    },

    hasTag(value) {
      return this.tags.includes(value);
    },

    clearTags() {
      this.tags = [];
      this.$dispatch('tags:clear');
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxTagGroup', tagGroupData);
  }

})();

/**
 * UX Textarea Component
 * Ãreas de texto estilo Ionic
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Textarea Container
    ======================================== */

    .ux-textarea {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    /* ========================================
       Textarea Field
    ======================================== */

    .ux-textarea__field {
      width: 100%;
      min-height: 100px;
      padding: var(--ux-space-md) var(--ux-space-lg);
      font-family: var(--ux-font-family);
      font-size: 16px; /* Prevent zoom on iOS */
      line-height: 1.5;
      color: var(--ux-text);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      outline: none;
      resize: vertical;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease),
        background-color var(--ux-transition-fast) var(--ux-ease);
      -webkit-appearance: none;
      appearance: none;
    }

    .ux-textarea__field::placeholder {
      color: var(--ux-text-tertiary);
    }

    .ux-textarea__field:hover {
      border-color: var(--ux-medium);
    }

    .ux-textarea__field:focus {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    /* ========================================
       Auto Resize
    ======================================== */

    .ux-textarea--auto-resize .ux-textarea__field {
      resize: none;
      overflow: hidden;
    }

    /* ========================================
       Label
    ======================================== */

    .ux-textarea__label {
      display: block;
      margin-bottom: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text-secondary);
    }

    .ux-textarea__label--required::after {
      content: ' *';
      color: var(--ux-danger);
    }

    /* ========================================
       Floating Label
    ======================================== */

    .ux-textarea--floating {
      position: relative;
    }

    .ux-textarea--floating .ux-textarea__field {
      padding-top: 28px;
    }

    .ux-textarea--floating .ux-textarea__label {
      position: absolute;
      top: var(--ux-space-md);
      left: var(--ux-space-lg);
      margin: 0;
      font-size: var(--ux-font-size-md);
      color: var(--ux-text-tertiary);
      pointer-events: none;
      transition:
        top var(--ux-transition-fast) var(--ux-ease),
        font-size var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-textarea--floating .ux-textarea__field:focus ~ .ux-textarea__label,
    .ux-textarea--floating .ux-textarea__field:not(:placeholder-shown) ~ .ux-textarea__label,
    .ux-textarea--floating .ux-textarea__field.has-value ~ .ux-textarea__label {
      top: 8px;
      font-size: var(--ux-font-size-xs);
      color: var(--ux-primary);
    }

    /* ========================================
       Helper Text & Counter
    ======================================== */

    .ux-textarea__footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: var(--ux-space-xs);
      gap: var(--ux-space-md);
    }

    .ux-textarea__helper {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-textarea__counter {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      flex-shrink: 0;
    }

    .ux-textarea__counter--warning {
      color: var(--ux-warning);
    }

    .ux-textarea__counter--danger {
      color: var(--ux-danger);
    }

    /* ========================================
       Error State
    ======================================== */

    .ux-textarea--error .ux-textarea__field {
      border-color: var(--ux-danger);
    }

    .ux-textarea--error .ux-textarea__field:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-danger-rgb), 0.15);
    }

    .ux-textarea--error .ux-textarea__label {
      color: var(--ux-danger);
    }

    .ux-textarea__error {
      margin-top: var(--ux-space-xs);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-danger);
    }

    /* ========================================
       Success State
    ======================================== */

    .ux-textarea--success .ux-textarea__field {
      border-color: var(--ux-success);
    }

    .ux-textarea--success .ux-textarea__field:focus {
      box-shadow: 0 0 0 3px rgba(var(--ux-success-rgb), 0.15);
    }

    /* ========================================
       Disabled State
    ======================================== */

    .ux-textarea--disabled .ux-textarea__field,
    .ux-textarea__field:disabled {
      background-color: var(--ux-light);
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
      opacity: 0.6;
      resize: none;
    }

    /* ========================================
       Readonly State
    ======================================== */

    .ux-textarea__field[readonly] {
      background-color: var(--ux-light);
      cursor: default;
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-textarea--sm .ux-textarea__field {
      min-height: 60px;
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-sm);
    }

    .ux-textarea--lg .ux-textarea__field {
      min-height: 150px;
      padding: var(--ux-space-lg) var(--ux-space-xl);
      font-size: var(--ux-font-size-lg);
    }

    /* ========================================
       Variants
    ======================================== */

    /* Filled */
    .ux-textarea--filled .ux-textarea__field {
      background-color: var(--ux-surface-secondary);
      border-color: transparent;
      border-radius: var(--ux-border-radius) var(--ux-border-radius) 0 0;
      border-bottom: 2px solid var(--ux-border-color);
    }

    .ux-textarea--filled .ux-textarea__field:focus {
      border-bottom-color: var(--ux-primary);
      box-shadow: none;
    }

    /* Outline */
    .ux-textarea--outline .ux-textarea__field {
      background-color: transparent;
    }

    /* Borderless */
    .ux-textarea--borderless .ux-textarea__field {
      border: none;
      background-color: transparent;
      padding-left: 0;
      padding-right: 0;
    }

    .ux-textarea--borderless .ux-textarea__field:focus {
      box-shadow: none;
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-textarea--glass .ux-textarea__field {
      background: var(--ux-glass-bg-thin);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-textarea--glass .ux-textarea__field:hover {
      background: var(--ux-glass-bg);
    }

    .ux-textarea--glass .ux-textarea__field:focus {
      background: var(--ux-glass-bg);
      border-color: var(--ux-glass-border);
      box-shadow: var(--ux-glass-highlight);
    }

    /* ========================================
       Resize Options
    ======================================== */

    .ux-textarea--no-resize .ux-textarea__field {
      resize: none;
    }

    .ux-textarea--resize-horizontal .ux-textarea__field {
      resize: horizontal;
    }

    .ux-textarea--resize-both .ux-textarea__field {
      resize: both;
    }

    /* ========================================
       With Toolbar (formatting)
    ======================================== */

    .ux-textarea--with-toolbar {
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      overflow: hidden;
    }

    .ux-textarea--with-toolbar .ux-textarea__field {
      border: none;
      border-radius: 0;
    }

    .ux-textarea--with-toolbar .ux-textarea__field:focus {
      box-shadow: none;
    }

    .ux-textarea__toolbar {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-sm) var(--ux-space-md);
      background-color: var(--ux-surface-secondary);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-textarea__toolbar-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
      border: none;
      background: transparent;
      border-radius: var(--ux-border-radius-sm);
      color: var(--ux-text-secondary);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-textarea__toolbar-btn:hover {
      background-color: var(--ux-light);
      color: var(--ux-text);
    }

    .ux-textarea__toolbar-btn:active {
      background-color: var(--ux-light-shade);
    }

    .ux-textarea__toolbar-btn--active {
      background-color: rgba(var(--ux-primary-rgb), 0.15);
      color: var(--ux-primary);
    }

    .ux-textarea__toolbar-btn svg {
      width: 18px;
      height: 18px;
    }

    .ux-textarea__toolbar-divider {
      width: 1px;
      height: 24px;
      background-color: var(--ux-border-color);
      margin: 0 var(--ux-space-xs);
    }

    /* Focus state for toolbar variant */
    .ux-textarea--with-toolbar:focus-within {
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-textarea-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-textarea-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for textarea with validation
  const textareaComponent = (config = {}) => ({
    value: config.value || '',
    error: '',
    touched: false,
    maxLength: config.maxLength || null,
    minLength: config.minLength || null,
    autoResize: config.autoResize || false,
    _resizeObserver: null,

    init() {
      // Set up ResizeObserver for efficient auto-resize
      if (this.autoResize && this.$refs.textarea) {
        this.setupAutoResize(this.$refs.textarea);
      }
    },

    destroy() {
      // Clean up ResizeObserver to prevent memory leaks
      if (this._resizeObserver) {
        this._resizeObserver.disconnect();
        this._resizeObserver = null;
      }
    },

    setupAutoResize(el) {
      if (!el) return;

      // Initial resize
      this.resize(el);

      // Use ResizeObserver for efficient resize detection
      if (typeof ResizeObserver !== 'undefined') {
        this._resizeObserver = new ResizeObserver(() => {
          // Avoid infinite loop by checking if height actually needs updating
          const currentHeight = el.style.height;
          el.style.height = 'auto';
          const newHeight = el.scrollHeight + 'px';
          if (currentHeight !== newHeight) {
            el.style.height = newHeight;
          } else {
            el.style.height = currentHeight;
          }
        });
        this._resizeObserver.observe(el);
      }
    },

    get hasValue() {
      return this.value && this.value.length > 0;
    },

    get charCount() {
      return this.value ? this.value.length : 0;
    },

    get charRemaining() {
      return this.maxLength ? this.maxLength - this.charCount : null;
    },

    get isOverLimit() {
      return this.maxLength && this.charCount > this.maxLength;
    },

    get isNearLimit() {
      return this.maxLength && this.charRemaining <= this.maxLength * 0.1;
    },

    get isValid() {
      return !this.error;
    },

    get counterClass() {
      if (this.isOverLimit) return 'ux-textarea__counter--danger';
      if (this.isNearLimit) return 'ux-textarea__counter--warning';
      return '';
    },

    clear() {
      this.value = '';
      this.error = '';
    },

    resize(el) {
      if (!this.autoResize) return;
      el.style.height = 'auto';
      el.style.height = el.scrollHeight + 'px';
    },

    validate(rules = []) {
      this.touched = true;
      for (const rule of rules) {
        const result = rule(this.value);
        if (result !== true) {
          this.error = result;
          return false;
        }
      }
      this.error = '';
      return true;
    },

    // Common validators
    required(message = 'This field is required') {
      return (value) => !!value && value.trim() !== '' ? true : message;
    },

    minLengthValidator(min, message) {
      return (value) => value.length >= min ? true : (message || `Minimum ${min} characters`);
    },

    maxLengthValidator(max, message) {
      return (value) => value.length <= max ? true : (message || `Maximum ${max} characters`);
    },

    pattern(regex, message = 'Invalid format') {
      return (value) => regex.test(value) ? true : message;
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxTextarea', textareaComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxTextarea', textareaComponent);
    });
  }
})();

/**
 * UX Time Clock Component
 * Employee time tracking with clock in/out, breaks, and history
 * @requires ux-core.js
 * @requires Alpine.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Time Clock
    ======================================== */

    :root {
      --ux-time-clock-padding: var(--ux-space-lg);
      --ux-time-clock-border-radius: var(--ux-border-radius-xl);
      --ux-time-clock-time-size: 4rem;
      --ux-time-clock-date-size: var(--ux-font-size-md);
    }

    .ux-time-clock {
      background: var(--ux-surface);
      border-radius: var(--ux-time-clock-border-radius);
      overflow: hidden;
      box-shadow: var(--ux-shadow-md);
    }

    /* ========================================
       Time Clock Display
    ======================================== */

    .ux-time-clock__display {
      padding: var(--ux-space-2xl) var(--ux-time-clock-padding);
      text-align: center;
      background: linear-gradient(180deg, var(--ux-surface) 0%, var(--ux-surface-secondary) 100%);
    }

    .ux-time-clock__time {
      font-size: var(--ux-time-clock-time-size);
      font-weight: 200;
      font-variant-numeric: tabular-nums;
      letter-spacing: -0.02em;
      color: var(--ux-text);
      margin: 0;
      line-height: 1.1;
    }

    .ux-time-clock__time-seconds {
      font-size: calc(var(--ux-time-clock-time-size) * 0.5);
      color: var(--ux-text-secondary);
      vertical-align: super;
      margin-left: var(--ux-space-xs);
    }

    .ux-time-clock__date {
      font-size: var(--ux-time-clock-date-size);
      color: var(--ux-text-secondary);
      margin: var(--ux-space-sm) 0 0;
    }

    /* ========================================
       Status Indicator
    ======================================== */

    .ux-time-clock__status {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-xs) var(--ux-space-md);
      border-radius: var(--ux-border-radius-full);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      margin-top: var(--ux-space-md);
      background: var(--ux-gray-100);
      color: var(--ux-text-secondary);
    }

    .ux-time-clock__status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--ux-gray-400);
    }

    /* Clocked In State */
    .ux-time-clock--clocked-in .ux-time-clock__status {
      background: rgba(var(--ux-success-rgb), 0.15);
      color: var(--ux-success);
    }

    .ux-time-clock--clocked-in .ux-time-clock__status-dot {
      background: var(--ux-success);
      animation: ux-time-clock-pulse 2s ease-in-out infinite;
    }

    /* On Break State */
    .ux-time-clock--on-break .ux-time-clock__status {
      background: rgba(var(--ux-warning-rgb), 0.15);
      color: var(--ux-warning);
    }

    .ux-time-clock--on-break .ux-time-clock__status-dot {
      background: var(--ux-warning);
      animation: ux-time-clock-pulse 1.5s ease-in-out infinite;
    }

    @keyframes ux-time-clock-pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(0.9); }
    }

    /* ========================================
       Work Counter
    ======================================== */

    .ux-time-clock__counter {
      display: flex;
      justify-content: center;
      gap: var(--ux-space-xl);
      padding: var(--ux-space-lg) var(--ux-time-clock-padding);
      border-top: 1px solid var(--ux-border-color);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-time-clock__counter-item {
      text-align: center;
    }

    .ux-time-clock__counter-value {
      font-size: var(--ux-font-size-2xl);
      font-weight: 600;
      font-variant-numeric: tabular-nums;
      color: var(--ux-text);
      line-height: 1.2;
    }

    .ux-time-clock__counter-label {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: var(--ux-space-xs);
    }

    /* ========================================
       Actions
    ======================================== */

    .ux-time-clock__actions {
      display: flex;
      gap: var(--ux-space-md);
      padding: var(--ux-time-clock-padding);
    }

    .ux-time-clock__actions .ux-button {
      flex: 1;
    }

    .ux-time-clock__actions--stacked {
      flex-direction: column;
    }

    /* ========================================
       History
    ======================================== */

    .ux-time-clock__history {
      padding: 0 var(--ux-time-clock-padding) var(--ux-time-clock-padding);
    }

    .ux-time-clock__history-title {
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin: 0 0 var(--ux-space-md);
    }

    .ux-time-clock__history-list {
      list-style: none;
      margin: 0;
      padding: 0;
      max-height: 200px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .ux-time-clock__history-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm) 0;
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-time-clock__history-item:last-child {
      border-bottom: none;
    }

    .ux-time-clock__history-type {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text);
    }

    .ux-time-clock__history-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .ux-time-clock__history-icon svg {
      width: 12px;
      height: 12px;
    }

    .ux-time-clock__history-icon--clock-in {
      background: rgba(var(--ux-success-rgb), 0.15);
      color: var(--ux-success);
    }

    .ux-time-clock__history-icon--clock-out {
      background: rgba(var(--ux-danger-rgb), 0.15);
      color: var(--ux-danger);
    }

    .ux-time-clock__history-icon--break-start {
      background: rgba(var(--ux-warning-rgb), 0.15);
      color: var(--ux-warning);
    }

    .ux-time-clock__history-icon--break-end {
      background: rgba(var(--ux-primary-rgb), 0.15);
      color: var(--ux-primary);
    }

    .ux-time-clock__history-time {
      font-size: var(--ux-font-size-sm);
      font-variant-numeric: tabular-nums;
      color: var(--ux-text-secondary);
    }

    .ux-time-clock__history-empty {
      text-align: center;
      padding: var(--ux-space-lg);
      color: var(--ux-text-tertiary);
      font-size: var(--ux-font-size-sm);
    }

    /* ========================================
       Confirmation Dialog
    ======================================== */

    .ux-time-clock__confirm {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: var(--ux-z-modal);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-xl);
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        visibility var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-time-clock__confirm--open {
      opacity: 1;
      visibility: visible;
    }

    .ux-time-clock__confirm-dialog {
      width: 100%;
      max-width: 300px;
      background: var(--ux-glass-bg-thick);
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border-radius: var(--ux-glass-radius-md);
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
      overflow: hidden;
      transform: scale(1.1);
      opacity: 0;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease-spring),
        opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-time-clock__confirm--open .ux-time-clock__confirm-dialog {
      transform: scale(1);
      opacity: 1;
    }

    .ux-time-clock__confirm-content {
      padding: var(--ux-space-lg);
      text-align: center;
    }

    .ux-time-clock__confirm-title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
    }

    .ux-time-clock__confirm-message {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    .ux-time-clock__confirm-buttons {
      display: flex;
      border-top: 0.5px solid var(--ux-glass-border);
    }

    .ux-time-clock__confirm-button {
      flex: 1;
      min-height: 44px;
      padding: var(--ux-space-sm);
      background: none;
      border: none;
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-lg);
      color: var(--ux-primary);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-time-clock__confirm-button:first-child {
      border-right: 0.5px solid var(--ux-glass-border);
    }

    .ux-time-clock__confirm-button:hover {
      background: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-time-clock__confirm-button:active {
      background: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-time-clock__confirm-button--primary {
      font-weight: 600;
    }

    .ux-time-clock__confirm-button--danger {
      color: var(--ux-danger);
    }

    .ux-time-clock__confirm-button--danger:hover {
      background: rgba(var(--ux-danger-rgb), 0.05);
    }

    /* ========================================
       Compact Variant
    ======================================== */

    .ux-time-clock--compact .ux-time-clock__display {
      padding: var(--ux-space-lg) var(--ux-time-clock-padding);
    }

    .ux-time-clock--compact .ux-time-clock__time {
      font-size: calc(var(--ux-time-clock-time-size) * 0.75);
    }

    .ux-time-clock--compact .ux-time-clock__counter {
      padding: var(--ux-space-md) var(--ux-time-clock-padding);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    .ux-time-clock--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
    }

    .ux-time-clock--glass .ux-time-clock__display {
      background: transparent;
    }

    .ux-time-clock--glass .ux-time-clock__counter {
      border-color: var(--ux-glass-border);
    }

    .ux-time-clock--glass .ux-time-clock__history-item {
      border-color: var(--ux-glass-border);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-time-clock {
        box-shadow: var(--ux-shadow-lg);
      }

      .ux-time-clock__display {
        background: linear-gradient(180deg, var(--ux-surface) 0%, var(--ux-surface-secondary) 100%);
      }

      .ux-time-clock__status {
        background: var(--ux-gray-800);
      }
    }

    .ux-dark .ux-time-clock {
      box-shadow: var(--ux-shadow-lg);
    }

    .ux-dark .ux-time-clock__display {
      background: linear-gradient(180deg, var(--ux-surface) 0%, var(--ux-surface-secondary) 100%);
    }

    .ux-dark .ux-time-clock__status {
      background: var(--ux-gray-800);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      :root {
        --ux-time-clock-time-size: 3rem;
      }

      .ux-time-clock__counter {
        gap: var(--ux-space-lg);
      }

      .ux-time-clock__actions {
        flex-direction: column;
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-time-clock__status-dot {
        animation: none;
      }

      .ux-time-clock__confirm {
        transition: none;
      }

      .ux-time-clock__confirm-dialog {
        transition: none;
        transform: none;
      }

      .ux-time-clock__confirm--open .ux-time-clock__confirm-dialog {
        transform: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-time-clock-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-time-clock-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  /**
   * Alpine.js component for Time Clock
   * @param {Object} config - Configuration options
   * @param {boolean} config.showSeconds - Show seconds in time display (default: true)
   * @param {boolean} config.confirmActions - Show confirmation dialog before actions (default: true)
   * @param {string} config.dateLocale - Locale for date formatting (default: 'en-US')
   * @param {Function} config.onClockIn - Callback when clocking in
   * @param {Function} config.onClockOut - Callback when clocking out
   * @param {Function} config.onBreakStart - Callback when starting break
   * @param {Function} config.onBreakEnd - Callback when ending break
   */
  const timeClockComponent = (config = {}) => ({
    // Configuration
    showSeconds: config.showSeconds !== false,
    confirmActions: config.confirmActions !== false,
    dateLocale: config.dateLocale || 'en-US',

    // State
    currentTime: new Date(),
    isClockedIn: false,
    isOnBreak: false,
    clockInTime: null,
    breakStartTime: null,
    entries: [],
    totalWorkedMs: 0,
    totalBreakMs: 0,

    // Confirmation dialog state
    confirmOpen: false,
    confirmTitle: '',
    confirmMessage: '',
    confirmAction: null,
    confirmIsDanger: false,

    // Timer intervals
    _clockInterval: null,
    _workedInterval: null,

    // Callbacks
    _onClockIn: config.onClockIn || null,
    _onClockOut: config.onClockOut || null,
    _onBreakStart: config.onBreakStart || null,
    _onBreakEnd: config.onBreakEnd || null,

    // Computed: current status text
    get currentStatus() {
      if (this.isOnBreak) return 'On Break';
      if (this.isClockedIn) return 'Clocked In';
      return 'Clocked Out';
    },

    // Computed: formatted current time
    get formattedTime() {
      const hours = this.currentTime.getHours();
      const minutes = this.currentTime.getMinutes();
      const h = hours.toString().padStart(2, '0');
      const m = minutes.toString().padStart(2, '0');
      return `${h}:${m}`;
    },

    // Computed: formatted seconds
    get formattedSeconds() {
      return this.currentTime.getSeconds().toString().padStart(2, '0');
    },

    // Computed: formatted date
    get formattedDate() {
      return this.currentTime.toLocaleDateString(this.dateLocale, {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    },

    // Computed: total worked time formatted
    get totalWorkedTime() {
      let total = this.totalWorkedMs;

      // Add current session if clocked in and not on break
      if (this.isClockedIn && !this.isOnBreak && this.clockInTime) {
        total += Date.now() - this.clockInTime.getTime();
      }

      return this._formatDuration(total);
    },

    // Computed: total break time formatted
    get totalBreakTime() {
      let total = this.totalBreakMs;

      // Add current break if on break
      if (this.isOnBreak && this.breakStartTime) {
        total += Date.now() - this.breakStartTime.getTime();
      }

      return this._formatDuration(total);
    },

    // Initialize component
    init() {
      // Start clock update interval
      this._clockInterval = setInterval(() => {
        this.currentTime = new Date();
      }, 1000);

      // Start worked time update interval (for live counter)
      this._workedInterval = setInterval(() => {
        // Force reactivity update by reassigning
        if (this.isClockedIn) {
          this.totalWorkedMs = this.totalWorkedMs;
        }
      }, 1000);

      // Load saved state from localStorage if available
      this._loadState();
    },

    // Cleanup on destroy
    destroy() {
      if (this._clockInterval) {
        clearInterval(this._clockInterval);
      }
      if (this._workedInterval) {
        clearInterval(this._workedInterval);
      }
    },

    // Clock In
    clockIn() {
      if (this.confirmActions) {
        this._showConfirm(
          'Clock In',
          'Are you ready to start your shift?',
          () => this._doClockIn(),
          false
        );
      } else {
        this._doClockIn();
      }
    },

    _doClockIn() {
      const now = new Date();
      this.isClockedIn = true;
      this.isOnBreak = false;
      this.clockInTime = now;

      this.entries.unshift({
        type: 'clock-in',
        time: now,
        label: 'Clock In'
      });

      this._saveState();

      if (this._onClockIn) {
        this._onClockIn({ time: now, entries: this.entries });
      }

      this.$dispatch('timeclock:clockin', { time: now });
    },

    // Clock Out
    clockOut() {
      if (this.confirmActions) {
        this._showConfirm(
          'Clock Out',
          'Are you sure you want to end your shift?',
          () => this._doClockOut(),
          true
        );
      } else {
        this._doClockOut();
      }
    },

    _doClockOut() {
      const now = new Date();

      // End any active break first
      if (this.isOnBreak && this.breakStartTime) {
        this.totalBreakMs += now.getTime() - this.breakStartTime.getTime();
        this.isOnBreak = false;
        this.breakStartTime = null;
      }

      // Calculate worked time for this session
      if (this.clockInTime) {
        this.totalWorkedMs += now.getTime() - this.clockInTime.getTime();
      }

      this.isClockedIn = false;
      this.clockInTime = null;

      this.entries.unshift({
        type: 'clock-out',
        time: now,
        label: 'Clock Out'
      });

      this._saveState();

      if (this._onClockOut) {
        this._onClockOut({
          time: now,
          totalWorked: this.totalWorkedMs,
          totalBreak: this.totalBreakMs,
          entries: this.entries
        });
      }

      this.$dispatch('timeclock:clockout', {
        time: now,
        totalWorked: this.totalWorkedMs,
        totalBreak: this.totalBreakMs
      });
    },

    // Start Break
    startBreak() {
      if (!this.isClockedIn || this.isOnBreak) return;

      if (this.confirmActions) {
        this._showConfirm(
          'Start Break',
          'Are you starting your break?',
          () => this._doStartBreak(),
          false
        );
      } else {
        this._doStartBreak();
      }
    },

    _doStartBreak() {
      const now = new Date();

      // Save worked time up to break start
      if (this.clockInTime) {
        this.totalWorkedMs += now.getTime() - this.clockInTime.getTime();
        this.clockInTime = null;
      }

      this.isOnBreak = true;
      this.breakStartTime = now;

      this.entries.unshift({
        type: 'break-start',
        time: now,
        label: 'Break Start'
      });

      this._saveState();

      if (this._onBreakStart) {
        this._onBreakStart({ time: now, entries: this.entries });
      }

      this.$dispatch('timeclock:breakstart', { time: now });
    },

    // End Break
    endBreak() {
      if (!this.isOnBreak) return;

      if (this.confirmActions) {
        this._showConfirm(
          'End Break',
          'Are you ready to resume work?',
          () => this._doEndBreak(),
          false
        );
      } else {
        this._doEndBreak();
      }
    },

    _doEndBreak() {
      const now = new Date();

      // Calculate break duration
      if (this.breakStartTime) {
        this.totalBreakMs += now.getTime() - this.breakStartTime.getTime();
      }

      this.isOnBreak = false;
      this.breakStartTime = null;
      this.clockInTime = now; // Resume tracking worked time

      this.entries.unshift({
        type: 'break-end',
        time: now,
        label: 'Break End'
      });

      this._saveState();

      if (this._onBreakEnd) {
        this._onBreakEnd({ time: now, totalBreak: this.totalBreakMs, entries: this.entries });
      }

      this.$dispatch('timeclock:breakend', { time: now, totalBreak: this.totalBreakMs });
    },

    // Reset all data
    reset() {
      this._showConfirm(
        'Reset Time Clock',
        'This will clear all entries for today. Continue?',
        () => {
          this.isClockedIn = false;
          this.isOnBreak = false;
          this.clockInTime = null;
          this.breakStartTime = null;
          this.entries = [];
          this.totalWorkedMs = 0;
          this.totalBreakMs = 0;
          this._clearState();
          this.$dispatch('timeclock:reset');
        },
        true
      );
    },

    // Format time for history entries
    formatEntryTime(date) {
      return date.toLocaleTimeString(this.dateLocale, {
        hour: '2-digit',
        minute: '2-digit'
      });
    },

    // Confirmation dialog methods
    _showConfirm(title, message, action, isDanger = false) {
      this.confirmTitle = title;
      this.confirmMessage = message;
      this.confirmAction = action;
      this.confirmIsDanger = isDanger;
      this.confirmOpen = true;
    },

    confirmYes() {
      if (this.confirmAction) {
        this.confirmAction();
      }
      this.confirmOpen = false;
    },

    confirmNo() {
      this.confirmOpen = false;
    },

    // Private helper to format duration
    _formatDuration(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      const h = hours.toString().padStart(2, '0');
      const m = minutes.toString().padStart(2, '0');
      const s = seconds.toString().padStart(2, '0');

      return `${h}:${m}:${s}`;
    },

    // State persistence
    _getStorageKey() {
      const today = new Date().toISOString().split('T')[0];
      return `ux-time-clock-${today}`;
    },

    _saveState() {
      try {
        const state = {
          isClockedIn: this.isClockedIn,
          isOnBreak: this.isOnBreak,
          clockInTime: this.clockInTime ? this.clockInTime.toISOString() : null,
          breakStartTime: this.breakStartTime ? this.breakStartTime.toISOString() : null,
          entries: this.entries.map(e => ({
            ...e,
            time: e.time.toISOString()
          })),
          totalWorkedMs: this.totalWorkedMs,
          totalBreakMs: this.totalBreakMs
        };
        localStorage.setItem(this._getStorageKey(), JSON.stringify(state));
      } catch (e) {
        console.warn('Could not save time clock state:', e);
      }
    },

    _loadState() {
      try {
        const saved = localStorage.getItem(this._getStorageKey());
        if (saved) {
          const state = JSON.parse(saved);
          this.isClockedIn = state.isClockedIn || false;
          this.isOnBreak = state.isOnBreak || false;
          this.clockInTime = state.clockInTime ? new Date(state.clockInTime) : null;
          this.breakStartTime = state.breakStartTime ? new Date(state.breakStartTime) : null;
          this.entries = (state.entries || []).map(e => ({
            ...e,
            time: new Date(e.time)
          }));
          this.totalWorkedMs = state.totalWorkedMs || 0;
          this.totalBreakMs = state.totalBreakMs || 0;
        }
      } catch (e) {
        console.warn('Could not load time clock state:', e);
      }
    },

    _clearState() {
      try {
        localStorage.removeItem(this._getStorageKey());
      } catch (e) {
        console.warn('Could not clear time clock state:', e);
      }
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxTimeClock', timeClockComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxTimeClock', timeClockComponent);
    });
  }
})();

/**
 * UX Timeline Component
 * Vertical and horizontal timeline for displaying events chronologically
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Timeline - Base
    ======================================== */

    .ux-timeline {
      position: relative;
      font-family: var(--ux-font-family);
    }

    /* ========================================
       Vertical Timeline (Default)
    ======================================== */

    .ux-timeline--vertical {
      padding-left: var(--ux-space-xl);
    }

    .ux-timeline--vertical::before {
      content: '';
      position: absolute;
      left: 11px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--ux-border-color);
    }

    /* Timeline Item */
    .ux-timeline__item {
      position: relative;
      padding-bottom: var(--ux-space-lg);
    }

    .ux-timeline__item:last-child {
      padding-bottom: 0;
    }

    /* Marker */
    .ux-timeline__marker {
      position: absolute;
      left: calc(-1 * var(--ux-space-xl) + 4px);
      top: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--ux-surface);
      border: 2px solid var(--ux-border-color);
      z-index: 1;
    }

    .ux-timeline__marker--dot {
      width: 12px;
      height: 12px;
      left: calc(-1 * var(--ux-space-xl) + 6px);
      background: var(--ux-primary);
      border: none;
    }

    .ux-timeline__marker--icon {
      width: 32px;
      height: 32px;
      left: calc(-1 * var(--ux-space-xl) - 4px);
      background: var(--ux-primary);
      border: none;
      color: var(--ux-primary-contrast);
    }

    .ux-timeline__marker--icon svg {
      width: 16px;
      height: 16px;
    }

    /* Color variants for markers */
    .ux-timeline__marker--primary {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
    }

    .ux-timeline__marker--success {
      background: var(--ux-success);
      border-color: var(--ux-success);
    }

    .ux-timeline__marker--warning {
      background: var(--ux-warning);
      border-color: var(--ux-warning);
    }

    .ux-timeline__marker--danger {
      background: var(--ux-danger);
      border-color: var(--ux-danger);
    }

    .ux-timeline__marker--secondary {
      background: var(--ux-gray-400);
      border-color: var(--ux-gray-400);
    }

    /* Content */
    .ux-timeline__content {
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      padding: var(--ux-space-md);
    }

    .ux-timeline__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--ux-space-sm);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-timeline__title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
    }

    .ux-timeline__time {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-tertiary);
      white-space: nowrap;
    }

    .ux-timeline__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    .ux-timeline__body {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-sm);
    }

    .ux-timeline__body p {
      margin: 0 0 var(--ux-space-xs);
    }

    .ux-timeline__body p:last-child {
      margin-bottom: 0;
    }

    .ux-timeline__footer {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      margin-top: var(--ux-space-md);
      padding-top: var(--ux-space-sm);
      border-top: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Simple Timeline (No Cards)
    ======================================== */

    .ux-timeline--simple .ux-timeline__content {
      background: transparent;
      border: none;
      padding: 0;
      padding-left: var(--ux-space-sm);
    }

    .ux-timeline--simple .ux-timeline__footer {
      border-top: none;
      padding-top: 0;
    }

    /* ========================================
       Compact Timeline
    ======================================== */

    .ux-timeline--compact .ux-timeline__item {
      padding-bottom: var(--ux-space-md);
    }

    .ux-timeline--compact .ux-timeline__content {
      padding: var(--ux-space-sm);
    }

    .ux-timeline--compact .ux-timeline__title {
      font-size: var(--ux-font-size-sm);
    }

    .ux-timeline--compact .ux-timeline__body {
      font-size: var(--ux-font-size-xs);
    }

    /* ========================================
       Alternating Timeline
    ======================================== */

    .ux-timeline--alternating {
      padding-left: 0;
    }

    .ux-timeline--alternating::before {
      left: 50%;
      transform: translateX(-50%);
    }

    .ux-timeline--alternating .ux-timeline__item {
      width: 50%;
      padding-right: var(--ux-space-xl);
      padding-left: 0;
    }

    .ux-timeline--alternating .ux-timeline__item:nth-child(even) {
      margin-left: 50%;
      padding-left: var(--ux-space-xl);
      padding-right: 0;
    }

    .ux-timeline--alternating .ux-timeline__marker {
      left: auto;
      right: calc(-1 * var(--ux-space-xl) + 4px);
    }

    .ux-timeline--alternating .ux-timeline__item:nth-child(even) .ux-timeline__marker {
      left: calc(-1 * var(--ux-space-xl) + 4px);
      right: auto;
    }

    .ux-timeline--alternating .ux-timeline__marker--icon {
      right: calc(-1 * var(--ux-space-xl) - 4px);
    }

    .ux-timeline--alternating .ux-timeline__item:nth-child(even) .ux-timeline__marker--icon {
      left: calc(-1 * var(--ux-space-xl) - 4px);
    }

    /* ========================================
       Right-aligned Timeline
    ======================================== */

    .ux-timeline--right {
      padding-left: 0;
      padding-right: var(--ux-space-xl);
    }

    .ux-timeline--right::before {
      left: auto;
      right: 11px;
    }

    .ux-timeline--right .ux-timeline__marker {
      left: auto;
      right: calc(-1 * var(--ux-space-xl) + 4px);
    }

    .ux-timeline--right .ux-timeline__marker--icon {
      right: calc(-1 * var(--ux-space-xl) - 4px);
    }

    .ux-timeline--right .ux-timeline__content {
      text-align: right;
    }

    .ux-timeline--right .ux-timeline__header {
      flex-direction: row-reverse;
    }

    .ux-timeline--right .ux-timeline__footer {
      justify-content: flex-end;
    }

    /* ========================================
       Horizontal Timeline
    ======================================== */

    .ux-timeline--horizontal {
      display: flex;
      overflow-x: auto;
      padding: var(--ux-space-xl) 0 var(--ux-space-md);
      gap: 0;
      -webkit-overflow-scrolling: touch;
    }

    .ux-timeline--horizontal::before {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      top: 11px;
      height: 2px;
      background: var(--ux-border-color);
    }

    .ux-timeline--horizontal .ux-timeline__item {
      flex: 0 0 auto;
      min-width: 200px;
      max-width: 280px;
      padding-bottom: 0;
      padding-right: var(--ux-space-lg);
    }

    .ux-timeline--horizontal .ux-timeline__item:last-child {
      padding-right: 0;
    }

    .ux-timeline--horizontal .ux-timeline__marker {
      position: absolute;
      left: 50%;
      top: calc(-1 * var(--ux-space-xl) + 4px);
      transform: translateX(-50%);
    }

    .ux-timeline--horizontal .ux-timeline__marker--icon {
      top: calc(-1 * var(--ux-space-xl) - 4px);
    }

    .ux-timeline--horizontal .ux-timeline__content {
      height: 100%;
    }

    /* ========================================
       Horizontal Scroll Navigation
    ======================================== */

    .ux-timeline-scroll {
      position: relative;
    }

    .ux-timeline-scroll__container {
      overflow: hidden;
    }

    .ux-timeline-scroll__nav {
      position: absolute;
      top: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: 50%;
      box-shadow: var(--ux-shadow-md);
      cursor: pointer;
      z-index: 10;
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-timeline-scroll__nav:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-timeline-scroll__nav:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-timeline-scroll__nav--prev {
      left: 0;
    }

    .ux-timeline-scroll__nav--next {
      right: 0;
    }

    .ux-timeline-scroll__nav svg {
      width: 20px;
      height: 20px;
      color: var(--ux-text);
    }

    /* ========================================
       Connected Items (with connector line animation)
    ======================================== */

    .ux-timeline--animated::before {
      background: linear-gradient(
        to bottom,
        var(--ux-primary) var(--timeline-progress, 0%),
        var(--ux-border-color) var(--timeline-progress, 0%)
      );
    }

    .ux-timeline--horizontal.ux-timeline--animated::before {
      background: linear-gradient(
        to right,
        var(--ux-primary) var(--timeline-progress, 0%),
        var(--ux-border-color) var(--timeline-progress, 0%)
      );
    }

    /* ========================================
       Grouped Timeline
    ======================================== */

    .ux-timeline__group {
      margin-bottom: var(--ux-space-lg);
    }

    .ux-timeline__group-title {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-xs) var(--ux-space-md);
      background: var(--ux-surface-secondary);
      border-radius: 999px;
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-md);
      margin-left: calc(-1 * var(--ux-space-xl) + 24px);
    }

    /* ========================================
       Activity Feed Style
    ======================================== */

    .ux-timeline--activity {
      padding-left: var(--ux-space-2xl);
    }

    .ux-timeline--activity .ux-timeline__marker {
      left: calc(-1 * var(--ux-space-2xl) + 4px);
      width: 32px;
      height: 32px;
      background: var(--ux-surface-secondary);
      border: none;
    }

    .ux-timeline--activity .ux-timeline__marker svg {
      width: 16px;
      height: 16px;
      color: var(--ux-text-secondary);
    }

    .ux-timeline--activity .ux-timeline__content {
      background: transparent;
      border: none;
      padding: 0;
    }

    .ux-timeline--activity .ux-timeline__title {
      font-size: var(--ux-font-size-sm);
      font-weight: 400;
    }

    .ux-timeline--activity .ux-timeline__title strong {
      font-weight: 600;
      color: var(--ux-text);
    }

    .ux-timeline--activity .ux-timeline__time {
      display: block;
      margin-top: 2px;
    }

    /* ========================================
       Loading State
    ======================================== */

    .ux-timeline__item--loading .ux-timeline__content {
      opacity: 0.6;
    }

    .ux-timeline__item--loading .ux-timeline__marker {
      animation: ux-timeline-pulse 1.5s infinite;
    }

    @keyframes ux-timeline-pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.7; }
    }

    /* ========================================
       Interactive States
    ======================================== */

    .ux-timeline__item--clickable {
      cursor: pointer;
    }

    .ux-timeline__item--clickable .ux-timeline__content {
      transition: all var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-timeline__item--clickable:hover .ux-timeline__content {
      border-color: var(--ux-primary);
      box-shadow: var(--ux-shadow-sm);
    }

    .ux-timeline__item--active .ux-timeline__content {
      border-color: var(--ux-primary);
      background: rgba(var(--ux-primary-rgb), 0.05);
    }

    .ux-timeline__item--active .ux-timeline__marker {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 4px rgba(var(--ux-primary-rgb), 0.2);
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-timeline--glass .ux-timeline__content {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);
    }

    .ux-timeline--glass .ux-timeline__group-title {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-timeline--activity .ux-timeline__marker {
        background: var(--ux-surface-tertiary);
      }
    }

    .ux-dark .ux-timeline--activity .ux-timeline__marker {
      background: var(--ux-surface-tertiary);
    }

    /* ========================================
       Responsive
    ======================================== */

    @media (max-width: 767px) {
      .ux-timeline--alternating {
        padding-left: var(--ux-space-xl);
      }

      .ux-timeline--alternating::before {
        left: 11px;
        transform: none;
      }

      .ux-timeline--alternating .ux-timeline__item,
      .ux-timeline--alternating .ux-timeline__item:nth-child(even) {
        width: 100%;
        margin-left: 0;
        padding-left: 0;
        padding-right: 0;
      }

      .ux-timeline--alternating .ux-timeline__marker,
      .ux-timeline--alternating .ux-timeline__item:nth-child(even) .ux-timeline__marker {
        left: calc(-1 * var(--ux-space-xl) + 4px);
        right: auto;
      }

      .ux-timeline--alternating .ux-timeline__marker--icon,
      .ux-timeline--alternating .ux-timeline__item:nth-child(even) .ux-timeline__marker--icon {
        left: calc(-1 * var(--ux-space-xl) - 4px);
        right: auto;
      }

      .ux-timeline--horizontal .ux-timeline__item {
        min-width: 160px;
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-timeline__item--loading .ux-timeline__marker {
        animation: none;
      }

      .ux-timeline__item--clickable .ux-timeline__content {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-timeline-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-timeline-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for interactive timeline
  const timelineData = (options = {}) => ({
    items: options.items || [],
    activeIndex: options.activeIndex ?? -1,
    direction: options.direction || 'vertical', // vertical, horizontal
    variant: options.variant || 'default', // default, simple, activity, alternating
    animated: options.animated ?? false,
    clickable: options.clickable ?? false,
    progress: 0,

    init() {
      if (this.animated && this.items.length > 0) {
        this.calculateProgress();
      }
    },

    calculateProgress() {
      // Calculate progress based on active index
      if (this.activeIndex >= 0 && this.items.length > 0) {
        this.progress = ((this.activeIndex + 1) / this.items.length) * 100;
        this.$el.style.setProperty('--timeline-progress', `${this.progress}%`);
      }
    },

    setActive(index) {
      if (index >= 0 && index < this.items.length) {
        this.activeIndex = index;
        this.calculateProgress();
        this.$dispatch('timeline:change', { index, item: this.items[index] });
      }
    },

    isActive(index) {
      return index === this.activeIndex;
    },

    isCompleted(index) {
      return index < this.activeIndex;
    },

    next() {
      if (this.activeIndex < this.items.length - 1) {
        this.setActive(this.activeIndex + 1);
      }
    },

    prev() {
      if (this.activeIndex > 0) {
        this.setActive(this.activeIndex - 1);
      }
    },

    goTo(index) {
      this.setActive(index);
    },

    onClick(index, event) {
      if (this.clickable) {
        this.setActive(index);
        this.$dispatch('timeline:click', { index, item: this.items[index], event });
      }
    },

    getMarkerClass(index, item) {
      const classes = ['ux-timeline__marker'];

      if (item.icon) {
        classes.push('ux-timeline__marker--icon');
      } else if (item.dot) {
        classes.push('ux-timeline__marker--dot');
      }

      if (item.color) {
        classes.push(`ux-timeline__marker--${item.color}`);
      } else if (this.isActive(index)) {
        classes.push('ux-timeline__marker--primary');
      } else if (this.isCompleted(index)) {
        classes.push('ux-timeline__marker--success');
      }

      return classes.join(' ');
    },

    getItemClass(index, item) {
      const classes = ['ux-timeline__item'];

      if (this.clickable) {
        classes.push('ux-timeline__item--clickable');
      }

      if (this.isActive(index)) {
        classes.push('ux-timeline__item--active');
      }

      if (item.loading) {
        classes.push('ux-timeline__item--loading');
      }

      return classes.join(' ');
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxTimeline', timelineData);
  }

})();

/**
 * UX Toast Component
 * Notificaciones toast estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Toast Container
    ======================================== */

    .ux-toast-container {
      position: fixed;
      z-index: var(--ux-z-toast);
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
      pointer-events: none;
      padding: var(--ux-space-md);
    }

    .ux-toast-container--top {
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      padding-top: calc(var(--ux-space-md) + env(safe-area-inset-top));
    }

    .ux-toast-container--bottom {
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      padding-bottom: calc(var(--ux-space-md) + env(safe-area-inset-bottom));
    }

    .ux-toast-container--top-start {
      top: 0;
      left: 0;
    }

    .ux-toast-container--top-end {
      top: 0;
      right: 0;
    }

    .ux-toast-container--bottom-start {
      bottom: 0;
      left: 0;
    }

    .ux-toast-container--bottom-end {
      bottom: 0;
      right: 0;
      padding-bottom: calc(var(--ux-space-md) + env(safe-area-inset-bottom));
    }

    /* Center positions */
    .ux-toast-container--center {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .ux-toast-container--center-start {
      top: 50%;
      left: 0;
      transform: translateY(-50%);
    }

    .ux-toast-container--center-end {
      top: 50%;
      right: 0;
      transform: translateY(-50%);
    }

    /* ========================================
       UX Toast
    ======================================== */

    .ux-toast {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
      min-height: var(--ux-toast-min-height);
      min-width: 200px;
      max-width: var(--ux-toast-max-width);
      padding: var(--ux-toast-padding);
      background-color: var(--ux-dark);
      color: var(--ux-dark-contrast);
      border-radius: var(--ux-toast-border-radius);
      box-shadow: var(--ux-shadow-lg);
      pointer-events: auto;
      opacity: 0;
      transform: translateY(-20px) scale(0.95);
      will-change: transform, opacity;
      transition:
        opacity var(--ux-transition-base) var(--ux-ease),
        transform var(--ux-transition-base) var(--ux-ease-spring);
    }

    .ux-toast-container--bottom .ux-toast,
    .ux-toast-container--bottom-start .ux-toast,
    .ux-toast-container--bottom-end .ux-toast {
      transform: translateY(20px) scale(0.95);
    }

    .ux-toast-container--center .ux-toast {
      transform: scale(0.9);
    }

    .ux-toast-container--center-start .ux-toast,
    .ux-toast-container--top-start .ux-toast,
    .ux-toast-container--bottom-start .ux-toast {
      transform: translateX(-20px) scale(0.95);
    }

    .ux-toast-container--center-end .ux-toast,
    .ux-toast-container--top-end .ux-toast,
    .ux-toast-container--bottom-end .ux-toast {
      transform: translateX(20px) scale(0.95);
    }

    .ux-toast--visible {
      opacity: 1;
      transform: translateY(0) translateX(0) scale(1);
      will-change: auto;
    }

    /* ========================================
       Toast Content
    ======================================== */

    .ux-toast__icon {
      width: var(--ux-toast-icon-size, 22px);
      height: var(--ux-toast-icon-size, 22px);
      flex-shrink: 0;
    }

    .ux-toast__icon svg {
      width: 100%;
      height: 100%;
    }

    /* Icon colors for semantic toasts */
    .ux-toast--success .ux-toast__icon {
      color: var(--ux-success-contrast);
    }

    .ux-toast--warning .ux-toast__icon {
      color: var(--ux-warning-contrast);
    }

    .ux-toast--danger .ux-toast__icon {
      color: var(--ux-danger-contrast);
    }

    .ux-toast--light .ux-toast__icon--success {
      color: var(--ux-success);
    }

    .ux-toast--light .ux-toast__icon--warning {
      color: var(--ux-warning);
    }

    .ux-toast--light .ux-toast__icon--danger {
      color: var(--ux-danger);
    }

    .ux-toast--light .ux-toast__icon--info {
      color: var(--ux-primary);
    }

    .ux-toast--glass .ux-toast__icon--success {
      color: var(--ux-success);
    }

    .ux-toast--glass .ux-toast__icon--warning {
      color: var(--ux-warning);
    }

    .ux-toast--glass .ux-toast__icon--danger {
      color: var(--ux-danger);
    }

    .ux-toast--glass .ux-toast__icon--info {
      color: var(--ux-primary);
    }

    .ux-toast__content {
      flex: 1;
      min-width: 0;
    }

    .ux-toast__message {
      font-size: var(--ux-font-size-sm);
      line-height: 1.4;
    }

    .ux-toast__title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .ux-toast__action {
      flex-shrink: 0;
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background: none;
      border: none;
      color: var(--ux-primary-tint);
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-sm);
      font-weight: 600;
      cursor: pointer;
      border-radius: var(--ux-border-radius-sm);
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-toast__action:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .ux-toast__action:active {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .ux-toast__close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      padding: 0;
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      flex-shrink: 0;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-toast__close:hover {
      color: white;
    }

    .ux-toast__close svg {
      width: 16px;
      height: 16px;
    }

    /* ========================================
       Toast Colors
    ======================================== */

    .ux-toast--success {
      background-color: var(--ux-success);
      color: var(--ux-success-contrast);
    }

    .ux-toast--success .ux-toast__action {
      color: rgba(255, 255, 255, 0.9);
    }

    .ux-toast--warning {
      background-color: var(--ux-warning);
      color: var(--ux-warning-contrast);
    }

    .ux-toast--warning .ux-toast__action {
      color: rgba(0, 0, 0, 0.7);
    }

    .ux-toast--danger {
      background-color: var(--ux-danger);
      color: var(--ux-danger-contrast);
    }

    .ux-toast--danger .ux-toast__action {
      color: rgba(255, 255, 255, 0.9);
    }

    .ux-toast--light {
      background-color: var(--ux-surface);
      color: var(--ux-text);
      border: 1px solid var(--ux-border-color);
    }

    .ux-toast--light .ux-toast__action {
      color: var(--ux-primary);
    }

    .ux-toast--light .ux-toast__close {
      color: var(--ux-text-tertiary);
    }

    .ux-toast--light .ux-toast__close:hover {
      color: var(--ux-text);
    }

    /* ========================================
       Glass Toast (iOS 26 Liquid Glass)
    ======================================== */

    .ux-toast--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      color: var(--ux-text);
      border: 0.5px solid var(--ux-glass-border);
      border-radius: var(--ux-glass-radius-lg);
      box-shadow:
        var(--ux-glass-shadow),
        var(--ux-glass-highlight);
    }

    .ux-toast--glass .ux-toast__action {
      color: var(--ux-primary);
    }

    .ux-toast--glass .ux-toast__action:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .ux-toast--glass .ux-toast__close {
      color: var(--ux-text-tertiary);
    }

    .ux-toast--glass .ux-toast__close:hover {
      color: var(--ux-text);
    }

    .ux-toast--glass .ux-toast__progress {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .ux-toast--glass .ux-toast__progress-bar {
      background-color: var(--ux-primary);
    }

    /* Dark mode glass toast */
    @media (prefers-color-scheme: dark) {
      .ux-toast--glass .ux-toast__action:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .ux-toast--glass .ux-toast__progress {
        background-color: rgba(255, 255, 255, 0.1);
      }
    }

    .ux-dark .ux-toast--glass .ux-toast__action:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .ux-dark .ux-toast--glass .ux-toast__progress {
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* Fallback */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-toast--glass {
        background-color: var(--ux-surface);
      }
    }

    /* ========================================
       Toast Progress Bar
    ======================================== */

    .ux-toast__progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 0 0 var(--ux-border-radius-lg) var(--ux-border-radius-lg);
      overflow: hidden;
    }

    .ux-toast__progress-bar {
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      transition: width linear;
    }

    .ux-toast--light .ux-toast__progress {
      background-color: var(--ux-light);
    }

    .ux-toast--light .ux-toast__progress-bar {
      background-color: var(--ux-primary);
    }

    /* ========================================
       Toast Sizes
    ======================================== */

    .ux-toast--sm {
      min-width: 150px;
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    .ux-toast--sm .ux-toast__message {
      font-size: var(--ux-font-size-xs);
    }

    .ux-toast--lg {
      min-width: 300px;
      padding: var(--ux-space-lg);
    }

    /* ========================================
       Toast with Avatar
    ======================================== */

    .ux-toast__avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
    }

    .ux-toast__avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ========================================
       Swipeable Toast
    ======================================== */

    .ux-toast--swipeable {
      cursor: grab;
      user-select: none;
    }

    .ux-toast--swipeable:active {
      cursor: grabbing;
    }

    .ux-toast--swiping {
      transition: none;
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .ux-toast {
        transition: opacity 0.1s ease;
        transform: none !important;
      }

      .ux-toast--visible {
        transform: none;
      }

      .ux-toast__progress-bar {
        transition: none;
      }
    }

    /* ========================================
       Stacked Toasts
    ======================================== */

    .ux-toast-container--stacked {
      align-items: center;
    }

    .ux-toast-container--stacked .ux-toast:nth-child(2) {
      transform: scale(0.95);
      opacity: 0.8;
    }

    .ux-toast-container--stacked .ux-toast:nth-child(3) {
      transform: scale(0.9);
      opacity: 0.6;
    }

    .ux-toast-container--stacked .ux-toast:nth-child(n+4) {
      display: none;
    }

    /* ========================================
       Full Width Toast (mobile)
    ======================================== */

    @media (max-width: 480px) {
      .ux-toast-container--top,
      .ux-toast-container--bottom {
        left: 0;
        right: 0;
        transform: none;
        padding-left: var(--ux-space-sm);
        padding-right: var(--ux-space-sm);
      }

      .ux-toast {
        max-width: none;
        width: 100%;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-toast-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-toast-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for toast
  // ARIA: role="status" or "alert", aria-live for announcements
  const toastComponent = (config = {}) => ({
    visible: false,
    message: config.message || '',
    title: config.title || '',
    color: config.color || '',
    duration: config.duration || 3000,
    showProgress: config.showProgress || false,
    progress: 100,
    _timer: null,
    _progressTimer: null,
    _startTime: null,

    // ARIA attributes - use "alert" for danger/errors, "status" for info
    get ariaAttrs() {
      const isUrgent = this.color === 'danger' || this.color === 'warning';
      return {
        'role': isUrgent ? 'alert' : 'status',
        'aria-live': isUrgent ? 'assertive' : 'polite',
        'aria-atomic': 'true'
      };
    },

    show(options = {}) {
      if (options.message) this.message = options.message;
      if (options.title) this.title = options.title;
      if (options.color) this.color = options.color;
      if (options.duration !== undefined) this.duration = options.duration;
      if (options.showProgress !== undefined) this.showProgress = options.showProgress;

      this.visible = true;
      this.progress = 100;
      this._startTime = Date.now();

      // Clear existing timer
      if (this._timer) {
        clearTimeout(this._timer);
      }
      if (this._progressTimer) {
        cancelAnimationFrame(this._progressTimer);
      }

      // Auto dismiss
      if (this.duration > 0) {
        // Progress bar animation using requestAnimationFrame for accuracy
        if (this.showProgress) {
          const updateProgress = () => {
            const elapsed = Date.now() - this._startTime;
            this.progress = Math.max(0, 100 - (elapsed / this.duration) * 100);

            if (this.progress > 0 && this.visible) {
              this._progressTimer = requestAnimationFrame(updateProgress);
            }
          };
          this._progressTimer = requestAnimationFrame(updateProgress);
        }

        this._timer = setTimeout(() => {
          this.dismiss();
        }, this.duration);
      }
    },

    dismiss() {
      this.visible = false;
      if (this._timer) {
        clearTimeout(this._timer);
        this._timer = null;
      }
      if (this._progressTimer) {
        cancelAnimationFrame(this._progressTimer);
        this._progressTimer = null;
      }
    },

    pause() {
      this._pausedAt = Date.now();
      if (this._timer) {
        clearTimeout(this._timer);
        this._timer = null;
      }
      if (this._progressTimer) {
        cancelAnimationFrame(this._progressTimer);
        this._progressTimer = null;
      }
    },

    resume() {
      if (this.visible && this.duration > 0) {
        const remainingTime = (this.progress / 100) * this.duration;
        // Adjust start time to account for pause duration
        this._startTime = Date.now() - (this.duration - remainingTime);

        if (this.showProgress) {
          const updateProgress = () => {
            const elapsed = Date.now() - this._startTime;
            this.progress = Math.max(0, 100 - (elapsed / this.duration) * 100);

            if (this.progress > 0 && this.visible) {
              this._progressTimer = requestAnimationFrame(updateProgress);
            }
          };
          this._progressTimer = requestAnimationFrame(updateProgress);
        }

        this._timer = setTimeout(() => {
          this.dismiss();
        }, remainingTime);
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxToast', toastComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxToast', toastComponent);
    });
  }

  // Toast manager for multiple toasts
  // ARIA: Container with aria-live region for toast announcements
  // Posiciones disponibles: top, bottom, center, top-start, top-end, bottom-start, bottom-end, center-start, center-end
  const toastManagerComponent = (config = {}) => ({
    toasts: [],
    position: config.position || 'bottom',
    maxToasts: config.maxToasts || 5,

    // ARIA attributes for toast container (live region)
    get containerAriaAttrs() {
      return {
        'aria-live': 'polite',
        'aria-atomic': 'false'
      };
    },

    // Computed class for container position
    get containerClass() {
      return `ux-toast-container ux-toast-container--${this.position}`;
    },

    setPosition(newPosition) {
      const validPositions = ['top', 'bottom', 'center', 'top-start', 'top-end', 'bottom-start', 'bottom-end', 'center-start', 'center-end'];
      if (validPositions.includes(newPosition)) {
        this.position = newPosition;
      }
    },

    add(options) {
      const id = Date.now() + Math.random();
      const toast = {
        id,
        message: options.message || '',
        title: options.title || '',
        color: options.color || '',
        duration: options.duration ?? 3000,
        showProgress: options.showProgress || false,
        visible: false,
        progress: 100
      };

      this.toasts.push(toast);

      // Limit max toasts
      if (this.toasts.length > this.maxToasts) {
        this.toasts.shift();
      }

      // Show after next tick
      this.$nextTick(() => {
        const t = this.toasts.find(x => x.id === id);
        if (t) t.visible = true;
      });

      // Auto remove
      if (toast.duration > 0) {
        setTimeout(() => {
          this.remove(id);
        }, toast.duration);
      }

      return id;
    },

    remove(id) {
      const index = this.toasts.findIndex(t => t.id === id);
      if (index !== -1) {
        this.toasts[index].visible = false;
        setTimeout(() => {
          this.toasts = this.toasts.filter(t => t.id !== id);
        }, 300);
      }
    },

    clear() {
      this.toasts.forEach(t => t.visible = false);
      setTimeout(() => {
        this.toasts = [];
      }, 300);
    },

    // Alias for clear
    dismissAll() {
      this.clear();
    },

    success(message, options = {}) {
      return this.add({ ...options, message, color: 'success' });
    },

    warning(message, options = {}) {
      return this.add({ ...options, message, color: 'warning' });
    },

    danger(message, options = {}) {
      return this.add({ ...options, message, color: 'danger' });
    },

    info(message, options = {}) {
      return this.add({ ...options, message, color: '' });
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxToastManager', toastManagerComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxToastManager', toastManagerComponent);
    });
  }
})();

/**
 * UX Toggle Component
 * Toggle switches estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Toggle
    ======================================== */

    .ux-toggle {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-md);
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
    }

    .ux-toggle input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
      pointer-events: none;
    }

    .ux-toggle__track {
      position: relative;
      width: var(--ux-toggle-width);
      height: var(--ux-toggle-height);
      background-color: var(--ux-medium);
      border-radius: var(--ux-toggle-border-radius);
      transition:
        background-color var(--ux-transition-base) var(--ux-ease);
      flex-shrink: 0;
    }

    .ux-toggle__thumb {
      position: absolute;
      top: 2px;
      left: 2px;
      width: var(--ux-toggle-handle-size);
      height: var(--ux-toggle-handle-size);
      background-color: white;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition:
        transform var(--ux-transition-base) var(--ux-ease-spring),
        width var(--ux-transition-fast) var(--ux-ease);
    }

    /* Checked State - Default uses primary color like Ionic */
    .ux-toggle input[type="checkbox"]:checked + .ux-toggle__track {
      background-color: var(--ux-primary);
    }

    .ux-toggle input[type="checkbox"]:checked + .ux-toggle__track .ux-toggle__thumb {
      transform: translateX(20px);
    }

    /* Active State (press effect) */
    .ux-toggle input[type="checkbox"]:active + .ux-toggle__track .ux-toggle__thumb,
    .ux-toggle:active .ux-toggle__thumb {
      width: 31px;
    }

    .ux-toggle input[type="checkbox"]:checked:active + .ux-toggle__track .ux-toggle__thumb {
      transform: translateX(16px);
    }

    /* Focus State */
    .ux-toggle input[type="checkbox"]:focus-visible + .ux-toggle__track {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    /* Disabled State */
    .ux-toggle--disabled,
    .ux-toggle input[type="checkbox"]:disabled + .ux-toggle__track {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-toggle input[type="checkbox"]:disabled + .ux-toggle__track .ux-toggle__thumb {
      box-shadow: none;
    }

    /* ========================================
       Color Variants
       Default: primary (like Ionic)
    ======================================== */

    .ux-toggle.ux-color-success input[type="checkbox"]:checked + .ux-toggle__track { background-color: var(--ux-success); }
    .ux-toggle.ux-color-warning input[type="checkbox"]:checked + .ux-toggle__track { background-color: var(--ux-warning); }
    .ux-toggle.ux-color-danger input[type="checkbox"]:checked + .ux-toggle__track { background-color: var(--ux-danger); }
    .ux-toggle.ux-color-dark input[type="checkbox"]:checked + .ux-toggle__track { background-color: var(--ux-dark); }

    /* ========================================
       Sizes
    ======================================== */

    .ux-toggle--sm .ux-toggle__track {
      width: 40px;
      height: 24px;
    }

    .ux-toggle--sm .ux-toggle__thumb {
      width: 20px;
      height: 20px;
    }

    .ux-toggle--sm input[type="checkbox"]:checked + .ux-toggle__track .ux-toggle__thumb {
      transform: translateX(16px);
    }

    .ux-toggle--sm input[type="checkbox"]:active + .ux-toggle__track .ux-toggle__thumb {
      width: 24px;
    }

    .ux-toggle--sm input[type="checkbox"]:checked:active + .ux-toggle__track .ux-toggle__thumb {
      transform: translateX(12px);
    }

    .ux-toggle--lg .ux-toggle__track {
      width: 64px;
      height: 38px;
    }

    .ux-toggle--lg .ux-toggle__thumb {
      width: 34px;
      height: 34px;
    }

    .ux-toggle--lg input[type="checkbox"]:checked + .ux-toggle__track .ux-toggle__thumb {
      transform: translateX(26px);
    }

    .ux-toggle--lg input[type="checkbox"]:active + .ux-toggle__track .ux-toggle__thumb {
      width: 38px;
    }

    /* ========================================
       Label
    ======================================== */

    .ux-toggle__label {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
    }

    .ux-toggle__label--left {
      order: -1;
    }

    .ux-toggle__description {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    /* ========================================
       With Icons
    ======================================== */

    .ux-toggle__track--icons {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 8px;
    }

    .ux-toggle__icon {
      width: 14px;
      height: 14px;
      color: white;
      opacity: 0.8;
      z-index: 0;
    }

    .ux-toggle__icon svg {
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Toggle List Item
    ======================================== */

    .ux-toggle-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-md) var(--ux-space-lg);
      background-color: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-toggle-item:last-child {
      border-bottom: none;
    }

    .ux-toggle-item__content {
      flex: 1;
      margin-right: var(--ux-space-md);
    }

    .ux-toggle-item__title {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-toggle-item__subtitle {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin-top: var(--ux-space-xs);
    }

    /* ========================================
       Glass Variant (iOS 26 Liquid Glass)
    ======================================== */

    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-toggle--glass .ux-toggle__track {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 0.5px solid var(--ux-glass-border);
    }

    .ux-toggle--glass .ux-toggle__thumb {
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
    }

    .ux-toggle--glass input[type="checkbox"]:checked + .ux-toggle__track {
      background: var(--ux-primary);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-toggle__track {
        transition: none;
      }

      .ux-toggle__thumb {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-toggle-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-toggle-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for toggle
  // ARIA: role="switch", aria-checked for toggle state
  const toggleComponent = (config = {}) => ({
    checked: config.checked || false,
    disabled: config.disabled || false,

    // ARIA attributes for toggle (when used without native checkbox)
    get ariaAttrs() {
      return {
        'role': 'switch',
        'aria-checked': this.checked ? 'true' : 'false',
        'aria-disabled': this.disabled ? 'true' : 'false'
      };
    },

    toggle() {
      if (!this.disabled) {
        this.checked = !this.checked;
      }
    },

    on() {
      if (!this.disabled) {
        this.checked = true;
      }
    },

    off() {
      if (!this.disabled) {
        this.checked = false;
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxToggle', toggleComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxToggle', toggleComponent);
    });
  }
})();

/**
 * UX Toolbar Component
 * Barras de herramientas estilo iOS
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Toolbar
    ======================================== */

    .ux-toolbar {
      display: flex;
      align-items: center;
      min-height: var(--ux-toolbar-min-height);
      padding: var(--ux-toolbar-padding-y) var(--ux-toolbar-padding-x);
      background-color: var(--ux-surface);
      border-bottom: 1px solid var(--ux-border-color);
    }

    /* ========================================
       Toolbar Variants
    ======================================== */

    /* Translucent */
    .ux-toolbar--translucent {
      background-color: rgba(var(--ux-surface-rgb, 255, 255, 255), 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 0.5px solid rgba(0, 0, 0, 0.1);
    }

    /* Glass (iOS 26 Liquid Glass) */
    /* Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js */
    .ux-toolbar--glass {
      box-shadow: var(--ux-glass-highlight);
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    .ux-toolbar--glass.ux-toolbar--border-top {
      border-bottom: none;
      border-top: 0.5px solid var(--ux-glass-border);
    }

    /* Transparent */
    .ux-toolbar--transparent {
      background-color: transparent;
      border-bottom: none;
    }

    /* No border */
    .ux-toolbar--no-border {
      border-bottom: none;
    }

    /* Border top (for footer toolbars) */
    .ux-toolbar--border-top {
      border-bottom: none;
      border-top: 1px solid var(--ux-border-color);
    }

    /* Colored */
    .ux-toolbar--primary {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    .ux-toolbar--secondary {
      background-color: var(--ux-secondary);
      color: var(--ux-secondary-contrast);
    }

    .ux-toolbar--dark {
      background-color: var(--ux-dark);
      color: var(--ux-dark-contrast);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    .ux-toolbar--light {
      background-color: var(--ux-light);
      color: var(--ux-text);
    }

    /* ========================================
       Toolbar Layout
    ======================================== */

    .ux-toolbar__start {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    .ux-toolbar__center {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 var(--ux-space-sm);
    }

    .ux-toolbar__end {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
    }

    /* Spread layout */
    .ux-toolbar--spread {
      justify-content: space-between;
    }

    .ux-toolbar--spread .ux-toolbar__center {
      flex: 0;
    }

    /* ========================================
       Toolbar Buttons
    ======================================== */

    .ux-toolbar__button {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 44px;
      min-height: 44px;
      padding: var(--ux-space-xs);
      background: none;
      border: none;
      color: var(--ux-primary);
      cursor: pointer;
      border-radius: var(--ux-border-radius);
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-toolbar__button:hover {
      background-color: rgba(var(--ux-primary-rgb), 0.1);
    }

    .ux-toolbar__button:active {
      opacity: 0.7;
    }

    .ux-toolbar__button:disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    .ux-toolbar__button-icon {
      width: 24px;
      height: 24px;
    }

    .ux-toolbar__button-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-toolbar__button-text {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      padding: 0 var(--ux-space-xs);
    }

    /* Button with badge */
    .ux-toolbar__button--badge {
      position: relative;
    }

    .ux-toolbar__button-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      min-width: 16px;
      height: 16px;
      padding: 0 4px;
      background-color: var(--ux-danger);
      color: white;
      font-size: 10px;
      font-weight: 600;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Primary button colors for colored toolbars */
    .ux-toolbar--primary .ux-toolbar__button,
    .ux-toolbar--dark .ux-toolbar__button {
      color: inherit;
    }

    .ux-toolbar--primary .ux-toolbar__button:hover,
    .ux-toolbar--dark .ux-toolbar__button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* ========================================
       Toolbar Title
    ======================================== */

    .ux-toolbar__title {
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-toolbar--primary .ux-toolbar__title,
    .ux-toolbar--dark .ux-toolbar__title {
      color: inherit;
    }

    /* ========================================
       Toolbar Text
    ======================================== */

    .ux-toolbar__text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    /* ========================================
       Toolbar Spacer
    ======================================== */

    .ux-toolbar__spacer {
      flex: 1;
    }

    /* ========================================
       Toolbar Divider
    ======================================== */

    .ux-toolbar__divider {
      width: 1px;
      height: 24px;
      background-color: var(--ux-border-color);
      margin: 0 var(--ux-space-sm);
    }

    .ux-toolbar--primary .ux-toolbar__divider,
    .ux-toolbar--dark .ux-toolbar__divider {
      background-color: rgba(255, 255, 255, 0.2);
    }

    /* ========================================
       Toolbar Group
    ======================================== */

    .ux-toolbar__group {
      display: flex;
      align-items: center;
      background-color: var(--ux-surface-secondary);
      border-radius: var(--ux-border-radius);
      padding: 2px;
    }

    .ux-toolbar__group .ux-toolbar__button {
      min-width: 36px;
      min-height: 36px;
      border-radius: calc(var(--ux-border-radius) - 2px);
    }

    .ux-toolbar__group .ux-toolbar__button:hover {
      background-color: var(--ux-light);
    }

    .ux-toolbar__group .ux-toolbar__button--active {
      background-color: var(--ux-surface);
      box-shadow: var(--ux-shadow-sm);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-toolbar--sm {
      min-height: 36px;
      padding: var(--ux-space-xs) var(--ux-space-sm);
    }

    .ux-toolbar--sm .ux-toolbar__button {
      min-width: 36px;
      min-height: 36px;
    }

    .ux-toolbar--sm .ux-toolbar__button-icon {
      width: 20px;
      height: 20px;
    }

    .ux-toolbar--lg {
      min-height: 56px;
      padding: var(--ux-space-md) var(--ux-space-lg);
    }

    /* ========================================
       Fixed Position
       Glass effect by default (iOS style)
    ======================================== */

    .ux-toolbar--fixed-top {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      /* Glass by default */
      background-color: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    .ux-toolbar--fixed-bottom {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 100;
      /* Glass by default */
      background-color: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-top: 0.5px solid var(--ux-glass-border);
      border-bottom: none;
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not (backdrop-filter: blur(1px)) {
      .ux-toolbar--fixed-top,
      .ux-toolbar--fixed-bottom {
        background-color: var(--ux-surface);
      }
    }

    /* Safe area for bottom toolbar */
    .ux-toolbar--safe-area-bottom {
      padding-bottom: calc(var(--ux-space-sm) + env(safe-area-inset-bottom));
    }

    /* ========================================
       Footer Toolbar
    ======================================== */

    .ux-toolbar--footer {
      border-top: 1px solid var(--ux-border-color);
      border-bottom: none;
      padding-bottom: calc(var(--ux-space-sm) + env(safe-area-inset-bottom));
    }

    /* ========================================
       Keyboard Toolbar (for inputs)
    ======================================== */

    .ux-keyboard-toolbar {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      min-height: 44px;
      padding: var(--ux-space-xs) var(--ux-space-md);
      background-color: var(--ux-surface-secondary);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-keyboard-toolbar__button {
      padding: var(--ux-space-sm) var(--ux-space-md);
      background: none;
      border: none;
      color: var(--ux-primary);
      font-size: var(--ux-font-size-md);
      font-weight: 600;
      cursor: pointer;
    }

    .ux-keyboard-toolbar__button:active {
      opacity: 0.7;
    }

    /* ========================================
       Action Toolbar (bottom actions)
    ======================================== */

    .ux-action-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-around;
      min-height: 49px;
      background-color: var(--ux-surface);
      border-top: 1px solid var(--ux-border-color);
    }

    .ux-action-toolbar__item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      padding: var(--ux-space-sm);
      background: none;
      border: none;
      color: var(--ux-primary);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-action-toolbar__item:active {
      opacity: 0.7;
    }

    .ux-action-toolbar__icon {
      width: 24px;
      height: 24px;
    }

    .ux-action-toolbar__icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-action-toolbar__label {
      font-size: 10px;
      margin-top: 2px;
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-toolbar-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-toolbar-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }
})();

/**
 * UX Tooltip Component
 * Tooltips estilo iOS/macOS para hints en hover
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Tooltip
    ======================================== */

    .ux-tooltip {
      position: relative;
      display: inline-flex;
    }

    .ux-tooltip__content {
      position: absolute;
      z-index: var(--ux-z-tooltip);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      background-color: var(--ux-dark);
      color: white;
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      line-height: 1.4;
      border-radius: var(--ux-border-radius-sm);
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-transition-fast) var(--ux-ease),
        visibility var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* Arrow */
    .ux-tooltip__content::before {
      content: '';
      position: absolute;
      width: 0;
      height: 0;
      border: 6px solid transparent;
    }

    /* Show on hover/focus */
    .ux-tooltip:hover .ux-tooltip__content,
    .ux-tooltip:focus-within .ux-tooltip__content,
    .ux-tooltip--open .ux-tooltip__content {
      opacity: 1;
      visibility: visible;
    }

    /* ========================================
       Positions
    ======================================== */

    /* Top (default) */
    .ux-tooltip__content,
    .ux-tooltip--top .ux-tooltip__content {
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(-8px);
    }

    .ux-tooltip:hover .ux-tooltip__content,
    .ux-tooltip:focus-within .ux-tooltip__content,
    .ux-tooltip--open .ux-tooltip__content,
    .ux-tooltip--top:hover .ux-tooltip__content,
    .ux-tooltip--top:focus-within .ux-tooltip__content,
    .ux-tooltip--top.ux-tooltip--open .ux-tooltip__content {
      transform: translateX(-50%) translateY(-4px);
    }

    .ux-tooltip__content::before,
    .ux-tooltip--top .ux-tooltip__content::before {
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-top-color: var(--ux-dark);
    }

    /* Bottom */
    .ux-tooltip--bottom .ux-tooltip__content {
      top: 100%;
      bottom: auto;
      left: 50%;
      transform: translateX(-50%) translateY(8px);
    }

    .ux-tooltip--bottom:hover .ux-tooltip__content,
    .ux-tooltip--bottom:focus-within .ux-tooltip__content,
    .ux-tooltip--bottom.ux-tooltip--open .ux-tooltip__content {
      transform: translateX(-50%) translateY(4px);
    }

    .ux-tooltip--bottom .ux-tooltip__content::before {
      top: auto;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-top-color: transparent;
      border-bottom-color: var(--ux-dark);
    }

    /* Left */
    .ux-tooltip--left .ux-tooltip__content {
      top: 50%;
      right: 100%;
      bottom: auto;
      left: auto;
      transform: translateY(-50%) translateX(-8px);
    }

    .ux-tooltip--left:hover .ux-tooltip__content,
    .ux-tooltip--left:focus-within .ux-tooltip__content,
    .ux-tooltip--left.ux-tooltip--open .ux-tooltip__content {
      transform: translateY(-50%) translateX(-4px);
    }

    .ux-tooltip--left .ux-tooltip__content::before {
      top: 50%;
      right: auto;
      left: 100%;
      transform: translateY(-50%);
      border-top-color: transparent;
      border-left-color: var(--ux-dark);
    }

    /* Right */
    .ux-tooltip--right .ux-tooltip__content {
      top: 50%;
      left: 100%;
      bottom: auto;
      right: auto;
      transform: translateY(-50%) translateX(8px);
    }

    .ux-tooltip--right:hover .ux-tooltip__content,
    .ux-tooltip--right:focus-within .ux-tooltip__content,
    .ux-tooltip--right.ux-tooltip--open .ux-tooltip__content {
      transform: translateY(-50%) translateX(4px);
    }

    .ux-tooltip--right .ux-tooltip__content::before {
      top: 50%;
      left: auto;
      right: 100%;
      transform: translateY(-50%);
      border-top-color: transparent;
      border-right-color: var(--ux-dark);
    }

    /* ========================================
       Variants
    ======================================== */

    /* Light variant */
    .ux-tooltip--light .ux-tooltip__content {
      background-color: var(--ux-surface);
      color: var(--ux-text);
      border: 1px solid var(--ux-border-color);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }

    .ux-tooltip--light .ux-tooltip__content::before,
    .ux-tooltip--light.ux-tooltip--top .ux-tooltip__content::before {
      border-top-color: var(--ux-surface);
    }

    .ux-tooltip--light.ux-tooltip--bottom .ux-tooltip__content::before {
      border-top-color: transparent;
      border-bottom-color: var(--ux-surface);
    }

    .ux-tooltip--light.ux-tooltip--left .ux-tooltip__content::before {
      border-top-color: transparent;
      border-left-color: var(--ux-surface);
    }

    .ux-tooltip--light.ux-tooltip--right .ux-tooltip__content::before {
      border-top-color: transparent;
      border-right-color: var(--ux-surface);
    }

    /* Primary variant */
    .ux-tooltip--primary .ux-tooltip__content {
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
    }

    .ux-tooltip--primary .ux-tooltip__content::before,
    .ux-tooltip--primary.ux-tooltip--top .ux-tooltip__content::before {
      border-top-color: var(--ux-primary);
    }

    .ux-tooltip--primary.ux-tooltip--bottom .ux-tooltip__content::before {
      border-top-color: transparent;
      border-bottom-color: var(--ux-primary);
    }

    .ux-tooltip--primary.ux-tooltip--left .ux-tooltip__content::before {
      border-top-color: transparent;
      border-left-color: var(--ux-primary);
    }

    .ux-tooltip--primary.ux-tooltip--right .ux-tooltip__content::before {
      border-top-color: transparent;
      border-right-color: var(--ux-primary);
    }

    /* ========================================
       Sizes
    ======================================== */

    .ux-tooltip--sm .ux-tooltip__content {
      padding: 4px 8px;
      font-size: var(--ux-font-size-xs);
    }

    .ux-tooltip--lg .ux-tooltip__content {
      padding: var(--ux-space-sm) var(--ux-space-md);
      font-size: var(--ux-font-size-md);
    }

    /* ========================================
       Multi-line / Rich Content
    ======================================== */

    .ux-tooltip--multiline .ux-tooltip__content {
      white-space: normal;
      max-width: 250px;
      text-align: center;
    }

    .ux-tooltip--rich .ux-tooltip__content {
      white-space: normal;
      max-width: 300px;
      text-align: left;
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    .ux-tooltip__title {
      font-weight: 600;
      margin-bottom: var(--ux-space-xs);
    }

    .ux-tooltip__description {
      font-weight: 400;
      opacity: 0.9;
    }

    /* ========================================
       Delay Variants
    ======================================== */

    .ux-tooltip--delay-short:hover .ux-tooltip__content {
      transition-delay: 200ms;
    }

    .ux-tooltip--delay:hover .ux-tooltip__content {
      transition-delay: 500ms;
    }

    .ux-tooltip--delay-long:hover .ux-tooltip__content {
      transition-delay: 1000ms;
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-tooltip--glass .ux-tooltip__content {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      color: var(--ux-text);
    }

    .ux-tooltip--glass .ux-tooltip__content::before {
      display: none;
    }

    /* ========================================
       Touch Device Handling
    ======================================== */

    @media (hover: none) {
      /* On touch devices, show tooltip only when .ux-tooltip--open is added */
      .ux-tooltip:hover .ux-tooltip__content {
        opacity: 0;
        visibility: hidden;
      }

      .ux-tooltip--open .ux-tooltip__content {
        opacity: 1;
        visibility: visible;
      }
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-tooltip__content {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-tooltip-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-tooltip-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for programmatic tooltip control
  const tooltipComponent = (config = {}) => ({
    isOpen: config.open || false,
    delay: config.delay || 0,
    _timeout: null,

    show() {
      if (this.delay > 0) {
        this._timeout = setTimeout(() => {
          this.isOpen = true;
        }, this.delay);
      } else {
        this.isOpen = true;
      }
    },

    hide() {
      if (this._timeout) {
        clearTimeout(this._timeout);
        this._timeout = null;
      }
      this.isOpen = false;
    },

    toggle() {
      if (this.isOpen) {
        this.hide();
      } else {
        this.show();
      }
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxTooltip', tooltipComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxTooltip', tooltipComponent);
    });
  }
})();

/**
 * UX Tree View Component
 * Hierarchical expandable/collapsible tree structure
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Tree View
       ========================================================================== */

    .ux-tree {
      font-family: var(--ux-font-family);
      font-size: var(--ux-font-size-md);
      color: var(--ux-text);
      user-select: none;
    }

    .ux-tree__list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .ux-tree__list--nested {
      padding-left: var(--ux-space-lg);
    }

    /* ==========================================================================
       Tree Node
       ========================================================================== */

    .ux-tree__node {
      margin: 0;
      padding: 0;
    }

    .ux-tree__item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: background var(--ux-transition-fast) var(--ux-ease-out);
    }

    .ux-tree__item:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-tree__item:active {
      background: var(--ux-surface-tertiary);
    }

    .ux-tree__item--selected {
      background: var(--ux-primary-tint);
      color: var(--ux-primary);
    }

    .ux-tree__item--selected:hover {
      background: var(--ux-primary-tint);
    }

    /* ==========================================================================
       Toggle Arrow
       ========================================================================== */

    .ux-tree__toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      color: var(--ux-text-tertiary);
      transition: transform var(--ux-transition-fast) var(--ux-ease-out);
    }

    .ux-tree__toggle svg {
      width: 14px;
      height: 14px;
    }

    .ux-tree__toggle--expanded {
      transform: rotate(90deg);
    }

    .ux-tree__toggle--empty {
      visibility: hidden;
    }

    /* ==========================================================================
       Checkbox (for selectable trees)
       ========================================================================== */

    .ux-tree__checkbox {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      border: 2px solid var(--ux-border-color);
      border-radius: var(--ux-radius-sm);
      background: var(--ux-surface);
      color: transparent;
      transition: all var(--ux-transition-fast) var(--ux-ease-out);
    }

    .ux-tree__checkbox svg {
      width: 12px;
      height: 12px;
    }

    .ux-tree__checkbox--checked {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
      color: white;
    }

    .ux-tree__checkbox--indeterminate {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
      color: white;
    }

    .ux-tree__checkbox--indeterminate svg {
      display: none;
    }

    .ux-tree__checkbox--indeterminate::after {
      content: '';
      width: 8px;
      height: 2px;
      background: white;
      border-radius: 1px;
    }

    /* ==========================================================================
       Icon
       ========================================================================== */

    .ux-tree__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      color: var(--ux-text-secondary);
    }

    .ux-tree__icon svg {
      width: 16px;
      height: 16px;
    }

    .ux-tree__icon--folder {
      color: var(--ux-warning);
    }

    .ux-tree__icon--file {
      color: var(--ux-text-tertiary);
    }

    /* ==========================================================================
       Label
       ========================================================================== */

    .ux-tree__label {
      flex: 1;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      line-height: 1.4;
    }

    .ux-tree__label--editable {
      padding: 2px 4px;
      margin: -2px -4px;
      border-radius: var(--ux-radius-sm);
      outline: none;
    }

    .ux-tree__label--editable:focus {
      background: var(--ux-surface);
      box-shadow: 0 0 0 2px var(--ux-primary);
    }

    /* ==========================================================================
       Badge / Count
       ========================================================================== */

    .ux-tree__badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 18px;
      height: 18px;
      padding: 0 6px;
      font-size: var(--ux-font-size-xs);
      font-weight: 600;
      background: var(--ux-surface-tertiary);
      color: var(--ux-text-secondary);
      border-radius: 9px;
      flex-shrink: 0;
    }

    .ux-tree__badge--primary {
      background: var(--ux-primary-tint);
      color: var(--ux-primary);
    }

    /* ==========================================================================
       Actions
       ========================================================================== */

    .ux-tree__actions {
      display: flex;
      align-items: center;
      gap: 2px;
      opacity: 0;
      transition: opacity var(--ux-transition-fast);
    }

    .ux-tree__item:hover .ux-tree__actions {
      opacity: 1;
    }

    .ux-tree__action {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: var(--ux-radius-sm);
      color: var(--ux-text-tertiary);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all var(--ux-transition-fast);
    }

    .ux-tree__action:hover {
      background: var(--ux-surface-tertiary);
      color: var(--ux-text);
    }

    .ux-tree__action svg {
      width: 14px;
      height: 14px;
    }

    /* ==========================================================================
       Loading State
       ========================================================================== */

    .ux-tree__loading {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm);
      padding: var(--ux-space-xs) var(--ux-space-sm);
      padding-left: calc(var(--ux-space-lg) + var(--ux-space-sm));
      color: var(--ux-text-tertiary);
      font-size: var(--ux-font-size-sm);
    }

    .ux-tree__loading-spinner {
      width: 14px;
      height: 14px;
      border: 2px solid var(--ux-border-color);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-tree-spin 0.8s linear infinite;
    }

    @keyframes ux-tree-spin {
      to { transform: rotate(360deg); }
    }

    /* ==========================================================================
       Empty State
       ========================================================================== */

    .ux-tree__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-xl);
      color: var(--ux-text-tertiary);
      text-align: center;
    }

    .ux-tree__empty-icon {
      width: 48px;
      height: 48px;
      margin-bottom: var(--ux-space-md);
      opacity: 0.5;
    }

    /* ==========================================================================
       Drag & Drop
       ========================================================================== */

    .ux-tree__item--dragging {
      opacity: 0.5;
    }

    .ux-tree__item--drag-over {
      background: var(--ux-primary-tint);
      outline: 2px dashed var(--ux-primary);
      outline-offset: -2px;
    }

    .ux-tree__drop-indicator {
      height: 2px;
      background: var(--ux-primary);
      margin: 0 var(--ux-space-sm);
      border-radius: 1px;
    }

    /* ==========================================================================
       Size Variants
       ========================================================================== */

    .ux-tree--sm {
      font-size: var(--ux-font-size-sm);
    }

    .ux-tree--sm .ux-tree__item {
      padding: 2px var(--ux-space-xs);
    }

    .ux-tree--sm .ux-tree__toggle,
    .ux-tree--sm .ux-tree__icon {
      width: 16px;
      height: 16px;
    }

    .ux-tree--sm .ux-tree__toggle svg,
    .ux-tree--sm .ux-tree__icon svg {
      width: 12px;
      height: 12px;
    }

    .ux-tree--sm .ux-tree__list--nested {
      padding-left: var(--ux-space-md);
    }

    .ux-tree--lg {
      font-size: var(--ux-font-size-lg);
    }

    .ux-tree--lg .ux-tree__item {
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    .ux-tree--lg .ux-tree__toggle,
    .ux-tree--lg .ux-tree__icon {
      width: 24px;
      height: 24px;
    }

    .ux-tree--lg .ux-tree__toggle svg,
    .ux-tree--lg .ux-tree__icon svg {
      width: 20px;
      height: 20px;
    }

    /* ==========================================================================
       Lines Variant
       ========================================================================== */

    .ux-tree--lines .ux-tree__list--nested {
      position: relative;
      margin-left: 10px;
      padding-left: var(--ux-space-md);
    }

    .ux-tree--lines .ux-tree__list--nested::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: var(--ux-space-md);
      width: 1px;
      background: var(--ux-border-color);
    }

    .ux-tree--lines .ux-tree__node {
      position: relative;
    }

    .ux-tree--lines .ux-tree__list--nested > .ux-tree__node::before {
      content: '';
      position: absolute;
      top: 14px;
      left: calc(-1 * var(--ux-space-md));
      width: var(--ux-space-sm);
      height: 1px;
      background: var(--ux-border-color);
    }

    /* ==========================================================================
       Bordered Variant
       ========================================================================== */

    .ux-tree--bordered {
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-lg);
      padding: var(--ux-space-sm);
    }

    /* ==========================================================================
       Glass Variant
       ========================================================================== */

    .ux-tree--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border: 1px solid var(--ux-glass-border);
      border-radius: var(--ux-radius-lg);
      padding: var(--ux-space-sm);
    }

    .ux-tree--glass .ux-tree__item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .ux-tree--glass .ux-tree__item--selected {
      background: rgba(var(--ux-primary-rgb), 0.2);
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      .ux-tree--glass .ux-tree__item:hover {
        background: rgba(255, 255, 255, 0.05);
      }
    }

    .ux-dark .ux-tree--glass .ux-tree__item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-tree__toggle,
      .ux-tree__item,
      .ux-tree__checkbox,
      .ux-tree__actions {
        transition: none;
      }

      .ux-tree__loading-spinner {
        animation: none;
      }
    }
  `;

  // Icons
  const icons = {
    chevron: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>`,
    folder: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 7c0-1.1.9-2 2-2h4l2 2h8c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V7z"/></svg>`,
    folderOpen: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M5 5c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2h-7l-2-2H5z"/><path d="M3 12h18v5c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2v-5z" opacity="0.3"/></svg>`,
    file: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>`,
    check: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`,
    plus: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`,
    edit: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`,
    trash: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`,
    empty: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>`
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-tree-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-tree-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const treeData = (options = {}) => ({
    // Configuration
    data: options.data || [],
    selectable: options.selectable ?? false,
    multiSelect: options.multiSelect ?? false,
    checkable: options.checkable ?? false,
    editable: options.editable ?? false,
    draggable: options.draggable ?? false,
    showIcons: options.showIcons ?? true,
    showActions: options.showActions ?? false,
    expandOnClick: options.expandOnClick ?? true,
    lazyLoad: options.lazyLoad ?? false,
    loadChildren: options.loadChildren || null,

    // State
    expandedNodes: new Set(options.expanded || []),
    selectedNodes: new Set(options.selected || []),
    checkedNodes: new Set(options.checked || []),
    loadingNodes: new Set(),
    editingNode: null,
    draggedNode: null,
    dragOverNode: null,

    // Icons
    icons: icons,

    // Lifecycle
    init() {
      // Auto-expand to selected nodes
      if (this.selectedNodes.size > 0) {
        this.expandToNodes([...this.selectedNodes]);
      }
    },

    // Toggle node expansion
    toggle(nodeId) {
      if (this.expandedNodes.has(nodeId)) {
        this.collapse(nodeId);
      } else {
        this.expand(nodeId);
      }
    },

    // Expand node
    async expand(nodeId) {
      const node = this.findNode(nodeId);
      if (!node) return;

      // Lazy load children if needed
      if (this.lazyLoad && this.loadChildren && !node.childrenLoaded) {
        this.loadingNodes.add(nodeId);
        try {
          const children = await this.loadChildren(node);
          node.children = children;
          node.childrenLoaded = true;
        } catch (error) {
          console.error('Failed to load children:', error);
          this.$dispatch('tree:load-error', { nodeId, error });
        } finally {
          this.loadingNodes.delete(nodeId);
        }
      }

      this.expandedNodes.add(nodeId);
      this.$dispatch('tree:expand', { nodeId, node });
    },

    // Collapse node
    collapse(nodeId) {
      this.expandedNodes.delete(nodeId);
      this.$dispatch('tree:collapse', { nodeId });
    },

    // Expand all nodes
    expandAll() {
      const expandRecursive = (nodes) => {
        nodes.forEach(node => {
          if (node.children && node.children.length > 0) {
            this.expandedNodes.add(node.id);
            expandRecursive(node.children);
          }
        });
      };
      expandRecursive(this.data);
      this.$dispatch('tree:expand-all');
    },

    // Collapse all nodes
    collapseAll() {
      this.expandedNodes.clear();
      this.$dispatch('tree:collapse-all');
    },

    // Select node
    select(nodeId) {
      const node = this.findNode(nodeId);
      if (!node) return;

      if (!this.multiSelect) {
        this.selectedNodes.clear();
      }

      if (this.selectedNodes.has(nodeId)) {
        this.selectedNodes.delete(nodeId);
      } else {
        this.selectedNodes.add(nodeId);
      }

      this.$dispatch('tree:select', {
        nodeId,
        node,
        selected: [...this.selectedNodes]
      });
    },

    // Check node (with checkbox)
    check(nodeId, checked = null) {
      const node = this.findNode(nodeId);
      if (!node) return;

      const isChecked = checked !== null ? checked : !this.checkedNodes.has(nodeId);

      if (isChecked) {
        this.checkedNodes.add(nodeId);
        // Check all children
        if (node.children) {
          this.checkAllChildren(node, true);
        }
      } else {
        this.checkedNodes.delete(nodeId);
        // Uncheck all children
        if (node.children) {
          this.checkAllChildren(node, false);
        }
      }

      // Update parent states
      this.updateParentCheckState(nodeId);

      this.$dispatch('tree:check', {
        nodeId,
        node,
        checked: isChecked,
        checkedNodes: [...this.checkedNodes]
      });
    },

    // Check/uncheck all children recursively
    checkAllChildren(node, checked) {
      if (!node.children) return;
      node.children.forEach(child => {
        if (checked) {
          this.checkedNodes.add(child.id);
        } else {
          this.checkedNodes.delete(child.id);
        }
        this.checkAllChildren(child, checked);
      });
    },

    // Update parent check state (for indeterminate)
    updateParentCheckState(nodeId) {
      const parent = this.findParent(nodeId);
      if (!parent) return;

      const allChecked = parent.children.every(child => this.checkedNodes.has(child.id));
      const someChecked = parent.children.some(child =>
        this.checkedNodes.has(child.id) || this.isIndeterminate(child.id)
      );

      if (allChecked) {
        this.checkedNodes.add(parent.id);
      } else {
        this.checkedNodes.delete(parent.id);
      }

      // Continue up the tree
      this.updateParentCheckState(parent.id);
    },

    // Check if node is indeterminate
    isIndeterminate(nodeId) {
      const node = this.findNode(nodeId);
      if (!node || !node.children || node.children.length === 0) return false;

      const checkedCount = node.children.filter(child =>
        this.checkedNodes.has(child.id)
      ).length;

      return checkedCount > 0 && checkedCount < node.children.length;
    },

    // Get checkbox state
    getCheckState(nodeId) {
      if (this.checkedNodes.has(nodeId)) return 'checked';
      if (this.isIndeterminate(nodeId)) return 'indeterminate';
      return 'unchecked';
    },

    // Find node by ID
    findNode(nodeId, nodes = this.data) {
      for (const node of nodes) {
        if (node.id === nodeId) return node;
        if (node.children) {
          const found = this.findNode(nodeId, node.children);
          if (found) return found;
        }
      }
      return null;
    },

    // Find parent of node
    findParent(nodeId, nodes = this.data, parent = null) {
      for (const node of nodes) {
        if (node.id === nodeId) return parent;
        if (node.children) {
          const found = this.findParent(nodeId, node.children, node);
          if (found) return found;
        }
      }
      return null;
    },

    // Expand to show specific nodes
    expandToNodes(nodeIds) {
      nodeIds.forEach(nodeId => {
        let parent = this.findParent(nodeId);
        while (parent) {
          this.expandedNodes.add(parent.id);
          parent = this.findParent(parent.id);
        }
      });
    },

    // Start editing node
    startEdit(nodeId) {
      if (!this.editable) return;
      this.editingNode = nodeId;
      this.$nextTick(() => {
        const input = this.$el.querySelector(`[data-node-id="${nodeId}"] .ux-tree__label--editable`);
        if (input) {
          input.focus();
          // Select all text
          const range = document.createRange();
          range.selectNodeContents(input);
          const sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
        }
      });
    },

    // Finish editing node
    finishEdit(nodeId, newLabel) {
      const node = this.findNode(nodeId);
      if (node && newLabel.trim()) {
        const oldLabel = node.label;
        node.label = newLabel.trim();
        this.$dispatch('tree:rename', { nodeId, node, oldLabel, newLabel: node.label });
      }
      this.editingNode = null;
    },

    // Cancel editing
    cancelEdit() {
      this.editingNode = null;
    },

    // Handle item click
    handleClick(nodeId, node, event) {
      if (this.selectable) {
        this.select(nodeId);
      }

      if (this.expandOnClick && node.children && node.children.length > 0) {
        this.toggle(nodeId);
      }

      this.$dispatch('tree:click', { nodeId, node, event });
    },

    // Handle double click
    handleDoubleClick(nodeId, node, event) {
      if (this.editable) {
        this.startEdit(nodeId);
      }
      this.$dispatch('tree:dblclick', { nodeId, node, event });
    },

    // Drag & Drop handlers
    handleDragStart(nodeId, event) {
      if (!this.draggable) return;
      this.draggedNode = nodeId;
      event.dataTransfer.effectAllowed = 'move';
      event.dataTransfer.setData('text/plain', nodeId);
    },

    handleDragOver(nodeId, event) {
      if (!this.draggable || !this.draggedNode) return;
      if (nodeId === this.draggedNode) return;

      event.preventDefault();
      event.dataTransfer.dropEffect = 'move';
      this.dragOverNode = nodeId;
    },

    handleDragLeave(nodeId) {
      if (this.dragOverNode === nodeId) {
        this.dragOverNode = null;
      }
    },

    handleDrop(nodeId, event) {
      if (!this.draggable || !this.draggedNode) return;
      event.preventDefault();

      const draggedNode = this.findNode(this.draggedNode);
      const targetNode = this.findNode(nodeId);

      if (draggedNode && targetNode && this.draggedNode !== nodeId) {
        // Check if target is not a descendant of dragged
        if (!this.isDescendant(this.draggedNode, nodeId)) {
          this.$dispatch('tree:drop', {
            draggedNodeId: this.draggedNode,
            targetNodeId: nodeId,
            draggedNode,
            targetNode
          });
        }
      }

      this.draggedNode = null;
      this.dragOverNode = null;
    },

    handleDragEnd() {
      this.draggedNode = null;
      this.dragOverNode = null;
    },

    // Check if nodeId is descendant of parentId
    isDescendant(parentId, nodeId) {
      const parent = this.findNode(parentId);
      if (!parent || !parent.children) return false;

      for (const child of parent.children) {
        if (child.id === nodeId) return true;
        if (this.isDescendant(child.id, nodeId)) return true;
      }
      return false;
    },

    // Actions
    addNode(parentId = null, newNode) {
      const parent = parentId ? this.findNode(parentId) : null;
      if (parent) {
        if (!parent.children) parent.children = [];
        parent.children.push(newNode);
        this.expandedNodes.add(parentId);
      } else {
        this.data.push(newNode);
      }
      this.$dispatch('tree:add', { parentId, node: newNode });
    },

    removeNode(nodeId) {
      const removeFromList = (nodes) => {
        const index = nodes.findIndex(n => n.id === nodeId);
        if (index !== -1) {
          nodes.splice(index, 1);
          return true;
        }
        for (const node of nodes) {
          if (node.children && removeFromList(node.children)) {
            return true;
          }
        }
        return false;
      };

      const node = this.findNode(nodeId);
      if (removeFromList(this.data)) {
        this.selectedNodes.delete(nodeId);
        this.checkedNodes.delete(nodeId);
        this.expandedNodes.delete(nodeId);
        this.$dispatch('tree:remove', { nodeId, node });
      }
    },

    // Get selected nodes data
    getSelected() {
      return [...this.selectedNodes].map(id => this.findNode(id)).filter(Boolean);
    },

    // Get checked nodes data
    getChecked() {
      return [...this.checkedNodes].map(id => this.findNode(id)).filter(Boolean);
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxTree', treeData);
  }

  // Expose icons for external use
  window.UX = window.UX || {};
  window.UX.treeIcons = icons;
})();

/**
 * UX Upload Component
 * File upload con drag & drop, preview y progress
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Upload
    ======================================== */

    .ux-upload {
      position: relative;
      width: 100%;
    }

    /* ========================================
       Dropzone
    ======================================== */

    .ux-upload__dropzone {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 200px;
      padding: var(--ux-space-xl);
      background-color: var(--ux-surface);
      border: 2px dashed var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      cursor: pointer;
      transition:
        border-color var(--ux-transition-fast) var(--ux-ease),
        background-color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-upload__dropzone:hover {
      border-color: var(--ux-primary);
      background-color: rgba(var(--ux-primary-rgb), 0.02);
    }

    /* Drag over state */
    .ux-upload__dropzone--dragover,
    .ux-upload--dragover .ux-upload__dropzone {
      border-color: var(--ux-primary);
      background-color: rgba(var(--ux-primary-rgb), 0.05);
      border-style: solid;
    }

    /* Disabled state */
    .ux-upload__dropzone--disabled,
    .ux-upload--disabled .ux-upload__dropzone {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Hidden file input */
    .ux-upload__input {
      position: absolute;
      width: 0;
      height: 0;
      opacity: 0;
      pointer-events: none;
    }

    /* ========================================
       Dropzone Content
    ======================================== */

    .ux-upload__icon {
      width: 48px;
      height: 48px;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-text-secondary);
      transition: color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-upload__dropzone:hover .ux-upload__icon,
    .ux-upload__dropzone--dragover .ux-upload__icon {
      color: var(--ux-primary);
    }

    .ux-upload__text {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
      margin-bottom: var(--ux-space-xs);
      text-align: center;
    }

    .ux-upload__hint {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      text-align: center;
    }

    .ux-upload__browse {
      color: var(--ux-primary);
      font-weight: 500;
      cursor: pointer;
    }

    .ux-upload__browse:hover {
      text-decoration: underline;
    }

    /* ========================================
       Compact Variant
    ======================================== */

    .ux-upload--compact .ux-upload__dropzone {
      min-height: auto;
      flex-direction: row;
      padding: var(--ux-space-md) var(--ux-space-lg);
      gap: var(--ux-space-md);
    }

    .ux-upload--compact .ux-upload__icon {
      width: 24px;
      height: 24px;
      margin-bottom: 0;
    }

    .ux-upload--compact .ux-upload__content {
      text-align: left;
    }

    .ux-upload--compact .ux-upload__text {
      margin-bottom: 0;
    }

    /* ========================================
       Button Variant
    ======================================== */

    .ux-upload--button .ux-upload__dropzone {
      display: inline-flex;
      flex-direction: row;
      min-height: auto;
      padding: var(--ux-space-sm) var(--ux-space-lg);
      border: none;
      background-color: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-radius: var(--ux-border-radius-md);
      gap: var(--ux-space-sm);
    }

    .ux-upload--button .ux-upload__dropzone:hover {
      background-color: var(--ux-primary-shade);
    }

    .ux-upload--button .ux-upload__icon {
      width: 20px;
      height: 20px;
      margin-bottom: 0;
      color: currentColor;
    }

    .ux-upload--button .ux-upload__text {
      color: currentColor;
      margin-bottom: 0;
    }

    .ux-upload--button .ux-upload__hint {
      display: none;
    }

    /* ========================================
       File List
    ======================================== */

    .ux-upload__files {
      margin-top: var(--ux-space-md);
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-upload__file {
      display: flex;
      align-items: center;
      padding: var(--ux-space-sm) var(--ux-space-md);
      background-color: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-md);
      gap: var(--ux-space-md);
    }

    .ux-upload__file--error {
      border-color: var(--ux-danger);
      background-color: rgba(var(--ux-danger-rgb), 0.05);
    }

    .ux-upload__file--success {
      border-color: var(--ux-success);
    }

    /* File Preview */
    .ux-upload__preview {
      width: 40px;
      height: 40px;
      border-radius: var(--ux-border-radius-sm);
      background-color: var(--ux-surface-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
    }

    .ux-upload__preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .ux-upload__preview-icon {
      width: 24px;
      height: 24px;
      color: var(--ux-text-secondary);
    }

    /* File Info */
    .ux-upload__file-info {
      flex: 1;
      min-width: 0;
    }

    .ux-upload__file-name {
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ux-upload__file-meta {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
      display: flex;
      gap: var(--ux-space-sm);
      margin-top: 2px;
    }

    .ux-upload__file-error {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-danger);
      margin-top: 2px;
    }

    /* File Progress */
    .ux-upload__progress {
      width: 100%;
      height: 4px;
      background-color: var(--ux-border-color);
      border-radius: 2px;
      margin-top: var(--ux-space-xs);
      overflow: hidden;
    }

    .ux-upload__progress-bar {
      height: 100%;
      background-color: var(--ux-primary);
      border-radius: 2px;
      transition: width var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-upload__file--success .ux-upload__progress-bar {
      background-color: var(--ux-success);
    }

    .ux-upload__file--error .ux-upload__progress-bar {
      background-color: var(--ux-danger);
    }

    /* File Actions */
    .ux-upload__file-actions {
      display: flex;
      gap: var(--ux-space-xs);
      flex-shrink: 0;
    }

    .ux-upload__file-action {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: transparent;
      color: var(--ux-text-secondary);
      border-radius: var(--ux-border-radius-sm);
      cursor: pointer;
      transition:
        background-color var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-upload__file-action:hover {
      background-color: var(--ux-surface-secondary);
      color: var(--ux-text);
    }

    .ux-upload__file-action--danger:hover {
      background-color: rgba(var(--ux-danger-rgb), 0.1);
      color: var(--ux-danger);
    }

    .ux-upload__file-action svg {
      width: 18px;
      height: 18px;
    }

    /* ========================================
       Grid Preview
    ======================================== */

    .ux-upload--grid .ux-upload__files {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: var(--ux-space-md);
    }

    .ux-upload--grid .ux-upload__file {
      flex-direction: column;
      padding: var(--ux-space-sm);
      text-align: center;
    }

    .ux-upload--grid .ux-upload__preview {
      width: 80px;
      height: 80px;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-upload--grid .ux-upload__file-info {
      width: 100%;
    }

    .ux-upload--grid .ux-upload__file-meta {
      justify-content: center;
    }

    .ux-upload--grid .ux-upload__file-actions {
      position: absolute;
      top: var(--ux-space-xs);
      right: var(--ux-space-xs);
    }

    .ux-upload--grid .ux-upload__file {
      position: relative;
    }

    /* ========================================
       Avatar Upload
    ======================================== */

    .ux-upload--avatar {
      display: inline-block;
    }

    .ux-upload--avatar .ux-upload__dropzone {
      width: 120px;
      height: 120px;
      min-height: auto;
      border-radius: 50%;
      padding: 0;
      overflow: hidden;
    }

    .ux-upload--avatar .ux-upload__preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .ux-upload--avatar .ux-upload__overlay {
      position: absolute;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-upload--avatar .ux-upload__dropzone:hover .ux-upload__overlay {
      opacity: 1;
    }

    .ux-upload--avatar .ux-upload__overlay-icon {
      width: 32px;
      height: 32px;
      color: white;
    }

    /* ========================================
       Image Upload Button (Simple)
       Usage: Button + Preview side by side
    ======================================== */

    .ux-upload-image {
      display: flex;
      align-items: center;
      gap: var(--ux-space-md);
    }

    .ux-upload-image__preview {
      width: 64px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--ux-surface-secondary);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-glass-radius-sm);
      overflow: hidden;
      flex-shrink: 0;
      transition: border-color 200ms var(--ux-ease-ios);
    }

    .ux-upload-image__preview--rounded {
      border-radius: 50%;
    }

    .ux-upload-image__preview--lg {
      width: 80px;
      height: 80px;
    }

    .ux-upload-image__preview--sm {
      width: 48px;
      height: 48px;
    }

    .ux-upload-image__preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .ux-upload-image__preview svg,
    .ux-upload-image__preview .icon {
      width: 24px;
      height: 24px;
      color: var(--ux-text-tertiary);
    }

    .ux-upload-image__preview--lg svg,
    .ux-upload-image__preview--lg .icon {
      width: 32px;
      height: 32px;
    }

    /* Button with hidden input */
    .ux-upload-image__button {
      position: relative;
      cursor: pointer;
    }

    .ux-upload-image__button input[type="file"] {
      position: absolute;
      width: 0;
      height: 0;
      opacity: 0;
      pointer-events: none;
    }

    /* ========================================
       Upload Area (Drop Zone)
    ======================================== */

    .ux-upload-area {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 180px;
      padding: var(--ux-space-xl);
      background-color: var(--ux-surface);
      border: 2px dashed var(--ux-border-color);
      border-radius: var(--ux-glass-radius-md);
      cursor: pointer;
      text-align: center;
      transition:
        border-color 200ms var(--ux-ease-ios),
        background-color 200ms var(--ux-ease-ios);
    }

    .ux-upload-area:hover {
      border-color: var(--ux-primary);
      background-color: rgba(var(--ux-primary-rgb), 0.02);
    }

    .ux-upload-area--dragover {
      border-color: var(--ux-primary);
      background-color: rgba(var(--ux-primary-rgb), 0.05);
      border-style: solid;
    }

    .ux-upload-area--sm {
      min-height: 120px;
      padding: var(--ux-space-lg);
    }

    .ux-upload-area--lg {
      min-height: 240px;
      padding: var(--ux-space-2xl);
    }

    .ux-upload-area__icon {
      width: 48px;
      height: 48px;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-text-tertiary);
      transition: color 200ms var(--ux-ease-ios);
    }

    .ux-upload-area:hover .ux-upload-area__icon,
    .ux-upload-area--dragover .ux-upload-area__icon {
      color: var(--ux-primary);
    }

    .ux-upload-area--sm .ux-upload-area__icon {
      width: 32px;
      height: 32px;
    }

    .ux-upload-area__text {
      font-size: var(--ux-font-size-md);
      font-weight: 500;
      color: var(--ux-text);
      margin-bottom: var(--ux-space-xs);
    }

    .ux-upload-area__hint {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
    }

    .ux-upload-area__link {
      color: var(--ux-primary);
      font-weight: 500;
      text-decoration: none;
    }

    .ux-upload-area__link:hover {
      text-decoration: underline;
    }

    .ux-upload-area input[type="file"] {
      position: absolute;
      width: 0;
      height: 0;
      opacity: 0;
      pointer-events: none;
    }

    /* Upload area with preview */
    .ux-upload-area--has-preview {
      padding: var(--ux-space-md);
    }

    .ux-upload-area__preview {
      width: 100%;
      max-height: 200px;
      object-fit: contain;
      border-radius: var(--ux-border-radius-md);
      margin-bottom: var(--ux-space-md);
    }

    /* Disabled state */
    .ux-upload-area--disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Error state */
    .ux-upload-area--error {
      border-color: var(--ux-danger);
    }

    /* ========================================
       States
    ======================================== */

    .ux-upload--loading .ux-upload__dropzone {
      pointer-events: none;
    }

    .ux-upload__loading {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(var(--ux-surface-rgb), 0.8);
      border-radius: var(--ux-border-radius-lg);
    }

    /* ========================================
       Validation
    ======================================== */

    .ux-upload--error .ux-upload__dropzone {
      border-color: var(--ux-danger);
    }

    .ux-upload__error-message {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-danger);
      margin-top: var(--ux-space-sm);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-upload__dropzone,
      .ux-upload__progress-bar,
      .ux-upload__file-action {
        transition: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-upload-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-upload-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for upload
  const uploadComponent = (config = {}) => ({
    files: [],
    isDragover: false,
    isLoading: false,
    error: '',

    // Config
    multiple: config.multiple !== false,
    accept: config.accept || '*/*',
    maxSize: config.maxSize || 10 * 1024 * 1024, // 10MB default
    maxFiles: config.maxFiles || 10,
    autoUpload: config.autoUpload || false,
    uploadUrl: config.uploadUrl || '',

    // File type icons
    fileIcons: {
      image: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="m21 15-5-5L5 21"/></svg>`,
      pdf: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M10 9H8v6h2v-2h1a2 2 0 1 0 0-4h-1z"/></svg>`,
      document: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>`,
      video: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/><line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/><line x1="17" y1="7" x2="22" y2="7"/></svg>`,
      audio: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>`,
      archive: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>`,
      default: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>`
    },

    // Initialize
    init() {
      this.$refs.input?.addEventListener('change', (e) => this.handleFiles(e.target.files));
    },

    // Open file dialog
    browse() {
      this.$refs.input?.click();
    },

    // Handle dropped/selected files
    handleFiles(fileList) {
      this.error = '';
      const newFiles = Array.from(fileList);

      // Check max files
      if (this.files.length + newFiles.length > this.maxFiles) {
        this.error = `Maximum ${this.maxFiles} files allowed`;
        return;
      }

      for (const file of newFiles) {
        // Validate size
        if (file.size > this.maxSize) {
          this.error = `File "${file.name}" exceeds maximum size of ${this.formatSize(this.maxSize)}`;
          continue;
        }

        // Create file object
        const fileObj = {
          id: this.generateId(),
          file: file,
          name: file.name,
          size: file.size,
          type: file.type,
          progress: 0,
          status: 'pending', // pending, uploading, success, error
          error: '',
          preview: null
        };

        // Generate preview for images
        if (file.type.startsWith('image/')) {
          this.generatePreview(fileObj);
        }

        this.files.push(fileObj);

        // Auto upload if enabled
        if (this.autoUpload && this.uploadUrl) {
          this.uploadFile(fileObj);
        }
      }

      // Reset input
      if (this.$refs.input) {
        this.$refs.input.value = '';
      }
    },

    // Generate image preview
    generatePreview(fileObj) {
      const reader = new FileReader();
      reader.onload = (e) => {
        fileObj.preview = e.target.result;
      };
      reader.readAsDataURL(fileObj.file);
    },

    // Upload single file
    async uploadFile(fileObj) {
      if (!this.uploadUrl) return;

      fileObj.status = 'uploading';
      fileObj.progress = 0;

      const formData = new FormData();
      formData.append('file', fileObj.file);

      try {
        const xhr = new XMLHttpRequest();

        xhr.upload.addEventListener('progress', (e) => {
          if (e.lengthComputable) {
            fileObj.progress = Math.round((e.loaded / e.total) * 100);
          }
        });

        xhr.addEventListener('load', () => {
          if (xhr.status >= 200 && xhr.status < 300) {
            fileObj.status = 'success';
            fileObj.progress = 100;
          } else {
            fileObj.status = 'error';
            fileObj.error = `Upload failed: ${xhr.statusText}`;
          }
        });

        xhr.addEventListener('error', () => {
          fileObj.status = 'error';
          fileObj.error = 'Upload failed';
        });

        xhr.open('POST', this.uploadUrl);
        xhr.send(formData);
      } catch (err) {
        fileObj.status = 'error';
        fileObj.error = err.message || 'Upload failed';
      }
    },

    // Upload all pending files
    uploadAll() {
      this.files
        .filter(f => f.status === 'pending')
        .forEach(f => this.uploadFile(f));
    },

    // Remove file
    removeFile(fileId) {
      this.files = this.files.filter(f => f.id !== fileId);
    },

    // Clear all files
    clearFiles() {
      this.files = [];
      this.error = '';
    },

    // Retry failed upload
    retryFile(fileId) {
      const file = this.files.find(f => f.id === fileId);
      if (file && file.status === 'error') {
        file.status = 'pending';
        file.error = '';
        file.progress = 0;
        if (this.uploadUrl) {
          this.uploadFile(file);
        }
      }
    },

    // Drag handlers
    onDragEnter(e) {
      e.preventDefault();
      this.isDragover = true;
    },

    onDragOver(e) {
      e.preventDefault();
      this.isDragover = true;
    },

    onDragLeave(e) {
      e.preventDefault();
      // Only set to false if leaving the dropzone entirely
      if (!e.currentTarget.contains(e.relatedTarget)) {
        this.isDragover = false;
      }
    },

    onDrop(e) {
      e.preventDefault();
      this.isDragover = false;
      const files = e.dataTransfer?.files;
      if (files?.length) {
        this.handleFiles(files);
      }
    },

    // Utilities
    generateId() {
      return 'file_' + Math.random().toString(36).substr(2, 9);
    },

    formatSize(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    },

    getFileIcon(type) {
      if (type.startsWith('image/')) return this.fileIcons.image;
      if (type === 'application/pdf') return this.fileIcons.pdf;
      if (type.startsWith('video/')) return this.fileIcons.video;
      if (type.startsWith('audio/')) return this.fileIcons.audio;
      if (type.includes('zip') || type.includes('rar') || type.includes('tar')) return this.fileIcons.archive;
      if (type.includes('document') || type.includes('word') || type.includes('text')) return this.fileIcons.document;
      return this.fileIcons.default;
    },

    // Getters
    get hasFiles() {
      return this.files.length > 0;
    },

    get pendingFiles() {
      return this.files.filter(f => f.status === 'pending');
    },

    get uploadingFiles() {
      return this.files.filter(f => f.status === 'uploading');
    },

    get completedFiles() {
      return this.files.filter(f => f.status === 'success');
    },

    get failedFiles() {
      return this.files.filter(f => f.status === 'error');
    },

    get totalProgress() {
      if (this.files.length === 0) return 0;
      const total = this.files.reduce((sum, f) => sum + f.progress, 0);
      return Math.round(total / this.files.length);
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxUpload', uploadComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxUpload', uploadComponent);
    });
  }
})();

(function() {
  'use strict';

  /* ========================================
     UX Utilities
     CSS utilities and Alpine.js directives/magic helpers
  ======================================== */

  const styles = `
    /* ========================================
       Visibility Helpers
    ======================================== */

    /* Hide visually but keep accessible to screen readers */
    .ux-sr-only {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }

    /* Completely hidden */
    .ux-hidden {
      display: none !important;
    }

    /* Invisible but takes space */
    .ux-invisible {
      visibility: hidden !important;
    }

    /* Responsive visibility */
    @media (max-width: 575px) {
      .ux-hidden-xs { display: none !important; }
      .ux-visible-xs { display: block !important; }
      .ux-visible-xs-inline { display: inline !important; }
      .ux-visible-xs-flex { display: flex !important; }
    }

    @media (min-width: 576px) and (max-width: 767px) {
      .ux-hidden-sm { display: none !important; }
      .ux-visible-sm { display: block !important; }
      .ux-visible-sm-inline { display: inline !important; }
      .ux-visible-sm-flex { display: flex !important; }
    }

    @media (min-width: 768px) and (max-width: 991px) {
      .ux-hidden-md { display: none !important; }
      .ux-visible-md { display: block !important; }
      .ux-visible-md-inline { display: inline !important; }
      .ux-visible-md-flex { display: flex !important; }
    }

    @media (min-width: 992px) and (max-width: 1199px) {
      .ux-hidden-lg { display: none !important; }
      .ux-visible-lg { display: block !important; }
      .ux-visible-lg-inline { display: inline !important; }
      .ux-visible-lg-flex { display: flex !important; }
    }

    @media (min-width: 1200px) {
      .ux-hidden-xl { display: none !important; }
      .ux-visible-xl { display: block !important; }
      .ux-visible-xl-inline { display: inline !important; }
      .ux-visible-xl-flex { display: flex !important; }
    }

    /* Mobile/Desktop shortcuts */
    @media (max-width: 767px) {
      .ux-desktop-only { display: none !important; }
    }

    @media (min-width: 768px) {
      .ux-mobile-only { display: none !important; }
    }

    /* Touch/No-touch visibility */
    @media (hover: none) and (pointer: coarse) {
      .ux-no-touch { display: none !important; }
    }

    @media (hover: hover) and (pointer: fine) {
      .ux-touch-only { display: none !important; }
    }

    /* Dark/Light mode visibility */
    @media (prefers-color-scheme: dark) {
      .ux-light-only { display: none !important; }
    }

    @media (prefers-color-scheme: light) {
      .ux-dark-only { display: none !important; }
    }

    .ux-dark .ux-light-only { display: none !important; }
    .ux-dark .ux-dark-only { display: block !important; }
    .ux-light .ux-dark-only { display: none !important; }
    .ux-light .ux-light-only { display: block !important; }

    /* ========================================
       Print Utilities
    ======================================== */

    @media print {
      /* Hide elements when printing */
      .ux-no-print {
        display: none !important;
      }

      /* Show only when printing */
      .ux-print-only {
        display: block !important;
      }

      /* Page break utilities */
      .ux-print-break-before {
        page-break-before: always !important;
        break-before: page !important;
      }

      .ux-print-break-after {
        page-break-after: always !important;
        break-after: page !important;
      }

      .ux-print-break-avoid {
        page-break-inside: avoid !important;
        break-inside: avoid !important;
      }

      /* Print-friendly backgrounds */
      .ux-print-bg {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }

      /* Remove shadows for print */
      * {
        box-shadow: none !important;
        text-shadow: none !important;
      }

      /* Expand links for print */
      a[href^="http"]::after {
        content: " (" attr(href) ")";
        font-size: 0.8em;
        color: #666;
      }

      /* Page margins */
      @page {
        margin: 1.5cm;
      }

      /* Ensure content is visible */
      body {
        background: white !important;
        color: black !important;
      }
    }

    /* Hidden until print */
    .ux-print-only {
      display: none !important;
    }

    /* ========================================
       Scroll Lock Body Class
    ======================================== */

    .ux-scroll-locked {
      overflow: hidden !important;
      position: fixed !important;
      width: 100% !important;
      height: 100% !important;
    }

    /* Preserve scroll position */
    .ux-scroll-locked--preserve {
      overflow: hidden !important;
    }

    /* ========================================
       Focus Ring Utilities
    ======================================== */

    .ux-focus-visible:focus {
      outline: none;
    }

    .ux-focus-visible:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }

    .ux-focus-ring:focus {
      outline: none;
      box-shadow: 0 0 0 3px var(--ux-primary-tint);
    }

    .ux-focus-ring--inset:focus {
      outline: none;
      box-shadow: inset 0 0 0 3px var(--ux-primary-tint);
    }

    /* Remove focus ring on mouse click, keep for keyboard */
    .ux-focus-keyboard:focus:not(:focus-visible) {
      outline: none;
      box-shadow: none;
    }

    /* ========================================
       Interactive State Utilities
    ======================================== */

    .ux-disabled {
      opacity: 0.5 !important;
      pointer-events: none !important;
      cursor: not-allowed !important;
    }

    .ux-loading {
      pointer-events: none !important;
      cursor: wait !important;
    }

    .ux-clickable {
      cursor: pointer !important;
    }

    .ux-draggable {
      cursor: grab !important;
    }

    .ux-dragging {
      cursor: grabbing !important;
    }

    /* ========================================
       Text Selection Utilities
    ======================================== */

    .ux-select-none {
      user-select: none !important;
      -webkit-user-select: none !important;
    }

    .ux-select-text {
      user-select: text !important;
      -webkit-user-select: text !important;
    }

    .ux-select-all {
      user-select: all !important;
      -webkit-user-select: all !important;
    }

    /* ========================================
       Pointer Events Utilities
    ======================================== */

    .ux-pointer-none {
      pointer-events: none !important;
    }

    .ux-pointer-auto {
      pointer-events: auto !important;
    }

    /* ========================================
       Overflow Utilities
    ======================================== */

    .ux-overflow-hidden { overflow: hidden !important; }
    .ux-overflow-auto { overflow: auto !important; }
    .ux-overflow-scroll { overflow: scroll !important; }
    .ux-overflow-visible { overflow: visible !important; }

    .ux-overflow-x-hidden { overflow-x: hidden !important; }
    .ux-overflow-x-auto { overflow-x: auto !important; }
    .ux-overflow-x-scroll { overflow-x: scroll !important; }

    .ux-overflow-y-hidden { overflow-y: hidden !important; }
    .ux-overflow-y-auto { overflow-y: auto !important; }
    .ux-overflow-y-scroll { overflow-y: scroll !important; }

    /* Scrollbar styling */
    .ux-scrollbar-thin {
      scrollbar-width: thin;
    }

    .ux-scrollbar-none {
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .ux-scrollbar-none::-webkit-scrollbar {
      display: none;
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-utilities-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-utilities-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  /* ========================================
     JavaScript Utilities
  ======================================== */

  // Ensure UX namespace exists
  window.UX = window.UX || {};

  /* ----------------------------------------
     Focus Trap
  ---------------------------------------- */

  // Store for active focus traps
  const focusTraps = new Map();

  /**
   * Trap focus within an element
   * @param {HTMLElement} element - Container to trap focus in
   * @param {Object} options - Configuration options
   * @returns {Function} Function to remove the trap
   */
  window.UX.trapFocus = function(element, options = {}) {
    const {
      initialFocus = null,  // Element or selector to focus initially
      returnFocus = true,   // Return focus to previously focused element on release
      escapeDeactivates = false // Deactivate trap on Escape key
    } = options;

    const previouslyFocused = document.activeElement;

    const focusableSelectors = [
      'a[href]',
      'button:not([disabled])',
      'textarea:not([disabled])',
      'input:not([disabled]):not([type="hidden"])',
      'select:not([disabled])',
      '[tabindex]:not([tabindex="-1"])',
      '[contenteditable="true"]'
    ].join(', ');

    function getFocusableElements() {
      return [...element.querySelectorAll(focusableSelectors)]
        .filter(el => el.offsetParent !== null); // Only visible elements
    }

    function handleKeyDown(e) {
      if (e.key === 'Tab') {
        const focusable = getFocusableElements();
        if (focusable.length === 0) return;

        const firstFocusable = focusable[0];
        const lastFocusable = focusable[focusable.length - 1];

        if (e.shiftKey) {
          if (document.activeElement === firstFocusable) {
            e.preventDefault();
            lastFocusable.focus();
          }
        } else {
          if (document.activeElement === lastFocusable) {
            e.preventDefault();
            firstFocusable.focus();
          }
        }
      }

      if (escapeDeactivates && e.key === 'Escape') {
        release();
      }
    }

    function release() {
      element.removeEventListener('keydown', handleKeyDown);
      focusTraps.delete(element);

      if (returnFocus && previouslyFocused && previouslyFocused.focus) {
        previouslyFocused.focus();
      }
    }

    // Set up trap
    element.addEventListener('keydown', handleKeyDown);
    focusTraps.set(element, release);

    // Set initial focus
    requestAnimationFrame(() => {
      if (initialFocus) {
        const target = typeof initialFocus === 'string'
          ? element.querySelector(initialFocus)
          : initialFocus;
        if (target) target.focus();
      } else {
        const focusable = getFocusableElements();
        if (focusable.length > 0) focusable[0].focus();
      }
    });

    return release;
  };

  /**
   * Release a focus trap
   * @param {HTMLElement} element - The trapped element
   */
  window.UX.releaseFocusTrap = function(element) {
    const release = focusTraps.get(element);
    if (release) release();
  };

  /* ----------------------------------------
     Click Outside
  ---------------------------------------- */

  /**
   * Detect clicks outside an element
   * @param {HTMLElement} element - Target element
   * @param {Function} callback - Callback when clicked outside
   * @param {Object} options - Configuration
   * @returns {Function} Cleanup function
   */
  window.UX.onClickOutside = function(element, callback, options = {}) {
    const {
      ignore = [],  // Elements or selectors to ignore
      capture = true // Use capture phase
    } = options;

    function handleClick(e) {
      // Check if click is on the element
      if (element.contains(e.target)) return;

      // Check ignored elements
      for (const ignored of ignore) {
        if (typeof ignored === 'string') {
          if (e.target.closest(ignored)) return;
        } else if (ignored instanceof HTMLElement) {
          if (ignored.contains(e.target)) return;
        }
      }

      callback(e);
    }

    // Delay adding listener to avoid immediate trigger
    setTimeout(() => {
      document.addEventListener('click', handleClick, capture);
      document.addEventListener('touchstart', handleClick, capture);
    }, 0);

    return function cleanup() {
      document.removeEventListener('click', handleClick, capture);
      document.removeEventListener('touchstart', handleClick, capture);
    };
  };

  /* ----------------------------------------
     Scroll Lock
  ---------------------------------------- */

  let scrollLockCount = 0;
  let scrollPosition = 0;

  /**
   * Lock body scroll
   * @param {boolean} preservePosition - Keep scroll position
   */
  window.UX.lockScroll = function(preservePosition = true) {
    scrollLockCount++;

    if (scrollLockCount === 1) {
      scrollPosition = window.scrollY;

      if (preservePosition) {
        document.body.style.top = `-${scrollPosition}px`;
        document.body.classList.add('ux-scroll-locked--preserve');
      } else {
        document.body.classList.add('ux-scroll-locked');
      }
    }
  };

  /**
   * Unlock body scroll
   */
  window.UX.unlockScroll = function() {
    scrollLockCount = Math.max(0, scrollLockCount - 1);

    if (scrollLockCount === 0) {
      const wasPreserved = document.body.classList.contains('ux-scroll-locked--preserve');

      document.body.classList.remove('ux-scroll-locked', 'ux-scroll-locked--preserve');
      document.body.style.top = '';

      if (wasPreserved) {
        window.scrollTo(0, scrollPosition);
      }
    }
  };

  /**
   * Force unlock all scroll locks
   */
  window.UX.forceUnlockScroll = function() {
    scrollLockCount = 0;
    document.body.classList.remove('ux-scroll-locked', 'ux-scroll-locked--preserve');
    document.body.style.top = '';
    window.scrollTo(0, scrollPosition);
  };

  /* ----------------------------------------
     Clipboard
  ---------------------------------------- */

  /**
   * Copy text to clipboard
   * @param {string} text - Text to copy
   * @returns {Promise<boolean>} Success status
   */
  window.UX.copyToClipboard = async function(text) {
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
        return true;
      }

      // Fallback for older browsers
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.left = '-9999px';
      textarea.style.top = '-9999px';
      document.body.appendChild(textarea);
      textarea.focus();
      textarea.select();

      const success = document.execCommand('copy');
      document.body.removeChild(textarea);
      return success;
    } catch (err) {
      console.error('Failed to copy to clipboard:', err);
      return false;
    }
  };

  /**
   * Read text from clipboard
   * @returns {Promise<string|null>} Clipboard text or null
   */
  window.UX.readFromClipboard = async function() {
    try {
      if (navigator.clipboard && navigator.clipboard.readText) {
        return await navigator.clipboard.readText();
      }
      return null;
    } catch (err) {
      console.error('Failed to read from clipboard:', err);
      return null;
    }
  };

  /* ----------------------------------------
     Debounce & Throttle
  ---------------------------------------- */

  /**
   * Debounce a function
   * @param {Function} fn - Function to debounce
   * @param {number} delay - Delay in ms
   * @param {Object} options - Configuration
   * @returns {Function} Debounced function
   */
  window.UX.debounce = function(fn, delay = 300, options = {}) {
    const { leading = false, trailing = true } = options;
    let timeoutId = null;
    let lastCallTime = 0;

    function debounced(...args) {
      const now = Date.now();
      const isFirstCall = !timeoutId;

      if (timeoutId) {
        clearTimeout(timeoutId);
      }

      if (leading && isFirstCall) {
        fn.apply(this, args);
        lastCallTime = now;
      }

      if (trailing) {
        timeoutId = setTimeout(() => {
          if (!leading || now - lastCallTime >= delay) {
            fn.apply(this, args);
          }
          timeoutId = null;
        }, delay);
      }
    }

    debounced.cancel = function() {
      if (timeoutId) {
        clearTimeout(timeoutId);
        timeoutId = null;
      }
    };

    debounced.flush = function(...args) {
      debounced.cancel();
      fn.apply(this, args);
    };

    return debounced;
  };

  /**
   * Throttle a function
   * @param {Function} fn - Function to throttle
   * @param {number} limit - Minimum time between calls in ms
   * @param {Object} options - Configuration
   * @returns {Function} Throttled function
   */
  window.UX.throttle = function(fn, limit = 300, options = {}) {
    const { leading = true, trailing = true } = options;
    let lastCallTime = 0;
    let timeoutId = null;
    let lastArgs = null;

    function throttled(...args) {
      const now = Date.now();
      const timeSinceLastCall = now - lastCallTime;

      if (timeSinceLastCall >= limit) {
        if (timeoutId) {
          clearTimeout(timeoutId);
          timeoutId = null;
        }

        if (leading) {
          fn.apply(this, args);
          lastCallTime = now;
        }
      } else {
        lastArgs = args;

        if (trailing && !timeoutId) {
          timeoutId = setTimeout(() => {
            fn.apply(this, lastArgs);
            lastCallTime = Date.now();
            timeoutId = null;
            lastArgs = null;
          }, limit - timeSinceLastCall);
        }
      }
    }

    throttled.cancel = function() {
      if (timeoutId) {
        clearTimeout(timeoutId);
        timeoutId = null;
      }
      lastArgs = null;
    };

    return throttled;
  };

  /* ----------------------------------------
     Alpine.js Directives
  ---------------------------------------- */

  // Register directives when Alpine is available
  function registerDirectives() {
    if (typeof Alpine === 'undefined') return;

    // x-click-outside directive
    Alpine.directive('click-outside', (el, { expression }, { evaluateLater, cleanup }) => {
      const evaluate = evaluateLater(expression);

      const removeListener = window.UX.onClickOutside(el, () => {
        evaluate();
      });

      cleanup(() => removeListener());
    });

    // x-trap-focus directive
    Alpine.directive('trap-focus', (el, { value, modifiers }, { cleanup }) => {
      const options = {
        escapeDeactivates: modifiers.includes('escape'),
        returnFocus: !modifiers.includes('noreturn')
      };

      const release = window.UX.trapFocus(el, options);
      cleanup(() => release());
    });

    // x-clipboard directive
    Alpine.directive('clipboard', (el, { expression, modifiers }, { evaluateLater, effect }) => {
      const getValue = evaluateLater(expression);

      el.addEventListener('click', async () => {
        getValue(async (value) => {
          const success = await window.UX.copyToClipboard(value);

          if (success) {
            el.dispatchEvent(new CustomEvent('clipboard:copied', {
              detail: { value },
              bubbles: true
            }));

            if (modifiers.includes('feedback')) {
              const originalText = el.textContent;
              el.textContent = 'Copied!';
              setTimeout(() => {
                el.textContent = originalText;
              }, 1500);
            }
          }
        });
      });
    });

    // $clipboard magic
    Alpine.magic('clipboard', () => ({
      copy: window.UX.copyToClipboard,
      read: window.UX.readFromClipboard
    }));

    // $debounce magic
    Alpine.magic('debounce', () => window.UX.debounce);

    // $throttle magic
    Alpine.magic('throttle', () => window.UX.throttle);
  }

  // Try to register immediately
  if (typeof Alpine !== 'undefined') {
    registerDirectives();
  }

  // Also register when Alpine loads
  document.addEventListener('alpine:init', registerDirectives);

  /* ----------------------------------------
     Print Utilities
  ---------------------------------------- */

  /**
   * Print a specific element
   * @param {HTMLElement|string} element - Element or selector to print
   * @param {Object} options - Print options
   */
  window.UX.printElement = function(element, options = {}) {
    const {
      title = document.title,
      styles = true, // Include page styles
      extraStyles = '' // Additional CSS
    } = options;

    const el = typeof element === 'string'
      ? document.querySelector(element)
      : element;

    if (!el) {
      console.error('Element not found for printing');
      return;
    }

    const printWindow = window.open('', '_blank');
    if (!printWindow) {
      console.error('Could not open print window');
      return;
    }

    let styleSheets = '';
    if (styles) {
      for (const sheet of document.styleSheets) {
        try {
          if (sheet.cssRules) {
            for (const rule of sheet.cssRules) {
              styleSheets += rule.cssText + '\n';
            }
          }
        } catch (e) {
          // Cross-origin stylesheets will throw
          if (sheet.href) {
            styleSheets += `@import url("${sheet.href}");\n`;
          }
        }
      }
    }

    printWindow.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>${title}</title>
        <style>
          ${styleSheets}
          ${extraStyles}
          @media print {
            body { margin: 0; padding: 20px; }
          }
        </style>
      </head>
      <body>
        ${el.outerHTML}
      </body>
      </html>
    `);

    printWindow.document.close();

    printWindow.onload = function() {
      printWindow.focus();
      printWindow.print();
      printWindow.close();
    };
  };

  /**
   * Print current page
   */
  window.UX.print = function() {
    window.print();
  };

})();

(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Variant Selector
       Size, color, and option selectors for e-commerce
    ======================================== */

    .ux-variant-selector {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-sm);
    }

    .ux-variant-selector__label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      color: var(--ux-text);
    }

    .ux-variant-selector__selected {
      font-weight: 400;
      color: var(--ux-text-secondary);
    }

    .ux-variant-selector__options {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-sm);
    }

    /* Base option style */
    .ux-variant-selector__option {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 44px;
      height: 44px;
      padding: 0 var(--ux-space-md);
      border: 2px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      background: var(--ux-surface);
      color: var(--ux-text);
      font-size: var(--ux-font-size-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--ux-transition-fast);
      position: relative;
      overflow: hidden;
    }

    .ux-variant-selector__option:hover {
      border-color: var(--ux-gray-400);
    }

    .ux-variant-selector__option--selected {
      border-color: var(--ux-primary);
      background: var(--ux-primary-tint);
      color: var(--ux-primary);
    }

    .ux-variant-selector__option--disabled {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Out of stock diagonal line */
    .ux-variant-selector__option--unavailable {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ux-variant-selector__option--unavailable::after {
      content: '';
      position: absolute;
      top: 50%;
      left: -10%;
      width: 120%;
      height: 2px;
      background: var(--ux-gray-400);
      transform: rotate(-45deg);
    }

    /* Size variants */
    .ux-variant-selector--sm .ux-variant-selector__option {
      min-width: 36px;
      height: 36px;
      padding: 0 var(--ux-space-sm);
      font-size: var(--ux-font-size-xs);
    }

    .ux-variant-selector--lg .ux-variant-selector__option {
      min-width: 52px;
      height: 52px;
      padding: 0 var(--ux-space-lg);
      font-size: var(--ux-font-size-md);
    }

    /* ========================================
       Color Swatch Variant
    ======================================== */

    .ux-variant-selector--color .ux-variant-selector__options {
      gap: var(--ux-space-xs);
    }

    .ux-variant-selector--color .ux-variant-selector__option {
      min-width: 36px;
      width: 36px;
      height: 36px;
      padding: 0;
      border-radius: 50%;
      border-width: 3px;
      border-color: transparent;
      box-shadow: inset 0 0 0 2px var(--ux-surface);
    }

    .ux-variant-selector--color .ux-variant-selector__option:hover {
      border-color: var(--ux-gray-300);
    }

    .ux-variant-selector--color .ux-variant-selector__option--selected {
      border-color: var(--ux-primary);
      box-shadow: inset 0 0 0 2px var(--ux-surface);
    }

    /* Color swatch sizes */
    .ux-variant-selector--color.ux-variant-selector--sm .ux-variant-selector__option {
      min-width: 28px;
      width: 28px;
      height: 28px;
    }

    .ux-variant-selector--color.ux-variant-selector--lg .ux-variant-selector__option {
      min-width: 44px;
      width: 44px;
      height: 44px;
    }

    /* Checkmark for selected color */
    .ux-variant-selector--color .ux-variant-selector__option--selected::before {
      content: '';
      width: 12px;
      height: 6px;
      border-left: 2px solid white;
      border-bottom: 2px solid white;
      transform: rotate(-45deg);
      margin-bottom: 2px;
    }

    /* Dark color check */
    .ux-variant-selector--color .ux-variant-selector__option--dark.ux-variant-selector__option--selected::before {
      border-color: white;
    }

    /* Light color check */
    .ux-variant-selector--color .ux-variant-selector__option--light.ux-variant-selector__option--selected::before {
      border-color: var(--ux-gray-800);
    }

    /* White/light color border */
    .ux-variant-selector--color .ux-variant-selector__option--light {
      box-shadow: inset 0 0 0 1px var(--ux-gray-200), inset 0 0 0 2px var(--ux-surface);
    }

    /* Unavailable color */
    .ux-variant-selector--color .ux-variant-selector__option--unavailable::after {
      width: 100%;
      left: 0;
      background: rgba(255, 255, 255, 0.8);
    }

    /* ========================================
       Image Variant
    ======================================== */

    .ux-variant-selector--image .ux-variant-selector__option {
      width: 56px;
      height: 56px;
      padding: 2px;
      border-radius: var(--ux-radius-md);
    }

    .ux-variant-selector--image .ux-variant-selector__option img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: calc(var(--ux-radius-md) - 4px);
    }

    .ux-variant-selector--image.ux-variant-selector--sm .ux-variant-selector__option {
      width: 44px;
      height: 44px;
    }

    .ux-variant-selector--image.ux-variant-selector--lg .ux-variant-selector__option {
      width: 72px;
      height: 72px;
    }

    /* ========================================
       Chip Variant
    ======================================== */

    .ux-variant-selector--chip .ux-variant-selector__option {
      height: auto;
      padding: var(--ux-space-xs) var(--ux-space-md);
      border-radius: var(--ux-radius-full);
      font-size: var(--ux-font-size-sm);
    }

    .ux-variant-selector--chip .ux-variant-selector__option--selected {
      background: var(--ux-primary);
      border-color: var(--ux-primary);
      color: white;
    }

    /* ========================================
       Button Group Variant
    ======================================== */

    .ux-variant-selector--button-group .ux-variant-selector__options {
      gap: 0;
    }

    .ux-variant-selector--button-group .ux-variant-selector__option {
      border-radius: 0;
      margin-left: -2px;
    }

    .ux-variant-selector--button-group .ux-variant-selector__option:first-child {
      border-radius: var(--ux-radius-md) 0 0 var(--ux-radius-md);
      margin-left: 0;
    }

    .ux-variant-selector--button-group .ux-variant-selector__option:last-child {
      border-radius: 0 var(--ux-radius-md) var(--ux-radius-md) 0;
    }

    .ux-variant-selector--button-group .ux-variant-selector__option--selected {
      z-index: 1;
    }

    /* ========================================
       Dropdown Variant
    ======================================== */

    .ux-variant-selector--dropdown {
      position: relative;
    }

    .ux-variant-selector--dropdown .ux-variant-selector__trigger {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      height: 44px;
      padding: 0 var(--ux-space-md);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      background: var(--ux-surface);
      color: var(--ux-text);
      font-size: var(--ux-font-size-md);
      cursor: pointer;
      transition: border-color var(--ux-transition-fast);
    }

    .ux-variant-selector--dropdown .ux-variant-selector__trigger:hover {
      border-color: var(--ux-gray-400);
    }

    .ux-variant-selector--dropdown .ux-variant-selector__trigger:focus {
      outline: none;
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px var(--ux-primary-tint);
    }

    .ux-variant-selector--dropdown .ux-variant-selector__trigger-icon {
      width: 16px;
      height: 16px;
      color: var(--ux-text-secondary);
      transition: transform var(--ux-transition-fast);
    }

    .ux-variant-selector--dropdown.ux-variant-selector--open .ux-variant-selector__trigger-icon {
      transform: rotate(180deg);
    }

    .ux-variant-selector--dropdown .ux-variant-selector__menu {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: var(--ux-space-xs);
      padding: var(--ux-space-xs);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      box-shadow: var(--ux-shadow-lg);
      z-index: var(--ux-z-dropdown);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all var(--ux-transition-fast);
    }

    .ux-variant-selector--dropdown.ux-variant-selector--open .ux-variant-selector__menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-variant-selector--dropdown .ux-variant-selector__option {
      width: 100%;
      justify-content: flex-start;
      border: none;
      border-radius: var(--ux-radius-sm);
      padding: var(--ux-space-sm) var(--ux-space-md);
    }

    .ux-variant-selector--dropdown .ux-variant-selector__option:hover {
      background: var(--ux-gray-100);
    }

    .ux-variant-selector--dropdown .ux-variant-selector__option--selected {
      background: var(--ux-primary-tint);
    }

    /* ========================================
       With Price Variant
    ======================================== */

    .ux-variant-selector__option-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .ux-variant-selector__option-name {
      font-weight: 500;
    }

    .ux-variant-selector__option-price {
      font-size: var(--ux-font-size-xs);
      color: var(--ux-text-secondary);
    }

    .ux-variant-selector__option--selected .ux-variant-selector__option-price {
      color: var(--ux-primary-shade);
    }

    /* Price difference indicator */
    .ux-variant-selector__option-diff {
      font-size: var(--ux-font-size-xs);
    }

    .ux-variant-selector__option-diff--up {
      color: var(--ux-danger);
    }

    .ux-variant-selector__option-diff--down {
      color: var(--ux-success);
    }

    /* ========================================
       Stock Indicator
    ======================================== */

    .ux-variant-selector__stock {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs);
      font-size: var(--ux-font-size-xs);
      margin-top: var(--ux-space-xs);
    }

    .ux-variant-selector__stock-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }

    .ux-variant-selector__stock--in-stock .ux-variant-selector__stock-dot {
      background: var(--ux-success);
    }

    .ux-variant-selector__stock--low-stock .ux-variant-selector__stock-dot {
      background: var(--ux-warning);
    }

    .ux-variant-selector__stock--out-of-stock .ux-variant-selector__stock-dot {
      background: var(--ux-danger);
    }

    .ux-variant-selector__stock-text {
      color: var(--ux-text-secondary);
    }

    /* ========================================
       Dark Mode
    ======================================== */

    @media (prefers-color-scheme: dark) {
      .ux-variant-selector__option {
        background: var(--ux-gray-800);
        border-color: var(--ux-gray-700);
      }

      .ux-variant-selector__option:hover {
        border-color: var(--ux-gray-600);
      }

      .ux-variant-selector--color .ux-variant-selector__option--light {
        box-shadow: inset 0 0 0 1px var(--ux-gray-600), inset 0 0 0 2px var(--ux-gray-800);
      }

      .ux-variant-selector--dropdown .ux-variant-selector__trigger {
        background: var(--ux-gray-800);
        border-color: var(--ux-gray-700);
      }

      .ux-variant-selector--dropdown .ux-variant-selector__menu {
        background: var(--ux-gray-800);
        border-color: var(--ux-gray-700);
      }

      .ux-variant-selector--dropdown .ux-variant-selector__option:hover {
        background: var(--ux-gray-700);
      }
    }

    .ux-dark .ux-variant-selector__option {
      background: var(--ux-gray-800);
      border-color: var(--ux-gray-700);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-variant-selector__option,
      .ux-variant-selector--dropdown .ux-variant-selector__trigger,
      .ux-variant-selector--dropdown .ux-variant-selector__menu,
      .ux-variant-selector--dropdown .ux-variant-selector__trigger-icon {
        transition: none;
      }
    }
  `;

  if (window.UX) {
    window.UX.injectStyles('ux-variant-selector-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-variant-selector-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const componentData = (options = {}) => ({
    // Options format: [{ value, label, price?, image?, color?, available?, stock? }]
    options: options.options || [],
    selected: options.selected || null,
    multiple: options.multiple ?? false, // Allow multiple selection
    isOpen: false, // For dropdown variant
    label: options.label || '',

    init() {
      // Default to first available option if none selected
      if (!this.selected && !this.multiple) {
        const firstAvailable = this.options.find(opt => opt.available !== false);
        if (firstAvailable) {
          this.selected = firstAvailable.value;
        }
      }

      // Initialize multiple selection as array
      if (this.multiple && !Array.isArray(this.selected)) {
        this.selected = this.selected ? [this.selected] : [];
      }
    },

    select(value) {
      const option = this.options.find(opt => opt.value === value);
      if (!option || option.available === false) return;

      if (this.multiple) {
        const index = this.selected.indexOf(value);
        if (index === -1) {
          this.selected.push(value);
        } else {
          this.selected.splice(index, 1);
        }
        this.$dispatch('variant:change', { values: [...this.selected] });
      } else {
        this.selected = value;
        this.isOpen = false;
        this.$dispatch('variant:change', { value, option });
      }
    },

    isSelected(value) {
      if (this.multiple) {
        return this.selected.includes(value);
      }
      return this.selected === value;
    },

    toggle() {
      this.isOpen = !this.isOpen;
    },

    close() {
      this.isOpen = false;
    },

    get selectedOption() {
      return this.options.find(opt => opt.value === this.selected);
    },

    get selectedLabel() {
      const opt = this.selectedOption;
      return opt ? opt.label : 'Select option';
    },

    getStockStatus(option) {
      if (option.available === false || option.stock === 0) {
        return 'out-of-stock';
      }
      if (option.stock && option.stock < 5) {
        return 'low-stock';
      }
      return 'in-stock';
    },

    getStockText(option) {
      const status = this.getStockStatus(option);
      if (status === 'out-of-stock') return 'Out of stock';
      if (status === 'low-stock') return `Only ${option.stock} left`;
      return 'In stock';
    },

    // Helper to determine if color is light or dark
    isLightColor(color) {
      if (!color) return false;
      // Simple heuristic - could be improved
      const lightColors = ['white', '#fff', '#ffffff', 'ivory', 'beige', 'cream', 'yellow', 'lightyellow'];
      return lightColors.some(c => color.toLowerCase().includes(c));
    }
  });

  if (window.UX) {
    window.UX.registerComponent('uxVariantSelector', componentData);
  }
})();

/**
 * UX Video Player Component
 * Custom video player with iOS-style controls
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Video Player
    ======================================== */

    .ux-video-player {
      --ux-video-controls-height: 44px;
      --ux-video-progress-height: 4px;
      --ux-video-progress-height-active: 6px;
      --ux-video-btn-size: 44px;
      --ux-video-btn-size-sm: 36px;
      --ux-video-slider-thumb: 14px;
      --ux-video-controls-bg: rgba(0, 0, 0, 0.6);
      --ux-video-controls-color: #ffffff;
      --ux-video-progress-bg: rgba(255, 255, 255, 0.3);
      --ux-video-progress-fill: var(--ux-primary, #0ea5e9);
      --ux-video-progress-buffer: rgba(255, 255, 255, 0.5);

      position: relative;
      width: 100%;
      background-color: #000;
      border-radius: var(--ux-border-radius-lg, 12px);
      overflow: hidden;
      line-height: 0;
      user-select: none;
      -webkit-user-select: none;
    }

    .ux-video-player:focus-within {
      outline: 2px solid var(--ux-primary, #0ea5e9);
      outline-offset: 2px;
    }

    /* ========================================
       Video Element
    ======================================== */

    .ux-video-player__video {
      width: 100%;
      height: auto;
      display: block;
      object-fit: contain;
      background-color: #000;
    }

    .ux-video-player--cover .ux-video-player__video {
      object-fit: cover;
    }

    .ux-video-player--16-9 {
      aspect-ratio: 16 / 9;
    }

    .ux-video-player--4-3 {
      aspect-ratio: 4 / 3;
    }

    .ux-video-player--1-1 {
      aspect-ratio: 1 / 1;
    }

    .ux-video-player--16-9 .ux-video-player__video,
    .ux-video-player--4-3 .ux-video-player__video,
    .ux-video-player--1-1 .ux-video-player__video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    /* ========================================
       Poster Overlay
    ======================================== */

    .ux-video-player__poster {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-size: cover;
      background-position: center;
      background-color: #000;
      cursor: pointer;
      z-index: 5;
      transition: opacity var(--ux-transition-normal, 200ms) var(--ux-ease, ease);
    }

    .ux-video-player__poster--hidden {
      opacity: 0;
      pointer-events: none;
    }

    .ux-video-player__poster-play {
      width: 72px;
      height: 72px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: #fff;
      cursor: pointer;
      transition:
        transform var(--ux-transition-fast, 150ms) var(--ux-ease, ease),
        background-color var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-video-player__poster-play:hover {
      transform: scale(1.1);
      background: rgba(0, 0, 0, 0.8);
    }

    .ux-video-player__poster-play:active {
      transform: scale(0.95);
    }

    .ux-video-player__poster-play svg {
      width: 32px;
      height: 32px;
      margin-left: 4px;
    }

    /* ========================================
       Loading Overlay
    ======================================== */

    .ux-video-player__loading {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.4);
      z-index: 10;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-transition-fast, 150ms) var(--ux-ease, ease),
        visibility var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-video-player--loading .ux-video-player__loading {
      opacity: 1;
      visibility: visible;
    }

    .ux-video-player__spinner {
      width: 48px;
      height: 48px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: ux-video-spin 0.8s linear infinite;
    }

    @keyframes ux-video-spin {
      to { transform: rotate(360deg); }
    }

    /* ========================================
       Controls Wrapper
    ======================================== */

    .ux-video-player__controls {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      flex-direction: column;
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
      padding: var(--ux-space-lg, 1.5rem) var(--ux-space-md, 1rem) var(--ux-space-sm, 0.5rem);
      z-index: 15;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-transition-normal, 200ms) var(--ux-ease, ease),
        visibility var(--ux-transition-normal, 200ms) var(--ux-ease, ease);
    }

    .ux-video-player:hover .ux-video-player__controls,
    .ux-video-player--controls-visible .ux-video-player__controls,
    .ux-video-player:focus-within .ux-video-player__controls {
      opacity: 1;
      visibility: visible;
    }

    .ux-video-player--controls-always .ux-video-player__controls {
      opacity: 1;
      visibility: visible;
      position: relative;
      background: var(--ux-surface-secondary, #f3f4f6);
      padding: var(--ux-space-sm, 0.5rem) var(--ux-space-md, 1rem);
    }

    /* ========================================
       Progress Bar
    ======================================== */

    .ux-video-player__progress-wrapper {
      position: relative;
      width: 100%;
      height: 20px;
      display: flex;
      align-items: center;
      cursor: pointer;
      touch-action: none;
    }

    .ux-video-player__progress {
      position: relative;
      width: 100%;
      height: var(--ux-video-progress-height);
      background: var(--ux-video-progress-bg);
      border-radius: 2px;
      overflow: hidden;
      transition: height var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-video-player__progress-wrapper:hover .ux-video-player__progress,
    .ux-video-player__progress-wrapper:active .ux-video-player__progress {
      height: var(--ux-video-progress-height-active);
    }

    .ux-video-player__progress-buffer {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: var(--ux-video-progress-buffer);
      border-radius: 2px;
    }

    .ux-video-player__progress-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: var(--ux-video-progress-fill);
      border-radius: 2px;
      transition: width 0.1s linear;
    }

    .ux-video-player__progress-thumb {
      position: absolute;
      top: 50%;
      width: var(--ux-video-slider-thumb);
      height: var(--ux-video-slider-thumb);
      background: #fff;
      border-radius: 50%;
      transform: translate(-50%, -50%) scale(0);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      transition:
        transform var(--ux-transition-fast, 150ms) cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .ux-video-player__progress-wrapper:hover .ux-video-player__progress-thumb,
    .ux-video-player__progress-wrapper:active .ux-video-player__progress-thumb {
      transform: translate(-50%, -50%) scale(1);
    }

    /* ========================================
       Controls Bar
    ======================================== */

    .ux-video-player__controls-bar {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs, 0.25rem);
      margin-top: var(--ux-space-xs, 0.25rem);
    }

    .ux-video-player__controls-left {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs, 0.25rem);
    }

    .ux-video-player__controls-center {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ux-video-player__controls-right {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs, 0.25rem);
    }

    /* ========================================
       Control Buttons
    ======================================== */

    .ux-video-player__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ux-video-btn-size);
      height: var(--ux-video-btn-size);
      min-width: var(--ux-video-btn-size);
      background: transparent;
      border: none;
      border-radius: var(--ux-border-radius, 8px);
      color: var(--ux-video-controls-color);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast, 150ms) var(--ux-ease, ease),
        transform var(--ux-transition-fast, 150ms) var(--ux-ease, ease),
        opacity var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-video-player__btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .ux-video-player__btn:active {
      transform: scale(0.95);
      opacity: 0.8;
    }

    .ux-video-player__btn:focus-visible {
      outline: 2px solid var(--ux-primary, #0ea5e9);
      outline-offset: 2px;
    }

    .ux-video-player__btn svg {
      width: 24px;
      height: 24px;
    }

    .ux-video-player__btn--sm {
      width: var(--ux-video-btn-size-sm);
      height: var(--ux-video-btn-size-sm);
      min-width: var(--ux-video-btn-size-sm);
    }

    .ux-video-player__btn--sm svg {
      width: 20px;
      height: 20px;
    }

    /* ========================================
       Time Display
    ======================================== */

    .ux-video-player__time {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 500;
      color: var(--ux-video-controls-color);
      font-variant-numeric: tabular-nums;
      white-space: nowrap;
      padding: 0 var(--ux-space-xs, 0.25rem);
    }

    .ux-video-player__time-separator {
      opacity: 0.6;
    }

    /* ========================================
       Volume Control
    ======================================== */

    .ux-video-player__volume {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs, 0.25rem);
    }

    .ux-video-player__volume-slider-wrapper {
      width: 0;
      overflow: hidden;
      transition: width var(--ux-transition-normal, 200ms) var(--ux-ease, ease);
    }

    .ux-video-player__volume:hover .ux-video-player__volume-slider-wrapper,
    .ux-video-player__volume-slider-wrapper:focus-within {
      width: 80px;
    }

    .ux-video-player__volume-slider {
      width: 80px;
      height: 4px;
      -webkit-appearance: none;
      appearance: none;
      background: var(--ux-video-progress-bg);
      border-radius: 2px;
      outline: none;
      cursor: pointer;
    }

    .ux-video-player__volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 12px;
      height: 12px;
      background: #fff;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    .ux-video-player__volume-slider::-moz-range-thumb {
      width: 12px;
      height: 12px;
      background: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    /* ========================================
       Speed Control
    ======================================== */

    .ux-video-player__speed {
      position: relative;
    }

    .ux-video-player__speed-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 44px;
      height: var(--ux-video-btn-size);
      padding: 0 var(--ux-space-sm, 0.5rem);
      background: transparent;
      border: none;
      border-radius: var(--ux-border-radius, 8px);
      color: var(--ux-video-controls-color);
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 600;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition:
        background-color var(--ux-transition-fast, 150ms) var(--ux-ease, ease),
        opacity var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-video-player__speed-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .ux-video-player__speed-menu {
      position: absolute;
      bottom: calc(100% + var(--ux-space-xs, 0.25rem));
      right: 0;
      min-width: 100px;
      background: var(--ux-video-controls-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--ux-border-radius-lg, 12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: var(--ux-space-xs, 0.25rem);
      opacity: 0;
      visibility: hidden;
      transform: translateY(8px);
      transition:
        opacity var(--ux-transition-fast, 150ms) var(--ux-ease, ease),
        visibility var(--ux-transition-fast, 150ms) var(--ux-ease, ease),
        transform var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
      z-index: 20;
    }

    .ux-video-player__speed-menu--open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-video-player__speed-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      padding: var(--ux-space-sm, 0.5rem) var(--ux-space-md, 1rem);
      background: transparent;
      border: none;
      border-radius: var(--ux-border-radius, 8px);
      color: var(--ux-video-controls-color);
      font-size: var(--ux-font-size-sm, 0.875rem);
      text-align: left;
      cursor: pointer;
      transition: background-color var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-video-player__speed-option:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .ux-video-player__speed-option--active {
      color: var(--ux-primary, #0ea5e9);
    }

    .ux-video-player__speed-option--active::after {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--ux-primary, #0ea5e9);
      border-radius: 50%;
    }

    /* ========================================
       Fullscreen
    ======================================== */

    .ux-video-player--fullscreen {
      position: fixed;
      inset: 0;
      z-index: 9999;
      border-radius: 0;
      background: #000;
    }

    .ux-video-player--fullscreen .ux-video-player__video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* ========================================
       Picture-in-Picture Indicator
    ======================================== */

    .ux-video-player__pip-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm, 0.5rem);
      padding: var(--ux-space-md, 1rem) var(--ux-space-lg, 1.5rem);
      background: rgba(0, 0, 0, 0.8);
      border-radius: var(--ux-border-radius-lg, 12px);
      color: #fff;
      font-size: var(--ux-font-size-md, 1rem);
      z-index: 20;
    }

    .ux-video-player__pip-indicator svg {
      width: 24px;
      height: 24px;
    }

    /* ========================================
       Center Play Overlay
    ======================================== */

    .ux-video-player__center-play {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 8;
    }

    .ux-video-player__center-play-btn {
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: none;
      border-radius: 50%;
      color: #fff;
      cursor: pointer;
      opacity: 0;
      transform: scale(0.8);
      transition:
        opacity var(--ux-transition-fast, 150ms) var(--ux-ease, ease),
        transform var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-video-player:hover .ux-video-player__center-play-btn,
    .ux-video-player--paused .ux-video-player__center-play-btn {
      opacity: 1;
      transform: scale(1);
    }

    .ux-video-player__center-play-btn:hover {
      transform: scale(1.1);
    }

    .ux-video-player__center-play-btn:active {
      transform: scale(0.95);
    }

    .ux-video-player__center-play-btn svg {
      width: 36px;
      height: 36px;
      margin-left: 4px;
    }

    /* Hide center play when playing */
    .ux-video-player--playing .ux-video-player__center-play {
      display: none;
    }

    /* ========================================
       Tooltip (for time preview on hover)
    ======================================== */

    .ux-video-player__tooltip {
      position: absolute;
      bottom: calc(100% + 8px);
      padding: var(--ux-space-xs, 0.25rem) var(--ux-space-sm, 0.5rem);
      background: rgba(0, 0, 0, 0.9);
      border-radius: var(--ux-border-radius, 8px);
      color: #fff;
      font-size: var(--ux-font-size-xs, 0.75rem);
      font-weight: 500;
      white-space: nowrap;
      transform: translateX(-50%);
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--ux-transition-fast, 150ms) var(--ux-ease, ease),
        visibility var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-video-player__progress-wrapper:hover .ux-video-player__tooltip {
      opacity: 1;
      visibility: visible;
    }

    /* ========================================
       Mobile Adjustments
    ======================================== */

    @media (max-width: 767px) {
      .ux-video-player__controls {
        padding: var(--ux-space-md, 1rem) var(--ux-space-sm, 0.5rem) var(--ux-space-xs, 0.25rem);
      }

      .ux-video-player__btn {
        width: 40px;
        height: 40px;
        min-width: 40px;
      }

      .ux-video-player__btn svg {
        width: 20px;
        height: 20px;
      }

      .ux-video-player__time {
        font-size: var(--ux-font-size-xs, 0.75rem);
      }

      .ux-video-player__volume-slider-wrapper {
        display: none;
      }

      .ux-video-player__center-play-btn {
        width: 64px;
        height: 64px;
      }

      .ux-video-player__center-play-btn svg {
        width: 28px;
        height: 28px;
      }
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-video-player--glass .ux-video-player__controls {
      background: linear-gradient(
        transparent,
        var(--ux-glass-bg, rgba(255, 255, 255, 0.72))
      );
      backdrop-filter: blur(var(--ux-glass-blur, 20px)) saturate(var(--ux-glass-saturation, 180%));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur, 20px)) saturate(var(--ux-glass-saturation, 180%));
    }

    .ux-video-player--glass .ux-video-player__controls-bar {
      color: var(--ux-text, #111827);
    }

    .ux-video-player--glass .ux-video-player__btn {
      color: var(--ux-text, #111827);
    }

    .ux-video-player--glass .ux-video-player__btn:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    .ux-video-player--glass .ux-video-player__time {
      color: var(--ux-text, #111827);
    }

    .ux-video-player--glass .ux-video-player__progress {
      background: rgba(0, 0, 0, 0.2);
    }

    .ux-video-player--glass .ux-video-player__progress-buffer {
      background: rgba(0, 0, 0, 0.3);
    }

    .ux-video-player--glass .ux-video-player__progress-thumb {
      background: var(--ux-primary, #0ea5e9);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .ux-video-player--glass .ux-video-player__speed-menu {
      background: var(--ux-glass-bg, rgba(255, 255, 255, 0.72));
      backdrop-filter: blur(var(--ux-glass-blur, 20px)) saturate(var(--ux-glass-saturation, 180%));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur, 20px)) saturate(var(--ux-glass-saturation, 180%));
      border-color: var(--ux-glass-border, rgba(255, 255, 255, 0.18));
    }

    .ux-video-player--glass .ux-video-player__speed-btn,
    .ux-video-player--glass .ux-video-player__speed-option {
      color: var(--ux-text, #111827);
    }

    .ux-video-player--glass .ux-video-player__speed-option:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    /* Dark mode glass */
    .ux-dark .ux-video-player--glass .ux-video-player__controls {
      background: linear-gradient(
        transparent,
        rgba(30, 30, 30, 0.72)
      );
    }

    .ux-dark .ux-video-player--glass .ux-video-player__controls-bar,
    .ux-dark .ux-video-player--glass .ux-video-player__btn,
    .ux-dark .ux-video-player--glass .ux-video-player__time,
    .ux-dark .ux-video-player--glass .ux-video-player__speed-btn,
    .ux-dark .ux-video-player--glass .ux-video-player__speed-option {
      color: #fff;
    }

    .ux-dark .ux-video-player--glass .ux-video-player__btn:hover,
    .ux-dark .ux-video-player--glass .ux-video-player__speed-option:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .ux-dark .ux-video-player--glass .ux-video-player__progress {
      background: rgba(255, 255, 255, 0.2);
    }

    .ux-dark .ux-video-player--glass .ux-video-player__progress-buffer {
      background: rgba(255, 255, 255, 0.3);
    }

    @media (prefers-color-scheme: dark) {
      .ux-video-player--glass .ux-video-player__controls {
        background: linear-gradient(
          transparent,
          rgba(30, 30, 30, 0.72)
        );
      }

      .ux-video-player--glass .ux-video-player__controls-bar,
      .ux-video-player--glass .ux-video-player__btn,
      .ux-video-player--glass .ux-video-player__time,
      .ux-video-player--glass .ux-video-player__speed-btn,
      .ux-video-player--glass .ux-video-player__speed-option {
        color: #fff;
      }

      .ux-video-player--glass .ux-video-player__btn:hover,
      .ux-video-player--glass .ux-video-player__speed-option:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .ux-video-player--glass .ux-video-player__progress {
        background: rgba(255, 255, 255, 0.2);
      }

      .ux-video-player--glass .ux-video-player__progress-buffer {
        background: rgba(255, 255, 255, 0.3);
      }
    }

    /* ========================================
       Size Variants
    ======================================== */

    .ux-video-player--sm {
      --ux-video-btn-size: 36px;
      --ux-video-btn-size-sm: 32px;
    }

    .ux-video-player--lg {
      --ux-video-btn-size: 52px;
      --ux-video-btn-size-sm: 44px;
    }

    /* ========================================
       Minimal Variant (progress only)
    ======================================== */

    .ux-video-player--minimal .ux-video-player__controls-bar {
      display: none;
    }

    .ux-video-player--minimal .ux-video-player__controls {
      padding: var(--ux-space-sm, 0.5rem);
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-video-player__controls,
      .ux-video-player__poster,
      .ux-video-player__loading,
      .ux-video-player__poster-play,
      .ux-video-player__btn,
      .ux-video-player__progress,
      .ux-video-player__progress-thumb,
      .ux-video-player__speed-menu,
      .ux-video-player__tooltip,
      .ux-video-player__center-play-btn {
        transition: none;
      }

      .ux-video-player__spinner {
        animation: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-video-player-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-video-player-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine component for video player
  const videoPlayerComponent = (config = {}) => ({
    // State
    isPlaying: false,
    isPaused: true,
    isLoading: false,
    isBuffering: false,
    isMuted: config.muted || false,
    isFullscreen: false,
    isPiP: false,
    showControls: true,
    showSpeedMenu: false,
    hasStarted: false,

    // Values
    currentTime: 0,
    duration: 0,
    bufferedPercent: 0,
    volume: config.volume ?? 1,
    playbackRate: config.playbackRate || 1,

    // Options
    autoplay: config.autoplay || false,
    loop: config.loop || false,
    poster: config.poster || null,
    preload: config.preload || 'metadata',
    controlsTimeout: config.controlsTimeout || 3000,
    speeds: config.speeds || [0.5, 0.75, 1, 1.25, 1.5, 2],

    // Internal
    _video: null,
    _controlsTimer: null,
    _progressDragging: false,
    playerId: config.id || 'ux-video-player-' + Math.random().toString(36).substr(2, 9),

    // ARIA attributes
    get ariaAttrs() {
      return {
        'role': 'application',
        'aria-label': config.ariaLabel || 'Video player'
      };
    },

    // Computed
    get progress() {
      return this.duration > 0 ? (this.currentTime / this.duration) * 100 : 0;
    },

    get currentTimeFormatted() {
      return this._formatTime(this.currentTime);
    },

    get durationFormatted() {
      return this._formatTime(this.duration);
    },

    get volumeIcon() {
      if (this.isMuted || this.volume === 0) return 'muted';
      if (this.volume < 0.5) return 'low';
      return 'high';
    },

    // Lifecycle
    init() {
      this.$nextTick(() => {
        this._video = this.$refs.video;
        if (!this._video) return;

        // Set initial values
        this._video.volume = this.volume;
        this._video.muted = this.isMuted;
        this._video.playbackRate = this.playbackRate;
        if (this.loop) this._video.loop = true;

        // Bind events
        this._bindVideoEvents();
        this._bindKeyboardEvents();

        // Handle autoplay
        if (this.autoplay) {
          this.play();
        }
      });
    },

    destroy() {
      this._clearControlsTimer();
      if (this._keydownHandler) {
        document.removeEventListener('keydown', this._keydownHandler);
      }
    },

    // Video event bindings
    _bindVideoEvents() {
      const video = this._video;

      video.addEventListener('loadstart', () => {
        this.isLoading = true;
      });

      video.addEventListener('loadedmetadata', () => {
        this.duration = video.duration;
        this.isLoading = false;
      });

      video.addEventListener('canplay', () => {
        this.isLoading = false;
        this.isBuffering = false;
      });

      video.addEventListener('waiting', () => {
        this.isBuffering = true;
      });

      video.addEventListener('playing', () => {
        this.isBuffering = false;
      });

      video.addEventListener('play', () => {
        this.isPlaying = true;
        this.isPaused = false;
        this.hasStarted = true;
        this.$el.classList.add('ux-video-player--playing');
        this.$el.classList.remove('ux-video-player--paused');
        this.$dispatch('ux-video-player:play');
      });

      video.addEventListener('pause', () => {
        this.isPlaying = false;
        this.isPaused = true;
        this.$el.classList.remove('ux-video-player--playing');
        this.$el.classList.add('ux-video-player--paused');
        this.$dispatch('ux-video-player:pause');
      });

      video.addEventListener('ended', () => {
        this.isPlaying = false;
        this.isPaused = true;
        if (!this.loop) {
          this.hasStarted = false;
        }
        this.$dispatch('ux-video-player:ended');
      });

      video.addEventListener('timeupdate', () => {
        if (!this._progressDragging) {
          this.currentTime = video.currentTime;
        }
      });

      video.addEventListener('progress', () => {
        this._updateBuffered();
      });

      video.addEventListener('volumechange', () => {
        this.volume = video.volume;
        this.isMuted = video.muted;
      });

      video.addEventListener('ratechange', () => {
        this.playbackRate = video.playbackRate;
      });

      video.addEventListener('enterpictureinpicture', () => {
        this.isPiP = true;
        this.$dispatch('ux-video-player:pip-enter');
      });

      video.addEventListener('leavepictureinpicture', () => {
        this.isPiP = false;
        this.$dispatch('ux-video-player:pip-leave');
      });

      video.addEventListener('error', (e) => {
        this.isLoading = false;
        this.$dispatch('ux-video-player:error', { error: video.error });
      });
    },

    // Keyboard navigation
    _bindKeyboardEvents() {
      this._keydownHandler = (e) => {
        // Only handle if player is focused or has focus within
        if (!this.$el.contains(document.activeElement) && document.activeElement !== this.$el) {
          return;
        }

        switch (e.key) {
          case ' ':
          case 'k':
            e.preventDefault();
            this.toggle();
            break;
          case 'ArrowLeft':
            e.preventDefault();
            this.skip(-10);
            break;
          case 'ArrowRight':
            e.preventDefault();
            this.skip(10);
            break;
          case 'ArrowUp':
            e.preventDefault();
            this.setVolume(Math.min(1, this.volume + 0.1));
            break;
          case 'ArrowDown':
            e.preventDefault();
            this.setVolume(Math.max(0, this.volume - 0.1));
            break;
          case 'm':
            e.preventDefault();
            this.toggleMute();
            break;
          case 'f':
            e.preventDefault();
            this.toggleFullscreen();
            break;
          case 'p':
            if (e.shiftKey) {
              e.preventDefault();
              this.togglePiP();
            }
            break;
          case 'Home':
            e.preventDefault();
            this.seek(0);
            break;
          case 'End':
            e.preventDefault();
            this.seek(this.duration);
            break;
          case '0':
          case '1':
          case '2':
          case '3':
          case '4':
          case '5':
          case '6':
          case '7':
          case '8':
          case '9':
            e.preventDefault();
            const percent = parseInt(e.key) * 10;
            this.seek(this.duration * (percent / 100));
            break;
          case '<':
            e.preventDefault();
            this.decreaseSpeed();
            break;
          case '>':
            e.preventDefault();
            this.increaseSpeed();
            break;
        }
      };

      document.addEventListener('keydown', this._keydownHandler);
    },

    // Playback controls
    play() {
      if (this._video) {
        this._video.play().catch(err => {
          console.warn('Video play failed:', err);
        });
      }
    },

    pause() {
      if (this._video) {
        this._video.pause();
      }
    },

    toggle() {
      if (this.isPlaying) {
        this.pause();
      } else {
        this.play();
      }
    },

    stop() {
      this.pause();
      this.seek(0);
      this.hasStarted = false;
    },

    // Seeking
    seek(time) {
      if (this._video) {
        const targetTime = Math.max(0, Math.min(this.duration, time));
        this._video.currentTime = targetTime;
        this.currentTime = targetTime;
      }
    },

    skip(seconds) {
      this.seek(this.currentTime + seconds);
    },

    // Progress bar interaction
    handleProgressClick(event) {
      const rect = event.currentTarget.getBoundingClientRect();
      const percent = (event.clientX - rect.left) / rect.width;
      this.seek(percent * this.duration);
    },

    handleProgressDrag(event) {
      if (!this._progressDragging) return;
      const rect = this.$refs.progressWrapper.getBoundingClientRect();
      const percent = Math.max(0, Math.min(1, (event.clientX - rect.left) / rect.width));
      this.currentTime = percent * this.duration;
    },

    startProgressDrag(event) {
      this._progressDragging = true;
      this.handleProgressClick(event);
      document.addEventListener('mousemove', this._onProgressMove = (e) => this.handleProgressDrag(e));
      document.addEventListener('mouseup', this._onProgressUp = () => this.endProgressDrag());
    },

    endProgressDrag() {
      if (this._progressDragging) {
        this.seek(this.currentTime);
        this._progressDragging = false;
      }
      document.removeEventListener('mousemove', this._onProgressMove);
      document.removeEventListener('mouseup', this._onProgressUp);
    },

    getProgressTooltipTime(event) {
      const rect = event.currentTarget.getBoundingClientRect();
      const percent = (event.clientX - rect.left) / rect.width;
      return this._formatTime(percent * this.duration);
    },

    getProgressTooltipPosition(event) {
      const rect = event.currentTarget.getBoundingClientRect();
      return ((event.clientX - rect.left) / rect.width) * 100;
    },

    // Volume control
    setVolume(level) {
      if (this._video) {
        const vol = Math.max(0, Math.min(1, level));
        this._video.volume = vol;
        this.volume = vol;
        if (vol > 0 && this.isMuted) {
          this._video.muted = false;
        }
      }
    },

    toggleMute() {
      if (this._video) {
        this._video.muted = !this._video.muted;
      }
    },

    // Speed control
    setSpeed(rate) {
      if (this._video) {
        this._video.playbackRate = rate;
        this.playbackRate = rate;
        this.showSpeedMenu = false;
      }
    },

    increaseSpeed() {
      const currentIndex = this.speeds.indexOf(this.playbackRate);
      if (currentIndex < this.speeds.length - 1) {
        this.setSpeed(this.speeds[currentIndex + 1]);
      }
    },

    decreaseSpeed() {
      const currentIndex = this.speeds.indexOf(this.playbackRate);
      if (currentIndex > 0) {
        this.setSpeed(this.speeds[currentIndex - 1]);
      }
    },

    toggleSpeedMenu() {
      this.showSpeedMenu = !this.showSpeedMenu;
    },

    // Fullscreen
    toggleFullscreen() {
      if (!document.fullscreenElement) {
        this.enterFullscreen();
      } else {
        this.exitFullscreen();
      }
    },

    enterFullscreen() {
      const elem = this.$el;
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) {
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) {
        elem.msRequestFullscreen();
      }
      this.isFullscreen = true;
      this.$el.classList.add('ux-video-player--fullscreen');
      this.$dispatch('ux-video-player:fullscreen-enter');
    },

    exitFullscreen() {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      }
      this.isFullscreen = false;
      this.$el.classList.remove('ux-video-player--fullscreen');
      this.$dispatch('ux-video-player:fullscreen-exit');
    },

    // Picture-in-Picture
    async togglePiP() {
      if (!document.pictureInPictureEnabled) {
        console.warn('Picture-in-Picture not supported');
        return;
      }

      try {
        if (this._video !== document.pictureInPictureElement) {
          await this._video.requestPictureInPicture();
        } else {
          await document.exitPictureInPicture();
        }
      } catch (err) {
        console.error('PiP error:', err);
      }
    },

    // Controls visibility
    showControlsTemporarily() {
      this.showControls = true;
      this.$el.classList.add('ux-video-player--controls-visible');
      this._resetControlsTimer();
    },

    hideControls() {
      if (this.isPlaying && !this.showSpeedMenu) {
        this.showControls = false;
        this.$el.classList.remove('ux-video-player--controls-visible');
      }
    },

    _resetControlsTimer() {
      this._clearControlsTimer();
      if (this.isPlaying) {
        this._controlsTimer = setTimeout(() => {
          this.hideControls();
        }, this.controlsTimeout);
      }
    },

    _clearControlsTimer() {
      if (this._controlsTimer) {
        clearTimeout(this._controlsTimer);
        this._controlsTimer = null;
      }
    },

    // Helpers
    _formatTime(seconds) {
      if (isNaN(seconds) || !isFinite(seconds)) return '0:00';
      const hrs = Math.floor(seconds / 3600);
      const mins = Math.floor((seconds % 3600) / 60);
      const secs = Math.floor(seconds % 60);

      if (hrs > 0) {
        return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    },

    _updateBuffered() {
      if (this._video && this._video.buffered.length > 0) {
        const bufferedEnd = this._video.buffered.end(this._video.buffered.length - 1);
        this.bufferedPercent = (bufferedEnd / this.duration) * 100;
      }
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxVideoPlayer', videoPlayerComponent);
  } else {
    document.addEventListener('alpine:init', () => {
      Alpine.data('uxVideoPlayer', videoPlayerComponent);
    });
  }
})();

/**
 * UX Virtual Keyboard Component
 * Button to trigger the system virtual/touch keyboard
 *
 * LIMITATIONS:
 * ============
 * 1. Browser Support: Only works in Chromium-based browsers (Chrome, Edge, Opera)
 *    with the VirtualKeyboard API enabled.
 * 2. Device Requirement: Requires a touch-enabled device or tablet mode enabled.
 * 3. Windows: Must have "Touch keyboard" enabled in Settings > Time & Language > Typing.
 * 4. Security: Only works after user interaction (click/touch), not programmatically.
 * 5. HTTPS: Requires secure context (HTTPS) in production.
 * 6. Not supported: Firefox, Safari, iOS (uses native keyboard behavior).
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Virtual Keyboard Button
       ========================================================================== */

    .ux-virtual-keyboard-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-sm);
      min-width: var(--ux-touch-target);
      height: var(--ux-touch-target);
      padding: 0 var(--ux-space-md);
      font-size: 0.9375rem;
      font-weight: 500;
      color: var(--ux-text);
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-radius-md);
      cursor: pointer;
      transition: all var(--ux-transition-fast) var(--ux-ease-out);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .ux-virtual-keyboard-btn:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-virtual-keyboard-btn:active {
      transform: scale(0.97);
    }

    .ux-virtual-keyboard-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .ux-virtual-keyboard-btn__icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Icon-only variant */
    .ux-virtual-keyboard-btn--icon-only {
      width: var(--ux-touch-target);
      padding: 0;
    }

    /* Size variants */
    .ux-virtual-keyboard-btn--sm {
      height: var(--ux-touch-target-sm);
      min-width: var(--ux-touch-target-sm);
      padding: 0 var(--ux-space-sm);
      font-size: 0.8125rem;
    }

    .ux-virtual-keyboard-btn--sm.ux-virtual-keyboard-btn--icon-only {
      width: var(--ux-touch-target-sm);
    }

    .ux-virtual-keyboard-btn--sm .ux-virtual-keyboard-btn__icon {
      width: 16px;
      height: 16px;
    }

    .ux-virtual-keyboard-btn--lg {
      height: 52px;
      min-width: 52px;
      padding: 0 var(--ux-space-lg);
      font-size: 1rem;
    }

    .ux-virtual-keyboard-btn--lg.ux-virtual-keyboard-btn--icon-only {
      width: 52px;
    }

    .ux-virtual-keyboard-btn--lg .ux-virtual-keyboard-btn__icon {
      width: 24px;
      height: 24px;
    }

    /* Color variants */
    .ux-virtual-keyboard-btn--primary {
      background: var(--ux-primary);
      color: var(--ux-primary-contrast);
      border-color: var(--ux-primary);
    }

    .ux-virtual-keyboard-btn--primary:hover {
      background: var(--ux-primary-shade);
    }

    /* Glass variant */
    .ux-virtual-keyboard-btn--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur));
      border-color: var(--ux-glass-border);
    }

    /* Input group integration */
    .ux-input-group .ux-virtual-keyboard-btn {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      margin-left: -1px;
    }

    /* ==========================================================================
       Keyboard Status Indicator
       ========================================================================== */

    .ux-virtual-keyboard-status {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs);
      font-size: 0.75rem;
      color: var(--ux-text-tertiary);
    }

    .ux-virtual-keyboard-status__dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--ux-gray-400);
    }

    .ux-virtual-keyboard-status--supported .ux-virtual-keyboard-status__dot {
      background: var(--ux-success);
    }

    .ux-virtual-keyboard-status--unsupported .ux-virtual-keyboard-status__dot {
      background: var(--ux-danger);
    }
  `;

  // Keyboard icon
  const keyboardIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <rect x="2" y="4" width="20" height="16" rx="2"/>
    <path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01"/>
    <path d="M6 12h.01M10 12h.01M14 12h.01M18 12h.01"/>
    <path d="M8 16h8"/>
  </svg>`;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-virtual-keyboard-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-virtual-keyboard-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const virtualKeyboardData = (options = {}) => ({
    // Configuration
    targetSelector: options.targetSelector || null,
    showAlert: options.showAlert ?? true,
    alertTitle: options.alertTitle || 'Teclado Virtual No Disponible',
    alertMessage: options.alertMessage || 'El teclado virtual no estÃ¡ disponible en este navegador o dispositivo. Requisitos: navegador Chromium (Chrome, Edge) en dispositivo tÃ¡ctil con Windows.',

    // State
    isSupported: false,
    isVisible: false,
    keyboardIcon: keyboardIcon,

    // Lifecycle
    init() {
      this.checkSupport();

      // Listen for keyboard geometry changes if supported
      if ('virtualKeyboard' in navigator) {
        navigator.virtualKeyboard.overlaysContent = true;

        navigator.virtualKeyboard.addEventListener('geometrychange', (e) => {
          const { height } = e.target.boundingRect;
          this.isVisible = height > 0;
          this.$dispatch('virtualkeyboard:change', {
            isVisible: this.isVisible,
            height: height
          });
        });
      }
    },

    // Check API support
    checkSupport() {
      this.isSupported = 'virtualKeyboard' in navigator;
      return this.isSupported;
    },

    // Get detailed support info
    getSupportInfo() {
      return {
        apiAvailable: 'virtualKeyboard' in navigator,
        isSecureContext: window.isSecureContext,
        isTouchDevice: 'ontouchstart' in window || navigator.maxTouchPoints > 0,
        browser: this.detectBrowser(),
        recommendation: this.getRecommendation()
      };
    },

    detectBrowser() {
      const ua = navigator.userAgent;
      if (ua.includes('Edg/')) return 'Edge';
      if (ua.includes('Chrome/')) return 'Chrome';
      if (ua.includes('Firefox/')) return 'Firefox';
      if (ua.includes('Safari/') && !ua.includes('Chrome')) return 'Safari';
      return 'Unknown';
    },

    getRecommendation() {
      const info = {
        apiAvailable: 'virtualKeyboard' in navigator,
        isSecureContext: window.isSecureContext,
        isTouchDevice: 'ontouchstart' in window || navigator.maxTouchPoints > 0
      };

      if (!info.apiAvailable) {
        return 'Usa Chrome o Edge en un dispositivo tÃ¡ctil con Windows.';
      }
      if (!info.isSecureContext) {
        return 'Requiere conexiÃ³n HTTPS segura.';
      }
      if (!info.isTouchDevice) {
        return 'Activa el modo tableta o usa un dispositivo tÃ¡ctil.';
      }
      return 'Todo listo para usar el teclado virtual.';
    },

    // Show virtual keyboard
    async show(targetEl = null) {
      // Find target input
      let target = targetEl;
      if (!target && this.targetSelector) {
        target = document.querySelector(this.targetSelector);
      }
      if (!target) {
        target = document.activeElement;
      }

      // Check if target is focusable
      const focusableSelector = 'input, textarea, [contenteditable="true"]';
      if (!target || !target.matches(focusableSelector)) {
        console.warn('VirtualKeyboard: No focusable element found');
        return false;
      }

      // Check API support
      if (!this.isSupported) {
        if (this.showAlert) {
          this.showUnsupportedAlert();
        }
        this.$dispatch('virtualkeyboard:unsupported', this.getSupportInfo());
        return false;
      }

      // Focus the target and show keyboard
      try {
        target.focus();
        navigator.virtualKeyboard.show();
        this.$dispatch('virtualkeyboard:show', { target });
        return true;
      } catch (error) {
        console.error('VirtualKeyboard: Error showing keyboard', error);
        this.$dispatch('virtualkeyboard:error', { error });
        return false;
      }
    },

    // Hide virtual keyboard
    hide() {
      if (!this.isSupported) return false;

      try {
        navigator.virtualKeyboard.hide();
        this.$dispatch('virtualkeyboard:hide');
        return true;
      } catch (error) {
        console.error('VirtualKeyboard: Error hiding keyboard', error);
        return false;
      }
    },

    // Toggle keyboard
    toggle(targetEl = null) {
      if (this.isVisible) {
        this.hide();
      } else {
        this.show(targetEl);
      }
    },

    // Show alert using UX Alert component
    showUnsupportedAlert() {
      // Try to use uxAlert if available
      if (window.Alpine && document.querySelector('[x-data*="uxAlert"]')) {
        // Dispatch event for external alert handling
        this.$dispatch('virtualkeyboard:alert', {
          title: this.alertTitle,
          message: this.alertMessage
        });
      } else {
        // Create a simple alert modal
        this.createFallbackAlert();
      }
    },

    createFallbackAlert() {
      // Check if alert already exists
      if (document.getElementById('ux-vk-alert')) return;

      const alertHtml = `
        <div id="ux-vk-alert" class="ux-alert-backdrop" style="
          position: fixed;
          inset: 0;
          z-index: var(--ux-z-modal-backdrop, 400);
          background: rgba(0,0,0,0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 1rem;
        ">
          <div class="ux-alert" style="
            background: var(--ux-surface);
            border-radius: 16px;
            padding: 1.5rem;
            max-width: 320px;
            width: 100%;
            text-align: center;
            box-shadow: var(--ux-shadow-xl);
          ">
            <div style="
              width: 48px;
              height: 48px;
              margin: 0 auto 1rem;
              background: var(--ux-warning-tint);
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
            ">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--ux-warning)" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 8v4M12 16h.01"/>
              </svg>
            </div>
            <h3 style="margin: 0 0 0.5rem; font-size: 1.125rem; font-weight: 600; color: var(--ux-text);">
              ${this.alertTitle}
            </h3>
            <p style="margin: 0 0 1.5rem; font-size: 0.9375rem; color: var(--ux-text-secondary); line-height: 1.5;">
              ${this.alertMessage}
            </p>
            <button onclick="document.getElementById('ux-vk-alert').remove()" style="
              width: 100%;
              height: 44px;
              background: var(--ux-primary);
              color: white;
              border: none;
              border-radius: 8px;
              font-size: 1rem;
              font-weight: 500;
              cursor: pointer;
            ">
              Entendido
            </button>
          </div>
        </div>
      `;

      document.body.insertAdjacentHTML('beforeend', alertHtml);

      // Close on backdrop click
      const backdrop = document.getElementById('ux-vk-alert');
      backdrop.addEventListener('click', (e) => {
        if (e.target === backdrop) backdrop.remove();
      });

      // Close on escape
      const escHandler = (e) => {
        if (e.key === 'Escape') {
          backdrop.remove();
          document.removeEventListener('keydown', escHandler);
        }
      };
      document.addEventListener('keydown', escHandler);
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxVirtualKeyboard', virtualKeyboardData);
  }

  // Also expose a simple function for non-Alpine usage
  window.UX = window.UX || {};
  window.UX.showVirtualKeyboard = function(targetSelector) {
    if (!('virtualKeyboard' in navigator)) {
      console.warn('VirtualKeyboard API not supported');
      return false;
    }
    const target = targetSelector ? document.querySelector(targetSelector) : document.activeElement;
    if (target && target.focus) {
      target.focus();
      navigator.virtualKeyboard.show();
      return true;
    }
    return false;
  };
})();

/**
 * UX Virtual List Component
 * Efficient rendering of large lists with virtualization
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ========================================
       UX Virtual List - Base
    ======================================== */

    .ux-virtual-list {
      position: relative;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      font-family: var(--ux-font-family);
    }

    .ux-virtual-list__container {
      position: relative;
      width: 100%;
    }

    .ux-virtual-list__content {
      position: absolute;
      left: 0;
      right: 0;
      width: 100%;
    }

    /* ========================================
       List Items
    ======================================== */

    .ux-virtual-list__item {
      box-sizing: border-box;
    }

    /* ========================================
       Loading States
    ======================================== */

    .ux-virtual-list__loader {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-lg);
      color: var(--ux-text-secondary);
    }

    .ux-virtual-list__spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--ux-border-color);
      border-top-color: var(--ux-primary);
      border-radius: 50%;
      animation: ux-virtual-spin 0.8s linear infinite;
    }

    @keyframes ux-virtual-spin {
      to { transform: rotate(360deg); }
    }

    .ux-virtual-list__loader-text {
      margin-left: var(--ux-space-sm);
      font-size: var(--ux-font-size-sm);
    }

    /* ========================================
       Empty State
    ======================================== */

    .ux-virtual-list__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--ux-space-2xl);
      text-align: center;
    }

    .ux-virtual-list__empty-icon {
      width: 48px;
      height: 48px;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-text-tertiary);
    }

    .ux-virtual-list__empty-title {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      color: var(--ux-text);
      margin: 0 0 var(--ux-space-xs);
    }

    .ux-virtual-list__empty-text {
      font-size: var(--ux-font-size-sm);
      color: var(--ux-text-secondary);
      margin: 0;
    }

    /* ========================================
       Scroll to Top Button
    ======================================== */

    .ux-virtual-list__scroll-top {
      position: absolute;
      bottom: var(--ux-space-md);
      right: var(--ux-space-md);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--ux-surface);
      border: 1px solid var(--ux-border-color);
      border-radius: 50%;
      box-shadow: var(--ux-shadow-md);
      color: var(--ux-text);
      cursor: pointer;
      opacity: 0;
      visibility: hidden;
      transform: translateY(10px);
      transition: all var(--ux-transition-fast) var(--ux-ease);
      z-index: 10;
    }

    .ux-virtual-list__scroll-top--visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .ux-virtual-list__scroll-top:hover {
      background: var(--ux-surface-secondary);
    }

    .ux-virtual-list__scroll-top svg {
      width: 20px;
      height: 20px;
    }

    /* ========================================
       Row Variants
    ======================================== */

    .ux-virtual-list--striped .ux-virtual-list__item:nth-child(even) {
      background: var(--ux-surface-secondary);
    }

    .ux-virtual-list--bordered .ux-virtual-list__item {
      border-bottom: 1px solid var(--ux-border-color);
    }

    .ux-virtual-list--bordered .ux-virtual-list__item:last-child {
      border-bottom: none;
    }

    /* ========================================
       Glass Variant
    ======================================== */

    .ux-virtual-list--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
    }

    /* ========================================
       Reduced Motion
    ======================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-virtual-list__spinner {
        animation: none;
      }

      .ux-virtual-list__scroll-top {
        transition: opacity var(--ux-transition-fast);
        transform: none;
      }
    }
  `;

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-virtual-list-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-virtual-list-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component for virtual list
  const virtualListData = (options = {}) => ({
    // Data
    items: options.items || [],
    itemHeight: options.itemHeight || 50,
    buffer: options.buffer || 5,

    // State
    visibleItems: [],
    startIndex: 0,
    endIndex: 0,
    scrollTop: 0,
    containerHeight: 0,
    totalHeight: 0,

    // Options
    loading: options.loading || false,
    loadingText: options.loadingText || 'Cargando...',
    emptyTitle: options.emptyTitle || 'Sin elementos',
    emptyText: options.emptyText || 'No hay elementos para mostrar.',
    showScrollTop: options.showScrollTop ?? true,
    scrollTopThreshold: options.scrollTopThreshold || 300,

    // Infinite scroll
    hasMore: options.hasMore ?? false,
    loadMore: options.loadMore || null,
    loadingMore: false,
    infiniteScrollThreshold: options.infiniteScrollThreshold || 200,

    init() {
      this.$nextTick(() => {
        this.containerHeight = this.$el.clientHeight;
        this.calculateVisibleItems();
      });

      // Set up scroll listener
      this._scrollHandler = this.onScroll.bind(this);
      this.$el.addEventListener('scroll', this._scrollHandler, { passive: true });

      // Set up resize observer
      if (typeof ResizeObserver !== 'undefined') {
        this._resizeObserver = new ResizeObserver(() => {
          this.containerHeight = this.$el.clientHeight;
          this.calculateVisibleItems();
        });
        this._resizeObserver.observe(this.$el);
      }
    },

    destroy() {
      if (this._scrollHandler) {
        this.$el.removeEventListener('scroll', this._scrollHandler);
      }
      if (this._resizeObserver) {
        this._resizeObserver.disconnect();
      }
    },

    // Calculate which items should be visible
    calculateVisibleItems() {
      if (this.items.length === 0) {
        this.visibleItems = [];
        this.totalHeight = 0;
        return;
      }

      this.totalHeight = this.items.length * this.itemHeight;

      const visibleCount = Math.ceil(this.containerHeight / this.itemHeight);
      this.startIndex = Math.max(0, Math.floor(this.scrollTop / this.itemHeight) - this.buffer);
      this.endIndex = Math.min(this.items.length, this.startIndex + visibleCount + (this.buffer * 2));

      this.visibleItems = this.items.slice(this.startIndex, this.endIndex).map((item, index) => ({
        ...item,
        _virtualIndex: this.startIndex + index,
        _top: (this.startIndex + index) * this.itemHeight
      }));
    },

    // Handle scroll event
    onScroll() {
      this.scrollTop = this.$el.scrollTop;
      this.calculateVisibleItems();

      // Infinite scroll
      if (this.hasMore && !this.loadingMore && this.loadMore) {
        const scrollBottom = this.$el.scrollHeight - this.$el.scrollTop - this.$el.clientHeight;
        if (scrollBottom < this.infiniteScrollThreshold) {
          this.triggerLoadMore();
        }
      }

      // Dispatch scroll event
      this.$dispatch('virtuallist:scroll', {
        scrollTop: this.scrollTop,
        startIndex: this.startIndex,
        endIndex: this.endIndex
      });
    },

    // Trigger load more
    async triggerLoadMore() {
      if (this.loadingMore || !this.hasMore) return;

      this.loadingMore = true;
      this.$dispatch('virtuallist:loadmore');

      if (typeof this.loadMore === 'function') {
        try {
          await this.loadMore();
        } catch (error) {
          console.error('Virtual list load more error:', error);
        }
      }

      this.loadingMore = false;
    },

    // Scroll to index
    scrollToIndex(index, behavior = 'smooth') {
      const targetTop = index * this.itemHeight;
      this.$el.scrollTo({
        top: targetTop,
        behavior
      });
    },

    // Scroll to top
    scrollToTop(behavior = 'smooth') {
      this.$el.scrollTo({
        top: 0,
        behavior
      });
    },

    // Check if scroll-to-top button should be visible
    get showScrollTopButton() {
      return this.showScrollTop && this.scrollTop > this.scrollTopThreshold;
    },

    // Get transform style for content
    get contentStyle() {
      return {
        transform: `translateY(${this.startIndex * this.itemHeight}px)`
      };
    },

    // Get container style
    get containerStyle() {
      return {
        height: `${this.totalHeight}px`
      };
    },

    // Update items
    setItems(newItems) {
      this.items = newItems;
      this.calculateVisibleItems();
    },

    // Add items
    addItems(newItems) {
      this.items = [...this.items, ...newItems];
      this.calculateVisibleItems();
    },

    // Prepend items
    prependItems(newItems) {
      this.items = [...newItems, ...this.items];
      this.calculateVisibleItems();
    },

    // Remove item
    removeItem(index) {
      this.items.splice(index, 1);
      this.calculateVisibleItems();
    },

    // Update item
    updateItem(index, updates) {
      if (index >= 0 && index < this.items.length) {
        this.items[index] = { ...this.items[index], ...updates };
        this.calculateVisibleItems();
      }
    },

    // Get item at index
    getItem(index) {
      return this.items[index];
    },

    // Get visible range
    getVisibleRange() {
      return {
        start: this.startIndex,
        end: this.endIndex,
        count: this.endIndex - this.startIndex
      };
    },

    // Check if item is visible
    isItemVisible(index) {
      return index >= this.startIndex && index < this.endIndex;
    },

    // Get current scroll percentage
    get scrollPercentage() {
      if (this.totalHeight <= this.containerHeight) return 100;
      return Math.round((this.scrollTop / (this.totalHeight - this.containerHeight)) * 100);
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxVirtualList', virtualListData);
  }

})();

/**
 * UX Work Order Card Component
 * Work order cards for manufacturing and production systems
 * @requires ux-core.js
 */
(function() {
  'use strict';

  const styles = `
    /* ==========================================================================
       Work Order Variables
       ========================================================================== */

    :root {
      --ux-work-order-width: 360px;
      --ux-work-order-padding: var(--ux-space-md);
      --ux-work-order-border-radius: var(--ux-radius-lg, 12px);
      --ux-work-order-font-family: var(--ux-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);

      /* Status colors */
      --ux-work-order-pending: var(--ux-gray-500, #6b7280);
      --ux-work-order-pending-bg: rgba(107, 114, 128, 0.1);
      --ux-work-order-in-progress: var(--ux-primary, #3b82f6);
      --ux-work-order-in-progress-bg: rgba(59, 130, 246, 0.1);
      --ux-work-order-completed: var(--ux-success, #22c55e);
      --ux-work-order-completed-bg: rgba(34, 197, 94, 0.1);
      --ux-work-order-on-hold: var(--ux-warning, #f59e0b);
      --ux-work-order-on-hold-bg: rgba(245, 158, 11, 0.1);

      /* Priority colors */
      --ux-work-order-priority-low: var(--ux-gray-400, #9ca3af);
      --ux-work-order-priority-normal: var(--ux-primary, #3b82f6);
      --ux-work-order-priority-high: var(--ux-warning, #f59e0b);
      --ux-work-order-priority-urgent: var(--ux-danger, #ef4444);
    }

    /* ==========================================================================
       Work Order Container
       ========================================================================== */

    .ux-work-order {
      position: relative;
      display: flex;
      flex-direction: column;
      width: var(--ux-work-order-width);
      background-color: var(--ux-surface, #ffffff);
      border-radius: var(--ux-work-order-border-radius);
      box-shadow: var(--ux-shadow-md, 0 4px 6px -1px rgba(0, 0, 0, 0.1));
      overflow: hidden;
      font-family: var(--ux-work-order-font-family);
      transition: box-shadow var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
    }

    .ux-work-order:hover {
      box-shadow: var(--ux-shadow-lg, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
    }

    /* Priority indicator strip */
    .ux-work-order::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 4px;
      background-color: var(--ux-work-order-priority-color, var(--ux-work-order-priority-normal));
    }

    /* ==========================================================================
       Work Order Header
       ========================================================================== */

    .ux-work-order__header {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs, 4px);
      padding: var(--ux-work-order-padding);
      padding-left: calc(var(--ux-work-order-padding) + 8px);
      border-bottom: 1px solid var(--ux-border-color, #e5e7eb);
    }

    .ux-work-order__header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--ux-space-sm, 8px);
    }

    .ux-work-order__number {
      font-size: var(--ux-font-size-lg, 1.125rem);
      font-weight: 700;
      color: var(--ux-text, #111827);
      margin: 0;
      font-variant-numeric: tabular-nums;
    }

    .ux-work-order__status {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs, 4px);
      padding: 4px 10px;
      border-radius: 9999px;
      font-size: var(--ux-font-size-xs, 0.75rem);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background-color: var(--ux-work-order-status-bg, var(--ux-work-order-pending-bg));
      color: var(--ux-work-order-status-color, var(--ux-work-order-pending));
    }

    .ux-work-order__status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: currentColor;
    }

    .ux-work-order__status--pulse .ux-work-order__status-dot {
      animation: ux-work-order-pulse 1.5s ease-in-out infinite;
    }

    @keyframes ux-work-order-pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    /* Status variants */
    .ux-work-order__status--pending {
      --ux-work-order-status-bg: var(--ux-work-order-pending-bg);
      --ux-work-order-status-color: var(--ux-work-order-pending);
    }

    .ux-work-order__status--in-progress {
      --ux-work-order-status-bg: var(--ux-work-order-in-progress-bg);
      --ux-work-order-status-color: var(--ux-work-order-in-progress);
    }

    .ux-work-order__status--completed {
      --ux-work-order-status-bg: var(--ux-work-order-completed-bg);
      --ux-work-order-status-color: var(--ux-work-order-completed);
    }

    .ux-work-order__status--on-hold {
      --ux-work-order-status-bg: var(--ux-work-order-on-hold-bg);
      --ux-work-order-status-color: var(--ux-work-order-on-hold);
    }

    /* Product info */
    .ux-work-order__product {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-top: var(--ux-space-xs, 4px);
    }

    .ux-work-order__product-name {
      font-size: var(--ux-font-size-md, 1rem);
      font-weight: 600;
      color: var(--ux-text, #111827);
      line-height: 1.3;
      margin: 0;
    }

    .ux-work-order__product-sku {
      font-size: var(--ux-font-size-xs, 0.75rem);
      font-family: monospace;
      color: var(--ux-text-tertiary, #9ca3af);
    }

    /* ==========================================================================
       Work Order Priority
       ========================================================================== */

    .ux-work-order__priority {
      display: inline-flex;
      align-items: center;
      gap: var(--ux-space-xs, 4px);
      font-size: var(--ux-font-size-xs, 0.75rem);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-work-order__priority-icon {
      width: 12px;
      height: 12px;
    }

    .ux-work-order__priority-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-work-order__priority--low {
      color: var(--ux-work-order-priority-low);
    }

    .ux-work-order__priority--normal {
      color: var(--ux-work-order-priority-normal);
    }

    .ux-work-order__priority--high {
      color: var(--ux-work-order-priority-high);
    }

    .ux-work-order__priority--urgent {
      color: var(--ux-work-order-priority-urgent);
    }

    /* Priority strip variants */
    .ux-work-order--priority-low {
      --ux-work-order-priority-color: var(--ux-work-order-priority-low);
    }

    .ux-work-order--priority-normal {
      --ux-work-order-priority-color: var(--ux-work-order-priority-normal);
    }

    .ux-work-order--priority-high {
      --ux-work-order-priority-color: var(--ux-work-order-priority-high);
    }

    .ux-work-order--priority-urgent {
      --ux-work-order-priority-color: var(--ux-work-order-priority-urgent);
      box-shadow: 0 0 0 2px var(--ux-work-order-priority-urgent),
                  var(--ux-shadow-md, 0 4px 6px -1px rgba(0, 0, 0, 0.1));
    }

    .ux-work-order--priority-urgent::before {
      animation: ux-work-order-urgent-strip 1.5s ease-in-out infinite;
    }

    @keyframes ux-work-order-urgent-strip {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* ==========================================================================
       Work Order Content
       ========================================================================== */

    .ux-work-order__content {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md, 16px);
      padding: var(--ux-work-order-padding);
      padding-left: calc(var(--ux-work-order-padding) + 8px);
    }

    /* ==========================================================================
       Quantity Section
       ========================================================================== */

    .ux-work-order__quantities {
      display: flex;
      align-items: center;
      gap: var(--ux-space-lg, 24px);
    }

    .ux-work-order__quantity {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ux-work-order__quantity-label {
      font-size: var(--ux-font-size-xs, 0.75rem);
      color: var(--ux-text-tertiary, #9ca3af);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ux-work-order__quantity-value {
      font-size: var(--ux-font-size-xl, 1.25rem);
      font-weight: 700;
      color: var(--ux-text, #111827);
      font-variant-numeric: tabular-nums;
    }

    .ux-work-order__quantity-value--completed {
      color: var(--ux-success, #22c55e);
    }

    .ux-work-order__quantity-value--remaining {
      color: var(--ux-text-secondary, #6b7280);
    }

    /* ==========================================================================
       Progress Section
       ========================================================================== */

    .ux-work-order__progress {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs, 4px);
    }

    .ux-work-order__progress-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .ux-work-order__progress-label {
      font-size: var(--ux-font-size-sm, 0.875rem);
      color: var(--ux-text-secondary, #6b7280);
    }

    .ux-work-order__progress-value {
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 600;
      color: var(--ux-text, #111827);
      font-variant-numeric: tabular-nums;
    }

    .ux-work-order__progress-bar {
      width: 100%;
      height: 8px;
      background-color: var(--ux-light, #f3f4f6);
      border-radius: 4px;
      overflow: hidden;
    }

    .ux-work-order__progress-fill {
      height: 100%;
      background-color: var(--ux-primary, #3b82f6);
      border-radius: 4px;
      transition: width var(--ux-transition-normal, 200ms) var(--ux-ease, ease);
    }

    .ux-work-order__progress-fill--success {
      background-color: var(--ux-success, #22c55e);
    }

    .ux-work-order__progress-fill--warning {
      background-color: var(--ux-warning, #f59e0b);
    }

    /* ==========================================================================
       Due Date Section
       ========================================================================== */

    .ux-work-order__due-date {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs, 4px);
      font-size: var(--ux-font-size-sm, 0.875rem);
      color: var(--ux-text-secondary, #6b7280);
    }

    .ux-work-order__due-date-icon {
      width: 14px;
      height: 14px;
      opacity: 0.7;
    }

    .ux-work-order__due-date-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-work-order__due-date--overdue {
      color: var(--ux-danger, #ef4444);
      font-weight: 600;
    }

    .ux-work-order__due-date--warning {
      color: var(--ux-warning, #f59e0b);
      font-weight: 500;
    }

    .ux-work-order__due-date--overdue .ux-work-order__due-date-icon,
    .ux-work-order__due-date--warning .ux-work-order__due-date-icon {
      opacity: 1;
    }

    /* ==========================================================================
       Machine/Workstation Section
       ========================================================================== */

    .ux-work-order__machine {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs, 4px);
      font-size: var(--ux-font-size-sm, 0.875rem);
      color: var(--ux-text-secondary, #6b7280);
    }

    .ux-work-order__machine-icon {
      width: 14px;
      height: 14px;
      opacity: 0.7;
    }

    .ux-work-order__machine-icon svg {
      width: 100%;
      height: 100%;
    }

    .ux-work-order__machine-name {
      font-weight: 500;
      color: var(--ux-text, #111827);
    }

    /* ==========================================================================
       Materials/BOM Section
       ========================================================================== */

    .ux-work-order__materials {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs, 4px);
    }

    .ux-work-order__materials-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 600;
      color: var(--ux-text, #111827);
    }

    .ux-work-order__materials-count {
      font-size: var(--ux-font-size-xs, 0.75rem);
      color: var(--ux-text-tertiary, #9ca3af);
      font-weight: 400;
    }

    .ux-work-order__materials-list {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-xs, 4px);
      padding: 0;
      margin: 0;
      list-style: none;
    }

    .ux-work-order__material {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-xs, 4px) var(--ux-space-sm, 8px);
      background-color: var(--ux-surface-secondary, #f9fafb);
      border-radius: var(--ux-border-radius, 6px);
      font-size: var(--ux-font-size-sm, 0.875rem);
    }

    .ux-work-order__material-name {
      color: var(--ux-text, #111827);
    }

    .ux-work-order__material-qty {
      color: var(--ux-text-secondary, #6b7280);
      font-variant-numeric: tabular-nums;
    }

    .ux-work-order__material--shortage {
      background-color: rgba(239, 68, 68, 0.1);
    }

    .ux-work-order__material--shortage .ux-work-order__material-qty {
      color: var(--ux-danger, #ef4444);
      font-weight: 600;
    }

    /* ==========================================================================
       Meta Section (row of metadata items)
       ========================================================================== */

    .ux-work-order__meta {
      display: flex;
      flex-wrap: wrap;
      gap: var(--ux-space-md, 16px);
    }

    .ux-work-order__meta-item {
      display: flex;
      align-items: center;
      gap: var(--ux-space-xs, 4px);
      font-size: var(--ux-font-size-sm, 0.875rem);
      color: var(--ux-text-secondary, #6b7280);
    }

    .ux-work-order__meta-icon {
      width: 14px;
      height: 14px;
      opacity: 0.7;
    }

    .ux-work-order__meta-icon svg {
      width: 100%;
      height: 100%;
    }

    /* ==========================================================================
       Actions Section
       ========================================================================== */

    .ux-work-order__actions {
      display: flex;
      align-items: center;
      gap: var(--ux-space-sm, 8px);
      padding: var(--ux-work-order-padding);
      padding-left: calc(var(--ux-work-order-padding) + 8px);
      border-top: 1px solid var(--ux-border-color, #e5e7eb);
    }

    .ux-work-order__action {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ux-space-xs, 4px);
      padding: var(--ux-space-sm, 8px) var(--ux-space-md, 16px);
      border: none;
      border-radius: 8px;
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--ux-transition-fast, 150ms) var(--ux-ease, ease);
      -webkit-tap-highlight-color: transparent;
    }

    .ux-work-order__action--start {
      background-color: var(--ux-primary, #3b82f6);
      color: white;
    }

    .ux-work-order__action--start:hover {
      background-color: var(--ux-primary-shade, #2563eb);
    }

    .ux-work-order__action--pause {
      background-color: var(--ux-warning, #f59e0b);
      color: white;
    }

    .ux-work-order__action--pause:hover {
      background-color: var(--ux-warning-shade, #d97706);
    }

    .ux-work-order__action--complete {
      background-color: var(--ux-success, #22c55e);
      color: white;
    }

    .ux-work-order__action--complete:hover {
      background-color: var(--ux-success-shade, #16a34a);
    }

    .ux-work-order__action--secondary {
      background-color: var(--ux-surface-tertiary, #e5e7eb);
      color: var(--ux-text, #111827);
    }

    .ux-work-order__action--secondary:hover {
      background-color: var(--ux-border-color, #d1d5db);
    }

    .ux-work-order__action:active {
      transform: scale(0.98);
    }

    .ux-work-order__action:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .ux-work-order__action-icon {
      width: 16px;
      height: 16px;
    }

    .ux-work-order__action-icon svg {
      width: 100%;
      height: 100%;
    }

    /* ==========================================================================
       Compact Variant
       ========================================================================== */

    .ux-work-order--compact {
      --ux-work-order-padding: var(--ux-space-sm, 8px);
    }

    .ux-work-order--compact .ux-work-order__number {
      font-size: var(--ux-font-size-md, 1rem);
    }

    .ux-work-order--compact .ux-work-order__product-name {
      font-size: var(--ux-font-size-sm, 0.875rem);
    }

    .ux-work-order--compact .ux-work-order__quantities {
      gap: var(--ux-space-md, 16px);
    }

    .ux-work-order--compact .ux-work-order__quantity-value {
      font-size: var(--ux-font-size-lg, 1.125rem);
    }

    .ux-work-order--compact .ux-work-order__materials {
      display: none;
    }

    .ux-work-order--compact .ux-work-order__content {
      gap: var(--ux-space-sm, 8px);
    }

    /* ==========================================================================
       Detailed Variant
       ========================================================================== */

    .ux-work-order--detailed {
      --ux-work-order-width: 420px;
    }

    .ux-work-order--detailed .ux-work-order__header {
      background-color: var(--ux-surface-secondary, #f9fafb);
    }

    /* ==========================================================================
       Full Width
       ========================================================================== */

    .ux-work-order--full {
      --ux-work-order-width: 100%;
    }

    /* ==========================================================================
       Glass Variant (iOS 26 Liquid Glass)
       ========================================================================== */

    .ux-work-order--glass {
      box-shadow: var(--ux-glass-shadow, 0 8px 32px rgba(0, 0, 0, 0.08)),
                  var(--ux-glass-highlight, inset 0 1px 0 rgba(255, 255, 255, 0.5));
      border: 0.5px solid var(--ux-glass-border, rgba(255, 255, 255, 0.18));
    }

    .ux-work-order--glass .ux-work-order__header {
      background: var(--ux-glass-bg-thin, rgba(255, 255, 255, 0.5));
      border-bottom-color: var(--ux-glass-border, rgba(255, 255, 255, 0.18));
    }

    .ux-work-order--glass .ux-work-order__actions {
      background: var(--ux-glass-bg-thin, rgba(255, 255, 255, 0.5));
      border-top-color: var(--ux-glass-border, rgba(255, 255, 255, 0.18));
    }

    .ux-work-order--glass .ux-work-order__material {
      background: var(--ux-glass-bg-thin, rgba(255, 255, 255, 0.5));
    }

    .ux-work-order--glass .ux-work-order__progress-bar {
      background: var(--ux-glass-bg-thin, rgba(255, 255, 255, 0.5));
    }

    /* ==========================================================================
       Work Order Grid
       ========================================================================== */

    .ux-work-order-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(var(--ux-work-order-width), 1fr));
      gap: var(--ux-space-lg, 24px);
      padding: var(--ux-space-md, 16px);
    }

    .ux-work-order-grid .ux-work-order {
      width: 100%;
    }

    /* Kanban-style columns */
    .ux-work-order-column {
      display: flex;
      flex-direction: column;
      gap: var(--ux-space-md, 16px);
      min-width: var(--ux-work-order-width);
      padding: var(--ux-space-md, 16px);
      background-color: var(--ux-surface-secondary, #f9fafb);
      border-radius: var(--ux-border-radius-lg, 12px);
    }

    .ux-work-order-column__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ux-space-sm, 8px);
      font-size: var(--ux-font-size-sm, 0.875rem);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--ux-text-secondary, #6b7280);
    }

    .ux-work-order-column__count {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 24px;
      padding: 0 8px;
      border-radius: 12px;
      font-size: var(--ux-font-size-xs, 0.75rem);
      font-weight: 700;
      background-color: var(--ux-surface-tertiary, #e5e7eb);
      color: var(--ux-text, #111827);
    }

    /* ==========================================================================
       Dark Mode
       ========================================================================== */

    @media (prefers-color-scheme: dark) {
      :root:not(.ux-light):not(.ux-theme-light) {
        --ux-work-order-pending-bg: rgba(107, 114, 128, 0.2);
        --ux-work-order-in-progress-bg: rgba(59, 130, 246, 0.2);
        --ux-work-order-completed-bg: rgba(34, 197, 94, 0.2);
        --ux-work-order-on-hold-bg: rgba(245, 158, 11, 0.2);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-work-order__material {
        background-color: var(--ux-gray-800, #1f2937);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-work-order__action--secondary {
        background-color: var(--ux-gray-700, #374151);
        color: var(--ux-gray-100, #f3f4f6);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-work-order__action--secondary:hover {
        background-color: var(--ux-gray-600, #4b5563);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-work-order-column {
        background-color: var(--ux-gray-800, #1f2937);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-work-order-column__count {
        background-color: var(--ux-gray-700, #374151);
        color: var(--ux-gray-100, #f3f4f6);
      }

      :root:not(.ux-light):not(.ux-theme-light) .ux-work-order__progress-bar {
        background-color: var(--ux-gray-700, #374151);
      }
    }

    .ux-dark .ux-work-order__material,
    .ux-theme-dark .ux-work-order__material {
      background-color: var(--ux-gray-800, #1f2937);
    }

    .ux-dark .ux-work-order__action--secondary,
    .ux-theme-dark .ux-work-order__action--secondary {
      background-color: var(--ux-gray-700, #374151);
      color: var(--ux-gray-100, #f3f4f6);
    }

    .ux-dark .ux-work-order__action--secondary:hover,
    .ux-theme-dark .ux-work-order__action--secondary:hover {
      background-color: var(--ux-gray-600, #4b5563);
    }

    .ux-dark .ux-work-order-column,
    .ux-theme-dark .ux-work-order-column {
      background-color: var(--ux-gray-800, #1f2937);
    }

    .ux-dark .ux-work-order-column__count,
    .ux-theme-dark .ux-work-order-column__count {
      background-color: var(--ux-gray-700, #374151);
      color: var(--ux-gray-100, #f3f4f6);
    }

    .ux-dark .ux-work-order__progress-bar,
    .ux-theme-dark .ux-work-order__progress-bar {
      background-color: var(--ux-gray-700, #374151);
    }

    /* ==========================================================================
       Reduced Motion
       ========================================================================== */

    @media (prefers-reduced-motion: reduce) {
      .ux-work-order,
      .ux-work-order__action,
      .ux-work-order__progress-fill {
        transition: none;
      }

      .ux-work-order__status--pulse .ux-work-order__status-dot,
      .ux-work-order--priority-urgent::before {
        animation: none;
      }
    }
  `;

  // Icons
  const icons = {
    play: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>',
    pause: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>',
    check: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',
    clock: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
    calendar: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>',
    machine: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="6" width="20" height="12" rx="2"/><line x1="6" y1="10" x2="6" y2="14"/><line x1="10" y1="10" x2="10" y2="14"/><circle cx="17" cy="12" r="2"/></svg>',
    warning: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',
    flag: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>',
    package: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>'
  };

  // Inject styles
  if (window.UX) {
    window.UX.injectStyles('ux-work-order-styles', styles);
  } else {
    const styleEl = document.createElement('style');
    styleEl.id = 'ux-work-order-styles';
    styleEl.textContent = styles;
    document.head.appendChild(styleEl);
  }

  // Alpine.js component
  const workOrderData = (options = {}) => ({
    // Work order identification
    workOrderNumber: options.workOrderNumber || options.number || '',
    workOrderId: options.workOrderId || options.id || null,

    // Product information
    product: {
      name: options.product?.name || '',
      sku: options.product?.sku || '',
      description: options.product?.description || '',
      ...options.product
    },

    // Status: 'pending', 'in-progress', 'completed', 'on-hold'
    status: options.status || 'pending',

    // Priority: 'low', 'normal', 'high', 'urgent'
    priority: options.priority || 'normal',

    // Quantities
    quantityOrdered: options.quantityOrdered || options.ordered || 0,
    quantityCompleted: options.quantityCompleted || options.completed || 0,

    // Due date
    dueDate: options.dueDate ? new Date(options.dueDate) : null,

    // Machine/Workstation
    machine: options.machine || options.workstation || null,

    // Materials/BOM
    materials: options.materials || [],

    // Notes
    notes: options.notes || '',

    // Timer
    startedAt: options.startedAt ? new Date(options.startedAt) : null,
    elapsedTime: 0,
    timerInterval: null,

    // Configuration
    showMaterials: options.showMaterials ?? true,
    showProgress: options.showProgress ?? true,
    showActions: options.showActions ?? true,

    // Labels
    labels: {
      ordered: options.labels?.ordered || 'Ordered',
      completed: options.labels?.completed || 'Completed',
      remaining: options.labels?.remaining || 'Remaining',
      progress: options.labels?.progress || 'Progress',
      dueDate: options.labels?.dueDate || 'Due',
      overdue: options.labels?.overdue || 'Overdue',
      dueSoon: options.labels?.dueSoon || 'Due soon',
      machine: options.labels?.machine || 'Machine',
      materials: options.labels?.materials || 'Materials',
      start: options.labels?.start || 'Start',
      pause: options.labels?.pause || 'Pause',
      resume: options.labels?.resume || 'Resume',
      complete: options.labels?.complete || 'Complete',
      pending: options.labels?.pending || 'Pending',
      inProgress: options.labels?.inProgress || 'In Progress',
      onHold: options.labels?.onHold || 'On Hold',
      low: options.labels?.low || 'Low',
      normal: options.labels?.normal || 'Normal',
      high: options.labels?.high || 'High',
      urgent: options.labels?.urgent || 'Urgent',
      ...options.labels
    },

    // Lifecycle
    init() {
      if (this.status === 'in-progress' && this.startedAt) {
        this.startTimer();
      }
    },

    destroy() {
      this.stopTimer();
    },

    // Computed properties
    get quantityRemaining() {
      return Math.max(0, this.quantityOrdered - this.quantityCompleted);
    },

    get progressPercent() {
      if (this.quantityOrdered === 0) return 0;
      return Math.min(100, Math.round((this.quantityCompleted / this.quantityOrdered) * 100));
    },

    get isOverdue() {
      if (!this.dueDate) return false;
      return new Date() > this.dueDate && this.status !== 'completed';
    },

    get isDueSoon() {
      if (!this.dueDate || this.isOverdue) return false;
      const now = new Date();
      const hoursUntilDue = (this.dueDate - now) / (1000 * 60 * 60);
      return hoursUntilDue <= 24 && hoursUntilDue > 0;
    },

    get formattedDueDate() {
      if (!this.dueDate) return '';
      return this.dueDate.toLocaleDateString(undefined, {
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    },

    get dueDateStatus() {
      if (this.isOverdue) return 'overdue';
      if (this.isDueSoon) return 'warning';
      return 'normal';
    },

    get statusLabel() {
      const statusLabels = {
        'pending': this.labels.pending,
        'in-progress': this.labels.inProgress,
        'completed': this.labels.completed,
        'on-hold': this.labels.onHold
      };
      return statusLabels[this.status] || this.status;
    },

    get priorityLabel() {
      const priorityLabels = {
        'low': this.labels.low,
        'normal': this.labels.normal,
        'high': this.labels.high,
        'urgent': this.labels.urgent
      };
      return priorityLabels[this.priority] || this.priority;
    },

    get materialsWithShortage() {
      return this.materials.filter(m => m.shortage || (m.available !== undefined && m.required > m.available));
    },

    get hasShortage() {
      return this.materialsWithShortage.length > 0;
    },

    // Timer methods
    startTimer() {
      if (this.timerInterval) return;

      const startTime = this.startedAt ? new Date(this.startedAt).getTime() : Date.now();

      this.timerInterval = setInterval(() => {
        this.elapsedTime = Math.floor((Date.now() - startTime) / 1000);
      }, 1000);

      this.elapsedTime = Math.floor((Date.now() - startTime) / 1000);
    },

    stopTimer() {
      if (this.timerInterval) {
        clearInterval(this.timerInterval);
        this.timerInterval = null;
      }
    },

    get formattedElapsedTime() {
      const hours = Math.floor(this.elapsedTime / 3600);
      const minutes = Math.floor((this.elapsedTime % 3600) / 60);
      const seconds = this.elapsedTime % 60;

      if (hours > 0) {
        return `${hours}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }
      return `${minutes}:${String(seconds).padStart(2, '0')}`;
    },

    // Status methods
    setStatus(newStatus) {
      const validStatuses = ['pending', 'in-progress', 'completed', 'on-hold'];
      if (!validStatuses.includes(newStatus)) return;

      const oldStatus = this.status;
      this.status = newStatus;

      if (newStatus === 'in-progress' && !this.startedAt) {
        this.startedAt = new Date();
        this.startTimer();
      } else if (newStatus === 'completed' || newStatus === 'on-hold') {
        this.stopTimer();
      }

      this.$dispatch('work-order:status-change', {
        workOrderId: this.workOrderId,
        workOrderNumber: this.workOrderNumber,
        oldStatus,
        newStatus
      });
    },

    start() {
      this.setStatus('in-progress');
    },

    pause() {
      this.setStatus('on-hold');
    },

    resume() {
      this.setStatus('in-progress');
    },

    complete() {
      this.quantityCompleted = this.quantityOrdered;
      this.setStatus('completed');
    },

    // Quantity methods
    incrementCompleted(amount = 1) {
      const newQty = Math.min(this.quantityOrdered, this.quantityCompleted + amount);
      this.quantityCompleted = newQty;

      this.$dispatch('work-order:quantity-change', {
        workOrderId: this.workOrderId,
        workOrderNumber: this.workOrderNumber,
        quantityCompleted: this.quantityCompleted,
        quantityRemaining: this.quantityRemaining
      });

      if (this.quantityCompleted >= this.quantityOrdered) {
        this.complete();
      }
    },

    setCompleted(qty) {
      this.quantityCompleted = Math.min(this.quantityOrdered, Math.max(0, qty));

      this.$dispatch('work-order:quantity-change', {
        workOrderId: this.workOrderId,
        workOrderNumber: this.workOrderNumber,
        quantityCompleted: this.quantityCompleted,
        quantityRemaining: this.quantityRemaining
      });
    },

    // Get icon
    getIcon(name) {
      return icons[name] || '';
    },

    // Get data
    getData() {
      return {
        workOrderId: this.workOrderId,
        workOrderNumber: this.workOrderNumber,
        product: this.product,
        status: this.status,
        priority: this.priority,
        quantityOrdered: this.quantityOrdered,
        quantityCompleted: this.quantityCompleted,
        quantityRemaining: this.quantityRemaining,
        progressPercent: this.progressPercent,
        dueDate: this.dueDate,
        isOverdue: this.isOverdue,
        machine: this.machine,
        materials: this.materials,
        notes: this.notes,
        startedAt: this.startedAt,
        elapsedTime: this.elapsedTime
      };
    }
  });

  // Register component
  if (window.UX) {
    window.UX.registerComponent('uxWorkOrder', workOrderData);
  }
})();
