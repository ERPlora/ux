<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Snackbar - UX Library</title>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="../components/ux-core.js"></script>
  <script src="../components/ux-button.js"></script>
  <script src="../components/ux-navbar.js"></script>
  <script src="../components/ux-content.js"></script>
  <script src="../components/ux-snackbar.js"></script>
  <script src="../components/ux-code-block.js"></script>
  <style>
    .demo-section { margin-bottom: var(--ux-space-xl); }
    .demo-section h3 { font-size: var(--ux-font-size-lg); font-weight: 600; margin-bottom: var(--ux-space-md); }
    .demo-section p { font-size: var(--ux-font-size-md); color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md); }
    .demo-box { background: var(--ux-surface-secondary); border-radius: var(--ux-border-radius-lg); padding: var(--ux-space-lg); margin-bottom: var(--ux-space-md); display: flex; flex-wrap: wrap; gap: var(--ux-space-md); }
  </style>
</head>
<body class="ux-app">

  <div class="ux-content" style="padding: var(--ux-space-lg);">
    <h2 style="margin-bottom: var(--ux-space-lg);">Snackbar</h2>
    <p style="color: var(--ux-text-secondary); margin-bottom: var(--ux-space-xl);">Notificaciones temporales con accion opcional. Aparecen en la parte inferior y permiten al usuario realizar una accion o descartar el mensaje.</p>

    <section class="demo-section">
      <h3>Basico (JavaScript API)</h3>
      <p>Usar la API global <code>UXSnackbar.show()</code> para mostrar snackbars.</p>
      <div class="demo-box">
        <button class="ux-button" onclick="UXSnackbar.show({ message: 'Este es un snackbar basico' })">
          Show Snackbar
        </button>
        <button class="ux-button" onclick="UXSnackbar.show({ message: 'Mensaje enviado correctamente', duration: 2000 })">
          Short Duration (2s)
        </button>
        <button class="ux-button" onclick="UXSnackbar.show({ message: 'Este se queda hasta cerrarlo', duration: 0, closable: true })">
          No Auto-dismiss
        </button>
      </div>
      <pre class="ux-code-block" data-lang="javascript">// Basico
UXSnackbar.show({ message: 'Mensaje enviado' });

// Con opciones
UXSnackbar.show({
  message: 'Archivo eliminado',
  duration: 4000,  // ms, 0 = no auto-dismiss
  closable: true
});</pre>
    </section>

    <section class="demo-section">
      <h3>Con Accion</h3>
      <p>Snackbar con boton de accion.</p>
      <div class="demo-box">
        <button class="ux-button" onclick="UXSnackbar.show({
          message: 'Elemento eliminado',
          actionLabel: 'Deshacer',
          onAction: () => alert('Deshacer!')
        })">
          With Action
        </button>
        <button class="ux-button" onclick="UXSnackbar.show({
          message: 'Cambios guardados',
          actionLabel: 'Ver',
          actionColor: 'success',
          onAction: () => console.log('Ver clicked')
        })">
          Success Action
        </button>
      </div>
      <pre class="ux-code-block" data-lang="javascript">UXSnackbar.show({
  message: 'Elemento eliminado',
  actionLabel: 'Deshacer',
  onAction: () => {
    // Restaurar elemento
  }
});</pre>
    </section>

    <section class="demo-section">
      <h3>Tipos / Colores</h3>
      <div class="demo-box">
        <button class="ux-button" onclick="UXSnackbar.show({ message: 'Operacion exitosa', type: 'success' })">
          Success
        </button>
        <button class="ux-button" onclick="UXSnackbar.show({ message: 'Atencion: revisar datos', type: 'warning' })">
          Warning
        </button>
        <button class="ux-button" onclick="UXSnackbar.show({ message: 'Error al procesar', type: 'danger' })">
          Danger
        </button>
        <button class="ux-button" onclick="UXSnackbar.show({ message: 'Nueva version disponible', type: 'info', actionLabel: 'Actualizar' })">
          Info
        </button>
      </div>
    </section>

    <section class="demo-section">
      <h3>Con Progress Bar</h3>
      <p>Indicador visual del tiempo restante.</p>
      <div class="demo-box">
        <button class="ux-button" onclick="UXSnackbar.show({
          message: 'Sincronizando datos...',
          showProgress: true,
          duration: 5000
        })">
          With Progress
        </button>
        <button class="ux-button" onclick="UXSnackbar.show({
          message: 'Guardado automaticamente',
          type: 'success',
          showProgress: true,
          duration: 3000
        })">
          Success + Progress
        </button>
      </div>
    </section>

    <section class="demo-section">
      <h3>Closable</h3>
      <p>Con boton de cierre.</p>
      <div class="demo-box">
        <button class="ux-button" onclick="UXSnackbar.show({
          message: 'Notificacion importante',
          closable: true,
          duration: 0
        })">
          Closable (Persistent)
        </button>
        <button class="ux-button" onclick="UXSnackbar.show({
          message: 'Con accion y cierre',
          actionLabel: 'Ver mas',
          closable: true,
          duration: 6000
        })">
          Action + Close
        </button>
      </div>
    </section>

    <section class="demo-section">
      <h3>Queue (Cola de mensajes)</h3>
      <p>Los snackbars se encolan y muestran uno a la vez.</p>
      <div class="demo-box">
        <button class="ux-button ux-color-primary" onclick="
          UXSnackbar.show({ message: 'Mensaje 1', duration: 2000 });
          UXSnackbar.show({ message: 'Mensaje 2', duration: 2000 });
          UXSnackbar.show({ message: 'Mensaje 3', duration: 2000 });
        ">
          Show 3 Snackbars
        </button>
      </div>
    </section>

    <section class="demo-section">
      <h3>Alpine.js Component</h3>
      <p>Uso con Alpine.js para control declarativo.</p>
      <div class="demo-box" style="flex-direction: column;">
        <div x-data="{ showSnack: false }">
          <button class="ux-button" @click="showSnack = true">Show Alpine Snackbar</button>

          <div class="ux-snackbar-container" x-show="showSnack" x-cloak>
            <div class="ux-snackbar"
                 :class="{ 'ux-snackbar--visible': showSnack }"
                 x-show="showSnack"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:leave="transition ease-in duration-200">
              <div class="ux-snackbar__content">
                <span class="ux-snackbar__message">Controlado con Alpine.js</span>
              </div>
              <button class="ux-snackbar__action" @click="showSnack = false; alert('Action!')">Action</button>
              <button class="ux-snackbar__close" @click="showSnack = false">
                <svg class="ux-snackbar__close-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="demo-section">
      <h3>Ejemplo de Uso Real</h3>
      <div class="demo-box" style="flex-direction: column; gap: var(--ux-space-lg);">
        <div style="display: flex; gap: var(--ux-space-sm);">
          <input type="text" class="ux-input" placeholder="Email" style="flex: 1;" id="demo-email">
          <button class="ux-button ux-color-primary" onclick="
            const email = document.getElementById('demo-email').value;
            if (email) {
              UXSnackbar.show({
                message: 'Invitacion enviada a ' + email,
                type: 'success',
                actionLabel: 'Deshacer',
                showProgress: true
              });
              document.getElementById('demo-email').value = '';
            } else {
              UXSnackbar.show({
                message: 'Por favor ingresa un email',
                type: 'warning'
              });
            }
          ">
            Enviar Invitacion
          </button>
        </div>
      </div>
    </section>

    <section class="demo-section">
      <h3>HTMX + Django</h3>
      <p>Integrar snackbars con respuestas HTMX desde Django. Usar el header <code>HX-Trigger</code> para disparar snackbars automaticamente.</p>

      <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Template HTML con HTMX</h4>
      <pre class="ux-code-block" data-lang="html">&lt;!-- Formulario con HTMX --&gt;
&lt;form hx-post="/api/items/create/"
      hx-target="#item-list"
      hx-swap="beforeend"&gt;
  &lt;input type="text" name="name" class="ux-input" placeholder="Nombre del item"&gt;
  &lt;button type="submit" class="ux-button ux-color-primary"&gt;Crear&lt;/button&gt;
&lt;/form&gt;

&lt;!-- Boton de eliminar con confirmacion --&gt;
&lt;button hx-delete="/api/items/{{ item.id }}/"
        hx-target="closest .item-row"
        hx-swap="outerHTML"
        hx-confirm="Eliminar este elemento?"&gt;
  Eliminar
&lt;/button&gt;

&lt;!-- Escuchar eventos personalizados de HTMX --&gt;
&lt;script&gt;
document.body.addEventListener('showSnackbar', (e) => {
  UXSnackbar.show(e.detail);
});
&lt;/script&gt;</pre>

      <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Vista Django</h4>
      <pre class="ux-code-block" data-lang="python"># views.py
from django.http import HttpResponse
import json

def create_item(request):
    # Crear item...
    item = Item.objects.create(name=request.POST['name'])

    # Respuesta con snackbar via HX-Trigger
    response = HttpResponse(render_to_string('partials/item_row.html', {'item': item}))
    response['HX-Trigger'] = json.dumps({
        'showSnackbar': {
            'message': f'Item "{item.name}" creado exitosamente',
            'type': 'success',
            'showProgress': True
        }
    })
    return response

def delete_item(request, item_id):
    item = Item.objects.get(id=item_id)
    item_name = item.name
    item.delete()

    response = HttpResponse('')
    response['HX-Trigger'] = json.dumps({
        'showSnackbar': {
            'message': f'"{item_name}" eliminado',
            'type': 'danger',
            'actionLabel': 'Deshacer',
            'duration': 5000
        }
    })
    return response

def update_item(request, item_id):
    item = Item.objects.get(id=item_id)
    item.name = request.POST['name']
    item.save()

    response = HttpResponse(render_to_string('partials/item_row.html', {'item': item}))
    response['HX-Trigger'] = json.dumps({
        'showSnackbar': {
            'message': 'Cambios guardados',
            'type': 'success'
        }
    })
    return response</pre>

      <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Middleware para Mensajes Django</h4>
      <pre class="ux-code-block" data-lang="python"># middleware.py
from django.contrib import messages
import json

class HTMXSnackbarMiddleware:
    """Convierte mensajes de Django en snackbars HTMX."""

    def __init__(self, get_response):
        self.get_response = get_response

    def __call__(self, request):
        response = self.get_response(request)

        # Solo para requests HTMX
        if not request.headers.get('HX-Request'):
            return response

        # Obtener mensajes pendientes
        storage = messages.get_messages(request)
        snackbar_messages = []

        type_map = {
            messages.SUCCESS: 'success',
            messages.WARNING: 'warning',
            messages.ERROR: 'danger',
            messages.INFO: 'info',
        }

        for msg in storage:
            snackbar_messages.append({
                'message': str(msg),
                'type': type_map.get(msg.level, 'info')
            })

        if snackbar_messages:
            # Agregar al HX-Trigger existente o crear nuevo
            existing = response.get('HX-Trigger', '{}')
            triggers = json.loads(existing) if existing != '{}' else {}

            # Usar el primer mensaje (o encolar multiples)
            triggers['showSnackbar'] = snackbar_messages[0]
            response['HX-Trigger'] = json.dumps(triggers)

        return response</pre>

      <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Ejemplo Completo: CRUD con Snackbars</h4>
      <pre class="ux-code-block" data-lang="html">&lt;!-- Lista de tareas con acciones HTMX --&gt;
&lt;div id="task-list"&gt;
  {% for task in tasks %}
  &lt;div class="ux-list__item task-row" id="task-{{ task.id }}"&gt;
    &lt;span&gt;{{ task.title }}&lt;/span&gt;
    &lt;div class="ux-list__end"&gt;
      &lt;button class="ux-button ux-button--sm"
              hx-patch="/tasks/{{ task.id }}/toggle/"
              hx-target="#task-{{ task.id }}"
              hx-swap="outerHTML"&gt;
        {% if task.completed %}Reabrir{% else %}Completar{% endif %}
      &lt;/button&gt;
      &lt;button class="ux-button ux-button--sm ux-color-danger"
              hx-delete="/tasks/{{ task.id }}/"
              hx-target="#task-{{ task.id }}"
              hx-swap="outerHTML swap:0.3s"&gt;
        Eliminar
      &lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  {% endfor %}
&lt;/div&gt;

&lt;!-- Formulario para nueva tarea --&gt;
&lt;form hx-post="/tasks/create/"
      hx-target="#task-list"
      hx-swap="beforeend"
      hx-on::after-request="this.reset()"&gt;
  &lt;input type="text" name="title" class="ux-input" placeholder="Nueva tarea..." required&gt;
  &lt;button type="submit" class="ux-button ux-color-primary"&gt;Agregar&lt;/button&gt;
&lt;/form&gt;</pre>
    </section>

    <section class="demo-section">
      <h3>API</h3>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="text-align: left; border-bottom: 1px solid var(--ux-border-color);">
            <th style="padding: var(--ux-space-sm);">Opcion</th>
            <th style="padding: var(--ux-space-sm);">Tipo</th>
            <th style="padding: var(--ux-space-sm);">Default</th>
            <th style="padding: var(--ux-space-sm);">Descripcion</th>
          </tr>
        </thead>
        <tbody style="font-size: var(--ux-font-size-sm);">
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>message</code></td>
            <td style="padding: var(--ux-space-sm);">String</td>
            <td style="padding: var(--ux-space-sm);">''</td>
            <td style="padding: var(--ux-space-sm);">Texto del mensaje</td>
          </tr>
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>duration</code></td>
            <td style="padding: var(--ux-space-sm);">Number</td>
            <td style="padding: var(--ux-space-sm);">4000</td>
            <td style="padding: var(--ux-space-sm);">Duracion en ms (0 = no auto-dismiss)</td>
          </tr>
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>type</code></td>
            <td style="padding: var(--ux-space-sm);">String</td>
            <td style="padding: var(--ux-space-sm);">null</td>
            <td style="padding: var(--ux-space-sm);">success, warning, danger, info</td>
          </tr>
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>actionLabel</code></td>
            <td style="padding: var(--ux-space-sm);">String</td>
            <td style="padding: var(--ux-space-sm);">'Action'</td>
            <td style="padding: var(--ux-space-sm);">Texto del boton de accion</td>
          </tr>
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>onAction</code></td>
            <td style="padding: var(--ux-space-sm);">Function</td>
            <td style="padding: var(--ux-space-sm);">null</td>
            <td style="padding: var(--ux-space-sm);">Callback al click en accion</td>
          </tr>
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>closable</code></td>
            <td style="padding: var(--ux-space-sm);">Boolean</td>
            <td style="padding: var(--ux-space-sm);">false</td>
            <td style="padding: var(--ux-space-sm);">Mostrar boton de cierre</td>
          </tr>
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>showProgress</code></td>
            <td style="padding: var(--ux-space-sm);">Boolean</td>
            <td style="padding: var(--ux-space-sm);">false</td>
            <td style="padding: var(--ux-space-sm);">Mostrar barra de progreso</td>
          </tr>
          <tr>
            <td style="padding: var(--ux-space-sm);"><code>onClose</code></td>
            <td style="padding: var(--ux-space-sm);">Function</td>
            <td style="padding: var(--ux-space-sm);">null</td>
            <td style="padding: var(--ux-space-sm);">Callback al cerrar</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section class="demo-section">
      <h3>Metodos Globales</h3>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="text-align: left; border-bottom: 1px solid var(--ux-border-color);">
            <th style="padding: var(--ux-space-sm);">Metodo</th>
            <th style="padding: var(--ux-space-sm);">Descripcion</th>
          </tr>
        </thead>
        <tbody style="font-size: var(--ux-font-size-sm);">
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>UXSnackbar.show(options)</code></td>
            <td style="padding: var(--ux-space-sm);">Mostrar snackbar con opciones</td>
          </tr>
          <tr>
            <td style="padding: var(--ux-space-sm);"><code>UXSnackbar.dismiss()</code></td>
            <td style="padding: var(--ux-space-sm);">Cerrar snackbar actual</td>
          </tr>
        </tbody>
      </table>
    </section>
  </div>
</body>
</html>
