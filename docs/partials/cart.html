<style>
    .demo-section { margin-bottom: var(--ux-space-xl); }
    .demo-section h3 {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-text);
    }
    .demo-section p {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-md);
    }
    .demo-box {
      background: var(--ux-surface);
      border-radius: var(--ux-border-radius-lg);
      padding: var(--ux-space-lg);
      margin-bottom: var(--ux-space-md);
    }
    .demo-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--ux-space-lg);
    }
    @media (max-width: 767px) {
      .demo-grid { grid-template-columns: 1fr; }
    }
  </style>

<h1 style="margin-bottom: var(--ux-space-sm);">Cart</h1>
    <p style="color: var(--ux-text-secondary); margin-bottom: var(--ux-space-xl);">Carrito de compras POS con lista de items, controles de cantidad, resumen y acciones.</p>

    <!-- Full Cart -->
    <section class="demo-section">
      <h3>Carrito Completo POS</h3>
      <p>Carrito con lista de items, controles de cantidad, resumen y acciones.</p>

      <div class="demo-grid">
        <div>
          <div x-data="uxCart({
            items: [
              { id: 1, name: 'Cafe Americano Grande', price: 3.50, quantity: 2, image: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=100&h=100&fit=crop' },
              { id: 2, name: 'Croissant de Mantequilla', price: 2.80, quantity: 1, image: 'https://images.unsplash.com/photo-1555507036-ab1f4038808a?w=100&h=100&fit=crop' },
              { id: 3, name: 'Smoothie Tropical con Frutas Frescas', price: 5.90, quantity: 1, image: 'https://images.unsplash.com/photo-1505252585461-04db1eb84625?w=100&h=100&fit=crop' }
            ],
            taxRate: 21,
            currency: '€',
            locale: 'es-ES',
            labels: {
              title: 'Carrito',
              subtotal: 'Subtotal',
              tax: 'IVA (21%)',
              total: 'Total',
              clearCart: 'Vaciar',
              checkout: 'Pagar',
              items: 'items'
            }
          })" class="ux-cart ux-cart--bordered" style="height: 500px;">

            <!-- Header -->
            <div class="ux-cart__header">
              <h2 class="ux-cart__title">
                <span x-text="labels.title"></span>
                <span class="ux-cart__count" x-text="itemCount"></span>
              </h2>
              <button type="button" class="ux-cart__clear" @click="clearCart()" x-show="!isEmpty">
                <span x-html="getIcon('trash')"></span>
                <span x-text="labels.clearCart"></span>
              </button>
            </div>

            <!-- Items -->
            <div class="ux-cart__items">
              <template x-if="isEmpty">
                <div class="ux-cart__empty">
                  <div class="ux-cart__empty-icon" x-html="getIcon('cart')"></div>
                  <h3 class="ux-cart__empty-title" x-text="labels.empty"></h3>
                  <p class="ux-cart__empty-text" x-text="labels.emptyText"></p>
                </div>
              </template>

              <ul class="ux-cart__items-list" x-show="!isEmpty">
                <template x-for="(item, index) in items" :key="item.id">
                  <li class="ux-cart-item">
                    <template x-if="item.image">
                      <img :src="item.image" :alt="item.name" class="ux-cart-item__image">
                    </template>
                    <template x-if="!item.image">
                      <div class="ux-cart-item__image-placeholder">
                        <span x-html="getIcon('placeholder')"></span>
                      </div>
                    </template>

                    <div class="ux-cart-item__content">
                      <h4 class="ux-cart-item__name" x-text="item.name"></h4>
                      <span class="ux-cart-item__unit-price" x-text="formatPrice(item.price) + ' c/u'"></span>

                      <div class="ux-cart-item__qty">
                        <button type="button" class="ux-cart-item__qty-btn" @click="decrementQuantity(index)">
                          <span x-html="getIcon('minus')"></span>
                        </button>
                        <span class="ux-cart-item__qty-value" x-text="item.quantity"></span>
                        <button type="button" class="ux-cart-item__qty-btn" @click="incrementQuantity(index)">
                          <span x-html="getIcon('plus')"></span>
                        </button>
                      </div>
                    </div>

                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: var(--ux-space-xs);">
                      <span class="ux-cart-item__price" x-text="formatPrice(item.price * item.quantity)"></span>
                      <button type="button" class="ux-cart-item__remove" @click="removeItem(index)">
                        <span x-html="getIcon('trash')"></span>
                      </button>
                    </div>
                  </li>
                </template>
              </ul>
            </div>

            <!-- Summary -->
            <div class="ux-cart-summary" x-show="!isEmpty">
              <div class="ux-cart-summary__row">
                <span class="ux-cart-summary__label" x-text="labels.subtotal"></span>
                <span class="ux-cart-summary__value" x-text="formatPrice(subtotal)"></span>
              </div>
              <div class="ux-cart-summary__row" x-show="discount > 0">
                <span class="ux-cart-summary__label" x-text="labels.discount"></span>
                <span class="ux-cart-summary__value ux-cart-summary__row--discount" x-text="'-' + formatPrice(discount)"></span>
              </div>
              <div class="ux-cart-summary__row">
                <span class="ux-cart-summary__label" x-text="labels.tax"></span>
                <span class="ux-cart-summary__value" x-text="formatPrice(tax)"></span>
              </div>
              <div class="ux-cart-summary__row ux-cart-summary__row--total">
                <span class="ux-cart-summary__label" x-text="labels.total"></span>
                <span class="ux-cart-summary__value" x-text="formatPrice(total)"></span>
              </div>
            </div>

            <!-- Actions -->
            <div class="ux-cart__actions" x-show="!isEmpty">
              <button type="button" class="ux-button ux-color-primary ux-button--lg" @click="checkout()">
                <span x-text="labels.checkout + ' ' + formatPrice(total)"></span>
              </button>
            </div>
          </div>
        </div>

        <div>
          <pre class="ux-code-block" data-lang="html">&lt;div x-data="uxCart({
  items: [
    { id: 1, name: 'Producto', price: 9.99, quantity: 2, image: '...' }
  ],
  taxRate: 21,
  currency: '€',
  locale: 'es-ES'
})" class="ux-cart"&gt;

  &lt;!-- Header --&gt;
  &lt;div class="ux-cart__header"&gt;
    &lt;h2 class="ux-cart__title"&gt;
      Carrito &lt;span class="ux-cart__count" x-text="itemCount"&gt;&lt;/span&gt;
    &lt;/h2&gt;
    &lt;button class="ux-cart__clear" @click="clearCart()"&gt;Vaciar&lt;/button&gt;
  &lt;/div&gt;

  &lt;!-- Items --&gt;
  &lt;div class="ux-cart__items"&gt;
    &lt;ul class="ux-cart__items-list"&gt;
      &lt;template x-for="(item, index) in items"&gt;
        &lt;li class="ux-cart-item"&gt;...&lt;/li&gt;
      &lt;/template&gt;
    &lt;/ul&gt;
  &lt;/div&gt;

  &lt;!-- Summary --&gt;
  &lt;div class="ux-cart-summary"&gt;
    &lt;div class="ux-cart-summary__row--total"&gt;
      &lt;span&gt;Total&lt;/span&gt;
      &lt;span x-text="formatPrice(total)"&gt;&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- Actions --&gt;
  &lt;div class="ux-cart__actions"&gt;
    &lt;button class="ux-button ux-color-primary" @click="checkout()"&gt;Pagar&lt;/button&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
        </div>
      </div>
    </section>

    <!-- Cart with Discount -->
    <section class="demo-section">
      <h3>Carrito con Descuento</h3>
      <p>Carrito mostrando descuento aplicado con <code>discountPercent</code>.</p>

      <div class="demo-box" style="max-width: 400px;">
        <div x-data="uxCart({
          items: [
            { id: 1, name: 'Laptop Pro 15 pulgadas', price: 1299.99, quantity: 1 },
            { id: 2, name: 'Mouse Wireless', price: 29.99, quantity: 2 }
          ],
          discountPercent: 10,
          taxRate: 8,
          currency: '$'
        })" class="ux-cart ux-cart--bordered" style="height: auto;">

          <div class="ux-cart__header">
            <h2 class="ux-cart__title">Order Summary</h2>
          </div>

          <div class="ux-cart__items" style="max-height: none;">
            <ul class="ux-cart__items-list">
              <template x-for="(item, index) in items" :key="item.id">
                <li class="ux-cart-item ux-cart-item--compact">
                  <div class="ux-cart-item__image-placeholder">
                    <span x-html="getIcon('placeholder')"></span>
                  </div>
                  <div class="ux-cart-item__content">
                    <h4 class="ux-cart-item__name" x-text="item.name"></h4>
                    <span class="ux-cart-item__meta" x-text="'Qty: ' + item.quantity"></span>
                  </div>
                  <span class="ux-cart-item__price" x-text="formatPrice(item.price * item.quantity)"></span>
                </li>
              </template>
            </ul>
          </div>

          <div class="ux-cart-summary">
            <div class="ux-cart-summary__row">
              <span class="ux-cart-summary__label">Subtotal</span>
              <span class="ux-cart-summary__value" x-text="formatPrice(subtotal)"></span>
            </div>
            <div class="ux-cart-summary__row ux-cart-summary__row--discount">
              <span class="ux-cart-summary__label">Discount (10%)</span>
              <span class="ux-cart-summary__value" x-text="'-' + formatPrice(discount)"></span>
            </div>
            <div class="ux-cart-summary__row">
              <span class="ux-cart-summary__label">Tax (8%)</span>
              <span class="ux-cart-summary__value" x-text="formatPrice(tax)"></span>
            </div>
            <div class="ux-cart-summary__row ux-cart-summary__row--total">
              <span class="ux-cart-summary__label">Total</span>
              <span class="ux-cart-summary__value" x-text="formatPrice(total)"></span>
            </div>
          </div>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="javascript">uxCart({
  items: [...],
  discountPercent: 10,  // 10% discount
  // or
  discountAmount: 50,   // $50 off
  taxRate: 8
})</pre>
    </section>

    <!-- Glass Variant -->
    <section class="demo-section">
      <h3>Variante Glass</h3>
      <p>Carrito con efecto glass morphism usando <code>.ux-cart--glass</code>.</p>

      <div class="demo-box" style="background: var(--ux-demo-gradient); padding: var(--ux-space-xl);">
        <div style="max-width: 350px;">
          <div x-data="uxCart({
            items: [
              { id: 1, name: 'Premium Plan', price: 29.99, quantity: 1 },
              { id: 2, name: 'Extra Storage', price: 9.99, quantity: 1 }
            ],
            currency: '$'
          })" class="ux-cart ux-cart--glass" style="height: auto;">

            <div class="ux-cart__header">
              <h2 class="ux-cart__title">Your Plan</h2>
            </div>

            <div class="ux-cart__items" style="max-height: none;">
              <ul class="ux-cart__items-list">
                <template x-for="(item, index) in items" :key="item.id">
                  <li class="ux-cart-item ux-cart-item--compact">
                    <div class="ux-cart-item__content">
                      <h4 class="ux-cart-item__name" x-text="item.name"></h4>
                    </div>
                    <span class="ux-cart-item__price" x-text="formatPrice(item.price)"></span>
                  </li>
                </template>
              </ul>
            </div>

            <div class="ux-cart-summary">
              <div class="ux-cart-summary__row ux-cart-summary__row--total">
                <span class="ux-cart-summary__label">Monthly Total</span>
                <span class="ux-cart-summary__value" x-text="formatPrice(total)"></span>
              </div>
            </div>

            <div class="ux-cart__actions">
              <button type="button" class="ux-button ux-color-primary">Subscribe</button>
            </div>
          </div>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;div class="ux-cart ux-cart--glass"&gt;...&lt;/div&gt;</pre>
    </section>

    <!-- API Reference -->
    <section class="demo-section">
      <h3>Componente Alpine.js</h3>
      <p>Opciones de configuracion, propiedades y metodos disponibles.</p>

      <pre class="ux-code-block" data-lang="javascript">// Configuracion uxCart
uxCart({
  // Items iniciales
  items: [
    {
      id: 1,
      name: 'Producto',
      price: 9.99,
      quantity: 1,
      image: 'https://...',     // Opcional
      maxQuantity: 10,          // Limite de cantidad
      options: { size: 'L' }    // Opciones/variantes
    }
  ],

  // Moneda y formato
  currency: '$',           // Simbolo
  locale: 'en-US',         // Locale para formato

  // Calculos
  taxRate: 0,              // % de impuesto
  discountAmount: 0,       // Descuento fijo
  discountPercent: 0,      // Descuento %
  shippingCost: 0,         // Costo de envio

  // Labels personalizables
  labels: { title: 'Cart', empty: 'Your cart is empty', ... }
})

// Propiedades reactivas:
items           // Array de items
itemCount       // Total de items (suma cantidades)
subtotal        // Subtotal antes de impuestos
discount        // Monto de descuento
tax             // Monto de impuestos
total           // Total final
isEmpty         // True si carrito vacio

// Metodos:
addItem(product, qty)       // Agregar item
removeItem(index)           // Eliminar item
updateQuantity(index, qty)  // Actualizar cantidad
incrementQuantity(index)    // +1 cantidad
decrementQuantity(index)    // -1 cantidad
clearCart()                 // Vaciar carrito
checkout()                  // Procesar pago
formatPrice(n)              // Formatear precio

// Eventos:
@cart-update          // { items, total }
@cart-item-removed    // { item, items }
@cart-cleared         // (sin datos)
@cart-checkout        // { items, subtotal, discount, tax, shipping, total }</pre>
    </section>

    <!-- CSS Classes -->
    <section class="demo-section">
      <h3>Clases CSS</h3>
      <p>Clases disponibles para personalizar el carrito.</p>

      <pre class="ux-code-block" data-lang="css">/* Contenedor */
.ux-cart                  // Contenedor principal
.ux-cart--bordered        // Con borde
.ux-cart--glass           // Variante glass
.ux-cart--mini            // Version mini (dropdown)

/* Header */
.ux-cart__header
.ux-cart__title
.ux-cart__count           // Badge contador
.ux-cart__clear           // Boton vaciar

/* Items */
.ux-cart__items           // Contenedor scrolleable
.ux-cart__items-list      // Lista ul

/* Item */
.ux-cart-item             // Item individual
.ux-cart-item--compact    // Version compacta
.ux-cart-item__image
.ux-cart-item__content
.ux-cart-item__name
.ux-cart-item__qty        // Controles cantidad
.ux-cart-item__price
.ux-cart-item__remove

/* Summary */
.ux-cart-summary
.ux-cart-summary__row
.ux-cart-summary__row--discount
.ux-cart-summary__row--total

/* Actions */
.ux-cart__actions</pre>
    </section>

    <!-- HTMX Integration -->
    <section class="demo-section">
      <h3>Integracion con HTMX</h3>
      <p>El carrito funciona perfectamente con HTMX para sincronizar con el servidor en tiempo real.</p>

      <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Agregar Producto al Carrito</h4>
      <p>Click en producto para agregarlo al carrito via HTMX.</p>

      <div class="demo-grid">
        <div style="display: flex; flex-direction: column; gap: var(--ux-space-sm);">
          <button class="ux-button ux-button--outline"
                  hx-post="/api/cart/add"
                  hx-vals='{"product_id": 1, "name": "Cafe Americano", "price": 3.50}'
                  hx-target="#htmx-cart-items"
                  hx-swap="innerHTML"
                  hx-indicator="#add-spinner-1">
            <span class="ux-spinner ux-spinner--sm htmx-indicator" id="add-spinner-1"></span>
            + Cafe Americano ($3.50)
          </button>
          <button class="ux-button ux-button--outline"
                  hx-post="/api/cart/add"
                  hx-vals='{"product_id": 2, "name": "Croissant", "price": 2.80}'
                  hx-target="#htmx-cart-items"
                  hx-swap="innerHTML"
                  hx-indicator="#add-spinner-2">
            <span class="ux-spinner ux-spinner--sm htmx-indicator" id="add-spinner-2"></span>
            + Croissant ($2.80)
          </button>
          <button class="ux-button ux-button--outline"
                  hx-post="/api/cart/add"
                  hx-vals='{"product_id": 3, "name": "Smoothie", "price": 5.90}'
                  hx-target="#htmx-cart-items"
                  hx-swap="innerHTML"
                  hx-indicator="#add-spinner-3">
            <span class="ux-spinner ux-spinner--sm htmx-indicator" id="add-spinner-3"></span>
            + Smoothie ($5.90)
          </button>
        </div>

        <div class="ux-cart ux-cart--bordered" style="height: 300px;">
          <div class="ux-cart__header">
            <h2 class="ux-cart__title">Carrito HTMX</h2>
          </div>
          <div id="htmx-cart-items" class="ux-cart__items" style="padding: var(--ux-space-md);">
            <p style="color: var(--ux-text-secondary); text-align: center;">Agrega productos...</p>
          </div>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Boton que agrega producto al carrito --&gt;
&lt;button hx-post="/api/cart/add"
        hx-vals='{"product_id": 1, "quantity": 1}'
        hx-target="#cart-items"
        hx-swap="innerHTML"&gt;
  Agregar al Carrito
&lt;/button&gt;

&lt;div id="cart-items"&gt;
  &lt;!-- El servidor devuelve la lista actualizada --&gt;
&lt;/div&gt;</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Actualizar Cantidad</h4>
      <p>Botones +/- que actualizan cantidad en el servidor.</p>

      <div class="demo-box">
        <div class="ux-cart-item" style="display: flex; align-items: center; gap: var(--ux-space-md); padding: var(--ux-space-md); background: var(--ux-surface-secondary); border-radius: var(--ux-border-radius);">
          <div style="flex: 1;">
            <h4 style="margin: 0;">Cafe Americano</h4>
            <span style="color: var(--ux-text-secondary);">$3.50 c/u</span>
          </div>

          <div style="display: flex; align-items: center; gap: var(--ux-space-sm);">
            <button class="ux-button ux-button--sm ux-button--outline"
                    hx-post="/api/cart/update"
                    hx-vals='{"item_id": 1, "action": "decrement"}'
                    hx-target="#qty-display"
                    hx-swap="innerHTML">
              -
            </button>
            <span id="qty-display" style="min-width: 30px; text-align: center; font-weight: 600;">2</span>
            <button class="ux-button ux-button--sm ux-button--outline"
                    hx-post="/api/cart/update"
                    hx-vals='{"item_id": 1, "action": "increment"}'
                    hx-target="#qty-display"
                    hx-swap="innerHTML">
              +
            </button>
          </div>

          <span style="font-weight: 700; min-width: 60px; text-align: right;">$7.00</span>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Controles de cantidad con HTMX --&gt;
&lt;button hx-post="/api/cart/update"
        hx-vals='{"item_id": 1, "action": "decrement"}'
        hx-target="#qty"&gt;-&lt;/button&gt;
&lt;span id="qty"&gt;2&lt;/span&gt;
&lt;button hx-post="/api/cart/update"
        hx-vals='{"item_id": 1, "action": "increment"}'
        hx-target="#qty"&gt;+&lt;/button&gt;</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Eliminar Item</h4>
      <p>Eliminar item del carrito con confirmacion.</p>

      <div class="demo-box">
        <div id="removable-items" style="display: flex; flex-direction: column; gap: var(--ux-space-sm);">
          <div class="ux-cart-item" style="display: flex; align-items: center; gap: var(--ux-space-md); padding: var(--ux-space-md); background: var(--ux-surface-secondary); border-radius: var(--ux-border-radius);">
            <div style="flex: 1;">
              <h4 style="margin: 0;">Cafe Americano</h4>
            </div>
            <span>$3.50</span>
            <button class="ux-button ux-button--sm ux-button--clear"
                    style="color: var(--ux-danger);"
                    hx-delete="/api/cart/item/1"
                    hx-target="closest .ux-cart-item"
                    hx-swap="outerHTML"
                    hx-confirm="Eliminar este producto?">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
            </button>
          </div>

          <div class="ux-cart-item" style="display: flex; align-items: center; gap: var(--ux-space-md); padding: var(--ux-space-md); background: var(--ux-surface-secondary); border-radius: var(--ux-border-radius);">
            <div style="flex: 1;">
              <h4 style="margin: 0;">Croissant</h4>
            </div>
            <span>$2.80</span>
            <button class="ux-button ux-button--sm ux-button--clear"
                    style="color: var(--ux-danger);"
                    hx-delete="/api/cart/item/2"
                    hx-target="closest .ux-cart-item"
                    hx-swap="outerHTML"
                    hx-confirm="Eliminar este producto?">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Eliminar item con HTMX --&gt;
&lt;div class="ux-cart-item"&gt;
  &lt;span&gt;Cafe&lt;/span&gt;
  &lt;button hx-delete="/api/cart/item/1"
          hx-target="closest .ux-cart-item"
          hx-swap="outerHTML"
          hx-confirm="Eliminar?"&gt;
    Eliminar
  &lt;/button&gt;
&lt;/div&gt;</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Carrito Completo con HTMX</h4>
      <p>Carrito que carga desde el servidor y actualiza totales automaticamente.</p>

      <div class="demo-box">
        <div class="ux-cart ux-cart--bordered" style="max-width: 400px;">
          <div class="ux-cart__header">
            <h2 class="ux-cart__title">Mi Pedido</h2>
            <button class="ux-button ux-button--sm ux-button--clear"
                    style="color: var(--ux-danger);"
                    hx-delete="/api/cart/clear"
                    hx-target="#full-cart-content"
                    hx-swap="innerHTML"
                    hx-confirm="Vaciar carrito?">
              Vaciar
            </button>
          </div>

          <div id="full-cart-content"
               hx-get="/api/cart"
               hx-trigger="load"
               hx-swap="innerHTML"
               style="min-height: 200px;">
            <div style="padding: var(--ux-space-xl); text-align: center;">
              <span class="ux-spinner"></span>
              <p style="color: var(--ux-text-secondary); margin-top: var(--ux-space-sm);">Cargando carrito...</p>
            </div>
          </div>

          <div class="ux-cart__actions">
            <button class="ux-button ux-color-primary" style="flex: 1;"
                    hx-post="/api/checkout"
                    hx-target="#checkout-result"
                    hx-swap="innerHTML"
                    hx-indicator="#checkout-spinner">
              <span class="ux-spinner ux-spinner--sm htmx-indicator" id="checkout-spinner"></span>
              Proceder al Pago
            </button>
          </div>
        </div>
        <div id="checkout-result" style="margin-top: var(--ux-space-md);"></div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Carrito que carga del servidor --&gt;
&lt;div class="ux-cart"&gt;
  &lt;div id="cart-content"
       hx-get="/api/cart"
       hx-trigger="load"
       hx-swap="innerHTML"&gt;
    Cargando...
  &lt;/div&gt;

  &lt;button hx-post="/api/checkout"
          hx-target="#result"&gt;
    Pagar
  &lt;/button&gt;
&lt;/div&gt;</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Sincronizacion OOB (Out of Band)</h4>
      <p>Actualizar contador del carrito en navbar automaticamente.</p>

      <div class="demo-box">
        <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--ux-space-md); background: var(--ux-surface-secondary); border-radius: var(--ux-border-radius); margin-bottom: var(--ux-space-md);">
          <span>Navbar con contador:</span>
          <div style="display: flex; align-items: center; gap: var(--ux-space-sm);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
            </svg>
            <span id="navbar-cart-count" class="ux-badge ux-color-primary" style="min-width: 24px; text-align: center;">3</span>
          </div>
        </div>

        <button class="ux-button ux-button--outline"
                hx-post="/api/cart/add-oob"
                hx-vals='{"product_id": 99}'
                hx-target="#oob-result"
                hx-swap="innerHTML">
          Agregar Producto (actualiza contador)
        </button>
        <div id="oob-result" style="margin-top: var(--ux-space-sm);"></div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Contador en navbar --&gt;
&lt;span id="cart-count"&gt;3&lt;/span&gt;

&lt;!-- Boton que agrega producto --&gt;
&lt;button hx-post="/api/cart/add"&gt;Agregar&lt;/button&gt;

&lt;!-- Respuesta del servidor con OOB swap --&gt;
&lt;div&gt;Producto agregado!&lt;/div&gt;
&lt;span id="cart-count" hx-swap-oob="true"&gt;4&lt;/span&gt;</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Aplicar Codigo de Descuento</h4>
      <p>Validar codigo de descuento en el servidor.</p>

      <div class="demo-box">
        <form hx-post="/api/cart/apply-discount"
              hx-target="#discount-result"
              hx-swap="innerHTML"
              hx-indicator="#discount-spinner"
              style="display: flex; gap: var(--ux-space-sm); max-width: 400px;">
          <input type="text"
                 name="code"
                 class="ux-input__field"
                 placeholder="Codigo de descuento"
                 style="flex: 1;">
          <button type="submit" class="ux-button ux-button--outline">
            <span class="ux-spinner ux-spinner--sm htmx-indicator" id="discount-spinner"></span>
            Aplicar
          </button>
        </form>
        <div id="discount-result" style="margin-top: var(--ux-space-sm);"></div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Aplicar descuento con HTMX --&gt;
&lt;form hx-post="/api/cart/apply-discount"
      hx-target="#result"&gt;
  &lt;input type="text" name="code" placeholder="Codigo"&gt;
  &lt;button type="submit"&gt;Aplicar&lt;/button&gt;
&lt;/form&gt;
&lt;div id="result"&gt;&lt;/div&gt;</pre>
    </section>

    <!-- HTMX + Django Section -->
    <section class="demo-section">
      <h3>HTMX + Django</h3>
      <p>Ejemplos de integracion de carrito de compras dinamico con Django y HTMX.</p>

      <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Modelo del Carrito</h4>
      <p>Modelo Django para el carrito de compras usando sesiones.</p>

      <pre class="ux-code-block" data-lang="python"># models.py
from django.db import models
from decimal import Decimal

class Product(models.Model):
    name = models.CharField(max_length=200)
    price = models.DecimalField(max_digits=10, decimal_places=2)
    image = models.ImageField(upload_to='products/', blank=True)
    stock = models.PositiveIntegerField(default=0)

    def __str__(self):
        return self.name

# cart.py - Cart class using sessions
class Cart:
    def __init__(self, request):
        self.session = request.session
        cart = self.session.get('cart')
        if not cart:
            cart = self.session['cart'] = {}
        self.cart = cart

    def add(self, product, quantity=1):
        product_id = str(product.id)
        if product_id not in self.cart:
            self.cart[product_id] = {
                'id': product.id,
                'name': product.name,
                'price': str(product.price),
                'quantity': 0,
                'image': product.image.url if product.image else None
            }
        self.cart[product_id]['quantity'] += quantity
        self.save()

    def remove(self, product_id):
        product_id = str(product_id)
        if product_id in self.cart:
            del self.cart[product_id]
            self.save()

    def update_quantity(self, product_id, quantity):
        product_id = str(product_id)
        if product_id in self.cart:
            self.cart[product_id]['quantity'] = quantity
            if quantity <= 0:
                self.remove(product_id)
            else:
                self.save()

    def clear(self):
        self.session['cart'] = {}
        self.save()

    def save(self):
        self.session.modified = True

    @property
    def items(self):
        return list(self.cart.values())

    @property
    def total_items(self):
        return sum(item['quantity'] for item in self.cart.values())

    @property
    def subtotal(self):
        return sum(
            Decimal(item['price']) * item['quantity']
            for item in self.cart.values()
        )

    def get_total(self, tax_rate=0, discount=0):
        subtotal = self.subtotal - Decimal(discount)
        tax = subtotal * Decimal(tax_rate) / 100
        return subtotal + tax</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Vistas Django</h4>
      <p>Vistas para manejar operaciones del carrito con HTMX.</p>

      <pre class="ux-code-block" data-lang="python"># views.py
from django.shortcuts import render, get_object_or_404
from django.http import HttpResponse
from django.views.decorators.http import require_POST, require_http_methods
from .models import Product
from .cart import Cart

def cart_view(request):
    """Renderiza el carrito completo"""
    cart = Cart(request)
    return render(request, 'cart/cart.html', {
        'cart': cart,
        'tax_rate': 21,
    })

def cart_items(request):
    """Renderiza solo los items del carrito (para HTMX)"""
    cart = Cart(request)
    return render(request, 'cart/partials/cart_items.html', {
        'cart': cart,
        'tax_rate': 21,
    })

@require_POST
def add_to_cart(request):
    """Agregar producto al carrito"""
    cart = Cart(request)
    product_id = request.POST.get('product_id')
    quantity = int(request.POST.get('quantity', 1))

    product = get_object_or_404(Product, id=product_id)
    cart.add(product, quantity)

    # Respuesta con OOB para actualizar contador en navbar
    response = render(request, 'cart/partials/cart_items.html', {'cart': cart})
    response['HX-Trigger'] = 'cartUpdated'

    # Agregar OOB swap para el contador
    oob_html = f'&lt;span id="cart-count" hx-swap-oob="true"&gt;{cart.total_items}&lt;/span&gt;'
    response.write(oob_html)

    return response

@require_POST
def update_cart_item(request):
    """Actualizar cantidad de item"""
    cart = Cart(request)
    item_id = request.POST.get('item_id')
    action = request.POST.get('action')

    current_qty = cart.cart.get(str(item_id), {}).get('quantity', 0)

    if action == 'increment':
        cart.update_quantity(item_id, current_qty + 1)
    elif action == 'decrement':
        cart.update_quantity(item_id, current_qty - 1)
    elif action == 'set':
        quantity = int(request.POST.get('quantity', 1))
        cart.update_quantity(item_id, quantity)

    return render(request, 'cart/partials/cart_items.html', {'cart': cart})

@require_http_methods(["DELETE"])
def remove_cart_item(request, item_id):
    """Eliminar item del carrito"""
    cart = Cart(request)
    cart.remove(item_id)

    # Retornar vacio para que HTMX elimine el elemento
    return HttpResponse('')

@require_http_methods(["DELETE"])
def clear_cart(request):
    """Vaciar carrito"""
    cart = Cart(request)
    cart.clear()

    return render(request, 'cart/partials/cart_empty.html')

@require_POST
def apply_discount(request):
    """Aplicar codigo de descuento"""
    code = request.POST.get('code', '').upper()

    # Validar codigo (ejemplo simple)
    discounts = {
        'SAVE10': {'percent': 10, 'message': 'Descuento del 10% aplicado'},
        'SAVE20': {'percent': 20, 'message': 'Descuento del 20% aplicado'},
        'FLAT50': {'amount': 50, 'message': '$50 de descuento aplicado'},
    }

    if code in discounts:
        discount = discounts[code]
        request.session['discount_code'] = code
        request.session['discount'] = discount
        return render(request, 'cart/partials/discount_success.html', {
            'discount': discount
        })
    else:
        return render(request, 'cart/partials/discount_error.html', {
            'message': 'Codigo invalido'
        })

@require_POST
def checkout(request):
    """Procesar checkout"""
    cart = Cart(request)

    if not cart.items:
        return HttpResponse('&lt;p class="ux-text-danger"&gt;El carrito esta vacio&lt;/p&gt;')

    # Aqui iria la logica de pago real
    order_total = cart.get_total(tax_rate=21)

    # Limpiar carrito despues del checkout
    cart.clear()

    return render(request, 'cart/partials/checkout_success.html', {
        'total': order_total
    })</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">URLs</h4>
      <p>Configuracion de URLs para las vistas del carrito.</p>

      <pre class="ux-code-block" data-lang="python"># urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('cart/', views.cart_view, name='cart'),
    path('cart/items/', views.cart_items, name='cart_items'),
    path('cart/add/', views.add_to_cart, name='add_to_cart'),
    path('cart/update/', views.update_cart_item, name='update_cart_item'),
    path('cart/remove/&lt;int:item_id&gt;/', views.remove_cart_item, name='remove_cart_item'),
    path('cart/clear/', views.clear_cart, name='clear_cart'),
    path('cart/apply-discount/', views.apply_discount, name='apply_discount'),
    path('cart/checkout/', views.checkout, name='checkout'),
]</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Templates Django</h4>
      <p>Templates parciales para renderizar el carrito con HTMX.</p>

      <pre class="ux-code-block" data-lang="html">&lt;!-- templates/cart/partials/cart_items.html --&gt;
&lt;div class="ux-cart__items"&gt;
  {% if cart.items %}
    &lt;ul class="ux-cart__items-list"&gt;
      {% for item in cart.items %}
        &lt;li class="ux-cart-item" id="cart-item-{{ item.id }}"&gt;
          {% if item.image %}
            &lt;img src="{{ item.image }}" alt="{{ item.name }}" class="ux-cart-item__image"&gt;
          {% else %}
            &lt;div class="ux-cart-item__image-placeholder"&gt;
              &lt;svg&gt;...&lt;/svg&gt;
            &lt;/div&gt;
          {% endif %}

          &lt;div class="ux-cart-item__content"&gt;
            &lt;h4 class="ux-cart-item__name"&gt;{{ item.name }}&lt;/h4&gt;
            &lt;span class="ux-cart-item__unit-price"&gt;${{ item.price }} c/u&lt;/span&gt;

            &lt;div class="ux-cart-item__qty"&gt;
              &lt;button type="button" class="ux-cart-item__qty-btn"
                      hx-post="{% url 'update_cart_item' %}"
                      hx-vals='{"item_id": "{{ item.id }}", "action": "decrement"}'
                      hx-target="#cart-items-container"
                      hx-swap="innerHTML"&gt;
                -
              &lt;/button&gt;
              &lt;span class="ux-cart-item__qty-value"&gt;{{ item.quantity }}&lt;/span&gt;
              &lt;button type="button" class="ux-cart-item__qty-btn"
                      hx-post="{% url 'update_cart_item' %}"
                      hx-vals='{"item_id": "{{ item.id }}", "action": "increment"}'
                      hx-target="#cart-items-container"
                      hx-swap="innerHTML"&gt;
                +
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          &lt;div style="display: flex; flex-direction: column; align-items: flex-end;"&gt;
            &lt;span class="ux-cart-item__price"&gt;${{ item.line_total }}&lt;/span&gt;
            &lt;button type="button" class="ux-cart-item__remove"
                    hx-delete="{% url 'remove_cart_item' item.id %}"
                    hx-target="#cart-item-{{ item.id }}"
                    hx-swap="outerHTML"
                    hx-confirm="Eliminar este producto?"&gt;
              &lt;svg&gt;...&lt;/svg&gt;
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/li&gt;
      {% endfor %}
    &lt;/ul&gt;
  {% else %}
    &lt;div class="ux-cart__empty"&gt;
      &lt;p&gt;Tu carrito esta vacio&lt;/p&gt;
    &lt;/div&gt;
  {% endif %}
&lt;/div&gt;

&lt;!-- Summary --&gt;
{% if cart.items %}
&lt;div class="ux-cart-summary"&gt;
  &lt;div class="ux-cart-summary__row"&gt;
    &lt;span class="ux-cart-summary__label"&gt;Subtotal&lt;/span&gt;
    &lt;span class="ux-cart-summary__value"&gt;${{ cart.subtotal }}&lt;/span&gt;
  &lt;/div&gt;
  {% if discount %}
  &lt;div class="ux-cart-summary__row ux-cart-summary__row--discount"&gt;
    &lt;span class="ux-cart-summary__label"&gt;Descuento&lt;/span&gt;
    &lt;span class="ux-cart-summary__value"&gt;-${{ discount }}&lt;/span&gt;
  &lt;/div&gt;
  {% endif %}
  &lt;div class="ux-cart-summary__row"&gt;
    &lt;span class="ux-cart-summary__label"&gt;IVA ({{ tax_rate }}%)&lt;/span&gt;
    &lt;span class="ux-cart-summary__value"&gt;${{ cart.tax }}&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class="ux-cart-summary__row ux-cart-summary__row--total"&gt;
    &lt;span class="ux-cart-summary__label"&gt;Total&lt;/span&gt;
    &lt;span class="ux-cart-summary__value"&gt;${{ cart.total }}&lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;
{% endif %}</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Boton Agregar al Carrito</h4>
      <p>Boton en pagina de producto que agrega al carrito y actualiza el contador.</p>

      <pre class="ux-code-block" data-lang="html">&lt;!-- templates/products/product_detail.html --&gt;
&lt;div class="ux-product-card"&gt;
  &lt;img src="{{ product.image.url }}" alt="{{ product.name }}"&gt;
  &lt;h2&gt;{{ product.name }}&lt;/h2&gt;
  &lt;p class="price"&gt;${{ product.price }}&lt;/p&gt;

  &lt;form hx-post="{% url 'add_to_cart' %}"
        hx-target="#cart-notification"
        hx-swap="innerHTML"
        hx-indicator="#add-spinner"&gt;
    {% csrf_token %}
    &lt;input type="hidden" name="product_id" value="{{ product.id }}"&gt;

    &lt;div class="quantity-selector"&gt;
      &lt;button type="button" onclick="this.nextElementSibling.stepDown()"&gt;-&lt;/button&gt;
      &lt;input type="number" name="quantity" value="1" min="1" max="{{ product.stock }}"&gt;
      &lt;button type="button" onclick="this.previousElementSibling.stepUp()"&gt;+&lt;/button&gt;
    &lt;/div&gt;

    &lt;button type="submit" class="ux-button ux-color-primary ux-button--lg"&gt;
      &lt;span class="ux-spinner ux-spinner--sm htmx-indicator" id="add-spinner"&gt;&lt;/span&gt;
      Agregar al Carrito
    &lt;/button&gt;
  &lt;/form&gt;

  &lt;div id="cart-notification"&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;!-- templates/cart/partials/add_success.html --&gt;
&lt;div class="ux-toast ux-toast--success" x-data="{ show: true }" x-show="show" x-init="setTimeout(() =&gt; show = false, 3000)"&gt;
  Producto agregado al carrito
&lt;/div&gt;
&lt;span id="cart-count" hx-swap-oob="true"&gt;{{ cart.total_items }}&lt;/span&gt;</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Carrito en Sidebar/Drawer</h4>
      <p>Mini carrito en sidebar que se actualiza automaticamente.</p>

      <pre class="ux-code-block" data-lang="html">&lt;!-- templates/base.html --&gt;
&lt;!-- Navbar con icono de carrito --&gt;
&lt;nav class="ux-navbar"&gt;
  &lt;div class="ux-navbar__end"&gt;
    &lt;button class="ux-button ux-button--clear"
            hx-get="{% url 'cart_items' %}"
            hx-target="#cart-drawer-content"
            hx-swap="innerHTML"
            onclick="document.getElementById('cart-drawer').classList.add('open')"&gt;
      &lt;svg&gt;...&lt;/svg&gt;
      &lt;span id="cart-count" class="ux-badge ux-color-primary"&gt;{{ cart.total_items }}&lt;/span&gt;
    &lt;/button&gt;
  &lt;/div&gt;
&lt;/nav&gt;

&lt;!-- Cart Drawer --&gt;
&lt;div id="cart-drawer" class="ux-drawer"&gt;
  &lt;div class="ux-drawer__header"&gt;
    &lt;h2&gt;Tu Carrito&lt;/h2&gt;
    &lt;button onclick="this.closest('.ux-drawer').classList.remove('open')"&gt;X&lt;/button&gt;
  &lt;/div&gt;

  &lt;div id="cart-drawer-content"
       hx-get="{% url 'cart_items' %}"
       hx-trigger="cartUpdated from:body"
       hx-swap="innerHTML"&gt;
    &lt;!-- Contenido del carrito cargado via HTMX --&gt;
  &lt;/div&gt;

  &lt;div class="ux-drawer__footer"&gt;
    &lt;a href="{% url 'cart' %}" class="ux-button ux-button--lg ux-color-primary"&gt;
      Ver Carrito Completo
    &lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>

      <h4 style="margin-top: var(--ux-space-xl); margin-bottom: var(--ux-space-sm); color: var(--ux-text);">Middleware para CSRF con HTMX</h4>
      <p>Configuracion necesaria para que HTMX funcione con Django CSRF.</p>

      <pre class="ux-code-block" data-lang="javascript">// En tu template base, agregar el token CSRF a todas las peticiones HTMX
document.body.addEventListener('htmx:configRequest', function(evt) {
  evt.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
});</pre>

      <pre class="ux-code-block" data-lang="html">&lt;!-- O usando meta tag --&gt;
&lt;meta name="csrf-token" content="{{ csrf_token }}"&gt;

&lt;script&gt;
document.body.addEventListener('htmx:configRequest', function(evt) {
  evt.detail.headers['X-CSRFToken'] = document.querySelector('meta[name="csrf-token"]').content;
});
&lt;/script&gt;</pre>
    </section>