<style>
    .demo-section { margin-bottom: var(--ux-space-xl); padding: var(--ux-space-lg); }
    .demo-section h3 { font-size: var(--ux-font-size-lg); font-weight: 600; margin-bottom: var(--ux-space-md); }
    .demo-section p { font-size: var(--ux-font-size-md); color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md); }
    .demo-box { background: var(--ux-surface); border-radius: var(--ux-border-radius-lg); padding: var(--ux-space-lg); margin-bottom: var(--ux-space-md); }
    .demo-controls { display: flex; gap: var(--ux-space-sm); margin-bottom: var(--ux-space-md); flex-wrap: wrap; }
    .demo-output { padding: var(--ux-space-md); background: var(--ux-surface-secondary); border-radius: var(--ux-radius-md); font-size: var(--ux-font-size-sm); color: var(--ux-text-secondary); margin-top: var(--ux-space-md); }
  </style>

<div class="demo-section">
    <h3>Notification Center - Panel</h3>
    <p>Panel lateral para gestionar notificaciones.</p>

    <div class="demo-box" x-data="uxNotificationCenter({
      notifications: [
        { id: '1', title: 'Nuevo pedido recibido', message: 'Pedido #1234 de Juan Garcia por 150.00', type: 'success', timestamp: new Date().toISOString(), read: false },
        { id: '2', title: 'Stock bajo', message: 'El producto Cafe Americano tiene menos de 10 unidades', type: 'warning', timestamp: new Date(Date.now() - 3600000).toISOString(), read: false },
        { id: '3', title: 'Error de sincronizacion', message: 'No se pudo sincronizar con el servidor. Reintentando...', type: 'error', timestamp: new Date(Date.now() - 7200000).toISOString(), read: true },
        { id: '4', title: 'Actualizacion disponible', message: 'Nueva version 2.1.0 disponible para instalar', type: 'info', timestamp: new Date(Date.now() - 86400000).toISOString(), read: true },
        { id: '5', title: 'Pago completado', message: 'Se proceso el pago de la factura #567', type: 'success', timestamp: new Date(Date.now() - 86400000 * 2).toISOString(), read: true }
      ]
    })" @notification:click.window="console.log('Clicked:', $event.detail)">
      <!-- Trigger Button -->
      <button class="ux-notification-trigger" @click="toggle()">
        <span x-html="icons.bell"></span>
        <span x-show="unreadCount > 0" class="ux-notification-trigger__badge" x-text="unreadCount > 99 ? '99+' : unreadCount"></span>
      </button>

      <!-- Backdrop -->
      <div class="ux-notification-panel__backdrop"
           :class="{ 'ux-notification-panel__backdrop--open': isOpen }"
           @click="close()"></div>

      <!-- Panel -->
      <div class="ux-notification-panel" :class="{ 'ux-notification-panel--open': isOpen }">
        <!-- Header -->
        <div class="ux-notification-panel__header">
          <h2 class="ux-notification-panel__title">Notificaciones</h2>
          <div class="ux-notification-panel__actions">
            <button class="ux-notification-panel__action" title="Marcar todo como leido" @click="markAllAsRead()">
              <span x-html="icons.checkAll"></span>
            </button>
            <button class="ux-notification-panel__action" title="Cerrar" @click="close()">
              <span x-html="icons.close"></span>
            </button>
          </div>
        </div>

        <!-- Filters -->
        <div x-show="showFilters" class="ux-notification-panel__filters">
          <template x-for="filter in filters" :key="filter">
            <button class="ux-notification-panel__filter"
                    :class="{ 'ux-notification-panel__filter--active': activeFilter === filter }"
                    @click="activeFilter = filter">
              <span x-text="filterLabels[filter]"></span>
              <span class="ux-notification-panel__filter-count" x-text="getFilterCount(filter)"></span>
            </button>
          </template>
        </div>

        <!-- Content -->
        <div class="ux-notification-panel__content">
          <!-- Empty State -->
          <div x-show="filteredNotifications.length === 0 || (filteredNotifications.length === 1 && filteredNotifications[0].items.length === 0)"
               class="ux-notification-panel__empty">
            <div class="ux-notification-panel__empty-icon" x-html="icons.empty"></div>
            <div class="ux-notification-panel__empty-title">No hay notificaciones</div>
            <div class="ux-notification-panel__empty-description">Las nuevas notificaciones apareceran aqui</div>
          </div>

          <!-- Notifications List -->
          <template x-for="group in filteredNotifications" :key="group.group">
            <div>
              <div x-show="group.group" class="ux-notification-panel__group" x-text="group.group"></div>
              <ul class="ux-notification-panel__list">
                <template x-for="notification in group.items" :key="notification.id">
                  <li class="ux-notification-item"
                      :class="{ 'ux-notification-item--unread': !notification.read }"
                      @click="handleClick(notification)">
                    <div class="ux-notification-item__icon"
                         :class="'ux-notification-item__icon--' + notification.type"
                         x-html="getTypeIcon(notification.type)"></div>
                    <div class="ux-notification-item__content">
                      <div class="ux-notification-item__header">
                        <span class="ux-notification-item__title" x-text="notification.title"></span>
                        <span class="ux-notification-item__time" x-text="formatTime(notification.timestamp)"></span>
                      </div>
                      <p class="ux-notification-item__message" x-text="notification.message"></p>
                    </div>
                    <div x-show="!notification.read" class="ux-notification-item__dot"></div>
                  </li>
                </template>
              </ul>
            </div>
          </template>
        </div>

        <!-- Footer -->
        <div x-show="showFooter && notifications.length > 0" class="ux-notification-panel__footer">
          <a class="ux-notification-panel__footer-link" @click="clearAll()">Borrar todas</a>
        </div>
      </div>

      <div class="demo-output">
        No leidas: <strong x-text="unreadCount"></strong> |
        Total: <strong x-text="notifications.length"></strong>
      </div>
    </div>

    <pre class="ux-code-block" data-lang="html">&lt;div x-data="uxNotificationCenter({
  notifications: [
    { id: '1', title: 'Titulo', message: 'Mensaje', type: 'success', timestamp: '...', read: false }
  ]
})"&gt;
  &lt;button class="ux-notification-trigger" @click="toggle()"&gt;
    &lt;span x-html="icons.bell"&gt;&lt;/span&gt;
    &lt;span class="ux-notification-trigger__badge" x-text="unreadCount"&gt;&lt;/span&gt;
  &lt;/button&gt;

  &lt;div class="ux-notification-panel" :class="{ 'ux-notification-panel--open': isOpen }"&gt;
    &lt;!-- Panel content --&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
  </div>

  <div class="demo-section">
    <h3>Variante Dropdown</h3>
    <p>Menu desplegable para espacios mas reducidos.</p>

    <div class="demo-box" style="position: relative;">
      <div x-data="uxNotificationCenter({
        variant: 'dropdown',
        showFilters: false,
        groupByDate: false,
        notifications: [
          { id: 'd1', title: 'Mensaje nuevo', message: 'Tienes un mensaje de Maria', type: 'info', timestamp: new Date().toISOString(), read: false },
          { id: 'd2', title: 'Tarea completada', message: 'La tarea Revisar inventario fue completada', type: 'success', timestamp: new Date(Date.now() - 1800000).toISOString(), read: false },
          { id: 'd3', title: 'Recordatorio', message: 'Reunion en 30 minutos', type: 'warning', timestamp: new Date(Date.now() - 3600000).toISOString(), read: true }
        ]
      })">
        <div style="position: relative; display: inline-block;">
          <button class="ux-notification-trigger" @click="toggle()">
            <span x-html="icons.bell"></span>
            <span x-show="unreadCount > 0" class="ux-notification-trigger__badge" x-text="unreadCount"></span>
          </button>

          <!-- Dropdown -->
          <div class="ux-notification-dropdown" :class="{ 'ux-notification-dropdown--open': isOpen }">
            <div class="ux-notification-panel__header">
              <h2 class="ux-notification-panel__title">Notificaciones</h2>
              <button class="ux-notification-panel__action" @click="markAllAsRead()">
                <span x-html="icons.checkAll"></span>
              </button>
            </div>
            <div class="ux-notification-panel__content">
              <ul class="ux-notification-panel__list">
                <template x-for="notification in notifications" :key="notification.id">
                  <li class="ux-notification-item"
                      :class="{ 'ux-notification-item--unread': !notification.read }"
                      @click="handleClick(notification)">
                    <div class="ux-notification-item__icon"
                         :class="'ux-notification-item__icon--' + notification.type"
                         x-html="getTypeIcon(notification.type)"></div>
                    <div class="ux-notification-item__content">
                      <div class="ux-notification-item__header">
                        <span class="ux-notification-item__title" x-text="notification.title"></span>
                        <span class="ux-notification-item__time" x-text="formatTime(notification.timestamp)"></span>
                      </div>
                      <p class="ux-notification-item__message" x-text="notification.message"></p>
                    </div>
                    <div x-show="!notification.read" class="ux-notification-item__dot"></div>
                  </li>
                </template>
              </ul>
            </div>
            <div class="ux-notification-panel__footer">
              <a class="ux-notification-panel__footer-link">Ver todas</a>
            </div>
          </div>
        </div>

        <!-- Click outside to close -->
        <div x-show="isOpen" @click="close()" style="position: fixed; inset: 0; z-index: 99;"></div>
      </div>
    </div>

    <pre class="ux-code-block" data-lang="html">&lt;div x-data="uxNotificationCenter({ variant: 'dropdown' })"&gt;
  &lt;button @click="toggle()"&gt;...&lt;/button&gt;
  &lt;div class="ux-notification-dropdown" :class="{ 'ux-notification-dropdown--open': isOpen }"&gt;
    ...
  &lt;/div&gt;
&lt;/div&gt;</pre>
  </div>

  <div class="demo-section">
    <h3>Con Acciones en Notificaciones</h3>
    <p>Botones de accion dentro de las notificaciones.</p>

    <div class="demo-box" x-data="uxNotificationCenter({
      showFilters: false,
      groupByDate: false,
      notifications: [
        {
          id: 'a1',
          title: 'Solicitud de amistad',
          message: 'Carlos Lopez quiere conectar contigo',
          type: 'info',
          timestamp: new Date().toISOString(),
          read: false,
          actions: [
            { id: 'accept', label: 'Aceptar', primary: true },
            { id: 'decline', label: 'Rechazar' }
          ]
        },
        {
          id: 'a2',
          title: 'Nuevo comentario',
          message: 'Ana Garcia comento en tu publicacion',
          type: 'info',
          timestamp: new Date(Date.now() - 600000).toISOString(),
          read: false,
          actions: [
            { id: 'view', label: 'Ver comentario', primary: true }
          ]
        }
      ]
    })" @notification:action.window="alert('Accion: ' + $event.detail.action.label)">
      <div style="max-width: 400px; border: 1px solid var(--ux-border-color); border-radius: var(--ux-radius-lg); overflow: hidden;">
        <div class="ux-notification-panel__header">
          <h2 class="ux-notification-panel__title">Notificaciones</h2>
        </div>
        <div class="ux-notification-panel__content" style="max-height: 400px;">
          <ul class="ux-notification-panel__list">
            <template x-for="notification in notifications" :key="notification.id">
              <li class="ux-notification-item" :class="{ 'ux-notification-item--unread': !notification.read }">
                <div class="ux-notification-item__icon"
                     :class="'ux-notification-item__icon--' + notification.type"
                     x-html="getTypeIcon(notification.type)"></div>
                <div class="ux-notification-item__content">
                  <div class="ux-notification-item__header">
                    <span class="ux-notification-item__title" x-text="notification.title"></span>
                    <span class="ux-notification-item__time" x-text="formatTime(notification.timestamp)"></span>
                  </div>
                  <p class="ux-notification-item__message" x-text="notification.message"></p>
                  <div x-show="notification.actions && notification.actions.length > 0" class="ux-notification-item__actions">
                    <template x-for="action in notification.actions" :key="action.id">
                      <button class="ux-notification-item__action-btn"
                              :class="{ 'ux-notification-item__action-btn--primary': action.primary }"
                              @click.stop="handleAction(notification, action)"
                              x-text="action.label"></button>
                    </template>
                  </div>
                </div>
              </li>
            </template>
          </ul>
        </div>
      </div>
    </div>

    <pre class="ux-code-block" data-lang="html">// Notificacion con acciones
{
  id: 'a1',
  title: 'Solicitud de amistad',
  message: 'Carlos quiere conectar',
  actions: [
    { id: 'accept', label: 'Aceptar', primary: true },
    { id: 'decline', label: 'Rechazar' }
  ]
}

// Escuchar evento
@notification:action="handleAction($event.detail)"</pre>
  </div>

  <div class="demo-section">
    <h3>Agregar Notificaciones Dinamicamente</h3>
    <p>Agregar nuevas notificaciones en tiempo real.</p>

    <div class="demo-box" x-data="{
      ...uxNotificationCenter({
        showFilters: false,
        groupByDate: false,
        notifications: []
      }),
      notifCount: 0,

      addTestNotification() {
        this.notifCount++;
        const types = ['info', 'success', 'warning', 'error'];
        const type = types[Math.floor(Math.random() * types.length)];
        const titles = {
          info: 'Nueva informacion',
          success: 'Operacion exitosa',
          warning: 'Atencion requerida',
          error: 'Error detectado'
        };

        this.addNotification({
          title: titles[type] + ' #' + this.notifCount,
          message: 'Esta es una notificacion de prueba generada dinamicamente.',
          type: type
        });
      }
    }">
      <div class="demo-controls">
        <button class="ux-button ux-color-primary" @click="addTestNotification()">
          Agregar Notificacion
        </button>
        <button class="ux-button ux-button--outline" @click="markAllAsRead()">
          Marcar todo leido
        </button>
        <button class="ux-button ux-button--outline ux-color-danger--outline" @click="clearAll()">
          Borrar todas
        </button>
      </div>

      <div style="max-width: 400px; border: 1px solid var(--ux-border-color); border-radius: var(--ux-radius-lg); overflow: hidden;">
        <div class="ux-notification-panel__header">
          <h2 class="ux-notification-panel__title">Notificaciones</h2>
          <span style="font-size: var(--ux-font-size-sm); color: var(--ux-text-tertiary);" x-text="unreadCount + ' no leidas'"></span>
        </div>
        <div class="ux-notification-panel__content" style="max-height: 300px;">
          <div x-show="notifications.length === 0" class="ux-notification-panel__empty">
            <div class="ux-notification-panel__empty-icon" x-html="icons.empty"></div>
            <div class="ux-notification-panel__empty-title">Sin notificaciones</div>
            <div class="ux-notification-panel__empty-description">Haz click en "Agregar" para probar</div>
          </div>
          <ul class="ux-notification-panel__list">
            <template x-for="notification in notifications" :key="notification.id">
              <li class="ux-notification-item"
                  :class="{ 'ux-notification-item--unread': !notification.read }"
                  @click="handleClick(notification)">
                <div class="ux-notification-item__icon"
                     :class="'ux-notification-item__icon--' + notification.type"
                     x-html="getTypeIcon(notification.type)"></div>
                <div class="ux-notification-item__content">
                  <div class="ux-notification-item__header">
                    <span class="ux-notification-item__title" x-text="notification.title"></span>
                    <span class="ux-notification-item__time" x-text="formatTime(notification.timestamp)"></span>
                  </div>
                  <p class="ux-notification-item__message" x-text="notification.message"></p>
                </div>
                <div x-show="!notification.read" class="ux-notification-item__dot"></div>
              </li>
            </template>
          </ul>
        </div>
      </div>
    </div>

    <pre class="ux-code-block" data-lang="html">// Agregar notificacion
addNotification({
  title: 'Titulo',
  message: 'Mensaje de la notificacion',
  type: 'success' // info, success, warning, error
});

// Marcar todas como leidas
markAllAsRead();

// Borrar todas
clearAll();</pre>
  </div>

  <div class="demo-section">
    <h3>Variante Glass</h3>
    <p>Panel con efecto glass morphism.</p>

    <div class="demo-box" style="background: linear-gradient(135deg, var(--ux-primary-tint) 0%, var(--ux-tertiary-tint) 100%); padding: var(--ux-space-xl); min-height: 300px;">
      <div x-data="uxNotificationCenter({
        showFilters: false,
        groupByDate: false,
        notifications: [
          { id: 'g1', title: 'Bienvenido', message: 'Panel de notificaciones glass', type: 'info', timestamp: new Date().toISOString(), read: false }
        ]
      })">
        <button class="ux-notification-trigger" style="background: var(--ux-glass-bg);" @click="toggle()">
          <span x-html="icons.bell"></span>
          <span x-show="unreadCount > 0" class="ux-notification-trigger__badge" x-text="unreadCount"></span>
        </button>

        <div class="ux-notification-panel__backdrop"
             :class="{ 'ux-notification-panel__backdrop--open': isOpen }"
             @click="close()"></div>

        <div class="ux-notification-panel ux-notification-panel--glass" :class="{ 'ux-notification-panel--open': isOpen }">
          <div class="ux-notification-panel__header">
            <h2 class="ux-notification-panel__title">Notificaciones</h2>
            <button class="ux-notification-panel__action" @click="close()">
              <span x-html="icons.close"></span>
            </button>
          </div>
          <div class="ux-notification-panel__content">
            <ul class="ux-notification-panel__list">
              <template x-for="notification in notifications" :key="notification.id">
                <li class="ux-notification-item"
                    :class="{ 'ux-notification-item--unread': !notification.read }"
                    @click="handleClick(notification)">
                  <div class="ux-notification-item__icon"
                       :class="'ux-notification-item__icon--' + notification.type"
                       x-html="getTypeIcon(notification.type)"></div>
                  <div class="ux-notification-item__content">
                    <div class="ux-notification-item__header">
                      <span class="ux-notification-item__title" x-text="notification.title"></span>
                      <span class="ux-notification-item__time" x-text="formatTime(notification.timestamp)"></span>
                    </div>
                    <p class="ux-notification-item__message" x-text="notification.message"></p>
                  </div>
                </li>
              </template>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <pre class="ux-code-block" data-lang="html">&lt;div class="ux-notification-panel ux-notification-panel--glass"&gt;...&lt;/div&gt;</pre>
  </div>

  <div class="demo-section">
    <h3>API y Eventos</h3>
    <div class="demo-box">
      <pre class="ux-code-block" data-lang="html">// Opciones de configuracion
uxNotificationCenter({
  notifications: [],           // Array de notificaciones
  filters: ['all', 'unread'],  // Filtros disponibles
  filterLabels: {},            // Etiquetas para filtros
  showFilters: true,           // Mostrar barra de filtros
  showFooter: true,            // Mostrar footer
  groupByDate: true,           // Agrupar por fecha
  maxVisible: 50,              // Maximo de notificaciones visibles
  variant: 'panel'             // 'panel' o 'dropdown'
})

// Estructura de notificacion
{
  id: 'unique-id',             // ID unico (requerido)
  title: 'Titulo',             // Titulo (requerido)
  message: 'Mensaje',          // Mensaje (requerido)
  type: 'info',                // 'info', 'success', 'warning', 'error'
  timestamp: '2024-01-15...',  // ISO date string
  read: false,                 // Estado de lectura
  actions: [                   // Acciones opcionales
    { id: 'action1', label: 'Aceptar', primary: true }
  ],
  data: {}                     // Datos adicionales
}

// Propiedades computadas
unreadCount                    // Cantidad de no leidas
filteredNotifications          // Notificaciones filtradas

// Metodos
open()                         // Abrir panel
close()                        // Cerrar panel
toggle()                       // Alternar estado
markAsRead(id)                 // Marcar como leida
markAllAsRead()                // Marcar todas como leidas
deleteNotification(id)         // Eliminar notificacion
clearAll()                     // Borrar todas
addNotification(notif)         // Agregar nueva
getFilterCount(filter)         // Contar por filtro
formatTime(timestamp)          // Formatear tiempo relativo

// Eventos
@notifications:open            // Panel abierto
@notifications:close           // Panel cerrado
@notification:read             // Notificacion leida
@notification:click            // Click en notificacion
@notification:action           // Click en accion
@notification:delete           // Notificacion eliminada
@notification:add              // Notificacion agregada
@notifications:all-read        // Todas marcadas como leidas
@notifications:clear           // Todas borradas</pre>
    </div>
  </div>

  <div class="demo-section">
    <h3>Integracion con HTMX</h3>
    <p>Cargar notificaciones desde el servidor.</p>
    <div class="demo-box">
      <pre class="ux-code-block" data-lang="html">&lt;!-- Cargar notificaciones al abrir --&gt;
&lt;div x-data="uxNotificationCenter()"
     @notifications:open="htmx.ajax('GET', '/api/notifications', { target: '#notif-list' })"&gt;
  &lt;div class="ux-notification-panel__content"&gt;
    &lt;ul id="notif-list" class="ux-notification-panel__list"&gt;
      &lt;!-- Notificaciones cargadas via HTMX --&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;!-- Polling para nuevas notificaciones --&gt;
&lt;div hx-get="/api/notifications/count"
     hx-trigger="every 30s"
     hx-swap="innerHTML"&gt;
  &lt;span class="ux-notification-trigger__badge"&gt;0&lt;/span&gt;
&lt;/div&gt;

&lt;!-- Marcar como leida en servidor --&gt;
&lt;li class="ux-notification-item"
    hx-post="/api/notifications/123/read"
    hx-trigger="click"
    hx-swap="none"&gt;
  ...
&lt;/li&gt;

&lt;!-- Respuesta del servidor --&gt;
&lt;li class="ux-notification-item ux-notification-item--unread"&gt;
  &lt;div class="ux-notification-item__icon ux-notification-item__icon--success"&gt;
    &lt;svg&gt;...&lt;/svg&gt;
  &lt;/div&gt;
  &lt;div class="ux-notification-item__content"&gt;
    &lt;div class="ux-notification-item__header"&gt;
      &lt;span class="ux-notification-item__title"&gt;Nuevo pedido&lt;/span&gt;
      &lt;span class="ux-notification-item__time"&gt;5m&lt;/span&gt;
    &lt;/div&gt;
    &lt;p class="ux-notification-item__message"&gt;Pedido #1234 recibido&lt;/p&gt;
  &lt;/div&gt;
&lt;/li&gt;</pre>
    </div>
  </div>

  <div class="demo-section">
    <h3>HTMX + Django</h3>
    <p>Notificaciones en tiempo real con Django y HTMX usando SSE (Server-Sent Events) o WebSockets via Django Channels.</p>

    <div class="demo-box">
      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin-bottom: var(--ux-space-sm);">1. Modelo Django</h4>
      <pre class="ux-code-block" data-lang="python"># models.py
from django.db import models
from django.contrib.auth import get_user_model

User = get_user_model()

class Notification(models.Model):
    TYPE_CHOICES = [
        ('info', 'Info'),
        ('success', 'Success'),
        ('warning', 'Warning'),
        ('error', 'Error'),
    ]

    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='notifications')
    title = models.CharField(max_length=200)
    message = models.TextField()
    type = models.CharField(max_length=20, choices=TYPE_CHOICES, default='info')
    read = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
    data = models.JSONField(default=dict, blank=True)

    class Meta:
        ordering = ['-created_at']

    def to_dict(self):
        return {
            'id': str(self.id),
            'title': self.title,
            'message': self.message,
            'type': self.type,
            'read': self.read,
            'timestamp': self.created_at.isoformat(),
            'data': self.data,
        }</pre>
    </div>

    <div class="demo-box">
      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin-bottom: var(--ux-space-sm);">2. Vistas Django (HTMX)</h4>
      <pre class="ux-code-block" data-lang="python"># views.py
from django.shortcuts import render
from django.http import HttpResponse
from django.views.decorators.http import require_POST, require_GET
from django.contrib.auth.decorators import login_required
from .models import Notification

@login_required
@require_GET
def notification_list(request):
    """Retorna lista de notificaciones como HTML parcial para HTMX"""
    notifications = Notification.objects.filter(user=request.user)[:50]
    return render(request, 'notifications/_list.html', {
        'notifications': notifications
    })

@login_required
@require_GET
def notification_count(request):
    """Retorna contador de no leidas para polling"""
    count = Notification.objects.filter(user=request.user, read=False).count()
    if count > 99:
        count = '99+'
    return HttpResponse(f'&lt;span class="ux-notification-trigger__badge"&gt;{count}&lt;/span&gt;')

@login_required
@require_POST
def mark_as_read(request, notification_id):
    """Marca una notificacion como leida"""
    Notification.objects.filter(
        id=notification_id,
        user=request.user
    ).update(read=True)
    return HttpResponse(status=204)

@login_required
@require_POST
def mark_all_read(request):
    """Marca todas las notificaciones como leidas"""
    Notification.objects.filter(user=request.user, read=False).update(read=True)
    return HttpResponse(status=204)

@login_required
@require_POST
def clear_all(request):
    """Elimina todas las notificaciones"""
    Notification.objects.filter(user=request.user).delete()
    return render(request, 'notifications/_empty.html')</pre>
    </div>

    <div class="demo-box">
      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin-bottom: var(--ux-space-sm);">3. URLs Django</h4>
      <pre class="ux-code-block" data-lang="python"># urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('notifications/', views.notification_list, name='notification_list'),
    path('notifications/count/', views.notification_count, name='notification_count'),
    path('notifications/&lt;int:notification_id&gt;/read/', views.mark_as_read, name='notification_read'),
    path('notifications/mark-all-read/', views.mark_all_read, name='notification_mark_all_read'),
    path('notifications/clear/', views.clear_all, name='notification_clear'),
]</pre>
    </div>

    <div class="demo-box">
      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin-bottom: var(--ux-space-sm);">4. Templates Django (Parciales HTMX)</h4>
      <pre class="ux-code-block" data-lang="html">&lt;!-- templates/notifications/_list.html --&gt;
{% for notification in notifications %}
&lt;li class="ux-notification-item {% if not notification.read %}ux-notification-item--unread{% endif %}"
    hx-post="{% url 'notification_read' notification.id %}"
    hx-trigger="click"
    hx-swap="none"&gt;
  &lt;div class="ux-notification-item__icon ux-notification-item__icon--{{ notification.type }}"&gt;
    {% if notification.type == 'success' %}
      &lt;svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;
        &lt;polyline points="20 6 9 17 4 12"&gt;&lt;/polyline&gt;
      &lt;/svg&gt;
    {% elif notification.type == 'warning' %}
      &lt;svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;
        &lt;path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"&gt;&lt;/path&gt;
        &lt;line x1="12" y1="9" x2="12" y2="13"&gt;&lt;/line&gt;
        &lt;line x1="12" y1="17" x2="12.01" y2="17"&gt;&lt;/line&gt;
      &lt;/svg&gt;
    {% elif notification.type == 'error' %}
      &lt;svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;
        &lt;circle cx="12" cy="12" r="10"&gt;&lt;/circle&gt;
        &lt;line x1="15" y1="9" x2="9" y2="15"&gt;&lt;/line&gt;
        &lt;line x1="9" y1="9" x2="15" y2="15"&gt;&lt;/line&gt;
      &lt;/svg&gt;
    {% else %}
      &lt;svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;
        &lt;circle cx="12" cy="12" r="10"&gt;&lt;/circle&gt;
        &lt;line x1="12" y1="16" x2="12" y2="12"&gt;&lt;/line&gt;
        &lt;line x1="12" y1="8" x2="12.01" y2="8"&gt;&lt;/line&gt;
      &lt;/svg&gt;
    {% endif %}
  &lt;/div&gt;
  &lt;div class="ux-notification-item__content"&gt;
    &lt;div class="ux-notification-item__header"&gt;
      &lt;span class="ux-notification-item__title"&gt;{{ notification.title }}&lt;/span&gt;
      &lt;span class="ux-notification-item__time"&gt;{{ notification.created_at|timesince }}&lt;/span&gt;
    &lt;/div&gt;
    &lt;p class="ux-notification-item__message"&gt;{{ notification.message }}&lt;/p&gt;
  &lt;/div&gt;
  {% if not notification.read %}
  &lt;div class="ux-notification-item__dot"&gt;&lt;/div&gt;
  {% endif %}
&lt;/li&gt;
{% empty %}
&lt;li class="ux-notification-panel__empty"&gt;
  &lt;div class="ux-notification-panel__empty-title"&gt;No hay notificaciones&lt;/div&gt;
&lt;/li&gt;
{% endfor %}

&lt;!-- templates/notifications/_empty.html --&gt;
&lt;div class="ux-notification-panel__empty"&gt;
  &lt;div class="ux-notification-panel__empty-title"&gt;No hay notificaciones&lt;/div&gt;
  &lt;div class="ux-notification-panel__empty-description"&gt;Las nuevas notificaciones apareceran aqui&lt;/div&gt;
&lt;/div&gt;</pre>
    </div>

    <div class="demo-box">
      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin-bottom: var(--ux-space-sm);">5. Frontend con HTMX</h4>
      <pre class="ux-code-block" data-lang="html">&lt;!-- Panel de notificaciones completo --&gt;
&lt;div x-data="{ isOpen: false }"&gt;
  &lt;!-- Trigger con polling para contador --&gt;
  &lt;button class="ux-notification-trigger" @click="isOpen = !isOpen"&gt;
    &lt;svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;
      &lt;path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"&gt;&lt;/path&gt;
      &lt;path d="M13.73 21a2 2 0 0 1-3.46 0"&gt;&lt;/path&gt;
    &lt;/svg&gt;
    &lt;span hx-get="{% url 'notification_count' %}"
          hx-trigger="load, every 30s"
          hx-swap="innerHTML"&gt;&lt;/span&gt;
  &lt;/button&gt;

  &lt;!-- Backdrop --&gt;
  &lt;div class="ux-notification-panel__backdrop"
       :class="{ 'ux-notification-panel__backdrop--open': isOpen }"
       @click="isOpen = false"&gt;&lt;/div&gt;

  &lt;!-- Panel --&gt;
  &lt;div class="ux-notification-panel"
       :class="{ 'ux-notification-panel--open': isOpen }"&gt;
    &lt;div class="ux-notification-panel__header"&gt;
      &lt;h2 class="ux-notification-panel__title"&gt;Notificaciones&lt;/h2&gt;
      &lt;div class="ux-notification-panel__actions"&gt;
        &lt;button class="ux-notification-panel__action"
                hx-post="{% url 'notification_mark_all_read' %}"
                hx-swap="none"
                hx-on::after-request="htmx.trigger('#notif-list', 'refresh')"&gt;
          &lt;svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;
            &lt;polyline points="9 11 12 14 22 4"&gt;&lt;/polyline&gt;
            &lt;path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"&gt;&lt;/path&gt;
          &lt;/svg&gt;
        &lt;/button&gt;
        &lt;button class="ux-notification-panel__action" @click="isOpen = false"&gt;
          &lt;svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;
            &lt;line x1="18" y1="6" x2="6" y2="18"&gt;&lt;/line&gt;
            &lt;line x1="6" y1="6" x2="18" y2="18"&gt;&lt;/line&gt;
          &lt;/svg&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="ux-notification-panel__content"&gt;
      &lt;ul id="notif-list"
          class="ux-notification-panel__list"
          hx-get="{% url 'notification_list' %}"
          hx-trigger="load, refresh from:body"
          hx-swap="innerHTML"&gt;
        &lt;!-- Cargando... --&gt;
        &lt;li style="text-align: center; padding: var(--ux-space-lg);"&gt;
          &lt;div class="ux-spinner"&gt;&lt;/div&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;

    &lt;div class="ux-notification-panel__footer"&gt;
      &lt;a class="ux-notification-panel__footer-link"
         hx-post="{% url 'notification_clear' %}"
         hx-target="#notif-list"
         hx-swap="innerHTML"&gt;
        Borrar todas
      &lt;/a&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
    </div>

    <div class="demo-box">
      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin-bottom: var(--ux-space-sm);">6. Django Channels (WebSocket en tiempo real)</h4>
      <pre class="ux-code-block" data-lang="python"># consumers.py
import json
from channels.generic.websocket import AsyncWebsocketConsumer
from channels.db import database_sync_to_async
from .models import Notification

class NotificationConsumer(AsyncWebsocketConsumer):
    async def connect(self):
        self.user = self.scope['user']
        if self.user.is_anonymous:
            await self.close()
            return

        self.group_name = f'notifications_{self.user.id}'
        await self.channel_layer.group_add(self.group_name, self.channel_name)
        await self.accept()

    async def disconnect(self, close_code):
        if hasattr(self, 'group_name'):
            await self.channel_layer.group_discard(self.group_name, self.channel_name)

    async def notification_new(self, event):
        """Envia nueva notificacion al WebSocket"""
        await self.send(text_data=json.dumps({
            'type': 'new',
            'notification': event['notification']
        }))

# routing.py
from django.urls import path
from . import consumers

websocket_urlpatterns = [
    path('ws/notifications/', consumers.NotificationConsumer.as_asgi()),
]

# utils.py - Enviar notificacion desde cualquier parte de Django
from asgiref.sync import async_to_sync
from channels.layers import get_channel_layer

def send_notification(user_id, notification_data):
    """Envia notificacion en tiempo real via WebSocket"""
    channel_layer = get_channel_layer()
    async_to_sync(channel_layer.group_send)(
        f'notifications_{user_id}',
        {
            'type': 'notification_new',
            'notification': notification_data
        }
    )</pre>
    </div>

    <div class="demo-box">
      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin-bottom: var(--ux-space-sm);">7. Cliente WebSocket + Alpine.js</h4>
      <pre class="ux-code-block" data-lang="html">&lt;!-- Componente con WebSocket --&gt;
&lt;div x-data="{
  isOpen: false,
  notifications: [],
  unreadCount: 0,
  ws: null,

  init() {
    this.connectWebSocket();
    this.loadNotifications();
  },

  connectWebSocket() {
    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    this.ws = new WebSocket(`${protocol}//${window.location.host}/ws/notifications/`);

    this.ws.onmessage = (event) =&gt; {
      const data = JSON.parse(event.data);
      if (data.type === 'new') {
        this.notifications.unshift(data.notification);
        this.unreadCount++;
        this.showToast(data.notification);
      }
    };

    this.ws.onclose = () =&gt; {
      // Reconectar despues de 3 segundos
      setTimeout(() =&gt; this.connectWebSocket(), 3000);
    };
  },

  async loadNotifications() {
    const response = await fetch('/api/notifications/');
    const data = await response.json();
    this.notifications = data.notifications;
    this.unreadCount = data.unread_count;
  },

  showToast(notification) {
    // Mostrar toast con la nueva notificacion
    window.dispatchEvent(new CustomEvent('toast:show', {
      detail: {
        message: notification.title,
        type: notification.type,
        duration: 5000
      }
    }));
  }
}"&gt;
  &lt;!-- Trigger --&gt;
  &lt;button class="ux-notification-trigger" @click="isOpen = !isOpen"&gt;
    &lt;svg&gt;...&lt;/svg&gt;
    &lt;span x-show="unreadCount &gt; 0"
          class="ux-notification-trigger__badge"
          x-text="unreadCount &gt; 99 ? '99+' : unreadCount"&gt;&lt;/span&gt;
  &lt;/button&gt;

  &lt;!-- Panel con notificaciones en tiempo real --&gt;
  &lt;div class="ux-notification-panel" :class="{ 'ux-notification-panel--open': isOpen }"&gt;
    &lt;!-- ... contenido del panel ... --&gt;
    &lt;ul class="ux-notification-panel__list"&gt;
      &lt;template x-for="notification in notifications" :key="notification.id"&gt;
        &lt;li class="ux-notification-item"
            :class="{ 'ux-notification-item--unread': !notification.read }"&gt;
          &lt;!-- ... contenido de notificacion ... --&gt;
        &lt;/li&gt;
      &lt;/template&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
    </div>

    <div class="demo-box">
      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin-bottom: var(--ux-space-sm);">8. Server-Sent Events (SSE) - Alternativa Ligera</h4>
      <pre class="ux-code-block" data-lang="python"># views.py - SSE endpoint
import json
from django.http import StreamingHttpResponse
from django.contrib.auth.decorators import login_required
import time

@login_required
def notification_stream(request):
    """Stream de notificaciones usando SSE"""
    def event_stream():
        last_id = 0
        while True:
            # Verificar nuevas notificaciones
            notifications = Notification.objects.filter(
                user=request.user,
                id__gt=last_id
            ).order_by('id')

            for notif in notifications:
                last_id = notif.id
                data = json.dumps(notif.to_dict())
                yield f"event: notification\ndata: {data}\n\n"

            time.sleep(2)  # Polling cada 2 segundos

    response = StreamingHttpResponse(
        event_stream(),
        content_type='text/event-stream'
    )
    response['Cache-Control'] = 'no-cache'
    response['X-Accel-Buffering'] = 'no'
    return response</pre>
      <pre class="ux-code-block" data-lang="html">&lt;!-- Cliente SSE --&gt;
&lt;script&gt;
const eventSource = new EventSource('/notifications/stream/');

eventSource.addEventListener('notification', (event) =&gt; {
  const notification = JSON.parse(event.data);

  // Agregar a la lista via Alpine.js
  Alpine.store('notifications').add(notification);

  // O refrescar via HTMX
  htmx.trigger('#notif-list', 'refresh');
});

eventSource.onerror = () =&gt; {
  // Reconectar automaticamente
  setTimeout(() =&gt; {
    eventSource.close();
    location.reload();
  }, 5000);
};
&lt;/script&gt;</pre>
    </div>
  </div>