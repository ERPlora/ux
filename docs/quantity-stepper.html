<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Quantity Stepper - UX Library</title>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="../components/ux-core.js"></script>
  <script src="../components/ux-button.js"></script>
  <script src="../components/ux-navbar.js"></script>
  <script src="../components/ux-content.js"></script>
  <script src="../components/ux-quantity-stepper.js"></script>
  <script src="../components/ux-code-block.js"></script>
  <style>
    .demo-section { margin-bottom: var(--ux-space-xl); }
    .demo-section h3 { font-size: var(--ux-font-size-lg); font-weight: 600; margin-bottom: var(--ux-space-md); }
    .demo-section p { font-size: var(--ux-font-size-md); color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md); }
    .demo-box { background: var(--ux-surface-secondary); border-radius: var(--ux-border-radius-lg); padding: var(--ux-space-lg); margin-bottom: var(--ux-space-md); display: flex; flex-wrap: wrap; gap: var(--ux-space-lg); align-items: center; }
  </style>
</head>
<body class="ux-app">

  <div class="ux-content" style="padding: var(--ux-space-lg);">
    <h2 style="margin-bottom: var(--ux-space-lg);">Quantity Stepper</h2>
    <p style="color: var(--ux-text-secondary); margin-bottom: var(--ux-space-xl);">Selector de cantidad con botones +/- para carrito de compras y sistemas POS.</p>

    <section class="demo-section">
      <h3>Basico</h3>
      <p>Stepper horizontal con botones +/-.</p>
      <div class="demo-box">
        <div class="ux-quantity-stepper"
             x-data="uxQuantityStepper({ value: 1, min: 0, max: 99 })"
             @quantity-change="console.log('Quantity:', $event.detail)">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus"
                  :class="{ 'ux-quantity-stepper__btn--disabled': isAtMin }"
                  :disabled="isAtMin"
                  @mousedown="onDecrementStart($event)"
                  @mouseup="onPressEnd()"
                  @mouseleave="onPressEnd()"
                  @touchstart="onDecrementStart($event)"
                  @touchend="onPressEnd()"
                  x-html="minusIcon">
          </button>
          <input type="text"
                 class="ux-quantity-stepper__input"
                 :value="value"
                 @input="onInput($event)"
                 @blur="onBlur($event)"
                 @keydown="onKeydown($event)"
                 inputmode="numeric"
                 pattern="[0-9]*">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus"
                  :class="{ 'ux-quantity-stepper__btn--disabled': isAtMax }"
                  :disabled="isAtMax"
                  @mousedown="onIncrementStart($event)"
                  @mouseup="onPressEnd()"
                  @mouseleave="onPressEnd()"
                  @touchstart="onIncrementStart($event)"
                  @touchend="onPressEnd()"
                  x-html="plusIcon">
          </button>
        </div>
      </div>
      <pre class="ux-code-block" data-lang="html">&lt;div class="ux-quantity-stepper" x-data="uxQuantityStepper({ value: 1 })"&gt;
  &lt;button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus"&gt;-&lt;/button&gt;
  &lt;input class="ux-quantity-stepper__input" :value="value"&gt;
  &lt;button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus"&gt;+&lt;/button&gt;
&lt;/div&gt;</pre>
    </section>

    <section class="demo-section">
      <h3>Sizes</h3>
      <div class="demo-box">
        <div>
          <p style="margin-bottom: var(--ux-space-sm); color: var(--ux-text-secondary); font-size: var(--ux-font-size-sm);">Small</p>
          <div class="ux-quantity-stepper ux-quantity-stepper--sm" x-data="uxQuantityStepper({ value: 2 })">
            <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus" :disabled="isAtMin" @click="decrement()" x-html="minusIcon"></button>
            <input type="text" class="ux-quantity-stepper__input" :value="value" @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric">
            <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus" :disabled="isAtMax" @click="increment()" x-html="plusIcon"></button>
          </div>
        </div>
        <div>
          <p style="margin-bottom: var(--ux-space-sm); color: var(--ux-text-secondary); font-size: var(--ux-font-size-sm);">Default</p>
          <div class="ux-quantity-stepper" x-data="uxQuantityStepper({ value: 3 })">
            <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus" :disabled="isAtMin" @click="decrement()" x-html="minusIcon"></button>
            <input type="text" class="ux-quantity-stepper__input" :value="value" @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric">
            <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus" :disabled="isAtMax" @click="increment()" x-html="plusIcon"></button>
          </div>
        </div>
        <div>
          <p style="margin-bottom: var(--ux-space-sm); color: var(--ux-text-secondary); font-size: var(--ux-font-size-sm);">Large</p>
          <div class="ux-quantity-stepper ux-quantity-stepper--lg" x-data="uxQuantityStepper({ value: 5 })">
            <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus" :disabled="isAtMin" @click="decrement()" x-html="minusIcon"></button>
            <input type="text" class="ux-quantity-stepper__input" :value="value" @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric">
            <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus" :disabled="isAtMax" @click="increment()" x-html="plusIcon"></button>
          </div>
        </div>
      </div>
    </section>

    <section class="demo-section">
      <h3>Vertical</h3>
      <div class="demo-box">
        <div class="ux-quantity-stepper ux-quantity-stepper--vertical" x-data="uxQuantityStepper({ value: 1 })">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus" :disabled="isAtMax" @click="increment()" x-html="plusIcon"></button>
          <input type="text" class="ux-quantity-stepper__input" :value="value" @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus" :disabled="isAtMin" @click="decrement()" x-html="minusIcon"></button>
        </div>
        <div class="ux-quantity-stepper ux-quantity-stepper--vertical ux-quantity-stepper--sm" x-data="uxQuantityStepper({ value: 2 })">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus" :disabled="isAtMax" @click="increment()" x-html="plusIcon"></button>
          <input type="text" class="ux-quantity-stepper__input" :value="value" @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus" :disabled="isAtMin" @click="decrement()" x-html="minusIcon"></button>
        </div>
      </div>
    </section>

    <section class="demo-section">
      <h3>Rounded</h3>
      <div class="demo-box">
        <div class="ux-quantity-stepper ux-quantity-stepper--round" x-data="uxQuantityStepper({ value: 1 })">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus" :disabled="isAtMin" @click="decrement()" x-html="minusIcon"></button>
          <input type="text" class="ux-quantity-stepper__input" :value="value" @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus" :disabled="isAtMax" @click="increment()" x-html="plusIcon"></button>
        </div>
      </div>
    </section>

    <section class="demo-section">
      <h3>Compact</h3>
      <div class="demo-box">
        <div class="ux-quantity-stepper ux-quantity-stepper--compact" x-data="uxQuantityStepper({ value: 1 })">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus" :disabled="isAtMin" @click="decrement()" x-html="minusIcon"></button>
          <input type="text" class="ux-quantity-stepper__input" :value="value" @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus" :disabled="isAtMax" @click="increment()" x-html="plusIcon"></button>
        </div>
      </div>
    </section>

    <section class="demo-section">
      <h3>Glass Variant</h3>
      <div class="demo-box" style="background: var(--ux-demo-gradient); padding: var(--ux-space-xl);">
        <div class="ux-quantity-stepper ux-quantity-stepper--glass" x-data="uxQuantityStepper({ value: 3 })">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus" :disabled="isAtMin" @click="decrement()" x-html="minusIcon"></button>
          <input type="text" class="ux-quantity-stepper__input" :value="value" @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus" :disabled="isAtMax" @click="increment()" x-html="plusIcon"></button>
        </div>
      </div>
    </section>

    <section class="demo-section">
      <h3>Con Limites</h3>
      <p>Min: 1, Max: 10, Step: 2</p>
      <div class="demo-box">
        <div class="ux-quantity-stepper" x-data="uxQuantityStepper({ value: 1, min: 1, max: 10, step: 2 })" @quantity-change="console.log('Value:', $event.detail)">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus" :disabled="isAtMin" @click="decrement()" x-html="minusIcon"></button>
          <input type="text" class="ux-quantity-stepper__input" :value="value" @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric">
          <button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus" :disabled="isAtMax" @click="increment()" x-html="plusIcon"></button>
        </div>
        <span style="color: var(--ux-text-secondary);">Value: <strong x-data x-text="$root.querySelector('[x-data*=uxQuantityStepper]')?._x_dataStack?.[0]?.value || '?'">?</strong></span>
      </div>
    </section>

    <section class="demo-section">
      <h3>Keyboard Support</h3>
      <ul style="color: var(--ux-text-secondary); margin-left: var(--ux-space-lg);">
        <li><strong>Arrow Up/Down</strong> - Incrementar/decrementar</li>
        <li><strong>Page Up/Down</strong> - Incrementar/decrementar x10</li>
        <li><strong>Home</strong> - Ir al minimo</li>
        <li><strong>End</strong> - Ir al maximo</li>
      </ul>
    </section>

    <section class="demo-section">
      <h3>API</h3>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="text-align: left; border-bottom: 1px solid var(--ux-border-color);">
            <th style="padding: var(--ux-space-sm);">Propiedad</th>
            <th style="padding: var(--ux-space-sm);">Tipo</th>
            <th style="padding: var(--ux-space-sm);">Default</th>
            <th style="padding: var(--ux-space-sm);">Descripcion</th>
          </tr>
        </thead>
        <tbody style="font-size: var(--ux-font-size-sm);">
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>value</code></td>
            <td style="padding: var(--ux-space-sm);">Number</td>
            <td style="padding: var(--ux-space-sm);">1</td>
            <td style="padding: var(--ux-space-sm);">Valor actual</td>
          </tr>
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>min</code></td>
            <td style="padding: var(--ux-space-sm);">Number</td>
            <td style="padding: var(--ux-space-sm);">0</td>
            <td style="padding: var(--ux-space-sm);">Valor minimo</td>
          </tr>
          <tr style="border-bottom: 1px solid var(--ux-border-color);">
            <td style="padding: var(--ux-space-sm);"><code>max</code></td>
            <td style="padding: var(--ux-space-sm);">Number</td>
            <td style="padding: var(--ux-space-sm);">999</td>
            <td style="padding: var(--ux-space-sm);">Valor maximo</td>
          </tr>
          <tr>
            <td style="padding: var(--ux-space-sm);"><code>step</code></td>
            <td style="padding: var(--ux-space-sm);">Number</td>
            <td style="padding: var(--ux-space-sm);">1</td>
            <td style="padding: var(--ux-space-sm);">Incremento por click</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section class="demo-section">
      <h3>HTMX + Django</h3>
      <p>Integracion con HTMX para actualizar cantidades en carrito de compras.</p>

      <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Template Django (cart_item.html)</h4>
      <pre class="ux-code-block" data-lang="html">&lt;div class="cart-item" id="cart-item-{{ item.id }}"&gt;
  &lt;div class="cart-item__info"&gt;
    &lt;span&gt;{{ item.product.name }}&lt;/span&gt;
    &lt;span&gt;${{ item.subtotal }}&lt;/span&gt;
  &lt;/div&gt;

  &lt;div class="ux-quantity-stepper"
       x-data="uxQuantityStepper({ value: {{ item.quantity }}, min: 1, max: {{ item.product.stock }} })"
       @quantity-change="
         htmx.ajax('POST', '/cart/update/{{ item.id }}/',
           { values: { quantity: $event.detail.value }, target: '#cart-item-{{ item.id }}', swap: 'outerHTML' }
         )
       "&gt;
    &lt;button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus"
            :disabled="isAtMin" @click="decrement()" x-html="minusIcon"&gt;&lt;/button&gt;
    &lt;input type="text" class="ux-quantity-stepper__input" :value="value"
           @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric"&gt;
    &lt;button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus"
            :disabled="isAtMax" @click="increment()" x-html="plusIcon"&gt;&lt;/button&gt;
  &lt;/div&gt;

  &lt;button class="ux-button ux-button--clear ux-color-danger"
          hx-delete="/cart/remove/{{ item.id }}/"
          hx-target="#cart-item-{{ item.id }}"
          hx-swap="outerHTML"
          hx-confirm="Eliminar este producto?"&gt;
    Eliminar
  &lt;/button&gt;
&lt;/div&gt;</pre>

      <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Vista Django (views.py)</h4>
      <pre class="ux-code-block" data-lang="python">from django.http import HttpResponse
from django.template.loader import render_to_string
from django.views.decorators.http import require_POST, require_http_methods

@require_POST
def cart_update(request, item_id):
    """Actualiza la cantidad de un item en el carrito."""
    cart_item = get_object_or_404(CartItem, id=item_id, cart__user=request.user)
    quantity = int(request.POST.get('quantity', 1))

    # Validar stock disponible
    if quantity &gt; cart_item.product.stock:
        quantity = cart_item.product.stock

    cart_item.quantity = quantity
    cart_item.save()

    # Retornar el fragmento HTML actualizado
    html = render_to_string('cart/cart_item.html', {
        'item': cart_item
    }, request=request)

    response = HttpResponse(html)
    # Trigger evento para actualizar totales del carrito
    response['HX-Trigger'] = 'cart-updated'
    return response

@require_http_methods(["DELETE"])
def cart_remove(request, item_id):
    """Elimina un item del carrito."""
    cart_item = get_object_or_404(CartItem, id=item_id, cart__user=request.user)
    cart_item.delete()

    response = HttpResponse("")
    response['HX-Trigger'] = 'cart-updated'
    return response</pre>

      <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Actualizar totales con HX-Trigger</h4>
      <pre class="ux-code-block" data-lang="html">&lt;!-- En el layout del carrito --&gt;
&lt;div class="cart-totals"
     hx-get="/cart/totals/"
     hx-trigger="cart-updated from:body"
     hx-swap="innerHTML"&gt;
  &lt;span&gt;Total: ${{ cart.total }}&lt;/span&gt;
  &lt;span&gt;Items: {{ cart.item_count }}&lt;/span&gt;
&lt;/div&gt;</pre>

      <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Stepper con debounce para POS</h4>
      <pre class="ux-code-block" data-lang="html">&lt;!-- Stepper con debounce para evitar multiples requests --&gt;
&lt;div class="ux-quantity-stepper ux-quantity-stepper--lg"
     x-data="{
       ...uxQuantityStepper({ value: {{ item.quantity }}, min: 0, max: 999 }),
       timeout: null,
       updateCart(value) {
         clearTimeout(this.timeout);
         this.timeout = setTimeout(() =&gt; {
           htmx.ajax('POST', '/pos/update-line/{{ item.id }}/',
             { values: { qty: value } }
           );
         }, 300);
       }
     }"
     @quantity-change="updateCart($event.detail.value)"&gt;
  &lt;button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--minus"
          :disabled="isAtMin" @click="decrement()" x-html="minusIcon"&gt;&lt;/button&gt;
  &lt;input type="text" class="ux-quantity-stepper__input" :value="value"
         @input="onInput($event)" @blur="onBlur($event)" inputmode="numeric"&gt;
  &lt;button class="ux-quantity-stepper__btn ux-quantity-stepper__btn--plus"
          :disabled="isAtMax" @click="increment()" x-html="plusIcon"&gt;&lt;/button&gt;
&lt;/div&gt;</pre>
    </section>
  </div>
</body>
</html>
