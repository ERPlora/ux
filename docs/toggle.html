<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Toggle - UX Library</title>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="../components/ux-core.js"></script>
  <script src="../components/ux-button.js"></script>
  <script src="../components/ux-navbar.js"></script>
  <script src="../components/ux-content.js"></script>
  <script src="../components/ux-toggle.js"></script>
  <script src="../components/ux-list.js"></script>
  <script src="../components/ux-code-block.js"></script>
  <style>
    .demo-section { margin-bottom: var(--ux-space-xl); }
    .demo-section h3 { font-size: var(--ux-font-size-lg); font-weight: 600; margin-bottom: var(--ux-space-md); }
    .demo-section p { font-size: var(--ux-font-size-md); color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md); }
    .demo-box { background: var(--ux-surface); border-radius: var(--ux-border-radius-lg); padding: var(--ux-space-lg); margin-bottom: var(--ux-space-md); display: flex; flex-wrap: wrap; gap: var(--ux-space-lg); align-items: center; }
  </style>
</head>
<body class="ux-app">

  <div class="ux-content" style="padding: var(--ux-space-lg);">
    <section class="demo-section">
      <h3>Toggle Basico (iOS Style)</h3>
      <p>Switch estilo iOS nativo.</p>
      <div class="demo-box">
        <label class="ux-toggle">
          <input type="checkbox" checked>
          <span class="ux-toggle__track">
            <span class="ux-toggle__thumb"></span>
          </span>
        </label>
        <label class="ux-toggle">
          <input type="checkbox">
          <span class="ux-toggle__track">
            <span class="ux-toggle__thumb"></span>
          </span>
        </label>
      </div>
      <pre class="ux-code-block" data-lang="html">&lt;label class="ux-toggle"&gt;
  &lt;input type="checkbox"&gt;
  &lt;span class="ux-toggle__track"&gt;
    &lt;span class="ux-toggle__thumb"&gt;&lt;/span&gt;
  &lt;/span&gt;
&lt;/label&gt;</pre>
    </section>

    <section class="demo-section">
      <h3>Colores</h3>
      <div class="demo-box">
        <label class="ux-toggle ux-toggle--primary">
          <input type="checkbox" checked>
          <span class="ux-toggle__track"><span class="ux-toggle__thumb"></span></span>
        </label>
        <label class="ux-toggle ux-toggle--success">
          <input type="checkbox" checked>
          <span class="ux-toggle__track"><span class="ux-toggle__thumb"></span></span>
        </label>
        <label class="ux-toggle ux-toggle--warning">
          <input type="checkbox" checked>
          <span class="ux-toggle__track"><span class="ux-toggle__thumb"></span></span>
        </label>
        <label class="ux-toggle ux-toggle--danger">
          <input type="checkbox" checked>
          <span class="ux-toggle__track"><span class="ux-toggle__thumb"></span></span>
        </label>
      </div>
      <pre class="ux-code-block" data-lang="html">&lt;label class="ux-toggle ux-toggle--success"&gt;...&lt;/label&gt;</pre>
    </section>

    <section class="demo-section">
      <h3>Con Label</h3>
      <div class="demo-box" style="flex-direction: column; align-items: stretch;">
        <label class="ux-toggle-item">
          <span class="ux-toggle-item__label">
            <span class="ux-toggle-item__text">Wi-Fi</span>
            <span class="ux-toggle-item__note">Conectado</span>
          </span>
          <span class="ux-toggle">
            <input type="checkbox" checked>
            <span class="ux-toggle__track"><span class="ux-toggle__thumb"></span></span>
          </span>
        </label>
        <label class="ux-toggle-item">
          <span class="ux-toggle-item__label">
            <span class="ux-toggle-item__text">Bluetooth</span>
          </span>
          <span class="ux-toggle">
            <input type="checkbox">
            <span class="ux-toggle__track"><span class="ux-toggle__thumb"></span></span>
          </span>
        </label>
        <label class="ux-toggle-item">
          <span class="ux-toggle-item__label">
            <span class="ux-toggle-item__text">Modo Avion</span>
          </span>
          <span class="ux-toggle">
            <input type="checkbox">
            <span class="ux-toggle__track"><span class="ux-toggle__thumb"></span></span>
          </span>
        </label>
      </div>
      <pre class="ux-code-block" data-lang="html">&lt;label class="ux-toggle-item"&gt;
  &lt;span class="ux-toggle-item__label"&gt;
    &lt;span class="ux-toggle-item__text"&gt;Wi-Fi&lt;/span&gt;
    &lt;span class="ux-toggle-item__note"&gt;Conectado&lt;/span&gt;
  &lt;/span&gt;
  &lt;span class="ux-toggle"&gt;
    &lt;input type="checkbox"&gt;
    &lt;span class="ux-toggle__track"&gt;
      &lt;span class="ux-toggle__thumb"&gt;&lt;/span&gt;
    &lt;/span&gt;
  &lt;/span&gt;
&lt;/label&gt;</pre>
    </section>

    <section class="demo-section">
      <h3>Estados</h3>
      <div class="demo-box">
        <label class="ux-toggle">
          <input type="checkbox" checked disabled>
          <span class="ux-toggle__track"><span class="ux-toggle__thumb"></span></span>
        </label>
        <span style="font-size: var(--ux-font-size-md); color: var(--ux-text-secondary);">Disabled On</span>
        <label class="ux-toggle">
          <input type="checkbox" disabled>
          <span class="ux-toggle__track"><span class="ux-toggle__thumb"></span></span>
        </label>
        <span style="font-size: var(--ux-font-size-md); color: var(--ux-text-secondary);">Disabled Off</span>
      </div>
    </section>

    <section class="demo-section">
      <h3>Con HTMX</h3>
      <pre class="ux-code-block" data-lang="html">&lt;label class="ux-toggle"&gt;
  &lt;input type="checkbox"
         name="notifications"
         hx-post="/settings/notifications"
         hx-trigger="change"
         hx-swap="none"&gt;
  &lt;span class="ux-toggle__track"&gt;
    &lt;span class="ux-toggle__thumb"&gt;&lt;/span&gt;
  &lt;/span&gt;
&lt;/label&gt;</pre>
    </section>

    <section class="demo-section">
      <h3>HTMX + Django</h3>
      <p>Ejemplos de integracion con Django para guardar preferencias de usuario.</p>

      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin: var(--ux-space-md) 0;">Toggle para activar/desactivar funcionalidades</h4>
      <pre class="ux-code-block" data-lang="html">&lt;!-- Template: settings.html --&gt;
&lt;div class="ux-list ux-list--inset"&gt;
  &lt;label class="ux-toggle-item"&gt;
    &lt;span class="ux-toggle-item__label"&gt;
      &lt;span class="ux-toggle-item__text"&gt;Notificaciones push&lt;/span&gt;
      &lt;span class="ux-toggle-item__note"&gt;Recibe alertas en tiempo real&lt;/span&gt;
    &lt;/span&gt;
    &lt;span class="ux-toggle"&gt;
      &lt;input type="checkbox"
             name="push_notifications"
             {% if user.preferences.push_notifications %}checked{% endif %}
             hx-post="{% url 'user:toggle_preference' %}"
             hx-vals='{"preference": "push_notifications"}'
             hx-trigger="change"
             hx-swap="none"
             hx-indicator="#save-indicator"&gt;
      &lt;span class="ux-toggle__track"&gt;&lt;span class="ux-toggle__thumb"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/span&gt;
  &lt;/label&gt;

  &lt;label class="ux-toggle-item"&gt;
    &lt;span class="ux-toggle-item__label"&gt;
      &lt;span class="ux-toggle-item__text"&gt;Modo oscuro&lt;/span&gt;
      &lt;span class="ux-toggle-item__note"&gt;Tema oscuro para la interfaz&lt;/span&gt;
    &lt;/span&gt;
    &lt;span class="ux-toggle"&gt;
      &lt;input type="checkbox"
             name="dark_mode"
             {% if user.preferences.dark_mode %}checked{% endif %}
             hx-post="{% url 'user:toggle_preference' %}"
             hx-vals='{"preference": "dark_mode"}'
             hx-trigger="change"
             hx-swap="none"&gt;
      &lt;span class="ux-toggle__track"&gt;&lt;span class="ux-toggle__thumb"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/span&gt;
  &lt;/label&gt;

  &lt;label class="ux-toggle-item"&gt;
    &lt;span class="ux-toggle-item__label"&gt;
      &lt;span class="ux-toggle-item__text"&gt;Email marketing&lt;/span&gt;
      &lt;span class="ux-toggle-item__note"&gt;Ofertas y novedades por correo&lt;/span&gt;
    &lt;/span&gt;
    &lt;span class="ux-toggle"&gt;
      &lt;input type="checkbox"
             name="email_marketing"
             {% if user.preferences.email_marketing %}checked{% endif %}
             hx-post="{% url 'user:toggle_preference' %}"
             hx-vals='{"preference": "email_marketing"}'
             hx-trigger="change"
             hx-swap="none"&gt;
      &lt;span class="ux-toggle__track"&gt;&lt;span class="ux-toggle__thumb"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/span&gt;
  &lt;/label&gt;
&lt;/div&gt;

&lt;!-- Indicador de guardado --&gt;
&lt;div id="save-indicator" class="htmx-indicator" style="text-align: center; padding: var(--ux-space-sm);"&gt;
  &lt;span class="ux-spinner ux-spinner--sm"&gt;&lt;/span&gt; Guardando...
&lt;/div&gt;</pre>

      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin: var(--ux-space-md) 0;">Toggle con feedback visual</h4>
      <pre class="ux-code-block" data-lang="html">&lt;!-- Toggle que muestra estado guardado --&gt;
&lt;div id="feature-toggle-container"&gt;
  &lt;label class="ux-toggle-item"&gt;
    &lt;span class="ux-toggle-item__label"&gt;
      &lt;span class="ux-toggle-item__text"&gt;Modo mantenimiento&lt;/span&gt;
      &lt;span class="ux-toggle-item__note" id="maintenance-status"&gt;
        {% if site_settings.maintenance_mode %}Activo{% else %}Inactivo{% endif %}
      &lt;/span&gt;
    &lt;/span&gt;
    &lt;span class="ux-toggle ux-toggle--warning"&gt;
      &lt;input type="checkbox"
             name="maintenance_mode"
             {% if site_settings.maintenance_mode %}checked{% endif %}
             hx-post="{% url 'admin:toggle_maintenance' %}"
             hx-trigger="change"
             hx-target="#maintenance-status"
             hx-swap="innerHTML"&gt;
      &lt;span class="ux-toggle__track"&gt;&lt;span class="ux-toggle__thumb"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/span&gt;
  &lt;/label&gt;
&lt;/div&gt;</pre>

      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin: var(--ux-space-md) 0;">Vista Django que procesa el cambio de estado</h4>
      <pre class="ux-code-block" data-lang="python"># views.py
from django.http import HttpResponse
from django.views.decorators.http import require_POST
from django.contrib.auth.decorators import login_required
from .models import UserPreferences

@login_required
@require_POST
def toggle_preference(request):
    """Toggle una preferencia booleana del usuario."""
    preference = request.POST.get('preference')

    # Lista de preferencias permitidas
    allowed_preferences = [
        'push_notifications',
        'dark_mode',
        'email_marketing',
        'two_factor_auth',
        'public_profile'
    ]

    if preference not in allowed_preferences:
        return HttpResponse(status=400)

    # Obtener o crear preferencias del usuario
    prefs, created = UserPreferences.objects.get_or_create(
        user=request.user
    )

    # Toggle el valor (checkbox envia valor solo si esta checked)
    current_value = getattr(prefs, preference, False)
    new_value = preference in request.POST  # True si checkbox esta marcado

    # Si el valor viene como 'on' del checkbox
    checkbox_value = request.POST.get(preference)
    new_value = checkbox_value == 'on'

    setattr(prefs, preference, new_value)
    prefs.save()

    # Respuesta vacia para hx-swap="none"
    return HttpResponse(status=204)


@login_required
@require_POST
def toggle_maintenance(request):
    """Toggle modo mantenimiento (solo admin)."""
    if not request.user.is_staff:
        return HttpResponse(status=403)

    from .models import SiteSettings
    settings = SiteSettings.get_solo()  # usando django-solo

    # Toggle basado en si el checkbox esta marcado
    settings.maintenance_mode = 'maintenance_mode' in request.POST
    settings.save()

    # Retornar nuevo estado para actualizar el label
    status_text = "Activo" if settings.maintenance_mode else "Inactivo"
    return HttpResponse(status_text)</pre>

      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin: var(--ux-space-md) 0;">Modelo de preferencias</h4>
      <pre class="ux-code-block" data-lang="python"># models.py
from django.db import models
from django.contrib.auth import get_user_model

User = get_user_model()

class UserPreferences(models.Model):
    """Preferencias del usuario almacenadas en BD."""
    user = models.OneToOneField(
        User,
        on_delete=models.CASCADE,
        related_name='preferences'
    )
    push_notifications = models.BooleanField(default=True)
    dark_mode = models.BooleanField(default=False)
    email_marketing = models.BooleanField(default=False)
    two_factor_auth = models.BooleanField(default=False)
    public_profile = models.BooleanField(default=True)

    class Meta:
        verbose_name_plural = "User preferences"


class SiteSettings(models.Model):
    """Configuracion global del sitio (singleton)."""
    maintenance_mode = models.BooleanField(default=False)

    def save(self, *args, **kwargs):
        self.pk = 1  # Singleton pattern
        super().save(*args, **kwargs)

    @classmethod
    def get_solo(cls):
        obj, created = cls.objects.get_or_create(pk=1)
        return obj</pre>

      <h4 style="font-size: var(--ux-font-size-md); font-weight: 600; margin: var(--ux-space-md) 0;">URLs</h4>
      <pre class="ux-code-block" data-lang="python"># urls.py
from django.urls import path
from . import views

app_name = 'user'

urlpatterns = [
    path('preferences/toggle/', views.toggle_preference, name='toggle_preference'),
]

# En admin/urls.py
urlpatterns = [
    path('maintenance/toggle/', views.toggle_maintenance, name='toggle_maintenance'),
]</pre>
    </section>
  </div>
</body>
</html>
