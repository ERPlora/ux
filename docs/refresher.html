<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Refresher - UX Library</title>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="../components/ux-core.js"></script>
  <script src="../components/ux-navbar.js"></script>
  <script src="../components/ux-button.js"></script>
  <script src="../components/ux-spinner.js"></script>
  <script src="../components/ux-refresher.js"></script>
  <style>
    .demo-section { margin-bottom: var(--ux-space-xl); padding: var(--ux-space-lg); }
    .demo-section h3 { font-size: var(--ux-font-size-lg); font-weight: 600; margin-bottom: var(--ux-space-md); }
    .demo-section p { font-size: var(--ux-font-size-sm); color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md); }
    .demo-box { background: var(--ux-surface); border-radius: var(--ux-border-radius-lg); padding: var(--ux-space-lg); margin-bottom: var(--ux-space-md); }
    .code-block { background: var(--ux-dark); color: #e5e5e5; padding: var(--ux-space-md); border-radius: var(--ux-border-radius); font-family: monospace; font-size: var(--ux-font-size-xs); overflow-x: auto; white-space: pre; }
    .css-reference { width: 100%; border-collapse: collapse; font-size: var(--ux-font-size-sm); }
    .css-reference th, .css-reference td { border: 1px solid var(--ux-border-color); padding: var(--ux-space-sm); text-align: left; }
    .css-reference th { background: var(--ux-surface); font-weight: 600; }
    .css-reference code { background: var(--ux-surface-alt); padding: 2px 6px; border-radius: 4px; font-size: var(--ux-font-size-xs); }

    /* Demo containers */
    .refresher-demo {
      height: 300px;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius-lg);
      overflow: hidden;
      position: relative;
      background: var(--ux-surface);
    }
    .refresher-content {
      height: 100%;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .demo-list {
      padding: var(--ux-space-md);
    }
    .demo-list-item {
      padding: var(--ux-space-md);
      background: var(--ux-background);
      border-radius: var(--ux-border-radius);
      margin-bottom: var(--ux-space-sm);
    }
  </style>
</head>
<body class="ux-app">
  <nav class="ux-navbar ux-navbar--sticky">
    <div class="ux-navbar__content">
      <div class="ux-navbar__start">
        <a href="index.html" class="ux-button ux-button--clear ux-button--icon">
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </a>
      </div>
      <div class="ux-navbar__center">
        <span class="ux-navbar__title">Refresher</span>
      </div>
      <div class="ux-navbar__end"></div>
    </div>
  </nav>

  <!-- Uso Basico -->
  <div class="demo-section">
    <h3>Uso Basico</h3>
    <p>El componente Refresher implementa el patron pull-to-refresh estilo iOS para actualizar contenido.</p>
    <div class="demo-box">
      <p>Carga el componente:</p>
      <pre class="code-block">&lt;script src="components/ux-refresher.js"&gt;&lt;/script&gt;</pre>
    </div>
  </div>

  <!-- Estados del Refresher -->
  <div class="demo-section">
    <h3>Estados del Refresher</h3>
    <p>El refresher tiene diferentes estados visuales: pulling, ready, refreshing y complete.</p>

    <div class="demo-box">
      <p style="margin-bottom: var(--ux-space-md);"><strong>Estado: Pulling (arrastrando)</strong></p>
      <div style="background: var(--ux-surface-alt); padding: var(--ux-space-lg); border-radius: var(--ux-border-radius); text-align: center;">
        <div class="ux-refresher ux-refresher--pulling" style="position: relative; display: flex; justify-content: center; padding: var(--ux-space-md);">
          <div class="ux-refresher__icon">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
            </svg>
          </div>
        </div>
        <p style="font-size: var(--ux-font-size-sm); color: var(--ux-text-secondary);">Arrastrando hacia abajo...</p>
      </div>
    </div>

    <div class="demo-box">
      <p style="margin-bottom: var(--ux-space-md);"><strong>Estado: Refreshing (actualizando)</strong></p>
      <div style="background: var(--ux-surface-alt); padding: var(--ux-space-lg); border-radius: var(--ux-border-radius); text-align: center;">
        <div class="ux-refresher ux-refresher--refreshing" style="position: relative; display: flex; justify-content: center; padding: var(--ux-space-md);">
          <div class="ux-spinner"></div>
        </div>
        <p style="font-size: var(--ux-font-size-sm); color: var(--ux-text-secondary);">Actualizando...</p>
      </div>
    </div>

    <div class="demo-box">
      <p style="margin-bottom: var(--ux-space-md);"><strong>Estado: Complete (completado)</strong></p>
      <div style="background: var(--ux-surface-alt); padding: var(--ux-space-lg); border-radius: var(--ux-border-radius); text-align: center;">
        <div class="ux-refresher ux-refresher--complete" style="position: relative; display: flex; justify-content: center; padding: var(--ux-space-md);">
          <div class="ux-refresher__icon" style="color: var(--ux-success);">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
          </div>
        </div>
        <p style="font-size: var(--ux-font-size-sm); color: var(--ux-text-secondary);">Actualizado!</p>
      </div>
    </div>

    <pre class="code-block">&lt;!-- Estado pulling --&gt;
&lt;div class="ux-refresher ux-refresher--pulling"&gt;
  &lt;div class="ux-refresher__icon"&gt;...&lt;/div&gt;
&lt;/div&gt;

&lt;!-- Estado refreshing --&gt;
&lt;div class="ux-refresher ux-refresher--refreshing"&gt;
  &lt;div class="ux-spinner"&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;!-- Estado complete --&gt;
&lt;div class="ux-refresher ux-refresher--complete"&gt;
  &lt;div class="ux-refresher__icon"&gt;...&lt;/div&gt;
&lt;/div&gt;</pre>
  </div>

  <!-- Demo Interactiva -->
  <div class="demo-section">
    <h3>Demo Interactiva</h3>
    <p>Arrastra hacia abajo desde la parte superior del contenedor para activar el refresh (funciona mejor en dispositivos tactiles).</p>

    <div class="demo-box" x-data="{
      items: ['Elemento 1', 'Elemento 2', 'Elemento 3', 'Elemento 4', 'Elemento 5'],
      lastUpdate: new Date().toLocaleTimeString()
    }">
      <div class="refresher-demo">
        <div class="refresher-content"
             x-data="uxRefresher({
               onRefresh: async () => {
                 await new Promise(r => setTimeout(r, 1500));
                 $data.items.unshift('Nuevo elemento ' + ($data.items.length + 1));
                 $data.lastUpdate = new Date().toLocaleTimeString();
               }
             })"
             @touchstart="handleTouchStart"
             @touchmove="handleTouchMove"
             @touchend="handleTouchEnd">

          <!-- Refresher indicator -->
          <div class="ux-refresher"
               :class="{
                 'ux-refresher--pulling': isPulling,
                 'ux-refresher--refreshing': isRefreshing,
                 'ux-refresher--complete': isComplete
               }"
               :style="contentStyle">
            <template x-if="!isRefreshing && !isComplete">
              <div class="ux-refresher__icon" :style="{ transform: 'rotate(' + (progress * 180) + 'deg)' }">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                </svg>
              </div>
            </template>
            <template x-if="isRefreshing">
              <div class="ux-spinner"></div>
            </template>
            <template x-if="isComplete">
              <div class="ux-refresher__icon" style="color: var(--ux-success);">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
              </div>
            </template>
          </div>

          <!-- Content -->
          <div class="demo-list">
            <p style="font-size: var(--ux-font-size-xs); color: var(--ux-text-tertiary); margin-bottom: var(--ux-space-sm);">
              Ultima actualizacion: <span x-text="lastUpdate"></span>
            </p>
            <template x-for="(item, index) in items" :key="index">
              <div class="demo-list-item" x-text="item"></div>
            </template>
          </div>
        </div>
      </div>
      <p style="font-size: var(--ux-font-size-xs); color: var(--ux-text-tertiary); margin-top: var(--ux-space-sm);">
        Tip: En desktop, usa touch simulation del DevTools
      </p>
    </div>

    <pre class="code-block">&lt;div x-data="{ items: [...], lastUpdate: '' }"&gt;
  &lt;div class="content-container"
       x-data="uxRefresher({
         onRefresh: async () =&gt; {
           // Simular fetch de datos
           await fetch('/api/items');
           lastUpdate = new Date().toLocaleTimeString();
         }
       })"
       @touchstart="handleTouchStart"
       @touchmove="handleTouchMove"
       @touchend="handleTouchEnd"&gt;

    &lt;!-- Refresher indicator --&gt;
    &lt;div class="ux-refresher"
         :class="{
           'ux-refresher--pulling': isPulling,
           'ux-refresher--refreshing': isRefreshing,
           'ux-refresher--complete': isComplete
         }"
         :style="contentStyle"&gt;
      &lt;!-- Icon/spinner segun estado --&gt;
    &lt;/div&gt;

    &lt;!-- Contenido scrolleable --&gt;
    &lt;div class="content"&gt;...&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
  </div>

  <!-- Contenido Personalizado -->
  <div class="demo-section">
    <h3>Contenido Personalizado</h3>
    <p>Personaliza el indicador de refresh con iconos, texto o animaciones propias.</p>

    <div class="demo-box">
      <p style="margin-bottom: var(--ux-space-md);"><strong>Con texto</strong></p>
      <div style="background: var(--ux-surface-alt); padding: var(--ux-space-lg); border-radius: var(--ux-border-radius); text-align: center;">
        <div class="ux-refresher ux-refresher--pulling" style="position: relative; display: flex; flex-direction: column; align-items: center; gap: var(--ux-space-xs); padding: var(--ux-space-md);">
          <div class="ux-refresher__icon">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
            </svg>
          </div>
          <span class="ux-refresher__text" style="font-size: var(--ux-font-size-xs); color: var(--ux-text-secondary);">Suelta para actualizar</span>
        </div>
      </div>
    </div>

    <div class="demo-box">
      <p style="margin-bottom: var(--ux-space-md);"><strong>Con icono personalizado</strong></p>
      <div style="background: var(--ux-surface-alt); padding: var(--ux-space-lg); border-radius: var(--ux-border-radius); text-align: center;">
        <div class="ux-refresher ux-refresher--refreshing" style="position: relative; display: flex; flex-direction: column; align-items: center; gap: var(--ux-space-xs); padding: var(--ux-space-md);">
          <div class="ux-refresher__icon" style="animation: spin 1s linear infinite;">
            <svg width="24" height="24" fill="none" stroke="var(--ux-primary)" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
          </div>
          <span class="ux-refresher__text" style="font-size: var(--ux-font-size-xs); color: var(--ux-primary);">Sincronizando...</span>
        </div>
      </div>
      <style>
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      </style>
    </div>

    <pre class="code-block">&lt;div class="ux-refresher"&gt;
  &lt;div class="ux-refresher__icon"&gt;
    &lt;!-- Icono personalizado --&gt;
    &lt;svg&gt;...&lt;/svg&gt;
  &lt;/div&gt;
  &lt;span class="ux-refresher__text"&gt;Suelta para actualizar&lt;/span&gt;
&lt;/div&gt;</pre>
  </div>

  <!-- Configuracion del Refresher -->
  <div class="demo-section">
    <h3>Configuracion del Refresher</h3>
    <p>El componente Alpine acepta varias opciones de configuracion.</p>

    <div class="demo-box">
      <pre class="code-block">// Configuracion por defecto
uxRefresher({
  // Callback cuando se activa el refresh (requerido)
  onRefresh: async () =&gt; { },

  // Distancia minima de pull para activar (px)
  pullMin: 60,

  // Distancia maxima de pull (px)
  pullMax: 120,

  // Factor de resistencia (0-1)
  resistance: 0.5,

  // Tiempo que se muestra "complete" antes de reset (ms)
  completeDelay: 500,

  // Snap back cuando no se alcanza pullMin
  snapBackDuration: 300,

  // Deshabilitado
  disabled: false
})</pre>
    </div>

    <div class="demo-box">
      <p><strong>Ejemplo con configuracion personalizada:</strong></p>
      <pre class="code-block">&lt;div x-data="uxRefresher({
  onRefresh: async () =&gt; {
    const response = await fetch('/api/refresh');
    const data = await response.json();
    // Actualizar estado
  },
  pullMin: 80,
  pullMax: 150,
  resistance: 0.4,
  completeDelay: 1000
})"&gt;
  ...
&lt;/div&gt;</pre>
    </div>
  </div>

  <!-- Propiedades y Metodos -->
  <div class="demo-section">
    <h3>Propiedades y Metodos Alpine</h3>
    <p>El componente expone propiedades reactivas y metodos para control programatico.</p>

    <div class="demo-box">
      <p><strong>Propiedades reactivas:</strong></p>
      <pre class="code-block">// Estados
progress      // 0-1, progreso del pull
isPulling     // true cuando esta arrastrando
isReady       // true cuando supera pullMin
isRefreshing  // true durante el refresh
isComplete    // true cuando termina

// Estilos
contentStyle  // Objeto de estilos para el indicador</pre>
    </div>

    <div class="demo-box">
      <p><strong>Metodos:</strong></p>
      <pre class="code-block">// Eventos touch (bindear a los listeners)
handleTouchStart(event)
handleTouchMove(event)
handleTouchEnd(event)

// Control programatico
doRefresh()   // Iniciar refresh manualmente
complete()    // Marcar como completado
cancel()      // Cancelar refresh actual
reset()       // Resetear al estado inicial</pre>
    </div>

    <div class="demo-box">
      <p><strong>Ejemplo de control programatico:</strong></p>
      <pre class="code-block">&lt;div x-data="{ refresher: null }"&gt;
  &lt;button @click="refresher.doRefresh()"&gt;
    Forzar Refresh
  &lt;/button&gt;

  &lt;div x-data="uxRefresher({ ... })" x-ref="refresher" x-init="$data.refresher = $refs.refresher.__x"&gt;
    ...
  &lt;/div&gt;
&lt;/div&gt;</pre>
    </div>
  </div>

  <!-- Integracion HTMX -->
  <div class="demo-section">
    <h3>Integracion con HTMX</h3>
    <p>El refresher funciona perfectamente con HTMX para cargar contenido del servidor.</p>

    <div class="demo-box">
      <p><strong>Patron basico con hx-trigger:</strong></p>
      <pre class="code-block">&lt;div x-data="uxRefresher({
  onRefresh: async () =&gt; {
    // Disparar request HTMX
    htmx.trigger('#content', 'refresh');
  }
})"
     @touchstart="handleTouchStart"
     @touchmove="handleTouchMove"
     @touchend="handleTouchEnd"&gt;

  &lt;div class="ux-refresher" ...&gt;...&lt;/div&gt;

  &lt;div id="content"
       hx-get="/api/items"
       hx-trigger="refresh"
       hx-swap="innerHTML"&gt;
    &lt;!-- Contenido que se actualiza --&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
    </div>

    <div class="demo-box">
      <p><strong>Con indicador de estado sincronizado:</strong></p>
      <pre class="code-block">&lt;div x-data="uxRefresher({
  onRefresh: () =&gt; {
    return new Promise(resolve =&gt; {
      const content = document.getElementById('content');

      // Escuchar cuando HTMX termina
      content.addEventListener('htmx:afterSwap', function handler() {
        content.removeEventListener('htmx:afterSwap', handler);
        resolve();
      });

      // Disparar request
      htmx.trigger(content, 'refresh');
    });
  }
})"&gt;
  ...
&lt;/div&gt;</pre>
    </div>

    <div class="demo-box">
      <p><strong>Con hx-indicator:</strong></p>
      <pre class="code-block">&lt;!-- El refresher puede ser el indicador HTMX --&gt;
&lt;div class="ux-refresher" id="refresher-indicator"&gt;
  &lt;div class="ux-spinner htmx-indicator"&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div hx-get="/api/items"
     hx-trigger="revealed"
     hx-indicator="#refresher-indicator"&gt;
  ...
&lt;/div&gt;</pre>
    </div>
  </div>

  <!-- Eventos Personalizados -->
  <div class="demo-section">
    <h3>Eventos Personalizados</h3>
    <p>El componente emite eventos que puedes escuchar para reaccionar a cambios de estado.</p>

    <div class="demo-box">
      <pre class="code-block">&lt;div x-data="uxRefresher({ ... })"
     @ux-refresher:start="console.log('Refresh iniciado')"
     @ux-refresher:complete="console.log('Refresh completado')"
     @ux-refresher:cancel="console.log('Refresh cancelado')"&gt;
  ...
&lt;/div&gt;

&lt;!-- O con JavaScript vanilla --&gt;
&lt;script&gt;
document.querySelector('.refresher').addEventListener('ux-refresher:complete', (e) =&gt; {
  console.log('Datos actualizados');
});
&lt;/script&gt;</pre>
    </div>
  </div>

  <!-- Uso sin Alpine -->
  <div class="demo-section">
    <h3>Uso Solo con CSS</h3>
    <p>Si solo necesitas los estilos, puedes usar las clases CSS directamente con tu propia logica.</p>

    <div class="demo-box">
      <pre class="code-block">&lt;!-- Estructura HTML basica --&gt;
&lt;div class="ux-refresher-container"&gt;
  &lt;div class="ux-refresher"&gt;
    &lt;div class="ux-refresher__icon"&gt;...&lt;/div&gt;
  &lt;/div&gt;
  &lt;div class="content"&gt;...&lt;/div&gt;
&lt;/div&gt;

&lt;!-- Agregar clases segun estado --&gt;
&lt;script&gt;
const refresher = document.querySelector('.ux-refresher');

// Cuando el usuario arrastra
refresher.classList.add('ux-refresher--pulling');

// Cuando se activa el refresh
refresher.classList.remove('ux-refresher--pulling');
refresher.classList.add('ux-refresher--refreshing');

// Cuando termina
refresher.classList.remove('ux-refresher--refreshing');
refresher.classList.add('ux-refresher--complete');

// Reset despues de un tiempo
setTimeout(() =&gt; {
  refresher.classList.remove('ux-refresher--complete');
}, 500);
&lt;/script&gt;</pre>
    </div>
  </div>

  <!-- Referencia CSS -->
  <div class="demo-section">
    <h3>Referencia de Clases CSS</h3>
    <table class="css-reference">
      <thead>
        <tr>
          <th>Clase</th>
          <th>Descripcion</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>.ux-refresher</code></td>
          <td>Contenedor principal del indicador de refresh</td>
        </tr>
        <tr>
          <td><code>.ux-refresher--pulling</code></td>
          <td>Estado cuando el usuario esta arrastrando</td>
        </tr>
        <tr>
          <td><code>.ux-refresher--refreshing</code></td>
          <td>Estado durante la operacion de refresh</td>
        </tr>
        <tr>
          <td><code>.ux-refresher--complete</code></td>
          <td>Estado cuando el refresh ha completado</td>
        </tr>
        <tr>
          <td><code>.ux-refresher__icon</code></td>
          <td>Contenedor del icono/indicador visual</td>
        </tr>
        <tr>
          <td><code>.ux-refresher__text</code></td>
          <td>Texto opcional debajo del icono</td>
        </tr>
        <tr>
          <td><code>.ux-refresher__spinner</code></td>
          <td>Spinner de carga (o usa .ux-spinner)</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Variables CSS -->
  <div class="demo-section">
    <h3>Variables CSS</h3>
    <p>Personaliza el refresher sobrescribiendo las variables CSS.</p>
    <div class="demo-box">
      <pre class="code-block">:root {
  /* Dimensiones */
  --ux-refresher-height: 60px;
  --ux-refresher-icon-size: 24px;

  /* Colores */
  --ux-refresher-bg: transparent;
  --ux-refresher-color: var(--ux-text-secondary);
  --ux-refresher-active-color: var(--ux-primary);

  /* Transiciones */
  --ux-refresher-transition: transform 0.2s ease;
}</pre>
    </div>
  </div>

  <!-- Componente Alpine -->
  <div class="demo-section">
    <h3>Componente Alpine: uxRefresher()</h3>
    <div class="demo-box">
      <pre class="code-block">Alpine.data('uxRefresher', (config = {}) => ({
  // Configuracion
  pullMin: config.pullMin || 60,
  pullMax: config.pullMax || 120,
  resistance: config.resistance || 0.5,
  completeDelay: config.completeDelay || 500,
  disabled: config.disabled || false,
  onRefresh: config.onRefresh || (() => Promise.resolve()),

  // Estado interno
  state: 'idle', // idle | pulling | ready | refreshing | complete
  pullDistance: 0,
  startY: 0,

  // Propiedades computadas
  get progress() { return Math.min(this.pullDistance / this.pullMin, 1) },
  get isPulling() { return this.state === 'pulling' },
  get isReady() { return this.state === 'ready' },
  get isRefreshing() { return this.state === 'refreshing' },
  get isComplete() { return this.state === 'complete' },
  get contentStyle() {
    return {
      transform: `translateY(${this.pullDistance}px)`,
      transition: this.state === 'idle' ? 'transform 0.3s' : 'none'
    }
  },

  // Metodos
  handleTouchStart(e) { ... },
  handleTouchMove(e) { ... },
  handleTouchEnd(e) { ... },
  async doRefresh() { ... },
  complete() { ... },
  cancel() { ... },
  reset() { ... }
}))</pre>
    </div>
  </div>

</body>
</html>
