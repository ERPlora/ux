<form x-data="{ currentStep: 0, canProceed: false }"
              hx-post="/api/wizard/validate"
              hx-trigger="change from:find input"
              hx-target="#validation-result"
              hx-swap="innerHTML"
              @htmx:after-request="canProceed = event.detail.xhr.status === 200">

          <div class="ux-stepper">
            <div class="ux-stepper__header" style="margin-bottom: var(--ux-space-lg);">
              <div class="ux-stepper__step" :class="{ 'ux-stepper__step--active': currentStep === 0 }">
                <div class="ux-stepper__circle">1</div>
                <span class="ux-stepper__label">Validar Email</span>
              </div>
              <div class="ux-stepper__step" :class="{ 'ux-stepper__step--active': currentStep === 1 }">
                <div class="ux-stepper__circle">2</div>
                <span class="ux-stepper__label">Completar</span>
              </div>
            </div>

            <div x-show="currentStep === 0">
              <input type="hidden" name="step" value="1">
              <div class="ux-input">
                <label class="ux-input__label" for="validate-email">Email (escribe para validar)</label>
                <input type="email"
                       id="validate-email"
                       name="email"
                       class="ux-input__field"
                       placeholder="tu@email.com"
                       hx-post="/api/wizard/validate-email"
                       hx-trigger="input changed delay:500ms"
                       hx-target="#email-validation"
                       hx-swap="innerHTML">
              </div>
              <div id="email-validation" style="margin-top: var(--ux-space-sm); font-size: var(--ux-font-size-sm);"></div>
            </div>

            <div x-show="currentStep === 1" style="padding: var(--ux-space-lg); text-align: center;">
              <div style="color: var(--ux-success); font-size: var(--ux-font-size-2xl); margin-bottom: var(--ux-space-md);">âœ“</div>
              <p>Email validado correctamente</p>
            </div>

            <div id="validation-result" style="margin-top: var(--ux-space-md);"></div>

            <div style="margin-top: var(--ux-space-lg); display: flex; gap: var(--ux-space-sm);">
              <button type="button"
                      class="ux-button ux-button--outline"
                      @click="currentStep = Math.max(0, currentStep - 1)"
                      :disabled="currentStep === 0">
                Anterior
              </button>
              <button type="button"
                      class="ux-button ux-button ux-color-primary"
                      @click="currentStep++"
                      :disabled="!canProceed"
                      x-show="currentStep === 0">
                Siguiente
              </button>
              <button type="submit"
                      class="ux-button ux-button ux-color-primary"
                      x-show="currentStep === 1"
                      hx-post="/api/wizard/complete">
                Finalizar
              </button>
            </div>
          </div>
        </form>
