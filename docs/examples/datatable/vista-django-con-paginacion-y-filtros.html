<pre class="ux-code-block" data-lang="python"># views.py
from django.views.generic import ListView
from django.db.models import Q

class UserListView(ListView):
    model = User
    template_name = 'users/user_list.html'
    context_object_name = 'users'
    paginate_by = 10

    def get_queryset(self):
        queryset = super().get_queryset()

        # Busqueda
        search = self.request.GET.get('q', '')
        if search:
            queryset = queryset.filter(
                Q(name__icontains=search) |
                Q(email__icontains=search)
            )

        # Filtro por estado
        status = self.request.GET.get('status')
        if status:
            queryset = queryset.filter(is_active=(status == 'active'))

        # Filtro por departamento
        department = self.request.GET.get('department')
        if department:
            queryset = queryset.filter(department_id=department)

        # Ordenacion
        order_by = self.request.GET.get('order_by', '-created_at')
        allowed_fields = ['name', '-name', 'email', '-email', 'created_at', '-created_at', 'status', '-status']
        if order_by in allowed_fields:
            queryset = queryset.order_by(order_by)

        return queryset

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['order_by'] = self.request.GET.get('order_by', '-created_at')
        context['departments'] = Department.objects.all()
        context['current_filters'] = {
            'q': self.request.GET.get('q', ''),
            'status': self.request.GET.get('status', ''),
            'department': self.request.GET.get('department', ''),
        }
        return context

    def get_template_names(self):
        # Devolver partial si es peticion HTMX
        if self.request.headers.get('HX-Request'):
            return ['users/partials/user_table.html']
        return [self.template_name]


# urls.py
from django.urls import path
from . import views

app_name = 'users'

urlpatterns = [
    path('', views.UserListView.as_view(), name='list'),
    path('<int:pk>/edit/', views.user_edit, name='edit'),
    path('<int:pk>/delete/', views.user_delete, name='delete'),
]</pre>
