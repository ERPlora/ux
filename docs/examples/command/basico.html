<div x-data="uxCommand({
  placeholder: 'Buscar comandos, archivos, acciones...',
  groups: [
    {
      name: 'Navegacion',
      commands: [
        { id: 'home', title: 'Ir a Inicio', description: 'Pagina principal', icon: 'folder', shortcut: 'Cmd+H', keywords: ['home', 'inicio'] },
        { id: 'settings', title: 'Configuracion', description: 'Ajustes de la aplicacion', icon: 'settings', shortcut: 'Cmd+,', keywords: ['settings', 'config'] },
        { id: 'profile', title: 'Mi Perfil', description: 'Ver y editar perfil', icon: 'user', keywords: ['profile', 'cuenta'] }
      ]
    },
    {
      name: 'Acciones',
      commands: [
        { id: 'new-file', title: 'Nuevo Archivo', description: 'Crear un nuevo documento', icon: 'file', shortcut: 'Cmd+N' },
        { id: 'new-folder', title: 'Nueva Carpeta', description: 'Crear una carpeta', icon: 'folder', shortcut: 'Cmd+Shift+N' },
        { id: 'search', title: 'Buscar en Archivos', description: 'Buscar texto en todos los archivos', icon: 'search', shortcut: 'Cmd+Shift+F' }
      ]
    },
    {
      name: 'Tema',
      commands: [
        { id: 'theme-light', title: 'Tema Claro', description: 'Cambiar a modo claro', keywords: ['light', 'claro'] },
        { id: 'theme-dark', title: 'Tema Oscuro', description: 'Cambiar a modo oscuro', keywords: ['dark', 'oscuro'] },
        { id: 'theme-system', title: 'Tema del Sistema', description: 'Usar preferencia del sistema', keywords: ['system', 'auto'] }
      ]
    }
  ]
})" @command:execute.window="console.log('Comando ejecutado:', $event.detail.command)">
  <!-- Trigger Button -->
  <button class="ux-button ux-button--outline" @click="open()">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
    </svg>
    Buscar comandos...
    <span class="shortcut-hint" style="margin-left: auto;">
      <span class="shortcut-key">⌘</span><span class="shortcut-key">K</span>
    </span>
  </button>

  <!-- Backdrop -->
  <div class="ux-command-backdrop"
       :class="{ 'ux-command-backdrop--open': isOpen }"
       @click="close()"></div>

  <!-- Command Palette -->
  <div class="ux-command" :class="{ 'ux-command--open': isOpen }">
    <!-- Search -->
    <div class="ux-command__search">
      <span class="ux-command__search-icon" x-html="icons.search"></span>
      <input type="text"
             class="ux-command__input"
             :placeholder="placeholder"
             x-model="query"
             @input="filterCommands()"
             @keydown="handleKeydown($event)"
             autocomplete="off"
             spellcheck="false">
      <div class="ux-command__shortcut">
        <span class="ux-command__key">Esc</span>
      </div>
    </div>

    <!-- Results -->
    <div class="ux-command__results">
      <!-- Loading -->
      <div x-show="loading" class="ux-command__loading">
        <div class="ux-command__loading-spinner"></div>
      </div>

      <!-- Empty State -->
      <div x-show="!loading && filteredCommands.length === 0" class="ux-command__empty">
        <div class="ux-command__empty-icon" x-html="icons.empty"></div>
        <div class="ux-command__empty-title">Sin resultados</div>
        <div class="ux-command__empty-description">No se encontraron comandos para "<span x-text="query"></span>"</div>
      </div>

      <!-- Results List -->
      <template x-for="(group, groupIndex) in filteredCommands" :key="group.group">
        <div class="ux-command__group">
          <div class="ux-command__group-title" x-text="group.group"></div>
          <ul class="ux-command__list">
            <template x-for="(cmd, itemIndex) in group.commands" :key="cmd.id">
              <li class="ux-command__item"
                  :class="{ 'ux-command__item--active': isActiveItem(groupIndex, itemIndex) }"
                  @click="executeCommand(cmd)"
                  @mouseenter="activeIndex = groupIndex > 0 ? filteredCommands.slice(0, groupIndex).reduce((a, g) => a + g.commands.length, 0) + itemIndex : itemIndex">
                <div class="ux-command__item-icon" x-html="getIcon(cmd)"></div>
                <div class="ux-command__item-content">
                  <div class="ux-command__item-title" x-html="highlightMatch(cmd.title, query)"></div>
                  <div class="ux-command__item-description" x-text="cmd.description" x-show="cmd.description"></div>
                </div>
                <div x-show="cmd.recent" class="ux-command__recent">
                  <span x-html="icons.clock" style="width:12px;height:12px;"></span>
                  Reciente
                </div>
                <div x-show="cmd.shortcut && showShortcuts" class="ux-command__item-shortcut">
                  <template x-for="key in formatShortcut(cmd.shortcut)" :key="key">
                    <span class="ux-command__key" x-text="key"></span>
                  </template>
                </div>
              </li>
            </template>
          </ul>
        </div>
      </template>
    </div>

    <!-- Footer -->
    <div x-show="showFooter" class="ux-command__footer">
      <div class="ux-command__footer-hints">
        <span class="ux-command__footer-hint">
          <span class="ux-command__key">↑</span>
          <span class="ux-command__key">↓</span>
          Navegar
        </span>
        <span class="ux-command__footer-hint">
          <span class="ux-command__key">↵</span>
          Seleccionar
        </span>
        <span class="ux-command__footer-hint">
          <span class="ux-command__key">Esc</span>
          Cerrar
        </span>
      </div>
      <button x-show="recentCommands.length > 0"
              @click="clearRecent()"
              style="background:none;border:none;color:var(--ux-text-tertiary);cursor:pointer;font-size:inherit;">
        Limpiar recientes
      </button>
    </div>
  </div>

  <div class="demo-output">
    <strong>Tip:</strong> Presiona <span class="shortcut-key">⌘</span>+<span class="shortcut-key">K</span> en cualquier momento para abrir la paleta de comandos.
  </div>
</div>
