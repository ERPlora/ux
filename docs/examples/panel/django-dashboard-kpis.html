<!-- templates/admin/dashboard.html -->
<div class="ux-panel-dashboard" x-data="{
  period: 'week',
  refreshKpis() { htmx.trigger('#kpis', 'refresh') }
}">

  <!-- Selector de periodo -->
  <div style="padding: var(--ux-space-md); display: flex; gap: var(--ux-space-sm);">
    <button class="ux-button ux-button--sm"
            :class="period === 'day' ? 'ux-color-primary' : 'ux-button--outline'"
            @click="period = 'day'; refreshKpis()">Hoy</button>
    <button class="ux-button ux-button--sm"
            :class="period === 'week' ? 'ux-color-primary' : 'ux-button--outline'"
            @click="period = 'week'; refreshKpis()">Semana</button>
    <button class="ux-button ux-button--sm"
            :class="period === 'month' ? 'ux-color-primary' : 'ux-button--outline'"
            @click="period = 'month'; refreshKpis()">Mes</button>
  </div>

  <!-- KPIs dinamicos -->
  <section id="kpis" class="ux-panel-dashboard__kpis"
           hx-get="{% url 'admin:dashboard-kpis' %}"
           hx-trigger="load, refresh"
           hx-vals='js:{"period": period}'
           hx-indicator="#kpis-loader">
    <div id="kpis-loader" class="htmx-indicator">
      <div class="ux-spinner"></div>
    </div>
    <div class="ux-panel-kpi-grid">
      {% include 'admin/dashboard/_kpis.html' %}
    </div>
  </section>

  <!-- Graficos -->
  <section class="ux-panel-dashboard__charts">
    <div class="ux-panel-card"
         hx-get="{% url 'admin:dashboard-sales-chart' %}"
         hx-trigger="load, refresh from:#kpis"
         hx-vals='js:{"period": period}'>
      <div class="ux-panel-card__header">
        <div class="ux-panel-card__title">Ventas</div>
      </div>
      <div class="ux-panel-card__body">
        {% include 'admin/dashboard/_sales_chart.html' %}
      </div>
    </div>

    <div class="ux-panel-card"
         hx-get="{% url 'admin:dashboard-categories-chart' %}"
         hx-trigger="load">
      <div class="ux-panel-card__header">
        <div class="ux-panel-card__title">Por Categoria</div>
      </div>
      <div class="ux-panel-card__body">
        {% include 'admin/dashboard/_categories_chart.html' %}
      </div>
    </div>
  </section>

  <!-- Ultimas ordenes con polling -->
  <section class="ux-panel-dashboard__table">
    <div class="ux-panel-card" style="height: 100%;">
      <div class="ux-panel-card__header">
        <div class="ux-panel-card__title">Ultimas Ordenes</div>
        <span class="ux-badge ux-color-success--soft" id="new-orders"></span>
      </div>
      <div class="ux-panel-card__body ux-panel-card__body--flush"
           hx-get="{% url 'admin:dashboard-orders' %}"
           hx-trigger="load, every 30s"
           hx-swap="innerHTML">
        {% include 'admin/dashboard/_orders.html' %}
      </div>
    </div>
  </section>
</div>
