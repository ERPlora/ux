<div class="ux-image-crop" :class="{ 'ux-image-crop--loading': isLoading, 'ux-image-crop--aspect-locked': isAspectLocked }">
          <!-- Canvas -->
          <div class="ux-image-crop__canvas"
               :class="{ 'ux-image-crop__canvas--empty': !imageLoaded }"
               x-ref="canvas"
               @click="!imageLoaded && $refs.fileInput.click()">

            <!-- Empty state -->
            <template x-if="!imageLoaded && !isLoading">
              <div class="ux-image-crop__placeholder">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2"/>
                  <circle cx="8.5" cy="8.5" r="1.5"/>
                  <path d="m21 15-5-5L5 21"/>
                </svg>
                <p class="ux-image-crop__placeholder-text">Click to select an image</p>
                <p class="ux-image-crop__placeholder-hint">or drag and drop</p>
              </div>
            </template>

            <!-- Image -->
            <template x-if="imageLoaded">
              <div class="ux-image-crop__image-container">
                <img :src="imageSrc"
                     class="ux-image-crop__image"
                     :style="{ transform: imageTransform }"
                     alt="Image to crop">

                <!-- Crop Area -->
                <div class="ux-image-crop__crop-area"
                     x-ref="cropArea"
                     :style="cropAreaStyle"
                     @mousedown="onCropMouseDown($event)"
                     @touchstart.prevent="onCropTouchStart($event)">

                  <!-- Grid -->
                  <div class="ux-image-crop__grid ux-image-crop__grid--thirds" x-show="showGrid"></div>

                  <!-- Handles -->
                  <div class="ux-image-crop__handles">
                    <div class="ux-image-crop__handle ux-image-crop__handle--nw"
                         @mousedown.stop="onHandleMouseDown($event, 'nw')"
                         @touchstart.stop.prevent="onHandleTouchStart($event, 'nw')"></div>
                    <div class="ux-image-crop__handle ux-image-crop__handle--ne"
                         @mousedown.stop="onHandleMouseDown($event, 'ne')"
                         @touchstart.stop.prevent="onHandleTouchStart($event, 'ne')"></div>
                    <div class="ux-image-crop__handle ux-image-crop__handle--sw"
                         @mousedown.stop="onHandleMouseDown($event, 'sw')"
                         @touchstart.stop.prevent="onHandleTouchStart($event, 'sw')"></div>
                    <div class="ux-image-crop__handle ux-image-crop__handle--se"
                         @mousedown.stop="onHandleMouseDown($event, 'se')"
                         @touchstart.stop.prevent="onHandleTouchStart($event, 'se')"></div>
                    <div class="ux-image-crop__handle ux-image-crop__handle--n"
                         @mousedown.stop="onHandleMouseDown($event, 'n')"
                         @touchstart.stop.prevent="onHandleTouchStart($event, 'n')"></div>
                    <div class="ux-image-crop__handle ux-image-crop__handle--s"
                         @mousedown.stop="onHandleMouseDown($event, 's')"
                         @touchstart.stop.prevent="onHandleTouchStart($event, 's')"></div>
                    <div class="ux-image-crop__handle ux-image-crop__handle--e"
                         @mousedown.stop="onHandleMouseDown($event, 'e')"
                         @touchstart.stop.prevent="onHandleTouchStart($event, 'e')"></div>
                    <div class="ux-image-crop__handle ux-image-crop__handle--w"
                         @mousedown.stop="onHandleMouseDown($event, 'w')"
                         @touchstart.stop.prevent="onHandleTouchStart($event, 'w')"></div>
                  </div>
                </div>
              </div>
            </template>
          </div>

          <!-- Controls -->
          <div class="ux-image-crop__controls" x-show="imageLoaded">
            <!-- Aspect Ratio -->
            <div class="ux-image-crop__control-row">
              <span class="ux-image-crop__control-label">Ratio</span>
              <div class="ux-image-crop__aspect-buttons">
                <button class="ux-image-crop__aspect-btn"
                        :class="{ 'ux-image-crop__aspect-btn--active': !aspectRatio }"
                        @click="setAspectRatio(null, 'Free')">Free</button>
                <button class="ux-image-crop__aspect-btn"
                        :class="{ 'ux-image-crop__aspect-btn--active': aspectRatio === 1 }"
                        @click="setAspectRatio(1, '1:1')">1:1</button>
                <button class="ux-image-crop__aspect-btn"
                        :class="{ 'ux-image-crop__aspect-btn--active': aspectRatio === 4/3 }"
                        @click="setAspectRatio(4/3, '4:3')">4:3</button>
                <button class="ux-image-crop__aspect-btn"
                        :class="{ 'ux-image-crop__aspect-btn--active': aspectRatio === 16/9 }"
                        @click="setAspectRatio(16/9, '16:9')">16:9</button>
              </div>
            </div>

            <!-- Zoom -->
            <div class="ux-image-crop__control-row">
              <span class="ux-image-crop__control-label">Zoom</span>
              <div class="ux-image-crop__control-group">
                <input type="range"
                       class="ux-image-crop__slider"
                       min="0.5" max="3" step="0.1"
                       x-model="zoom"
                       @input="setZoom(parseFloat($event.target.value))">
                <span class="ux-image-crop__control-value" x-text="zoomPercent + '%'"></span>
              </div>
            </div>

            <!-- Rotate -->
            <div class="ux-image-crop__control-row">
              <span class="ux-image-crop__control-label">Rotate</span>
              <div class="ux-image-crop__rotate-buttons">
                <button class="ux-image-crop__rotate-btn" @click="rotateLeft()" title="Rotate left">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M2.5 2v6h6M2.66 15.57a10 10 0 1 0 .57-8.38"/>
                  </svg>
                </button>
                <button class="ux-image-crop__rotate-btn" @click="rotateRight()" title="Rotate right">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.57-8.38"/>
                  </svg>
                </button>
              </div>
              <span class="ux-image-crop__control-value" x-text="rotation + 'deg'" style="margin-left: auto;"></span>
            </div>

            <!-- Actions -->
            <div class="ux-image-crop__actions">
              <button class="ux-button ux-button--outline ux-button--sm" @click="reset()">Reset</button>
              <button class="ux-button ux-button--outline ux-button--sm" @click="$refs.fileInput.click()">Change Image</button>
              <button class="ux-button ux-color-primary ux-button--sm"
                      @click="getCroppedImageDataURL().then(url => { window.open(url, '_blank') })">
                Export
              </button>
            </div>
          </div>

          <!-- Hidden file input -->
          <input type="file"
                 x-ref="fileInput"
                 accept="image/*"
                 style="display: none;"
                 @change="onFileSelect($event)">
        </div>
