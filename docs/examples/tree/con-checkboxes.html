<div x-data="uxTree({
  checkable: true,
  data: [
    {
      id: 'all',
      label: 'Seleccionar todo',
      children: [
        { id: 'cat1', label: 'Categoria 1', children: [
          { id: 'opt1', label: 'Opcion 1.1' },
          { id: 'opt2', label: 'Opcion 1.2' },
          { id: 'opt3', label: 'Opcion 1.3' }
        ]},
        { id: 'cat2', label: 'Categoria 2', children: [
          { id: 'opt4', label: 'Opcion 2.1' },
          { id: 'opt5', label: 'Opcion 2.2' }
        ]},
        { id: 'cat3', label: 'Categoria 3' }
      ]
    }
  ],
  expanded: ['all', 'cat1', 'cat2']
})">
  <div class="ux-tree">
    <template x-for="node in data" :key="node.id">
      <div class="ux-tree__node">
        <div class="ux-tree__item" @click="toggle(node.id)">
          <span class="ux-tree__toggle"
                :class="{ 'ux-tree__toggle--expanded': expandedNodes.has(node.id), 'ux-tree__toggle--empty': !node.children }"
                x-html="icons.chevron"></span>
          <span class="ux-tree__checkbox"
                :class="{
                  'ux-tree__checkbox--checked': checkedNodes.has(node.id),
                  'ux-tree__checkbox--indeterminate': isIndeterminate(node.id)
                }"
                @click.stop="check(node.id)"
                x-html="icons.check"></span>
          <span class="ux-tree__label" x-text="node.label"></span>
        </div>
        <template x-if="node.children && expandedNodes.has(node.id)">
          <ul class="ux-tree__list ux-tree__list--nested">
            <template x-for="child in node.children" :key="child.id">
              <li class="ux-tree__node">
                <div class="ux-tree__item" @click="toggle(child.id)">
                  <span class="ux-tree__toggle"
                        :class="{ 'ux-tree__toggle--expanded': expandedNodes.has(child.id), 'ux-tree__toggle--empty': !child.children }"
                        x-html="icons.chevron"></span>
                  <span class="ux-tree__checkbox"
                        :class="{
                          'ux-tree__checkbox--checked': checkedNodes.has(child.id),
                          'ux-tree__checkbox--indeterminate': isIndeterminate(child.id)
                        }"
                        @click.stop="check(child.id)"
                        x-html="icons.check"></span>
                  <span class="ux-tree__label" x-text="child.label"></span>
                </div>
                <template x-if="child.children && expandedNodes.has(child.id)">
                  <ul class="ux-tree__list ux-tree__list--nested">
                    <template x-for="grandchild in child.children" :key="grandchild.id">
                      <li class="ux-tree__node">
                        <div class="ux-tree__item">
                          <span class="ux-tree__toggle ux-tree__toggle--empty" x-html="icons.chevron"></span>
                          <span class="ux-tree__checkbox"
                                :class="{ 'ux-tree__checkbox--checked': checkedNodes.has(grandchild.id) }"
                                @click.stop="check(grandchild.id)"
                                x-html="icons.check"></span>
                          <span class="ux-tree__label" x-text="grandchild.label"></span>
                        </div>
                      </li>
                    </template>
                  </ul>
                </template>
              </li>
            </template>
          </ul>
        </template>
      </div>
    </template>
  </div>
  <div class="demo-output" style="margin-top: var(--ux-space-md);">
    <strong>Marcados:</strong> <span x-text="[...checkedNodes].join(', ') || 'Ninguno'"></span>
  </div>
</div>
