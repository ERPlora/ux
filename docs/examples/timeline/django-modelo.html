# models.py
from django.db import models
from django.contrib.auth.models import User

class ActivityLog(models.Model):
    ACTION_CHOICES = [
        ('create', 'Creado'),
        ('update', 'Actualizado'),
        ('delete', 'Eliminado'),
        ('comment', 'Comentario'),
        ('upload', 'Archivo subido'),
        ('status', 'Cambio de estado'),
    ]

    user = models.ForeignKey(User, on_delete=models.CASCADE)
    action = models.CharField(max_length=20, choices=ACTION_CHOICES)
    description = models.TextField()
    target_model = models.CharField(max_length=100, blank=True)
    target_id = models.PositiveIntegerField(null=True, blank=True)
    metadata = models.JSONField(default=dict, blank=True)
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ['-created_at']

    def get_icon(self):
        icons = {
            'create': 'plus-circle',
            'update': 'edit',
            'delete': 'trash',
            'comment': 'message-circle',
            'upload': 'upload',
            'status': 'refresh-cw',
        }
        return icons.get(self.action, 'activity')

    def get_color(self):
        colors = {
            'create': 'success',
            'update': 'primary',
            'delete': 'danger',
            'comment': 'secondary',
            'upload': 'warning',
            'status': 'primary',
        }
        return colors.get(self.action, 'secondary')
