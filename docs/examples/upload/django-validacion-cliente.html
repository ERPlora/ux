<!-- Validacion en cliente -->
<div x-data="{
  file: null,
  error: null,
  maxSize: 10 * 1024 * 1024,
  allowedTypes: ['image/jpeg', 'image/png', 'application/pdf'],
  validate(event) {
    this.error = null;
    const f = event.target.files[0];
    if (!f) return;

    if (!this.allowedTypes.includes(f.type)) {
      this.error = 'Tipo no permitido';
      event.target.value = '';
      return;
    }

    if (f.size > this.maxSize) {
      this.error = 'Archivo muy grande (max 10MB)';
      event.target.value = '';
      return;
    }

    this.file = f;
  },
  formatSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
  }
}">
  <form hx-post="/upload/" hx-encoding="multipart/form-data" hx-target="#response">
    <label class="ux-upload-area" :class="{ 'ux-upload-area--error': error }">
      <svg class="ux-upload-area__icon">...</svg>
      <p class="ux-upload-area__text" x-show="!file">Arrastra archivos aqui</p>
      <p class="ux-upload-area__text" x-show="file" x-text="file?.name"></p>
      <p class="ux-upload-area__hint" x-show="file" x-text="formatSize(file?.size || 0)"></p>
      <p class="ux-upload-area__hint" x-show="!file">JPG, PNG, PDF - Max 10MB</p>
      <input type="file" name="file" @change="validate($event)" required>
    </label>

    <p x-show="error" x-text="error" style="color: var(--ux-danger); margin-top: var(--ux-space-sm);"></p>

    <button type="submit" class="ux-button ux-color-primary" :disabled="!file || error">Subir</button>
  </form>
  <div id="response"></div>
</div>
