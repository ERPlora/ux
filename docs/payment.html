<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Payment - UX Library</title>
  <link rel="stylesheet" href="../bootstrap-grid.min.css">
  <script src="../dist/ux.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      background: var(--ux-surface-secondary);
      padding: 2rem;
      padding-bottom: 4rem;
    }
    .demo-section {
      margin-bottom: 3rem;
    }
    .demo-section h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--ux-text);
    }
    .demo-section h3 {
      font-size: 1rem;
      font-weight: 500;
      margin-bottom: 0.75rem;
      color: var(--ux-text-secondary);
    }
    .demo-box {
      background: var(--ux-surface);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
    .demo-box--dark {
      background: var(--ux-gray-900);
    }
    .demo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    code {
      background: var(--ux-surface-tertiary);
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      font-size: 0.875rem;
    }
    pre {
      background: var(--ux-gray-900);
      color: var(--ux-gray-100);
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.8125rem;
      line-height: 1.5;
    }
    .event-log {
      font-family: monospace;
      font-size: 0.75rem;
      background: var(--ux-gray-900);
      color: var(--ux-green-400);
      padding: 0.75rem;
      border-radius: 8px;
      max-height: 150px;
      overflow-y: auto;
    }
    .demo-glass-bg {
      background: linear-gradient(135deg, var(--ux-blue-400), var(--ux-purple-500));
      padding: 2rem;
      border-radius: 16px;
    }
  </style>
</head>
<body class="ux-app">

  <h1 style="margin-bottom: 0.5rem;">Payment Selector</h1>
  <p style="color: var(--ux-text-secondary); margin-bottom: 2rem;">
    Componentes para selección de método de pago, cálculo de cambio y pagos divididos para POS.
  </p>

  <!-- Basic Payment Methods -->
  <section class="demo-section">
    <h2>Métodos de Pago Básicos</h2>
    <p style="color: var(--ux-text-secondary); margin-bottom: 1rem;">
      Selección simple de método de pago con iconos y estado seleccionado.
    </p>

    <div class="demo-box" x-data="uxPayment({
      total: 45.50,
      methods: [
        { id: 'cash', name: 'Efectivo', icon: 'cash' },
        { id: 'card', name: 'Tarjeta', icon: 'card' },
        { id: 'contactless', name: 'Contactless', icon: 'contactless' },
        { id: 'wallet', name: 'Digital', icon: 'wallet' }
      ]
    })" @payment:method-selected.window="console.log('Método:', $event.detail)">
      <div class="ux-payment">
        <div class="ux-payment__section">
          <span class="ux-payment__label">Método de pago</span>
          <div class="ux-payment-methods">
            <template x-for="method in methods" :key="method.id">
              <div class="ux-payment-method"
                   :class="{ 'ux-payment-method--selected': selectedMethod === method.id }"
                   @click="selectMethod(method.id)">
                <div class="ux-payment-method__icon" x-html="getIcon(method.icon)"></div>
                <span class="ux-payment-method__name" x-text="method.name"></span>
              </div>
            </template>
          </div>
        </div>

        <div class="ux-payment-summary">
          <div class="ux-payment-summary__row ux-payment-summary__row--total">
            <span class="ux-payment-summary__label">Total a pagar</span>
            <span class="ux-payment-summary__value" x-text="formatCurrency(total)"></span>
          </div>
        </div>

        <button class="ux-button ux-color-primary" style="width: 100%;"
                @click="processPayment()" :disabled="!selectedMethod">
          Pagar con <span x-text="methods.find(m => m.id === selectedMethod)?.name || '...'"></span>
        </button>
      </div>
    </div>

    <pre>&lt;div x-data="uxPayment({
  total: 45.50,
  methods: [
    { id: 'cash', name: 'Efectivo', icon: 'cash' },
    { id: 'card', name: 'Tarjeta', icon: 'card' },
    { id: 'contactless', name: 'Contactless', icon: 'contactless' }
  ]
})"&gt;
  &lt;div class="ux-payment-methods"&gt;
    &lt;template x-for="method in methods"&gt;
      &lt;div class="ux-payment-method"
           :class="{ 'ux-payment-method--selected': selectedMethod === method.id }"
           @click="selectMethod(method.id)"&gt;
        &lt;div class="ux-payment-method__icon" x-html="getIcon(method.icon)"&gt;&lt;/div&gt;
        &lt;span class="ux-payment-method__name" x-text="method.name"&gt;&lt;/span&gt;
      &lt;/div&gt;
    &lt;/template&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
  </section>

  <!-- Payment with Change Calculator -->
  <section class="demo-section">
    <h2>Calculadora de Cambio</h2>
    <p style="color: var(--ux-text-secondary); margin-bottom: 1rem;">
      Calcula el cambio automáticamente. Incluye montos rápidos y opción de importe exacto.
    </p>

    <div class="demo-box" x-data="uxPayment({
      total: 27.80,
      quickAmounts: [10, 20, 30, 50, 100],
      methods: [
        { id: 'cash', name: 'Efectivo', icon: 'cash' }
      ],
      defaultMethod: 'cash'
    })">
      <div class="ux-payment">
        <div class="ux-payment__section">
          <span class="ux-payment__label">Importe recibido</span>
          <div class="ux-payment-quick">
            <template x-for="amount in quickAmounts" :key="amount">
              <button class="ux-payment-quick__btn"
                      :class="{ 'ux-payment-quick__btn--exact': amount === total }"
                      @click="addQuickAmount(amount)"
                      x-text="formatCurrency(amount)">
              </button>
            </template>
            <button class="ux-payment-quick__btn ux-payment-quick__btn--exact"
                    @click="setExactAmount()">
              Exacto
            </button>
          </div>
        </div>

        <div class="ux-payment-change">
          <div class="ux-payment-change__row">
            <span class="ux-payment-change__label">Total a cobrar</span>
            <span class="ux-payment-change__value" x-text="formatCurrency(total)"></span>
          </div>
          <div class="ux-payment-change__row">
            <span class="ux-payment-change__label">Recibido</span>
            <span class="ux-payment-change__value" x-text="formatCurrency(amountReceived)"></span>
          </div>
          <div class="ux-payment-change__row ux-payment-change__row--total"
               :class="{ 'ux-payment-change__row--change': change > 0, 'ux-payment-change__row--due': amountDue > 0 && amountReceived > 0 }">
            <span class="ux-payment-change__label" x-text="change > 0 ? 'Cambio' : 'Pendiente'"></span>
            <span class="ux-payment-change__value" x-text="formatCurrency(change > 0 ? change : amountDue)"></span>
          </div>
        </div>

        <button class="ux-button ux-color-success" style="width: 100%;"
                :disabled="!isPaid"
                @click="processPayment()">
          <span x-show="isPaid">Completar Venta</span>
          <span x-show="!isPaid">Faltan <span x-text="formatCurrency(amountDue)"></span></span>
        </button>
      </div>
    </div>
  </section>

  <!-- Split Payment -->
  <section class="demo-section">
    <h2>Pago Dividido</h2>
    <p style="color: var(--ux-text-secondary); margin-bottom: 1rem;">
      Permite dividir el pago entre múltiples métodos.
    </p>

    <div class="demo-box" x-data="uxPayment({
      total: 156.00,
      allowSplit: true,
      methods: [
        { id: 'cash', name: 'Efectivo', icon: 'cash' },
        { id: 'card', name: 'Tarjeta', icon: 'card' },
        { id: 'voucher', name: 'Vale', icon: 'voucher' }
      ]
    })" x-init="addSplitPayment('cash', 100)">
      <div class="ux-payment">
        <div class="ux-payment__section">
          <span class="ux-payment__label">Pagos realizados</span>
          <div class="ux-payment-split">
            <template x-for="payment in splitPayments" :key="payment.id">
              <div class="ux-payment-split__item">
                <div class="ux-payment-split__method">
                  <div class="ux-payment-split__method-icon" x-html="getIcon(payment.method.icon)"></div>
                  <span class="ux-payment-split__method-name" x-text="payment.method.name"></span>
                </div>
                <span class="ux-payment-split__amount" x-text="formatCurrency(payment.amount)"></span>
                <button class="ux-payment-split__remove" @click="removeSplitPayment(payment.id)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                  </svg>
                </button>
              </div>
            </template>

            <template x-if="amountDue > 0">
              <div class="ux-payment-split__add" @click="$refs.splitModal.showModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 5v14M5 12h14"/>
                </svg>
                Añadir pago (<span x-text="formatCurrency(amountDue)"></span> pendiente)
              </div>
            </template>
          </div>
        </div>

        <div class="ux-payment-summary">
          <div class="ux-payment-summary__row">
            <span class="ux-payment-summary__label">Total</span>
            <span class="ux-payment-summary__value" x-text="formatCurrency(total)"></span>
          </div>
          <div class="ux-payment-summary__row">
            <span class="ux-payment-summary__label">Pagado</span>
            <span class="ux-payment-summary__value" x-text="formatCurrency(totalPaid)"></span>
          </div>
          <div class="ux-payment-summary__row" x-show="amountDue > 0">
            <span class="ux-payment-summary__label">Pendiente</span>
            <span class="ux-payment-summary__value" style="color: var(--ux-danger);" x-text="formatCurrency(amountDue)"></span>
          </div>
          <div class="ux-payment-summary__row" x-show="change > 0">
            <span class="ux-payment-summary__label">Cambio</span>
            <span class="ux-payment-summary__value" style="color: var(--ux-success);" x-text="formatCurrency(change)"></span>
          </div>
        </div>

        <button class="ux-button ux-color-success" style="width: 100%;"
                :disabled="!isPaid"
                @click="processPayment()">
          Completar Venta
        </button>

        <!-- Split payment modal -->
        <dialog x-ref="splitModal" class="ux-modal" style="max-width: 320px;">
          <div class="ux-modal__header">
            <h3 class="ux-modal__title">Añadir pago</h3>
            <button class="ux-modal__close" @click="$refs.splitModal.close()">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"/>
              </svg>
            </button>
          </div>
          <div class="ux-modal__content">
            <div class="ux-payment-methods ux-payment-methods--list" style="margin-bottom: 1rem;">
              <template x-for="method in methods" :key="method.id">
                <div class="ux-payment-method ux-payment-method--horizontal"
                     @click="addSplitPayment(method.id, amountDue); $refs.splitModal.close()">
                  <div class="ux-payment-method__icon" style="width: 24px; height: 24px;" x-html="getIcon(method.icon)"></div>
                  <span class="ux-payment-method__name" x-text="method.name"></span>
                </div>
              </template>
            </div>
          </div>
        </dialog>
      </div>
    </div>
  </section>

  <!-- Horizontal Methods -->
  <section class="demo-section">
    <h2>Métodos en Lista</h2>
    <p style="color: var(--ux-text-secondary); margin-bottom: 1rem;">
      Variante horizontal para espacios reducidos.
    </p>

    <div class="demo-box" style="max-width: 400px;" x-data="uxPayment({
      total: 89.99,
      methods: [
        { id: 'cash', name: 'Efectivo', icon: 'cash', desc: 'Pago en efectivo' },
        { id: 'card', name: 'Tarjeta de crédito', icon: 'card', desc: 'Visa, Mastercard, Amex' },
        { id: 'transfer', name: 'Transferencia', icon: 'transfer', desc: 'SEPA, Bizum' },
        { id: 'qr', name: 'Código QR', icon: 'qr', desc: 'Escanear para pagar' }
      ]
    })">
      <div class="ux-payment">
        <div class="ux-payment__section">
          <span class="ux-payment__label">Selecciona método de pago</span>
          <div class="ux-payment-methods ux-payment-methods--list">
            <template x-for="method in methods" :key="method.id">
              <div class="ux-payment-method ux-payment-method--horizontal"
                   :class="{ 'ux-payment-method--selected': selectedMethod === method.id }"
                   @click="selectMethod(method.id)">
                <div class="ux-payment-method__icon" x-html="getIcon(method.icon)"></div>
                <div style="flex: 1;">
                  <div class="ux-payment-method__name" x-text="method.name"></div>
                  <div class="ux-payment-method__desc" x-text="method.desc"></div>
                </div>
              </div>
            </template>
          </div>
        </div>

        <div style="display: flex; justify-content: space-between; padding: 1rem 0; border-top: 1px solid var(--ux-border-color);">
          <span style="color: var(--ux-text-secondary);">Total</span>
          <span style="font-size: 1.25rem; font-weight: 700;" x-text="formatCurrency(total)"></span>
        </div>
      </div>
    </div>
  </section>

  <!-- Glass Variant -->
  <section class="demo-section">
    <h2>Glass Variant</h2>
    <p style="color: var(--ux-text-secondary); margin-bottom: 1rem;">
      Estilo glass morphism para interfaces modernas.
    </p>

    <div class="demo-glass-bg">
      <div x-data="uxPayment({
        total: 125.00,
        quickAmounts: [50, 100, 150, 200],
        methods: [
          { id: 'cash', name: 'Efectivo', icon: 'cash' },
          { id: 'card', name: 'Tarjeta', icon: 'card' },
          { id: 'contactless', name: 'NFC', icon: 'contactless' }
        ]
      })">
        <div class="ux-payment ux-payment--glass">
          <div class="ux-payment__section">
            <span class="ux-payment__label" style="color: white;">Método de pago</span>
            <div class="ux-payment-methods ux-payment-methods--3col">
              <template x-for="method in methods" :key="method.id">
                <div class="ux-payment-method"
                     :class="{ 'ux-payment-method--selected': selectedMethod === method.id }"
                     @click="selectMethod(method.id)">
                  <div class="ux-payment-method__icon" x-html="getIcon(method.icon)"></div>
                  <span class="ux-payment-method__name" x-text="method.name"></span>
                </div>
              </template>
            </div>
          </div>

          <div class="ux-payment__section" x-show="selectedMethod === 'cash'">
            <span class="ux-payment__label" style="color: white;">Importe</span>
            <div class="ux-payment-quick">
              <template x-for="amount in quickAmounts" :key="amount">
                <button class="ux-payment-quick__btn" @click="addQuickAmount(amount)" x-text="formatCurrency(amount)"></button>
              </template>
            </div>
          </div>

          <div class="ux-payment-change" x-show="selectedMethod === 'cash' && amountReceived > 0">
            <div class="ux-payment-change__row">
              <span class="ux-payment-change__label">Total</span>
              <span class="ux-payment-change__value" x-text="formatCurrency(total)"></span>
            </div>
            <div class="ux-payment-change__row">
              <span class="ux-payment-change__label">Recibido</span>
              <span class="ux-payment-change__value" x-text="formatCurrency(amountReceived)"></span>
            </div>
            <div class="ux-payment-change__row ux-payment-change__row--total ux-payment-change__row--change" x-show="change > 0">
              <span class="ux-payment-change__label">Cambio</span>
              <span class="ux-payment-change__value" x-text="formatCurrency(change)"></span>
            </div>
          </div>

          <button class="ux-button ux-button--glass" style="width: 100%; color: white; border-color: rgba(255,255,255,0.3);">
            Procesar Pago
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Compact POS -->
  <section class="demo-section">
    <h2>POS Compacto</h2>
    <p style="color: var(--ux-text-secondary); margin-bottom: 1rem;">
      Versión compacta optimizada para terminales POS.
    </p>

    <div class="demo-grid">
      <div class="demo-box" x-data="uxPayment({
        total: 32.50,
        quickAmounts: [20, 35, 40, 50],
        methods: [
          { id: 'cash', name: 'Efectivo', icon: 'cash' },
          { id: 'card', name: 'Tarjeta', icon: 'card' }
        ],
        defaultMethod: 'cash'
      })">
        <div class="ux-payment ux-payment--compact">
          <div class="ux-payment-methods ux-payment-methods--2col" style="margin-bottom: 1rem;">
            <template x-for="method in methods" :key="method.id">
              <div class="ux-payment-method"
                   :class="{ 'ux-payment-method--selected': selectedMethod === method.id }"
                   @click="selectMethod(method.id)">
                <div class="ux-payment-method__icon" x-html="getIcon(method.icon)"></div>
                <span class="ux-payment-method__name" x-text="method.name"></span>
              </div>
            </template>
          </div>

          <div class="ux-payment-quick ux-payment-quick--5col" x-show="selectedMethod === 'cash'" style="margin-bottom: 1rem;">
            <template x-for="amount in quickAmounts" :key="amount">
              <button class="ux-payment-quick__btn" @click="addQuickAmount(amount)" x-text="amount + '€'"></button>
            </template>
            <button class="ux-payment-quick__btn ux-payment-quick__btn--exact" @click="setExactAmount()">OK</button>
          </div>

          <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--ux-surface-secondary); border-radius: 8px; margin-bottom: 0.75rem;">
            <div>
              <div style="font-size: 0.75rem; color: var(--ux-text-tertiary);">Total</div>
              <div style="font-size: 1.25rem; font-weight: 700;" x-text="formatCurrency(total)"></div>
            </div>
            <div x-show="selectedMethod === 'cash' && change > 0" style="text-align: right;">
              <div style="font-size: 0.75rem; color: var(--ux-text-tertiary);">Cambio</div>
              <div style="font-size: 1.25rem; font-weight: 700; color: var(--ux-success);" x-text="formatCurrency(change)"></div>
            </div>
          </div>

          <button class="ux-button ux-color-success ux-button--sm" style="width: 100%;"
                  :disabled="selectedMethod === 'cash' && !isPaid"
                  @click="processPayment()">
            Cobrar
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Events -->
  <section class="demo-section">
    <h2>Eventos</h2>
    <p style="color: var(--ux-text-secondary); margin-bottom: 1rem;">
      El componente emite eventos para integración con tu aplicación.
    </p>

    <div class="demo-box" x-data="{
      ...uxPayment({
        total: 50.00,
        quickAmounts: [20, 50, 100],
        methods: [
          { id: 'cash', name: 'Efectivo', icon: 'cash' },
          { id: 'card', name: 'Tarjeta', icon: 'card' }
        ]
      }),
      eventLog: []
    }"
    @payment:method-selected="eventLog.unshift('method-selected: ' + $event.detail.method)"
    @payment:amount-changed="eventLog.unshift('amount-changed: ' + $event.detail.amount + '€')"
    @payment:processed="eventLog.unshift('processed: ' + JSON.stringify($event.detail))"
    @payment:insufficient="eventLog.unshift('insufficient: faltan ' + $event.detail.due + '€')">
      <div class="row g-3">
        <div class="col-md-6">
          <div class="ux-payment">
            <div class="ux-payment-methods ux-payment-methods--2col" style="margin-bottom: 1rem;">
              <template x-for="method in methods" :key="method.id">
                <div class="ux-payment-method"
                     :class="{ 'ux-payment-method--selected': selectedMethod === method.id }"
                     @click="selectMethod(method.id)">
                  <div class="ux-payment-method__icon" x-html="getIcon(method.icon)"></div>
                  <span class="ux-payment-method__name" x-text="method.name"></span>
                </div>
              </template>
            </div>

            <div class="ux-payment-quick" style="margin-bottom: 1rem;">
              <template x-for="amount in quickAmounts" :key="amount">
                <button class="ux-payment-quick__btn" @click="addQuickAmount(amount)" x-text="formatCurrency(amount)"></button>
              </template>
            </div>

            <button class="ux-button ux-color-primary" style="width: 100%;" @click="processPayment()">
              Procesar Pago
            </button>
          </div>
        </div>
        <div class="col-md-6">
          <h4 style="font-size: 0.875rem; margin-bottom: 0.5rem;">Event Log:</h4>
          <div class="event-log">
            <template x-for="(event, i) in eventLog.slice(0, 10)" :key="i">
              <div x-text="event"></div>
            </template>
            <div x-show="eventLog.length === 0" style="color: var(--ux-gray-500);">
              Interactúa con el componente...
            </div>
          </div>
        </div>
      </div>
    </div>

    <h3>Eventos disponibles</h3>
    <pre>@payment:method-selected  // Método seleccionado
@payment:amount-changed   // Importe cambiado
@payment:processed        // Pago procesado exitosamente
@payment:insufficient     // Importe insuficiente
@payment:split-added      // Pago dividido añadido
@payment:split-removed    // Pago dividido eliminado
@payment:reset            // Componente reiniciado</pre>
  </section>

  <!-- API Reference -->
  <section class="demo-section">
    <h2>API Reference</h2>

    <h3>Opciones</h3>
    <pre>uxPayment({
  total: 100.00,              // Total a cobrar
  currency: '€',              // Símbolo de moneda
  currencyPosition: 'after',  // 'before' o 'after'
  quickAmounts: [5, 10, 20, 50, 100],
  methods: [
    { id: 'cash', name: 'Efectivo', icon: 'cash' },
    { id: 'card', name: 'Tarjeta', icon: 'card' }
  ],
  defaultMethod: 'cash',      // Método preseleccionado
  allowSplit: false,          // Permitir pago dividido
  showChange: true            // Mostrar calculadora de cambio
})</pre>

    <h3>Propiedades reactivas</h3>
    <pre>selectedMethod   // ID del método seleccionado
amountReceived   // Importe recibido
splitPayments    // Array de pagos divididos
change           // Cambio a devolver (computed)
amountDue        // Importe pendiente (computed)
isPaid           // Si está pagado (computed)
totalPaid        // Total pagado (computed)</pre>

    <h3>Métodos</h3>
    <pre>selectMethod(methodId)           // Seleccionar método
setAmount(amount)                // Establecer importe
addQuickAmount(amount)           // Añadir importe rápido
setExactAmount()                 // Establecer importe exacto
addSplitPayment(methodId, amount) // Añadir pago dividido
removeSplitPayment(paymentId)    // Eliminar pago dividido
processPayment()                 // Procesar pago
reset()                          // Reiniciar
formatCurrency(amount)           // Formatear moneda
getIcon(name)                    // Obtener icono SVG</pre>

    <h3>Iconos disponibles</h3>
    <pre>cash, card, contactless, wallet, transfer, voucher, crypto, qr, check</pre>
  </section>

</body>
</html>
