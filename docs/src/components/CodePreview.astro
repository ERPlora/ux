---
interface Props {
  title?: string;
  semantic: string;
  tailwind?: string;
  js?: string;
  height?: string;
  noFrame?: boolean;
}

const { title, semantic, tailwind, js, height = '320px', noFrame = false } = Astro.props;
const id = `preview-${Math.random().toString(36).slice(2, 9)}`;
---

<div class="border border-base-300 rounded-xl overflow-hidden my-4">
  {title && <h3 class="px-4 py-2 text-sm font-medium bg-base-200 border-b border-base-300">{title}</h3>}

  <div>
    <!-- Tabs -->
    <div class="flex bg-base-200 border-b border-base-300 text-sm" data-tabs={id}>
      <button class="px-4 py-2 font-medium border-b-2 border-primary text-primary" data-tab="preview" data-active>Preview</button>
      <button class="px-4 py-2 text-base-content/60 hover:text-base-content border-b-2 border-transparent" data-tab="semantic">Semantic</button>
      {tailwind && <button class="px-4 py-2 text-base-content/60 hover:text-base-content border-b-2 border-transparent" data-tab="tailwind">Tailwind</button>}
      <button class="px-4 py-2 text-base-content/60 hover:text-base-content border-b-2 border-transparent" data-tab="js">JS</button>
    </div>

    <!-- Panels -->
    <div data-panels={id}>
      {noFrame ? (
        <div class="p-6 bg-base-100 flex flex-wrap items-center gap-3" data-panel="preview">
          <Fragment set:html={semantic} />
        </div>
      ) : (
        <div class="p-4 bg-base-200/50" data-panel="preview">
          <div class="preview-frame" style={`height: ${height};`}>
            <div class="preview-frame-header">
              <span class="preview-frame-dot" style="background:#ff5f57;"></span>
              <span class="preview-frame-dot" style="background:#febc2e;"></span>
              <span class="preview-frame-dot" style="background:#28c840;"></span>
              <span class="preview-frame-title">Preview</span>
            </div>
            <div class="preview-frame-body">
              <Fragment set:html={semantic} />
            </div>
          </div>
        </div>
      )}

      <div class="p-4 bg-neutral text-neutral-content hidden" data-panel="semantic">
        <pre class="text-sm overflow-x-auto"><code>{semantic.trim()}</code></pre>
        <p class="text-xs opacity-60 mt-3">Requires: ux.min.css</p>
      </div>

      {tailwind && (
        <div class="p-4 bg-neutral text-neutral-content hidden" data-panel="tailwind">
          <pre class="text-sm overflow-x-auto"><code>{tailwind.trim()}</code></pre>
          <p class="text-xs opacity-60 mt-3">Requires: tw.min.css</p>
        </div>
      )}

      <div class="p-4 bg-neutral text-neutral-content hidden" data-panel="js">
        <pre class="text-sm overflow-x-auto"><code>{js || '// No JavaScript required - pure CSS component'}</code></pre>
      </div>
    </div>
  </div>
</div>

<style>
  .preview-frame {
    display: flex;
    flex-direction: column;
    border-radius: 0.5rem;
    border: 1px solid var(--color-base-300);
    overflow: hidden;
    background: var(--color-base-100);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
  }

  .preview-frame-header {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 0.75rem;
    background: var(--color-base-200);
    border-bottom: 1px solid var(--color-base-300);
    flex-shrink: 0;
  }

  .preview-frame-dot {
    width: 0.5rem;
    height: 0.5rem;
    border-radius: 50%;
  }

  .preview-frame-title {
    font-size: 0.6875rem;
    color: var(--color-base-content);
    opacity: 0.4;
    margin-left: 0.375rem;
  }

  .preview-frame-body {
    flex: 1;
    min-height: 0;
    overflow: auto;
    position: relative;
  }

  /* Reset: inside the preview frame, containers take 100% of the frame, not 100dvh */
  .preview-frame-body :global(.app) {
    height: 100%;
    min-height: 0;
  }

  .preview-frame-body :global(.page) {
    height: 100%;
  }
</style>

<script>
  // Simple tab switching (no framework needed)
  document.querySelectorAll('[data-tabs]').forEach((tabContainer) => {
    const id = tabContainer.getAttribute('data-tabs');
    const panels = document.querySelector(`[data-panels="${id}"]`);
    if (!panels) return;

    tabContainer.querySelectorAll('[data-tab]').forEach((tab) => {
      tab.addEventListener('click', () => {
        // Update tab styles
        tabContainer.querySelectorAll('[data-tab]').forEach((t) => {
          t.classList.remove('border-primary', 'text-primary', 'font-medium');
          t.classList.add('border-transparent', 'text-base-content/60');
        });
        tab.classList.add('border-primary', 'text-primary', 'font-medium');
        tab.classList.remove('border-transparent', 'text-base-content/60');

        // Show/hide panels
        const target = tab.getAttribute('data-tab');
        panels.querySelectorAll('[data-panel]').forEach((p) => {
          p.classList.toggle('hidden', p.getAttribute('data-panel') !== target);
        });
      });
    });
  });
</script>
