---
interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;

const navigation = [
  {
    title: "Getting Started",
    items: [
      { name: "Installation", href: "/ux/" },
      { name: "HTMX Integration", href: "/ux/htmx/" },
      { name: "Templates", href: "/ux/templates/" },
    ],
  },
  {
    title: "Examples",
    items: [
      { name: "Login Page", href: "/ux/examples/login/" },
      { name: "Products DataTable", href: "/ux/examples/datatable/" },
    ],
  },
  {
    title: "Layout",
    items: [
      { name: "App / Page / Drawer", href: "/ux/components/layout/" },
      { name: "Grid System", href: "/ux/components/grid/" },
      { name: "Header & Footer", href: "/ux/components/toolbar/" },
      { name: "Sidebar", href: "/ux/components/sidebar/" },
      { name: "Shell", href: "/ux/components/shell/" },
      { name: "Split Pane", href: "/ux/components/split-pane/" },
      { name: "Resizable", href: "/ux/components/resizable/" },
      { name: "Masonry", href: "/ux/components/masonry/" },
      { name: "Dashboard Grid", href: "/ux/components/dashboard-grid/" },
      { name: "Panel", href: "/ux/components/panel/" },
      { name: "Section", href: "/ux/components/section/" },
      { name: "Master Detail", href: "/ux/components/master-detail/" },
      { name: "Scroll Area", href: "/ux/components/scroll-area/" },
    ],
  },
  {
    title: "Actions",
    items: [
      { name: "Button", href: "/ux/components/button/" },
      { name: "Icon Button", href: "/ux/components/icon-button/" },
      { name: "Back Button", href: "/ux/components/back-button/" },
      { name: "Menu Button", href: "/ux/components/menu-button/" },
      { name: "Split Button", href: "/ux/components/split-button/" },
      { name: "FAB", href: "/ux/components/fab/" },
      { name: "Numpad", href: "/ux/components/numpad/" },
      { name: "Pin Pad", href: "/ux/components/pinpad/" },
      { name: "Calculator", href: "/ux/components/calculator/" },
    ],
  },
  {
    title: "Data Display",
    items: [
      { name: "Badge", href: "/ux/components/badge/" },
      { name: "Quantity Badge", href: "/ux/components/quantity-badge/" },
      { name: "Card", href: "/ux/components/card/" },
      { name: "Avatar", href: "/ux/components/avatar/" },
      { name: "Chip", href: "/ux/components/chip/" },
      { name: "Loading", href: "/ux/components/loading/" },
      { name: "Skeleton", href: "/ux/components/skeleton/" },
      { name: "Divider", href: "/ux/components/divider/" },
      { name: "Stats", href: "/ux/components/stats/" },
      { name: "Stock Indicator", href: "/ux/components/stock-indicator/" },
      { name: "Carousel", href: "/ux/components/carousel/" },
      { name: "Image Gallery", href: "/ux/components/image-gallery/" },
      { name: "Img", href: "/ux/components/img/" },
    ],
  },
  {
    title: "Visualization",
    items: [
      { name: "Timeline", href: "/ux/components/timeline/" },
      { name: "Gauge", href: "/ux/components/gauge/" },
      { name: "Sparkline", href: "/ux/components/sparkline/" },
      { name: "KPI Card", href: "/ux/components/kpi-card/" },
      { name: "Code Block", href: "/ux/components/code-block/" },
      { name: "JSON Viewer", href: "/ux/components/json-viewer/" },
      { name: "Diff Viewer", href: "/ux/components/diff-viewer/" },
      { name: "QR Code", href: "/ux/components/qr-code/" },
      { name: "Barcode Scanner", href: "/ux/components/barcode-scanner/" },
      { name: "PDF Viewer", href: "/ux/components/pdf-viewer/" },
      { name: "Audio Player", href: "/ux/components/audio-player/" },
      { name: "Video Player", href: "/ux/components/video-player/" },
      { name: "Image Crop", href: "/ux/components/image-crop/" },
      { name: "Calendar", href: "/ux/components/calendar/" },
      { name: "Calendar Views", href: "/ux/components/calendar-views/" },
      { name: "Kanban", href: "/ux/components/kanban/" },
      { name: "Virtual List", href: "/ux/components/virtual-list/" },
    ],
  },
  {
    title: "Navigation",
    items: [
      { name: "Menu / Dropdown", href: "/ux/components/menu/" },
      { name: "Menubar", href: "/ux/components/menubar/" },
      { name: "Mega Menu", href: "/ux/components/mega-menu/" },
      { name: "Breadcrumbs", href: "/ux/components/breadcrumbs/" },
      { name: "Pagination", href: "/ux/components/pagination/" },
      { name: "Tabs", href: "/ux/components/tabs/" },
      { name: "Tab Bar", href: "/ux/components/tabbar/" },
      { name: "Category Tabs", href: "/ux/components/category-tabs/" },
      { name: "Segment", href: "/ux/components/segment/" },
      { name: "Stepper", href: "/ux/components/stepper/" },
      { name: "Context Menu", href: "/ux/components/context-menu/" },
      { name: "Command Palette", href: "/ux/components/command/" },
      { name: "Infinite Scroll", href: "/ux/components/infinite-scroll/" },
    ],
  },
  {
    title: "Data Input",
    items: [
      {
        name: "Checkbox / Radio / Toggle",
        href: "/ux/components/form-control/",
      },
      { name: "Input & Textarea", href: "/ux/components/input/" },
      { name: "Select", href: "/ux/components/select/" },
      { name: "Range", href: "/ux/components/range/" },
      { name: "Rating", href: "/ux/components/rating/" },
      { name: "Quantity Stepper", href: "/ux/components/quantity-stepper/" },
      { name: "Upload", href: "/ux/components/upload/" },
      { name: "Tag Input", href: "/ux/components/tag-input/" },
      { name: "Autocomplete", href: "/ux/components/autocomplete/" },
      { name: "OTP Input", href: "/ux/components/otp-input/" },
      { name: "Currency Input", href: "/ux/components/currency-input/" },
      { name: "Phone Input", href: "/ux/components/phone-input/" },
      { name: "Signature Pad", href: "/ux/components/signature-pad/" },
      { name: "Rich Text Editor", href: "/ux/components/rich-text/" },
      { name: "Color Picker", href: "/ux/components/color-picker/" },
      { name: "Searchbar", href: "/ux/components/searchbar/" },
      { name: "Datetime", href: "/ux/components/datetime/" },
      { name: "Date Range Picker", href: "/ux/components/date-range-picker/" },
      { name: "Keyboard", href: "/ux/components/keyboard/" },
      { name: "Onscreen Keyboard", href: "/ux/components/onscreen-keyboard/" },
      { name: "Virtual Keyboard", href: "/ux/components/virtual-keyboard/" },
      { name: "Form", href: "/ux/components/form/" },
      { name: "Form Wizard", href: "/ux/components/form-wizard/" },
    ],
  },
  {
    title: "Feedback",
    items: [
      { name: "Alert", href: "/ux/components/alert/" },
      { name: "Toast", href: "/ux/components/toast/" },
      { name: "Progress Bar", href: "/ux/components/progress-bar/" },
      { name: "Progress Circle", href: "/ux/components/progress-circle/" },
      { name: "Progress Steps", href: "/ux/components/progress-steps/" },
      { name: "Snackbar", href: "/ux/components/snackbar/" },
      { name: "Banner", href: "/ux/components/banner/" },
      { name: "Callout", href: "/ux/components/callout/" },
      { name: "Spinner", href: "/ux/components/spinner/" },
      { name: "PWA", href: "/ux/components/pwa/" },
      { name: "Refresher", href: "/ux/components/refresher/" },
      { name: "Swipe", href: "/ux/components/swipe/" },
      { name: "Status Badge", href: "/ux/components/status-badge/" },
      { name: "Status Indicator", href: "/ux/components/status-indicator/" },
    ],
  },
  {
    title: "Overlays",
    items: [
      { name: "Modal", href: "/ux/components/modal/" },
      { name: "Sheet", href: "/ux/components/sheet/" },
      { name: "Tooltip", href: "/ux/components/tooltip/" },
      { name: "Popover", href: "/ux/components/popover/" },
      { name: "Picker", href: "/ux/components/picker/" },
      { name: "Hover Card", href: "/ux/components/hover-card/" },
      { name: "Lightbox", href: "/ux/components/lightbox/" },
      { name: "Notifications", href: "/ux/components/notifications/" },
    ],
  },
  {
    title: "Lists & Tables",
    items: [
      { name: "List", href: "/ux/components/list/" },
      { name: "Table", href: "/ux/components/table/" },
      { name: "Accordion", href: "/ux/components/accordion/" },
      { name: "DataTable", href: "/ux/components/datatable/" },
      { name: "Tree", href: "/ux/components/tree/" },
      { name: "Reorder", href: "/ux/components/reorder/" },
    ],
  },
  {
    title: "Selection",
    items: [
      { name: "Toggle Group", href: "/ux/components/toggle-group/" },
      { name: "Filter Chip", href: "/ux/components/filter-chip/" },
      { name: "Variant Selector", href: "/ux/components/variant-selector/" },
    ],
  },
  {
    title: "E-Commerce",
    items: [
      { name: "Product Card", href: "/ux/components/product-card/" },
      { name: "Cart", href: "/ux/components/cart/" },
      { name: "Order Ticket", href: "/ux/components/order-ticket/" },
      { name: "KDS Order", href: "/ux/components/kds-order/" },
      { name: "Payment", href: "/ux/components/payment/" },
      { name: "Receipt", href: "/ux/components/receipt/" },
    ],
  },
  {
    title: "HR / Employees",
    items: [
      { name: "Employee Card", href: "/ux/components/employee-card/" },
      { name: "Time Clock", href: "/ux/components/time-clock/" },
      { name: "Shift Calendar", href: "/ux/components/shift-calendar/" },
      { name: "Attendance List", href: "/ux/components/attendance-list/" },
      { name: "Leave Request", href: "/ux/components/leave-request/" },
      { name: "Org Chart", href: "/ux/components/org-chart/" },
      { name: "Performance Meter", href: "/ux/components/performance-meter/" },
    ],
  },
  {
    title: "Manufacturing",
    items: [
      { name: "Work Order", href: "/ux/components/work-order/" },
      { name: "Machine Status", href: "/ux/components/machine-status/" },
      { name: "Production Line", href: "/ux/components/production-line/" },
      { name: "Quality Check", href: "/ux/components/quality-check/" },
      { name: "Batch Tracker", href: "/ux/components/batch-tracker/" },
      { name: "BOM Tree", href: "/ux/components/bom-tree/" },
      { name: "Gantt", href: "/ux/components/gantt/" },
    ],
  },
  {
    title: "System & Files",
    items: [
      { name: "File Manager", href: "/ux/components/file-manager/" },
      { name: "System Monitor", href: "/ux/components/system-monitor/" },
    ],
  },
];

const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title} - UX Components</title>
    {description && <meta name="description" content={description} />}
    <link rel="icon" type="image/svg+xml" href="/ux/favicon.svg" />
    <script is:inline>
      (function () {
        var t = localStorage.getItem("theme");
        if (t) document.documentElement.setAttribute("data-theme", t);
      })();
    </script>
  </head>
  <body>
    <!-- Drawer toggle (hidden checkbox, no JS needed) -->
    <input type="checkbox" id="drawer-toggle" class="drawer-toggle" checked />
    <script is:inline>
      if (window.innerWidth < 992)
        document.getElementById("drawer-toggle").checked = false;
    </script>

    <div class="app">
      <div class="page">
        <!-- Page Header -->
        <header class="header">
          <!-- Left: drawer toggles + logo -->
          <div class="flex items-center gap-3">
            <!-- Drawer toggle (label for checkbox) -->
            <label
              for="drawer-toggle"
              class="flex items-center justify-center w-10 h-10 rounded-lg hover:bg-base-200 transition-colors cursor-pointer"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-5 h-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
              </svg>
            </label>
            <a href="/ux/" class="text-lg font-bold"
              >UX <span class="text-sm font-normal text-base-content/60"
                >v3</span
              ></a
            >
          </div>

          <!-- Right: theme selector + GitHub -->
          <div class="flex items-center gap-3">
            <!-- Theme selector (native <details>, no JS framework) -->
            <details class="relative" id="theme-details">
              <summary
                class="flex items-center gap-1.5 text-sm text-base-content/60 hover:text-base-content transition-colors px-2 py-1.5 rounded-lg hover:bg-base-200 cursor-pointer list-none"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-4 h-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M4.098 19.902a3.75 3.75 0 0 0 5.304 0l6.401-6.402M6.75 21A3.75 3.75 0 0 1 3 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 0 0 3.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.438-.439 1.15-.439 1.59 0l3.712 3.713c.44.44.44 1.152 0 1.59l-2.879 2.88M6.75 17.25h.008v.008H6.75v-.008Z"
                  ></path>
                </svg>
                <span class="hidden sm:inline" id="theme-label">Auto</span>
              </summary>
              <div
                class="absolute right-0 top-full mt-1 bg-base-100 border border-base-300 rounded-lg shadow-lg py-1 min-w-35 z-600"
              >
                <button
                  data-set-theme=""
                  class="w-full text-left px-3 py-1.5 text-sm hover:bg-base-200 transition-colors"
                  >Auto</button
                >
                <button
                  data-set-theme="light"
                  class="w-full text-left px-3 py-1.5 text-sm hover:bg-base-200 transition-colors"
                  >Light</button
                >
                <button
                  data-set-theme="dark"
                  class="w-full text-left px-3 py-1.5 text-sm hover:bg-base-200 transition-colors"
                  >Dark</button
                >
                <button
                  data-set-theme="erplora"
                  class="w-full text-left px-3 py-1.5 text-sm hover:bg-base-200 transition-colors"
                  >ERPlora</button
                >
                <button
                  data-set-theme="ocean"
                  class="w-full text-left px-3 py-1.5 text-sm hover:bg-base-200 transition-colors"
                  >Ocean</button
                >
              </div>
            </details>
            <a
              href="https://github.com/ERPlora/ux"
              target="_blank"
              class="text-sm text-base-content/60 hover:text-base-content transition-colors"
            >
              GitHub
            </a>
          </div>
        </header>

        <!-- Backdrop (mobile) — label closes the drawer checkbox -->
        <label for="drawer-toggle" class="drawer-backdrop"></label>

        <!-- Sidebar Drawer -->
        <aside class="drawer drawer-start" style="--drawer-width: 250px;">
          <div class="content">
            <!-- Search -->
            <div class="p-3 pb-0">
              <input
                type="text"
                id="nav-search"
                placeholder="Buscar componente..."
                class="w-full px-3 py-1.5 text-sm rounded-lg border border-base-300 bg-base-100 text-base-content placeholder:text-base-content/40 outline-none focus:border-primary transition-colors"
              />
            </div>
            <nav class="p-3 space-y-5" id="nav-list">
              {
                navigation.map((section) => (
                  <div>
                    <h3 class="text-xs font-bold uppercase tracking-wider text-base-content/50 mb-1.5 px-3">
                      {section.title}
                    </h3>
                    <ul class="space-y-0.5">
                      {section.items.map((item) => (
                        <li>
                          <a
                            href={item.href}
                            class:list={[
                              "block px-3 py-1.5 rounded-lg text-sm transition-colors",
                              currentPath === item.href
                                ? "bg-primary text-primary-content font-medium"
                                : "hover:bg-base-200 text-base-content/70",
                            ]}
                          >
                            {item.name}
                          </a>
                        </li>
                      ))}
                    </ul>
                  </div>
                ))
              }
            </nav>
          </div>
          <div class="footer">
            <span class="text-xs text-base-content/40">UX v3.0</span>
          </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
          <div class="p-6 max-w-full">
            <h1 class="text-2xl font-bold mb-6">{title}</h1>
            <slot />
          </div>
        </main>
      </div>
    </div>
  </body>
</html>

<style is:global>
  @import "../styles/app.css";

  /* Hide default <details> marker/arrow */
  details summary::-webkit-details-marker {
    display: none;
  }
  details summary::marker {
    display: none;
    content: "";
  }
</style>

<script>
  // Theme switcher — minimal vanilla JS (no framework)
  const themeLabels: Record<string, string> = {
    "": "Auto",
    light: "Light",
    dark: "Dark",
    erplora: "ERPlora",
    ocean: "Ocean",
  };
  const details = document.getElementById(
    "theme-details",
  ) as HTMLDetailsElement;
  const label = document.getElementById("theme-label");

  // Set initial label
  const current = document.documentElement.getAttribute("data-theme") || "";
  if (label) label.textContent = themeLabels[current] || "Auto";

  // Theme button clicks
  details?.addEventListener("click", (e) => {
    const btn = (e.target as HTMLElement).closest<HTMLButtonElement>(
      "[data-set-theme]",
    );
    if (!btn) return;
    const theme = btn.getAttribute("data-set-theme") || "";
    if (theme) {
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem("theme", theme);
    } else {
      document.documentElement.removeAttribute("data-theme");
      localStorage.removeItem("theme");
    }
    if (label) label.textContent = themeLabels[theme] || "Auto";
    details.open = false;
  });

  // Close on click outside
  document.addEventListener("click", (e) => {
    if (details && !details.contains(e.target as Node)) {
      details.open = false;
    }
  });

  // Nav search filter
  const navSearch = document.getElementById("nav-search") as HTMLInputElement;
  const navList = document.getElementById("nav-list") as HTMLElement;

  navSearch?.addEventListener("input", () => {
    const q = navSearch.value.toLowerCase().trim();
    const sections = navList.querySelectorAll(":scope > div");

    sections.forEach((section) => {
      const items = section.querySelectorAll("li");
      let visibleCount = 0;

      items.forEach((li) => {
        const link = li.querySelector("a");
        const text = link?.textContent?.toLowerCase() || "";
        const match = !q || text.includes(q);
        (li as HTMLElement).style.display = match ? "" : "none";
        if (match) visibleCount++;
      });

      // Hide entire section if no matches
      (section as HTMLElement).style.display = visibleCount > 0 ? "" : "none";
    });
  });
</script>
