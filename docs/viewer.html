<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UX Example Viewer</title>
  <!-- CSS/JS - usar npm run dev (Vite) para desarrollo -->
  <link rel="stylesheet" href="/ux.css">
  <script src="/ux.js"></script>
  <script src="alpine-components.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <!-- UX Playground Web Component -->
  <script src="ux-playground.js"></script>
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
    }
    .viewer-sidebar {
      width: 280px;
      height: 100vh;
      overflow-y: auto;
      background: var(--ux-surface);
      border-right: 1px solid var(--ux-border-color);
      flex-shrink: 0;
    }
    .viewer-sidebar__header {
      padding: 1rem;
      border-bottom: 1px solid var(--ux-border-color);
      position: sticky;
      top: 0;
      background: var(--ux-surface);
      z-index: 10;
    }
    .viewer-sidebar__title {
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0 0 0.75rem;
    }
    .viewer-sidebar__search {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--ux-border-color);
      border-radius: var(--ux-border-radius);
      font-size: 0.875rem;
    }
    .viewer-sidebar__search:focus {
      outline: none;
      border-color: var(--ux-primary);
    }
    .viewer-group {
      border-bottom: 1px solid var(--ux-border-color);
    }
    .viewer-group__header {
      padding: 0.75rem 1rem;
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--ux-text-secondary);
      background: var(--ux-surface-secondary);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .viewer-group__header:hover {
      background: var(--ux-gray-100);
    }
    .viewer-group__count {
      font-size: 0.625rem;
      background: var(--ux-gray-200);
      padding: 0.125rem 0.375rem;
      border-radius: 9999px;
    }
    .viewer-group__items {
      display: none;
    }
    .viewer-group.is-open .viewer-group__items {
      display: block;
    }
    .viewer-item {
      display: block;
      padding: 0.5rem 1rem 0.5rem 1.5rem;
      font-size: 0.8125rem;
      color: var(--ux-text-secondary);
      text-decoration: none;
      border-left: 2px solid transparent;
    }
    .viewer-item:hover {
      background: var(--ux-surface-secondary);
      color: var(--ux-text);
    }
    .viewer-item.is-active {
      background: var(--ux-primary-tint);
      color: var(--ux-primary);
      border-left-color: var(--ux-primary);
      font-weight: 500;
    }
    .viewer-main {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
      background: var(--ux-surface-secondary);
    }
    .viewer-info {
      color: var(--ux-text-secondary);
      font-family: monospace;
      font-size: 0.875rem;
      margin-bottom: 1rem;
      padding: 0.5rem 1rem;
      background: var(--ux-surface);
      border-radius: var(--ux-border-radius);
    }
    .viewer-error {
      color: var(--ux-danger);
      padding: 1rem;
      background: var(--ux-surface);
      border-radius: var(--ux-border-radius);
      border: 1px solid var(--ux-danger);
    }
    .viewer-welcome {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--ux-text-secondary);
    }
    .viewer-welcome h2 {
      color: var(--ux-text);
      margin-bottom: 0.5rem;
    }
    @media (max-width: 768px) {
      .viewer-sidebar {
        width: 100%;
        height: auto;
        max-height: 50vh;
      }
      body {
        flex-direction: column;
      }
    }
  </style>
</head>
<body x-data="viewerApp()">
  <!-- Sidebar -->
  <aside class="viewer-sidebar">
    <div class="viewer-sidebar__header">
      <h1 class="viewer-sidebar__title">ðŸ“¦ Examples</h1>
      <input
        type="search"
        class="viewer-sidebar__search"
        placeholder="Buscar ejemplo..."
        x-model="search"
        @input="filterExamples()">
    </div>
    <nav>
      <template x-for="group in filteredGroups" :key="group.name">
        <div class="viewer-group" :class="{ 'is-open': group.open }">
          <div class="viewer-group__header" @click="group.open = !group.open">
            <span x-text="group.name"></span>
            <span class="viewer-group__count" x-text="group.items.length"></span>
          </div>
          <div class="viewer-group__items">
            <template x-for="item in group.items" :key="item">
              <a
                :href="'?example=' + group.name + '/' + item"
                class="viewer-item"
                :class="{ 'is-active': currentExample === group.name + '/' + item }"
                @click.prevent="loadExample(group.name + '/' + item)"
                x-text="item.replace('.html', '').replace(/-/g, ' ')">
              </a>
            </template>
          </div>
        </div>
      </template>
    </nav>
  </aside>

  <!-- Main -->
  <main class="viewer-main">
    <div x-show="currentExample" class="viewer-info" x-text="'ðŸ“ examples/' + currentExample + '.html'"></div>
    <div id="preview">
      <div class="viewer-welcome" x-show="!currentExample">
        <h2>UX Example Viewer</h2>
        <p>Selecciona un ejemplo del menÃº para previsualizarlo</p>
      </div>
    </div>
  </main>

  <script>
    function viewerApp() {
      return {
        search: '',
        currentExample: new URLSearchParams(location.search).get('example') || '',
        groups: [],
        filteredGroups: [],

        async init() {
          // Fetch example list
          try {
            const response = await fetch('examples/');
            const html = await response.text();
            this.parseExampleList(html);
          } catch (e) {
            // Fallback: load from predefined list
            this.loadPredefinedList();
          }

          // Load initial example if provided
          if (this.currentExample) {
            this.loadExample(this.currentExample);
          }
        },

        parseExampleList(html) {
          // Parse directory listing (works with most static servers)
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const links = doc.querySelectorAll('a');
          const dirs = new Set();

          links.forEach(link => {
            const href = link.getAttribute('href');
            if (href && href.endsWith('/') && !href.startsWith('..')) {
              dirs.add(href.replace('/', ''));
            }
          });

          if (dirs.size > 0) {
            this.loadFromDirs([...dirs]);
          } else {
            this.loadPredefinedList();
          }
        },

        async loadFromDirs(dirs) {
          for (const dir of dirs.sort()) {
            try {
              const response = await fetch(`examples/${dir}/`);
              const html = await response.text();
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, 'text/html');
              const links = doc.querySelectorAll('a');
              const items = [];

              links.forEach(link => {
                const href = link.getAttribute('href');
                if (href && href.endsWith('.html')) {
                  items.push(href);
                }
              });

              if (items.length > 0) {
                this.groups.push({
                  name: dir,
                  items: items.sort(),
                  open: false
                });
              }
            } catch (e) {
              console.warn(`Could not load ${dir}`);
            }
          }
          this.filteredGroups = [...this.groups];

          // Open current group
          if (this.currentExample) {
            const groupName = this.currentExample.split('/')[0];
            const group = this.groups.find(g => g.name === groupName);
            if (group) group.open = true;
          }
        },

        loadPredefinedList() {
          // Hardcoded common examples as fallback
          const examples = {
            'button': ['basico', 'colores', 'variantes', 'tamanos', 'estados'],
            'modal': ['basico', 'sizes', 'glass', 'fullscreen'],
            'card': ['basica', 'con-header', 'con-imagen', 'glass'],
            'badge': ['colores', 'tamanos', 'variantes'],
            'input': ['basico', 'estados', 'con-icono'],
            'toast': ['basico', 'variantes', 'posiciones'],
            'tabs': ['basico', 'variantes', 'con-iconos'],
            'accordion': ['basico', 'multiples-abiertos']
          };

          this.groups = Object.entries(examples).map(([name, items]) => ({
            name,
            items: items.map(i => i + '.html'),
            open: false
          }));
          this.filteredGroups = [...this.groups];
        },

        filterExamples() {
          if (!this.search) {
            this.filteredGroups = [...this.groups];
            return;
          }

          const query = this.search.toLowerCase();
          this.filteredGroups = this.groups
            .map(group => ({
              ...group,
              items: group.items.filter(item =>
                item.toLowerCase().includes(query) ||
                group.name.toLowerCase().includes(query)
              ),
              open: true
            }))
            .filter(group => group.items.length > 0);
        },

        loadExample(path) {
          this.currentExample = path;
          history.pushState(null, '', `?example=${path}`);

          const preview = document.getElementById('preview');

          // Usar el Web Component <ux-playground> para renderizar
          preview.innerHTML = `<ux-playground src="examples/${path}.html"></ux-playground>`;

          // Update active state in menu
          const groupName = path.split('/')[0];
          this.groups.forEach(g => {
            if (g.name === groupName) g.open = true;
          });
        }
      };
    }
  </script>
</body>
</html>
