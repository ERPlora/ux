<style>
  .demo-section { margin-bottom: var(--ux-space-xl); }
  .demo-section h3 {
    font-size: var(--ux-font-size-lg);
    font-weight: 600;
    margin-bottom: var(--ux-space-md);
    color: var(--ux-text);
  }
  .demo-section p {
    font-size: var(--ux-font-size-md);
    color: var(--ux-text-secondary);
    margin-bottom: var(--ux-space-md);
  }
  .demo-controls {
    display: flex;
    gap: var(--ux-space-sm);
    margin-bottom: var(--ux-space-md);
    flex-wrap: wrap;
  }
  .demo-output {
    padding: var(--ux-space-md);
    background: var(--ux-surface-secondary);
    border-radius: var(--ux-radius-md);
    font-size: var(--ux-font-size-sm);
    color: var(--ux-text-secondary);
  }
</style>

<!-- Uso Basico -->
<section class="component-section">
  <h3>Uso Basico</h3>
  <p>Arbol jerarquico expandible/colapsable con iconos.</p>
  <ux-playground src="examples/tree/basico.html"></ux-playground>
</section>

<!-- Arbol con Seleccion -->
<section class="component-section">
  <h3>Arbol con Seleccion</h3>
  <p>Permite seleccionar nodos haciendo click.</p>
  <ux-playground src="examples/tree/con-seleccion.html"></ux-playground>
</section>

<!-- Arbol con Checkboxes -->
<section class="component-section">
  <h3>Arbol con Checkboxes</h3>
  <p>Checkboxes para seleccion multiple con estado indeterminado.</p>
  <ux-playground src="examples/tree/con-checkboxes.html"></ux-playground>
</section>

<!-- Controles Expandir/Colapsar -->
<section class="component-section">
  <h3>Controles Expandir/Colapsar</h3>
  <p>Botones para expandir o colapsar todos los nodos.</p>
  <ux-playground src="examples/tree/controles-expandir.html"></ux-playground>
</section>

<!-- Variante con Lineas -->
<section class="component-section">
  <h3>Variante con Lineas</h3>
  <p>Lineas de conexion entre nodos.</p>
  <ux-playground src="examples/tree/con-lineas.html"></ux-playground>
</section>

<!-- Variante Glass -->
<section class="component-section">
  <h3>Variante Glass</h3>
  <p>Efecto glass morphism para fondos con gradiente.</p>
  <ux-playground src="examples/tree/glass.html"></ux-playground>
</section>

<!-- Tamanos -->
<section class="component-section">
  <h3>Tamanos</h3>
  <p>Variantes de tamano: small, default, large.</p>
  <ux-playground src="examples/tree/tamanos.html"></ux-playground>
</section>

<!-- Con Badges -->
<section class="component-section">
  <h3>Con Badges</h3>
  <p>Indicadores numericos en los nodos.</p>
  <ux-playground src="examples/tree/con-badges.html"></ux-playground>
</section>

<!-- API y Eventos -->
<section class="component-section">
  <h3>API y Eventos</h3>
  <pre class="ux-code-block" data-lang="javascript">// Opciones de configuracion
uxTree({
  data: [],                // Array de nodos
  selectable: false,       // Permitir seleccion
  multiSelect: false,      // Seleccion multiple
  checkable: false,        // Mostrar checkboxes
  editable: false,         // Permitir edicion de labels
  draggable: false,        // Permitir drag & drop
  showIcons: true,         // Mostrar iconos
  showActions: false,      // Mostrar acciones (add, edit, delete)
  expandOnClick: true,     // Expandir al hacer click
  lazyLoad: false,         // Cargar hijos bajo demanda
  loadChildren: null,      // Funcion async para cargar hijos
  expanded: [],            // IDs de nodos expandidos inicialmente
  selected: [],            // IDs de nodos seleccionados inicialmente
  checked: []              // IDs de nodos marcados inicialmente
})

// Metodos
toggle(nodeId)             // Expandir/colapsar nodo
expand(nodeId)             // Expandir nodo
collapse(nodeId)           // Colapsar nodo
expandAll()                // Expandir todos
collapseAll()              // Colapsar todos
select(nodeId)             // Seleccionar nodo
check(nodeId, checked?)    // Marcar/desmarcar checkbox
startEdit(nodeId)          // Iniciar edicion
findNode(nodeId)           // Buscar nodo por ID
getSelected()              // Obtener nodos seleccionados
getChecked()               // Obtener nodos marcados
addNode(parentId, node)    // Agregar nodo
removeNode(nodeId)         // Eliminar nodo

// Eventos
@tree:expand               // Nodo expandido
@tree:collapse             // Nodo colapsado
@tree:expand-all           // Todos expandidos
@tree:collapse-all         // Todos colapsados
@tree:select               // Nodo seleccionado
@tree:check                // Checkbox cambiado
@tree:click                // Click en nodo
@tree:dblclick             // Doble click en nodo
@tree:rename               // Nodo renombrado
@tree:add                  // Nodo agregado
@tree:remove               // Nodo eliminado
@tree:drop                 // Drag & drop completado
@tree:load-error           // Error al cargar hijos</pre>
</section>

<!-- Estructura de Nodo -->
<section class="component-section">
  <h3>Estructura de Nodo</h3>
  <pre class="ux-code-block" data-lang="javascript">// Estructura basica de un nodo
{
  id: 'unique-id',         // ID unico (requerido)
  label: 'Nombre',         // Texto a mostrar (requerido)
  icon: 'folder',          // 'folder' o 'file' (opcional)
  children: [],            // Array de nodos hijos (opcional)
  badge: 5,                // Numero para badge (opcional)
  badgeType: 'primary',    // Tipo de badge (opcional)
  disabled: false,         // Deshabilitar nodo (opcional)
  data: {}                 // Datos adicionales (opcional)
}</pre>
</section>

<!-- Integracion con HTMX -->
<section class="component-section">
  <h3>Integracion con HTMX</h3>
  <p>Carga diferida de nodos hijos desde el servidor.</p>
  <pre class="ux-code-block" data-lang="html"><!-- Tree con lazy loading -->
<div x-data="uxTree({
  lazyLoad: true,
  loadChildren: async (node) => {
    const response = await fetch(`/api/tree/${node.id}/children`);
    return await response.json();
  },
  data: [
    { id: 'root', label: 'Raiz', children: [] }
  ]
})">
  ...
</div>

<!-- Con HTMX directo -->
<div class="ux-tree">
  <div class="ux-tree__node">
    <div class="ux-tree__item"
         hx-get="/api/tree/folder1/children"
         hx-target="next .ux-tree__list--nested"
         hx-trigger="click once"
         hx-swap="innerHTML">
      <span class="ux-tree__toggle">...</span>
      <span class="ux-tree__label">Carpeta</span>
    </div>
    <ul class="ux-tree__list ux-tree__list--nested"></ul>
  </div>
</div></pre>
</section>

<!-- HTMX + Django -->
<section class="component-section">
  <h3>HTMX + Django</h3>
  <p>Integracion con Django para arboles con nodos dinamicos cargados desde el servidor.</p>

  <h4 style="font-size: var(--ux-font-size-md); margin: var(--ux-space-lg) 0 var(--ux-space-sm);">Vista Django</h4>
  <pre class="ux-code-block" data-lang="python"># views.py - Vista Django para nodos del arbol
from django.http import JsonResponse
from django.shortcuts import render
from .models import TreeNode

def tree_view(request):
    """Vista principal del arbol"""
    root_nodes = TreeNode.objects.filter(parent=None)
    return render(request, 'tree.html', {'nodes': root_nodes})

def tree_children(request, node_id):
    """Endpoint para cargar hijos de un nodo (HTMX)"""
    node = TreeNode.objects.get(id=node_id)
    children = node.children.all()
    return render(request, 'partials/tree_nodes.html', {'nodes': children})</pre>

  <h4 style="font-size: var(--ux-font-size-md); margin: var(--ux-space-lg) 0 var(--ux-space-sm);">Modelo Django</h4>
  <pre class="ux-code-block" data-lang="python"># models.py - Modelo de nodo de arbol
from django.db import models

class TreeNode(models.Model):
    name = models.CharField(max_length=255)
    icon = models.CharField(max_length=50, default='folder')
    parent = models.ForeignKey(
        'self',
        on_delete=models.CASCADE,
        null=True,
        blank=True,
        related_name='children'
    )
    order = models.IntegerField(default=0)

    class Meta:
        ordering = ['order', 'name']

    def has_children(self):
        return self.children.exists()

    def __str__(self):
        return self.name</pre>

  <h4 style="font-size: var(--ux-font-size-md); margin: var(--ux-space-lg) 0 var(--ux-space-sm);">Template Principal</h4>
  <pre class="ux-code-block" data-lang="html"><!-- templates/tree.html - Template principal -->
<div class="ux-tree ux-tree--bordered">
  {% for node in nodes %}
    {% include "partials/tree_node.html" with node=node %}
  {% endfor %}
</div></pre>

  <h4 style="font-size: var(--ux-font-size-md); margin: var(--ux-space-lg) 0 var(--ux-space-sm);">Template de Nodo Individual</h4>
  <pre class="ux-code-block" data-lang="html"><!-- templates/partials/tree_node.html - Nodo individual -->
<div class="ux-tree__node" id="node-{{ node.id }}">
  <div class="ux-tree__item"
       {% if node.has_children %}
       hx-get="{% url 'tree_children' node.id %}"
       hx-target="#children-{{ node.id }}"
       hx-trigger="click once"
       hx-swap="innerHTML"
       hx-indicator="#loader-{{ node.id }}"
       @click="$el.closest('.ux-tree__node').querySelector('.ux-tree__toggle').classList.toggle('ux-tree__toggle--expanded')"
       {% endif %}>
    <span class="ux-tree__toggle {% if not node.has_children %}ux-tree__toggle--empty{% endif %}">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </span>
    <span class="ux-tree__icon ux-tree__icon--{{ node.icon }}">
      {% if node.icon == 'folder' %}
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 4H4a2 2 0 00-2 2v12a2 2 0 002 2h16a2 2 0 002-2V8a2 2 0 00-2-2h-8l-2-2z"/></svg>
      {% else %}
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      {% endif %}
    </span>
    <span class="ux-tree__label">{{ node.name }}</span>
    <span id="loader-{{ node.id }}" class="htmx-indicator ux-spinner ux-spinner--sm"></span>
  </div>
  <ul class="ux-tree__list ux-tree__list--nested" id="children-{{ node.id }}"></ul>
</div></pre>

  <h4 style="font-size: var(--ux-font-size-md); margin: var(--ux-space-lg) 0 var(--ux-space-sm);">Template de Lista de Hijos</h4>
  <pre class="ux-code-block" data-lang="html"><!-- templates/partials/tree_nodes.html - Lista de nodos hijos -->
{% for node in nodes %}
  <li>
    {% include "partials/tree_node.html" with node=node %}
  </li>
{% empty %}
  <li class="ux-tree__node ux-tree__node--empty">
    <span class="ux-text-secondary">Sin elementos</span>
  </li>
{% endfor %}</pre>

  <h4 style="font-size: var(--ux-font-size-md); margin: var(--ux-space-lg) 0 var(--ux-space-sm);">URLs Django</h4>
  <pre class="ux-code-block" data-lang="python"># urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('tree/', views.tree_view, name='tree_view'),
    path('tree/<int:node_id>/children/', views.tree_children, name='tree_children'),
]</pre>

  <h4 style="font-size: var(--ux-font-size-md); margin: var(--ux-space-lg) 0 var(--ux-space-sm);">Arbol con Checkboxes</h4>
  <pre class="ux-code-block" data-lang="html"><!-- Arbol con checkboxes y seleccion multiple (Django + HTMX) -->
<form hx-post="{% url 'tree_action' %}" hx-target="#result">
  {% csrf_token %}
  <div class="ux-tree ux-tree--bordered">
    {% for node in nodes %}
    <div class="ux-tree__node">
      <div class="ux-tree__item">
        <span class="ux-tree__toggle ux-tree__toggle--empty"></span>
        <label class="ux-tree__checkbox">
          <input type="checkbox" name="selected_nodes" value="{{ node.id }}">
          <span class="ux-tree__checkbox-icon"></span>
        </label>
        <span class="ux-tree__label">{{ node.name }}</span>
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="demo-controls" style="margin-top: var(--ux-space-md);">
    <button type="submit" class="ux-button ux-color-primary">Procesar seleccionados</button>
  </div>
</form>
<div id="result"></div></pre>

  <h4 style="font-size: var(--ux-font-size-md); margin: var(--ux-space-lg) 0 var(--ux-space-sm);">Arbol con Busqueda</h4>
  <pre class="ux-code-block" data-lang="html"><!-- Arbol con busqueda en tiempo real (HTMX) -->
<div class="ux-input" style="margin-bottom: var(--ux-space-md);">
  <input type="search"
         name="q"
         placeholder="Buscar en el arbol..."
         hx-get="{% url 'tree_search' %}"
         hx-trigger="input changed delay:300ms"
         hx-target="#tree-results">
  <span class="ux-input__icon">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
    </svg>
  </span>
</div>
<div id="tree-results" class="ux-tree ux-tree--bordered">
  {% include "partials/tree_nodes.html" %}
</div></pre>
</section>
