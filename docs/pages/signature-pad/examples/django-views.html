# views.py
import base64
from django.http import HttpResponse
from django.views.decorators.http import require_POST
from django.core.files.base import ContentFile

@require_POST
def save_signature(request):
    signature_data = request.POST.get('signature')

    if not signature_data:
        return HttpResponse(
            '<div class="ux-alert ux-color-danger">'
            'Firma requerida</div>',
            status=400
        )

    # Decodificar base64 (data:image/png;base64,...)
    format, imgstr = signature_data.split(';base64,')
    ext = format.split('/')[-1]
    image_data = base64.b64decode(imgstr)

    # Guardar en modelo
    from .models import Document
    doc = Document.objects.create(
        user=request.user,
        # Guardar como archivo
        signature=ContentFile(
            image_data,
            name=f'firma_{request.user.id}.{ext}'
        )
    )

    return HttpResponse(
        '<div class="ux-alert ux-color-success">'
        f'Firma guardada (ID: {doc.id})</div>'
    )
