<pre class="ux-code-block" data-lang="html" style="margin: 0;"><div x-data="{
       colors: {{ product.colors_json|safe }},
       allSizes: {{ product.sizes_by_color_json|safe }},
       selectedColor: '{{ product.default_color }}',
       selectedSize: null,

       get availableSizes() {
         return this.allSizes[this.selectedColor] || [];
       },

       selectColor(color) {
         this.selectedColor = color;
         // Reset size si no esta disponible en el nuevo color
         const sizeAvailable = this.availableSizes.find(s => s.value === this.selectedSize);
         if (!sizeAvailable || sizeAvailable.available === false) {
           const firstAvailable = this.availableSizes.find(s => s.available !== false);
           this.selectedSize = firstAvailable?.value || null;
         }
         // Actualizar precio
         htmx.trigger(this.$refs.priceContainer, 'refresh');
       }
     }">

  <!-- Selector de Color -->
  <div class="ux-variant-selector ux-variant-selector--color">
    <div class="ux-variant-selector__label">Color</div>
    <div class="ux-variant-selector__options">
      <template x-for="color in colors" :key="color.value">
        <button class="ux-variant-selector__option"
                :class="{ 'ux-variant-selector__option--selected': selectedColor === color.value }"
                :style="'background-color: ' + color.hex"
                @click="selectColor(color.value)"
                :title="color.label">
        </button>
      </template>
    </div>
  </div>

  <!-- Selector de Talla (dinamico segun color) -->
  <div class="ux-variant-selector">
    <div class="ux-variant-selector__label">Talla</div>
    <div class="ux-variant-selector__options">
      <template x-for="size in availableSizes" :key="size.value">
        <button class="ux-variant-selector__option"
                :class="{
                  'ux-variant-selector__option--selected': selectedSize === size.value,
                  'ux-variant-selector__option--unavailable': size.available === false
                }"
                @click="selectedSize = size.value; htmx.trigger($refs.priceContainer, 'refresh')"
                x-text="size.label">
        </button>
      </template>
    </div>
  </div>

  <input type="hidden" name="color" :value="selectedColor">
  <input type="hidden" name="size" :value="selectedSize">

  <div x-ref="priceContainer"
       hx-get="{% url 'product_price' product.id %}"
       hx-trigger="refresh"
       hx-vals="js:{color: document.querySelector('[name=color]').value, size: document.querySelector('[name=size]').value}">
  </div>
</div></pre>
