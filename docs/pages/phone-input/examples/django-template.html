<!-- Formulario con validacion en tiempo real -->
<form hx-post="/api/phone/validate/"
      hx-trigger="phone:change from:body delay:500ms"
      hx-target="#phone-result"
      hx-swap="innerHTML">

  <div class="ux-phone-field">
    <label class="ux-phone-field__label">Telefono</label>

    <div x-data="uxPhoneInput({ defaultCountry: 'ES' })"
         @phone:change="$dispatch('phone:change')"
         class="ux-phone"
         :class="{
           'ux-phone--open': isOpen,
           'ux-phone--error': $el.closest('form').querySelector('.is-invalid'),
           'ux-phone--success': $el.closest('form').querySelector('.is-valid')
         }">

      <!-- Hidden inputs para enviar al servidor -->
      <input type="hidden" name="phone_number" :value="phoneNumber">
      <input type="hidden" name="country_code" :value="selectedCountry.code">
      <input type="hidden" name="dial_code" :value="selectedCountry.dial">

      <button type="button" class="ux-phone__country" @click="toggle()">
        <span class="ux-phone__flag" x-text="selectedCountry.flag"></span>
        <span class="ux-phone__code" x-text="selectedCountry.dial"></span>
        <span class="ux-phone__arrow" x-html="arrowIcon"></span>
      </button>

      <input type="tel"
             x-ref="phoneInput"
             class="ux-input"
             :placeholder="placeholder"
             :value="phoneNumber"
             @input="onPhoneInput($event)">

      <div class="ux-phone__dropdown" x-show="isOpen" x-transition @click.outside="close()">
        <div class="ux-phone__search">
          <input type="text" x-ref="searchInput" class="ux-phone__search-input"
                 placeholder="Buscar pais..." x-model="searchQuery">
        </div>
        <div class="ux-phone__list">
          <template x-for="country in filteredCountries" :key="country.code">
            <div class="ux-phone__option"
                 :class="{ 'ux-phone__option--selected': selectedCountry.code === country.code }"
                 @click="selectCountry(country)">
              <span class="ux-phone__option-flag" x-text="country.flag"></span>
              <span class="ux-phone__option-name" x-text="country.name"></span>
              <span class="ux-phone__option-code" x-text="country.dial"></span>
            </div>
          </template>
        </div>
      </div>
    </div>

    <!-- Resultado de validacion -->
    <div id="phone-result"></div>
  </div>

  <button type="submit" class="ux-button ux-color-primary" style="margin-top: 1rem;">
    Enviar
  </button>
</form>
