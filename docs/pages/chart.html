<style>
    .demo-section { margin-bottom: var(--ux-space-xl); padding: var(--ux-space-lg); }
    .demo-section h3 { font-size: var(--ux-font-size-lg); font-weight: 600; margin-bottom: var(--ux-space-md); color: var(--ux-text); }
    .demo-section h4 { font-size: var(--ux-font-size-md); font-weight: 600; margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm); color: var(--ux-text); }
    .demo-section p { font-size: var(--ux-font-size-md); color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md); }
    .demo-row { display: flex; flex-wrap: wrap; gap: var(--ux-space-lg); align-items: flex-start; margin-bottom: var(--ux-space-md); }
    .ux-table { width: 100%; border-collapse: collapse; margin-bottom: var(--ux-space-lg); }
    .ux-table th, .ux-table td { padding: var(--ux-space-sm) var(--ux-space-md); text-align: left; border-bottom: 1px solid var(--ux-border-color); }
    .ux-table th { font-weight: 600; color: var(--ux-text); background: var(--ux-surface-secondary); }
    .ux-table td { color: var(--ux-text-secondary); }
    .ux-table code { background: var(--ux-surface-secondary); padding: 2px 6px; border-radius: 4px; font-size: var(--ux-font-size-sm); }
    .page-header { margin-bottom: var(--ux-space-xl); }
    .page-header h1 { font-size: var(--ux-font-size-2xl); font-weight: 700; color: var(--ux-text); margin-bottom: var(--ux-space-sm); }
    .page-header p { font-size: var(--ux-font-size-lg); color: var(--ux-text-secondary); }
  </style>

<div class="page-header">
    <h1>Chart</h1>
    <p>Wrapper para Chart.js con integracion de temas UX. Tambien soporta SVG externos (matplotlib).</p>
  </div>

  <!-- Basic Chart.js -->
  <div class="demo-section">
    <h3>Chart.js Basico</h3>
    <p>Usa <code>x-data="uxChart({...})"</code> para inicializar un grafico con colores del tema UX.</p>

    <ux-playground src="examples/chart/chartjs-basico.html"></ux-playground>
      <div class="demo-row">
      <div style="flex: 1; min-width: 300px;">
        <div class="ux-chart ux-chart--md ux-chart--bordered"
             x-data="uxChart({
               type: 'line',
               data: {
                 labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                 datasets: [{
                   label: 'Ventas 2024',
                   data: [12, 19, 15, 25, 22, 30]
                 }]
               }
             })">
          <canvas></canvas>
        </div>
      </div>

      <div style="flex: 1; min-width: 300px;">
        <div class="ux-chart ux-chart--md ux-chart--bordered"
             x-data="uxChart({
               type: 'bar',
               data: {
                 labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie'],
                 datasets: [{
                   label: 'Pedidos',
                   data: [45, 62, 38, 55, 70]
                 }]
               }
             })">
          <canvas></canvas>
        </div>
      </div>
    </div>

    <pre class="ux-code-block" data-lang="html"><!-- Grafico de lineas -->
<div class="ux-chart ux-chart--md ux-chart--bordered"
     x-data="uxChart({
       type: 'line',
       data: {
         labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
         datasets: [{
           label: 'Ventas 2024',
           data: [12, 19, 15, 25, 22, 30]
         }]
       }
     })">
  <canvas></canvas>
</div></pre>
  </div>

  <!-- Multiple Datasets -->
  <div class="demo-section">
    <h3>Multiples Series</h3>
    <p>Los colores se asignan automaticamente desde la paleta UX.</p>

    <ux-playground src="examples/chart/multiples-series.html"></ux-playground>
      <div class="demo-row">
      <div style="flex: 1; min-width: 400px;">
        <div class="ux-chart ux-chart--lg ux-chart--bordered ux-chart--padded"
             x-data="uxChart({
               type: 'line',
               data: {
                 labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                 datasets: [
                   { label: 'Producto A', data: [12, 19, 15, 25, 22, 30] },
                   { label: 'Producto B', data: [8, 15, 20, 18, 25, 28] },
                   { label: 'Producto C', data: [5, 10, 12, 15, 18, 22] }
                 ]
               },
               options: {
                 plugins: { legend: { position: 'bottom' } }
               }
             })">
          <canvas></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart Types -->
  <div class="demo-section">
    <h3>Tipos de Graficos</h3>

    <ux-playground src="examples/chart/tipos-de-graficos.html"></ux-playground>
      <div class="demo-row">
      <div style="flex: 1; min-width: 250px;">
        <h4>Doughnut</h4>
        <div class="ux-chart ux-chart--md ux-chart--bordered"
             x-data="uxChart({
               type: 'doughnut',
               data: {
                 labels: ['Rojo', 'Azul', 'Verde'],
                 datasets: [{ data: [30, 50, 20] }]
               }
             })">
          <canvas></canvas>
        </div>
      </div>

      <div style="flex: 1; min-width: 250px;">
        <h4>Pie</h4>
        <div class="ux-chart ux-chart--md ux-chart--bordered"
             x-data="uxChart({
               type: 'pie',
               data: {
                 labels: ['Desktop', 'Mobile', 'Tablet'],
                 datasets: [{ data: [55, 35, 10] }]
               }
             })">
          <canvas></canvas>
        </div>
      </div>

      <div style="flex: 1; min-width: 250px;">
        <h4>Radar</h4>
        <div class="ux-chart ux-chart--md ux-chart--bordered"
             x-data="uxChart({
               type: 'radar',
               data: {
                 labels: ['Ventas', 'Marketing', 'Dev', 'Soporte', 'Admin'],
                 datasets: [{ label: 'Equipo A', data: [65, 59, 90, 81, 56] }]
               }
             })">
          <canvas></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- HTMX Integration -->
  <div class="demo-section">
    <h3>HTMX: Cargar Datos del Servidor</h3>
    <p>El servidor devuelve un <code>&lt;script type="application/json"&gt;</code> con la config del chart.</p>

    <ux-playground src="examples/chart/htmx-cargar-datos-del-servidor.html"></ux-playground>
      <div class="demo-row">
      <div style="flex: 1; min-width: 400px;">
        <div class="ux-segment" style="margin-bottom: var(--ux-space-md);">
          <button class="ux-segment__button ux-segment__button--active"
                  hx-get="/api/chart/ventas?period=7d"
                  hx-target="#htmx-chart"
                  hx-swap="innerHTML">7 dias</button>
          <button class="ux-segment__button"
                  hx-get="/api/chart/ventas?period=30d"
                  hx-target="#htmx-chart"
                  hx-swap="innerHTML">30 dias</button>
          <button class="ux-segment__button"
                  hx-get="/api/chart/ventas?period=90d"
                  hx-target="#htmx-chart"
                  hx-swap="innerHTML">90 dias</button>
        </div>

        <div id="htmx-chart"
             class="ux-chart ux-chart--lg ux-chart--bordered"
             x-data="uxChart({
               type: 'line',
               data: {
                 labels: ['L', 'M', 'X', 'J', 'V', 'S', 'D'],
                 datasets: [{ label: 'Ventas', data: [120, 150, 180, 140, 200, 220, 190] }]
               }
             })">
          <canvas></canvas>
        </div>
      </div>
    </div>

    <h4>Respuesta del Servidor (Django)</h4>
    <pre class="ux-code-block" data-lang="python"># views.py
def chart_ventas(request):
    period = request.GET.get('period', '7d')
    # Obtener datos segun periodo...
    data = get_sales_data(period)

    config = {
        'type': 'line',
        'data': {
            'labels': data['labels'],
            'datasets': [{
                'label': 'Ventas',
                'data': data['values']
            }]
        }
    }

    # Devolver JSON dentro de script tag
    html = f'''
    <script type="application/json">{json.dumps(config)}</script>
    <canvas></canvas>
    '''
    return HttpResponse(html)</pre>

    <h4>Template Django</h4>
    <pre class="ux-code-block" data-lang="html"><!-- Contenedor con HTMX -->
<div id="chart"
     class="ux-chart ux-chart--lg"
     x-data="uxChart()"
     hx-get="{% url 'chart_ventas' %}"
     hx-trigger="load">
  <canvas></canvas>
</div>

<!-- Botones para cambiar periodo -->
<button hx-get="{% url 'chart_ventas' %}?period=7d"
        hx-target="#chart">7 dias</button>
<button hx-get="{% url 'chart_ventas' %}?period=30d"
        hx-target="#chart">30 dias</button></pre>
  </div>

  <!-- Alpine Reactivity -->
  <div class="demo-section">
    <h3>Alpine.js: Actualizar Datos Reactivamente</h3>
    <p>Usa <code>updateData()</code> para actualizar sin recargar el grafico completo.</p>

    <ux-playground src="examples/chart/alpinejs-actualizar-datos-reactivamente.html"></ux-playground>
      <div class="demo-row">
      <div style="flex: 1; min-width: 400px;">
        <div x-data="{
          chartRef: null,
          addPoint() {
            const newValue = Math.floor(Math.random() * 50) + 10;
            const labels = this.chartRef.chart.data.labels;
            const data = this.chartRef.chart.data.datasets[0].data;
            labels.push('T' + (labels.length + 1));
            data.push(newValue);
            if (labels.length > 10) {
              labels.shift();
              data.shift();
            }
            this.chartRef.chart.update();
          }
        }">
          <button class="ux-button ux-color-primary" @click="addPoint()" style="margin-bottom: var(--ux-space-md);">
            Agregar Punto
          </button>

          <div class="ux-chart ux-chart--md ux-chart--bordered"
               x-data="uxChart({
                 type: 'line',
                 data: {
                   labels: ['T1', 'T2', 'T3', 'T4', 'T5'],
                   datasets: [{ label: 'Tiempo Real', data: [20, 35, 25, 40, 30] }]
                 },
                 options: { animation: { duration: 300 } }
               })"
               x-init="$nextTick(() => chartRef = $data)">
            <canvas></canvas>
          </div>
        </div>
      </div>
    </div>

    <pre class="ux-code-block" data-lang="html"><div x-data="{ chartRef: null }">
  <button @click="chartRef.updateData({
    labels: [...newLabels],
    datasets: [{ data: [...newData] }]
  })">Actualizar</button>

  <div class="ux-chart ux-chart--md"
       x-data="uxChart({ type: 'line', data: {...} })"
       x-init="chartRef = $data">
    <canvas></canvas>
  </div>
</div></pre>
  </div>

  <!-- HTMX Polling -->
  <div class="demo-section">
    <h3>HTMX: Polling (Tiempo Real)</h3>
    <p>Actualizar el grafico automaticamente cada N segundos.</p>

    <pre class="ux-code-block" data-lang="html"><!-- Polling cada 5 segundos -->
<div class="ux-chart ux-chart--lg"
     x-data="uxChart()"
     hx-get="/api/chart/realtime"
     hx-trigger="load, every 5s"
     hx-swap="innerHTML">
  <canvas></canvas>
</div></pre>

    <h4>Respuesta del Servidor</h4>
    <pre class="ux-code-block" data-lang="python"># El servidor devuelve canvas + JSON config
def chart_realtime(request):
    data = get_realtime_data()
    config = {
        'type': 'line',
        'data': {
            'labels': data['timestamps'],
            'datasets': [{'label': 'CPU', 'data': data['cpu']}]
        },
        'options': {'animation': False}  # Sin animacion para polling
    }
    return HttpResponse(f'''
        <script type="application/json">{json.dumps(config)}</script>
        <canvas></canvas>
    ''')</pre>
  </div>

  <!-- SVG Support -->
  <div class="demo-section">
    <h3>SVG Externos (matplotlib)</h3>
    <p>Usa <code>.ux-chart--svg</code> para cargar graficos SVG con tematizacion automatica.</p>

    <ux-playground src="examples/chart/svg-externos-matplotlib.html"></ux-playground>
      <div class="demo-row">
      <div style="flex: 1; min-width: 300px;">
        <div class="ux-chart ux-chart--svg ux-chart--bordered" x-data="uxChart()">
          <svg viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg">
            <rect class="background" width="400" height="200" fill="#ffffff"/>
            <path fill="none" stroke="#1f77b4" stroke-width="2" d="M40,150 L100,120 L160,140 L220,80 L280,100 L340,60"/>
            <g class="tick">
              <text x="40" y="180" fill="#666666">Ene</text>
              <text x="160" y="180" fill="#666666">Mar</text>
              <text x="280" y="180" fill="#666666">May</text>
            </g>
          </svg>
        </div>
      </div>
    </div>

    <pre class="ux-code-block" data-lang="html"><!-- SVG de matplotlib con HTMX -->
<div class="ux-chart ux-chart--svg ux-chart--bordered"
     x-data="uxChart()"
     hx-get="/api/chart/matplotlib"
     hx-trigger="load">
</div></pre>

    <h4>Django + Matplotlib</h4>
    <pre class="ux-code-block" data-lang="python">import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
from io import StringIO

def chart_matplotlib(request):
    fig, ax = plt.subplots(figsize=(8, 4))
    ax.plot([1, 2, 3, 4], [10, 20, 15, 25])
    ax.set_facecolor('none')
    fig.patch.set_alpha(0)

    buffer = StringIO()
    fig.savefig(buffer, format='svg', transparent=True)
    plt.close(fig)

    return HttpResponse(buffer.getvalue(), content_type='image/svg+xml')</pre>
  </div>

  <!-- UX.chart helpers -->
  <div class="demo-section">
    <h3>Helpers: UX.chart</h3>
    <p>Funciones utiles para usar Chart.js con colores UX fuera del componente Alpine.</p>

    <pre class="ux-code-block" data-lang="javascript">// Obtener paleta de colores del tema actual
const colors = UX.chart.getColors();
// { colors: [...], text: '...', grid: '...', background: '...' }

// Obtener defaults para Chart.js
const defaults = UX.chart.getDefaults();
// { responsive: true, plugins: {...}, scales: {...} }

// Crear chart manualmente con colores UX
const ctx = document.getElementById('myChart');
const colors = UX.chart.getColors();

new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ['A', 'B', 'C'],
    datasets: [{
      data: [10, 20, 30],
      backgroundColor: colors.colors.slice(0, 3)
    }]
  },
  options: UX.chart.getDefaults()
});</pre>
  </div>

  <!-- CSS Classes -->
  <div class="demo-section">
    <h3>Clases CSS</h3>
    <table class="ux-table">
      <thead>
        <tr>
          <th>Clase</th>
          <th>Descripcion</th>
        </tr>
      </thead>
      <tbody>
        <tr><td><code>.ux-chart</code></td><td>Contenedor principal</td></tr>
        <tr><td><code>.ux-chart--bordered</code></td><td>Borde alrededor</td></tr>
        <tr><td><code>.ux-chart--padded</code></td><td>Padding interno</td></tr>
        <tr><td><code>.ux-chart--sm</code></td><td>Altura 200px</td></tr>
        <tr><td><code>.ux-chart--md</code></td><td>Altura 300px</td></tr>
        <tr><td><code>.ux-chart--lg</code></td><td>Altura 400px</td></tr>
        <tr><td><code>.ux-chart--xl</code></td><td>Altura 500px</td></tr>
        <tr><td><code>.ux-chart--svg</code></td><td>Para SVG externos (matplotlib)</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Alpine Methods -->
  <div class="demo-section">
    <h3>Metodos Alpine.js</h3>
    <table class="ux-table">
      <thead>
        <tr>
          <th>Metodo</th>
          <th>Descripcion</th>
        </tr>
      </thead>
      <tbody>
        <tr><td><code>updateData(data)</code></td><td>Actualiza labels/datasets sin recrear chart</td></tr>
        <tr><td><code>setConfig(config)</code></td><td>Reemplaza config completa (type, data, options)</td></tr>
        <tr><td><code>destroy()</code></td><td>Destruye la instancia de Chart.js</td></tr>
        <tr><td><code>chart</code></td><td>Referencia a la instancia Chart.js</td></tr>
      </tbody>
    </table>

    <h4>Eventos</h4>
    <table class="ux-table">
      <thead>
        <tr>
          <th>Evento</th>
          <th>Descripcion</th>
        </tr>
      </thead>
      <tbody>
        <tr><td><code>chart:ready</code></td><td>Chart inicializado</td></tr>
        <tr><td><code>chart:updated</code></td><td>Datos actualizados</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Dependencies -->
  <div class="demo-section">
    <h3>Dependencias</h3>
    <pre class="ux-code-block" data-lang="html"><!-- Chart.js (requerido) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<!-- HTMX (opcional, para carga dinamica) -->
<script src="https://unpkg.com/htmx.org@2.0.4"></script>

<!-- Alpine.js (requerido para x-data) -->
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

<!-- UX -->
<script src="ux-core.js"></script>
<script src="ux-chart.js"></script></pre>
  </div>