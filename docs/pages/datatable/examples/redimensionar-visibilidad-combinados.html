<div x-data="uxDatatable({
  columns: [
    { key: 'id', label: 'ID', type: 'number', sortable: true, width: 60 },
    { key: 'product', label: 'Producto', sortable: true, width: 180 },
    { key: 'sku', label: 'SKU', width: 100 },
    { key: 'category', label: 'Categoria', sortable: true, width: 120 },
    { key: 'price', label: 'Precio', type: 'number', sortable: true, width: 100 },
    { key: 'stock', label: 'Stock', type: 'number', sortable: true, width: 80 },
    { key: 'supplier', label: 'Proveedor', width: 150 }
  ],
  rows: [
    { id: 1, product: 'Laptop Pro 15', sku: 'LP-15-001', category: 'Electronica', price: 1299.99, stock: 45, supplier: 'Tech Corp' },
    { id: 2, product: 'Mouse Wireless', sku: 'MW-001', category: 'Accesorios', price: 29.99, stock: 120, supplier: 'Peripherals Inc' },
    { id: 3, product: 'Teclado Mecanico', sku: 'KM-RGB-01', category: 'Accesorios', price: 89.99, stock: 78, supplier: 'Peripherals Inc' },
    { id: 4, product: 'Monitor 27 pulgadas 4K', sku: 'MN-27-4K', category: 'Electronica', price: 499.99, stock: 23, supplier: 'Display Tech' },
    { id: 5, product: 'Webcam HD', sku: 'WC-HD-01', category: 'Accesorios', price: 59.99, stock: 95, supplier: 'Video Systems' },
    { id: 6, product: 'SSD 1TB NVMe', sku: 'SSD-1TB', category: 'Almacenamiento', price: 129.99, stock: 67, supplier: 'Storage Pro' }
  ],
  resizable: true,
  minColumnWidth: 50,
  hiddenColumns: ['sku', 'supplier'],
  selectable: true,
  paginated: false
})" class="ux-datatable ux-datatable--bordered ux-datatable--resizable ux-datatable--responsive"
   @click.outside="closeColumnMenu(); closeExportMenu()">

  <!-- Header -->
  <div class="ux-datatable__header">
    <div>
      <h3 class="ux-datatable__title">Inventario de Productos</h3>
      <p class="ux-datatable__subtitle" x-text="selectedRows.length > 0 ? selectedRows.length + ' seleccionados' : rows.length + ' productos'"></p>
    </div>
    <div class="ux-datatable__actions">
      <!-- Column Visibility Toggle -->
      <div class="ux-datatable__column-toggle">
        <button type="button" class="ux-datatable__column-btn" @click="toggleColumnMenu()">
          <span x-html="getIcon('columns')"></span>
          Columnas
          <template x-if="hiddenColumnsCount > 0">
            <span class="ux-datatable__column-btn-badge" x-text="hiddenColumnsCount"></span>
          </template>
        </button>
        <div class="ux-datatable__column-menu" :class="{ 'ux-datatable__column-menu--open': showColumnMenu }">
          <div class="ux-datatable__column-menu-header">
            <span class="ux-datatable__column-menu-title">Columnas</span>
            <div class="ux-datatable__column-menu-actions">
              <button type="button" class="ux-datatable__column-menu-action" @click="showAllColumns()">Mostrar</button>
              <button type="button" class="ux-datatable__column-menu-action" @click="hideAllColumns()">Ocultar</button>
            </div>
          </div>
          <div class="ux-datatable__column-list">
            <template x-for="col in columns" :key="col.key">
              <label class="ux-datatable__column-item">
                <input type="checkbox"
                       class="ux-checkbox"
                       :checked="isColumnVisible(col)"
                       :disabled="!canHideColumn(col) && isColumnVisible(col)"
                       @change="toggleColumnVisibility(col)">
                <span class="ux-datatable__column-item-label" x-text="col.label"></span>
              </label>
            </template>
          </div>
        </div>
      </div>

      <!-- Export Menu -->
      <div class="ux-datatable__export">
        <button type="button" class="ux-datatable__export-btn" @click="toggleExportMenu()">
          <span x-html="getIcon('download')"></span>
          Exportar
        </button>
        <div class="ux-datatable__export-menu" :class="{ 'ux-datatable__export-menu--open': exportMenuOpen }">
          <button type="button" class="ux-datatable__export-item" @click="exportToCSV({ filename: 'inventario' })">
            <span x-html="getIcon('csv')"></span>
            <span class="ux-datatable__export-item-text">CSV</span>
          </button>
          <button type="button" class="ux-datatable__export-item" @click="exportToExcel({ filename: 'inventario' })">
            <span x-html="getIcon('excel')"></span>
            <span class="ux-datatable__export-item-text">Excel</span>
          </button>
        </div>
      </div>

      <button type="button" class="ux-button ux-button--outline ux-button--sm"
              @click="resetAllColumnWidths()"
              :disabled="Object.keys(columnWidths).length === 0">
        Reset anchos
      </button>
    </div>
  </div>

  <!-- Table Body -->
  <div class="ux-datatable__body">
    <table class="ux-datatable__table">
      <thead class="ux-datatable__thead">
        <tr>
          <th class="ux-datatable__th ux-datatable__th--checkbox">
            <input type="checkbox" class="ux-checkbox" x-model="selectAll" @change="toggleSelectAll()">
          </th>
          <template x-for="col in columns" :key="col.key">
            <th class="ux-datatable__th"
                x-show="isColumnVisible(col)"
                :class="{
                  'ux-datatable__th--sortable': col.sortable,
                  'ux-datatable__th--sorted': isSorted(col),
                  'ux-datatable__th--sorted-desc': isSorted(col) && sortDirection === 'desc',
                  'ux-datatable__th--resizing': isColumnResizing(col)
                }"
                :style="{ width: getColumnWidth(col) }"
                @click="sortBy(col)">
              <span x-text="col.label"></span>
              <span x-show="col.sortable" class="ux-datatable__sort-icon">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 5v14M5 12l7-7 7 7"/>
                </svg>
              </span>
              <!-- Resize Handle -->
              <div class="ux-datatable__resize-handle"
                   :class="{ 'ux-datatable__resize-handle--active': isColumnResizing(col) }"
                   @mousedown.stop="startResize(col, $event)"
                   @touchstart.stop="startResize(col, $event)"></div>
            </th>
          </template>
        </tr>
      </thead>
      <tbody class="ux-datatable__tbody">
        <template x-for="row in paginatedRows" :key="getRowId(row)">
          <tr class="ux-datatable__tr" :class="{ 'ux-datatable__tr--selected': isRowSelected(row) }">
            <td class="ux-datatable__td ux-datatable__td--checkbox" data-label="">
              <input type="checkbox" class="ux-checkbox" :checked="isRowSelected(row)" @change="toggleRowSelection(row)">
            </td>
            <template x-for="col in columns" :key="col.key">
              <td class="ux-datatable__td"
                  x-show="isColumnVisible(col)"
                  :data-label="col.label">
                <template x-if="col.key === 'price'">
                  <strong x-text="'$' + row.price.toFixed(2)"></strong>
                </template>
                <template x-if="col.key === 'stock'">
                  <span class="ux-badge"
                        :class="row.stock > 50 ? 'ux-color-success' : row.stock > 20 ? 'ux-color-warning' : 'ux-color-danger'"
                        x-text="row.stock"></span>
                </template>
                <template x-if="col.key !== 'price' && col.key !== 'stock'">
                  <span x-text="formatCellValue(row, col)"></span>
                </template>
              </td>
            </template>
          </tr>
        </template>
      </tbody>
    </table>
  </div>

  <!-- Footer -->
  <div class="ux-datatable__footer">
    <div class="ux-datatable__info">
      <span class="ux-text-sm ux-text-secondary">
        <span x-text="visibleColumns.length"></span>/<span x-text="columns.length"></span> columnas
      </span>
    </div>
  </div>
</div>
