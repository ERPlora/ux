<!-- Basic Gantt Chart -->
<section class="component-section">
  <h3>Basic Gantt Chart</h3>
  <p>Interactive Gantt chart with task list, timeline, and progress tracking.</p>

  <ux-playground src="examples/gantt/basico.html"></ux-playground>
</section>

<!-- Grouped Tasks -->
<section class="component-section">
  <h3>Grouped Tasks with Dependencies</h3>
  <p>Hierarchical tasks with parent-child relationships and task dependencies.</p>

  <ux-playground src="examples/gantt/tareas-agrupadas.html"></ux-playground>
</section>

<!-- Compact Mode -->
<section class="component-section">
  <h3>Compact Mode</h3>
  <p>Denser layout for viewing more tasks at once.</p>

  <ux-playground src="examples/gantt/modo-compacto.html"></ux-playground>
</section>

<!-- Color Categories -->
<section class="component-section">
  <h3>Color Coding by Category</h3>
  <p>Tasks can be color-coded by status or custom categories.</p>

  <ux-playground src="examples/gantt/colores-categoria.html"></ux-playground>
</section>

<!-- CSS Classes Reference -->
<section class="component-section">
  <h3>CSS Classes</h3>
  <div class="demo-box">
    <pre class="ux-code-block" data-lang="css">/* Container */
.ux-gantt                     // Base container
.ux-gantt--compact            // Compact/dense layout
.ux-gantt--readonly           // Read-only mode (no drag)
.ux-gantt--bordered           // Visible border
.ux-gantt--glass              // Glass morphism variant

/* Toolbar */
.ux-gantt__toolbar            // Top toolbar
.ux-gantt__toolbar-start      // Left section
.ux-gantt__toolbar-end        // Right section
.ux-gantt__title              // Chart title
.ux-gantt__zoom-controls      // Zoom button group
.ux-gantt__zoom-btn           // Zoom button
.ux-gantt__zoom-btn--active   // Active zoom level
.ux-gantt__nav-btn            // Navigation button
.ux-gantt__today-btn          // Go to today button

/* Task Panel */
.ux-gantt__tasks              // Task list panel
.ux-gantt__tasks-header       // Task list header
.ux-gantt__tasks-body         // Task list body
.ux-gantt__task-row           // Individual task row
.ux-gantt__task-row--selected // Selected task
.ux-gantt__task-row--group    // Group task row
.ux-gantt__task-indent        // Indentation for hierarchy
.ux-gantt__task-expand        // Expand/collapse button
.ux-gantt__task-expand--expanded // Expanded state
.ux-gantt__task-name          // Task name text
.ux-gantt__resizer            // Panel resize handle

/* Chart Area */
.ux-gantt__chart              // Chart container
.ux-gantt__chart-scroll       // Scrollable area
.ux-gantt__chart-inner        // Inner container

/* Timeline Header */
.ux-gantt__header             // Timeline header
.ux-gantt__header-row         // Header row
.ux-gantt__header-row--primary // Primary row (months/years)
.ux-gantt__header-cell        // Header cell
.ux-gantt__header-cell--primary // Primary cell
.ux-gantt__header-cell--today // Today cell
.ux-gantt__header-cell--weekend // Weekend cell

/* Task Bars */
.ux-gantt__bars               // Bars container
.ux-gantt__bar-row            // Bar row
.ux-gantt__bar                // Task bar
.ux-gantt__bar--selected      // Selected bar
.ux-gantt__bar--dragging      // Being dragged
.ux-gantt__bar--group         // Group bar
.ux-gantt__bar--not-started   // Not started status
.ux-gantt__bar--in-progress   // In progress status
.ux-gantt__bar--completed     // Completed status
.ux-gantt__bar--delayed       // Delayed status
.ux-gantt__bar--on-hold       // On hold status
.ux-gantt__bar--category-*    // Category colors
.ux-gantt__bar-progress       // Progress fill
.ux-gantt__bar-label          // Bar label text
.ux-gantt__bar-handle         // Resize handle
.ux-gantt__bar-handle--start  // Left handle
.ux-gantt__bar-handle--end    // Right handle

/* Milestones */
.ux-gantt__milestone          // Milestone marker
.ux-gantt__milestone--completed // Completed milestone
.ux-gantt__milestone--delayed // Delayed milestone

/* Dependencies */
.ux-gantt__dependencies       // SVG container
.ux-gantt__dependency         // Dependency line
.ux-gantt__dependency-arrow   // Arrow head

/* Today Line */
.ux-gantt__today-line         // Today indicator

/* Tooltip */
.ux-gantt__tooltip            // Tooltip container
.ux-gantt__tooltip--visible   // Visible state
.ux-gantt__tooltip-title      // Task name
.ux-gantt__tooltip-dates      // Date range
.ux-gantt__tooltip-progress   // Progress indicator

/* Empty State */
.ux-gantt__empty              // Empty container
.ux-gantt__empty-icon         // Empty icon
.ux-gantt__empty-title        // Empty title
.ux-gantt__empty-text         // Empty description</pre>
  </div>
</section>

<!-- Alpine Component API -->
<section class="component-section">
  <h3>Alpine.js Component API</h3>
  <div class="demo-box">
    <pre class="ux-code-block" data-lang="javascript">// Configuration
uxGantt({
  // Data
  tasks: [],                    // Array of task objects

  // View settings
  zoom: 'week',                 // 'day', 'week', 'month'
  startDate: null,              // Start date (auto-calculated if null)
  endDate: null,                // End date (auto-calculated if null)
  taskPanelWidth: 280,          // Initial task panel width

  // Options
  readonly: false,              // Disable editing
  showToday: true,              // Show today line
  showWeekends: true,           // Show weekend columns
  showDependencies: true,       // Show dependency arrows
  showProgress: true,           // Show progress bars
  highlightWeekends: true,      // Highlight weekend columns

  // Expanded groups (for hierarchical tasks)
  expandedGroups: [],           // Array of expanded group IDs

  // Labels (for i18n)
  labels: {
    tasks: 'Tasks',
    day: 'Day',
    week: 'Week',
    month: 'Month',
    today: 'Today',
    noTasks: 'No tasks',
    noTasksDesc: 'Add tasks to see them on the Gantt chart.'
  }
})

// Task object structure
{
  id: 'unique-id',              // Required: unique identifier
  name: 'Task Name',            // Required: display name
  start: '2025-01-15',          // Start date (YYYY-MM-DD)
  end: '2025-01-20',            // End date (YYYY-MM-DD)
  progress: 50,                 // Progress percentage (0-100)
  status: 'in-progress',        // Status: 'not-started', 'in-progress', 'completed', 'delayed', 'on-hold'
  category: 'development',      // Category for color coding
  type: 'task',                 // Type: 'task', 'milestone', 'group'
  date: '2025-01-25',           // For milestones only
  dependencies: ['task-1'],     // Array of dependency task IDs
  children: []                  // Nested tasks (for groups)
}

// Properties (read-only)
flattenedTasks                  // Flattened task array with hierarchy info
timelineDates                   // Array of timeline dates
chartWidth                      // Total chart width in pixels
cellWidth                       // Width per cell based on zoom
todayPosition                   // X position of today line

// Methods
setZoom(level)                  // Set zoom level
scrollToToday()                 // Scroll chart to today
scrollToStart()                 // Scroll to start
scrollToEnd()                   // Scroll to end
navigate(direction)             // 'prev' or 'next'
toggleGroup(taskId)             // Expand/collapse group
selectTask(task)                // Select a task
showTooltip(task, event)        // Show task tooltip
hideTooltip()                   // Hide tooltip
formatDate(dateStr)             // Format date string

// Events
@gantt:zoom                     // { zoom } - Zoom level changed
@gantt:select                   // { task } - Task selected
@gantt:toggle-group             // { taskId, expanded } - Group toggled
@gantt:task-update              // { task } - Task dates changed (drag)</pre>
  </div>
</section>

<!-- HTMX Integration -->
<section class="component-section">
  <h3>HTMX + Django Integration</h3>
  <p>Load tasks dynamically and handle updates via HTMX.</p>

  <pre class="ux-code-block" data-lang="html">&lt;!-- Load tasks on page load --&gt;
&lt;div x-data="uxGantt({ tasks: [] })"
     hx-get="/api/projects/1/tasks/"
     hx-trigger="load"
     hx-target="this"
     hx-swap="none"
     @htmx:after-request="tasks = $event.detail.xhr.response"&gt;
  ...
&lt;/div&gt;

&lt;!-- Handle task updates --&gt;
&lt;div x-data="uxGantt({...})"
     @gantt:task-update="
       fetch('/api/tasks/' + $event.detail.task.id + '/', {
         method: 'PATCH',
         headers: {'Content-Type': 'application/json'},
         body: JSON.stringify({
           start: $event.detail.task.start,
           end: $event.detail.task.end
         })
       })
     "&gt;
  ...
&lt;/div&gt;</pre>

  <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Django Model</h4>
  <pre class="ux-code-block" data-lang="python"># models.py
from django.db import models

class Project(models.Model):
    name = models.CharField(max_length=200)
    start_date = models.DateField()
    end_date = models.DateField()

class Task(models.Model):
    STATUS_CHOICES = [
        ('not-started', 'Not Started'),
        ('in-progress', 'In Progress'),
        ('completed', 'Completed'),
        ('delayed', 'Delayed'),
        ('on-hold', 'On Hold'),
    ]

    TYPE_CHOICES = [
        ('task', 'Task'),
        ('milestone', 'Milestone'),
        ('group', 'Group'),
    ]

    project = models.ForeignKey(Project, on_delete=models.CASCADE, related_name='tasks')
    parent = models.ForeignKey('self', null=True, blank=True, on_delete=models.CASCADE, related_name='children')
    name = models.CharField(max_length=200)
    start_date = models.DateField(null=True, blank=True)
    end_date = models.DateField(null=True, blank=True)
    milestone_date = models.DateField(null=True, blank=True)  # For milestones
    progress = models.IntegerField(default=0)
    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='not-started')
    task_type = models.CharField(max_length=20, choices=TYPE_CHOICES, default='task')
    category = models.CharField(max_length=50, blank=True)
    order = models.IntegerField(default=0)

    class Meta:
        ordering = ['order', 'start_date']

    def to_gantt_dict(self):
        data = {
            'id': self.id,
            'name': self.name,
            'status': self.status,
            'type': self.task_type,
            'progress': self.progress,
            'category': self.category,
        }

        if self.task_type == 'milestone':
            data['date'] = self.milestone_date.isoformat() if self.milestone_date else None
        else:
            data['start'] = self.start_date.isoformat() if self.start_date else None
            data['end'] = self.end_date.isoformat() if self.end_date else None

        # Include children for groups
        if self.task_type == 'group':
            data['children'] = [child.to_gantt_dict() for child in self.children.all()]

        return data


class TaskDependency(models.Model):
    task = models.ForeignKey(Task, on_delete=models.CASCADE, related_name='dependencies')
    depends_on = models.ForeignKey(Task, on_delete=models.CASCADE, related_name='dependents')</pre>

  <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Django View</h4>
  <pre class="ux-code-block" data-lang="python"># views.py
from django.http import JsonResponse
from django.shortcuts import get_object_or_404
from .models import Project, Task

def project_tasks_api(request, project_id):
    project = get_object_or_404(Project, id=project_id)

    # Get top-level tasks (no parent)
    tasks = project.tasks.filter(parent__isnull=True)

    gantt_data = []
    for task in tasks:
        task_dict = task.to_gantt_dict()

        # Add dependencies
        deps = task.dependencies.values_list('depends_on_id', flat=True)
        if deps:
            task_dict['dependencies'] = list(deps)

        gantt_data.append(task_dict)

    return JsonResponse(gantt_data, safe=False)

def update_task_api(request, task_id):
    if request.method != 'PATCH':
        return JsonResponse({'error': 'Method not allowed'}, status=405)

    task = get_object_or_404(Task, id=task_id)

    import json
    data = json.loads(request.body)

    if 'start' in data:
        task.start_date = data['start']
    if 'end' in data:
        task.end_date = data['end']
    if 'progress' in data:
        task.progress = data['progress']
    if 'status' in data:
        task.status = data['status']

    task.save()

    return JsonResponse({'success': True, 'task': task.to_gantt_dict()})</pre>

  <h4 style="margin-top: var(--ux-space-lg); margin-bottom: var(--ux-space-sm);">Django URLs</h4>
  <pre class="ux-code-block" data-lang="python"># urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('api/projects/<int:project_id>/tasks/', views.project_tasks_api, name='project_tasks_api'),
    path('api/tasks/<int:task_id>/', views.update_task_api, name='update_task_api'),
]</pre>
</section>
