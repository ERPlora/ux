# views.py
from django.shortcuts import render
from django.http import HttpResponse
from datetime import datetime
from .models import Report

def reports_list(request):
    reports = Report.objects.all()

    # Filtrar por rango de fechas
    start_date = request.GET.get('start_date')
    end_date = request.GET.get('end_date')

    if start_date and end_date:
        start = datetime.strptime(start_date, '%Y-%m-%d')
        end = datetime.strptime(end_date, '%Y-%m-%d')
        reports = reports.filter(created_at__date__range=[start, end])

    # Si es peticion HTMX, devolver solo la tabla
    if request.headers.get('HX-Request'):
        return render(request, 'partials/reports_table.html', {
            'reports': reports
        })

    return render(request, 'reports/list.html', {
        'reports': reports
    })
