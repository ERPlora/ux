# views.py
from django.http import HttpResponse
from django.views.decorators.http import require_POST
from decimal import Decimal
import requests

# Tasas de cambio (en producción usar API externa)
EXCHANGE_RATES = {
    'USD': {'EUR': Decimal('0.92'), 'GBP': Decimal('0.79'), 'MXN': Decimal('17.15')},
    'EUR': {'USD': Decimal('1.09'), 'GBP': Decimal('0.86'), 'MXN': Decimal('18.65')},
    'GBP': {'USD': Decimal('1.27'), 'EUR': Decimal('1.16'), 'MXN': Decimal('21.75')},
}

@require_POST
def convert_currency(request):
    amount = Decimal(request.POST.get('amount', '0'))
    from_currency = request.POST.get('from_currency', 'USD')
    to_currency = request.POST.get('to_currency', 'EUR')

    rate = EXCHANGE_RATES.get(from_currency, {}).get(to_currency, Decimal('1'))
    converted = amount * rate

    # Formatear con locale
    symbols = {'USD': '$', 'EUR': '€', 'GBP': '£', 'MXN': '$'}
    symbol = symbols.get(to_currency, '')

    return HttpResponse(f'''
        Resultado: <strong>{symbol}{converted:,.2f} {to_currency}</strong>
    ''')
