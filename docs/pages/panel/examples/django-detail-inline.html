<!-- templates/admin/products/detail.html -->
<div class="ux-panel-detail" x-data="uxPanelDetail()">
  <!-- Contenido principal -->
  <section class="ux-panel-detail__main ux-padding">
    <div id="product-info"
         hx-get="{% url 'admin:products-info' product.id %}"
         hx-trigger="load, productUpdated from:body">
      {% include 'admin/products/_info.html' %}
    </div>

    <!-- Historial de cambios -->
    <div class="ux-panel-card" style="margin-top: var(--ux-space-lg);">
      <div class="ux-panel-card__header">
        <div class="ux-panel-card__title">Historial</div>
      </div>
      <div class="ux-panel-card__body"
           hx-get="{% url 'admin:products-history' product.id %}"
           hx-trigger="load">
        <div class="ux-skeleton" style="height: 100px;"></div>
      </div>
    </div>
  </section>

  <!-- Aside con formulario de edicion -->
  <aside class="ux-panel-detail__aside" :class="{ 'is-open': asideOpen }">
    <div class="ux-panel-detail__aside-header">
      <span style="font-weight: 600;">Editar Producto</span>
      <button @click="closeAside()" class="ux-button ux-button--clear ux-button--icon">
        &times;
      </button>
    </div>
    <div class="ux-panel-detail__aside-content">
      <form hx-put="{% url 'admin:products-update' product.id %}"
            hx-target="#product-info"
            hx-swap="innerHTML"
            hx-on::after-request="htmx.trigger(document.body, 'productUpdated')">
        {% csrf_token %}

        <div class="ux-input" style="margin-bottom: var(--ux-space-md);">
          <input type="text" name="name" value="{{ product.name }}" required>
          <label>Nombre</label>
        </div>

        <div class="ux-input" style="margin-bottom: var(--ux-space-md);">
          <input type="number" name="price" value="{{ product.price }}" step="0.01" required>
          <label>Precio</label>
        </div>

        <div class="ux-input" style="margin-bottom: var(--ux-space-md);">
          <input type="number" name="stock" value="{{ product.stock }}" required>
          <label>Stock</label>
        </div>

        <div style="margin-bottom: var(--ux-space-md);">
          <label class="ux-toggle">
            <input type="checkbox" name="is_active" {% if product.is_active %}checked{% endif %}>
            <span class="ux-toggle__track"><span class="ux-toggle__thumb"></span></span>
            <span class="ux-toggle__label">Activo</span>
          </label>
        </div>

        <button type="submit" class="ux-button ux-color-primary" style="width: 100%;">
          Guardar Cambios
        </button>
      </form>
    </div>
  </aside>

  <div class="ux-panel-detail__backdrop" :class="{ 'is-visible': asideOpen }" @click="closeAside()"></div>
  <button class="ux-panel-detail__toggle" @click="toggleAside()">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
    </svg>
  </button>
</div>
