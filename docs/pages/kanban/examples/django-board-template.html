<!-- templates/kanban/board.html -->
{% load static %}

<div class="ux-kanban"
     hx-trigger="refreshColumn from:body"
     hx-get="{% url 'kanban_board' %}"
     hx-select=".ux-kanban"
     hx-swap="outerHTML">

  {% for column in columns %}
    <div class="ux-kanban__column"
         id="column-{{ column.id }}"
         hx-post="{% url 'kanban_move_card' %}"
         hx-trigger="drop"
         hx-vals='{"column_id": "{{ column.id }}"}'
         hx-target="#column-{{ column.id }}"
         hx-swap="outerHTML"
         @dragover.prevent
         @drop="$event.target.closest('.ux-kanban__column').dispatchEvent(new Event('drop'))">

      <div class="ux-kanban__column-header">
        <div class="ux-kanban__column-header-start">
          <div class="ux-kanban__column-color" style="background: {{ column.color }};"></div>
          <h4 class="ux-kanban__column-title">{{ column.title }}</h4>
          <span class="ux-kanban__column-count">{{ column.cards.count }}</span>
        </div>
      </div>

      <div class="ux-kanban__column-body">
        {% for card in column.cards.all %}
          {% include 'kanban/partials/card.html' with card=card %}
        {% empty %}
          <p class="ux-kanban__empty">No hay tarjetas</p>
        {% endfor %}
      </div>

      <div class="ux-kanban__column-footer">
        <button class="ux-kanban__add-btn"
                hx-post="{% url 'kanban_add_card' column.id %}"
                hx-target="#column-{{ column.id }} .ux-kanban__column-body"
                hx-swap="beforeend">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
          Agregar tarjeta
        </button>
      </div>
    </div>
  {% endfor %}
</div>
