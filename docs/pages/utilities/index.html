<style>
    .demo-section { margin-bottom: var(--ux-space-xl); }
    .demo-section h3 {
      font-size: var(--ux-font-size-lg);
      font-weight: 600;
      margin-bottom: var(--ux-space-md);
      color: var(--ux-text);
    }
    .demo-section p {
      font-size: var(--ux-font-size-md);
      color: var(--ux-text-secondary);
      margin-bottom: var(--ux-space-md);
    }
    .demo-box {
      background: var(--ux-surface);
      border-radius: var(--ux-border-radius-lg);
      padding: var(--ux-space-lg);
      margin-bottom: var(--ux-space-md);
    }
    .utility-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: var(--ux-space-md);
    }
    .utility-card {
      padding: var(--ux-space-md);
      background: var(--ux-gray-50);
      border-radius: var(--ux-radius-md);
    }
    .utility-card code {
      display: block;
      font-size: var(--ux-font-size-sm);
      color: var(--ux-primary);
      margin-bottom: var(--ux-space-xs);
    }
    .utility-card small {
      color: var(--ux-text-secondary);
    }
  </style>

<!-- Visibility Helpers -->
    <section class="component-section">
      <h3>Visibility Helpers</h3>
      <p>Clases para mostrar/ocultar elementos segun contexto.</p>

      <ux-playground src="pages/utilities/examples/visibility-helpers.html"></ux-playground>
      <div class="demo-box">
        <h4 style="margin-bottom: var(--ux-space-md);">Basicas</h4>
        <div class="utility-grid">
          <div class="utility-card">
            <code>.ux-hidden</code>
            <small>Oculta completamente (display: none)</small>
          </div>
          <div class="utility-card">
            <code>.ux-invisible</code>
            <small>Invisible pero ocupa espacio</small>
          </div>
          <div class="utility-card">
            <code>.ux-sr-only</code>
            <small>Solo visible para screen readers</small>
          </div>
        </div>
      </div>

      <ux-playground src="pages/utilities/examples/basicas.html"></ux-playground>
      <div class="demo-box">
        <h4 style="margin-bottom: var(--ux-space-md);">Responsive</h4>
        <div class="utility-grid">
          <div class="utility-card">
            <code>.ux-hidden-xs</code>
            <small>Oculto en &lt;576px</small>
          </div>
          <div class="utility-card">
            <code>.ux-hidden-sm</code>
            <small>Oculto en 576-767px</small>
          </div>
          <div class="utility-card">
            <code>.ux-hidden-md</code>
            <small>Oculto en 768-991px</small>
          </div>
          <div class="utility-card">
            <code>.ux-hidden-lg</code>
            <small>Oculto en 992-1199px</small>
          </div>
          <div class="utility-card">
            <code>.ux-hidden-xl</code>
            <small>Oculto en &gt;1200px</small>
          </div>
          <div class="utility-card">
            <code>.ux-mobile-only</code>
            <small>Solo en movil (&lt;768px)</small>
          </div>
          <div class="utility-card">
            <code>.ux-desktop-only</code>
            <small>Solo en desktop (&gt;768px)</small>
          </div>
        </div>
      </div>

      <ux-playground src="pages/utilities/examples/responsive.html"></ux-playground>
      <div class="demo-box">
        <h4 style="margin-bottom: var(--ux-space-md);">Por Capacidad</h4>
        <div class="utility-grid">
          <div class="utility-card">
            <code>.ux-touch-only</code>
            <small>Solo dispositivos tactiles</small>
          </div>
          <div class="utility-card">
            <code>.ux-no-touch</code>
            <small>Solo dispositivos con mouse</small>
          </div>
          <div class="utility-card">
            <code>.ux-dark-only</code>
            <small>Solo en modo oscuro</small>
          </div>
          <div class="utility-card">
            <code>.ux-light-only</code>
            <small>Solo en modo claro</small>
          </div>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Visible solo en movil --&gt;
&lt;button class="ux-button ux-mobile-only"&gt;Menu&lt;/button&gt;

&lt;!-- Oculto en pantallas pequenas --&gt;
&lt;nav class="ux-hidden-xs ux-hidden-sm"&gt;...&lt;/nav&gt;

&lt;!-- Solo para screen readers --&gt;
&lt;span class="ux-sr-only"&gt;Abrir menu&lt;/span&gt;</pre>
    </section>

    <!-- Print Utilities -->
    <section class="component-section">
      <h3>Print Utilities</h3>
      <p>Clases para controlar la impresion.</p>

      <ux-playground src="pages/utilities/examples/print-utilities.html"></ux-playground>
      <div class="demo-box">
        <div class="utility-grid">
          <div class="utility-card">
            <code>.ux-no-print</code>
            <small>Ocultar al imprimir</small>
          </div>
          <div class="utility-card">
            <code>.ux-print-only</code>
            <small>Mostrar solo al imprimir</small>
          </div>
          <div class="utility-card">
            <code>.ux-print-break-before</code>
            <small>Salto de pagina antes</small>
          </div>
          <div class="utility-card">
            <code>.ux-print-break-after</code>
            <small>Salto de pagina despues</small>
          </div>
          <div class="utility-card">
            <code>.ux-print-break-avoid</code>
            <small>Evitar corte dentro</small>
          </div>
          <div class="utility-card">
            <code>.ux-print-bg</code>
            <small>Preservar colores de fondo</small>
          </div>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- No imprimir navegacion --&gt;
&lt;nav class="ux-navbar ux-no-print"&gt;...&lt;/nav&gt;

&lt;!-- Nota de pie de pagina solo en impresion --&gt;
&lt;footer class="ux-print-only"&gt;Impreso desde...&lt;/footer&gt;

&lt;!-- Evitar que tabla se corte --&gt;
&lt;table class="ux-print-break-avoid"&gt;...&lt;/table&gt;</pre>
    </section>

    <!-- JavaScript Utilities -->
    <section class="component-section">
      <h3>Focus Trap</h3>
      <p>Atrapa el foco dentro de un elemento (modales, dialogs).</p>

      <ux-playground src="pages/utilities/examples/focus-trap.html"></ux-playground>
      <div class="demo-box" x-data="{ isOpen: false }">
        <button class="ux-button ux-color-primary" @click="isOpen = true">Abrir Dialog</button>

        <div x-show="isOpen"
             x-trap-focus.escape
             style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;"
             @keydown.escape="isOpen = false">
          <div style="background: var(--ux-surface); padding: var(--ux-space-xl); border-radius: var(--ux-radius-lg); max-width: 400px;">
            <h4 style="margin-bottom: var(--ux-space-md);">Dialog con Focus Trap</h4>
            <p style="margin-bottom: var(--ux-space-md);">El foco esta atrapado dentro de este dialog. Presiona Tab para navegar.</p>
            <input type="text" class="ux-input" placeholder="Input 1" style="margin-bottom: var(--ux-space-sm);">
            <input type="text" class="ux-input" placeholder="Input 2" style="margin-bottom: var(--ux-space-md);">
            <div style="display: flex; gap: var(--ux-space-sm); justify-content: flex-end;">
              <button class="ux-button ux-button--outline" @click="isOpen = false">Cancelar</button>
              <button class="ux-button ux-color-primary" @click="isOpen = false">Aceptar</button>
            </div>
          </div>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Directiva Alpine.js --&gt;
&lt;div x-trap-focus&gt;...&lt;/div&gt;
&lt;div x-trap-focus.escape&gt;...&lt;/div&gt;  &lt;!-- Desactiva con Escape --&gt;

&lt;!-- JavaScript API --&gt;
const release = UX.trapFocus(element, {
  initialFocus: '#first-input',
  returnFocus: true,
  escapeDeactivates: true
});

// Liberar trap
release();
// o
UX.releaseFocusTrap(element);</pre>
    </section>

    <!-- Click Outside -->
    <section class="component-section">
      <h3>Click Outside</h3>
      <p>Detecta clicks fuera de un elemento.</p>

      <ux-playground src="pages/utilities/examples/click-outside.html"></ux-playground>
      <div class="demo-box" x-data="{ isOpen: false }">
        <div style="position: relative; display: inline-block;">
          <button class="ux-button" @click="isOpen = !isOpen">Toggle Dropdown</button>
          <div x-show="isOpen"
               x-click-outside="isOpen = false"
               style="position: absolute; top: 100%; left: 0; margin-top: 8px; padding: var(--ux-space-md); background: var(--ux-surface); border: 1px solid var(--ux-border-color); border-radius: var(--ux-radius-md); box-shadow: var(--ux-shadow-lg); min-width: 200px;">
            <p style="margin: 0;">Click fuera para cerrar</p>
          </div>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Directiva Alpine.js --&gt;
&lt;div x-click-outside="isOpen = false"&gt;...&lt;/div&gt;

&lt;!-- JavaScript API --&gt;
const cleanup = UX.onClickOutside(element, () =&gt; {
  console.log('Clicked outside!');
}, {
  ignore: ['.ignore-me', otherElement]
});

// Remover listener
cleanup();</pre>
    </section>

    <!-- Scroll Lock -->
    <section class="component-section">
      <h3>Scroll Lock</h3>
      <p>Bloquea el scroll del body (para modales).</p>

      <ux-playground src="pages/utilities/examples/scroll-lock.html"></ux-playground>
      <div class="demo-box" x-data="{ locked: false }">
        <button class="ux-button"
                :class="locked ? 'ux-color-danger' : 'ux-color-primary'"
                @click="locked = !locked; locked ? UX.lockScroll() : UX.unlockScroll()">
          <span x-text="locked ? 'Desbloquear Scroll' : 'Bloquear Scroll'"></span>
        </button>
        <p style="margin-top: var(--ux-space-sm); color: var(--ux-text-secondary);" x-show="locked">
          El scroll esta bloqueado. Intenta hacer scroll.
        </p>
      </div>

      <pre class="ux-code-block" data-lang="javascript">// Bloquear scroll
UX.lockScroll();

// Desbloquear scroll
UX.unlockScroll();

// Forzar desbloqueo (ignora contadores)
UX.forceUnlockScroll();</pre>
    </section>

    <!-- Clipboard -->
    <section class="component-section">
      <h3>Clipboard</h3>
      <p>Copiar texto al portapapeles.</p>

      <ux-playground src="pages/utilities/examples/clipboard.html"></ux-playground>
      <div class="demo-box" x-data="{ copied: false, text: 'Texto de ejemplo para copiar' }">
        <div style="display: flex; gap: var(--ux-space-sm); align-items: center;">
          <input type="text" class="ux-input" x-model="text" style="flex: 1;">
          <button class="ux-button ux-color-primary"
                  x-clipboard="text"
                  x-clipboard.feedback
                  @clipboard:copied="copied = true; setTimeout(() => copied = false, 2000)">
            <span x-text="copied ? 'Copiado!' : 'Copiar'"></span>
          </button>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Directiva Alpine.js --&gt;
&lt;button x-clipboard="textToCopy"&gt;Copiar&lt;/button&gt;
&lt;button x-clipboard.feedback="text"&gt;Copiar&lt;/button&gt;  &lt;!-- Cambia texto a "Copied!" --&gt;

&lt;!-- Magic helper --&gt;
&lt;button @click="$clipboard.copy('Hello!')"&gt;Copiar&lt;/button&gt;

&lt;!-- JavaScript API --&gt;
await UX.copyToClipboard('Texto a copiar');
const text = await UX.readFromClipboard();</pre>
    </section>

    <!-- Debounce & Throttle -->
    <section class="component-section">
      <h3>Debounce & Throttle</h3>
      <p>Controla la frecuencia de ejecucion de funciones.</p>

      <ux-playground src="pages/utilities/examples/debounce-throttle.html"></ux-playground>
      <div class="demo-box" x-data="{ searchCount: 0, scrollCount: 0 }">
        <div style="margin-bottom: var(--ux-space-md);">
          <label style="display: block; margin-bottom: var(--ux-space-xs);">Debounce (300ms) - Busqueda:</label>
          <input type="text"
                 class="ux-input"
                 placeholder="Escribe algo..."
                 @input="$debounce(() => searchCount++, 300)()">
          <small style="color: var(--ux-text-secondary);">Busquedas ejecutadas: <span x-text="searchCount"></span></small>
        </div>
      </div>

      <pre class="ux-code-block" data-lang="javascript">// Magic helpers en Alpine.js
@input="$debounce(() => search(), 300)()"
@scroll="$throttle(() => onScroll(), 100)()"

// JavaScript API
const debouncedSearch = UX.debounce((query) => {
  fetch(`/search?q=${query}`);
}, 300, {
  leading: false,   // No ejecutar al inicio
  trailing: true    // Ejecutar al final
});

const throttledScroll = UX.throttle(() => {
  updatePosition();
}, 100, {
  leading: true,
  trailing: true
});

// Cancelar
debouncedSearch.cancel();
debouncedSearch.flush(); // Ejecutar inmediatamente</pre>
    </section>

    <!-- Print Element -->
    <section class="component-section">
      <h3>Print Element</h3>
      <p>Imprimir un elemento especifico de la pagina.</p>

      <ux-playground src="pages/utilities/examples/print-element.html"></ux-playground>
      <div class="demo-box">
        <div id="printable-content" style="padding: var(--ux-space-md); border: 1px dashed var(--ux-border-color); border-radius: var(--ux-radius-md);">
          <h4>Contenido Imprimible</h4>
          <p>Este contenido se imprimira de forma aislada.</p>
          <table style="width: 100%; border-collapse: collapse; margin-top: var(--ux-space-md);">
            <tr><th style="text-align: left; padding: 8px; border-bottom: 1px solid var(--ux-border-color);">Item</th><th style="text-align: right; padding: 8px; border-bottom: 1px solid var(--ux-border-color);">Precio</th></tr>
            <tr><td style="padding: 8px;">Producto A</td><td style="text-align: right; padding: 8px;">$100</td></tr>
            <tr><td style="padding: 8px;">Producto B</td><td style="text-align: right; padding: 8px;">$200</td></tr>
          </table>
        </div>
        <button class="ux-button ux-color-primary" style="margin-top: var(--ux-space-md);" onclick="UX.printElement('#printable-content', { title: 'Reporte' })">
          Imprimir Contenido
        </button>
      </div>

      <pre class="ux-code-block" data-lang="javascript">UX.printElement('#element-id', {
  title: 'Titulo del documento',
  styles: true,         // Incluir estilos de la pagina
  extraStyles: '...'    // CSS adicional
});

// Imprimir pagina completa
UX.print();</pre>
    </section>

    <!-- Interactive State Utilities -->
    <section class="component-section">
      <h3>State Utilities</h3>
      <p>Clases para estados interactivos.</p>

      <ux-playground src="pages/utilities/examples/state-utilities.html"></ux-playground>
      <div class="demo-box">
        <div class="utility-grid">
          <div class="utility-card">
            <code>.ux-disabled</code>
            <small>Deshabilitado (opacity + no pointer)</small>
          </div>
          <div class="utility-card">
            <code>.ux-loading</code>
            <small>Estado de carga (cursor wait)</small>
          </div>
          <div class="utility-card">
            <code>.ux-clickable</code>
            <small>Cursor pointer</small>
          </div>
          <div class="utility-card">
            <code>.ux-draggable</code>
            <small>Cursor grab</small>
          </div>
          <div class="utility-card">
            <code>.ux-select-none</code>
            <small>Texto no seleccionable</small>
          </div>
          <div class="utility-card">
            <code>.ux-select-all</code>
            <small>Seleccionar todo al click</small>
          </div>
          <div class="utility-card">
            <code>.ux-pointer-none</code>
            <small>Sin eventos de pointer</small>
          </div>
          <div class="utility-card">
            <code>.ux-focus-ring</code>
            <small>Anillo de foco visible</small>
          </div>
        </div>
      </div>
    </section>

    <!-- Overflow Utilities -->
    <section class="component-section">
      <h3>Overflow Utilities</h3>
      <p>Clases para controlar el overflow.</p>

      <ux-playground src="pages/utilities/examples/overflow-utilities.html"></ux-playground>
      <div class="demo-box">
        <div class="utility-grid">
          <div class="utility-card">
            <code>.ux-overflow-hidden</code>
            <small>Ocultar overflow</small>
          </div>
          <div class="utility-card">
            <code>.ux-overflow-auto</code>
            <small>Scroll automatico</small>
          </div>
          <div class="utility-card">
            <code>.ux-overflow-x-auto</code>
            <small>Scroll horizontal</small>
          </div>
          <div class="utility-card">
            <code>.ux-overflow-y-auto</code>
            <small>Scroll vertical</small>
          </div>
          <div class="utility-card">
            <code>.ux-scrollbar-thin</code>
            <small>Scrollbar delgado</small>
          </div>
          <div class="utility-card">
            <code>.ux-scrollbar-none</code>
            <small>Ocultar scrollbar</small>
          </div>
        </div>
      </div>
    </section>

    <!-- HTMX + Django -->
    <section class="component-section">
      <h3>HTMX + Django</h3>
      <p>Integracion de utilidades con HTMX y Django.</p>

      <ux-playground src="pages/utilities/examples/htmx-django.html"></ux-playground>
      <div class="demo-box">
        <h4 style="margin-bottom: var(--ux-space-md);">Visibilidad Condicional con HTMX</h4>
        <p style="color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md);">
          Usa clases de visibilidad para mostrar/ocultar elementos durante peticiones HTMX.
        </p>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Mostrar spinner durante carga HTMX --&gt;
&lt;button hx-get="/api/data/"
        hx-target="#result"
        hx-indicator="#loading"
        class="ux-button ux-color-primary"&gt;
  Cargar Datos
&lt;/button&gt;
&lt;div id="loading" class="htmx-indicator"&gt;
  &lt;div class="ux-spinner"&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;!-- Resultado --&gt;
&lt;div id="result"&gt;&lt;/div&gt;</pre>

      <ux-playground src="pages/utilities/examples/visibilidad-condicional-con-htmx.html"></ux-playground>
      <div class="demo-box">
        <h4 style="margin-bottom: var(--ux-space-md);">Debounce en Busqueda con HTMX</h4>
        <p style="color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md);">
          Combina debounce con HTMX para busquedas en tiempo real.
        </p>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Busqueda con debounce --&gt;
&lt;input type="search"
       name="q"
       class="ux-input"
       placeholder="Buscar..."
       hx-get="/api/search/"
       hx-trigger="input changed delay:300ms"
       hx-target="#search-results"&gt;

&lt;div id="search-results"&gt;&lt;/div&gt;</pre>

      <ux-playground src="pages/utilities/examples/debounce-en-busqueda-con-htmx.html"></ux-playground>
      <div class="demo-box">
        <h4 style="margin-bottom: var(--ux-space-md);">Vista Django</h4>
        <p style="color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md);">
          Ejemplo de vista Django que responde a peticiones HTMX.
        </p>
      </div>

      <pre class="ux-code-block" data-lang="python"># views.py
from django.shortcuts import render
from django.http import HttpResponse

def search_view(request):
    query = request.GET.get('q', '')
    results = Product.objects.filter(name__icontains=query)[:10]

    # Si es peticion HTMX, devolver solo el fragmento
    if request.headers.get('HX-Request'):
        return render(request, 'partials/search_results.html', {
            'results': results
        })

    # Peticion normal, devolver pagina completa
    return render(request, 'search.html', {
        'results': results,
        'query': query
    })</pre>

      <pre class="ux-code-block" data-lang="html">&lt;!-- partials/search_results.html --&gt;
{% for item in results %}
&lt;div class="ux-list__item"&gt;
  &lt;div class="ux-list__content"&gt;
    &lt;div class="ux-list__title"&gt;{{ item.name }}&lt;/div&gt;
    &lt;div class="ux-list__subtitle"&gt;{{ item.description }}&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
{% empty %}
&lt;div class="ux-list__item"&gt;
  &lt;span class="ux-text-secondary"&gt;No se encontraron resultados&lt;/span&gt;
&lt;/div&gt;
{% endfor %}</pre>

      <ux-playground src="pages/utilities/examples/vista-django.html"></ux-playground>
      <div class="demo-box">
        <h4 style="margin-bottom: var(--ux-space-md);">Scroll Lock con Modales HTMX</h4>
        <p style="color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md);">
          Bloquea el scroll al abrir modales cargados via HTMX.
        </p>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Boton que carga modal --&gt;
&lt;button hx-get="/modal/edit/{{ item.id }}/"
        hx-target="body"
        hx-swap="beforeend"
        class="ux-button"&gt;
  Editar
&lt;/button&gt;

&lt;!-- Template del modal (Django) --&gt;
&lt;div class="ux-modal-backdrop"
     x-data="{ init() { UX.lockScroll() } }"
     @click="UX.unlockScroll(); $el.remove()"&gt;
  &lt;div class="ux-modal" @click.stop&gt;
    &lt;div class="ux-modal__header"&gt;
      &lt;h3&gt;Editar {{ item.name }}&lt;/h3&gt;
      &lt;button @click="UX.unlockScroll(); $el.closest('.ux-modal-backdrop').remove()"&gt;
        &amp;times;
      &lt;/button&gt;
    &lt;/div&gt;
    &lt;form hx-post="/api/items/{{ item.id }}/"
          hx-swap="outerHTML"&gt;
      {% csrf_token %}
      &lt;div class="ux-modal__content"&gt;
        {{ form.as_p }}
      &lt;/div&gt;
      &lt;div class="ux-modal__footer"&gt;
        &lt;button type="submit" class="ux-button ux-color-primary"&gt;Guardar&lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>

      <ux-playground src="pages/utilities/examples/scroll-lock-con-modales-htmx.html"></ux-playground>
      <div class="demo-box">
        <h4 style="margin-bottom: var(--ux-space-md);">Clipboard con Feedback</h4>
        <p style="color: var(--ux-text-secondary); margin-bottom: var(--ux-space-md);">
          Copiar contenido dinamico generado por Django.
        </p>
      </div>

      <pre class="ux-code-block" data-lang="html">&lt;!-- Copiar URL de compartir --&gt;
&lt;div class="ux-input-group" x-data="{ copied: false }"&gt;
  &lt;input type="text"
         class="ux-input"
         value="{{ share_url }}"
         readonly
         id="share-url"&gt;
  &lt;button class="ux-button ux-color-primary"
          @click="UX.copyToClipboard('{{ share_url }}'); copied = true; setTimeout(() =&gt; copied = false, 2000)"&gt;
    &lt;span x-text="copied ? 'Copiado!' : 'Copiar'"&gt;&lt;/span&gt;
  &lt;/button&gt;
&lt;/div&gt;</pre>

    </section>