<!-- templates/calendar.html -->
<div id="calendar-container"
     x-data="uxCalendar({
       events: {{ events_json|safe }}
     })"
     @calendar:select="loadDayEvents($event.detail.date)"
     @calendar:navigate="$refs.container.dispatchEvent(
       new CustomEvent('load-month', { detail: { month: currentDate.getMonth() + 1, year: currentDate.getFullYear() } })
     )">

  <div class="ux-calendar"
       hx-get="{% url 'calendar_events' %}"
       hx-trigger="load-month from:body"
       hx-vals="js:{month: event.detail.month, year: event.detail.year}"
       hx-target="#events-data"
       hx-swap="innerHTML">

    <div class="ux-calendar__header">
      <button class="ux-calendar__nav-btn" @click="prevMonth()" x-html="icons.prev"></button>
      <span class="ux-calendar__title" x-text="currentMonthYear"></span>
      <button class="ux-calendar__nav-btn" @click="nextMonth()" x-html="icons.next"></button>
    </div>

    <div class="ux-calendar__weekdays">
      <template x-for="day in weekdays" :key="day">
        <div class="ux-calendar__weekday" x-text="day"></div>
      </template>
    </div>

    <div class="ux-calendar__days">
      <template x-for="dayObj in calendarDays" :key="dayObj.date.toISOString()">
        <button class="ux-calendar__day"
                :class="{
                  'ux-calendar__day--today': dayObj.isToday,
                  'ux-calendar__day--selected': dayObj.isSelected
                }"
                @click="selectDate(dayObj)">
          <span x-text="dayObj.day"></span>
          <div class="ux-calendar__day-events" x-show="dayObj.events.length > 0">
            <template x-for="event in dayObj.events.slice(0, 3)">
              <span class="ux-calendar__day-event"
                    :class="'ux-calendar__day-event--' + event.color"></span>
            </template>
          </div>
        </button>
      </template>
    </div>
  </div>

  <!-- Panel de eventos del dia seleccionado -->
  <div id="day-events-panel"
       hx-get="{% url 'day_events' %}"
       hx-trigger="day-selected from:body"
       hx-vals="js:{date: event.detail.date}"
       hx-target="this"
       hx-swap="innerHTML">
    <p class="ux-text-secondary">Selecciona un dia para ver sus eventos</p>
  </div>

  <!-- Container oculto para actualizar eventos via HTMX -->
  <div id="events-data" style="display: none;"></div>
</div>

<script>
function loadDayEvents(date) {
  document.body.dispatchEvent(
    new CustomEvent('day-selected', { detail: { date: date } })
  );
}
</script>
