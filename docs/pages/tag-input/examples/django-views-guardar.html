# views.py
from django.views import View
from django.http import JsonResponse
from .models import Article, Tag

class ArticleUpdateView(View):
    def post(self, request, pk):
        article = Article.objects.get(pk=pk)

        # Obtener tags del formulario
        selected_tags = request.POST.getlist('selected_tags')

        # Limpiar tags existentes
        article.tags.clear()

        for tag_value in selected_tags:
            # Si es ID numerico, es tag existente
            if tag_value.isdigit():
                tag = Tag.objects.get(pk=tag_value)
            else:
                # Crear nuevo tag
                tag, created = Tag.objects.get_or_create(
                    name=tag_value.strip()
                )
            article.tags.add(tag)

        article.save()
        return JsonResponse({'status': 'ok'})
