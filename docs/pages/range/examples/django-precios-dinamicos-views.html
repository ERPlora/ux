# views.py - Version avanzada con precios dinamicos
from django.db.models import Min, Max

def product_list_with_dynamic_range(request):
    """
    Vista con rango de precios calculado dinamicamente
    basado en los productos disponibles.
    """
    base_queryset = Product.objects.filter(is_active=True)

    # Obtener rango de precios real
    price_stats = base_queryset.aggregate(
        min_price=Min('price'),
        max_price=Max('price')
    )

    actual_min = int(price_stats['min_price'] or 0)
    actual_max = int(price_stats['max_price'] or 1000)

    # Valores seleccionados por el usuario
    price_min = request.GET.get('price_min', actual_min)
    price_max = request.GET.get('price_max', actual_max)

    # Filtrar productos
    products = base_queryset.filter(
        price__gte=price_min,
        price__lte=price_max
    )

    context = {
        'products': products,
        'price_min': price_min,
        'price_max': price_max,
        'actual_min': actual_min,
        'actual_max': actual_max,
    }

    if request.headers.get('HX-Request'):
        return render(request, 'products/partials/product_list.html', context)

    return render(request, 'products/list.html', context)
