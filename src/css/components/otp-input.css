/* OTP Input â€” one-time password code entry fields */

@layer components {
  /* ===== Base container ===== */
  .otp {
    @apply inline-flex;
    gap: var(--spacing-2);
  }

  /* ===== Individual field ===== */
  .otp-field {
    @apply text-center font-semibold outline-none;
    width: 48px;
    height: 56px;
    padding: 0;
    font-size: 1.5rem;
    background: var(--color-base-100);
    border: 1.5px solid var(--color-base-300);
    border-radius: var(--radius-field);
    color: var(--color-base-content);
    caret-color: var(--color-primary);
    transition: border-color 0.15s, box-shadow 0.15s;
    -webkit-appearance: none;
    -moz-appearance: textfield;

    &::-webkit-outer-spin-button,
    &::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    &::placeholder {
      color: color-mix(in oklch, var(--color-base-content) 30%, transparent);
    }

    &:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px color-mix(in oklch, var(--color-primary) 15%, transparent);
    }

    &:hover:not(:focus):not(:disabled) {
      border-color: color-mix(in oklch, var(--color-base-content) 30%, transparent);
    }
  }

  /* Filled state */
  .otp-field-filled {
    background: var(--color-base-200);
    border-color: var(--color-primary);
  }

  /* ===== Separator ===== */
  .otp-separator {
    @apply flex items-center justify-center font-semibold;
    width: 16px;
    color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
    font-size: 1.25rem;
  }

  /* ===== Sizes ===== */
  .otp-sm {
    .otp-field {
      width: 40px;
      height: 48px;
      font-size: 1.25rem;
    }

    .otp-separator {
      width: 12px;
      font-size: 1rem;
    }
  }

  .otp-lg {
    .otp-field {
      width: 56px;
      height: 64px;
      font-size: 1.75rem;
    }

    .otp-separator {
      width: 20px;
      font-size: 1.5rem;
    }
  }

  /* ===== States ===== */
  .otp-success {
    .otp-field {
      border-color: var(--color-success);

      &:focus {
        box-shadow: 0 0 0 3px color-mix(in oklch, var(--color-success) 15%, transparent);
      }
    }
  }

  .otp-error {
    .otp-field {
      border-color: var(--color-error);
      animation: otp-shake 0.4s ease;

      &:focus {
        box-shadow: 0 0 0 3px color-mix(in oklch, var(--color-error) 15%, transparent);
      }
    }
  }

  .otp-disabled {
    .otp-field {
      @apply cursor-not-allowed;
      background: var(--color-base-200);
      color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
      opacity: 0.6;
    }
  }

  .otp-loading {
    .otp-field {
      @apply pointer-events-none;
      opacity: 0.6;
    }
  }

  /* ===== Variants ===== */

  /* Underline */
  .otp-underline {
    .otp-field {
      @apply border-none;
      border-bottom: 2px solid var(--color-base-300);
      border-radius: 0;
      background: transparent;

      &:focus {
        border-bottom-color: var(--color-primary);
        @apply shadow-none;
      }
    }

    .otp-field-filled {
      border-bottom-color: var(--color-primary);
      background: transparent;
    }

    &.otp-error .otp-field {
      border-bottom-color: var(--color-error);
    }

    &.otp-success .otp-field {
      border-bottom-color: var(--color-success);
    }
  }

  /* Rounded */
  .otp-rounded {
    .otp-field {
      border-radius: 50%;
      width: 56px;
      height: 56px;
    }

    &.otp-sm .otp-field {
      width: 48px;
      height: 48px;
    }

    &.otp-lg .otp-field {
      width: 64px;
      height: 64px;
    }
  }

  /* Secure (dots) */
  .otp-secure {
    .otp-field {
      -webkit-text-security: disc;
    }
  }

  /* ===== Glass ===== */
  .otp.glass {
    .otp-field {
      @apply glass;

      &:focus {
        background: color-mix(in oklch, var(--color-base-100) 85%, transparent);
      }
    }
  }

  /* ===== Wrapper (with helper text) ===== */
  .otp-wrapper {
    @apply inline-flex flex-col;
    gap: var(--spacing-2);
  }

  .otp-helper {
    @apply text-center;
    font-size: 0.8125rem;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
  }

  .otp-helper-error {
    color: var(--color-error);
  }

  .otp-helper-success {
    color: var(--color-success);
  }

  /* ===== Resend ===== */
  .otp-resend {
    @apply flex items-center justify-center;
    gap: var(--spacing-1);
    font-size: 0.8125rem;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
  }

  .otp-resend-btn {
    @apply border-none cursor-pointer bg-transparent underline;
    padding: 0;
    font: inherit;
    color: var(--color-primary);

    &:hover {
      opacity: 0.8;
    }

    &:disabled {
      color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
      cursor: not-allowed;
      @apply no-underline;
    }
  }
}

/* Keyframes (outside @layer) */
@keyframes otp-shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-4px); }
  40%, 80% { transform: translateX(4px); }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .otp-error .otp-field {
    animation: none;
  }
}
