/* UX v3 - Refresher Component */
/* Pull-to-refresh indicator with spinner, arrow icon, progress circle, and completion states */

@layer components {

  /* =============================================
     Refresher Base
     ============================================= */

  .refresher {
    @apply absolute top-0 left-0 right-0 flex items-center justify-center pointer-events-none;
    height: 60px;
    transform: translateY(-100%);
    transition: transform 0.2s var(--ease-ios);
    z-index: 10;
  }

  /* =============================================
     States
     ============================================= */

  .refresher-pulling {
    transform: translateY(0);

    & .refresher-icon {
      transform: rotate(0deg);
    }

    & .refresher-backdrop {
      @apply opacity-100;
    }
  }

  .refresher-refreshing {
    transform: translateY(0);
  }

  .refresher-ready {
    & .refresher-icon {
      transform: rotate(180deg);
    }
  }

  .refresher-complete {
    & .refresher-content {
      color: var(--color-success);
    }
  }

  /* =============================================
     Refresher Content
     ============================================= */

  .refresher-content {
    @apply flex flex-col items-center;
    gap: 0.25rem;
  }

  /* =============================================
     Arrow Icon
     ============================================= */

  .refresher-icon {
    @apply size-6;
    color: color-mix(in oklch, var(--color-base-content) 50%, transparent);
    transition: transform 0.15s var(--ease-ios);

    & > svg {
      @apply size-full;
    }
  }

  /* =============================================
     Spinner
     ============================================= */

  .refresher-spinner {
    @apply size-6 rounded-full;
    border: 2px solid var(--color-base-200);
    border-top-color: var(--color-primary);
    animation: refresher-spin 0.8s linear infinite;
  }

  .refresher-spinner-ios {
    @apply relative size-6;
    border: none;
    animation: none;

    &::before {
      content: '';
      @apply absolute top-0;
      left: 50%;
      width: 2px;
      height: 6px;
      background-color: color-mix(in oklch, var(--color-base-content) 50%, transparent);
      border-radius: 1px;
      transform-origin: center 12px;
      animation: refresher-ios-spin 1s steps(8) infinite;
    }
  }

  /* =============================================
     Text
     ============================================= */

  .refresher-text {
    font-size: 0.75rem;
    color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
  }

  /* =============================================
     Progress Circle
     ============================================= */

  .refresher-progress {
    @apply size-7;
  }

  .refresher-progress-circle {
    fill: none;
    stroke: var(--color-primary);
    stroke-width: 2;
    stroke-linecap: round;
    transform: rotate(-90deg);
    transform-origin: center;
  }

  /* =============================================
     Backdrop (optional pull feedback)
     ============================================= */

  .refresher-backdrop {
    @apply absolute top-0 left-0 right-0 pointer-events-none opacity-0;
    height: 100%;
    background: linear-gradient(to bottom, color-mix(in oklch, var(--color-primary) 5%, transparent), transparent);
    transition: opacity 0.15s var(--ease-ios);
  }

  /* =============================================
     Success Check
     ============================================= */

  .refresher-check {
    @apply size-6;
    color: var(--color-success);
    animation: refresher-check 0.3s var(--ease-spring);

    & > svg {
      @apply size-full;
    }
  }

  /* =============================================
     Pull Content Container
     ============================================= */

  .refresher-container {
    @apply relative;
    transform: translateY(0);
    transition: transform 0.2s var(--ease-ios);
    will-change: transform;
  }

  .refresher-container-pulling {
    transition: none;
  }

  .refresher-container-refreshing {
    transform: translateY(60px);
  }
}

/* =============================================
   Animations
   ============================================= */

@keyframes refresher-spin {
  to {
    transform: rotate(360deg);
  }
}

@keyframes refresher-ios-spin {
  from {
    transform: translateX(-50%) rotate(0deg);
  }
  to {
    transform: translateX(-50%) rotate(360deg);
  }
}

@keyframes refresher-check {
  0% {
    transform: scale(0);
  }
  50% {
    transform: scale(1.2);
  }
  100% {
    transform: scale(1);
  }
}

/* =============================================
   Reduced Motion
   ============================================= */

@media (prefers-reduced-motion: reduce) {
  .refresher,
  .refresher-container {
    transition: none;
  }

  .refresher-spinner,
  .refresher-spinner-ios::before {
    animation: none;
  }

  .refresher-check {
    animation: none;
  }
}
