/* UX v3 - Split Pane Component */
/* Two-panel layout with main content and collapsible side panel */
/*
   Usage (checkbox, no JS):
   <input type="checkbox" id="sp" class="split-pane-toggle" checked>
   <div class="split-pane">
     <div class="split-pane-main">...</div>
     <div class="split-pane-divider">
       <label for="sp" class="split-pane-divider-btn">
         <svg>chevron</svg>
       </label>
     </div>
     <div class="split-pane-side">...</div>
   </div>

   checked   = side panel visible
   unchecked = side panel collapsed
*/

@layer components {

  /* =============================================
     Hidden checkbox toggle (no JS needed)
     ============================================= */

  .split-pane-toggle {
    @apply sr-only;
  }

  /* =============================================
     Container
     ============================================= */

  .split-pane {
    @apply flex flex-row h-full w-full relative;
  }

  /* =============================================
     Main content area
     ============================================= */

  .split-pane-main {
    @apply flex-1 min-w-0 flex flex-col h-full overflow-hidden;
  }

  /* =============================================
     Side panel
     ============================================= */

  .split-pane-side {
    width: var(--split-pane-width, 320px);
    max-width: 85vw;
    @apply shrink-0 h-full flex flex-col overflow-hidden;
    background-color: var(--color-base-100);
    border-left: 1px solid var(--color-base-300);
    transition: width 0.2s ease, opacity 0.2s ease, transform 0.2s ease;
  }

  .split-pane-side-left {
    @apply order-first;
    border-left: none;
    border-right: 1px solid var(--color-base-300);
  }

  /* =============================================
     Divider (always visible, sits between main & side)
     ============================================= */

  .split-pane-divider {
    @apply shrink-0 flex flex-col items-center justify-center;
    width: 0;
    z-index: 2;
  }

  .split-pane-divider-btn {
    @apply flex items-center justify-center cursor-pointer rounded-full;
    width: 1.25rem;
    height: 2rem;
    border-radius: 0.375rem;
    background-color: var(--color-base-200);
    border: 1px solid var(--color-base-300);
    color: var(--color-base-content);
    opacity: 0;
    transition: opacity 0.15s ease, background-color 0.15s ease;
    -webkit-tap-highlight-color: transparent;

    & svg {
      @apply w-3 h-3;
      transition: transform 0.2s ease;
    }
  }

  .split-pane:hover .split-pane-divider-btn,
  .split-pane-divider-btn:focus-visible {
    opacity: 0.7;
  }

  .split-pane-divider-btn:hover {
    @apply opacity-100;
    background-color: var(--color-base-300);
  }

  /* =============================================
     Backdrop (for mobile overlay)
     ============================================= */

  .split-pane-backdrop {
    @apply hidden fixed inset-0 pointer-events-none;
    background: rgba(0, 0, 0, 0.4);
    z-index: 40;
    opacity: 0;
    transition: opacity 0.2s ease;
    -webkit-tap-highlight-color: transparent;
  }

  /* =============================================
     Collapsed state (class-based, for JS usage)
     ============================================= */

  .split-pane-collapsed .split-pane-side {
    width: 0;
    border-left: none;
    border-right: none;
    @apply opacity-0 overflow-hidden;
  }

  .split-pane-collapsed .split-pane-divider-btn svg {
    transform: rotate(180deg);
  }

  .split-pane:has(.split-pane-side-left) .split-pane-divider-btn svg {
    transform: rotate(180deg);
  }

  .split-pane-collapsed:has(.split-pane-side-left) .split-pane-divider-btn svg {
    transform: rotate(0deg);
  }

  /* =============================================
     Checkbox: collapsed state (desktop — width: 0)
     ============================================= */

  /* Unchecked = collapsed (right side panel) */
  .split-pane-toggle:not(:checked) ~ .split-pane .split-pane-side:not(.split-pane-side-left) {
    width: 0;
    border-left: none;
    @apply opacity-0 overflow-hidden;
  }

  .split-pane-toggle:not(:checked) ~ .split-pane .split-pane-divider-btn svg {
    transform: rotate(180deg);
  }

  /* Unchecked = collapsed (left side panel) */
  .split-pane-toggle:not(:checked) ~ .split-pane .split-pane-side-left {
    width: 0;
    border-right: none;
    @apply opacity-0 overflow-hidden;
  }

  /* Checked + left panel: chevron faces left by default */
  .split-pane-toggle:checked ~ .split-pane:has(.split-pane-side-left) .split-pane-divider-btn svg {
    transform: rotate(180deg);
  }

  .split-pane-toggle:not(:checked) ~ .split-pane:has(.split-pane-side-left) .split-pane-divider-btn svg {
    transform: rotate(0deg);
  }

  /* =============================================
     Glass
     ============================================= */

  .split-pane-side.glass {
    @apply glass;
    border-left-color: rgba(255, 255, 255, 0.18);
  }
}

/* =============================================
   Desktop (>= 992px)
   ============================================= */

@media (min-width: 992px) {
  .split-pane-backdrop {
    display: none !important;
  }
}

/* =============================================
   Mobile (< 992px) — overlay from edge
   ============================================= */

@media (max-width: 991px) {

  /* Side panel becomes a fixed overlay */
  .split-pane-side {
    @apply fixed top-0 bottom-0;
    right: 0;
    width: var(--split-pane-width, 320px);
    z-index: 50;
    transform: translateX(100%);
    box-shadow: -10px 0 40px rgba(0, 0, 0, 0.15);
  }

  .split-pane-side-left {
    right: auto;
    left: 0;
    transform: translateX(-100%);
  }

  /* Checkbox: checked = slide in the panel */
  .split-pane-toggle:checked ~ .split-pane .split-pane-side {
    transform: translateX(0);
  }

  /* Backdrop visible when checked */
  .split-pane-toggle:checked ~ .split-pane .split-pane-backdrop {
    @apply block pointer-events-auto;
    opacity: 1;
  }

  /* Unchecked = panel hidden, backdrop hidden */
  .split-pane-toggle:not(:checked) ~ .split-pane .split-pane-backdrop {
    @apply block pointer-events-none;
    opacity: 0;
  }

  /* Class-based JS fallback */
  .split-pane-open .split-pane-side {
    transform: translateX(0);
  }

  .split-pane-open .split-pane-backdrop {
    @apply block pointer-events-auto;
    opacity: 1;
  }

  /* Hide divider on mobile — use a regular button instead */
  .split-pane-divider {
    @apply hidden;
  }
}

/* =============================================
   Reduced motion
   ============================================= */

@media (prefers-reduced-motion: reduce) {
  .split-pane-side,
  .split-pane-backdrop {
    transition: none;
  }

  .split-pane-divider-btn svg {
    transition: none;
  }
}
