/* UX v3 - Split Pane Component */
/* Two-panel layout with main content and collapsible side panel */
/*
   Usage (checkbox, no JS):
   <input type="checkbox" id="sp" class="split-pane-toggle" checked>
   <div class="split-pane">
     <div class="split-pane-main">...</div>
     <div class="split-pane-divider">
       <label for="sp" class="split-pane-divider-btn">
         <svg>chevron</svg>
       </label>
     </div>
     <div class="split-pane-side">...</div>
   </div>

   checked   = side panel visible
   unchecked = side panel collapsed
*/

@layer components {

  /* =============================================
     Hidden checkbox toggle (no JS needed)
     ============================================= */

  .split-pane-toggle {
    @apply absolute w-px h-px opacity-0 pointer-events-none overflow-hidden;
    clip: rect(0 0 0 0);
  }

  /* =============================================
     Container
     ============================================= */

  .split-pane {
    @apply flex flex-row h-full w-full relative overflow-hidden;
  }

  /* =============================================
     Main content area
     ============================================= */

  .split-pane-main {
    @apply flex-1 min-w-0 flex flex-col h-full overflow-hidden;
  }

  /* =============================================
     Side panel
     ============================================= */

  .split-pane-side {
    width: var(--split-pane-width, 320px);
    max-width: 85vw;
    @apply shrink-0 h-full flex flex-col overflow-hidden;
    background-color: var(--color-base-100);
    border-left: 1px solid var(--color-base-300);
    transition: width 0.2s ease, opacity 0.2s ease, transform 0.2s ease;
  }

  .split-pane-side-left {
    @apply order-first;
    border-left: none;
    border-right: 1px solid var(--color-base-300);
  }

  /* =============================================
     Divider (always visible, sits between main & side)
     ============================================= */

  .split-pane-divider {
    @apply shrink-0 flex flex-col items-center justify-center relative;
    width: 1px;
    background-color: var(--color-base-300);
    z-index: 1;
  }

  .split-pane-divider-btn {
    @apply flex items-center justify-center cursor-pointer rounded-full;
    width: 1.5rem;
    height: 1.5rem;
    background-color: var(--color-base-200);
    border: 1px solid var(--color-base-300);
    color: var(--color-base-content);
    opacity: 0.6;
    transition: opacity 0.15s ease, background-color 0.15s ease;
    -webkit-tap-highlight-color: transparent;

    &:hover {
      @apply opacity-100;
      background-color: var(--color-base-300);
    }

    & svg {
      @apply w-3.5 h-3.5;
      transition: transform 0.2s ease;
    }
  }

  /* =============================================
     Backdrop (for mobile overlay)
     ============================================= */

  .split-pane-backdrop {
    @apply hidden fixed inset-0 pointer-events-none;
    background: rgba(0, 0, 0, 0.4);
    z-index: 40;
    opacity: 0;
    transition: opacity 0.2s ease;
    -webkit-tap-highlight-color: transparent;
  }

  /* =============================================
     Collapsed state (class-based, for JS usage)
     ============================================= */

  .split-pane-collapsed .split-pane-side {
    width: 0;
    border-left: none;
    border-right: none;
    @apply opacity-0 overflow-hidden;
  }

  .split-pane-collapsed .split-pane-divider-btn svg {
    transform: rotate(180deg);
  }

  .split-pane:has(.split-pane-side-left) .split-pane-divider-btn svg {
    transform: rotate(180deg);
  }

  .split-pane-collapsed:has(.split-pane-side-left) .split-pane-divider-btn svg {
    transform: rotate(0deg);
  }

  /* =============================================
     Glass
     ============================================= */

  .split-pane-side.glass {
    @apply glass;
    border-left-color: rgba(255, 255, 255, 0.18);
  }
}

/* =============================================
   Desktop (>= 992px) — side-by-side layout
   ============================================= */

@media (min-width: 992px) {

  /* Checkbox: unchecked = collapsed (right side panel) */
  .split-pane-toggle:not(:checked) ~ .split-pane .split-pane-side:not(.split-pane-side-left) {
    width: 0;
    border-left: none;
    @apply opacity-0 overflow-hidden;
  }

  .split-pane-toggle:not(:checked) ~ .split-pane .split-pane-divider-btn svg {
    transform: rotate(180deg);
  }

  /* Checkbox: unchecked = collapsed (left side panel) */
  .split-pane-toggle:not(:checked) ~ .split-pane .split-pane-side-left {
    width: 0;
    border-right: none;
    @apply opacity-0 overflow-hidden;
  }

  /* Checked + left panel: chevron faces left by default */
  .split-pane-toggle:checked ~ .split-pane:has(.split-pane-side-left) .split-pane-divider-btn svg {
    transform: rotate(180deg);
  }

  .split-pane-toggle:not(:checked) ~ .split-pane:has(.split-pane-side-left) .split-pane-divider-btn svg {
    transform: rotate(0deg);
  }

  /* Desktop: backdrop always hidden */
  .split-pane-backdrop {
    display: none !important;
  }
}

/* =============================================
   Mobile (< 992px) — overlay from edge
   ============================================= */

@media (max-width: 991px) {

  /* Side panel becomes a fixed overlay */
  .split-pane-side {
    @apply fixed top-0 bottom-0;
    right: 0;
    width: var(--split-pane-width, 320px);
    z-index: 50;
    transform: translateX(100%);
    box-shadow: -10px 0 40px rgba(0, 0, 0, 0.15);
  }

  .split-pane-side-left {
    right: auto;
    left: 0;
    transform: translateX(-100%);
  }

  /* Checkbox: checked = slide in the panel */
  .split-pane-toggle:checked ~ .split-pane .split-pane-side {
    transform: translateX(0);
  }

  /* Backdrop visible when checked */
  .split-pane-toggle:checked ~ .split-pane .split-pane-backdrop {
    @apply block pointer-events-auto;
    opacity: 1;
  }

  /* Unchecked = panel hidden, backdrop hidden */
  .split-pane-toggle:not(:checked) ~ .split-pane .split-pane-backdrop {
    @apply block pointer-events-none;
    opacity: 0;
  }

  /* Class-based JS fallback */
  .split-pane-open .split-pane-side {
    transform: translateX(0);
  }

  .split-pane-open .split-pane-backdrop {
    @apply block pointer-events-auto;
    opacity: 1;
  }

  /* Hide divider on mobile — the toggle button floats instead */
  .split-pane-divider {
    @apply hidden;
  }

  /* Floating toggle button for mobile */
  .split-pane-mobile-toggle {
    @apply fixed flex items-center justify-center cursor-pointer rounded-full shadow-lg;
    bottom: 1.5rem;
    right: 1.5rem;
    width: 3rem;
    height: 3rem;
    z-index: 60;
    background-color: var(--color-base-200);
    border: 1px solid var(--color-base-300);
    color: var(--color-base-content);
    -webkit-tap-highlight-color: transparent;
  }

  .split-pane-mobile-toggle svg {
    @apply w-5 h-5;
  }
}

/* =============================================
   Reduced motion
   ============================================= */

@media (prefers-reduced-motion: reduce) {
  .split-pane-side,
  .split-pane-backdrop {
    transition: none;
  }

  .split-pane-divider-btn svg {
    transition: none;
  }
}
