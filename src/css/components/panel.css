/* UX v3 - Panel Component */
/* Collapsible panel with header, body, and footer. Uses CSS grid for smooth expand/collapse. */

@layer components {

  /* =============================================
     Base panel
     ============================================= */

  .panel {
    --panel-padding: 1rem;
    --panel-radius: var(--radius-box);
    --panel-gap: 1rem;

    @apply flex flex-col overflow-hidden;
    background-color: var(--color-base-100);
    border: 1px solid var(--color-base-300);
    border-radius: var(--panel-radius);
  }

  /* =============================================
     Header
     ============================================= */

  .panel-header {
    @apply flex items-center justify-between gap-2 cursor-pointer select-none;
    padding: var(--panel-padding);
    background-color: var(--color-base-200);
    border-bottom: 1px solid var(--color-base-300);
    transition: background-color 0.15s ease;

    &:hover {
      background-color: var(--color-base-300);
    }

    &:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: -2px;
    }
  }

  .panel-header-content {
    @apply flex items-center gap-2 flex-1 min-w-0;
  }

  .panel-icon {
    @apply size-5 shrink-0;
    color: var(--color-base-content);
    opacity: 0.5;
  }

  .panel-title {
    @apply font-semibold m-0 truncate;
  }

  .panel-subtitle {
    @apply text-sm m-0 truncate;
    color: var(--color-base-content);
    opacity: 0.6;
  }

  .panel-actions {
    @apply flex items-center gap-1 shrink-0;
  }

  .panel-toggle {
    @apply size-5 shrink-0;
    color: var(--color-base-content);
    opacity: 0.3;
    transition: transform 0.2s ease;
  }

  /* =============================================
     Body (collapsible via CSS grid)
     ============================================= */

  .panel-body {
    @apply grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.2s ease;
  }

  .panel-content {
    @apply overflow-hidden;
  }

  .panel-content-inner {
    padding: var(--panel-padding);
  }

  /* =============================================
     Footer
     ============================================= */

  .panel-footer {
    @apply hidden items-center justify-end gap-2;
    padding: 0.5rem var(--panel-padding);
    border-top: 1px solid var(--color-base-300);
    background-color: var(--color-base-200);
  }

  /* =============================================
     Open state
     ============================================= */

  .panel-open .panel-toggle {
    transform: rotate(180deg);
  }

  .panel-open .panel-body {
    grid-template-rows: 1fr;
  }

  .panel-open .panel-footer {
    @apply flex;
  }

  /* Also support data-state="open" */
  .panel[data-state="open"] .panel-toggle {
    transform: rotate(180deg);
  }

  .panel[data-state="open"] .panel-body {
    grid-template-rows: 1fr;
  }

  .panel[data-state="open"] .panel-footer {
    @apply flex;
  }

  /* =============================================
     Style variants
     ============================================= */

  .panel-flush .panel-header {
    @apply bg-transparent;
    border-bottom-color: transparent;
  }

  .panel-flush.panel-open .panel-header,
  .panel-flush[data-state="open"] .panel-header {
    border-bottom-color: var(--color-base-300);
  }

  .panel-outline {
    @apply bg-transparent;

    & .panel-header {
      @apply bg-transparent;

      &:hover {
        background-color: var(--color-base-200);
      }
    }
  }

  .panel-filled {
    @apply border-none;

    & .panel-header {
      background-color: var(--color-base-300);

      &:hover {
        background-color: color-mix(in oklch, var(--color-base-300) 85%, var(--color-base-content));
      }
    }
  }

  .panel-borderless {
    @apply border-none rounded-none;

    & .panel-header {
      @apply bg-transparent border-b-0;
    }
  }

  /* =============================================
     Sizes
     ============================================= */

  .panel-sm {
    --panel-padding: 0.5rem;
    --panel-radius: var(--radius-field);

    & .panel-title {
      @apply text-sm;
    }

    & .panel-toggle,
    & .panel-icon {
      @apply size-4;
    }
  }

  .panel-lg {
    --panel-padding: 1.5rem;

    & .panel-title {
      @apply text-lg;
    }

    & .panel-toggle,
    & .panel-icon {
      @apply size-6;
    }
  }

  /* =============================================
     Color variants
     ============================================= */

  .panel-primary .panel-header {
    background-color: color-mix(in oklch, var(--color-primary) 10%, transparent);
    border-bottom-color: color-mix(in oklch, var(--color-primary) 20%, transparent);
  }

  .panel-primary .panel-title {
    color: var(--color-primary);
  }

  .panel-success .panel-header {
    background-color: color-mix(in oklch, var(--color-success) 10%, transparent);
    border-bottom-color: color-mix(in oklch, var(--color-success) 20%, transparent);
  }

  .panel-success .panel-title {
    color: var(--color-success);
  }

  .panel-warning .panel-header {
    background-color: color-mix(in oklch, var(--color-warning) 10%, transparent);
    border-bottom-color: color-mix(in oklch, var(--color-warning) 20%, transparent);
  }

  .panel-warning .panel-title {
    color: var(--color-warning);
  }

  .panel-error .panel-header {
    background-color: color-mix(in oklch, var(--color-error) 10%, transparent);
    border-bottom-color: color-mix(in oklch, var(--color-error) 20%, transparent);
  }

  .panel-error .panel-title {
    color: var(--color-error);
  }

  /* =============================================
     States
     ============================================= */

  .panel-disabled {
    @apply opacity-50 pointer-events-none;
  }

  .panel-loading .panel-content-inner {
    @apply relative;
    min-height: 100px;

    &::after {
      content: '';
      @apply absolute top-1/2 left-1/2 size-6 rounded-full;
      margin: -12px 0 0 -12px;
      border: 2px solid var(--color-base-300);
      border-top-color: var(--color-primary);
      animation: panel-spin 0.8s linear infinite;
    }
  }

  /* =============================================
     Glass variant
     ============================================= */

  .panel.glass {
    @apply glass;
    border-color: var(--color-glass-border);

    & .panel-header {
      background: rgba(255, 255, 255, 0.3);
      border-bottom-color: var(--color-glass-border);

      &:hover {
        background: rgba(255, 255, 255, 0.4);
      }
    }

    & .panel-footer {
      background: rgba(255, 255, 255, 0.2);
      border-top-color: var(--color-glass-border);
    }
  }

  /* =============================================
     Panel group
     ============================================= */

  .panel-group {
    @apply flex flex-col;
    gap: var(--panel-gap, 1rem);
  }

  .panel-group-accordion {
    @apply gap-0;

    & .panel {
      @apply rounded-none;
      margin-top: -1px;

      &:first-child {
        border-radius: var(--panel-radius, var(--radius-box)) var(--panel-radius, var(--radius-box)) 0 0;
        margin-top: 0;
      }

      &:last-child {
        border-radius: 0 0 var(--panel-radius, var(--radius-box)) var(--panel-radius, var(--radius-box));
      }

      &:only-child {
        border-radius: var(--panel-radius, var(--radius-box));
      }
    }
  }
}

/* =============================================
   Keyframes (outside @layer)
   ============================================= */

@keyframes panel-spin {
  to { transform: rotate(360deg); }
}

/* =============================================
   Reduced motion
   ============================================= */

@media (prefers-reduced-motion: reduce) {
  .panel-body {
    transition: none;
  }

  .panel-toggle {
    transition: none;
  }

  .panel-loading .panel-content-inner::after {
    animation: none;
  }
}
