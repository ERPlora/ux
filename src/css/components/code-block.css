/* UX v3 - Code Block Component */
/* Syntax-highlighted code display with line numbers, copy button, and light/dark themes */

@layer components {

  /* =============================================
     Base
     ============================================= */

  .code-block {
    @apply relative overflow-x-auto m-0;
    font-family: 'SF Mono', 'Fira Code', 'Monaco', 'Consolas', monospace;
    font-size: 0.875rem;
    line-height: 1.6;
    border-radius: var(--radius-box, 0.75rem);
    white-space: pre;
    padding: 1rem;
    background-color: #1e1e2e;
    color: #cdd6f4;
  }

  /* =============================================
     Header
     ============================================= */

  .code-block-header {
    @apply flex items-center justify-between;
    padding: 0.75rem 1rem;
    background-color: #181825;
    border-bottom: 1px solid #313244;
  }

  .code-block-title {
    @apply flex items-center gap-2 text-xs font-medium;
    color: #6c7086;
  }

  .code-block-lang {
    @apply text-xs uppercase tracking-wide;
    padding: 0.125rem 0.5rem;
    background-color: #313244;
    border-radius: 0.25rem;
    font-size: 0.6875rem;
    color: #a6adc8;
  }

  .code-block-actions {
    @apply flex items-center gap-2;
  }

  .code-block-btn {
    @apply flex items-center justify-center gap-1.5 bg-transparent border-none cursor-pointer;
    padding: 0.375rem 0.625rem;
    border-radius: 0.25rem;
    color: #6c7086;
    font-size: 0.75rem;
    font-family: inherit;
    transition: all 0.15s ease;

    &:hover {
      background-color: #313244;
      color: #cdd6f4;
    }

    & svg {
      @apply size-3.5;
    }
  }

  .code-block-btn-copied {
    color: var(--color-success);
  }

  /* =============================================
     Content area
     ============================================= */

  .code-block-content {
    @apply flex overflow-x-auto;
    scrollbar-width: thin;
    scrollbar-color: #45475a transparent;
  }

  /* =============================================
     Line numbers
     ============================================= */

  .code-block-line-numbers {
    @apply flex flex-col shrink-0 select-none;
    padding: 1rem 0;
    background-color: rgba(0, 0, 0, 0.2);
    border-right: 1px solid #313244;
  }

  .code-block-line-number {
    @apply text-right;
    padding: 0 1rem;
    color: #585b70;
    font-size: 0.75rem;
    line-height: 1.6;
  }

  .code-block-line-number-highlight {
    background-color: color-mix(in oklch, var(--color-primary) 15%, transparent);
    color: #a6adc8;
  }

  /* =============================================
     Code
     ============================================= */

  .code-block-code {
    @apply flex-1 m-0 overflow-visible bg-transparent;
    padding: 1rem;
    white-space: pre;
    font: inherit;
  }

  .code-block-line {
    @apply block;
    padding: 0 0.5rem;
    border-left: 3px solid transparent;
  }

  .code-block-line-highlight {
    background-color: color-mix(in oklch, var(--color-primary) 15%, transparent);
    border-left-color: var(--color-primary);
  }

  .code-block-line-added {
    background-color: rgba(46, 160, 67, 0.15);
    border-left-color: var(--color-success);

    &::before {
      content: '+';
      @apply mr-2;
      color: var(--color-success);
    }
  }

  .code-block-line-removed {
    background-color: rgba(248, 81, 73, 0.15);
    border-left-color: var(--color-error);

    &::before {
      content: '-';
      @apply mr-2;
      color: var(--color-error);
    }
  }

  /* =============================================
     Syntax tokens (One Dark inspired)
     ============================================= */

  .token-keyword { color: #cba6f7; }
  .token-string { color: #a6e3a1; }
  .token-number { color: #fab387; }
  .token-comment { color: #585b70; font-style: italic; }
  .token-function { color: #89b4fa; }
  .token-class { color: #f9e2af; }
  .token-operator { color: #94e2d5; }
  .token-punctuation { color: #a6adc8; }
  .token-property { color: #f38ba8; }
  .token-tag { color: #f38ba8; }
  .token-attr-name { color: #fab387; }
  .token-attr-value { color: #a6e3a1; }
  .token-selector { color: #cba6f7; }
  .token-variable { color: #f38ba8; }
  .token-constant { color: #94e2d5; }
  .token-boolean { color: #fab387; }
  .token-regex { color: #94e2d5; }

  /* =============================================
     Size variants
     ============================================= */

  .code-block-sm {
    font-size: 0.75rem;

    & .code-block-line-number {
      font-size: 0.6875rem;
    }
  }

  .code-block-lg {
    font-size: 1rem;

    & .code-block-line-number {
      font-size: 0.875rem;
    }
  }

  /* =============================================
     Light theme
     ============================================= */

  .code-block-light {
    background-color: var(--color-base-100);
    color: #383a42;

    & .code-block-header {
      background-color: var(--color-base-200);
      border-bottom-color: var(--color-base-300);
    }

    & .code-block-lang {
      background-color: var(--color-base-300);
      color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
    }

    & .code-block-btn {
      color: color-mix(in oklch, var(--color-base-content) 40%, transparent);

      &:hover {
        background-color: var(--color-base-300);
        color: var(--color-base-content);
      }
    }

    & .code-block-line-numbers {
      background-color: var(--color-base-200);
      border-right-color: var(--color-base-300);
    }

    & .code-block-line-number {
      color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
    }

    & .token-keyword { color: #8250df; }
    & .token-string { color: #0a3069; }
    & .token-number { color: #0550ae; }
    & .token-comment { color: #6e7781; }
    & .token-function { color: #8250df; }
    & .token-class { color: #953800; }
    & .token-operator { color: #cf222e; }
    & .token-punctuation { color: #24292f; }
    & .token-property { color: #0550ae; }
    & .token-tag { color: #116329; }
    & .token-attr-name { color: #0550ae; }
    & .token-attr-value { color: #0a3069; }
  }

  /* =============================================
     Collapsed / expandable
     ============================================= */

  .code-block-collapsed .code-block-content {
    max-height: 200px;
    @apply overflow-hidden relative;

    &::after {
      content: '';
      @apply absolute bottom-0 left-0 right-0 pointer-events-none;
      height: 60px;
      background: linear-gradient(transparent, #1e1e2e);
    }
  }

  .code-block-expand {
    @apply flex items-center justify-center cursor-pointer bg-transparent border-none;
    padding: 0.75rem;
    background-color: #181825;
    border-top: 1px solid #313244;
    color: #6c7086;
    font-size: 0.75rem;
    transition: all 0.15s ease;

    &:hover {
      background-color: #313244;
      color: #cdd6f4;
    }
  }

  /* =============================================
     Inline code
     ============================================= */

  .code-inline {
    @apply inline;
    padding: 0.125rem 0.375rem;
    background-color: var(--color-base-200);
    border-radius: 0.25rem;
    font-family: 'SF Mono', 'Fira Code', 'Monaco', 'Consolas', monospace;
    font-size: 0.875em;
    color: var(--color-base-content);
  }

  /* =============================================
     Glass
     ============================================= */

  .code-block.glass {
    @apply glass;

    & .code-block-header {
      background: rgba(255, 255, 255, 0.05);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    & .code-block-line-numbers {
      background: rgba(0, 0, 0, 0.1);
      border-right-color: rgba(255, 255, 255, 0.1);
    }
  }
}

/* =============================================
   Reduced motion
   ============================================= */

@media (prefers-reduced-motion: reduce) {
  .code-block-btn {
    transition: none;
  }
}
