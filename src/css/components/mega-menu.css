/* UX v3 - Mega Menu Component */
/* Large dropdown panels with grid sections, featured items, and promo cards */

@layer components {

  /* =============================================
     Container
     ============================================= */

  .mega-menu {
    @apply relative inline-flex;
  }

  /* =============================================
     Trigger
     ============================================= */

  .mega-menu-trigger {
    @apply inline-flex items-center gap-1 font-medium bg-transparent border-none cursor-pointer;
    padding: 0.5rem 1rem;
    color: var(--color-base-content);
    transition: color 0.15s;

    &:hover {
      color: var(--color-primary);
    }
  }

  .mega-menu-trigger-icon {
    @apply w-4 h-4;
    transition: transform 0.15s;
  }

  /* =============================================
     Panel
     ============================================= */

  .mega-menu-panel {
    @apply absolute overflow-hidden;
    top: 100%;
    left: 0;
    min-width: 600px;
    max-width: calc(100vw - 2rem);
    background-color: var(--color-base-100);
    border: 1px solid var(--color-base-300);
    border-radius: var(--radius-box, 0.75rem);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s;
    z-index: 100;
  }

  /* =============================================
     Open state
     ============================================= */

  .mega-menu[data-state="open"] .mega-menu-panel,
  .mega-menu.mega-menu-open .mega-menu-panel,
  details.mega-menu[open] > .mega-menu-panel {
    @apply opacity-100 visible;
    transform: translateY(0);
  }

  .mega-menu[data-state="open"] .mega-menu-trigger-icon,
  .mega-menu.mega-menu-open .mega-menu-trigger-icon,
  details.mega-menu[open] .mega-menu-trigger-icon {
    transform: rotate(180deg);
  }

  /* Hide native <details> marker */
  details.mega-menu > summary { list-style: none; }
  details.mega-menu > summary::-webkit-details-marker { display: none; }
  details.mega-menu > summary::marker { display: none; content: ''; }

  /* Position variants */
  .mega-menu-right .mega-menu-panel {
    left: auto;
    right: 0;
  }

  .mega-menu-center .mega-menu-panel {
    left: 50%;
    transform: translateX(-50%) translateY(-10px);
  }

  .mega-menu-center[data-state="open"] .mega-menu-panel,
  .mega-menu-center.mega-menu-open .mega-menu-panel,
  details.mega-menu.mega-menu-center[open] > .mega-menu-panel {
    transform: translateX(-50%) translateY(0);
  }

  .mega-menu-full .mega-menu-panel {
    @apply fixed;
    left: 1rem;
    right: 1rem;
    min-width: auto;
    max-width: none;
  }

  /* =============================================
     Panel header & footer
     ============================================= */

  .mega-menu-header {
    @apply flex items-center justify-between;
    padding: 1rem;
    border-bottom: 1px solid var(--color-base-300);
    background-color: var(--color-base-200);
  }

  .mega-menu-header-title {
    @apply text-lg font-semibold m-0;
    color: var(--color-base-content);
  }

  .mega-menu-footer {
    @apply flex items-center justify-between;
    padding: 0.5rem 1rem;
    border-top: 1px solid var(--color-base-300);
    background-color: var(--color-base-200);
  }

  .mega-menu-footer-link {
    @apply inline-flex items-center gap-1 text-sm no-underline;
    color: var(--color-primary);

    &:hover { @apply underline; }

    & svg { @apply w-4 h-4; }
  }

  /* =============================================
     Content grid
     ============================================= */

  .mega-menu-content {
    @apply p-4;
  }

  .mega-menu-grid {
    @apply grid gap-6;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  }

  .mega-menu-grid-2 { grid-template-columns: repeat(2, 1fr); }
  .mega-menu-grid-3 { grid-template-columns: repeat(3, 1fr); }
  .mega-menu-grid-4 { grid-template-columns: repeat(4, 1fr); }

  /* =============================================
     Section
     ============================================= */

  .mega-menu-section {
    @apply flex flex-col;
  }

  .mega-menu-section-title {
    @apply text-xs font-semibold uppercase tracking-wider;
    color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
    margin-bottom: 0.5rem;
    padding: 0 0.5rem;
  }

  .mega-menu-section-list {
    @apply flex flex-col;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  /* =============================================
     Item
     ============================================= */

  .mega-menu-item {
    @apply flex items-start gap-2 no-underline cursor-pointer;
    padding: 0.5rem;
    border-radius: var(--radius-field, 0.5rem);
    color: var(--color-base-content);
    transition: background-color 0.15s;

    &:hover {
      background-color: var(--color-base-200);
    }

    &:focus-visible {
      @apply outline-2 outline-primary -outline-offset-2;
    }
  }

  .mega-menu-item-icon {
    @apply shrink-0 w-5 h-5;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
  }

  .mega-menu-item-title {
    @apply font-medium m-0;
    color: var(--color-base-content);
    margin-bottom: 2px;
  }

  .mega-menu-item-desc {
    @apply text-sm m-0;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
    line-height: 1.4;
  }

  /* =============================================
     Promo card
     ============================================= */

  .mega-menu-promo {
    @apply flex flex-col gap-2 text-white;
    padding: 1rem;
    background: linear-gradient(135deg, var(--color-primary), color-mix(in oklch, var(--color-primary) 80%, black));
    border-radius: var(--radius-field, 0.5rem);
  }

  .mega-menu-promo-title {
    @apply font-semibold m-0;
  }

  .mega-menu-promo-desc {
    @apply text-sm m-0;
    opacity: 0.9;
  }

  /* =============================================
     Glass
     ============================================= */

  .mega-menu.glass .mega-menu-panel {
    @apply glass;
    border-color: rgba(255, 255, 255, 0.18);
  }

  .mega-menu.glass .mega-menu-header,
  .mega-menu.glass .mega-menu-footer {
    background: transparent;
    border-color: rgba(255, 255, 255, 0.18);
  }
}

/* =============================================
   Mobile
   ============================================= */

@media (max-width: 767px) {
  .mega-menu-panel {
    @apply fixed overflow-y-auto;
    top: auto;
    bottom: 0;
    left: 0;
    right: 0;
    min-width: auto;
    max-width: none;
    max-height: 80dvh;
    border-radius: var(--radius-box, 0.75rem) var(--radius-box, 0.75rem) 0 0;
    transform: translateY(100%);
  }

  .mega-menu[data-state="open"] .mega-menu-panel,
  .mega-menu.mega-menu-open .mega-menu-panel,
  details.mega-menu[open] > .mega-menu-panel {
    transform: translateY(0);
  }

  .mega-menu-grid,
  .mega-menu-grid-2,
  .mega-menu-grid-3,
  .mega-menu-grid-4 {
    grid-template-columns: 1fr;
  }
}

/* =============================================
   Reduced motion
   ============================================= */

@media (prefers-reduced-motion: reduce) {
  .mega-menu-panel {
    transition: opacity 0.1s ease, visibility 0.1s ease;
    transform: none !important;
  }

  .mega-menu-trigger-icon {
    transition: none;
  }
}
