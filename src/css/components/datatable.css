/* UX v3 - DataTable Component */
/* Full-featured data table with header, toolbar, sorting, pagination */

@layer components {

  /* =============================================
     Container
     ============================================= */

  .datatable {
    @apply flex flex-col w-full rounded-2xl overflow-hidden;
    background-color: var(--color-base-100);
  }

  .datatable-inset {
    @apply mx-6;
  }

  .datatable-bordered {
    border: 1px solid var(--color-base-300);
  }

  /* =============================================
     Header (title + actions)
     ============================================= */

  .datatable-header {
    @apply flex items-center justify-between px-5 py-3 shrink-0;
    background-color: var(--color-base-100);
    border-bottom: 1px solid var(--color-base-300);
  }

  .datatable-title {
    @apply text-lg font-semibold m-0;
    color: var(--color-base-content);
  }

  .datatable-subtitle {
    @apply text-xs mt-0.5;
    color: var(--color-base-content);
    opacity: 0.6;
  }

  .datatable-actions {
    @apply flex items-center gap-2;
  }

  /* =============================================
     Toolbar (search + filters)
     ============================================= */

  .datatable-toolbar {
    @apply flex items-center justify-between gap-3 px-5 py-2 shrink-0 flex-wrap;
    background-color: var(--color-base-200);
    border-bottom: 1px solid var(--color-base-300);
  }

  .datatable-toolbar-start {
    @apply flex items-center gap-2;
  }

  .datatable-toolbar-end {
    @apply flex items-center gap-2;
  }

  .datatable-search {
    @apply min-w-48;
  }

  /* =============================================
     Bulk actions toolbar
     ============================================= */

  .datatable-bulk {
    @apply flex items-center justify-between gap-3 px-5 py-2 shrink-0;
    background: color-mix(in oklch, var(--color-primary) 10%, var(--color-base-100));
    border-bottom: 1px solid color-mix(in oklch, var(--color-primary) 20%, transparent);
    animation: datatable-bulk-slide 200ms ease;
  }

  .datatable-bulk-info {
    @apply flex items-center gap-2 text-sm font-medium text-primary;
  }

  .datatable-bulk-count {
    @apply inline-flex items-center justify-center min-w-6 h-6 px-1 rounded-full text-xs font-semibold bg-primary text-primary-content;
  }

  .datatable-bulk-actions {
    @apply flex items-center gap-1;
  }

  /* =============================================
     Body (scrollable)
     ============================================= */

  .datatable-body {
    @apply flex-1 overflow-auto;
    -webkit-overflow-scrolling: touch;
  }

  .datatable-body-fixed {
    @apply max-h-96;
  }

  /* =============================================
     Table
     ============================================= */

  .datatable-table {
    @apply w-full;
    border-collapse: collapse;
    table-layout: auto;
  }

  .datatable-table-fixed {
    @apply table-fixed;
  }

  /* Table head */
  .datatable-thead {
    @apply sticky top-0 z-10;
    background-color: var(--color-base-200);
  }

  /* Header cell */
  .datatable-th {
    @apply px-5 py-3 text-left text-xs font-semibold uppercase tracking-wide whitespace-nowrap;
    color: var(--color-base-content);
    opacity: 0.6;
    background-color: var(--color-base-200);
    border-bottom: 2px solid var(--color-base-300);
  }

  .datatable-th-sortable {
    @apply cursor-pointer select-none;
    transition: color 0.15s ease;

    &:hover {
      @apply text-primary;
      opacity: 1;
    }
  }

  .datatable-th-sorted {
    @apply text-primary;
    opacity: 1;
  }

  .datatable-th-center {
    @apply text-center;
  }

  .datatable-th-right {
    @apply text-right;
  }

  .datatable-th-checkbox {
    @apply w-12 pl-3 pr-2;
  }

  .datatable-th-actions {
    @apply w-20 text-center;
  }

  /* Sort icon */
  .datatable-sort-icon {
    @apply inline-flex ml-1 opacity-50;
    transition: transform 0.15s ease;
  }

  .datatable-th-sorted .datatable-sort-icon {
    @apply opacity-100;
  }

  .datatable-th-sorted-desc .datatable-sort-icon {
    transform: rotate(180deg);
  }

  /* =============================================
     Table body
     ============================================= */

  .datatable-tbody {
    background-color: var(--color-base-100);
  }

  /* Row */
  .datatable-tr {
    transition: background-color 0.15s ease;

    &:hover {
      background: color-mix(in oklch, var(--color-primary) 5%, var(--color-base-100));
    }

    &:last-child .datatable-td {
      @apply border-b-0;
    }
  }

  .datatable-tr-selected {
    background: color-mix(in oklch, var(--color-primary) 10%, var(--color-base-100));
  }

  .datatable-tr-clickable {
    @apply cursor-pointer;
  }

  /* Cell */
  .datatable-td {
    @apply px-5 py-3 text-sm align-middle;
    color: var(--color-base-content);
    border-bottom: 1px solid var(--color-base-300);
  }

  .datatable-td-center {
    @apply text-center;
  }

  .datatable-td-right {
    @apply text-right;
  }

  .datatable-td-truncate {
    @apply max-w-48 whitespace-nowrap overflow-hidden text-ellipsis;
  }

  .datatable-td-checkbox {
    @apply w-12 pl-3 pr-2;
  }

  .datatable-td-actions {
    @apply w-20 text-center;
  }

  /* =============================================
     Row actions
     ============================================= */

  .datatable-row-actions {
    @apply flex items-center justify-center gap-1;
  }

  .datatable-row-action {
    @apply flex items-center justify-center size-8 p-0 bg-transparent border-none rounded-lg cursor-pointer;
    color: var(--color-base-content);
    opacity: 0.6;
    transition: background-color 0.15s ease, opacity 0.15s ease;

    &:hover {
      @apply opacity-100;
      background-color: var(--color-base-200);
    }

    svg {
      @apply size-4.5;
    }
  }

  .datatable-row-action-danger:hover {
    background-color: color-mix(in oklch, var(--color-error) 10%, transparent);
    color: var(--color-error);
    @apply opacity-100;
  }

  /* =============================================
     Empty state
     ============================================= */

  .datatable-empty {
    @apply flex flex-col items-center justify-center py-16 px-4 text-center;
  }

  .datatable-empty-icon {
    @apply size-16 mb-4;
    color: var(--color-base-content);
    opacity: 0.3;
  }

  .datatable-empty-title {
    @apply text-lg font-semibold m-0 mb-1;
    color: var(--color-base-content);
  }

  .datatable-empty-text {
    @apply text-sm m-0;
    color: var(--color-base-content);
    opacity: 0.6;
  }

  /* =============================================
     Loading state
     ============================================= */

  .datatable-loading {
    @apply flex items-center justify-center py-16;
  }

  .datatable.is-loading .datatable-tbody {
    @apply opacity-50 pointer-events-none;
  }

  /* =============================================
     Footer (pagination)
     ============================================= */

  .datatable-footer {
    @apply flex items-center justify-between px-5 py-3 shrink-0 flex-wrap gap-3;
    background-color: var(--color-base-100);
    border-top: 1px solid var(--color-base-300);
  }

  .datatable-info {
    @apply text-sm;
    color: var(--color-base-content);
    opacity: 0.6;
  }

  .datatable-per-page {
    @apply flex items-center gap-2 text-sm;
    color: var(--color-base-content);
    opacity: 0.6;

    select {
      @apply px-2 py-1 text-sm rounded-lg;
      border: 1px solid var(--color-base-300);
      background-color: var(--color-base-100);
      color: var(--color-base-content);
    }
  }

  /* =============================================
     Expandable rows
     ============================================= */

  .datatable-expand-btn {
    @apply flex items-center justify-center size-8 p-0 bg-transparent border-none rounded-lg cursor-pointer;
    color: var(--color-base-content);
    opacity: 0.6;
    transition: background-color 0.15s ease, transform 0.15s ease;

    &:hover {
      @apply opacity-100;
      background-color: var(--color-base-200);
    }

    svg {
      @apply size-4.5;
    }
  }

  .datatable-expand-btn-open {
    transform: rotate(90deg);
    @apply text-primary opacity-100;
  }

  .datatable-expand-row {
    background-color: var(--color-base-200);

    & > td {
      @apply p-0;
      border-bottom: 1px solid var(--color-base-300);
    }
  }

  .datatable-expand-content {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.2s ease;
  }

  .datatable-expand-content-open {
    grid-template-rows: 1fr;
  }

  .datatable-expand-inner {
    @apply overflow-hidden;
  }

  .datatable-expand-body {
    @apply p-5;
    border-left: 3px solid var(--color-primary);
    margin-left: 1rem;
  }

  .datatable-detail-list {
    @apply grid gap-3;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  }

  .datatable-detail-item {
    @apply flex flex-col gap-0.5;
  }

  .datatable-detail-label {
    @apply text-xs font-semibold uppercase tracking-wide;
    color: var(--color-base-content);
    opacity: 0.6;
  }

  .datatable-detail-value {
    @apply text-sm;
    color: var(--color-base-content);
  }

  /* =============================================
     Sizes
     ============================================= */

  .datatable-compact .datatable-th,
  .datatable-compact .datatable-td {
    @apply px-3 py-2 text-xs;
  }

  .datatable-sm .datatable-th,
  .datatable-sm .datatable-td {
    @apply px-2 py-1.5 text-xs;
  }

  .datatable-lg .datatable-th,
  .datatable-lg .datatable-td {
    @apply px-6 py-4;
  }

  /* Striped */
  .datatable-striped .datatable-tr:nth-child(even) {
    background-color: var(--color-base-200);
  }

  /* =============================================
     Responsive (card view on mobile)
     ============================================= */

  @media (max-width: 767px) {
    .datatable-toolbar {
      @apply flex-col items-stretch;
    }

    .datatable-search {
      @apply w-full;
    }

    .datatable-footer {
      @apply flex-col items-center;
    }

    .datatable-responsive .datatable-table,
    .datatable-responsive .datatable-thead,
    .datatable-responsive .datatable-tbody,
    .datatable-responsive .datatable-th,
    .datatable-responsive .datatable-tr,
    .datatable-responsive .datatable-td {
      @apply block;
    }

    .datatable-responsive .datatable-thead {
      @apply absolute invisible;
      top: -9999px;
      left: -9999px;
    }

    .datatable-responsive .datatable-tr {
      @apply mb-3 rounded-xl overflow-hidden;
      background-color: var(--color-base-100);
      border: 1px solid var(--color-base-300);

      &:last-child {
        @apply mb-0;
      }
    }

    .datatable-responsive .datatable-td {
      @apply flex items-center justify-between px-4 py-3 text-right;
      border-bottom: 1px solid var(--color-base-300);

      &::before {
        content: attr(data-label);
        @apply flex-1 font-semibold text-xs uppercase tracking-wide text-left pr-3;
        color: var(--color-base-content);
        opacity: 0.6;
      }
    }

    .datatable-responsive .datatable-tr .datatable-td:last-child {
      @apply border-b-0;
    }
  }

  /* =============================================
     Glass variant
     ============================================= */

  .datatable.glass {
    @apply glass;
    border: 0.5px solid var(--glass-border, rgba(255,255,255,0.18));

    & .datatable-th {
      background: var(--glass-bg-thin, rgba(255,255,255,0.5));
      border-bottom-color: var(--glass-border, rgba(255,255,255,0.18));
    }

    & .datatable-td {
      border-bottom-color: var(--glass-border, rgba(255,255,255,0.18));
    }

    & .datatable-tr:hover .datatable-td {
      background: var(--glass-bg-thin, rgba(255,255,255,0.5));
    }

    & .datatable-footer {
      background: var(--glass-bg-thin, rgba(255,255,255,0.5));
      border-top-color: var(--glass-border, rgba(255,255,255,0.18));
    }
  }
}

/* =============================================
   Keyframes (outside @layer for TW v4)
   ============================================= */

@keyframes datatable-bulk-slide {
  from {
    opacity: 0;
    transform: translateY(-8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* =============================================
   Reduced motion
   ============================================= */

@media (prefers-reduced-motion: reduce) {
  .datatable-expand-btn,
  .datatable-expand-content,
  .datatable-sort-icon {
    transition: none;
  }

  .datatable-bulk {
    animation: none;
  }
}
