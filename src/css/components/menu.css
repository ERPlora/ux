/* UX v3 - Menu Component */
/* Dropdown menus, context menus, action menus */
/* Uses native <details> or data-state for open/close */

@layer components {

  /* =============================================
     Menu container (the dropdown panel)
     ============================================= */

  .menu {
    @apply min-w-48 rounded-box p-1;
    background-color: var(--color-base-100);
    border: var(--border) solid var(--color-base-300);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12), 0 2px 10px rgba(0, 0, 0, 0.08);
  }

  /* =============================================
     Menu item
     ============================================= */

  .menu-item {
    @apply flex items-center gap-2 w-full rounded-field px-3 text-sm text-left cursor-pointer border-none select-none;
    min-height: 2.5rem;
    background: transparent;
    color: var(--color-base-content);
    text-decoration: none;
    -webkit-tap-highlight-color: transparent;
    transition: background-color 0.15s;

    &:hover {
      background-color: var(--color-base-200);
    }

    &:active {
      background-color: var(--color-base-300);
    }

    &:focus-visible {
      @apply outline-2 outline-primary outline-offset-[-2px];
    }
  }

  /* =============================================
     Item states
     ============================================= */

  .menu-item-active,
  .menu-item[aria-selected="true"] {
    color: var(--color-primary);
    background-color: color-mix(in oklch, var(--color-primary) 8%, transparent);
  }

  .menu-item-disabled,
  .menu-item:disabled {
    @apply opacity-40 pointer-events-none;
  }

  .menu-item-danger {
    color: var(--color-error);

    &:hover {
      background-color: color-mix(in oklch, var(--color-error) 10%, transparent);
    }
  }

  /* =============================================
     Item children
     ============================================= */

  .menu-icon {
    @apply size-5 shrink-0 opacity-60;
  }

  .menu-item-active .menu-icon,
  .menu-item-danger .menu-icon {
    @apply opacity-100;
    color: inherit;
  }

  .menu-label {
    @apply flex-1 min-w-0 truncate;
  }

  .menu-shortcut {
    @apply text-xs text-base-content/40 ml-auto pl-4;
  }

  .menu-badge {
    @apply ml-auto text-xs px-1.5 py-0.5 rounded-full bg-primary text-primary-content;
  }

  /* =============================================
     Divider & Header
     ============================================= */

  .menu-divider {
    @apply h-px my-1;
    background-color: var(--color-base-200);
  }

  .menu-header {
    @apply px-3 py-1.5 text-xs font-semibold uppercase tracking-wider;
    color: var(--color-base-content);
    opacity: 0.5;
  }

  /* =============================================
     Sizes
     ============================================= */

  .menu-sm {
    @apply min-w-36;

    & .menu-item {
      min-height: 2rem;
      @apply text-xs px-2;
    }
  }

  .menu-lg {
    @apply min-w-60;

    & .menu-item {
      min-height: 3rem;
      @apply px-4;
    }
  }

  /* =============================================
     Dropdown wrapper (with trigger)
     ============================================= */

  .dropdown {
    @apply relative inline-block;
  }

  .dropdown-content {
    @apply absolute z-100;
    opacity: 0;
    visibility: hidden;
    transform: scale(0.95) translateY(-4px);
    transform-origin: top left;
    transition: opacity 0.15s, visibility 0.15s, transform 0.15s;
  }

  /* Open state */
  .dropdown[open] > .dropdown-content,
  .dropdown[data-state="open"] > .dropdown-content {
    opacity: 1;
    visibility: visible;
    transform: scale(1) translateY(0);
  }

  /* Position helpers */
  .dropdown-end > .dropdown-content {
    @apply right-0 left-auto;
    transform-origin: top right;
  }

  .dropdown-top > .dropdown-content {
    @apply bottom-full top-auto mb-1;
    transform-origin: bottom left;
    transform: scale(0.95) translateY(4px);
  }

  .dropdown-top[open] > .dropdown-content,
  .dropdown-top[data-state="open"] > .dropdown-content {
    transform: scale(1) translateY(0);
  }

  .dropdown-top.dropdown-end > .dropdown-content {
    transform-origin: bottom right;
  }

  /* =============================================
     Glass
     ============================================= */

  .menu.glass {
    @apply glass;
  }
}

/* =============================================
   Reduced motion
   ============================================= */

@media (prefers-reduced-motion: reduce) {
  .menu-item {
    transition: none;
  }

  .dropdown-content {
    transition: opacity 0.1s, visibility 0.1s;
    transform: none !important;
  }

  .dropdown[open] > .dropdown-content,
  .dropdown[data-state="open"] > .dropdown-content {
    transform: none !important;
  }
}
