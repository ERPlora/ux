/* UX v3 - Diff Viewer Component */
/* Code diff viewer with unified/split views, line types, gutter, word diff */

@layer components {

  /* =============================================
     Base
     ============================================= */

  .diff {
    @apply overflow-hidden;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Consolas', monospace;
    font-size: 0.8125rem;
    line-height: 1.5;
    background-color: var(--color-base-100);
    border: 1px solid var(--color-base-300);
    border-radius: var(--radius-box, 0.75rem);
  }

  /* =============================================
     Header
     ============================================= */

  .diff-header {
    @apply flex items-center justify-between;
    padding: 0.75rem 1rem;
    background-color: var(--color-base-200);
    border-bottom: 1px solid var(--color-base-300);
  }

  .diff-title {
    @apply font-semibold;
    font-family: inherit;
    font-size: 0.875rem;
    color: var(--color-base-content);
  }

  .diff-stats {
    @apply flex gap-3;
    font-size: 0.75rem;
  }

  .diff-stat-added { color: var(--color-success); }
  .diff-stat-removed { color: var(--color-error); }

  .diff-actions {
    @apply flex gap-2;
  }

  .diff-action {
    @apply text-xs font-medium cursor-pointer;
    padding: 0.375rem 0.75rem;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
    background-color: var(--color-base-100);
    border: 1px solid var(--color-base-300);
    border-radius: var(--radius-field, 0.25rem);
    transition: background-color 0.15s ease;

    &:hover {
      background-color: var(--color-base-200);
    }
  }

  .diff-action-active {
    background-color: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
  }

  /* =============================================
     Content
     ============================================= */

  .diff-content {
    @apply overflow-x-auto;
  }

  .diff-table {
    @apply w-full;
    border-collapse: collapse;
  }

  /* =============================================
     Unified View
     ============================================= */

  .diff-unified .diff-line {
    @apply flex;
  }

  .diff-gutter {
    @apply shrink-0 text-right select-none;
    width: 3.5rem;
    padding: 0 0.5rem;
    color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
    background-color: var(--color-base-200);
    border-right: 1px solid var(--color-base-300);
  }

  .diff-gutter-old { width: 3rem; }
  .diff-gutter-new { width: 3rem; }

  .diff-code {
    @apply flex-1 overflow-x-auto;
    padding: 0 1rem;
    white-space: pre;
  }

  .diff-marker {
    @apply shrink-0 text-center font-semibold select-none;
    width: 1.5rem;
  }

  /* =============================================
     Line Types
     ============================================= */

  .diff-line-added {
    background-color: color-mix(in oklch, var(--color-success) 10%, transparent);

    .diff-marker { color: var(--color-success); }
    .diff-gutter { background-color: color-mix(in oklch, var(--color-success) 15%, transparent); }
  }

  .diff-line-removed {
    background-color: color-mix(in oklch, var(--color-error) 10%, transparent);

    .diff-marker { color: var(--color-error); }
    .diff-gutter { background-color: color-mix(in oklch, var(--color-error) 15%, transparent); }
  }

  .diff-line-context {
    background-color: var(--color-base-100);
  }

  .diff-line-header {
    @apply italic;
    background-color: var(--color-base-200);
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
  }

  /* =============================================
     Inline Highlights (word diff)
     ============================================= */

  .diff-highlight-added {
    background-color: color-mix(in oklch, var(--color-success) 30%, transparent);
    border-radius: 2px;
  }

  .diff-highlight-removed {
    background-color: color-mix(in oklch, var(--color-error) 30%, transparent);
    border-radius: 2px;
  }

  /* =============================================
     Split View
     ============================================= */

  .diff-split .diff-content {
    @apply flex;
  }

  .diff-pane {
    @apply flex-1 min-w-0;
  }

  .diff-pane-old {
    border-right: 1px solid var(--color-base-300);
  }

  .diff-pane-header {
    @apply text-xs font-semibold;
    padding: 0.5rem 1rem;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
    background-color: var(--color-base-200);
    border-bottom: 1px solid var(--color-base-300);
  }

  .diff-pane-header-old { color: var(--color-error); }
  .diff-pane-header-new { color: var(--color-success); }

  .diff-split .diff-line {
    @apply flex;
    min-height: 1.5em;
  }

  .diff-split .diff-gutter { width: 3rem; }
  .diff-split .diff-code { padding: 0 0.75rem; }

  .diff-line-empty {
    background-color: var(--color-base-200);

    .diff-code {
      background: repeating-linear-gradient(
        -45deg,
        transparent,
        transparent 4px,
        var(--color-base-300) 4px,
        var(--color-base-300) 5px
      );
    }
  }

  /* =============================================
     Word Diff Mode
     ============================================= */

  .diff-word .diff-word-added {
    @apply inline;
    background-color: color-mix(in oklch, var(--color-success) 25%, transparent);
    padding: 0 2px;
    border-radius: 2px;
  }

  .diff-word .diff-word-removed {
    @apply inline line-through;
    background-color: color-mix(in oklch, var(--color-error) 25%, transparent);
    padding: 0 2px;
    border-radius: 2px;
  }

  /* =============================================
     Expandable Sections
     ============================================= */

  .diff-expand {
    @apply flex items-center justify-center cursor-pointer;
    padding: 0.25rem 1rem;
    background-color: var(--color-base-200);
    border-top: 1px solid var(--color-base-300);
    border-bottom: 1px solid var(--color-base-300);
    transition: background-color 0.15s ease;

    &:hover {
      background-color: var(--color-base-300);
    }
  }

  .diff-expand-text {
    @apply text-xs;
    color: var(--color-primary);
  }

  .diff-expand-icon {
    @apply w-4 h-4 mr-2;
    color: var(--color-primary);
  }

  /* =============================================
     File Info
     ============================================= */

  .diff-file {
    @apply flex items-center gap-2;
    padding: 0.5rem 1rem;
    background-color: var(--color-base-200);
    border-bottom: 1px solid var(--color-base-300);
  }

  .diff-file-icon {
    @apply w-4 h-4;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
  }

  .diff-file-name {
    @apply font-medium;
    font-size: 0.8125rem;
    color: var(--color-base-content);
  }

  .diff-file-status {
    @apply text-xs font-semibold uppercase;
    padding: 0.125rem 0.5rem;
    border-radius: var(--radius-field, 0.25rem);
  }

  .diff-file-status-modified {
    background-color: color-mix(in oklch, var(--color-warning) 15%, transparent);
    color: var(--color-warning);
  }

  .diff-file-status-added {
    background-color: color-mix(in oklch, var(--color-success) 15%, transparent);
    color: var(--color-success);
  }

  .diff-file-status-deleted {
    background-color: color-mix(in oklch, var(--color-error) 15%, transparent);
    color: var(--color-error);
  }

  .diff-file-status-renamed {
    background-color: color-mix(in oklch, var(--color-primary) 15%, transparent);
    color: var(--color-primary);
  }

  /* =============================================
     Empty State
     ============================================= */

  .diff-empty {
    @apply text-center;
    padding: 3rem 2rem;
  }

  .diff-empty-icon {
    @apply w-12 h-12 mx-auto mb-4;
    color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
  }

  .diff-empty-title {
    @apply font-semibold mb-2;
    color: var(--color-base-content);
  }

  .diff-empty-text {
    @apply text-sm;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
  }

  /* =============================================
     Size Variants
     ============================================= */

  .diff-sm {
    font-size: 0.75rem;

    .diff-gutter { width: 2.5rem; padding: 0 0.375rem; }
    .diff-code { padding: 0 0.75rem; }
  }

  .diff-lg {
    font-size: 0.875rem;

    .diff-gutter { width: 4rem; }
  }

  /* =============================================
     No Gutter
     ============================================= */

  .diff-no-gutter .diff-gutter {
    @apply hidden;
  }
}

/* =============================================
   Reduced Motion
   ============================================= */

@media (prefers-reduced-motion: reduce) {
  .diff-action,
  .diff-expand {
    transition: none;
  }
}
