/* UX v3 - Kanban Component */
/* Drag-and-drop board with columns and cards */

@layer components {

  /* =============================================
     Base kanban board
     ============================================= */

  .kanban {
    @apply flex gap-4 overflow-x-auto p-4;
    min-height: 400px;
    -webkit-overflow-scrolling: touch;
  }

  .kanban-compact {
    @apply gap-2;

    & .kanban-card {
      @apply p-2;
    }

    & .kanban-card-title {
      @apply text-sm;
    }

    & .kanban-card-body {
      @apply text-xs;
    }
  }

  .kanban-swimlanes {
    @apply flex-col;
  }

  /* =============================================
     Column
     ============================================= */

  .kanban-column {
    @apply flex flex-col shrink-0;
    width: 300px;
    min-width: 280px;
    max-width: 350px;
    background-color: var(--color-base-200);
    border-radius: var(--radius-box);
    max-height: 100%;
  }

  .kanban-column-collapsed {
    @apply min-w-12;
    width: 48px;
  }

  .kanban-column-dragover {
    border: 2px dashed var(--color-primary);
    background-color: color-mix(in oklch, var(--color-primary) 5%, transparent);
  }

  /* Column color indicators */
  .kanban-column-todo .kanban-column-color { background-color: color-mix(in oklch, var(--color-base-content) 30%, transparent); }
  .kanban-column-progress .kanban-column-color { background-color: var(--color-primary); }
  .kanban-column-review .kanban-column-color { background-color: var(--color-warning); }
  .kanban-column-done .kanban-column-color { background-color: var(--color-success); }

  /* =============================================
     Column header
     ============================================= */

  .kanban-column-header {
    @apply flex items-center justify-between shrink-0;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--color-base-300);
  }

  .kanban-column-header-start {
    @apply flex items-center gap-2 min-w-0;
  }

  .kanban-column-title {
    @apply text-sm font-semibold m-0 truncate;
    color: var(--color-base-content);
  }

  .kanban-column-count {
    @apply inline-flex items-center justify-center text-xs font-semibold;
    min-width: 24px;
    height: 24px;
    padding: 0 0.375rem;
    background-color: var(--color-base-100);
    border-radius: 12px;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
  }

  .kanban-column-color {
    @apply w-1 h-6 rounded-sm shrink-0;
  }

  .kanban-column-actions {
    @apply flex items-center gap-1;
  }

  .kanban-column-btn {
    @apply flex items-center justify-center w-7 h-7 p-0 border-none rounded-md cursor-pointer;
    background: none;
    color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
    transition: all 0.15s ease;

    &:hover {
      background-color: var(--color-base-100);
      color: var(--color-base-content);
    }

    & svg {
      @apply w-4 h-4;
    }
  }

  /* =============================================
     Column body (cards container)
     ============================================= */

  .kanban-column-body {
    @apply flex-1 overflow-y-auto flex flex-col gap-2 p-2;
    min-height: 100px;

    &:empty::after {
      content: attr(data-empty-text);
      @apply block text-center text-sm;
      padding: 1.5rem;
      color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
    }
  }

  /* =============================================
     Column footer
     ============================================= */

  .kanban-column-footer {
    @apply shrink-0 p-2;
    border-top: 1px solid var(--color-base-300);
  }

  .kanban-add-btn {
    @apply flex items-center justify-center gap-1 w-full p-2 text-sm cursor-pointer;
    background: transparent;
    border: 1px dashed var(--color-base-300);
    border-radius: var(--radius-field);
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
    transition: all 0.15s ease;

    &:hover {
      background-color: var(--color-base-100);
      border-color: var(--color-primary);
      color: var(--color-primary);
    }

    & svg {
      @apply w-4 h-4;
    }
  }

  /* =============================================
     Card
     ============================================= */

  .kanban-card {
    @apply p-3;
    background-color: var(--color-base-100);
    border: 1px solid var(--color-base-300);
    border-radius: var(--radius-field);
    cursor: grab;
    transition: all 0.15s ease;

    &:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border-color: var(--color-primary);
    }

    &:active {
      cursor: grabbing;
    }
  }

  .kanban-card-dragging {
    @apply opacity-50;
    transform: rotate(3deg);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }

  .kanban-card-ghost {
    @apply opacity-40 border-dashed;
  }

  /* Card color stripe */
  .kanban-card-color {
    border-left-width: 4px;
  }

  .kanban-card-color-primary { border-left-color: var(--color-primary); }
  .kanban-card-color-success { border-left-color: var(--color-success); }
  .kanban-card-color-warning { border-left-color: var(--color-warning); }
  .kanban-card-color-error { border-left-color: var(--color-error); }
  .kanban-card-color-info { border-left-color: var(--color-info); }

  .kanban-card-completed {
    @apply opacity-60;

    & .kanban-card-title {
      @apply line-through;
    }
  }

  /* =============================================
     Card header
     ============================================= */

  .kanban-card-header {
    @apply flex items-start justify-between gap-2 mb-2;
  }

  .kanban-card-title {
    @apply text-sm font-medium m-0;
    color: var(--color-base-content);
    line-height: 1.4;
  }

  .kanban-card-id {
    @apply text-xs font-mono;
    color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
  }

  /* =============================================
     Card body
     ============================================= */

  .kanban-card-body {
    @apply text-xs mb-2;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
  }

  /* =============================================
     Card labels
     ============================================= */

  .kanban-card-labels {
    @apply flex flex-wrap gap-1 mb-2;
  }

  .kanban-card-label {
    @apply inline-block text-xs font-medium;
    padding: 2px 0.5rem;
    border-radius: var(--radius-field);
  }

  .kanban-card-label-primary {
    background-color: color-mix(in oklch, var(--color-primary) 15%, transparent);
    color: var(--color-primary);
  }

  .kanban-card-label-success {
    background-color: color-mix(in oklch, var(--color-success) 15%, transparent);
    color: var(--color-success);
  }

  .kanban-card-label-warning {
    background-color: color-mix(in oklch, var(--color-warning) 15%, transparent);
    color: var(--color-warning);
  }

  .kanban-card-label-error {
    background-color: color-mix(in oklch, var(--color-error) 15%, transparent);
    color: var(--color-error);
  }

  /* =============================================
     Card footer
     ============================================= */

  .kanban-card-footer {
    @apply flex items-center justify-between gap-2 pt-2;
    border-top: 1px solid var(--color-base-300);
  }

  .kanban-card-meta {
    @apply flex items-center gap-3;
  }

  .kanban-card-meta-item {
    @apply flex items-center gap-1 text-xs;
    color: color-mix(in oklch, var(--color-base-content) 40%, transparent);

    & svg {
      @apply w-3.5 h-3.5;
    }
  }

  /* =============================================
     Card assignees
     ============================================= */

  .kanban-card-assignees {
    @apply flex items-center;
  }

  .kanban-card-assignee {
    @apply w-6 h-6 rounded-full overflow-hidden;
    border: 2px solid var(--color-base-100);
    margin-left: -8px;
    background-color: var(--color-base-200);

    &:first-child {
      @apply ml-0;
    }

    & img {
      @apply w-full h-full object-cover;
    }
  }

  .kanban-card-assignee-more {
    @apply flex items-center justify-center w-6 h-6 rounded-full font-semibold;
    font-size: 10px;
    margin-left: -8px;
    border: 2px solid var(--color-base-100);
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
    background-color: var(--color-base-200);
  }

  /* =============================================
     Card priority
     ============================================= */

  .kanban-card-priority {
    @apply flex items-center;
    gap: 2px;

    & svg {
      @apply w-3 h-3;
    }
  }

  .kanban-card-priority-high { color: var(--color-error); }
  .kanban-card-priority-medium { color: var(--color-warning); }
  .kanban-card-priority-low { color: var(--color-success); }

  /* =============================================
     Drop zone
     ============================================= */

  .kanban-drop-zone {
    @apply h-1 rounded-sm;
    background: transparent;
    transition: all 0.15s ease;
  }

  .kanban-drop-zone-active {
    @apply h-10 my-1;
    background-color: color-mix(in oklch, var(--color-primary) 10%, transparent);
    border: 2px dashed var(--color-primary);
  }

  /* =============================================
     Swimlanes
     ============================================= */

  .kanban-swimlane {
    @apply flex flex-col mb-6;
  }

  .kanban-swimlane-header {
    @apply flex items-center gap-2 mb-2;
    padding: 0.5rem 0;
  }

  .kanban-swimlane-title {
    @apply text-xs font-semibold uppercase tracking-wider;
    color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
  }

  .kanban-swimlane-toggle {
    @apply flex items-center justify-center w-6 h-6 border-none rounded-md cursor-pointer;
    background: none;
    color: color-mix(in oklch, var(--color-base-content) 40%, transparent);
    transition: transform 0.15s ease;

    & svg {
      @apply w-4 h-4;
    }
  }

  .kanban-swimlane-toggle-collapsed {
    transform: rotate(-90deg);
  }

  .kanban-swimlane-body {
    @apply flex gap-4 overflow-x-auto;
  }

  .kanban-swimlane-body-collapsed {
    @apply hidden;
  }

  /* =============================================
     Glass variant
     ============================================= */

  .kanban.glass .kanban-column,
  .kanban-glass .kanban-column {
    @apply glass;
    border: 0.5px solid var(--glass-border, rgba(255,255,255,0.18));
  }

  .kanban.glass .kanban-card,
  .kanban-glass .kanban-card {
    background: var(--glass-bg-thick, rgba(255,255,255,0.85));
    backdrop-filter: blur(20px);
    border-color: var(--glass-border, rgba(255,255,255,0.18));
  }
}

/* =============================================
   Responsive
   ============================================= */

@media (max-width: 767px) {
  .kanban {
    @apply p-2;
  }

  .kanban-column {
    width: 280px;
    min-width: 260px;
  }
}

/* =============================================
   Reduced motion
   ============================================= */

@media (prefers-reduced-motion: reduce) {
  .kanban-card,
  .kanban-drop-zone {
    transition: none;
  }
}
