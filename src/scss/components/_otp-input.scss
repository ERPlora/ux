@use '../core/mixins' as *;

/**
 * UX Otp-input Component
 * Part of the UX CSS Library
 */

/* ========================================
   UX OTP Input - Base
   ======================================== */

.ux-otp {
  display: inline-flex;
  gap: var(--ux-space-sm);
  font-family: var(--ux-font-family);

  &__field {
    width: 48px;
    height: 56px;
    padding: 0;
    font-size: 1.5rem;
    font-weight: 600;
    text-align: center;
    background: var(--ux-surface);
    border: 1.5px solid var(--ux-border-color);
    border-radius: var(--ux-radius-md);
    color: var(--ux-text);
    transition: all var(--ux-transition-fast) var(--ux-ease);
    -webkit-appearance: none;
    -moz-appearance: textfield;
    caret-color: var(--ux-primary);

    &::-webkit-outer-spin-button,
    &::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    &::placeholder {
      color: var(--ux-text-tertiary);
    }

    &:focus {
      outline: none;
      border-color: var(--ux-primary);
      box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
    }

    &:hover:not(:focus):not(:disabled) {
      border-color: var(--ux-gray-400);
    }

    /* Filled state */
    &--filled {
      background: var(--ux-surface-secondary);
      border-color: var(--ux-primary);
    }
  }

  /* ========================================
     Separator
     ======================================== */

  &__separator {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    color: var(--ux-text-tertiary);
    font-size: 1.25rem;
    font-weight: 600;
  }

  /* ========================================
     Size Variants
     ======================================== */

  /* Small */
  &--sm {
    .ux-otp__field {
      width: 40px;
      height: 48px;
      font-size: 1.25rem;
    }

    .ux-otp__separator {
      width: 12px;
      font-size: 1rem;
    }
  }

  /* Large */
  &--lg {
    .ux-otp__field {
      width: 56px;
      height: 64px;
      font-size: 1.75rem;
    }

    .ux-otp__separator {
      width: 20px;
      font-size: 1.5rem;
    }
  }

  /* ========================================
     States
     ======================================== */

  /* Success */
  &--success {
    .ux-otp__field {
      border-color: var(--ux-success);

      &:focus {
        box-shadow: 0 0 0 3px rgba(var(--ux-success-rgb), 0.15);
      }
    }
  }

  /* Error */
  &--error {
    .ux-otp__field {
      border-color: var(--ux-danger);
      animation: ux-otp-shake 0.4s ease;

      &:focus {
        box-shadow: 0 0 0 3px rgba(var(--ux-danger-rgb), 0.15);
      }
    }
  }

  /* Disabled */
  &--disabled {
    .ux-otp__field {
      background: var(--ux-surface-secondary);
      color: var(--ux-text-tertiary);
      cursor: not-allowed;
      opacity: 0.6;
    }
  }

  /* Loading */
  &--loading {
    .ux-otp__field {
      pointer-events: none;
      opacity: 0.6;
    }
  }

  /* ========================================
     Variants
     ======================================== */

  /* Underline */
  &--underline {
    .ux-otp__field {
      border: none;
      border-bottom: 2px solid var(--ux-border-color);
      border-radius: 0;
      background: transparent;

      &:focus {
        border-bottom-color: var(--ux-primary);
        box-shadow: none;
      }

      &--filled {
        border-bottom-color: var(--ux-primary);
        background: transparent;
      }
    }

    &.ux-otp--error .ux-otp__field {
      border-bottom-color: var(--ux-danger);
    }

    &.ux-otp--success .ux-otp__field {
      border-bottom-color: var(--ux-success);
    }
  }

  /* Rounded */
  &--rounded {
    .ux-otp__field {
      border-radius: 50%;
      width: 56px;
      height: 56px;
    }

    &.ux-otp--sm .ux-otp__field {
      width: 48px;
      height: 48px;
    }

    &.ux-otp--lg .ux-otp__field {
      width: 64px;
      height: 64px;
    }
  }

  /* ========================================
     Glass Variant
     ======================================== */

  &--glass {
    .ux-otp__field {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border-color: var(--ux-glass-border);

      &:focus {
        background: var(--ux-glass-bg-thick);
      }
    }
  }

  /* ========================================
     Password/Secure Mode
     ======================================== */

  &--secure {
    .ux-otp__field {
      -webkit-text-security: disc;
      font-family: text-security-disc, sans-serif;
    }
  }
}

/* ========================================
   Keyframe Animations
   ======================================== */

@keyframes ux-otp-shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-4px); }
  40%, 80% { transform: translateX(4px); }
}

/* ========================================
   Helper Text
   ======================================== */

.ux-otp-wrapper {
  display: inline-flex;
  flex-direction: column;
  gap: var(--ux-space-sm);
}

.ux-otp__helper {
  font-size: var(--ux-font-size-sm);
  color: var(--ux-text-secondary);
  text-align: center;

  &--error {
    color: var(--ux-danger);
  }

  &--success {
    color: var(--ux-success);
  }
}

/* ========================================
   Resend Timer
   ======================================== */

.ux-otp__resend {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--ux-space-xs);
  font-size: var(--ux-font-size-sm);
  color: var(--ux-text-secondary);
}

.ux-otp__resend-btn {
  background: none;
  border: none;
  padding: 0;
  font: inherit;
  color: var(--ux-primary);
  cursor: pointer;
  text-decoration: underline;

  &:hover {
    color: var(--ux-primary-shade);
  }

  &:disabled {
    color: var(--ux-text-tertiary);
    cursor: not-allowed;
    text-decoration: none;
  }
}

/* ========================================
   Dark Mode
   ======================================== */

@media (prefers-color-scheme: dark) {
  .ux-otp__field {
    background: var(--ux-surface);
    border-color: var(--ux-border-color);

    &--filled {
      background: var(--ux-surface-secondary);
    }
  }
}

.ux-dark .ux-otp__field {
  background: var(--ux-surface);
  border-color: var(--ux-border-color);

  &--filled {
    background: var(--ux-surface-secondary);
  }
}

/* ========================================
   Reduced Motion
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  .ux-otp--error .ux-otp__field {
    animation: none;
  }
}
