@use '../core/mixins' as *;

/**
 * UX Image-zoom Component
 * Part of the UX CSS Library
 */

/* ========================================
   UX Image Zoom Variables
   ======================================== */

:root {
  --ux-image-zoom-lens-size: 150px;
  --ux-image-zoom-lens-border: 2px solid rgba(255, 255, 255, 0.8);
  --ux-image-zoom-lens-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  --ux-image-zoom-zoom-factor: 2.5;
  --ux-image-zoom-transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);
  --ux-image-zoom-result-width: 400px;
  --ux-image-zoom-result-height: 400px;
}

/* ========================================
   UX Image Zoom Container
   ======================================== */

.ux-image-zoom {
  position: relative;
  display: inline-block;
  overflow: visible;
  cursor: zoom-in;
  line-height: 0;

  &--active {
    cursor: none;
  }

  &--fullscreen-active {
    cursor: pointer;
  }

  &--loading .ux-image-zoom__img {
    opacity: 0.5;
  }

  /* Lens square variant */
  &--lens-square .ux-image-zoom__lens {
    border-radius: var(--ux-radius-md);
  }

  /* Inner mode */
  &--inner-mode .ux-image-zoom__inner {
    position: absolute;
    inset: 0;
    background-repeat: no-repeat;
    pointer-events: none;
    opacity: 0;
    visibility: hidden;
    transition:
      opacity var(--ux-image-zoom-transition),
      visibility var(--ux-image-zoom-transition);
    z-index: 1;
  }

  &--inner-mode.ux-image-zoom--active .ux-image-zoom__inner {
    opacity: 1;
    visibility: visible;
  }

  /* Result positions */
  &--result-left .ux-image-zoom__result {
    left: auto;
    right: calc(100% + var(--ux-space-md));
    transform: translateX(10px);
  }

  &--result-left.ux-image-zoom--active .ux-image-zoom__result {
    transform: translateX(0);
  }

  &--result-top .ux-image-zoom__result {
    top: auto;
    bottom: calc(100% + var(--ux-space-md));
    left: 50%;
    transform: translate(-50%, 10px);
  }

  &--result-top.ux-image-zoom--active .ux-image-zoom__result {
    transform: translate(-50%, 0);
  }

  &--result-bottom .ux-image-zoom__result {
    top: calc(100% + var(--ux-space-md));
    left: 50%;
    transform: translate(-50%, -10px);
  }

  &--result-bottom.ux-image-zoom--active .ux-image-zoom__result {
    transform: translate(-50%, 0);
  }
}

/* ========================================
   Image
   ======================================== */

.ux-image-zoom__img {
  display: block;
  max-width: 100%;
  height: auto;
  user-select: none;
  -webkit-user-drag: none;
}

/* ========================================
   Lens Mode (Magnifying Glass)
   ======================================== */

.ux-image-zoom__lens {
  position: absolute;
  width: var(--ux-image-zoom-lens-size);
  height: var(--ux-image-zoom-lens-size);
  border-radius: 50%;
  border: var(--ux-image-zoom-lens-border);
  box-shadow: var(--ux-image-zoom-lens-shadow);
  background-repeat: no-repeat;
  pointer-events: none;
  opacity: 0;
  visibility: hidden;
  transform: translate(-50%, -50%) scale(0.8);
  transition:
    opacity var(--ux-image-zoom-transition),
    visibility var(--ux-image-zoom-transition),
    transform var(--ux-image-zoom-transition);
  z-index: var(--ux-z-tooltip);
  overflow: hidden;
}

.ux-image-zoom--active .ux-image-zoom__lens {
  opacity: 1;
  visibility: visible;
  transform: translate(-50%, -50%) scale(1);
}

/* ========================================
   Result Window (Side Preview)
   ======================================== */

.ux-image-zoom__result {
  position: absolute;
  top: 0;
  left: calc(100% + var(--ux-space-md));
  width: var(--ux-image-zoom-result-width);
  height: var(--ux-image-zoom-result-height);
  background-repeat: no-repeat;
  border: 1px solid var(--ux-border-color);
  border-radius: var(--ux-radius-md);
  box-shadow: var(--ux-shadow-lg);
  background-color: var(--ux-surface);
  pointer-events: none;
  opacity: 0;
  visibility: hidden;
  transform: translateX(-10px);
  transition:
    opacity var(--ux-image-zoom-transition),
    visibility var(--ux-image-zoom-transition),
    transform var(--ux-image-zoom-transition);
  z-index: var(--ux-z-tooltip);
  overflow: hidden;
}

.ux-image-zoom--active .ux-image-zoom__result {
  opacity: 1;
  visibility: visible;
  transform: translateX(0);
}

/* ========================================
   Fullscreen Mode
   ======================================== */

.ux-image-zoom-fullscreen {
  position: fixed;
  inset: 0;
  z-index: var(--ux-z-modal);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 300ms cubic-bezier(0.32, 0.72, 0, 1),
    visibility 300ms cubic-bezier(0.32, 0.72, 0, 1);

  &--open {
    opacity: 1;
    visibility: visible;
  }

  &--hide-ui {
    .ux-image-zoom-fullscreen__header {
      opacity: 0;
      pointer-events: none;
    }

    .ux-image-zoom-fullscreen__controls {
      opacity: 0;
      pointer-events: none;
    }
  }

  &--panning .ux-image-zoom-fullscreen__image-wrapper {
    transition: none;
  }

  &--zoomed .ux-image-zoom-fullscreen__image {
    max-width: none;
    max-height: none;
  }
}

.ux-image-zoom-fullscreen__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.95);
  z-index: -1;
}

.ux-image-zoom-fullscreen__container {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ========================================
   Fullscreen Header
   ======================================== */

.ux-image-zoom-fullscreen__header {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--ux-space-md);
  padding-top: max(var(--ux-space-md), var(--ux-safe-top));
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.5), transparent);
  z-index: 10;
  opacity: 1;
  transition: opacity var(--ux-transition-normal);
}

.ux-image-zoom-fullscreen__title {
  color: white;
  font-size: var(--ux-font-size-md);
  font-weight: 500;
  margin: 0;
}

.ux-image-zoom-fullscreen__zoom-level {
  color: rgba(255, 255, 255, 0.7);
  font-size: var(--ux-font-size-sm);
}

/* ========================================
   Fullscreen Image Container
   ======================================== */

.ux-image-zoom-fullscreen__image-container {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  cursor: grab;
  touch-action: none;

  &:active {
    cursor: grabbing;
  }
}

.ux-image-zoom-fullscreen__image-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 200ms cubic-bezier(0.4, 0, 0.2, 1);
  will-change: transform;
}

.ux-image-zoom-fullscreen__image {
  max-width: 100%;
  max-height: calc(100dvh - 120px);
  object-fit: contain;
  user-select: none;
  -webkit-user-drag: none;
}

/* ========================================
   Fullscreen Controls
   ======================================== */

.ux-image-zoom-fullscreen__controls {
  position: absolute;
  bottom: var(--ux-space-xl);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: var(--ux-space-sm);
  padding: var(--ux-space-sm);
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-radius: var(--ux-radius-full);
  z-index: 10;
  opacity: 1;
  transition: opacity var(--ux-transition-normal);
}

.ux-image-zoom-fullscreen__btn {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: background var(--ux-transition-fast);
  -webkit-tap-highlight-color: transparent;

  &:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  &:active {
    background: rgba(255, 255, 255, 0.3);
  }

  &:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  svg {
    width: 22px;
    height: 22px;
  }
}

.ux-image-zoom-fullscreen__zoom-display {
  color: white;
  font-size: var(--ux-font-size-sm);
  min-width: 48px;
  text-align: center;
  font-weight: 500;
}

/* Close Button */
.ux-image-zoom-fullscreen__close {
  position: absolute;
  top: var(--ux-space-md);
  right: var(--ux-space-md);
  top: max(var(--ux-space-md), var(--ux-safe-top));
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  z-index: 11;
  transition: background var(--ux-transition-fast);

  &:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  svg {
    width: 24px;
    height: 24px;
  }
}

/* ========================================
   Zoom Icon Overlay
   ======================================== */

.ux-image-zoom__icon {
  position: absolute;
  bottom: var(--ux-space-sm);
  right: var(--ux-space-sm);
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.5);
  color: white;
  border-radius: 50%;
  pointer-events: none;
  opacity: 0.8;
  transition: opacity var(--ux-transition-fast);

  svg {
    width: 18px;
    height: 18px;
  }
}

.ux-image-zoom:hover .ux-image-zoom__icon {
  opacity: 1;
}

.ux-image-zoom--active .ux-image-zoom__icon {
  opacity: 0;
}

/* ========================================
   Loading State
   ======================================== */

.ux-image-zoom__spinner {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 32px;
  height: 32px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: ux-image-zoom-spin 0.8s linear infinite;
}

@keyframes ux-image-zoom-spin {
  to { transform: translate(-50%, -50%) rotate(360deg); }
}

/* ========================================
   Mobile Adjustments
   ======================================== */

@media (max-width: 767px) {
  .ux-image-zoom__result {
    display: none;
  }

  .ux-image-zoom__lens {
    --ux-image-zoom-lens-size: 120px;
  }

  .ux-image-zoom-fullscreen__btn {
    width: 40px;
    height: 40px;

    svg {
      width: 20px;
      height: 20px;
    }
  }

  .ux-image-zoom-fullscreen__controls {
    bottom: max(var(--ux-space-lg), var(--ux-safe-bottom));
  }
}

/* ========================================
   Dark Mode
   ======================================== */

@media (prefers-color-scheme: dark) {
  .ux-image-zoom__result {
    background-color: var(--ux-gray-900);
    border-color: var(--ux-gray-700);
  }
}

.ux-dark .ux-image-zoom__result {
  background-color: var(--ux-gray-900);
  border-color: var(--ux-gray-700);
}

/* ========================================
   Reduced Motion
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  .ux-image-zoom__lens,
  .ux-image-zoom__result,
  .ux-image-zoom__inner,
  .ux-image-zoom-fullscreen,
  .ux-image-zoom-fullscreen__image-wrapper {
    transition: none;
  }

  .ux-image-zoom__spinner {
    animation: none;
  }
}
