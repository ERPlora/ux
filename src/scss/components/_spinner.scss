/**
 * UX Spinner Component
 * Part of the UX CSS Library
 */

@use '../core/mixins' as *;

// ========================================
// UX Spinner
// ========================================

:root {
  --ux-spinner-size: 24px;
  --ux-spinner-size-sm: 16px;
  --ux-spinner-size-lg: 32px;
}

.ux-spinner {
  // Internal color variable - defaults to primary, can be overridden by .ux-color-* classes
  // Note: Can't use fallback because --ux-variant-bg is defined as 'transparent' by default
  --_spinner-color: var(--ux-primary);
  --_spinner-color-rgb: var(--ux-primary-rgb);

  display: inline-block;
  width: var(--ux-spinner-size);
  height: var(--ux-spinner-size);
  border: 3px solid rgba(var(--_spinner-color-rgb), 0.2);
  border-top-color: var(--_spinner-color);
  border-radius: 50%;
  animation: ux-spinner-rotate 0.8s linear infinite;

  // ========================================
  // Sizes
  // ========================================

  &--xs {
    width: calc(var(--ux-spinner-size-sm) * 0.8);
    height: calc(var(--ux-spinner-size-sm) * 0.8);
    border-width: 2px;
  }

  &--sm {
    width: var(--ux-spinner-size-sm);
    height: var(--ux-spinner-size-sm);
    border-width: 2px;
  }

  &--lg {
    width: var(--ux-spinner-size-lg);
    height: var(--ux-spinner-size-lg);
    border-width: 4px;
  }

  &--xl {
    width: calc(var(--ux-spinner-size-lg) * 1.4);
    height: calc(var(--ux-spinner-size-lg) * 1.4);
    border-width: 5px;
  }

  // ========================================
  // Color Variants
  // ========================================

  &--primary {
    --_spinner-color: var(--ux-primary);
    --_spinner-color-rgb: var(--ux-primary-rgb);
  }

  &--secondary {
    --_spinner-color: var(--ux-secondary);
    --_spinner-color-rgb: var(--ux-secondary-rgb);
  }

  &--tertiary {
    --_spinner-color: var(--ux-tertiary);
    --_spinner-color-rgb: var(--ux-tertiary-rgb);
  }

  &--success {
    --_spinner-color: var(--ux-success);
    --_spinner-color-rgb: var(--ux-success-rgb);
  }

  &--warning {
    --_spinner-color: var(--ux-warning);
    --_spinner-color-rgb: var(--ux-warning-rgb);
  }

  &--danger {
    --_spinner-color: var(--ux-danger);
    --_spinner-color-rgb: var(--ux-danger-rgb);
  }

  &--dark {
    --_spinner-color: var(--ux-dark);
    --_spinner-color-rgb: var(--ux-dark-rgb);
  }

  &--light,
  &--white {
    --_spinner-color: #ffffff;
    --_spinner-color-rgb: 255, 255, 255;
  }

  // Support for .ux-color-* utility classes
  &[class*="ux-color-"] {
    --_spinner-color: var(--ux-variant-bg);
    --_spinner-color-rgb: var(--ux-variant-bg-rgb);
  }

  // ========================================
  // Dots Spinner
  // ========================================

  &--dots {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    width: auto;
    height: auto;
    border: none;
    animation: none;

    span {
      width: 8px;
      height: 8px;
      background-color: var(--_spinner-color);
      border-radius: 50%;
      animation: ux-spinner-dots 1.4s ease-in-out infinite both;

      &:nth-child(1) {
        animation-delay: -0.32s;
      }

      &:nth-child(2) {
        animation-delay: -0.16s;
      }
    }

    &.ux-spinner--sm span {
      width: 6px;
      height: 6px;
    }

    &.ux-spinner--lg span {
      width: 12px;
      height: 12px;
    }
  }

  // ========================================
  // Bars Spinner
  // ========================================

  &--bars {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    width: auto;
    height: 28px;
    border: none;
    animation: none;

    span {
      width: 4px;
      height: 100%;
      background-color: var(--_spinner-color);
      border-radius: 2px;
      animation: ux-spinner-bars 1.2s ease-in-out infinite;

      &:nth-child(1) { animation-delay: -1.2s; }
      &:nth-child(2) { animation-delay: -1.1s; }
      &:nth-child(3) { animation-delay: -1.0s; }
      &:nth-child(4) { animation-delay: -0.9s; }
    }
  }

  // ========================================
  // iOS Native Style Spinner (12 lines)
  // ========================================

  &--ios {
    position: relative;
    width: var(--ux-spinner-ios-size, 20px);
    height: var(--ux-spinner-ios-size, 20px);
    border: none;
    animation: ux-spinner-ios 1s steps(12) infinite;

    &::before,
    &::after,
    span {
      content: '';
      position: absolute;
      top: 0;
      left: calc(50% - var(--ux-spinner-ios-line-width, 1.5px));
      width: var(--ux-spinner-ios-line-width, 1.5px);
      height: var(--ux-spinner-ios-line-height, 25%);
      background-color: var(--_spinner-color);
      border-radius: var(--ux-spinner-ios-line-radius, 1px);
      transform-origin: center calc(var(--ux-spinner-ios-size, 20px) / 2);
    }

    &::before { opacity: 1; transform: rotate(0deg); }
    &::after { opacity: 0.916; transform: rotate(30deg); }

    span:nth-child(1) { opacity: 0.833; transform: rotate(60deg); }
    span:nth-child(2) { opacity: 0.75; transform: rotate(90deg); }
    span:nth-child(3) { opacity: 0.666; transform: rotate(120deg); }
    span:nth-child(4) { opacity: 0.583; transform: rotate(150deg); }
    span:nth-child(5) { opacity: 0.5; transform: rotate(180deg); }
    span:nth-child(6) { opacity: 0.416; transform: rotate(210deg); }
    span:nth-child(7) { opacity: 0.333; transform: rotate(240deg); }
    span:nth-child(8) { opacity: 0.25; transform: rotate(270deg); }
    span:nth-child(9) { opacity: 0.166; transform: rotate(300deg); }
    span:nth-child(10) { opacity: 0.083; transform: rotate(330deg); }

    &.ux-spinner--sm {
      --ux-spinner-ios-size: 16px;
      --ux-spinner-ios-line-width: 1.2px;
    }

    &.ux-spinner--lg {
      --ux-spinner-ios-size: 28px;
      --ux-spinner-ios-line-width: 2px;
    }
  }

  // ========================================
  // Inline Spinner (for buttons, inputs)
  // ========================================

  &--inline {
    vertical-align: middle;
    margin-right: var(--ux-space-sm);
  }

  // ========================================
  // Paused State
  // ========================================

  &--paused {
    animation-play-state: paused;

    span {
      animation-play-state: paused;
    }
  }
}

// ========================================
// Keyframes
// ========================================

@keyframes ux-spinner-rotate {
  to {
    transform: rotate(360deg);
  }
}

@keyframes ux-spinner-dots {
  0%, 80%, 100% {
    transform: scale(0);
    opacity: 0.5;
  }
  40% {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes ux-spinner-bars {
  0%, 40%, 100% {
    transform: scaleY(0.4);
  }
  20% {
    transform: scaleY(1);
  }
}

@keyframes ux-spinner-ios {
  to {
    transform: rotate(360deg);
  }
}

// ========================================
// Spinner Container
// ========================================

.ux-spinner-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--ux-space-md);
  padding: var(--ux-space-xl);

  &__text {
    font-size: var(--ux-font-size-sm);
    color: var(--ux-text-secondary);
  }
}

// ========================================
// Full Page Spinner
// ========================================

.ux-spinner-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(var(--ux-background-rgb), 0.8);
  z-index: var(--ux-z-modal);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
}

// ========================================
// Reduced motion support
// ========================================

@media (prefers-reduced-motion: reduce) {
  .ux-spinner {
    animation: none;
    border-top-color: var(--_spinner-color);
    opacity: 0.8;
  }

  .ux-spinner--dots span {
    animation: none;
    opacity: 0.7;
  }

  .ux-spinner--bars span {
    animation: none;
    transform: scaleY(0.7);
  }

  .ux-spinner--ios {
    animation: none;
  }
}
