@use '../core/mixins' as *;

/**
 * UX Input Component
 * Part of the UX CSS Library
 */

/* ========================================
   UX Input - Base Styles (direct on input)
   ======================================== */

.ux-input,
.ux-input__field,
input.ux-input,
textarea.ux-input,
select.ux-input {
  width: 100%;
  height: var(--ux-input-height);
  padding: var(--ux-input-padding-y) var(--ux-input-padding-x);
  font-family: var(--ux-font-family);
  font-size: var(--ux-input-font-size);
  line-height: 1.5;
  color: var(--ux-text);
  background-color: var(--ux-surface);
  border: 1px solid var(--ux-border-color);
  border-radius: var(--ux-border-radius);
  outline: none;
  transition:
    border-color var(--ux-transition-fast) var(--ux-ease),
    box-shadow var(--ux-transition-fast) var(--ux-ease),
    background-color var(--ux-transition-fast) var(--ux-ease);
  -webkit-appearance: none;
  appearance: none;
}

.ux-input,
.ux-input__field,
input.ux-input,
textarea.ux-input {
  &::placeholder {
    color: var(--ux-text-tertiary);
  }
}

.ux-input,
.ux-input__field,
input.ux-input,
textarea.ux-input,
select.ux-input {
  &:hover {
    border-color: var(--ux-medium);
  }

  &:focus {
    border-color: var(--ux-primary);
    box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.15);
  }

  &:disabled {
    background-color: var(--ux-light);
    color: var(--ux-text-tertiary);
    cursor: not-allowed;
    opacity: 0.6;
  }
}

.ux-input,
.ux-input__field,
input.ux-input,
textarea.ux-input {
  &[readonly] {
    background-color: var(--ux-light);
    cursor: default;
  }
}

/* .ux-input as container (when wrapping .ux-input__field) */
div.ux-input:has(.ux-input__field) {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: auto;
  padding: 0;
  border: none;
  border-radius: 0;
  background: none;
  box-shadow: none;
}

/* Size variants for direct input */
.ux-input--sm,
input.ux-input--sm,
textarea.ux-input--sm {
  height: var(--ux-input-height-sm);
  padding: var(--ux-input-padding-y-sm) var(--ux-input-padding-x-sm);
  font-size: var(--ux-input-font-size-sm);
}

.ux-input--lg,
input.ux-input--lg,
textarea.ux-input--lg {
  height: var(--ux-input-height-lg);
  padding: var(--ux-input-padding-y-lg) var(--ux-input-padding-x-lg);
  font-size: var(--ux-input-font-size-lg);
}

/* Variant styles for direct input */
.ux-input--filled,
input.ux-input--filled,
textarea.ux-input--filled {
  background-color: var(--ux-surface-secondary);
  border-color: transparent;
  border-radius: var(--ux-border-radius) var(--ux-border-radius) 0 0;
  border-bottom: 2px solid var(--ux-border-color);

  &:focus {
    border-bottom-color: var(--ux-primary);
    box-shadow: none;
  }
}

.ux-input--outline,
input.ux-input--outline,
textarea.ux-input--outline {
  background-color: transparent;
}

.ux-input--underline,
input.ux-input--underline,
textarea.ux-input--underline {
  background-color: transparent;
  border: none;
  border-bottom: 1px solid var(--ux-border-color);
  border-radius: 0;
  padding-left: 0;
  padding-right: 0;

  &:focus {
    border-bottom-color: var(--ux-primary);
    border-bottom-width: 2px;
    box-shadow: none;
  }
}

/* ========================================
   Glass Variant (iOS 26 Liquid Glass)
   ======================================== */

/* Glass variant - higher specificity to override base styles */
.ux-input.ux-input--glass,
input.ux-input.ux-input--glass,
textarea.ux-input.ux-input--glass,
select.ux-input.ux-input--glass {
  background: var(--ux-glass-bg-thin);
  backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
  -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
  border: 0.5px solid var(--ux-glass-border);
  color: #fff;
}

.ux-input.ux-input--glass,
input.ux-input.ux-input--glass,
textarea.ux-input.ux-input--glass {
  &::placeholder {
    color: rgba(255, 255, 255, 0.5);
  }
}

.ux-input.ux-input--glass,
input.ux-input.ux-input--glass,
textarea.ux-input.ux-input--glass,
select.ux-input.ux-input--glass {
  &:hover {
    background: var(--ux-glass-bg);
  }

  &:focus {
    background: var(--ux-glass-bg);
    border-color: var(--ux-glass-border);
    box-shadow: var(--ux-glass-highlight);
  }
}

/* Textarea specific */
textarea.ux-input {
  height: auto;
  min-height: 100px;
  max-height: none;
  resize: vertical;
}

/* ========================================
   UX Input Group (wrapper structure)
   ======================================== */

.ux-input-group {
  display: flex;
  flex-direction: column;
  width: 100%;

  &--horizontal {
    flex-direction: row;
    align-items: stretch;

    .ux-input {
      flex: 1;
      border-radius: 0;

      &:first-child {
        border-radius: var(--ux-border-radius) 0 0 var(--ux-border-radius);
      }

      &:last-child {
        border-radius: 0 var(--ux-border-radius) var(--ux-border-radius) 0;
      }
    }

    .ux-input-wrapper:first-child .ux-input {
      border-radius: var(--ux-border-radius) 0 0 var(--ux-border-radius);
    }

    .ux-input-wrapper:last-child .ux-input {
      border-radius: 0 var(--ux-border-radius) var(--ux-border-radius) 0;
    }
  }

  &--error {
    .ux-input,
    input.ux-input {
      border-color: var(--ux-danger);

      &:focus {
        box-shadow: 0 0 0 3px rgba(var(--ux-danger-rgb), 0.15);
      }
    }

    .ux-input__label {
      color: var(--ux-danger);
    }
  }

  &--success {
    .ux-input,
    input.ux-input {
      border-color: var(--ux-success);

      &:focus {
        box-shadow: 0 0 0 3px rgba(var(--ux-success-rgb), 0.15);
      }
    }
  }

  &--warning {
    .ux-input,
    input.ux-input {
      border-color: var(--ux-warning);
    }
  }

  &--floating {
    position: relative;

    .ux-input {
      padding-top: 20px;
      padding-bottom: 4px;
      height: auto;
      min-height: var(--ux-input-height);
    }

    .ux-input__label {
      position: absolute;
      top: 50%;
      left: var(--ux-input-padding-x, 12px);
      transform: translateY(-50%);
      margin: 0;
      padding: 0 2px;
      font-size: var(--ux-font-size-md);
      color: var(--ux-text-tertiary);
      background: transparent;
      pointer-events: none;
      z-index: 1;
      transition:
        top var(--ux-transition-fast) var(--ux-ease),
        font-size var(--ux-transition-fast) var(--ux-ease),
        color var(--ux-transition-fast) var(--ux-ease),
        transform var(--ux-transition-fast) var(--ux-ease),
        background var(--ux-transition-fast) var(--ux-ease);
    }

    .ux-input:focus ~ .ux-input__label,
    .ux-input:not(:placeholder-shown) ~ .ux-input__label {
      top: 0;
      transform: translateY(-50%);
      font-size: var(--ux-font-size-xs);
      color: var(--ux-primary);
      background: var(--ux-surface);
    }

    // Error state for floating
    &.ux-input-group--error {
      .ux-input:focus ~ .ux-input__label,
      .ux-input:not(:placeholder-shown) ~ .ux-input__label {
        color: var(--ux-danger);
      }
    }
  }

  &__addon {
    display: flex;
    align-items: center;
    padding: 0 var(--ux-space-md);
    background-color: var(--ux-surface-secondary);
    border: 1px solid var(--ux-border-color);
    color: var(--ux-text-secondary);
    font-size: var(--ux-font-size-sm);
    white-space: nowrap;

    &:first-child {
      border-right: none;
      border-radius: var(--ux-border-radius) 0 0 var(--ux-border-radius);
    }

    &:last-child {
      border-left: none;
      border-radius: 0 var(--ux-border-radius) var(--ux-border-radius) 0;
    }
  }
}

/* ========================================
   Label
   ======================================== */

.ux-input__label {
  display: block;
  margin-bottom: var(--ux-space-xs);
  font-size: var(--ux-font-size-sm);
  font-weight: 500;
  color: var(--ux-text-secondary);

  &--required::after {
    content: ' *';
    color: var(--ux-danger);
  }
}

/* ========================================
   Helper & Error Text
   ======================================== */

.ux-input__helper {
  margin-top: var(--ux-space-xs);
  font-size: var(--ux-font-size-sm);
  color: var(--ux-text-secondary);
}

.ux-input__error {
  margin-top: var(--ux-space-xs);
  font-size: var(--ux-font-size-sm);
  color: var(--ux-danger);
}

.ux-input__counter {
  margin-top: var(--ux-space-xs);
  font-size: var(--ux-font-size-xs);
  color: var(--ux-text-tertiary);
  text-align: right;
}

/* ========================================
   Input Wrapper (for icons, password toggle)
   ======================================== */

.ux-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;

  .ux-input {
    width: 100%;
  }

  &--icon-start {
    .ux-input__icon {
      left: var(--ux-space-md);
    }

    .ux-input {
      padding-left: calc(var(--ux-space-lg) + 24px);
    }
  }

  &--icon-end {
    .ux-input__icon {
      right: var(--ux-space-md);
    }

    .ux-input {
      padding-right: calc(var(--ux-space-lg) + 24px);
    }
  }

  &--clearable .ux-input {
    padding-right: calc(var(--ux-space-lg) + 28px);
  }
}

.ux-input__icon {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  color: var(--ux-text-tertiary);
  pointer-events: none;

  svg {
    width: 100%;
    height: 100%;
  }
}

/* ========================================
   Password Toggle
   ======================================== */

.ux-input-password {
  position: relative;
  width: 100%;

  .ux-input {
    padding-right: calc(var(--ux-space-lg) + 32px);
  }

  &__toggle {
    position: absolute;
    top: 50%;
    right: var(--ux-space-md);
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    padding: 0;
    border: none;
    background: transparent;
    color: var(--ux-text-tertiary);
    cursor: pointer;
    border-radius: var(--ux-border-radius-sm);
    transition: color var(--ux-transition-fast) var(--ux-ease);

    &:hover {
      color: var(--ux-text-secondary);
    }

    svg {
      width: 20px;
      height: 20px;
    }
  }
}

/* ========================================
   Clearable
   ======================================== */

.ux-input__clear {
  position: absolute;
  top: 50%;
  right: var(--ux-space-md);
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  padding: 0;
  border: none;
  background: var(--ux-medium);
  border-radius: 50%;
  color: white;
  cursor: pointer;
  opacity: 0;
  transition: opacity var(--ux-transition-fast) var(--ux-ease);

  svg {
    width: 12px;
    height: 12px;
  }
}

.ux-input:not(:placeholder-shown) ~ .ux-input__clear {
  opacity: 1;
}

/* ========================================
   Date/Time Input Icons (Native Browser)
   ======================================== */

/* Webkit browsers (Chrome, Safari, Edge) */
input.ux-input[type="date"],
input.ux-input[type="time"],
input.ux-input[type="datetime-local"],
input.ux-input[type="month"],
input.ux-input[type="week"] {
  &::-webkit-calendar-picker-indicator {
    cursor: pointer;
    opacity: 0.6;
    filter: opacity(0.5);
    transition: opacity var(--ux-transition-fast) var(--ux-ease);

    &:hover {
      opacity: 1;
    }
  }
}

/* Dark mode support for date/time icons */
.ux-dark {
  input.ux-input[type="date"],
  input.ux-input[type="time"],
  input.ux-input[type="datetime-local"],
  input.ux-input[type="month"],
  input.ux-input[type="week"] {
    &::-webkit-calendar-picker-indicator {
      filter: invert(1) opacity(0.6);
    }
  }
}

/* Also support data-theme dark */
[data-theme="dark"] {
  input.ux-input[type="date"],
  input.ux-input[type="time"],
  input.ux-input[type="datetime-local"],
  input.ux-input[type="month"],
  input.ux-input[type="week"] {
    &::-webkit-calendar-picker-indicator {
      filter: invert(1) opacity(0.6);
    }
  }
}

/* ========================================
   Reduced Motion
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  .ux-input,
  input.ux-input,
  textarea.ux-input,
  select.ux-input {
    transition: none;
  }

  .ux-input-group--floating .ux-input__label {
    transition: none;
  }

  .ux-input-password__toggle {
    transition: none;
  }

  .ux-input__clear {
    transition: none;
  }
}
