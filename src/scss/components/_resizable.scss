@use '../core/mixins' as *;

/**
 * UX Resizable Component
 * Part of the UX CSS Library
 *
 * Resizable panels with drag handles.
 * Works with any framework: HTMX, React, Vue, vanilla JS.
 *
 * Usage:
 * <div class="ux-resizable">
 *   <div class="ux-resizable__panel">Panel 1</div>
 *   <div class="ux-resizable__handle"></div>
 *   <div class="ux-resizable__panel">Panel 2</div>
 * </div>
 */

/* ========================================
   CSS Variables
   ======================================== */

:root {
  --ux-resizable-handle-size: 4px;
  --ux-resizable-handle-hit-area: 12px;
  --ux-resizable-handle-color: var(--ux-border-color);
  --ux-resizable-handle-hover-color: var(--ux-primary);
  --ux-resizable-grip-size: 16px;
}

/* ========================================
   UX Resizable Panel Group
   ======================================== */

.ux-resizable {
  display: flex;
  width: 100%;
  height: 100%;

  /* Vertical layout */
  &--vertical {
    flex-direction: column;
  }

  /* ========================================
     Panel
     ======================================== */

  &__panel {
    flex: 1 1 auto;
    overflow: hidden;

    /* Sized panel */
    &[style*="flex-basis"],
    &[data-panel-size] {
      flex: 0 0 auto;
    }

    /* Collapsible panel */
    &[data-collapsed="true"] {
      flex-basis: 0 !important;
      overflow: hidden;
    }

    /* Min/max constraints via CSS variables */
    min-width: var(--ux-panel-min-width, 0);
    max-width: var(--ux-panel-max-width, none);
    min-height: var(--ux-panel-min-height, 0);
    max-height: var(--ux-panel-max-height, none);
  }

  /* ========================================
     Handle (Horizontal - default)
     ======================================== */

  &__handle {
    position: relative;
    flex: 0 0 var(--ux-resizable-handle-size);
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--ux-resizable-handle-color);
    cursor: col-resize;
    user-select: none;
    touch-action: none;
    transition: background-color var(--ux-transition-fast) var(--ux-ease);

    /* Hit area */
    &::before {
      content: '';
      position: absolute;
      inset: 0;
      width: var(--ux-resizable-handle-hit-area);
      left: 50%;
      transform: translateX(-50%);
    }

    &:hover,
    &:focus-visible,
    &[data-dragging="true"] {
      background-color: var(--ux-resizable-handle-hover-color);
    }

    &:focus-visible {
      outline: 2px solid var(--ux-primary);
      outline-offset: 2px;
    }
  }

  /* Vertical handle */
  &--vertical > &__handle {
    cursor: row-resize;

    &::before {
      width: auto;
      height: var(--ux-resizable-handle-hit-area);
      inset: auto 0;
      top: 50%;
      transform: translateY(-50%);
    }
  }

  /* ========================================
     Grip Handle (with visual grip)
     ======================================== */

  &__grip {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 12px;
    height: var(--ux-resizable-grip-size);
    background-color: var(--ux-surface);
    border: 1px solid var(--ux-border-color);
    border-radius: var(--ux-border-radius-sm);
    z-index: 1;

    svg {
      width: 10px;
      height: 10px;
      color: var(--ux-text-tertiary);
    }

    &:hover svg,
    .ux-resizable__handle:hover & svg,
    .ux-resizable__handle[data-dragging="true"] & svg {
      color: var(--ux-text-secondary);
    }
  }

  &--vertical &__grip {
    width: var(--ux-resizable-grip-size);
    height: 12px;

    svg {
      transform: rotate(90deg);
    }
  }

  /* ========================================
     Handle Variants
     ======================================== */

  /* Hidden handle (invisible but still interactive) */
  &__handle--hidden {
    background-color: transparent;

    &:hover {
      background-color: var(--ux-resizable-handle-hover-color);
    }
  }

  /* Bordered handle */
  &__handle--bordered {
    background-color: transparent;
    border-left: 1px solid var(--ux-border-color);

    &:hover {
      border-color: var(--ux-resizable-handle-hover-color);
      background-color: rgba(var(--ux-primary-rgb), 0.05);
    }
  }

  &--vertical > &__handle--bordered {
    border-left: none;
    border-top: 1px solid var(--ux-border-color);
  }

  /* Dotted handle */
  &__handle--dotted {
    background-color: transparent;
    background-image: radial-gradient(
      circle,
      var(--ux-text-tertiary) 1px,
      transparent 1px
    );
    background-size: 4px 4px;
    background-position: center;

    &:hover {
      background-image: radial-gradient(
        circle,
        var(--ux-primary) 1px,
        transparent 1px
      );
    }
  }

  /* ========================================
     Sizes
     ======================================== */

  &--sm &__handle {
    flex-basis: 2px;
  }

  &--lg &__handle {
    flex-basis: 8px;
  }

  /* ========================================
     Nested Resizable
     ======================================== */

  &__panel > & {
    width: 100%;
    height: 100%;
  }

  /* ========================================
     Collapse Buttons
     ======================================== */

  &__collapse-button {
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    background-color: var(--ux-surface);
    border: 1px solid var(--ux-border-color);
    border-radius: 50%;
    cursor: pointer;
    z-index: 2;
    transition:
      background-color var(--ux-transition-fast) var(--ux-ease),
      transform var(--ux-transition-fast) var(--ux-ease);

    svg {
      width: 12px;
      height: 12px;
      color: var(--ux-text-secondary);
    }

    &:hover {
      background-color: var(--ux-surface-secondary);

      svg {
        color: var(--ux-text);
      }
    }

    /* Position on horizontal handle */
    top: 50%;
    transform: translateY(-50%);

    &--start {
      left: -10px;
    }

    &--end {
      right: -10px;
    }
  }

  &--vertical &__collapse-button {
    top: auto;
    left: 50%;
    transform: translateX(-50%);

    &--start {
      top: -10px;
    }

    &--end {
      bottom: -10px;
    }
  }

  /* ========================================
     Glass Variant
     ======================================== */

  &--glass &__handle {
    background-color: var(--ux-glass-border);
  }

  &--glass &__grip {
    background-color: var(--ux-glass-bg);
    backdrop-filter: blur(var(--ux-glass-blur));
    -webkit-backdrop-filter: blur(var(--ux-glass-blur));
    border-color: var(--ux-glass-border);
  }

  /* ========================================
     Disabled State
     ======================================== */

  &--disabled &__handle {
    cursor: default;
    pointer-events: none;
    opacity: 0.5;
  }
}

/* ========================================
   Dragging State (on body)
   ======================================== */

body[data-resizing="horizontal"] {
  cursor: col-resize;
  user-select: none;

  * {
    cursor: col-resize !important;
  }
}

body[data-resizing="vertical"] {
  cursor: row-resize;
  user-select: none;

  * {
    cursor: row-resize !important;
  }
}

/* ========================================
   Reduced Motion
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  .ux-resizable__handle,
  .ux-resizable__grip,
  .ux-resizable__collapse-button {
    transition: none;
  }
}
