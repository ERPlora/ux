/**
 * UX Sheet Component
 * Part of the UX CSS Library
 * https://github.com/user/ux
 */

/* ========================================
   UX Sheet Backdrop
   ======================================== */

.ux-sheet-backdrop {
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.4);
  z-index: var(--ux-z-modal-backdrop);
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 350ms var(--ux-ease-ios),
    visibility 350ms var(--ux-ease-ios);

  &--open,
  &[data-state="open"],
  &[aria-hidden="false"],
  &.is-open {
    opacity: 1;
    visibility: visible;
    transition:
      opacity 300ms var(--ux-ease-ios),
      visibility 300ms var(--ux-ease-ios);

    .ux-sheet {
      transform: translateY(0);
      // Slightly slower for opening - feels more natural
      transition: transform 400ms var(--ux-ease-ios);
    }

    .ux-side-sheet--left,
    .ux-side-sheet--right {
      transform: translateX(0);
      // Slightly slower for opening
      transition: transform 400ms var(--ux-ease-ios);
    }

    .ux-action-sheet {
      transform: translateY(0);
      // Slightly slower for opening
      transition: transform 400ms var(--ux-ease-ios);
    }

    .ux-side-sheet-container [class*="col"] {
      transform: translateX(0);
      transition: transform 400ms var(--ux-ease-ios);
    }
  }

  // ========================================
  // Bootstrap Grid Support
  // ========================================

  &.ux-sheet-backdrop--grid {
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    overflow-x: hidden;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;

    > .container,
    > .container-fluid {
      width: 100%;
      max-width: 100%;
      padding-bottom: calc(var(--ux-space-lg) + env(safe-area-inset-bottom));
    }

    .row {
      margin-left: 0;
      margin-right: 0;
    }

    // Bottom sheet with grid - override fixed positioning
    .ux-sheet {
      position: static;
      left: auto;
      right: auto;
      bottom: auto;
      transform: translateY(100%);
      margin: 0;
      width: 100%;
    }

    &.ux-sheet-backdrop--open .ux-sheet,
    &[data-state="open"] .ux-sheet,
    &[aria-hidden="false"] .ux-sheet,
    &.is-open .ux-sheet {
      transform: translateY(0);
    }

    // Action sheet with grid - override fixed positioning
    .ux-action-sheet {
      position: static;
      left: auto;
      right: auto;
      bottom: auto;
      transform: translateY(calc(100% + var(--ux-space-lg)));
      margin: 0;
      width: 100%;
      will-change: transform;
    }

    &.ux-sheet-backdrop--open .ux-action-sheet,
    &[data-state="open"] .ux-action-sheet,
    &[aria-hidden="false"] .ux-action-sheet,
    &.is-open .ux-action-sheet {
      transform: translateY(0);
      will-change: auto;
    }
  }
}

/* ========================================
   UX Bottom Sheet
   ======================================== */

.ux-sheet {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  max-height: var(--ux-modal-max-height);
  // Glass by default (iOS style)
  background-color: var(--ux-glass-bg);
  backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
  -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
  border-radius: var(--ux-sheet-border-radius) var(--ux-sheet-border-radius) 0 0;
  border-top: 0.5px solid var(--ux-glass-border);
  box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
  display: flex;
  flex-direction: column;
  z-index: var(--ux-z-modal);
  transform: translateY(100%);
  // iOS-style smooth transition for closing
  transition: transform 350ms var(--ux-ease-ios);
  padding-bottom: env(safe-area-inset-bottom);
  will-change: transform;

  // Fallback for browsers without backdrop-filter
  @supports not (backdrop-filter: blur(1px)) {
    background-color: var(--ux-surface);
  }

  // ========================================
  // Sheet Handle
  // ========================================

  &__handle {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--ux-space-sm) 0;
    cursor: grab;
    flex-shrink: 0;

    &:active {
      cursor: grabbing;
    }
  }

  &__handle-bar {
    width: var(--ux-sheet-handle-width);
    height: var(--ux-sheet-handle-height);
    background-color: var(--ux-light-shade);
    border-radius: calc(var(--ux-sheet-handle-height) / 2);
  }

  // ========================================
  // Sheet Header
  // ========================================

  &__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--ux-space-sm) var(--ux-space-lg);
    border-bottom: 0.5px solid var(--ux-glass-border);
    flex-shrink: 0;

    &--no-border {
      border-bottom: none;
    }
  }

  &__title {
    font-size: var(--ux-font-size-lg);
    font-weight: 600;
    color: var(--ux-text);
    margin: 0;
  }

  &__close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    padding: 0;
    background-color: var(--ux-surface-secondary);
    border: none;
    border-radius: 50%;
    color: var(--ux-text-secondary);
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
    transition: background-color var(--ux-transition-fast) var(--ux-ease);

    &:hover {
      background-color: var(--ux-light);
    }

    &:active {
      background-color: var(--ux-light-shade);
    }
  }

  &__close-icon {
    width: 18px;
    height: 18px;

    svg {
      width: 100%;
      height: 100%;
    }
  }

  // ========================================
  // Sheet Content
  // ========================================

  &__content {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: var(--ux-space-lg);

    &--no-padding {
      padding: 0;
    }
  }

  // ========================================
  // Sheet Footer
  // ========================================

  &__footer {
    display: flex;
    flex-direction: column;
    gap: var(--ux-space-sm);
    padding: var(--ux-space-md) var(--ux-space-lg);
    border-top: 0.5px solid var(--ux-glass-border);
    flex-shrink: 0;

    &--row {
      flex-direction: row;
      justify-content: flex-end;

      .ux-button {
        width: auto;
        flex: 1;
      }
    }

    .ux-button {
      width: 100%;
    }
  }

  // ========================================
  // Sheet Sizes
  // ========================================

  &--sm {
    height: 40dvh;
    max-height: 40dvh;
  }

  &--md {
    height: 60dvh;
    max-height: 60dvh;
  }

  &--lg {
    height: 80dvh;
    max-height: 80dvh;
  }

  &--full {
    height: 100dvh;
    max-height: 100dvh;
    border-radius: 0;
  }

  // Auto height based on content
  &--auto {
    height: auto;
    max-height: 90dvh;
  }

  // ========================================
  // Sheet Detents (snap points)
  // ========================================

  &--detent-small {
    max-height: 25dvh;
  }

  &--detent-medium {
    max-height: 50dvh;
  }

  &--detent-large {
    max-height: 90dvh;
  }

  // ========================================
  // Glass Sheet (iOS 26 Liquid Glass)
  // ========================================

  // Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js
  // Sheet uses heavier blur for prominence
  &--glass {
    backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
    -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
    border-top: 0.5px solid var(--ux-glass-border);
    box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);

    .ux-sheet__header {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-sheet__footer {
      border-top-color: var(--ux-glass-border);
    }

    .ux-sheet__handle-bar {
      background-color: rgba(0, 0, 0, 0.2);
    }
  }

  // ========================================
  // Sheet with Scroll Lock Indicator
  // ========================================

  &--scroll-lock .ux-sheet__content {
    overscroll-behavior-y: contain;
  }

  // Sheet dragging state
  &--dragging {
    transition: none !important;
  }
}

// Dark mode glass sheet
@media (prefers-color-scheme: dark) {
  .ux-sheet--glass .ux-sheet__handle-bar {
    background-color: rgba(255, 255, 255, 0.3);
  }
}

.ux-dark .ux-sheet--glass .ux-sheet__handle-bar {
  background-color: rgba(255, 255, 255, 0.3);
}

/* ========================================
   Side Sheet
   ======================================== */

.ux-side-sheet {
  position: fixed;
  top: 0;
  bottom: 0;
  width: 320px;
  max-width: 85dvw;
  // Glass by default (iOS style)
  background-color: var(--ux-glass-bg);
  backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
  -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
  box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
  display: flex;
  flex-direction: column;
  z-index: var(--ux-z-modal);
  // iOS-style smooth transition for closing
  transition: transform 350ms var(--ux-ease-ios);
  will-change: transform;

  // Fallback for browsers without backdrop-filter
  @supports not (backdrop-filter: blur(1px)) {
    background-color: var(--ux-surface);
  }

  &--left {
    left: 0;
    border-radius: 0 var(--ux-border-radius-xl) var(--ux-border-radius-xl) 0;
    transform: translateX(-100%);
  }

  &--right {
    right: 0;
    border-radius: var(--ux-border-radius-xl) 0 0 var(--ux-border-radius-xl);
    transform: translateX(100%);
  }

  // Side Sheet Header
  &__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 56px;
    padding: var(--ux-space-md) var(--ux-space-lg);
    padding-top: calc(var(--ux-space-md) + env(safe-area-inset-top));
    border-bottom: 0.5px solid var(--ux-glass-border);
    flex-shrink: 0;
  }

  &__content {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  &__footer {
    padding: var(--ux-space-md) var(--ux-space-lg);
    padding-bottom: calc(var(--ux-space-md) + env(safe-area-inset-bottom));
    border-top: 0.5px solid var(--ux-glass-border);
    flex-shrink: 0;
  }

  // Grid variant
  &--grid {
    position: relative;
    width: 100%;
    height: 100%;
    max-width: none;
    border-radius: 0;
    transform: none;
  }
}

/* ========================================
   Side Sheet with Bootstrap Grid
   ======================================== */

.ux-side-sheet-container {
  position: fixed;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: var(--ux-z-modal);
  pointer-events: none;
  overflow: hidden;

  > .row {
    height: 100%;
    margin: 0;
  }

  [class*="col"] {
    padding: 0;
    height: 100%;
    pointer-events: auto;
  }

  // Left side sheet (default)
  &--left [class*="col"] {
    transform: translateX(-100%);
    transition: transform 350ms var(--ux-ease-ios);
  }

  // Right side sheet
  &--right {
    > .row {
      justify-content: flex-end;
    }

    [class*="col"] {
      transform: translateX(100%);
      transition: transform 350ms var(--ux-ease-ios);
    }
  }

  // Border radius for grid side sheets
  &--left .ux-side-sheet--grid {
    border-radius: 0 var(--ux-border-radius-xl) var(--ux-border-radius-xl) 0;
  }

  &--right .ux-side-sheet--grid {
    border-radius: var(--ux-border-radius-xl) 0 0 var(--ux-border-radius-xl);
  }
}

/* ========================================
   Action Sheet
   ======================================== */

.ux-action-sheet {
  position: fixed;
  left: var(--ux-space-sm);
  right: var(--ux-space-sm);
  bottom: var(--ux-space-sm);
  display: flex;
  flex-direction: column;
  gap: var(--ux-space-sm);
  z-index: var(--ux-z-modal);
  transform: translateY(calc(100% + var(--ux-space-lg)));
  // iOS-style smooth transition for closing
  transition: transform 350ms var(--ux-ease-ios);
  padding-bottom: env(safe-area-inset-bottom);
  will-change: transform;

  &__group {
    // Glass by default (iOS style)
    background-color: var(--ux-glass-bg);
    backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
    -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
    border: 0.5px solid var(--ux-glass-border);
    box-shadow: var(--ux-glass-shadow);
    border-radius: var(--ux-border-radius-lg);
    overflow: hidden;

    // Fallback for browsers without backdrop-filter
    @supports not (backdrop-filter: blur(1px)) {
      background-color: var(--ux-surface);
    }
  }

  &__header {
    padding: var(--ux-space-md) var(--ux-space-lg);
    text-align: center;
    border-bottom: 0.5px solid var(--ux-glass-border);
  }

  &__title {
    font-size: var(--ux-font-size-sm);
    font-weight: 600;
    color: var(--ux-text-secondary);
    margin: 0;
  }

  &__message {
    font-size: var(--ux-font-size-sm);
    color: var(--ux-text-tertiary);
    margin: var(--ux-space-xs) 0 0;
  }

  &__button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 56px;
    padding: var(--ux-space-md) var(--ux-space-lg);
    background: none;
    border: none;
    color: var(--ux-primary);
    font-family: var(--ux-font-family);
    font-size: var(--ux-font-size-lg);
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
    transition: background-color var(--ux-transition-fast) var(--ux-ease);

    &:not(:last-child) {
      border-bottom: 0.5px solid var(--ux-glass-border);
    }

    &:hover {
      background-color: var(--ux-surface-secondary);
    }

    &:active {
      background-color: var(--ux-light);
    }

    &--destructive {
      color: var(--ux-danger);
    }

    &--cancel {
      font-weight: 600;
    }
  }

  &__button-icon {
    width: 24px;
    height: 24px;
    margin-right: var(--ux-space-md);

    svg {
      width: 100%;
      height: 100%;
    }
  }

  // ========================================
  // Glass Action Sheet (iOS 26 Liquid Glass)
  // ========================================

  // Note: backdrop-filter and glass background come from universal selector [class*="--glass"] in ux-core.js
  // Action sheet uses heavier blur for prominence
  &--glass {
    .ux-action-sheet__group {
      backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur-heavy)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow);
    }

    .ux-action-sheet__header {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-action-sheet__button:not(:last-child) {
      border-bottom-color: var(--ux-glass-border);
    }

    .ux-action-sheet__button:hover {
      background-color: rgba(0, 0, 0, 0.04);
    }
  }
}

// Dark mode glass action sheet
@media (prefers-color-scheme: dark) {
  .ux-action-sheet--glass .ux-action-sheet__button:hover {
    background-color: rgba(255, 255, 255, 0.08);
  }
}

.ux-dark .ux-action-sheet--glass .ux-action-sheet__button:hover {
  background-color: rgba(255, 255, 255, 0.08);
}

/* ========================================
   Reduced Motion Support
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  .ux-sheet-backdrop {
    transition: opacity 0.1s ease, visibility 0.1s ease;
  }

  .ux-sheet,
  .ux-side-sheet,
  .ux-action-sheet {
    transition: transform 0.1s ease;
  }

  .ux-sheet-backdrop--open .ux-sheet,
  .ux-sheet-backdrop[data-state="open"] .ux-sheet,
  .ux-sheet-backdrop[aria-hidden="false"] .ux-sheet,
  .ux-sheet-backdrop.is-open .ux-sheet,
  .ux-sheet-backdrop--open .ux-side-sheet--left,
  .ux-sheet-backdrop[data-state="open"] .ux-side-sheet--left,
  .ux-sheet-backdrop[aria-hidden="false"] .ux-side-sheet--left,
  .ux-sheet-backdrop.is-open .ux-side-sheet--left,
  .ux-sheet-backdrop--open .ux-side-sheet--right,
  .ux-sheet-backdrop[data-state="open"] .ux-side-sheet--right,
  .ux-sheet-backdrop[aria-hidden="false"] .ux-side-sheet--right,
  .ux-sheet-backdrop.is-open .ux-side-sheet--right,
  .ux-sheet-backdrop--open .ux-action-sheet,
  .ux-sheet-backdrop[data-state="open"] .ux-action-sheet,
  .ux-sheet-backdrop[aria-hidden="false"] .ux-action-sheet,
  .ux-sheet-backdrop.is-open .ux-action-sheet {
    transition: transform 0.1s ease;
  }
}
