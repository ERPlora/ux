@use '../core/mixins' as *;

/**
 * UX Masonry Component
 * Part of the UX CSS Library
 * https://github.com/user/ux
 */

/* ========================================
   UX Masonry - CSS Variables
   ======================================== */

:root {
  --ux-masonry-gap: var(--ux-space-md);
  --ux-masonry-radius: var(--ux-radius-lg);
  --ux-masonry-columns: 3;
  --ux-masonry-item-bg: var(--ux-surface);
}

/* ========================================
   UX Masonry - Base
   ======================================== */

.ux-masonry {
  font-family: var(--ux-font-family);

  &__grid {
    display: block;
    column-count: var(--ux-masonry-columns);
    column-gap: var(--ux-masonry-gap);
  }

  /* ========================================
     Column Variants
     ======================================== */

  &--cols-2 { --ux-masonry-columns: 2; }
  &--cols-3 { --ux-masonry-columns: 3; }
  &--cols-4 { --ux-masonry-columns: 4; }
  &--cols-5 { --ux-masonry-columns: 5; }
  &--cols-6 { --ux-masonry-columns: 6; }

  /* ========================================
     Gap Variants
     ======================================== */

  &--gap-none { --ux-masonry-gap: 0; }
  &--gap-xs { --ux-masonry-gap: var(--ux-space-xs); }
  &--gap-sm { --ux-masonry-gap: var(--ux-space-sm); }
  &--gap-md { --ux-masonry-gap: var(--ux-space-md); }
  &--gap-lg { --ux-masonry-gap: var(--ux-space-lg); }
  &--gap-xl { --ux-masonry-gap: var(--ux-space-xl); }

  /* ========================================
     Masonry Item
     ======================================== */

  &__item {
    position: relative;
    display: block;
    break-inside: avoid;
    margin-bottom: var(--ux-masonry-gap);
    overflow: hidden;
    border-radius: var(--ux-masonry-radius);
    background: var(--ux-masonry-item-bg);

    /* Prevent orphans and widows */
    &:last-child {
      margin-bottom: 0;
    }

    img {
      display: block;
      width: 100%;
      height: auto;
      border-radius: inherit;
      object-fit: cover;
      transition: transform var(--ux-transition-normal) var(--ux-ease);
    }

    /* Span (double width/height) */
    &--span-2 {
      column-span: all;
      width: calc((100% - var(--ux-masonry-gap)) / 2);
    }

    /* Hover effect */
    &--hover:hover img {
      transform: scale(1.05);
    }

    /* Clickable */
    &--clickable {
      cursor: pointer;
      transition:
        transform var(--ux-transition-fast) var(--ux-ease),
        box-shadow var(--ux-transition-fast) var(--ux-ease);
      -webkit-tap-highlight-color: transparent;

      &:hover {
        box-shadow: var(--ux-shadow-lg);
      }

      &:active {
        transform: scale(0.98);
      }

      &:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(var(--ux-primary-rgb), 0.3);
      }
    }

    /* Loading State / Skeleton */
    &--loading {
      min-height: 200px;
      background: linear-gradient(
        90deg,
        var(--ux-gray-100) 0%,
        var(--ux-gray-200) 50%,
        var(--ux-gray-100) 100%
      );
      background-size: 200% 100%;
      animation: ux-masonry-shimmer 1.5s infinite;
    }

    /* Glass variant */
    &--glass {
      background: var(--ux-glass-bg);
      backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      -webkit-backdrop-filter: blur(var(--ux-glass-blur)) saturate(var(--ux-glass-saturation));
      border: 0.5px solid var(--ux-glass-border);
      box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);

      .ux-masonry__item-content {
        background: transparent;
      }
    }
  }

  /* Image loading state */
  &__item img[loading="lazy"]:not([src]),
  &__item img.ux-masonry__img--loading {
    min-height: 200px;
    background: var(--ux-gray-100);
  }

  /* ========================================
     Masonry Item - Overlay
     ======================================== */

  &__item-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0);
    color: white;
    padding: var(--ux-space-md);
    text-align: center;
    transition: background var(--ux-transition-fast) var(--ux-ease);
  }

  &__item:hover &__item-overlay {
    background: rgba(0, 0, 0, 0.4);
  }

  &__item-title {
    font-size: var(--ux-font-size-lg);
    font-weight: 600;
    margin-bottom: var(--ux-space-xs);
    opacity: 0;
    transform: translateY(10px);
    transition: all var(--ux-transition-normal) var(--ux-ease);
  }

  &__item-subtitle {
    font-size: var(--ux-font-size-sm);
    opacity: 0;
    transform: translateY(10px);
    transition: all var(--ux-transition-normal) var(--ux-ease);
    transition-delay: 50ms;
  }

  &__item:hover &__item-title,
  &__item:hover &__item-subtitle {
    opacity: 1;
    transform: translateY(0);
  }

  /* ========================================
     Masonry Item - Content (for cards)
     ======================================== */

  &__item-content {
    padding: var(--ux-space-md);

    .ux-masonry__item-title {
      color: var(--ux-text);
      opacity: 1;
      transform: none;
      margin-bottom: var(--ux-space-sm);
    }

    .ux-masonry__item-subtitle {
      color: var(--ux-text-secondary);
      opacity: 1;
      transform: none;
    }
  }

  /* ========================================
     Animation on Load
     ======================================== */

  &--animated &__item {
    opacity: 0;
    transform: translateY(20px);
    animation: ux-masonry-fade-in var(--ux-transition-slow) var(--ux-ease) forwards;

    &:nth-child(1) { animation-delay: 0ms; }
    &:nth-child(2) { animation-delay: 50ms; }
    &:nth-child(3) { animation-delay: 100ms; }
    &:nth-child(4) { animation-delay: 150ms; }
    &:nth-child(5) { animation-delay: 200ms; }
    &:nth-child(6) { animation-delay: 250ms; }
    &:nth-child(7) { animation-delay: 300ms; }
    &:nth-child(8) { animation-delay: 350ms; }
    &:nth-child(9) { animation-delay: 400ms; }
    &:nth-child(10) { animation-delay: 450ms; }
    &:nth-child(11) { animation-delay: 500ms; }
    &:nth-child(12) { animation-delay: 550ms; }
    &:nth-child(n+13) { animation-delay: 600ms; }
  }

  /* ========================================
     Rounded Variants
     ======================================== */

  &--rounded-none &__item { border-radius: 0; }
  &--rounded-sm &__item { border-radius: var(--ux-radius-sm); }
  &--rounded-md &__item { border-radius: var(--ux-radius-md); }
  &--rounded-lg &__item { border-radius: var(--ux-radius-lg); }
  &--rounded-xl &__item { border-radius: var(--ux-radius-xl); }

  /* ========================================
     Shadow Variants
     ======================================== */

  &--shadow-none &__item { box-shadow: none; }
  &--shadow-sm &__item { box-shadow: var(--ux-shadow-sm); }
  &--shadow-md &__item { box-shadow: var(--ux-shadow-md); }
  &--shadow-lg &__item { box-shadow: var(--ux-shadow-lg); }

  /* Keep 2 columns on mobile if explicitly set */
  &--cols-2-always {
    --ux-masonry-columns: 2 !important;
  }
}

@keyframes ux-masonry-fade-in {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes ux-masonry-shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* ========================================
   Responsive Breakpoints
   ======================================== */

@media (max-width: 1200px) {
  .ux-masonry--cols-6 { --ux-masonry-columns: 4; }
  .ux-masonry--cols-5 { --ux-masonry-columns: 4; }
}

@media (max-width: 992px) {
  .ux-masonry--cols-6 { --ux-masonry-columns: 3; }
  .ux-masonry--cols-5 { --ux-masonry-columns: 3; }
  .ux-masonry--cols-4 { --ux-masonry-columns: 3; }
}

@media (max-width: 767px) {
  .ux-masonry--cols-6,
  .ux-masonry--cols-5,
  .ux-masonry--cols-4,
  .ux-masonry--cols-3 {
    --ux-masonry-columns: 2;
  }
}

@media (max-width: 480px) {
  .ux-masonry--cols-6,
  .ux-masonry--cols-5,
  .ux-masonry--cols-4,
  .ux-masonry--cols-3 {
    --ux-masonry-columns: 1;
  }

  .ux-masonry--cols-2 {
    --ux-masonry-columns: 1;
  }
}

/* ========================================
   Dark Mode
   ======================================== */

@media (prefers-color-scheme: dark) {
  :root:not(.ux-theme-light):not(.ux-light) {
    --ux-masonry-item-bg: var(--ux-surface);

    .ux-masonry__item--loading {
      background: linear-gradient(
        90deg,
        var(--ux-gray-800) 0%,
        var(--ux-gray-700) 50%,
        var(--ux-gray-800) 100%
      );
      background-size: 200% 100%;
    }

    .ux-masonry__item img[loading="lazy"]:not([src]),
    .ux-masonry__item img.ux-masonry__img--loading {
      background: var(--ux-gray-800);
    }
  }
}

.ux-dark,
.ux-theme-dark {
  .ux-masonry__item--loading {
    background: linear-gradient(
      90deg,
      var(--ux-gray-800) 0%,
      var(--ux-gray-700) 50%,
      var(--ux-gray-800) 100%
    );
    background-size: 200% 100%;
  }

  .ux-masonry__item img[loading="lazy"]:not([src]),
  .ux-masonry__item img.ux-masonry__img--loading {
    background: var(--ux-gray-800);
  }
}

/* ========================================
   Reduced Motion
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  .ux-masonry--animated .ux-masonry__item {
    animation: none;
    opacity: 1;
    transform: none;
  }

  .ux-masonry__item img,
  .ux-masonry__item-overlay,
  .ux-masonry__item-title,
  .ux-masonry__item-subtitle,
  .ux-masonry__item--clickable {
    transition: none;
  }

  .ux-masonry__item--loading {
    animation: none;
  }

  .ux-masonry__item--hover:hover img {
    transform: none;
  }
}
