/**
 * UX Mixins
 * Reusable SCSS mixins for consistent styling
 * Part of the UX CSS Library
 */

// ==========================================================
// State Selectors
// Generates multiple selectors for state compatibility
// ==========================================================

/// Generates state selectors for open/closed states
/// @param {String} $base - The base selector (e.g., '.ux-modal-backdrop')
/// @param {String} $state - The state name (e.g., 'open', 'closed')
@mixin state($base, $state) {
  #{$base}--#{$state},
  #{$base}[data-state="#{$state}"],
  #{$base}.is-#{$state} {
    @content;
  }

  // Add ARIA selectors for specific states
  @if $state == 'open' {
    #{$base}[aria-hidden="false"] {
      @content;
    }
  }
  @if $state == 'closed' {
    #{$base}[aria-hidden="true"] {
      @content;
    }
  }
  @if $state == 'expanded' {
    #{$base}[aria-expanded="true"] {
      @content;
    }
  }
  @if $state == 'collapsed' {
    #{$base}[aria-expanded="false"] {
      @content;
    }
  }
  @if $state == 'selected' {
    #{$base}[aria-selected="true"] {
      @content;
    }
  }
  @if $state == 'disabled' {
    #{$base}[aria-disabled="true"],
    #{$base}:disabled {
      @content;
    }
  }
}

// ==========================================================
// Glass Morphism
// iOS-style frosted glass effect
// ==========================================================

/// Applies glass morphism effect
/// @param {String} $bg - Background variable (default: --ux-glass-bg)
/// @param {String} $blur - Blur amount variable (default: --ux-glass-blur)
@mixin glass($bg: var(--ux-glass-bg), $blur: var(--ux-glass-blur)) {
  background: $bg;
  backdrop-filter: blur($blur) saturate(var(--ux-glass-saturation));
  -webkit-backdrop-filter: blur($blur) saturate(var(--ux-glass-saturation));
  border-color: var(--ux-glass-border);
  box-shadow: var(--ux-glass-shadow), var(--ux-glass-highlight);
}

/// Thick glass variant
@mixin glass-thick {
  @include glass(var(--ux-glass-bg-thick));
}

/// Thin glass variant
@mixin glass-thin {
  @include glass(var(--ux-glass-bg-thin));
}

// ==========================================================
// Touch & Interaction
// ==========================================================

/// Ensures minimum touch target size
/// @param {Length} $size - Minimum size (default: 44px)
@mixin touch-target($size: 44px) {
  min-height: $size;
  min-width: $size;
}

/// Touch feedback with scale effect
@mixin touch-feedback {
  transition: transform var(--ux-transition-fast) var(--ux-ease),
              opacity var(--ux-transition-fast) var(--ux-ease);

  &:active {
    transform: scale(0.97);
    opacity: 0.85;
  }
}

/// Ionic-style touch properties (disable browser default touch effects)
@mixin touch-native {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  touch-action: manipulation;
  user-select: none;
  -webkit-user-select: none;
}

/// Complete touch-friendly button behavior
@mixin touch-button {
  @include touch-native;
  @include touch-feedback;
  cursor: pointer;

  // Only hover on devices that support it
  @media (hover: hover) and (pointer: fine) {
    &:hover {
      @content;
    }
  }
}

/// Ripple effect base
@mixin ripple {
  position: relative;
  overflow: hidden;

  &::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
  }

  &:active::after {
    width: 200%;
    height: 200%;
    opacity: 1;
    transition: width 0s, height 0s, opacity 0s;
  }

  &:not(:active)::after {
    transition: width var(--ux-transition-slow), height var(--ux-transition-slow), opacity var(--ux-transition-slow);
  }
}

// ==========================================================
// Responsive Breakpoints
// ==========================================================

/// Mobile breakpoint (max-width: 767px)
@mixin mobile {
  @media (max-width: 767px) {
    @content;
  }
}

/// Tablet breakpoint (min-width: 768px) and (max-width: 991px)
@mixin tablet {
  @media (min-width: 768px) and (max-width: 991px) {
    @content;
  }
}

/// Desktop breakpoint (min-width: 992px)
@mixin desktop {
  @media (min-width: 992px) {
    @content;
  }
}

/// Custom breakpoint
/// @param {Length} $min - Minimum width (optional)
/// @param {Length} $max - Maximum width (optional)
@mixin breakpoint($min: null, $max: null) {
  @if $min and $max {
    @media (min-width: $min) and (max-width: $max) {
      @content;
    }
  } @else if $min {
    @media (min-width: $min) {
      @content;
    }
  } @else if $max {
    @media (max-width: $max) {
      @content;
    }
  }
}

// ==========================================================
// Accessibility
// ==========================================================

/// Reduced motion media query
@mixin reduced-motion {
  @media (prefers-reduced-motion: reduce) {
    @content;
  }
}

/// Focus visible styles (enhanced for Windows/accessibility)
@mixin focus-visible {
  &:focus {
    outline: none;
  }

  &:focus-visible {
    outline: var(--ux-focus-ring-width) var(--ux-focus-ring-style, solid) var(--ux-focus-ring-color);
    outline-offset: var(--ux-focus-ring-offset);
    // Extra glow for better visibility on Windows
    box-shadow: 0 0 0 calc(var(--ux-focus-ring-width) + 1px) rgba(var(--ux-primary-rgb), 0.2);
  }
}

/// Focus visible with inset style
@mixin focus-visible-inset {
  &:focus {
    outline: none;
  }

  &:focus-visible {
    box-shadow: inset 0 0 0 var(--ux-focus-ring-width) var(--ux-focus-ring-color);
  }
}

/// Focus ring with box-shadow
@mixin focus-ring {
  &:focus {
    outline: none;
    box-shadow: 0 0 0 3px var(--ux-primary-tint);
  }
}

/// Screen reader only (visually hidden)
@mixin sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// ==========================================================
// Layout Utilities
// ==========================================================

/// Flexbox center (both axes)
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

/// Flexbox space between
@mixin flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/// Absolute center
@mixin absolute-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

/// Absolute fill (cover parent)
@mixin absolute-fill {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}

/// Fixed fill (cover viewport)
@mixin fixed-fill {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}

// ==========================================================
// Typography
// ==========================================================

/// Text truncation (ellipsis)
@mixin truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/// Line clamp (multi-line truncation)
/// @param {Number} $lines - Number of lines to show
@mixin line-clamp($lines: 2) {
  display: -webkit-box;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

// ==========================================================
// Scrollbar Utilities
// ==========================================================

/// Hide scrollbar but keep scrolling
@mixin hide-scrollbar {
  scrollbar-width: none;
  -ms-overflow-style: none;

  &::-webkit-scrollbar {
    display: none;
  }
}

/// Thin scrollbar
@mixin thin-scrollbar {
  scrollbar-width: thin;

  &::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
}

// ==========================================================
// Transitions
// ==========================================================

/// Standard transition
/// @param {String} $property - CSS property to transition (default: all)
@mixin transition($property: all) {
  transition: $property var(--ux-transition-normal) var(--ux-ease);
}

/// Fast transition
@mixin transition-fast($property: all) {
  transition: $property var(--ux-transition-fast) var(--ux-ease);
}

/// Slow transition
@mixin transition-slow($property: all) {
  transition: $property var(--ux-transition-slow) var(--ux-ease);
}

/// Spring transition (bouncy)
@mixin transition-spring($property: all) {
  transition: $property var(--ux-transition-normal) var(--ux-ease-spring);
}

/// iOS-style transition
@mixin transition-ios($property: all) {
  transition: $property var(--ux-transition-normal) var(--ux-ease-ios);
}

// ==========================================================
// Disabled State
// ==========================================================

/// Disabled state styling
@mixin disabled {
  opacity: var(--ux-disabled-opacity);
  cursor: var(--ux-disabled-cursor);
  pointer-events: none;
}

// ==========================================================
// Color Variants
// ==========================================================

/// Apply color variant variables
/// @param {Color} $bg - Background color
/// @param {Color} $color - Text color
/// @param {Color} $border - Border color
/// @param {Color} $hover - Hover background color
@mixin color-variant($bg, $color, $border: $bg, $hover: null) {
  --ux-variant-bg: #{$bg};
  --ux-variant-color: #{$color};
  --ux-variant-border: #{$border};
  @if $hover {
    --ux-variant-bg-hover: #{$hover};
  }
}
